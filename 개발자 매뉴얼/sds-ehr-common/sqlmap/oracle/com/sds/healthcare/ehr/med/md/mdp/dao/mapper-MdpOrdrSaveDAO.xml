<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_MdpOrdrSaveDAO_sql.xml 
    Description : -->
<mapper namespace="MdpOrdrSaveDAO">


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrSaveDual-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="wardCd" column="WARD_CD"/>
		<result property="mdcrDt" column="MDCR_DT"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="ptadCodvCd" column="PTAD_CODV_CD"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="orfrCd" column="ORFR_CD"/>
		<result property="orocDprtCd" column="OROC_DPRT_CD"/>
		<result property="frnsDprtCd" column="FRNS_DPRT_CD"/>
		<result property="slipCd" column="SLIP_CD"/>
		<result property="adtnOrdvCd" column="ADTN_ORDV_CD"/>
		<result property="orcnNursId" column="ORCN_NURS_ID"/>
		<result property="orcnDt" column="ORCN_DT"/>
		<result property="dcOddrId" column="DC_ODDR_ID"/>
		<result property="dcOrdrDt" column="DC_ORDR_DT"/>
		<result property="dcCnnuId" column="DC_CNNU_ID"/>
		<result property="dcCnfrDt" column="DC_CNFR_DT"/>
		<result property="inptUserDvsnCd" column="INPT_USER_DVSN_CD"/>
		<result property="crtfTrgtYn" column="CRTF_TRGT_YN"/>
		<result property="athnId" column="ATHN_ID"/>
		<result property="crtfIp" column="CRTF_IP"/>
		<result property="crtfDt" column="CRTF_DT"/>
		<result property="oprtYmd" column="OPRT_YMD"/>
		<result property="oprtSno" column="OPRT_SNO"/>
		<result property="itrnBsdvCd" column="ITRN_BSDV_CD"/>
		<result property="srrqCmntCtn" column="SRRQ_CMNT_CTN"/>
		<result property="insrIpdvCd" column="INSR_IPDV_CD"/>
		<result property="durvYn" column="DURV_YN"/>
		<result property="durvOrtaNm" column="DURV_ORTA_NM"/>
		<result property="durvOrdrYmd" column="DURV_ORDR_YMD"/>
		<result property="durvOrdrCd" column="DURV_ORDR_CD"/>
		<result property="ordrValdStrtYmd" column="ORDR_VALD_STRT_YMD"/>
		<result property="ordrValdFnshYmd" column="ORDR_VALD_FNSH_YMD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="uprcOrdrNm" column="UPRC_ORDR_NM"/>
		<result property="mdprNm" column="MDPR_NM"/>
		<result property="ingrNm" column="INGR_NM"/>
		<result property="antcOrdvVl" column="ANTC_ORDV_VL"/>
		<result property="ordrSlctDvsnCd" column="ORDR_SLCT_DVSN_CD"/>
		<result property="cmmdPrsrYn" column="CMMD_PRSR_YN"/>
		<result property="ocdtCd" column="OCDT_CD"/>
		<result property="ocfmCd" column="OCFM_CD"/>
		<result property="ocfmDetlCd" column="OCFM_DETL_CD"/>
		<result property="ocpsCd" column="OCPS_CD"/>
		<result property="ordrCrtnDvsnCd" column="ORDR_CRTN_DVSN_CD"/>
		<result property="oddrMcdpCd" column="ODDR_MCDP_CD"/>
		<result property="oprtSqnc" column="OPRT_SQNC"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="sckbNo" column="SCKB_NO"/>
		<result property="userDprtCd" column="USER_DPRT_CD"/>
		<result property="userId" column="USER_ID"/>
		<result property="userIp" column="USER_IP"/>
		<result property="afiOrdrValdChupYn" column="AFI_ORDR_VALD_CHUP_YN"/>
		<result property="mdcrClasCd" column="MDCR_CLAS_CD"/>
		<result property="afiOrdrUseDvsnVl" column="AFI_ORDR_USE_DVSN_VL"/>
		<result property="afiOrdrClotDvsnVl" column="AFI_ORDR_CLOT_DVSN_VL"/>
		<result property="anshId" column="ANSH_ID"/>
		<result property="asndrNm" column="ASNDR_NM"/>
		<result property="brrn" column="BRRN"/>
		<result property="btdt" column="BTDT"/>
		<result property="cpCd" column="CP_CD"/>
		<result property="frrn" column="FRRN"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="gndrId" column="GNDR_ID"/>
		<result property="hslcDvsnCd" column="HSLC_DVSN_CD"/>
		<result property="mainScinCd" column="MAIN_SCIN_CD"/>
		<result property="mccnCd" column="MCCN_CD"/>
		<result property="mddrId" column="MDDR_ID"/>
		<result property="dprtNm" column="DPRT_NM"/>
		<result property="vatTrgtCd" column="VAT_TRGT_CD"/>
		<result property="tmprOrdrYn" column="TMPR_ORDR_YN"/>
		<result property="afiOrglOrdrDcDvsnCd" column="AFI_ORGL_ORDR_DC_DVSN_CD"/>
		<result property="cnplCd" column="CNPL_CD"/>
		<result property="orocCd" column="OROC_CD"/>
		<result property="atmtCmltFnctUseYn" column="ATMT_CMLT_FNCT_USE_YN"/>
		<result property="inqrCndtVl" column="INQR_CNDT_VL"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="bdwgVl" column="BDWG_VL"/>
		<result property="sdpfExreCd" column="SDPF_EXRE_CD"/>
		<result property="allDrugDcYn" column="ALL_DRUG_DC_YN"/>
		<result property="mccnMcdpCd" column="MCCN_MCDP_CD"/>
		<result property="mdcrAndvCd" column="MDCR_ANDV_CD"/>
		<result property="userLcnsNo" column="USER_LCNS_NO"/>
		<result property="userSpczDrlcNo" column="USER_SPCZ_DRLC_NO"/>
		<result property="dschPrrnDt" column="DSCH_PRRN_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrSaveDual (DVO Parameter를 유지하기 위한 DUAL SELECT) 
        Description :                                           DVO Parameter 를 유지하기 위한 DUAL SELECT.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrSaveDual-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrSaveDual"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrSaveDual-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrSaveDual */
		           '' as WARD_CD
		        ,  '' as MDCR_DT
		        ,  '' as DC_DVSN_CD
		        ,  '' as CHDR_ID
		        ,  '' as PTAD_CODV_CD
		        ,  '' as ORCL_CD
		        ,  '' as ODKI_CD
		        ,  '' as ODKI_DETL_CD
		        ,  '' as ORFR_CD
		        ,  '' as OROC_DPRT_CD
		        ,  '' as FRNS_DPRT_CD
		        ,  '' as SLIP_CD
		        ,  '' as ADTN_ORDV_CD
		        ,  '' as ORCN_NURS_ID
		        ,  '' as ORCN_DT
		        ,  '' as DC_ODDR_ID
		        ,  '' as DC_ORDR_DT
		        ,  '' as DC_CNNU_ID
		        ,  '' as DC_CNFR_DT
		        ,  '' as INPT_USER_DVSN_CD
		        ,  '' as CRTF_TRGT_YN
		        ,  '' as ATHN_ID
		        ,  '' as CRTF_IP
		        ,  '' as CRTF_DT
		        ,  '' as OPRT_YMD
		        ,  0  as OPRT_SNO
		        ,  '' as ITRN_BSDV_CD
		        ,  '' as SRRQ_CMNT_CTN
		        ,  '' as INSR_IPDV_CD
		        ,  '' as DURV_YN
		        ,  '' as DURV_ORTA_NM
		        ,  '' as DURV_ORDR_YMD
		        ,  '' as DURV_ORDR_CD
		        ,  '' as ORDR_VALD_STRT_YMD
		        ,  '' as ORDR_VALD_FNSH_YMD
		        ,  '' as ORDR_NM
		        ,  '' as UPRC_ORDR_NM
		        ,  '' as MDPR_NM
		        ,  '' as INGR_NM
		        ,  '' as ANTC_ORDV_VL
		        ,  '' as ORDR_SLCT_DVSN_CD
		        ,  '' as CMMD_PRSR_YN
		        ,  '' as OCDT_CD
		        ,  '' as OCFM_CD
		        ,  '' as OCFM_DETL_CD
		        ,  '' as OCPS_CD
		        ,  '' as ORDR_CRTN_DVSN_CD
		        ,  '' as ODDR_MCDP_CD
		        ,   0 as OPRT_SQNC
		        ,  '' as PTNT_NM
		        ,   0 as SCKB_NO
		        ,  '' as USER_DPRT_CD
		        ,  '' as USER_ID
		        ,  '' as USER_IP
		        ,  '' as AFI_ORDR_VALD_CHUP_YN
		        ,  '' as MDCR_CLAS_CD
		        ,  '' as AFI_ORDR_USE_DVSN_VL
		        ,  '' as AFI_ORDR_CLOT_DVSN_VL
		        ,  '' as ANSH_ID
		        ,  '' as ASNDR_NM
		        ,  '' as BRRN
		        ,  '' as BTDT
		        ,  '' as CP_CD
		        ,  '' as FRRN
		        ,  '' as GEND_CD
		        ,  '' as GNDR_ID
		        ,  '' as HSLC_DVSN_CD
		        ,  '' as MAIN_SCIN_CD
		        ,  '' as MCCN_CD
		        ,  '' as MDDR_ID
		        ,  '' as DPRT_NM
		        ,  '' as VAT_TRGT_CD
		        ,  '' as TMPR_ORDR_YN
		        ,  '' as AFI_ORGL_ORDR_DC_DVSN_CD
		        ,  '' as CNPL_CD
		        ,  '' as OROC_CD
		        ,  '' as ATMT_CMLT_FNCT_USE_YN
		        ,  '' as INQR_CNDT_VL
		        ,  0 as PTAD_MDRP_NO
		        ,  0 as BDWG_VL
		        ,  '' as SDPF_EXRE_CD
		        ,  '' as ALL_DRUG_DC_YN
		        ,  '' as MCCN_MCDP_CD
		        ,  '' as MDCR_ANDV_CD
		        ,  '' as USER_LCNS_NO
		        ,  '' as USER_SPCZ_DRLC_NO
		        ,  '' as DSCH_PRRN_DT
		from dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtntOrdrBsisInfmYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="yn" column="YN"/>
		<result property="rgorFinsYn" column="RGOR_FINS_YN"/>
		<result property="sporExstYn" column="SPOR_EXST_YN"/>
		<result property="dgstRqstYn" column="DGST_RQST_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtntOrdrBsisInfmYn (환자처방기본 정보 유무 및 정규처방 완료 여부 조회) 
        Description :                                           환자처방기본 정보 유무 및 정규처방 완료 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtntOrdrBsisInfmYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtntOrdrBsisInfmYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtntOrdrBsisInfmYn-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtntOrdrBsisInfmYn */
		           case when count ( ptno ) > 0 then 'Y' else 'N' end  as YN
		        ,  case when count ( RGOR_CNNU_ID ) > 0  then 'Y' else 'N' end as RGOR_FINS_YN /*  정규처방 확인간호사가 있을 경우 정규처방 완료 */
		        ,  case when sum(decode(SPOR_EXST_YN, 'Y', 1, 0)) > 0 then 'Y' else 'N' end as SPOR_EXST_YN
		        ,  case when sum(decode(RCST_CD, 'F', 1, 0)) > 0 then 'Y' else 'N' end as DGST_RQST_YN	/* 약물요청여부 */
		  from  MDPAORDBT
		where  PTNO    = #{ptno}
		   and  MDRP_NO = #{mdrpNo}
		   and  ORDR_YMD = to_date( #{ordrYmd},'yyyymmdd')
		   and  rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneDlysPtntOrdrBsisInfmYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneDlysPtntOrdrBsisInfmYn (환자번호,처방일 조회 조건으로 투석환자 처방 기본정보 유무 조회) 
        Description :                                           환자번호,처방일 조회 조건으로 투석환자 처방 기본정보 유무를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneDlysPtntOrdrBsisInfmYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneDlysPtntOrdrBsisInfmYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneDlysPtntOrdrBsisInfmYn-result" useCache="true" flushCache="false">
		 select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneDlysPtntOrdrBsisInfmYn */
		           case when count ( PTNO ) &gt; 0 then 'Y' else 'N'end as YN
		  from  MNHPBASET
		where  PTNO   = #{ptno}
		   and  ORDR_YMD = to_date( #{ordrYmd},'yyyymmdd')
		   and  rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoOrdrExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoOrdrExstYn (처방별 항암제차수 처방존재여부 조회) 
        Description :                                           처방별 항암제차수 처방존재여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoOrdrExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoOrdrExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoOrdrExstYn-result" useCache="true" flushCache="false">
		 select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoOrdrExstYn */
		           case  when count ( PTNO ) &gt; 0 then 'Y' else 'N'end as YN
		  from  MDCHEMOCT
		where
			       PTNO = #{ptno}
		   and  ORDR_YMD = to_date( #{ordrYmd}, 'yyyymmdd' )
		   and  ORDR_SNO = #{ordrSno}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneCareWardCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="careWardCd" column="CARE_WARD_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneCareWardCd () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneCareWardCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneCareWardCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneCareWardCd-result" useCache="true" flushCache="false">
		 select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneCareWardCd */
		           CARE_WARD_CD as CARE_WARD_CD
		  from  APRCRPTNT a
		where  MDRP_NO = #{mdrpNo}
		   and  CODV_CD = 'I'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrPsblYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="afiErrMesgCtn" column="AFI_ERR_MESG_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrPsblYn (진료접수번호 조회조건으로 처방가능 여부조회) 
        Description :                                           진료접수번호 조회조건으로 처방가능 여부조회를 조회한다. ( 원무함수 fn_ac_get_ordr_psbl_yn 사용
                                                                )
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrPsblYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrPsblYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrPsblYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneOrdrPsblYn */
		          fn_ac_get_ordr_psbl_yn ( #{mdrpNo}) as AFI_ERR_MESG_CTN
		 from  dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePacsOrdrAccsNo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="pacsAccsNo" column="PACS_ACCS_NO"/>
		<result property="pacsCdNm" column="PACS_CD_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePacsOrdrAccsNo (PACS처방 접근번호 생성) 
        Description :                                           처방내림시 PACS 인터페이스 대상인 경우 접근번호 생성한다. ( PACS 처방과 인터페이스 테이블에 접근번호 저장
                                                                )
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePacsOrdrAccsNo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePacsOrdrAccsNo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePacsOrdrAccsNo-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePacsOrdrAccsNo */
		          case when substr ( #{ordrCltyCd}, 0, 1 ) = 'C'
		                 then decode(#{ordrCd},'ID910','O','Z')
		                         || substr(to_char(sysdate,'yyyy-mm-dd'),3,2)
		                         || decode(substr(to_char(sysdate,'yyyy-mm-dd'),6,2),'10','A','11','B','12','C',substr(to_char(sysdate,'yyyy-mm-dd'),7,1))
		                         || substr(to_char(sysdate,'yyyy-mm-dd'),9,2) ||lpad(MDACCNOSQ.nextval,4,'0')
		                  /*  치과 PACS 접근번호 생성 */
		                 else decode(substr(#{ordrCd},1,2),'KR','D','B')
		                        || substr(to_char(sysdate,'yyyy-mm-dd'),3,2)
		                        || decode(substr(to_char(sysdate,'yyyy-mm-dd'),6,2),'10','A','11','B','12','C',substr(to_char(sysdate,'yyyy-mm-dd'),7,1))
		                        || substr(to_char(sysdate,'yyyy-mm-dd'),9,2) ||lpad(MDACCNOSQ.nextval,4,'0')end as PACS_ACCS_NO
		       ,  ( select  DETL_CD_NM
		             from  CCCMCDDMT
		           where  COMN_GRP_CD = 'MM998'
		              and  COMN_DTLS_CD = #{pacsCd}
		              and  ROWNUM < 2) as PACS_CD_NM
		 from  dual
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoInfmYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoInfmYn (처방일 기준 처방별 항암제차수 정보 유무 조회) 
        Description :                                           처방내림시 처방항암차수 정보가 있는 경우 처방일 기준 처방별 항암제차수 정보 유무 정보를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoInfmYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoInfmYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoInfmYn-result" useCache="true" flushCache="false">
		 select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAcdgOrnoInfmYn */
		           case  when count ( PTNO ) &gt; 0 then 'Y' else 'N'end as YN
		   from  MDCHEMOCT
		 where
		            PTNO = #{ptno}
		    and  ORDR_YMD = to_date( #{ordrYmd}, 'yyyymmdd' )
		    and  ORDR_CD = #{ordrCd}
		    and  DRAP_MDCF_CD = 'DG1'
		    and  ORDR_SNO = 0
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAntcThrpMngmDvsnCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="admsInptNotcLmttDdcn" column="ADMS_INPT_NOTC_LMTT_DDCN"/>
		<result property="antcThrpMngmDvsnCd" column="ANTC_THRP_MNGM_DVSN_CD"/>
		<result property="adltDdcn" column="ADLT_DDCN"/>
		<result property="chldDdcn" column="CHLD_DDCN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAntcThrpMngmDvsnCd (항암제수가코드 입원입력노티제한일수, 항암요법관리구분코드 조회) 
        Description :                                           처방내림시 항암제차수입력 대상 처방이 있는 경우 처방별항암제차수 저장시 사용할 항암제수가코드 입원입력노티제한일수,
                                                                항암요법관리구분코드 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAntcThrpMngmDvsnCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAntcThrpMngmDvsnCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAntcThrpMngmDvsnCd-result" useCache="true" flushCache="false">
		 select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneAntcThrpMngmDvsnCd */
		           case when #{ordrCd} = 'PED' then nvl( CHLD_ADMS_INPT_NOTC_LMTT_DDCN, 0 ) else nvl ( ADLT_ADMS_INPT_NOTC_LMTT_DDCN, 0 )end as ADMS_INPT_NOTC_LMTT_DDCN
		        ,  ANTC_THRP_MNGM_DVSN_CD as ANTC_THRP_MNGM_DVSN_CD
		        ,  ADLT_DDCN as ADLT_DDCN
		        ,  CHLD_DDCN as CHLD_DDCN
		  from  AIMFACDGT
		where  MDFE_CD    = nvl( #{ordrCd}, MDFE_CD)
		   and  trunc(sysdate) between APST_YMD and APFN_YMD
		   and  rownum = 1
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateCpOrdrDcInfm (CP처방 DC처리) 
        Description :                                           처방 DC를 내린 경우 CP 처방 SET이 대상인 경우 처방발행내역을 Clear 한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateCpOrdrDcInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateCpOrdrDcInfm */
		            MDCPPATDT
		      set
		            ORDR_APLY_YMD = null                                                  /*  처방적용일자 = 처방일자 */
		         ,  MDRP_NO = null                                                  /*  진료접수번호 */
		         ,  MCDP_CD = null                                                  /*  진료과코드 */
		         ,  MDDR_ID = null                                                  /*  진료의사ID */
		         ,  CODV_CD = null                                                  /*  내원구분코드 */
		         ,  HSLC_DVSN_CD = null                                                  /*  병원위치구분코드 */
		         ,  MCCN_CD = null                                                  /*  진료센터코드 */
		         ,  DTLS_MCDP_CD = null                                                  /*  세부진료과코드 */
		         ,  PADV_CD = null                                                  /*  장소구분코드 */
		         ,  LAST_UPDR_ID = #{gvUserId}                                           /*  최종수정자ID */
		         ,  LAST_UPDT_IP = #{gvUserIp}                                           /*  최종수정IP */
		         ,  LAST_UPDT_DT = sysdate                                               /*  최종수정일시 */
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                  /*  최종수정SMC클라이언트프로그램ID */
		         ,  LAST_UPDT_SRVR_PRGM_ID  = #{gvSrvrPrgmId}                                  /*  최종수정SMC서버프로그램ID */
		where
		            ORDR_CRTN_LNKN_NO = #{ordrCrtnLnknNo}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updatePtntOrdrBsisInfmAdtnInfm (환자처방기본 DC처방정보 update) 
        Description :                                           처방내림시 DC처방정보가 있는 경우 환자처방기본 테이블에 DC처방정보를 update 한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updatePtntOrdrBsisInfmAdtnInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updatePtntOrdrBsisInfmAdtnInfm */
		            MDPAORDBT
		      set  ADTN_ODDR_ID = #{oddrId}                              /*  추가처방(DC)의사 */
		         ,  ADOR_DT      = to_date(#{ordrDt},'yyyymmddhh24miss')  /*  추가처방일시     */
		         ,  LAST_UPDR_ID = #{gvUserId}                            /*  최종수정자ID */
		         ,  LAST_UPDT_IP = #{gvUserIp}                            /*  최종수정IP */
		         ,  LAST_UPDT_DT = to_date(#{ordrDt},'yyyymmddhh24miss')  /*  최종수정일시 */
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}              /*  최종수정SMC클라이언트프로그램ID */
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}              /*  최종수정SMC서버프로그램ID */
		 where  PTNO         = #{ptno}
		    and  MDRP_NO      = #{mdrpNo}
		    and  CODV_CD      = #{codvCd}
		    and  ORDR_YMD     = to_date(#{ordrYmd},'yyyymmdd')
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updatePtntOrdrBsisInfm (환자처방기본 정보 수정 update) 
        Description :                                           처방내림시 신규처방이 있고 처방일 조건으로 환자처방기본 정보가 이미 있는 경우 수정처리 한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updatePtntOrdrBsisInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updatePtntOrdrBsisInfm */
		             MDPAORDBT
		      set
		             RGOR_FNDR_ID = case when RGOR_FNDR_ID is null then #{rgorFndrId}
		                                            else RGOR_FNDR_ID end       /*  정규처방완료의사 : NULL일 경우에만 업데이트 */
		          ,  RGOR_FINS_DT = case when RGOR_FINS_DT is null then to_date(#{rgorFinsDt}, 'YYYYMMDDHH24MISS')
		                                            else RGOR_FINS_DT end       /*  정규처방완료일시 : NULL일 경우에만 업데이트 */
		          ,  ADTN_ODDR_ID = case when #{adtnOddrId} is null then ADTN_ODDR_ID
		                                             else #{adtnOddrId} end /*  추가처방의사ID */
		          ,  ADOR_DT      = case when #{adorDt} is null then ADOR_DT
		                                         else to_date( #{adorDt} ,'yyyymmddhh24miss') end      /*  추가처방일시 */
		          ,  MDCR_LAST_ORDR_DT = case when #{mdcrLastOrdrDt} is null then MDCR_LAST_ORDR_DT
		                                                      else to_date( #{mdcrLastOrdrDt},'yyyymmddhh24miss') end /*  진료최종처방일시 */
		          ,  LAST_UPDR_ID = #{gvUserId}                                                                  /*  최종수정자ID */
		          ,  LAST_UPDT_IP = #{gvUserIp}                                                                  /*  최종수정IP */
		          ,  LAST_UPDT_DT = to_date(#{ordrDt},'yyyymmddhh24miss')                                        /*  최종수정일시 */
		          ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                                    /*  최종수정SMC클라이언트프로그램ID */
		          ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                                    /*  최종수정SMC서버프로그램ID */
		 where  PTNO = #{ptno}
		    and  MDRP_NO = #{mdrpNo}
		    and  ORDR_YMD = to_date(#{ordrYmd},'yyyymmdd')
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateDlysPtntOrdrBsisInfm (투석환자 처방기본 정보 update) 
        Description :                                           처방내림시 처방발생원이 투석이 있는 경우 투석환자 처방기본 정보가 이미 있으면 수정처리 한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateDlysPtntOrdrBsisInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateDlysPtntOrdrBsisInfm */
		            MNHPBASET
		      set
		            RGOR_FINS_YN = decode(RGOR_CNFR_YN,'Y',RGOR_FINS_YN,'Y')                                    /*  정규처방완료여부 */
		         ,  RGOR_FNDR_ID = decode(RGOR_CNFR_YN,'Y',RGOR_FNDR_ID  ,#{gvUserId})                          /*  정규처방완료의사ID */
		         ,  RGOR_FINS_DT = decode(RGOR_CNFR_YN,'Y',RGOR_FINS_DT, to_date(#{ordrDt},'yyyymmddhh24miss')) /*  정규처방완료일시 */
		         ,  ADOR_YN = decode(RGOR_CNNU_ID,null,ADOR_YN,'Y')                                        /*  추가처방여부 */
		         ,  ADTN_ODDR_ID = decode(RGOR_CNNU_ID,null,ADTN_ODDR_ID,#{gvUserId})                           /*  추가처방의사 */
		         ,  ADOR_DT = decode(RGOR_CNNU_ID,null,ADOR_DT,to_date(#{ordrDt},'yyyymmddhh24miss'))      /*  추가처방일시 */
		         ,  ADTN_ORCN_YN = null                                                                         /*  추가처방확인여부-간호사 */
		         ,  LAST_UPDR_ID = #{gvUserId}                                                                  /*  최종수정자ID */
		         ,  LAST_UPDT_IP = #{gvUserIp}                                                                  /*  최종수정IP */
		         ,  LAST_UPDT_DT = to_date(#{ordrDt},'yyyymmddhh24miss')                                        /*  최종수정일시 */
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                                    /*  최종수정SMC클라이언트프로그램ID */
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                                    /*  최종수정SMC서버프로그램ID */
		 where  PTNO = #{ptno}
		    and  ORDR_YMD = to_date(#{ordrYmd},'yyyymmdd')
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateDlysPtntOrdrDc (투석환자 DC 처리시 투석환자 처방기본 정보 update) 
        Description :                                           투석환자 DC 처리시 투석환자 처방기본 정보를 수정한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateDlysPtntOrdrDc"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateDlysPtntOrdrDc */
		            MNHPBASET
		      set  ADTN_ODDR_ID = #{oddrId}                                                                   /*  추가처방(DC)의사 */
		         ,  ADOR_DT      = to_date(#{ordrDt},'yyyymmddhh24miss')                                       /*  추가처방일시     */
		         ,  LAST_UPDR_ID = #{gvUserId}                                                                 /*  최종수정자ID */
		         ,  LAST_UPDT_IP = #{gvUserIp}                                                                 /*  최종수정IP */
		         ,  LAST_UPDT_DT = to_date(#{ordrDt},'yyyymmddhh24miss')                                       /*  최종수정일시 */
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                                   /*  최종수정SMC클라이언트프로그램ID */
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                                   /*  최종수정SMC서버프로그램ID */
		 where  PTNO         = #{ptno}
		    and  ORDR_YMD     = to_date(#{ordrYmd},'yyyymmdd')
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateOrdrSetMntcCnfr (처방 SET 정비 확인) 
        Description :                                           처방 SET을 통해 처방이 발행 된 경우 해당 처방 SET은 정비를 한것으로 간주 한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateOrdrSetMntcCnfr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateOrdrSetMntcCnfr */
		            MDOSETBST
		     set
		            CNFM_ID = #{cnfmId}                                             /*  확인자ID */
		         ,  CNFR_DT = sysdate                                               /*  확인일시 */
		         ,  LAST_UPDR_ID = #{gvUserId}                                           /*  최종수정자ID */
		         ,  LAST_UPDT_IP = #{gvUserIp}                                           /*  최종수정IP */
		         ,  LAST_UPDT_DT = sysdate                                               /*  최종수정일시 */
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                  /*  최종수정SMC클라이언트프로그램ID */
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                  /*  최종수정SMC서버프로그램ID */
		where
		            ORDR_CRTN_LNKN_NO = #{ordrCrtnLnknNo}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAntcOrdrDc (항암처방 DC처리) 
        Description :                                           처방을 DC한 경우 가처방으로 처방 발행한 처방의 처방 발행여부를 수정한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAntcOrdrDc"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAntcOrdrDc */
		            MEACMDPLT
		      set
		            MDRP_NO = 0                                                     /*  진료접수번호 */
		         ,  ORDR_APLY_YMD = null                                                  /*  처방적용일자 */
		         ,  LAST_UPDR_ID = #{gvUserId}                                           /*  최종수정자ID */
		         ,  LAST_UPDT_IP = #{gvUserIp}                                           /*  최종수정IP */
		         ,  LAST_UPDT_DT = sysdate                                               /*  최종수정일시 */
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                  /*  최종수정SMC클라이언트프로그램ID */
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                  /*  최종수정SMC서버프로그램ID */
		where
		      ORDR_CRTN_LNKN_NO = #{ordrCrtnLnknNo}                                         /*  처방생성연결번호 */
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAcdgOrnoOrdrCncl (처방DC에 따른 처방별 항암제차수 정보 취소) 
        Description :                                           처방DC 에 따른 처방별항암제차수 정보를 취소한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAcdgOrnoOrdrCncl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAcdgOrnoOrdrCncl */
		            MDCHEMOCT
		      set  CNCL_DT        = sysdate
		         ,  LAST_UPDR_ID   = #{gvUserId}                                                 /* 최종수정자ID        */
		         ,  LAST_UPDT_IP   = #{gvUserIp}                                                 /* 최종수정IP          */
		         ,  LAST_UPDT_DT   = sysdate                                                     /* 최종수정일시         */
		         ,  LAST_UPDT_CLNT_PRGM_ID  = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID  = #{gvSrvrPrgmId}
		where
		           PTNO = #{ptno}
		  and   ORDR_YMD = to_date( #{ordrYmd},'yyyymmdd')
		  and   ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAntcOrdrCrtnLnknNo (가처방으로 처방 발행 시 처방생성연결번호를 통해 처방 발행여부를 수정) 
        Description :                                           가처방으로 처방 발행 시 처방생성연결번호를 통해 처방 발행여부를 수정한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAntcOrdrCrtnLnknNo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		 update /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAntcOrdrCrtnLnknNo */
		             MEACMDPLT
		       set
		             MDRP_NO = #{mdrpNo}                                             /*  진료접수번호 */
		          ,  ORDR_APLY_YMD = to_date(#{ordrYmd}, 'yyyymmdd')                       /*  처방일자 */
		          ,  LAST_UPDR_ID = #{gvUserId}                                           /*  최종수정자ID */
		          ,  LAST_UPDT_IP = #{gvUserIp}                                           /*  최종수정IP */
		          ,  LAST_UPDT_DT = sysdate                                               /*  최종수정일시 */
		          ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                  /*  최종수정SMC클라이언트프로그램ID */
		          ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                  /*  최종수정SMC서버프로그램ID */
		where
		            ORDR_CRTN_LNKN_NO = #{ordrCrtnLnknNo}                                         /*  처방생성연결번호 */
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAcdgOrnoOrdrSno (처방별 항암제차수 처방분류코드 약제 수정) 
        Description :                                           신규항암제차수 저장시(처방내림) 처방당일 이미 항암제차수 정보가 있을경우 신규항암차수 처방일련번호로 Update
                                                                처리한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAcdgOrnoOrdrSno"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateAcdgOrnoOrdrSno */
		            MDCHEMOCT
		      set  ORDR_SNO       = #{ordrSno}
		         ,  LAST_UPDR_ID   = #{gvUserId}                                                 /* 최종수정자ID        */
		         ,  LAST_UPDT_IP   = #{gvUserIp}                                                 /* 최종수정IP          */
		         ,  LAST_UPDT_DT   = sysdate                                                     /* 최종수정일시         */
		         ,  LAST_UPDT_CLNT_PRGM_ID  = #{gvUserId}
		         ,  LAST_UPDT_SRVR_PRGM_ID  = #{gvUserId}
		where
		           PTNO = #{ptno}
		   and  ORDR_YMD = to_date( #{ordrYmd},'yyyymmdd')
		   and  ORDR_CD = #{ordrCd}
		   and  CODV_CD = #{codvCd}
		   and  DRAP_MDCF_CD = 'DG1'
		   and  ORDR_SNO = 0
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateEdctOrdrCmtxDltn (교육처방_병동협진의뢰 삭제) 
        Description :                                           교육처방_병동협진의뢰 삭제
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateEdctOrdrCmtxDltn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateEdctOrdrCmtxDltn */
		             MDCONSRCT
		      set
		             CMTX_STTS_CD = '9'                       /* 협진상태코드 */
		          ,  DLTN_YN = 'Y'                                /* 삭제여부 */
		          ,  CMTX_STTS_DT = sysdate                /* 협진상태일시 */
		          ,  CMTX_RPLY_CTN = empty_clob()        /* 협진회신내용 */
		          ,  CARE_CMTX_REFR_CNFM_ID = null     /* 간호협진의뢰확인자ID */
		          ,  CARE_CMTX_REFR_CNFR_IP = null      /* 간호협진의뢰확인IP */
		          ,  CARE_CMTX_REFR_CNFR_DT = null     /* 간호협진의뢰확인일시 */
		          ,  LAST_UPDR_ID = #{gvUserId}             /*  최종수정자ID */
		          ,  LAST_UPDT_IP = #{gvUserIp}              /*  최종수정IP */
		          ,  LAST_UPDT_DT = sysdate                 /*  최종수정일시 */
		          ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}  /*  최종수정클라이언트프로그램ID */
		          ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}  /*  최종수정서버프로그램ID */
		 where
		             PTNO      = #{ptno}
		     and  ORDR_YMD  = to_date(#{ordrYmd}, 'yyyymmdd')
		     and  ORDR_CD   = #{ordrCd}
		     and  nvl(DLTN_YN, 'N') = 'N' /* 삭제되지 않은 것만 삭제 */
		     and  IMPL_YMD  is null       /* 실시되지 않은 것만 삭제 */
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updatePthlExmnAdtnOrdr (진단병리 2차처방 처리) 
        Description :                                           진단병리 2차처방을 확인처리 한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updatePthlExmnAdtnOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updatePthlExmnAdtnOrdr */
				    SPAADDODT  /* 추가 오더 관리(선검사처방) */
		   set
				ODDR_ID   = #{oddrId}                                      /* 처방의사 */
			  ,  ORDR_YMD  = to_date(#{ordrYmd}, 'yyyymmdd')  /* 처방일자 */
			  ,  ORDR_SNO  = #{ordrSno}                                 /* 처방순번 */
			  ,  LAST_UPDR_ID = #{gvUserId}                             /* 최종수정자ID */
			  ,  LAST_UPDT_IP = #{gvUserIp}                             /* 최종수정IP */
			  ,  LAST_UPDT_DT = sysdate                                /*  최종수정일시 */
			  ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}   /*  최종수정클라이언트프로그램ID */
			  ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}   /*  최종수정서버프로그램ID */
		 where  1 = 1
		   and  PTHL_NO = #{pthlNo}                           /* 병리번호             */
		   and  PTEX_ADOR_SNO = #{ptexAdorSno}               /* 병리검사추가처방순번             */
		   and  ORDR_YMD  is null                         /* 처방일자             */
		   and  ODDR_ID   is null                         /* 처방의사             */
		   and  CCDR_ID   is null                         /* 취소한의사           */
		   and  nvl(DX_PTHL_PRSG_DVSN_CD, 'N') = 'N'      /* 선검사처리여부 Y=처리,N=미처리,C=취소 */
		   and  nvl(EXMN_DVSN_NM, 'PRE') = 'PRE'
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-deleteNtrtEdctCmtxDltn (미실시 된 영양 상담을 삭제) 
        Description :                                           미실시 된 영양 상담을 삭제한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<delete id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-deleteNtrtEdctCmtxDltn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		delete  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-deleteNtrtEdctCmtxDltn */
		  from  SUCONSLMT
		where  PTNO = #{ptno}
		   and  MDRP_NO = #{mdrpNo}
		   and  ORDR_YMD = to_date(#{ordrYmd} , 'YYYYMMDD')
		   and  ORDR_CD = #{ordrCd}
	</delete>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-insertPtntOrdrBsisInfm (환자처방기본 정보 저장) 
        Description :                                           환자처방기본 정보 유무 및 정규처방 완료 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-insertPtntOrdrBsisInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		insert  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-insertPtntOrdrBsisInfm */
		into MDPAORDBT
		(
		        PTNO
		       ,CODV_CD
		       ,MCDP_CD
		       ,ORDR_YMD
		       ,MDRP_NO
		       ,ANPT_VIST_YN
		       ,RGOR_FNDR_ID
		       ,RGOR_FINS_DT
		       ,RGOR_CNNU_ID
		       ,RGOR_CNFR_DT
		       ,ADTN_ODDR_ID
		       ,ADOR_DT
		       ,ADTN_ORCN_NURS_ID
		       ,ADTN_ORCN_DT
		       ,MDCR_LAST_ORDR_DT
		       ,ISTY_CD
		       ,ISTY_ASST_CD
		       ,CNPL_CD
		       ,ORDR_PNTM_CODV_CD
		       ,DR_PRTX_LAST_PRIN_DT
		       ,RCST_CD
		       ,RPNT_ID
		       ,RCPC_YMD
		       ,RCPC_DT
		       ,PTAD_LAST_RCPC_DT
		       ,CP_PRMR_SNO
		       ,CAHS_ANTC_TERM_ENRM_DT
		       ,ANTC_02C_CHOT_DT
		       ,ORCN_SPDR_ID
		       ,SPDR_ORCN_DT
		       ,SPOR_EXST_YN
		       ,FRST_RGSR_ID
		       ,FRST_RGST_IP
		       ,FRST_RGST_DT
		       ,FRST_RGST_CLNT_PRGM_ID
		       ,FRST_RGST_SRVR_PRGM_ID
		       ,LAST_UPDR_ID
		       ,LAST_UPDT_IP
		       ,LAST_UPDT_DT
		       ,LAST_UPDT_CLNT_PRGM_ID
		       ,LAST_UPDT_SRVR_PRGM_ID
		)
		values
		(
		         #{ptno}                                    /*  환자번호 */
		       , #{codvCd}                                  /*  내원구분코드 */
		       , #{mcdpCd}                                  /*  진료과코드 */
		       , to_date ( #{ordrYmd}, 'YYYYMMDD' )         /* 처방일자 */
		       , #{mdrpNo}                                  /*  진료접수번호 */
		       , 'Y'                                        /*  defualt 'Y' 항암환자방문여부 */
		       , #{rgorFndrId}                              /*  정규처방완료의사ID */
		       , to_date ( #{rgorFinsDt}, 'YYYYMMDDhh24miss' ) /*  정규처방완료일시 */
		       , #{rgorCnnuId}                              /*  정규처방확인간호사ID */
		       , to_date ( #{rgorCnfrDt}, 'YYYYMMDDhh24miss' ) /*  정규처방확인일시 */
		       , #{adtnOddrId}                              /*  추가처방의사ID */
		       , to_date (#{adorDt}, 'YYYYMMDDhh24miss' )   /*  추가처방일시 */
		       , #{adtnOrcnNursId}                          /*  추가처방확인간호사ID */
		       , to_date (#{adtnOrcnDt}, 'YYYYMMDDhh24miss' ) /*  추가처방확인일시 */
		       , to_date (#{mdcrLastOrdrDt}, 'YYYYMMDDhh24miss' ) /*  진료최종처방일시 */
		       , #{istyCd}                                  /* 보험유형코드 */
		       , #{istyAsstCd}                              /*  보험유형보조코드 */
		       , null                                       /*  계약처코드 */
		       , #{codvCd}                                  /*  처방시점내원구분코드 */
		       , null                                        /*  의사처방전최종출력일시 */
		       , null                                       /*  수납상태코드 */
		       , null                                       /*  수납자ID */
		       , null                                       /*  수납일자 */
		       , null                                       /*  수납일시 */
		       , null                                       /*  원무최종수납일시 */
		       , null                                       /*  CP1차일련번호 */
		       , null                                       /*  암병원항암치료실입실일시 */
		       , null                                       /*  항암02C퇴실일시 */
		       , null										/*  전문의감독확인ID */
		       , null										/*  전문의감독확인일시 */
		       , 'N'   					                    /*  스페셜처방존재여부 */
		       , #{gvUserId}                                /*  최초등록자ID */
		       , #{gvUserIp}                                /*  최초등록IP */
		       , sysdate                                    /*  최초등록일시 */
		       , #{gvClntPrgmId}                            /*  최초등록SMC클라이언트프로그램ID */
		       , #{gvSrvrPrgmId}                            /*  최초등록SMC서버프로그램ID */
		       , #{gvUserId}                                /*  최종수정자ID */
		       , #{gvUserIp}                                /*  최종수정IP */
		       , sysdate                                    /*  최종수정일시 */
		       , #{gvClntPrgmId}                            /*  최종수정SMC클라이언트프로그램ID */
		       , #{gvSrvrPrgmId}                            /*  최종수정SMC서버프로그램ID */
		)
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-insertDlysPtntOrdrBsis (투석환자 처방기본 저장) 
        Description :                                           처방내림시 처방발생원이 투석이 있는 경우 투석환자처방기본 정보를 저장한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-insertDlysPtntOrdrBsis"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		insert  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-insertDlysPtntOrdrBsis */
		into  MNHPBASET
		(
		       PTNO
		       ,ORDR_YMD
		       ,RGOR_FINS_YN
		       ,RGOR_FNDR_ID
		       ,RGOR_FINS_DT
		       ,RGOR_CNFR_YN
		       ,RGOR_CNNU_ID
		       ,RGOR_CNFR_DT
		       ,ADOR_YN
		       ,ADTN_ODDR_ID
		       ,ADOR_DT
		       ,ADTN_ORCN_YN
		       ,ADTN_ORCN_NURS_ID
		       ,ADTN_ORCN_DT
		       ,FRST_RGSR_ID
		       ,FRST_RGST_IP
		       ,FRST_RGST_DT
		       ,FRST_RGST_CLNT_PRGM_ID
		       ,FRST_RGST_SRVR_PRGM_ID
		       ,LAST_UPDR_ID
		       ,LAST_UPDT_IP
		       ,LAST_UPDT_DT
		       ,LAST_UPDT_CLNT_PRGM_ID
		       ,LAST_UPDT_SRVR_PRGM_ID
		)
		values
		(
		       #{ptno}
		       ,  to_date ( #{ordrYmd}, 'YYYYMMDD' )
		       ,  #{rgorFinsYn}
		       ,  #{rgorFndrId}
		       ,  to_date ( #{rgorFinsDt}, 'YYYYMMDDhh24miss' )
		       ,  #{rgorCnfrYn}
		       ,  #{rgorCnnuId}
		       ,  to_date ( #{rgorCnfrDt}, 'YYYYMMDDhh24miss' )
		       ,  #{adorYn}
		       ,  #{adtnOddrId}
		       ,  to_date ( #{adorDt}, 'YYYYMMDDhh24miss' )
		       ,  #{adtnOrcnYn}
		       ,  #{adtnOrcnNursId}
		       ,  to_date ( #{adtnOrcnDt}, 'YYYYMMDDhh24miss' )
		       , #{gvUserId}                          /*  최초등록자ID */
		       , #{gvUserIp}                          /*  최초등록IP */
		       , sysdate                              /*  최초등록일시 */
		       , #{gvClntPrgmId}                      /*  최초등록SMC클라이언트프로그램ID */
		       , #{gvSrvrPrgmId}                      /*  최초등록SMC서버프로그램ID */
		       , #{gvUserId}                          /*  최종수정자ID */
		       , #{gvUserIp}                          /*  최종수정IP */
		       , sysdate                              /*  최종수정일시 */
		       , #{gvClntPrgmId}                      /*  최종수정SMC클라이언트프로그램ID */
		       , #{gvSrvrPrgmId}                      /*  최종수정SMC서버프로그램ID */
		)
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-insertAcdgOrno (처방별 항암제차수 저장) 
        Description :                                           처방별 항암제차수 정보를 저장한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-insertAcdgOrno"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		insert  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-insertAcdgOrno */
		into  MDCHEMOCT
		(
		     ORDR_CLBY_ACDG_SNO                                                             /* 처방별항암제일련번호*/
		     ,  PTNO                                                                        /* 환자번호*/
		     ,  ORDR_YMD                                                                    /* 처방일자*/
		     ,  ORDR_SNO                                                                    /* 처방일련번호*/
		     ,  MDRP_NO                                                                     /* 진료접수번호*/
		     ,  CODV_CD                                                                     /* 내원구분코드*/
		     ,  MCDP_CD                                                                     /* 진료과코드*/
		     ,  ORDR_CD                                                                     /* 처방코드*/
		     ,  ODDR_ID                                                                     /* 처방의사ID*/
		     ,  DRAP_MDCF_CD                                                                /* 약적용수가분류코드*/
		     ,  ANTC_ORNO_RMRK_CTN                                                          /* 항암차수비고내용*/
		     ,  ANTC_MDTE_STRT_YMD                                                          /* 항암치료시작일자*/
		     ,  CNCL_DT                                                                     /* 취소일시*/
		     ,  ADMS_INPT_NOTC_LMTT_DDCN                                                    /* 입원입력노티제한일수*/
		     ,  CANC_PRGR_STEP_VL                                                           /* 암진행단계값*/
		     ,  ANTC_ORNO                                                                   /* 항암차수*/
		     ,  ANTC_THRP_MNGM_DVSN_CD                                                      /* 항암요법관리구분코드*/
		     ,  FRST_RGSR_ID                                                                /* 최초등록자ID*/
		     ,  FRST_RGST_IP                                                                /* 최초등록IP*/
		     ,  FRST_RGST_DT                                                                /* 최초등록일시*/
		     ,  FRST_RGST_CLNT_PRGM_ID                                                      /* 최초등록SMC클라이언트프로그램ID*/
		     ,  FRST_RGST_SRVR_PRGM_ID                                                      /* 최초등록SMC서버프로그램ID*/
		     ,  LAST_UPDR_ID                                                                /* 최종수정자ID*/
		     ,  LAST_UPDT_IP                                                                /* 최종수정IP*/
		     ,  LAST_UPDT_DT                                                                /* 최종수정일시*/
		     ,  LAST_UPDT_CLNT_PRGM_ID                                                      /* 최종수정SMC클라이언트프로그램ID*/
		     ,  LAST_UPDT_SRVR_PRGM_ID                                                      /* 최종수정SMC서버프로그램ID*/
		)
		values
		(
		      MDCHEMOCTQ.nextval                                                            /* 처방별항암제일련번호*/
		      , #{ptno}                                                                     /* 환자번호*/
		      ,  to_date ( #{ordrYmd} , 'YYYYMMDD' )                                        /* 처방일자*/
		      ,  #{ordrSno}                                                                 /* 처방일련번호*/
		      ,  #{mdrpNo}                                                                  /* 진료접수번호*/
		      ,  #{codvCd}                                                                  /* 내원구분코드*/
		      ,  #{mcdpCd}                                                                  /* 진료과코드*/
		      ,  #{ordrCd}                                                                  /* 처방코드*/
		      ,  #{oddrId}                                                                  /* 처방의사ID*/
		      ,  #{drapMdcfCd}                                                              /* 약적용수가분류코드*/
		      ,  #{antcOrnoRmrkCtn}                                                         /* 항암차수비고내용*/
		      ,  to_date ( #{antcMdteStrtYmd}, 'YYYYMMDD' )                                 /* 항암치료시작일자*/
		      ,  to_date ( #{cnclDt}, 'YYYYMMDDhh24miss' )                                  /* 취소일시*/
		      ,  #{admsInptNotcLmttDdcn}                                                    /* 입원입력노티제한일수*/
		      ,  #{cancPrgrStepVl}                                                          /* 암진행단계값*/
		      ,  #{antcOrno}                                                                /* 항암차수*/
		      ,  #{antcThrpMngmDvsnCd}                                                      /* 항암요법관리구분코드*/
		      ,  #{gvUserId}                                                                /* 최초등록자ID*/
		      ,  #{gvUserIp}                                                                /* 최초등록IP*/
		      ,  sysdate                                                                    /* 최초등록일시*/
		      ,  #{gvClntPrgmId}                                                            /* 최초등록클라이언트프로그램ID*/
		      ,  #{gvSrvrPrgmId}                                                            /* 최초등록서버프로그램ID*/
		      ,  #{gvUserId}                                                                /* 최종수정자ID*/
		      ,  #{gvUserIp}                                                                /* 최종수정IP*/
		      ,  sysdate                                                                    /* 최종수정일시*/
		      ,  #{gvClntPrgmId}                                                            /* 최종수정클라이언트프로그램ID*/
		      ,  #{gvSrvrPrgmId}                                                            /* 최종수정서버프로그램ID*/
		)
	</insert>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listSpczCareRefrOrdrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="dprtCd" column="DPRT_CD"/>
		<result property="cmtxDvsnCd" column="CMTX_DVSN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listSpczCareRefrOrdrList (전문 간호 의뢰 처방 목록) 
        Description :                                           전문 간호 컨설트가 필요한 처방 목록을 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listSpczCareRefrOrdrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listSpczCareRefrOrdrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listSpczCareRefrOrdrList-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listSpczCareRefrOrdrList */
		          distinct B.CNSL_ORDR_CD AS ORDR_CD        /*협진필요 처방코드 */ 
		        , C.CMTX_DPRT_CD AS DPRT_CD       /* 의뢰서 자동 발생 부서 */
		        , C.CMTX_DVSN_CD AS CMTX_DVSN_CD /* 협진구분 코드  */
		  from MNPSPEDMT a /* 전문간호목록 */
		     , MNPSEORDT b /* 전문간호처방코드*/
		     , MNPSECSTT c /* 전문간호의뢰 자동발생부서*/
		 where nvl(a.dltn_yn, 'N') = 'N'
		   and nvl(b.dltn_yn, 'N') = 'N'
		   and nvl(b.ATMT_CMTX_YN, 'N') = 'Y'
		   and b.SPCZ_CNSL_EDCT_CD = a.SPCZ_CNSL_EDCT_CD
		   and c.SPCZ_CNSL_EDCT_CD = b.SPCZ_CNSL_EDCT_CD
		   and c.CNSL_ORDR_CD = b.CNSL_ORDR_CD
		   and nvl(c.dltn_yn, 'N') = 'N'
		   and instr(c.CMTX_PADV_VL, #{codvCd}) <![CDATA[ > ]]> 0 
		 order by ORDR_CD ,CMTX_DVSN_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtptCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="ptptCd" column="PTPT_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtptCd (가야할 곳 검색) 
        Description :                                           가야할 곳 검색
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtptCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtptCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtptCd-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOnePtptCd */
		           decode ( CENT_APNT_PSBL_YN, 'Y',  (select CNST_VL from  COCONSTDT where CNST_GRP_ID = 'CCD_001' and  CNST_ID = 'DPRT_FIT') , PTPT_CD ) as PTPT_CD
		  from  MDORDRCMT
		where  ORDR_CD = #{ordrCd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneMaxSporBndlNo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="sporBndlNo" column="SPOR_BNDL_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneMaxSporBndlNo () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneMaxSporBndlNo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneMaxSporBndlNo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneMaxSporBndlNo-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-selectOneMaxSporBndlNo */
		select  nvl(max(SPOR_BNDL_NO), 0) + 1 as SPOR_BNDL_NO
		  from  (
		        select  SPOR_BNDL_NM
		             ,  nvl(SPOR_BNDL_NO, 0) as SPOR_BNDL_NO
		          from  MDBASORDT
		         where  PTNO = #{ptno}
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		         union  all
		        select  SPOR_BNDL_NM
		             ,  nvl(SPOR_BNDL_NO, 0) as SPOR_BNDL_NO
		          from  MDMEDORDT
		         where  PTNO = #{ptno}
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		         union  all
		        select  SPOR_BNDL_NM
		             ,  nvl(SPOR_BNDL_NO, 0) as SPOR_BNDL_NO
		          from  MDEXMORDT
		         where  PTNO = #{ptno}
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		         union  all
		        select  SPOR_BNDL_NM
		             ,  nvl(SPOR_BNDL_NO, 0) as SPOR_BNDL_NO
		          from  MDTRTORDT
		         where  PTNO = #{ptno}
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		         union  all
		        select  SPOR_BNDL_NM
		             ,  nvl(SPOR_BNDL_NO, 0) as SPOR_BNDL_NO
		          from  MDBLDORDT
		         where  PTNO = #{ptno}
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		         union  all
		        select  SPOR_BNDL_NM
		             ,  nvl(SPOR_BNDL_NO, 0) as SPOR_BNDL_NO
		          from  MDREHORDT
		         where  PTNO = #{ptno}
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		        )
		 where  SPOR_BNDL_NO <![CDATA[ <> ]]> 99
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateOrcnSpdrInfm () 
        Description :                                           입원환자의 지정의가 처방 입력/수정/DC 처리시 처방일 이전 입원기간 동안 수련감독 처리되지 않은 일자의 처방에
                                                                대해서 수련감독 처리한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateOrcnSpdrInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateOrcnSpdrInfm */
		update  MDPAORDBT
		   set  ORCN_SPDR_ID = #{oddrId}
		     ,  SPDR_ORCN_DT = to_date(#{ordrDt},'yyyymmddhh24miss') 
		     ,  LAST_UPDR_ID = #{gvUserId}                                                                  /*  최종수정자ID */
		     ,  LAST_UPDT_IP = #{gvUserIp}                                                                  /*  최종수정IP */
		     ,  LAST_UPDT_DT = to_date(#{ordrDt},'yyyymmddhh24miss')                                        /*  최종수정일시 */
		     ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                                    /*  최종수정SMC클라이언트프로그램ID */
		     ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                                    /*  최종수정SMC서버프로그램ID */
		 where  PTNO = #{ptno}
		   and  MDRP_NO = #{mdrpNo}
		   and  CODV_CD = 'I'
		   and  ORDR_YMD <![CDATA[ <= ]]> to_date(#{ordrYmd}, 'yyyymmdd')
		   and  ORCN_SPDR_ID is null
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateSporExstYn (스페셜처방존재여부수정) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateSporExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-updateSporExstYn */
		update  MDPAORDBT
		   set  SPOR_EXST_YN = (case when exists (select 1 
		                                            from MDORDDATV
		                                           where PTNO = #{ptno}
		                                             and  MDRP_NO = #{mdrpNo}
		                                             and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		                                             and  DC_DVSN_CD in ('N', 'Y', 'C')
		                                             and  ODKI_DETL_CD = 'Z'
		                                             and  SPOR_BNDL_NO  <![CDATA[ > ]]> 0)
		                             then 'Y'
		                             else 'N'
		                         end)
		     ,  LAST_UPDR_ID = #{gvUserId}                                                                  /*  최종수정자ID */
		     ,  LAST_UPDT_IP = #{gvUserIp}                                                                  /*  최종수정IP */
		     ,  LAST_UPDT_DT = to_date(#{ordrDt},'yyyymmddhh24miss')                                        /*  최종수정일시 */
		     ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                                    /*  최종수정SMC클라이언트프로그램ID */
		     ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                                    /*  최종수정SMC서버프로그램ID */
		 where  PTNO = #{ptno}
		   and  MDRP_NO = #{mdrpNo}
		   and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
	</update>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listPtntCmtxInfmInqr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO">
	
		<result property="cmtxRefrYmd" column="CMTX_REFR_YMD"/>
		<result property="cmtxRefrSno" column="CMTX_REFR_SNO"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="cmtxDvsnCd" column="CMTX_DVSN_CD"/>
		<result property="wntdDrMcdpCd" column="WNTD_DR_MCDP_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listPtntCmtxInfmInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listPtntCmtxInfmInqr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listPtntCmtxInfmInqr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listPtntCmtxInfmInqr-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveDAO-listPtntCmtxInfmInqr */
				        to_char(ORDR_YMD,'yyyymmdd') as CMTX_REFR_YMD
				     ,  ORDR_SNO as CMTX_REFR_SNO
				     ,  ORDR_CD
				     ,  CMTX_DVSN_CD
				     ,  WNTD_DR_MCDP_CD
				  from  MDCONSRCT
				where  PTNO = #{ptno}
				   and  LNKN_ORDR_YMD = to_date( #{ordrYmd}, 'yyyymmdd' )
				   and  LNKN_ORDR_SNO = #{ordrSno}
				   and  LNKN_ORDR_CLTY_CD = #{ordrCltyCd}
	</select>



</mapper>