<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_MdpPhrmDrugOrdrPrsgDAO_sql.xml 
    Description : -->
<mapper namespace="MdpPhrmDrugOrdrPrsgDAO">




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePrssCd1 (해당 환자의 당일 약처방 진행상태 수정) 
        Description :                                           해당 환자의 당일 약처방 진행상태를 수정한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePrssCd1"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePrssCd1 */
		update  /*+ mdd_sdmdmed_u12$U01_약처방 진행상태 수정2 */
				            MDMEDORDT a
				       set
				            a.DRUG_ORDR_PRSS_CD = '1'
				         ,  LAST_UPDR_ID = #{gvUserId}
				         ,  LAST_UPDT_IP = #{gvUserIp}
				         ,  LAST_UPDT_DT = sysdate
				         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
				         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
				     where  a.PTNO = #{ptno}
				       and  a.ORDR_YMD = to_date( #{ordrYmd}, 'YYYYMMDD')
				       and  a.MDTN_LCDV_CD = #{mdtnLcdvCd}
				       and  nvl(a.DC_DVSN_CD,'N') = 'X'
				       and  nvl(a.LAST_UPDT_DT, a.FRST_RGST_DT) <= to_date( #{frstCrtnDt}, 'YYYYMMDDHH24MISS')
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateRptnInfm (해당처방 약처방 진행상태 수정) 
        Description :                                           해당처방 약처방 진행상태를 수정한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateRptnInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateRptnInfm */
		update  /*+ mdd_sdmdmed_u11$U01_약처방 진행상태 수정1 */
				            MDMEDORDT a
				       set
				            a.MDTN_LCDV_CD = #{mdtnLcdvCd}
				         ,  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
				         ,  a.MDTN_NO = #{mdtnNo}
				         ,  a.DRUG_ORDR_PRSS_CD = case /* 처방이 변경되는 경우 조제정보에 잘 반영되지 않는 경우 처리 */
				                                       when a.PCKN_UNAD_QTY           = #{pcknUnadQty}
				                                        and a.ICUN_ADMN_VLM           = #{icunAdmnVlm}
				                                        and decode(a.NTM,0,1,a.NTM)   = #{ntm}
				                                        and decode(a.DDCN,0,1,a.DDCN) = #{ddcn}
				                                        and a.DRUS_CD                 = #{drusCd}
				                                        and a.IHOH_DVSN_CD            = #{ihohDvsnCd}
				                                       then '1'
				                                       else '0'
				                                  end
				         ,  a.PHDP_PRIN_YN =      case /* 처방이 변경되는 경우 조제정보에 잘 반영되지 않는 경우 처리 */
				                                       when a.PCKN_UNAD_QTY           = #{pcknUnadQty}
				                                        and a.ICUN_ADMN_VLM           = #{icunAdmnVlm}
				                                        and decode(a.NTM,0,1,a.NTM)   = #{ntm}
				                                        and decode(a.DDCN,0,1,a.DDCN) = #{ddcn}
				                                        and a.DRUS_CD                     = #{drusCd}
				                                        and a.IHOH_DVSN_CD            = #{ihohDvsnCd}
				                                       then #{phdpPrinYn}
				                                       else null
				                                  end
				         ,  a.STER_CMMD_IMPL_YN = #{sterCmmdImplYn}
				         ,  a.FRNS_DPRT_CD = case /* 변경된 불출장소를 정규처방에 한해서 update해준다. */
				                                 when ( #{mdtnNoDvsnCd} in ('A','D','P')) then #{injcPlacCd}
				                                 else a.FRNS_DPRT_CD
				                             end
				         ,  LAST_UPDR_ID = #{gvUserId}
				         ,  LAST_UPDT_IP = #{gvUserIp}
				         ,  LAST_UPDT_DT = sysdate
				         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
				         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
				     where  a.PTNO = #{ptno}
				       and  a.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
				       and  a.ORDR_SNO = #{ordrSno}
				       and  nvl(a.DC_DVSN_CD,'N') != 'X'
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateRtrnQty (반납량 수정) 
        Description :                                           DC확인 되었거나 조제이전반납구분코드가 "Y"이면 반납량을 수정한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateRtrnQty"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateRtrnQty */
		update  /*+ mdd_sdmdmed_u15$U01_반납량 수정 */
		            MDMEDORDT a
		       set
		            a.PACL_AFTR_DRRT_QTY = a.PCKN_UNAD_QTY * a.NTM * a.DDCN
		         ,  a.PHRM_RTRN_QTY = decode(a.SLCT_UNIT_DVSN_CD, '1', a.PCKN_UNAD_QTY * a.NTM * a.DDCN, '2', a.ICUN_ADMN_VLM * a.NTM * a.DDCN)
		         ,  a.FRNS_RTRN_CQY = decode(a.FRNS_CTRL_DVSN_CD, null, null, a.FRNS_VLM)
		        ,  a.rcpc_aft_dc_psbl_yn = case when codv_cd in ('O','E' ) and nvl(  RCST_CD  , 'N' ) in ( 'Y','W' ) then 'Y'
		                                                  else nvl( a.rcpc_aft_dc_psbl_yn , 'N' ) 
		                                            end
		        ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  a.PTNO = #{ptno}
		       and  a.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		      and  a.ORDR_SNO = #{ordrSno}
		       and  (
		                nvl(a.DC_DVSN_CD, 'N') = 'Y'
		             or
		                nvl(a.CMMD_BEFR_RTRN_DVSN_CD,'N') = 'Y'
		            )
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMdprIngr () 
        Description :                                           약제에서 약품 Master 성분 수정 후 동기화
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMdprIngr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMdprIngr */
		    update  /*+ mdd_ordrcmt_u02$U01_약품성분 매칭 수정 */
		               MDORDRCMT                            /* 처방 마스터 테이블   */
		       set
		            ANTB_RPRS_INGR_CD  = #{antbRprsIngrCd}            /* 성분코드               */
		         ,  FLUD_CD    = #{fludCd}             /* 수액코드               */
		         ,  FLUD_VLM     = #{fludVlm}               /* 수액 용량                */
		         ,  CLCL_MTHD_CD  = #{clclMthdCd}            /* 우선 처방 용법        */
		         /* 서버 프로그램 전환시 자동 추가된 항목 */
		         ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  ORDR_CD   = #{ordrCd}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntg (PN모니터링 수정) 
        Description :                                           mdd_sdtpnor_u06
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntg"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		<![CDATA[	
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntg */
		       update  /*+ mdd_sdtpnor_u06$U01_PN모니터링 수정 */
		           MDTPNORDT
		      set
		           PHRC_INPT_PTNT_BDWG_VL  = #{phrcInptPtntBdwgVl}
		        ,  PN_INUT_QTY    = #{pnInutQty}
		        ,  LPID_INUT_QTY  = #{lpidInutQty}
		        ,  FDNG_INUT_QTY  = #{fdngInutQty}
		        ,  INUT_UNSB_CTN  = #{inutUnsbCtn}
		        ,  ALL_INUT_QTY   = #{allInutQty}
		        ,  URIN_EMS_QTY   = #{urinEmsQty}
		        ,  ETC_EMS_QTY    = #{etcEmsQty}
		        ,  EMS_UNSB_CTN   = #{emsUnsbCtn}
		        ,  ALL_EMS_QTY    = #{allEmsQty}
		         /* 서버 프로그램 전환시 자동 추가된 항목 */
		        ,  LAST_UPDR_ID = LAST_UPDR_ID
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}        
		    where
		           PTNO = #{ptno}                                  /* 환자번호             */
		      and  ORDR_YMD  = to_date(#{ordrYmd}, 'YYYYMMDD')       /* 처방일자             */
		      and  ORDR_SNO = #{ordrSno}
		 ]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgUnsb (PN모니터링 특이사항 수정) 
        Description :                                           mdd_sdtpnor_u07
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgUnsb"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		<![CDATA[	
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgUnsb */
		        update  /*+ mdd_sdtpnor_u07$U01_PN모니터링 특이사항 수정 */
		            MDTPNORDT
		      set
		           TPN_ORDR_UNSL_CTN          = #{tpnOrdrUnslCtn}                  /* 특이사항             */
		       /* 서버 프로그램 전환시 자동 추가된 항목 */
		       ,  LAST_UPDR_ID = LAST_UPDR_ID
		       ,  LAST_UPDT_IP = #{gvUserIp}
		       ,  LAST_UPDT_DT = sysdate
		       ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		       ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}  
		    where
		           PTNO = #{ptno}                                    /* 환자번호             */
		      and  ORDR_YMD >= to_date(#{ordrYmd}, 'YYYYMMDD')
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgPnIndtVl (PN모니터링 PN적응증값 수정) 
        Description :                                           mdd_sdtpnor_u08
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgPnIndtVl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		<![CDATA[	
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgPnIndtVl */
		    update  /*+ mdd_sdtpnor_u08$U01_PN모니터링 PN적응증값 수정 */
		            MDTPNORDT
		      set
		           PN_INDT_VL    = #{pnIndtVl}         /* PN indication        */
		         /* 서버 프로그램 전환시 자동 추가된 항목 */
		         ,  LAST_UPDR_ID = LAST_UPDR_ID
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}  
		    where
		           PTNO = #{ptno}                                   /* 환자번호             */
		      and  ORDR_YMD >= to_date(#{ordrYmd}, 'YYYYMMDD')
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgCmmdDfntInfm (PN모니터링 조제확정정보 수정) 
        Description :                                           mdd_sdtpnor_u09
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgCmmdDfntInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgCmmdDfntInfm */
		    update  /*+ mdd_sdtpnor_u09$U01_PN모니터링 조제확정정보 수정 */
		           MDTPNORDT
		      set
		           CMMD_DFNT_PHRC_ID = #{cmmdDfntPhrcId},       /* 조제확정자(약사)     */
		           BAG_NTM           = #{bagNtm},                  /* BAG 회수             */
		           PHRC_CMNT_CTN     = #{phrcCmntCtn}            /* 약사 커멘트          */
		         /* 서버 프로그램 전환시 자동 추가된 항목 */
		         ,  LAST_UPDR_ID = LAST_UPDR_ID
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}  
		    where
		           PTNO = #{ptno}                                    /* 환자번호             */
		      and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')     /* 처방일자             */
		      and  ORDR_SNO = ORDR_SNO
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMdtnLcdvCd (약처방 위치 수정) 
        Description :                                           약처방 위치 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMdtnLcdvCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMdtnLcdvCd */
		update  /*+ mdd_sdmdmed_u20$U01_약처방 수정 */
		                MDMEDORDT a
		           set
		                a.MDTN_LCDV_CD = #{mdtnLcdvCd}
		             ,  a.LAST_UPDR_ID = #{gvUserId}
		             ,  a.LAST_UPDT_IP = #{gvUserIp}
		             ,  a.LAST_UPDT_DT = sysdate
		             ,  a.LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		             ,  a.LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where  a.PTNO = #{ptno}
		           and  a.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		           and  a.ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrCmmdDetl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrCmmdDetl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrCmmdDetl */
		 <![CDATA[   update  /*+ mdd_sdmdmed_u90$U01_처방조제상태 수정 */
		                MDMEDORDT
		           set  DRUG_ORDR_PRSS_CD = #{cmmdSttsCd1}
		          ,  PHDP_PRIN_YN          =  case when   #{cmmdSttsCd1} >  '1' then 'Y'
		                                                      else   PHDP_PRIN_YN  
		                                                end
		         ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where  ORDR_YMD  = to_date(#{ordrYmd}, 'YYYYMMDD')
		           and  PTNO      = #{ptno}
		           and  ORDR_SNO  = #{ordrSno}
		           and  DRUG_ORDR_PRSS_CD = #{cmmdSttsCd}
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrCmmdStts () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrCmmdStts"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrCmmdStts */
		<![CDATA[
		    update /*+ mdd_sdmdmed_u06$U01_처방조제상태 수정 */
				   MDMEDORDT
			   set 
		              DRUG_ORDR_PRSS_CD = #{cmmdSttsCd1}
		            ,  PHDP_PRIN_YN          =  case when   #{cmmdSttsCd1} > '1' then 'Y'
		                                                      else   PHDP_PRIN_YN  
		                                                end
		         , LAST_UPDR_ID = #{gvUserId}
		         , LAST_UPDT_IP = #{gvUserIp}
		         , LAST_UPDT_DT = sysdate
		         , LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         , LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where PTNO      = #{ptno} 
		       and ORDR_YMD  = to_date(#{ordrYmd}, 'yyyymmdd')		           
		       and ORDR_SNO  = #{ordrSno}
		]]>	
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrkPrmrCnsnOrdrSttsVl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrkPrmrCnsnOrdrSttsVl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrkPrmrCnsnOrdrSttsVl */
		    update  /*+ mdd_slhlars_u07$I01_약물동력학 1차자문등록 처방상태값 변경 */
		            MDEXMORDT                                 /* 검사처방 */
		       set  RPRT_DT      = decode(#{exorPrssCd}, 'I', sysdate, null)                          /* 진행상태 J 진행, Y 보고 */
		         ,  EXOR_PRSS_CD = decode(#{exorPrssCd}, 'I', 'I', null)
		         ,  PACL_YMD     = decode(#{exorPrssCd}, 'I', PACL_YMD, null)
		            /* 서버 프로그램 전환시 자동 추가된 항목 */
		         , LAST_UPDR_ID = #{gvUserId}
		         , LAST_UPDT_IP = #{gvUserIp}
		         , LAST_UPDT_DT = sysdate
		         , LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         , LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  PTNO     = #{ptno}
		       and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
		       and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrkLastRprtOrdrSttsVl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrkLastRprtOrdrSttsVl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrkLastRprtOrdrSttsVl */
		    update  /*+ mdd_slhlars_u08$I01_약물동역학 최종보고 처방상태값 변경 */
		            MDEXMORDT
		       set  EXOR_PRSS_CD = #{exorPrssCd}
		         ,  PACL_YMD     = decode(#{rsltUpdtYn}, 'Y', nvl(PACL_YMD, sysdate), sysdate)
		         ,  EXRM_RPTN_DT = sysdate
		         ,  ENFR_DT      = sysdate
		         ,  RPRT_DT      = sysdate
		         /* 서버 프로그램 전환시 자동 추가된 항목 */
		         , LAST_UPDR_ID = #{gvUserId}
		         , LAST_UPDT_IP = #{gvUserIp}
		         , LAST_UPDT_DT = sysdate
		         , LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         , LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where PTNO                  = #{ptno}
		       and ORDR_YMD              = to_date(#{ordrYmd},'YYYYMMDD')
		       and ORDR_SNO              = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateSbsnUpdtCmmdYn (원외처방변경이력 수정) 
        Description :                                           원외처방변경이력 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateSbsnUpdtCmmdYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateSbsnUpdtCmmdYn */
		 update  /*+ mdd_sdmdmed_u17$U01_원외처방변경이력 수정 */
		            MDMEDORDT m
		       set
		            m.SBSN_UPDT_CMMD_YN = #{sbsnUpdtCmmdYn},
		            m.LAST_UPDR_ID = #{gvUserId},
		            m.LAST_UPDT_IP = #{gvUserIp},
		            m.LAST_UPDT_DT = sysdate ,
		            m.LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId},
		            m.LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  m.ORDR_YMD         = to_date( #{ordrYmd}, 'yyyymmdd')
		       and  m.PTNO                  = #{ptno}
		       and  m.ORDR_SNO          = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrmRtrnQty (불출반납수량에 불출용량을 update) 
        Description :                                           불출반납수량에 불출용량을 update 한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrmRtrnQty"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrmRtrnQty */
		 update  /*+ mdd_sdmdmed_u01$U01_MDMEDORDT 수정1 */
		            MDMEDORDT m
		       set
		            m.PHRM_RTRN_QTY  =
		                               (
		                                select
		                                        decode(a.SLCT_UNIT_DVSN_CD, '2', b.PCUN_INLS_QTY, 1) * a.INVN_TOTL_QTY
		                                  from
		                                         SDPORDDET a
		                                     ,   SDDDGCDMT b
		                                 where  a.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		                                   and  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		                                   and  a.MDTN_NO = #{mdtnNo}
		                                   and  a.MDTN_LCDV_CD = decode( #{mdtnLcdvCd}, null, a.MDTN_LCDV_CD, 'A', a.MDTN_LCDV_CD, #{mdtnLcdvCd} )
		                                   and  a.ORDR_SNO = m.ORDR_SNO
		                                   and  b.MDPR_CD = a.MDPR_CD
		                               )
		         ,  m.PACL_AFTR_DRRT_QTY =
		                                   (
		                                    select
		                                            a.INVN_TOTL_QTY
		                                      from
		                                              SDPORDDET a
		                                     where  a.ORDR_YMD = to_date( #{ordrYmd}, 'YYYYMMDD')
		                                       and  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		                                       and  a.MDTN_NO = #{mdtnNo}
		                                       and  a.MDTN_LCDV_CD = decode( #{mdtnLcdvCd} , null, a.MDTN_LCDV_CD, 'A', a.MDTN_LCDV_CD, #{mdtnLcdvCd} )
		                                       and  a.ORDR_SNO = m.ORDR_SNO
		                                   )
		         ,  m.FRNS_RTRN_CQY =  decode(m.FRNS_CTRL_DVSN_CD, null, null, m.FRNS_VLM)
		         ,  m.RTRN_STTS_CD  =  decode(nvl(m.RCST_CD, 'N'),'N', 'R', 'Y')
		         ,  m.rcpc_aft_dc_psbl_yn = case when codv_cd in ('O','E' ) and nvl(  RCST_CD  , 'N' ) in ( 'Y','W' ) then 'Y'
		                                                    else nvl( m.rcpc_aft_dc_psbl_yn , 'N' ) 
		                                              end
		         ,  LAST_UPDR_ID         = #{gvUserId}
		         ,  LAST_UPDT_IP         = #{gvUserIp}
		         ,  LAST_UPDT_DT         = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID   = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID    = #{gvSrvrPrgmId}
		     where  (
		             m.PTNO,
		             m.ORDR_YMD,
		             m.ORDR_SNO
		             ) in (
		                   select
		                           a.PTNO
		                        ,  a.ORDR_YMD
		                        ,  b.ORDR_SNO
		                     from
		                            SDPORDBAT a
		                        ,   SDPORDDET b
		                    where  a.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		                      and  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		                      and  a.MDTN_NO = #{mdtnNo}
		                      and  a.MDTN_LCDV_CD = decode( #{mdtnLcdvCd}, null, a.MDTN_LCDV_CD, 'A', a.MDTN_LCDV_CD, #{mdtnLcdvCd} )
		                      and  b.ORDR_YMD = a.ORDR_YMD
		                      and  b.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		                      and  b.MDTN_NO = a.MDTN_NO
		                      and  b.MDTN_LCDV_CD = a.MDTN_LCDV_CD
		                      and  b.SDPF_EXRE_CD is null
		                   )
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDurvRtrnDdcn (UR반납일수를 입력받은 값으로 Update) 
        Description :                                           UR반납일수를 입력받은 값으로 Update
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDurvRtrnDdcn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDurvRtrnDdcn */
		 update  /*+ mdd_sdmdmed_u02$U01_MDMEDORDT 수정2 */
		                        MDMEDORDT m
		                   set
		                          m.DURV_RTRN_DDCN  =  m.DDCN
		                        ,  m.rcpc_aft_dc_psbl_yn = case when codv_cd in ('O','E' ) and nvl(  RCST_CD  , 'N' ) in ( 'Y','W' ) then 'Y'
		                                                                    else nvl( m.rcpc_aft_dc_psbl_yn , 'N' ) 
		                                                              end
		                        ,  LAST_UPDR_ID         = #{gvUserId}
		                        ,  LAST_UPDT_IP         = #{gvUserIp}
		                        ,  LAST_UPDT_DT         = sysdate
		                        ,  LAST_UPDT_CLNT_PRGM_ID    = #{gvClntPrgmId}
		                        ,  LAST_UPDT_SRVR_PRGM_ID    = #{gvSrvrPrgmId}
		                 where  (
		                         m.PTNO,
		                         m.ORDR_YMD,
		                         m.ORDR_SNO
		                         ) in (
		                               select
		                                       a.PTNO
		                                    ,  a.ORDR_YMD
		                                    ,  b.ORDR_SNO
		                                 from
		                                       SDPORDBAT a
		                                    ,  SDPORDDET b
		                                where  a.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		                                  and  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		                                  and  a.MDTN_NO = #{mdtnNo}
		                                  and  a.MDTN_LCDV_CD = decode( #{mdtnLcdvCd} , null, a.MDTN_LCDV_CD, 'A', a.MDTN_LCDV_CD, #{mdtnLcdvCd} )
		                                  and  b.ORDR_YMD = a.ORDR_YMD
		                                  and  b.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		                                  and  b.MDTN_NO = a.MDTN_NO
		                                  and  b.MDTN_LCDV_CD = a.MDTN_LCDV_CD
		                                  and  b.SDPF_EXRE_CD is null
		                               )
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateCnclPhrmRtrnQty (약반납정보 취소) 
        Description :                                           약반납정보 취소
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateCnclPhrmRtrnQty"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateCnclPhrmRtrnQty */
		 update  /*+ mdd_sdmdmed_u03$U01_MDMEDORDT 수정3 */
		                    MDMEDORDT
		               set
		                    PHRM_RTRN_QTY = null
		                 ,  PACL_AFTR_DRRT_QTY = null
		                 ,  FRNS_RTRN_CQY = null
		                 ,  RTRN_STTS_CD = null
		                 ,  rcpc_aft_dc_psbl_yn = case when codv_cd in ('O','E' ) and nvl(  RCST_CD  , 'N' ) in ( 'Y','W' ) then 'N'
		                                                         else nvl( rcpc_aft_dc_psbl_yn , 'N' ) 
		                                                   end
		                 ,  LAST_UPDR_ID         = #{gvUserId}
		                 ,  LAST_UPDT_IP         = #{gvUserIp}
		                 ,  LAST_UPDT_DT         = sysdate
		                 ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		                 ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		             where  (
		                     PTNO,
		                     ORDR_YMD,
		                     ORDR_SNO
		                     ) in (
		                           select
		                                   a.PTNO
		                                ,  a.ORDR_YMD
		                                ,  b.ORDR_SNO
		                             from
		                                    SDPORDBAT a
		                                ,   SDPORDDET b
		                            where  a.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		                              and  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		                              and  a.MDTN_NO = #{mdtnNo}
		                              and  a.MDTN_LCDV_CD = decode( #{mdtnLcdvCd} , null, a.MDTN_LCDV_CD, 'A', a.MDTN_LCDV_CD, #{mdtnLcdvCd} )
		                              and  b.ORDR_YMD = a.ORDR_YMD
		                              and  b.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		                              and  b.MDTN_NO = a.MDTN_NO
		                              and  b.MDTN_LCDV_CD = a.MDTN_LCDV_CD
		                              and  b.SDPF_EXRE_CD is null
		                           )
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateCnclDurvRtrnDdcn (dur 반납정보 취소) 
        Description :                                           dur 반납정보 취소
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateCnclDurvRtrnDdcn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateCnclDurvRtrnDdcn */
		 update  /*+ mdd_sdmdmed_u04$U01_MDMEDORDT 수정4 */
		                        MDMEDORDT m
		                   set
		                        m.DURV_RTRN_DDCN  =  ''
		                               ,  m.rcpc_aft_dc_psbl_yn = case when codv_cd in ('O','E' ) and nvl(  RCST_CD  , 'N' ) in ( 'Y','W' ) then 'N'
		                                                                            else nvl( m.rcpc_aft_dc_psbl_yn , 'N' ) 
		                                                                     end
		                                ,  LAST_UPDR_ID         = #{gvUserId}
		                                ,  LAST_UPDT_IP         = #{gvUserIp}
		                                ,  LAST_UPDT_DT         = sysdate
		                                ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		                                ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		                 where  (
		                         m.PTNO,
		                         m.ORDR_YMD,
		                         m.ORDR_SNO
		                         ) in (
		                               select
		                                       a.PTNO
		                                    ,  a.ORDR_YMD
		                                    ,  b.ORDR_SNO
		                                 from
		                                        SDPORDBAT a
		                                    ,   SDPORDDET b
		                                where  a.ORDR_YMD = to_date( #{ordrYmd}, 'YYYYMMDD')
		                                  and  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		                                  and  a.MDTN_NO = #{mdtnNo}
		                                  and  a.MDTN_LCDV_CD = decode( #{mdtnLcdvCd}, null, a.MDTN_LCDV_CD, 'A', a.MDTN_LCDV_CD, #{mdtnLcdvCd} )
		                                  and  b.ORDR_YMD = a.ORDR_YMD
		                                  and  b.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		                                  and  b.MDTN_NO = a.MDTN_NO
		                                  and  b.MDTN_LCDV_CD = a.MDTN_LCDV_CD
		                                  and  b.SDPF_EXRE_CD is null
		                               )
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateCnclPhdpPrinYn (약국 출력 취소) 
        Description :                                           약국 출력 취소
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateCnclPhdpPrinYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateCnclPhdpPrinYn */
		 update  /*+ mdd_sdmdmed_u05$U01_MDMEDORDT 수정5 */
		            MDMEDORDT
		       set
		            PHDP_PRIN_YN = null
		         ,  RCST_CD = 'N'
		         ,  VIA_ADMS_RCST_CD = 'N'
		         ,  LAST_UPDR_ID         = #{gvUserId}
		         ,  LAST_UPDT_IP         = #{gvUserIp}
		         ,  LAST_UPDT_DT         = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  (
		                    PTNO,
		                    ORDR_YMD,
		                    ORDR_SNO
		             ) in (
		                    select
		                           a.PTNO
		                        ,  a.ORDR_YMD
		                        ,  b.ORDR_SNO
		                      from
		                            SDPORDBAT a
		                        ,   SDPORDDET b
		                    where  a.ORDR_YMD = to_date( #{ordrYmd}, 'YYYYMMDD')
		                      and  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		                      and  a.MDTN_NO = #{mdtnNo}
		                      and  a.MDTN_LCDV_CD = decode( #{mdtnLcdvCd} , null, a.MDTN_LCDV_CD, 'A', a.MDTN_LCDV_CD, #{mdtnLcdvCd} )
		                      and  b.ORDR_YMD = a.ORDR_YMD
		                      and  b.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		                      and  b.MDTN_NO = a.MDTN_NO
		                      and  b.MDTN_LCDV_CD = a.MDTN_LCDV_CD
		                      and  b.SDPF_EXRE_CD is null
		                   )
		       and  nvl(RCST_CD, 'N') not in ('Y', 'R')
		       and  MDTN_LCDV_CD = decode( #{mdtnLcdvCd}, null, MDTN_LCDV_CD, 'A', MDTN_LCDV_CD, #{mdtnLcdvCd} )
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrMstrMdprDetl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrMstrMdprDetl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrMstrMdprDetl */
		    update  /*+ mdd_sdmdord_u01$U01_약품상세 처방마스터 update */  MDORDRCMT
		       set
		            MDPR_NM                      = #{mdprNm}
				 ,  ORDR_NM                      = #{mdprNm}
				 ,  UPRC_ORDR_NM                 = upper( #{ensnPdctNm} )
		         ,  MEGR_CD                      = #{megrCd}
		         ,  KORN_PDCT_NM                 = #{kornPdctNm}
		         ,  ENSN_PDCT_NM                 = #{ensnPdctNm}
		         ,  RSTC_CMPN_NM                 = #{rstcCmpnNm}
		         ,  DGFR_CD                      = #{dgfrCd}
		         ,  TOTL_QTY_CLCL_CD             = #{totlQtyClclCd}
		         ,  DVDN_DVSN_CD                 = #{dvdnDvsnCd}
		         ,  SDPF_EXRE_CD                 = #{sdpfExreCd}
		         ,  IHOH_DVSN_CD                 = #{ihohDvsnCd}
		         ,  ORDR_PSBL_DVSN_CD            = #{ordrPsblDvsnCd}
		         ,  TIMS1_TOTL_QTY_YN            = #{tims1TotlQtyYn}
		         ,  PRTN_DLFL_YN                 = #{prtnDlflYn}
		         ,  STST_DVSN_CD                 = decode(#{mdprClsfDetlCd}, '01','1','02','2','03','3','04','4','05','7',
		                                                                     '06','B','07','','08','','09','','10','5',
		                                                                     '11','9','12','F','13','6','14','C')
		         ,  KIT_MDPR_DDCN                = decode(#{afiKitMdprDdcnStr},null,null,to_number(#{afiKitMdprDdcnStr}))
		         ,  INGR_MNMM_CD                 = #{ingrMnmmCd}
		         ,  ANTB_YN                      = #{antbYn}
		         ,  ACGR_CD                      = #{acgrCd}
		         ,  INJT_MIX_CMMD_DVSN_CD        = #{injtMixCmmdDvsnCd}
		         ,  CNPL_CD                      = #{cnplCd}
		         ,  MDPR_CLSF_CD                 = decode(#{mdprClsfDetlCd},'07','8','08','7','09','6',
		                                                  decode(#{mdprClsfCd},'1','1','2','2','3','3','1' ))
		         ,  ANTB_RPRS_INGR_CD            = #{antbRprsIngrCd}
		         ,  SLIP_CD                      = decode(#{mdprClsfDetlCd}, '10', 'D11', '11', 'D12',
		                                                  decode(#{drapDvsnCd}, '1', 'D21', '2', 'D12', '3', 'D31', 'D91')) 
		         /*동일제형최소포함량*/
		         ,  SAME_DGFR_MNMM_INLS_QTY      = decode(#{afiIngrMnmmQtyStr},null,null,to_number(#{afiIngrMnmmQtyStr}))
		         /*동일제형최대포함량*/
		         ,  SAME_DGFR_MXMM_INLS_QTY      = decode(#{afiIngrMxmmQtyStr},null,null,to_number(#{afiIngrMxmmQtyStr}))
		         /*수액처방여부*/
		         ,  FLUD_ORDR_YN                 = #{totlQtyBaseInptYn}
				/* 추가 */
				 ,  INVN_PCUN_CD = #{invnPcunCd}					/* 재고포장단위코드 */
				 ,  PCUN_INLS_QTY = #{afiPcunInlsQtyStr}					/* 포장단위포함량 */
				 ,  ICUN_CD = #{icunCd}					/* 함량단위코드 */
				 ,  INGR_NM = #{ingrNm}					/* 성분명 */
				 ,  DRAP_DVSN_CD = #{drapDvsnCd}					/* 약적용구분코드 */
		         ,  PWDR_DSLW_YN = (select decode(#{pwdrDslwYn},'Y', DURV_PWDR_DSLW_YN, #{pwdrDslwYn})from SDDDGCDMT where mdpr_cd = #{mdprCd} and rownum=1)                    /* 산제불가여부 */
				 ,  CLNC_EXAM_DRUG_YN = case when#{dgmtRgstTypeCd} ='2' then 'Y' end	/*임상시험약여부 */
				 ,  CLCL_MTHD_CD = #{clclMthdCd}					/* 계산방법코드 */
		         ,  ORDR_CLTY_CD = decode(#{drapDvsnCd}, '1', 'B2', '2', 'B1', '3', 'B3', '9', 'B9')   /*  B1 (주사) , B2(내복약, B3(외용약), B9(기타)  */
		         ,  ORCL_CD      = decode(#{drapDvsnCd}, '2', 'IJ1', 'DG1')
		         ,  CIV_VLM      = #{civVlm}
		         ,  CIV_TRGT_YN  = #{civTrgtYn}
		         ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		    where  ORDR_CD = #{mdprCd}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmNxdyRply () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmNxdyRply"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmNxdyRply */
		    update   /*+ mdd_sdconsr_u01$I01_지참약관리 익일회신 */
		    MDCONSRCT
		    set
		       NXDY_RPLY_YN = #{nxdyRplyYn}                                         /* 익일회신여부             */
		    /* 서버 프로그램 전환시 자동 추가된 항목 */
		  	, LAST_UPDR_ID = #{gvUserId}
		  	, LAST_UPDT_IP = #{gvUserIp}
		  	, LAST_UPDT_DT = sysdate
		  	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		  	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		    where  PTNO = #{ptno}                                       /* 환자번호             */
		    and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')               /* 처방일자(의뢰일자)   */
		    and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmMeaDfntRply () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmMeaDfntRply"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmMeaDfntRply */
		         update /*+ mdd_sdconsr_u02$I01_지참약관리 미확정회신 */
		                MDCONSRCT                                 /* 협진기록             */
		           set
		                RPLY_DR_ID = #{rplyDrId}                    /* 회신의사             */
		             ,  RPLY_YMD = sysdate                    /* 회신일자             */
		             ,  RPLY_DR_MCDP_CD = #{rplyDrMcdpCd}                       /* 회신의사 진료과(회신부서) */
		             ,  CMTX_RPLY_CTN = #{rplyCtn}                         /* 회신내용             */
		             ,  TMPR_RSLT_CTN = #{tmprRsltCtn}
		             ,  TMPR_RSLT_LOG_CTN  = to_char(sysdate, 'YYYY/MM/DD HH24:MI')||'-'||(select  USER_NM
		                                                                                     from  CCUSRDPHT
		                                                                                    where  USER_ID  = #{gvUserId}
		                                                                                      and rownum = 1)
		             ,  IMPL_YMD = null                         /* 실시일자             */
		             ,  CMTX_STTS_CD = '1'                          /* 협진상태             */ /* 2007.10.17 이은정 책임 요청 사항 */
		             ,  CMTX_MDPR_RMRK_CTN = #{cmtxMdprRmrkCtn}                      /* 회신비고             */
		             ,  NXDY_RPLY_YN = null
		             ,  RPTN_DT = sysdate           /* 접수일시             */
		             , CLCL_EXCL_YN = 'Y'           /* 계산제외여부를 Y로 */
		             /* 서버 프로그램 전환시 자동 추가된 항목 */
		            	, LAST_UPDR_ID = #{gvUserId}
		            	, LAST_UPDT_IP = #{gvUserIp}
		            	, LAST_UPDT_DT = sysdate
		            	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		            	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where  PTNO = #{ptno}                         /* 환자번호             */
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD') /* 처방일자(의뢰일자)   */
		           and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRefrCncl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRefrCncl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRefrCncl */
		        update  /*+ mdd_sdconsr_u03$I01_지참약관리 의뢰취소 */
		                MDCONSRCT
		           set
		                CMTX_STTS_CD = '9'                                          /* 의뢰취소             */
		             ,  NXDY_RPLY_YN = null                                   /* 익일회신 */
		             ,  RPTN_DT = null                                        /* 접수일자 */
		             ,  CMTX_RPLY_CTN = #{rplyCtn}               /* 회신내용             */
		             ,  RPLY_YMD = sysdate                                    /* 회신일자             */
		             ,  RPLY_DR_ID = #{rplyDrId}           /* 회신의사             */
		             ,  RPLY_DR_MCDP_CD = #{rplyDrMcdpCd}       /* 회신의사 진료과(회신부서) */
		             ,  TMPR_RSLT_CTN = null                                        /* 회신내용임시         */
		             ,  TMPR_RSLT_LOG_CTN  = null                                        /* 회신임시정보         */
		             /* 서버 프로그램 전환시 자동 추가된 항목 */
		            	, LAST_UPDR_ID = #{gvUserId}
		            	, LAST_UPDT_IP = #{gvUserIp}
		            	, LAST_UPDT_DT = sysdate
		            	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		            	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		      where  PTNO = #{ptno}                           /* 환자번호             */
		        and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')   /* 처방일자(의뢰일자)   */
		        and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRefrCnclRest () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRefrCnclRest"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRefrCnclRest */
		update  /*+ mdd_sdconsr_u04$I01_지참약관리 의뢰취소복구 */
		                MDCONSRCT
		           set
		                CMTX_STTS_CD = '1'                                         /* 의뢰취소             */
		             ,  CMTX_RPLY_CTN = null                                        /* 회신내용             */
		             ,  RPLY_YMD = null                                       /* 회신일자             */
		             ,  RPLY_DR_ID = null                                         /* 회신의사             */
		             ,  RPLY_DR_MCDP_CD = null                                      /* 회신의사 진료과(회신부서) */
		             ,  TMPR_RSLT_CTN = null                                        /* 회신내용임시         */
		             ,  TMPR_RSLT_LOG_CTN  = null                                        /* 회신임시정보         */
		             /* 서버 프로그램 전환시 자동 추가된 항목 */
		            	, LAST_UPDR_ID = #{gvUserId}
		            	, LAST_UPDT_IP = #{gvUserIp}
		            	, LAST_UPDT_DT = sysdate
		            	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		            	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where  PTNO = #{ptno}                                        /* 환자번호             */
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')               /* 처방일자(의뢰일자)   */
		           and  ORDR_SNO = #{ordrSno}                                 /* 처방순번             */
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRptn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRptn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRptn */
		update      /*+ mdd_sdconsr_u05$I01_지참약관리 접수 */
		                MDCONSRCT
		           set
		                RPTN_DT = sysdate           /* 접수일시             */
		             ,  CMTX_STTS_CD = '2'          /*협진상태코드 접수일경우 2로 update 하는것으로 변경16.07.26 */
		             /* 서버 프로그램 전환시 자동 추가된 항목 */
		            	, LAST_UPDR_ID = #{gvUserId}
		            	, LAST_UPDT_IP = #{gvUserIp}
		            	, LAST_UPDT_DT = sysdate
		            	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		            	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where  PTNO = #{ptno}                           /* 환자번호             */
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')   /* 처방일자(의뢰일자)   */
		           and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRptnCncl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRptnCncl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRptnCncl */
		update  /*+ mdd_sdconsr_u06$I01_지참약관리 접수취소 */
		                MDCONSRCT
		           set
		                RPTN_DT = null                                        /* 접수일시             */
		             ,  NXDY_RPLY_YN = null                                   /* 익일회신 */
		             ,  CMTX_STTS_CD = '1'          /*협진상태코드 의뢰상태일 경우 1로 update 하는것으로 변경16.07.26 */
		                /* 서버 프로그램 전환시 자동 추가된 항목 */
		              , LAST_UPDR_ID = #{gvUserId}
		            	, LAST_UPDT_IP = #{gvUserIp}
		            	, LAST_UPDT_DT = sysdate
		            	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		            	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where  PTNO = #{ptno}                           /* 환자번호             */
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')   /* 처방일자(의뢰일자)   */
		           and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmDfntRply () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmDfntRply"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmDfntRply */
		update /*+ mdd_sdconsr_u07$I01_지참약관리 확정회신 */
		               MDCONSRCT                                 /* 협진기록             */
		          set
		               RPLY_YMD = sysdate                     /* 회신일자             */            
		            ,  RPLY_DR_ID = #{rplyDrId}                    /* 회신의사             */
		            ,  RPLY_DR_MCDP_CD = #{rplyDrMcdpCd}              /* 회신의사 진료과(회신부서) */
		            ,  CMTX_RPLY_CTN = #{rplyCtn}                  /* 회신내용             */
		            ,  TMPR_RSLT_CTN = null                         /* 회신내용임시         */
		            ,  TMPR_RSLT_LOG_CTN  = null                         /* 회신임시정보         */
		            ,  IMPL_YMD = sysdate                      /* 실시일자             */
		            ,  CMTX_STTS_CD = '4'                           /* 협진상태             */ /* 2007.10.17 이은정 책임 요청 사항 */
		            ,  CMTX_MDPR_RMRK_CTN = #{cmtxMdprRmrkCtn}                     /* 회신비고             */
		            ,  NXDY_RPLY_YN = null
		            ,  RPTN_DT  = sysdate
		            /* 서버 프로그램 전환시 자동 추가된 항목 */
		            	, LAST_UPDR_ID = #{gvUserId}
		            	, LAST_UPDT_IP = #{gvUserIp}
		            	, LAST_UPDT_DT = sysdate
		            	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		            	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where  PTNO = #{ptno}                           /* 환자번호             */
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')   /* 처방일자(의뢰일자)   */
		           and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRplyCncl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRplyCncl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateBrngDrugMngmRplyCncl */
		update   /*+ mdd_sdconsr_u08$I01_지참약관리 회신취소 */
		                MDCONSRCT
		           set
		                RPLY_DR_ID = null
		              , RPLY_YMD = null
		              , RPLY_DR_MCDP_CD = null
		              , CMTX_RPLY_CTN = null
		              , TMPR_RSLT_CTN = null
		              , TMPR_RSLT_LOG_CTN = null
		              , IMPL_YMD = null
		              , CMTX_STTS_CD = '2'              /*협진상태코드 접수일경우 2로 update 하는것으로 변경16.07.26 */
		              , CMTX_MDPR_RMRK_CTN = null
		            	, LAST_UPDR_ID = #{gvUserId}
		            	, LAST_UPDT_IP = #{gvUserIp}
		            	, LAST_UPDT_DT = sysdate
		            	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		            	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where  PTNO = #{ptno}                           /* 환자번호             */
		           and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')   /* 처방일자(의뢰일자)   */
		           and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMtfrMdtnInfmApfnYmdCrntDdUpdt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMtfrMdtnInfmApfnYmdCrntDdUpdt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMtfrMdtnInfmApfnYmdCrntDdUpdt */
		<![CDATA[	
		        update  /*+ mdd_sddrgcn_u03$U01_메포민 타원정보 적용종료 */
		                MDDRGCNPT x
		           set
		                x.APFN_DT = sysdate
		             /* 서버 프로그램 전환시 자동 추가된 항목 */
		             ,  LAST_UPDR_ID = #{gvUserId}
		             ,  LAST_UPDT_IP = #{gvUserIp}
		             ,  LAST_UPDT_DT = sysdate
		             ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		             ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where  (
		                   x.PTNO,
		                   x.DRUG_TKNG_DLMT_CD,
		                   x.RCRD_DT,
		                   x.DRUG_TKNG_RGST_DPRT_DVSN_CD,
		                   x.CNPT_RGST_PADV_CD
		                )
		                        =
		               (
		                select
		                        d.PTNO
		                     ,  '1'
		                     ,  e.FRST_RGST_DT
		                     ,  'D'
		                     ,  '05'
		                  from
		                        SDDATGRPT a
		                     ,  SDMDISCRT b
		                     ,  MDORDRCMT c
		                     ,  MDCONSRCT d
		                     ,  SDOCONSDT e
		                 where  a.MDEF_CLSF_1_CD = '68'
		                   and  a.MDEF_CLSF_2_CD = '20'
		                   and  a.MDEF_CLSF_3_CD = '04'
		                   and  a.MDEF_CLSF_5_CD <> '**********'
		                   and  b.RPMD_ID = a.MDEF_CLSF_5_CD
		                   and  c.ORDR_CD = b.MDPR_CD
		                   and  d.PTNO = #{ptno}
		                   and  d.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
		                   and  d.ORDR_SNO = to_number(#{ordrSno})
		                   and  d.CMTX_DVSN_CD = '7'
		                   and  d.CMTX_STTS_CD = '1'
		                   and  e.PTNO = d.PTNO
		                   and  e.ORDR_YMD = d.ORDR_YMD
		                   and  e.ORDR_SNO = d.ORDR_SNO
		                   and  nvl(e.SBSN_MDPR_CD, e.MDPR_CD) = c.ORDR_CD
		                   and  rownum < 2
		                 )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateAntgMdtnInfmApfnYmdCrntDdUpdt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateAntgMdtnInfmApfnYmdCrntDdUpdt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateAntgMdtnInfmApfnYmdCrntDdUpdt */
		<![CDATA[	   
		        update  /*+ mdd_sddrgcn_u04$U01_항응고제 타원정보 적용종료 */
		                MDDRGCNPT x
		           set
		                x.APFN_DT = sysdate
		             /* 서버 프로그램 전환시 자동 추가된 항목 */
		             ,  LAST_UPDR_ID = #{gvUserId}
		             ,  LAST_UPDT_IP = #{gvUserIp}
		             ,  LAST_UPDT_DT = sysdate
		             ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		             ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where  (
		                        x.PTNO,
		                        x.DRUG_TKNG_DLMT_CD,
		                        x.RCRD_DT,
		                        x.DRUG_TKNG_RGST_DPRT_DVSN_CD,
		                        x.CNPT_RGST_PADV_CD
		                        )
		                        =
		             (
		                select
		                        d.PTNO
		                     ,  '2'
		                     ,  e.FRST_RGST_DT
		                     ,  'D'
		                     ,  '05'
		                  from
		                        SDDATGRPT a
		                     ,  SDMDISCRT b
		                     ,  MDORDRCMT c
		                     ,  MDCONSRCT d
		                     ,  SDOCONSDT e
		                 where  a.MDEF_CLSF_1_CD = '20'
		                   and  a.MDEF_CLSF_2_CD = '12'
		                   and  a.MDEF_CLSF_5_CD <> '**********'
		                   and  b.RPMD_ID = a.MDEF_CLSF_5_CD
		                   and  c.ORDR_CD = b.MDPR_CD
		                   and  d.PTNO = #{ptno}
		                   and  d.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
		                   and  d.ORDR_SNO = #{ordrSno}
		                   and  d.CMTX_DVSN_CD = '7'
		                   and  d.CMTX_STTS_CD = '1'
		                   and  e.PTNO = d.PTNO
		                   and  e.ORDR_YMD = d.ORDR_YMD
		                   and  e.ORDR_SNO = d.ORDR_SNO
		                   and  nvl(e.SBSN_MDPR_CD, e.MDPR_CD) = c.ORDR_CD
		                   and  rownum < 2
		             )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertMtfrMdtnInfmApfn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertMtfrMdtnInfmApfn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertMtfrMdtnInfmApfn */
		<![CDATA[	
		        insert  /*+ mdd_sddrgcn_i02$I01_메포민 타원정보 적용종료 */
		                into  MDDRGCNPT
		             (
		                    PTNO
		                 ,  DRUG_TKNG_DLMT_CD
		                 ,  RCRD_DT
		                 ,  DRUG_TKNG_RGST_DPRT_DVSN_CD
		                 ,  DRUG_TKNG_YN
		                 ,  CNPT_RGST_PADV_CD
		                 ,  RGST_PLAC_CMNT_CTN
		                 ,  CNPT_CMNT_CTN
		                /* 서버 프로그램 전환시 자동 추가된 항목 */
		              	 ,  FRST_RGSR_ID
		              	 ,  FRST_RGST_IP
		              	 ,  FRST_RGST_DT
		              	 ,  FRST_RGST_CLNT_PRGM_ID
		              	 ,  FRST_RGST_SRVR_PRGM_ID
		              	 ,  LAST_UPDR_ID
		              	 ,  LAST_UPDT_IP
		              	 ,  LAST_UPDT_DT
		              	 ,  LAST_UPDT_CLNT_PRGM_ID
		              	 ,  LAST_UPDT_SRVR_PRGM_ID
		             )
		            select
		                    e.PTNO
		                 ,  '1'
		                 ,  e.FRST_RGST_DT
		                 ,  'D'
		                 ,  'Y'
		                 ,  '05'
		                 ,  substr(c.MDPR_NM, 1, 50)
		                 ,  substr(c.MDPR_NM, 1, 100)
		                 ,  e.FRST_RGSR_ID
		                 ,  e.FRST_RGST_IP
		                 ,  e.FRST_RGST_DT
		                 ,  e.FRST_RGST_CLNT_PRGM_ID
		                 ,  e.FRST_RGST_SRVR_PRGM_ID
		                 ,  e.LAST_UPDR_ID
		                 ,  e.LAST_UPDT_IP
		                 ,  e.LAST_UPDT_DT
		                 ,  e.LAST_UPDT_CLNT_PRGM_ID
		                 ,  e.LAST_UPDT_SRVR_PRGM_ID
		              from
		                    SDDATGRPT a
		                 ,  SDMDISCRT b
		                 ,  MDORDRCMT c
		                 ,  MDCONSRCT d
		                 ,  SDOCONSDT e
		             where  a.MDEF_CLSF_1_CD = '68'
		               and  a.MDEF_CLSF_2_CD = '20'
		               and  a.MDEF_CLSF_3_CD = '04'
		               and  a.MDEF_CLSF_5_CD <> '**********'
		               and  b.RPMD_ID = a.MDEF_CLSF_5_CD
		               and  c.ORDR_CD = b.MDPR_CD
		               and  d.PTNO = #{ptno}
		               and  d.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
		               and  d.ORDR_SNO = #{ordrSno}
		               and  d.CMTX_DVSN_CD = '7'
		               and  d.CMTX_STTS_CD = '4'
		               and  e.PTNO = d.PTNO
		               and  e.ORDR_YMD = d.ORDR_YMD
		               and  e.ORDR_SNO = d.ORDR_SNO
		               and  nvl(e.SBSN_MDPR_CD, e.MDPR_CD) = c.ORDR_CD              
		]]>
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertAntgMdtnInfmAplyFnsh () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertAntgMdtnInfmAplyFnsh"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertAntgMdtnInfmAplyFnsh */
		<![CDATA[	
		        insert  /*+ mdd_sddrgcn_i03$I01_항응고제 타원정보 적용종료 */
		          into  MDDRGCNPT
		             (
		                    PTNO
		                 ,  DRUG_TKNG_DLMT_CD
		                 ,  RCRD_DT
		                 ,  DRUG_TKNG_RGST_DPRT_DVSN_CD
		                 ,  DRUG_TKNG_YN
		                 ,  CNPT_RGST_PADV_CD
		                 ,  RGST_PLAC_CMNT_CTN
		                 ,  CNPT_CMNT_CTN
		                 /* 서버 프로그램 전환시 자동 추가된 항목 */
		              	 ,  FRST_RGSR_ID
		              	 ,  FRST_RGST_IP
		              	 ,  FRST_RGST_DT
		              	 ,  FRST_RGST_CLNT_PRGM_ID
		              	 ,  FRST_RGST_SRVR_PRGM_ID
		              	 ,  LAST_UPDR_ID
		              	 ,  LAST_UPDT_IP
		              	 ,  LAST_UPDT_DT
		              	 ,  LAST_UPDT_CLNT_PRGM_ID
		              	 ,  LAST_UPDT_SRVR_PRGM_ID
		             )
		        select
		                e.PTNO
		             ,  '2'
		             ,  e.FRST_RGST_DT
		             ,  'D'
		             ,  'Y'
		             ,  '05'
		             ,  substr(c.MDPR_NM, 1, 50)
		             ,  substr(c.MDPR_NM, 1, 100)
		             ,  e.FRST_RGSR_ID
		             ,  e.FRST_RGST_IP
		             ,  e.FRST_RGST_DT
		             ,  e.FRST_RGST_CLNT_PRGM_ID
		             ,  e.FRST_RGST_SRVR_PRGM_ID
		             ,  e.LAST_UPDR_ID
		             ,  e.LAST_UPDT_IP
		             ,  e.LAST_UPDT_DT
		             ,  e.LAST_UPDT_CLNT_PRGM_ID
		             ,  e.LAST_UPDT_SRVR_PRGM_ID
		          from
		                SDDATGRPT a
		             ,  SDMDISCRT b
		             ,  MDORDRCMT c
		             ,  MDCONSRCT d
		             ,  SDOCONSDT e
		         where  a.MDEF_CLSF_1_CD = '20'
		           and  a.MDEF_CLSF_2_CD = '12'
		           and  a.MDEF_CLSF_5_CD <> '**********'
		           and  b.RPMD_ID = a.MDEF_CLSF_5_CD
		           and  c.ORDR_CD = b.MDPR_CD
		           and  d.PTNO = #{ptno}
		           and  d.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
		           and  d.ORDR_SNO = #{ordrSno}
		           and  d.CMTX_DVSN_CD = '7'
		           and  d.CMTX_STTS_CD = '4'
		           and  e.PTNO = d.PTNO
		           and  e.ORDR_YMD = d.ORDR_YMD
		           and  e.ORDR_SNO = d.ORDR_SNO
		           and  nvl(e.SBSN_MDPR_CD, e.MDPR_CD) = c.ORDR_CD
		           and  rownum < 2
		]]>
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMdtnInfErrm (해당처방 약처방 진행상태 수정) 
        Description :                                           해당처방 약처방 진행상태를 수정한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMdtnInfErrm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateMdtnInfErrm */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u13$U01_약처방 진행상태 수정3 */
		            MDMEDORDT a
		       set
		            a.MDTN_LCDV_CD = #{mdtnLcdvCd}
		         ,  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		         ,  a.MDTN_NO = #{mdtnNo}
		         ,  a.DRUG_ORDR_PRSS_CD =    case    /* 처방이 변경되는 경우 조제정보에 잘 반영되지 않는 경우 처리 */
		                                    when a.PCKN_UNAD_QTY = #{pcknUnadQty}
		                                     and a.ICUN_ADMN_VLM = #{icunAdmnVlm}
		                                     and a.NTM        = #{ntm}
		                                     and a.DDCN      = #{ddcn}
		                                     and a.DRUS_CD = #{drusCd}
		                                     and a.IHOH_DVSN_CD = #{ihohDvsnCd}
		                                    then '1'
		                                    else '0'
		                                end
		         ,  a.PHDP_PRIN_YN =     case    /* 처방이 변경되는 경우 조제정보에 잘 반영되지 않는 경우 처리 */
		                                    when a.PCKN_UNAD_QTY = #{pcknUnadQty}
		                                     and a.ICUN_ADMN_VLM = #{icunAdmnVlm}
		                                     and a.NTM = #{ntm}
		                                     and a.DDCN = #{ddcn}
		                                     and a.DRUS_CD = #{drusCd}
		                                     and a.IHOH_DVSN_CD = #{ihohDvsnCd}
		                                    then #{phdpPrinYn}
		                                    else null
		                                end
		         ,  a.STER_CMMD_IMPL_YN = #{sterCmmdImplYn}
		         ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  a.PTNO = #{ptno}
		       and  a.ORDR_YMD = to_date( #{ordrYmd}, 'YYYYMMDD')
		       and  a.ORDR_SNO = #{ordrSno}
		       and  (
		                    (nvl(a.ODKI_CD,' ') = 'D' and a.DC_DVSN_CD not in ('Y', 'X'))
		                or  (nvl(a.ODKI_CD,' ') != 'D' and a.DC_DVSN_CD not in ('X'))
		            )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCdErrm (해당 환자의 당일 약처방 진행상태 수정) 
        Description :                                           해당 환자의 당일 약처방 진행상태를 수정한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCdErrm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCdErrm */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u14$U01_약처방 진행상태 수정4 */
		             MDMEDORDT a
		       set
		            a.DRUG_ORDR_PRSS_CD = '1'
		         ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  a.PTNO = #{ptno}
		       and  a.ORDR_YMD = to_date( #{ordrYmd}, 'YYYYMMDD')
		       and  a.MDTN_LCDV_CD = #{mdtnLcdvCd}
		       and  a.CODV_CD = 'E'
		       and  (
		                    (nvl(a.ODKI_CD,' ') = 'D' and a.DC_DVSN_CD in ('Y', 'X'))
		                or  (nvl(a.ODKI_CD,' ') != 'D' and a.DC_DVSN_CD in ('X'))
		            )
		       and  nvl(a.LAST_UPDT_DT, a.FRST_RGST_DT) <= to_date( #{frstCrtnDt}, 'YYYYMMDDHH24MISS')
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrLablPrinYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrLablPrinYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrLablPrinYn */
		<![CDATA[
		    update  /*+ mdd_sdtpnor_u05$U01_TPN처방 라벨출력여부 저장 */
		           MDTPNORDT
		       set
		          LABL_PRIN_YN = decode(#{lablPrinYn}, 'Y', nvl(LABL_PRIN_YN, #{lablPrinYn} ), #{lablPrinYn})
		       ,  LAST_UPDR_ID = #{gvUserId}
		       ,  LAST_UPDT_IP = #{gvUserIp}
		       ,  LAST_UPDT_DT = sysdate
		       ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		       ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  PTNO       = #{ptno}                                           /* 환자번호 */
		       and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')     /* 처방일자 */
		       and  ORDR_SNO = #{ordrSno}                                      /* 처방순번 */
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd (약처방진행상태) 
        Description :                                           약처방진행상태
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u24$I01_약처방진행상태 UDPATE */
		            MDMEDORDT
		       set
		            DRUG_ORDR_PRSS_CD =  nvl(#{drugOrdrPrssCd}, DRUG_ORDR_PRSS_CD)
		          ,  PHDP_PRIN_YN     =  nvl(#{phdpPrinYn}, PHDP_PRIN_YN)
		         /* 서버 프로그램 전환시 자동 추가된 항목 */
		         ,  LAST_UPDR_ID      = #{gvUserId}
		         ,  LAST_UPDT_IP      = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  ORDR_YMD  = to_date( #{ordrYmd} , 'YYYYMMDD')
		       and  (PTNO, ORDR_SNO) in (
		                                     select
		                                             a.PTNO
		                                          ,  b.ORDR_SNO
		                                       from
		                                             SDPORDBAT a
		                                          ,  SDPORDDET b
		                                      where  a.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD') /* 처방일자             */
		                                        and  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}            /* 처방형태구분         */
		                                        and  a.MDTN_NO = #{mdtnNo}                                      /* 투약번호             */
		                                        and  a.MDTN_LCDV_CD = decode( #{mdtnLcdvCd} , null, a.MDTN_LCDV_CD
		                                                                                                     , 'A', a.MDTN_LCDV_CD, #{mdtnLcdvCd} ) /* 투약위치 */
		                                        and  b.ORDR_YMD = a.ORDR_YMD
		                                        and  b.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		                                        and  b.MDTN_NO = a.MDTN_NO
		                                        and  b.MDTN_LCDV_CD = a.MDTN_LCDV_CD
		                                        and  (
		                                                 (
		                                                        #{bsisCmmdPlacCd} in ('T','U','V')
				                                                               and  b.BSIS_CMMD_PLAC_CD in ('T' , 'U' , 'V' )
				                                                               and (
				                                                                   b.MDTN_NO_DVSN_CD in ('B', 'E', 'F', 'I', 'S', 'T', 'O', 'Z')
				                                                                                and  nvl(b.WARD_LABL_PRIN_YN, 'N') = 'N'
				                                                         )		                                                         
				                                                 )
		                                                 )
		                                )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd2 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd2"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd2 */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u21$I01_약처방 진행상태 update */
		            MDMEDORDT
		       set
		            DRUG_ORDR_PRSS_CD = decode(sign(nvl(DRUG_ORDR_PRSS_CD, 0) - 2), -1, '2', DRUG_ORDR_PRSS_CD)
		         ,  PHDP_PRIN_YN          =  case when   decode(sign(nvl(DRUG_ORDR_PRSS_CD, 0) - 2), -1, '2', DRUG_ORDR_PRSS_CD) > '1' then 'Y'
		                                                      else   PHDP_PRIN_YN  
		                                                end
		         ,  LAST_UPDR_ID      = #{gvUserId}
		         ,  LAST_UPDT_IP      = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where
		            ORDR_YMD = to_date( #{ordrYmd} ,'YYYYMMDD') /* 처방일자 */
		       and  (PTNO,ORDR_SNO) in (select
		                                        a.PTNO,
		                                        b.ORDR_SNO
		                                   from
		                                          SDPORDBAT a,
		                                         SDPORDDET b
		                                  where
		                                           a.ORDR_YMD = to_date( #{ordrYmd} ,'YYYYMMDD')
		                                    and a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		                                    and a.MDTN_NO = to_number( #{mdtnNo} )
		                                    and a.MDTN_LCDV_CD = decode( #{mdtnLcdvCd} , null, a.MDTN_LCDV_CD
		                                                                                                , 'A', a.MDTN_LCDV_CD, #{mdtnLcdvCd} ) /* 투약위치 */
		                                    and b.ORDR_YMD = a.ORDR_YMD
		                                    and b.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		                                    and b.MDTN_NO = a.MDTN_NO
		                                    and b.MDTN_LCDV_CD = a.MDTN_LCDV_CD
		                                    and b.ORDR_SNO = #{ordrSno}
		                              )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd3 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd3"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd3 */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u22$I01_약처방 진행상태 update */
		             MDMEDORDT
		       set
		            DRUG_ORDR_PRSS_CD = decode( sign(nvl(DRUG_ORDR_PRSS_CD, 0) - 2), -1, '2', DRUG_ORDR_PRSS_CD)
		         ,  PHDP_PRIN_YN          =  case when   decode( sign(nvl(DRUG_ORDR_PRSS_CD, 0) - 2), -1, '2', DRUG_ORDR_PRSS_CD) > '1' then 'Y'
		                                                      else   PHDP_PRIN_YN  
		                                                end
		         ,  LAST_UPDR_ID      = #{gvUserId}
		         ,  LAST_UPDT_IP      = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where
		            ORDR_YMD  = to_date( #{ordrYmd} , 'YYYYMMDD')
		       and  (PTNO,ORDR_SNO) in (select
		                                         a.PTNO,
		                                         b.ORDR_SNO
		                                    from
		                                           SDPORDBAT a,
		                                           SDPORDDET b,
		                                           SDDDGCDMT c
		                                   where
		                                            b.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD') /* 처방일자             */
		                                     and  b.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}                    /* 처방형태구분         */
		                                     and  b.MDTN_NO = #{mdtnNo}                          /* 투약번호             */
		                                     and  b.MDTN_LCDV_CD = decode( #{mdtnLcdvCd} , null, b.MDTN_LCDV_CD
		                                                                                                , 'A', b.MDTN_LCDV_CD, #{mdtnLcdvCd} ) /* 투약위치 */
		                                     and  b.INJC_PLAC_CD = nvl( #{injcPlacCd} ,b.INJC_PLAC_CD)       /* 주사장소             */
		                                     and  ((b.BSIS_CMMD_PLAC_CD = '7') or (b.BSIS_CMMD_PLAC_CD = 'A' and c.DRAP_DVSN_CD ='2'))  /* 병동주사             */
		                                     and  /* 특정부서 당일,익일 & 당일수납 건만 진도변경 */
		                                         (
		                                             (   /* 6개 부서 한정 + 영상간호 추가  '012','021','C02A','C02B','C02D','M01C','RN','CRN1'*/
		                                                 /* (b.INJC_PLAC_CD in ('201243','201233','201289','201290','201291','201250','173810','201259')) */
		                                                 (b.INJC_PLAC_CD in (select t.PHRM_DTLS_CTRL_CD from  SDMCTRLMT t where t.PHRM_CTRL_CD = 'SD320'))
		                                                 and
		                                                 (
		                                                     ( /* 당일수납 + 당일,익일 실시예정 */
		                                                          (b.PHRM_IMPL_YMD between trunc(sysdate) and trunc(sysdate) + 1)
		                                                          and
		                                                          (b.RCPC_DT between trunc(sysdate) and trunc(sysdate) + 1)
		                                                      )
		                                                      or
		                                                      ( /* 간호에서 실시예정 바꾼경우(이전수납,당일실시예정) */
		                                                          (b.PHRM_IMPL_YMD = trunc(sysdate))
		                                                          and
		                                                          (b.RCPC_DT < trunc(sysdate))
		                                                      )
		                                                      or
		                                                      ( /* 실시예정일 지나서 수납한건 */
		                                                          (b.PHRM_IMPL_YMD < trunc(sysdate))
		                                                          and
		                                                          (b.RCPC_DT between trunc(sysdate) - 1 and trunc(sysdate) + 1)
		                                                      )
		                                                 )
		                                             )
		                                             or
		                                             (   /* 6개 부서 한정 + 영상간호 추가 */
		                                                 /* (b.INJC_PLAC_CD not in ('201243','201233','201289','201290','201291','201250','173810','201259')) */
		                                                 (b.INJC_PLAC_CD not in (select t.PHRM_DTLS_CTRL_CD from SDMCTRLMT t where t.PHRM_CTRL_CD = 'SD320'))
		                                             )
		                                         )
		                                    /* refact  and
		                                          (
		                                             (
		                                                  (a.OROC_CD not in ('n','N') ) * 혈액투석실 자가주사 추가 2012.2.14 LHJ *
		                                                 and
		                                                 (b.MDTN_NO_DVSN_CD in ('O','Z') and a.INJC_PRIN_YN in ('P','M')
		                                                                                 and nvl(b.WARD_LABL_PRIN_YN,'N') = 'N'
		                                                                                 and nvl(b.RCPC_YN, 'N') in ('Y', 'W'))
		                                             )
		                                             or
		                                             (
		                                                 (a.OROC_CD = 'n')
		                                                 and
		                                                 (b.MDTN_NO_DVSN_CD in ('O','Z'))
		                                                 and
		                                                 (
		                                                     (b.INJC_PLAC_CD in ('200661','200665','200666') and a.INJC_PRIN_YN in ('P','M')    * 'PHH','PHN','CPHN' *
		                                                                                                     and nvl(b.WARD_LABL_PRIN_YN,'N') = 'N'
		                                                                                                     and nvl(b.RCPC_YN, 'N') in ('Y', 'W'))
		                                                     or
		                                                     (b.INJC_PLAC_CD not in ('200661','200665','200666') and a.INJC_PRIN_YN in ('P','M') and nvl(b.WARD_LABL_PRIN_YN,'N') = 'N')
		                                                 )
		                                             )
		                                             or * 혈액투석실 자가주사 추가 2012.2.14 LHJ *
		                                             (
		                                                 (a.OROC_CD = 'N')
		                                                 and
		                                                 (b.MDTN_NO_DVSN_CD in ('O','Z'))
		                                                 and
		                                                 (b.INJC_PLAC_CD in ('200661','200665','200666') and a.INJC_PRIN_YN in ('P','M')
		                                                                                                 and nvl(b.WARD_LABL_PRIN_YN,'N') = 'N'
		                                                                                                 and nvl(b.RCPC_YN, 'N') in ('Y', 'W'))
		                                             )
		                                             or
		                                             (b.MDTN_NO_DVSN_CD in ('G','H') and a.INJC_PRIN_YN in ('P','M') and nvl(b.WARD_LABL_PRIN_YN,'N') = 'N' and nvl(b.RCPC_YN, 'N') in ('Y', 'W'))
		                                             or
		                                             (b.MDTN_NO_DVSN_CD not in ('O','Z','G','H') and a.INJC_PRIN_YN in ('P','M') and nvl(b.WARD_LABL_PRIN_YN,'N') = 'N')
		                                           )
		*/
		                                      and  a.ORDR_YMD = b.ORDR_YMD
		                                      and  a.MDTN_NO_DVSN_CD = b.MDTN_NO_DVSN_CD
		                                      and  a.MDTN_NO = b.MDTN_NO
		                                      and  a.MDTN_LCDV_CD = b.MDTN_LCDV_CD
		                                      and  c.MDPR_CD = b.MDPR_CD
		                                      and (   (nvl(c.OTPT_PHRM_RQST_YN, 'N') != 'Y')
		                                           or (   (nvl(c.OTPT_PHRM_RQST_YN, 'N') = 'Y')
		                                               and(b.MDTN_NO_DVSN_CD in ('B', 'E', 'F', 'H', 'I', 'S', 'T'))
		                                               )
		                                           )
		                                   )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd4 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd4"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd4 */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u25$I01_약처방진행상태 UPDATE */
		             MDMEDORDT
		       set
		            DRUG_ORDR_PRSS_CD = decode( sign(nvl(DRUG_ORDR_PRSS_CD, 0) - 2), -1, '2', DRUG_ORDR_PRSS_CD)
		         ,  PHDP_PRIN_YN          =  case when   decode( sign(nvl(DRUG_ORDR_PRSS_CD, 0) - 2), -1, '2', DRUG_ORDR_PRSS_CD) > '1' then 'Y'
		                                                      else   PHDP_PRIN_YN  
		                                                end
		         ,  LAST_UPDR_ID      = #{gvUserId}
		         ,  LAST_UPDT_IP      = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where
		            ORDR_YMD  = to_date( #{ordrYmd} , 'YYYYMMDD')
		       and  (PTNO,ORDR_SNO) in (select
		                                         c.PTNO,
		                                         d.ORDR_SNO
		                                   from
		                                          SDPORDBAT c,
		                                          SDPORDDET d,
		                                          SDDDGCDMT e
		                                  where
		                                         d.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD') /* 처방일자             */
		                                    and  d.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}                    /* 처방형태구분         */
		                                    and  d.MDTN_NO = to_number( #{mdtnNo} )                          /* 투약번호             */
		                                    and  d.MDTN_LCDV_CD = decode( #{mdtnLcdvCd} , null, d.MDTN_LCDV_CD
		                                                                                                 , 'A', d.MDTN_LCDV_CD, #{mdtnLcdvCd} ) /* 투약위치 */
		                                    /* and  d.BSIS_CMMD_PLAC_CD not in ('7', '8', '9', 'B', 'O', 'R', 'A', 'T', 'U', 'V') */   /* 병동주사, CM, SM, 임상시험약국 제외*/
		                                    and  (d.BSIS_CMMD_PLAC_CD in ('1', '2', '3', '4', '5', '6') or (d.BSIS_CMMD_PLAC_CD = 'A' and e.DRAP_DVSN_CD != '2'))
		                                    and  nvl(d.WARD_LABL_PRIN_YN, 'N') = 'N'
		                                    and  c.ORDR_YMD = d.ORDR_YMD
		                                    and  c.MDTN_NO_DVSN_CD = d.MDTN_NO_DVSN_CD
		                                    and  c.MDTN_NO = d.MDTN_NO
		                                    and  c.MDTN_LCDV_CD = d.MDTN_LCDV_CD
		                                    and  e.MDPR_CD = d.MDPR_CD
		                                    /* SMC 하드코딩
		                                    and (   (nvl(e.OTPT_PHRM_RQST_YN, 'N') != 'Y')
		                                         or (   (nvl(e.OTPT_PHRM_RQST_YN, 'N') = 'Y')
		                                             and(d.MDTN_NO_DVSN_CD in ('B', 'E', 'F', 'Q', 'H', 'I', 'S', 'G'))
		                                             )
		                                         )
		                                    */
		                            )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd5 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd5"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd5 */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u23$I01_약처방 진행상태 update */
		             MDMEDORDT
		       set
		            DRUG_ORDR_PRSS_CD = decode( sign(nvl(DRUG_ORDR_PRSS_CD, 0) - 2), -1, '2', DRUG_ORDR_PRSS_CD)
		         ,  PHDP_PRIN_YN          =  case when  decode( sign(nvl(DRUG_ORDR_PRSS_CD, 0) - 2), -1, '2', DRUG_ORDR_PRSS_CD) > '1' then 'Y'
		                                                      else   PHDP_PRIN_YN  
		                                                end
		        ,   LAST_UPDR_ID      = #{gvUserId}
		        ,   LAST_UPDT_IP      = #{gvUserIp}
		        ,   LAST_UPDT_DT = sysdate
		        ,   LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		        ,   LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where
		            ORDR_YMD  = to_date( #{ordrYmd} , 'YYYYMMDD')
		       and  (PTNO,ORDR_SNO) in (select
		                                         a.PTNO,
		                                         b.ORDR_SNO
		                                   from
		                                          SDPORDBAT a,
		                                          SDPORDDET b
		                                  where
		                                         b.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD') /* 처방일자             */
		                                    and  b.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}                    /* 처방형태구분         */
		                                    and  b.MDTN_NO = #{mdtnNo}                          /* 투약번호             */
		                                    and  b.MDTN_LCDV_CD = decode( #{mdtnLcdvCd} , null, b.MDTN_LCDV_CD
		                                                                                                 , 'A', b.MDTN_LCDV_CD, #{mdtnLcdvCd} ) /* 투약위치 */
		                                    and  ( b.BSIS_CMMD_PLAC_CD in ('8','B')                    /* CM실                */
		                                          or
		                                          (b.BSIS_CMMD_PLAC_CD||'' = '7' and b.INJC_PLAC_CD = fn_cc_get_dprt_cd('DPRT_OSI') /* PHH */
		                                           and exists (
		                                                   select 'X'
		                                                     from  SDPORDDET z
		                                                    where z.ORDR_YMD = b.ORDR_YMD
		                                                      and z.MDTN_NO_DVSN_CD = b.MDTN_NO_DVSN_CD
		                                                      and z.MDTN_NO = b.MDTN_NO
		                                                      and z.MDTN_LCDV_CD = b.MDTN_LCDV_CD
		                                                      and z.PHDP_CMMD_BNDL_NO = b.PHDP_CMMD_BNDL_NO
		                                                      and z.BSIS_CMMD_PLAC_CD = 'B'))
		                                         )
		                                    and  (   (    (b.MDTN_NO_DVSN_CD in('O', 'Z'))
		                                              and (nvl(b.WARD_LABL_PRIN_YN, 'N') = 'N')
		                                              and (b.PHRM_IMPL_YMD <= trunc(sysdate))
		                                              and (   (    (nvl(b.RCPC_YN, 'N') = 'Y')
		                                                       and (trunc(nvl(b.RCPC_DT, sysdate)) < trunc(sysdate) + 1)
		                                                      )
		                                               /*refact     or (nvl(a.OROC_CD, '*') = 'n') */
		                                                  ) /* 혈액투석실 자가주사 추가 2012.2.14 LHJ */
		                                             /* and (nvl(a.ORDACTPL, '*') != 'N') */
		                                              )
		                                          or (    (b.MDTN_NO_DVSN_CD in('G', 'H'))
		                                              and (nvl(b.WARD_LABL_PRIN_YN, 'N') = 'N')
		                                              and (b.PHRM_IMPL_YMD <= trunc(sysdate))
		                                              and (   (    (nvl(b.RCPC_YN, 'N') = 'Y')
		                                                      and (trunc(nvl(b.RCPC_DT, sysdate)) < trunc(sysdate) + 1))
		                                                 /* refact   or (nvl(a.OROC_CD, '*') = 'n') */
		                                                  )
		                                              )
		                                          or (   (b.MDTN_NO_DVSN_CD in('B', 'E', 'F', 'I', 'S', 'T'))
		                                              and(nvl(b.WARD_LABL_PRIN_YN, 'N') = 'N')
		                                              )
		                                          )
		                                    and  a.ORDR_YMD = b.ORDR_YMD
		                                    and  a.MDTN_NO_DVSN_CD = b.MDTN_NO_DVSN_CD
		                                    and  a.MDTN_NO = b.MDTN_NO
		                                    and  a.MDTN_LCDV_CD = b.MDTN_LCDV_CD
		                                  )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd6 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd6"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd6 */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u26$I01_약처방진행상태 UPDATE */
		             MDMEDORDT
		       set
		            DRUG_ORDR_PRSS_CD = decode( sign(nvl(DRUG_ORDR_PRSS_CD, 0) - 2), -1, '2', DRUG_ORDR_PRSS_CD)
		         ,  PHDP_PRIN_YN     =  case when  decode( sign(nvl(DRUG_ORDR_PRSS_CD, 0) - 2), -1, '2', DRUG_ORDR_PRSS_CD) > '1' then 'Y'
		                                                 else   PHDP_PRIN_YN  
		                                            end
		         ,  LAST_UPDR_ID      = #{gvUserId}
		         ,  LAST_UPDT_IP      = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where
		            ORDR_YMD  = to_date( #{ordrYmd} , 'YYYYMMDD')
		       and  (PTNO,ORDR_SNO) in (select
		                                         a.PTNO,
		                                         b.ORDR_SNO
		                                from
		                                        SDPORDBAT a,
		                                        SDPORDDET b
		                                where
		                                       b.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD') /* 처방일자             */
		                                  and  b.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}                    /* 처방형태구분         */
		                                  and  b.MDTN_NO = #{mdtnNo}                          /* 투약번호             */
		                                  and  b.MDTN_LCDV_CD = decode( #{mdtnLcdvCd} , null, b.MDTN_LCDV_CD
		                                                                                               , 'A', b.MDTN_LCDV_CD, #{mdtnLcdvCd} ) /* 투약위치 */
		                                  and  b.BSIS_CMMD_PLAC_CD = '9'                             /* SM실                */
		                                  and  (   (    (b.MDTN_NO_DVSN_CD in('O', 'Z'))
		                                            and (nvl(b.WARD_LABL_PRIN_YN, 'N') = 'N')
		                                            and (b.PHRM_IMPL_YMD <= trunc(sysdate))
		                                            and (   (    (nvl(b.RCPC_YN, 'N') = 'Y')
		                                                    and (trunc(nvl(b.RCPC_DT, sysdate)) < trunc(sysdate) + 1))
		                                                 /* refact or (nvl(a.OROC_CD, '*') = 'n') */
		                                                ) /* 혈액투석실 자가주사 추가 2012.2.14 LHJ */
		                                         /* and (nvl(a.ORDACTPL, '*') != 'N') */
		                                            )
		                                        or (    (b.MDTN_NO_DVSN_CD in('G', 'H'))
		                                            and (nvl(b.WARD_LABL_PRIN_YN, 'N') = 'N')
		                                            and (b.PHRM_IMPL_YMD <= trunc(sysdate))
		                                            and (   (    (nvl(b.RCPC_YN, 'N') = 'Y')
		                                                    and (trunc(nvl(b.RCPC_DT, sysdate)) < trunc(sysdate) + 1))
		                                                 /* refact or (nvl(a.OROC_CD, '*') = 'n')  */
		                                                )
		                                            )
		                                        or (   (b.MDTN_NO_DVSN_CD in('B', 'E', 'F', 'I', 'S', 'T'))
		                                            and(nvl(b.WARD_LABL_PRIN_YN, 'N') = 'N')
		                                            )
		                                       )
		                                  and  a.ORDR_YMD = b.ORDR_YMD
		                                  and  a.MDTN_NO_DVSN_CD = b.MDTN_NO_DVSN_CD
		                                  and  a.MDTN_NO = b.MDTN_NO
		                                  and  a.MDTN_LCDV_CD = b.MDTN_LCDV_CD
		                               )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCdByOrdrSno () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCdByOrdrSno"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCdByOrdrSno */
		<![CDATA[
		update /*+ mdd_sdmdmed_u16$U01_투약완료 처리 */
		       MDMEDORDT x
		   set
		       x.DRUG_ORDR_PRSS_CD = decode(sign(x.DRUG_ORDR_PRSS_CD - #{drugPrssCd1} ), -1, #{drugPrssCd1} , x.DRUG_ORDR_PRSS_CD)
		      ,  PHDP_PRIN_YN     =  case when  decode(sign(x.DRUG_ORDR_PRSS_CD - #{drugPrssCd1} ), -1, #{drugPrssCd1} , x.DRUG_ORDR_PRSS_CD) > '1' then 'Y'
		                                                 else   PHDP_PRIN_YN  
		                                            end
		     , x.LAST_UPDR_ID      = #{gvUserId}
		     , x.LAST_UPDT_IP      = #{gvUserIp}
		     , x.LAST_UPDT_DT = sysdate
		     , x.LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		     , x.LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		 where x.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		   and (x.PTNO, x.ORDR_SNO) in (select a.PTNO
		                                     , b.ORDR_SNO
		                                  from
		                                       SDPORDBAT a
		                                     , SDPORDDET b
		                                 where a.ORDR_YMD        = to_date( #{ordrYmd} , 'YYYYMMDD')
		                                   and a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		                                   and a.MDTN_NO         = #{mdtnNo}
		                                   and a.MDTN_LCDV_CD    = decode( #{mdtnLcdvCd} , null, a.MDTN_LCDV_CD, 'A', a.MDTN_LCDV_CD,  #{mdtnLcdvCd} )
		                                   and b.ORDR_YMD        = a.ORDR_YMD
		                                   and b.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		                                   and b.MDTN_NO         = a.MDTN_NO
		                                   and b.MDTN_LCDV_CD    = a.MDTN_LCDV_CD
		                                   and (
		                                         ( b.BSIS_CMMD_PLAC_CD in ('1', '2', '3', '4', '5', '6')              )  or
		                                         ( b.BSIS_CMMD_PLAC_CD  = 'A' and b.DRAP_DVSN_CD               != '2' )  or /* 마약은 주사 제외 */
		                                         ( b.BSIS_CMMD_PLAC_CD  = '7' and nvl(b.OSLF_ADMN_DRUG_YN, 'N') = 'Y' )     /* 자가주사만 */
		                                       )
		                                   and (
		                                         ( #{etcYn} is null     and nvl(b.DRUS_CD, 'X') <> 'SAVE') or
		                                         ( #{etcYn} is not null and nvl(b.DRUS_CD, 'X')  = 'SAVE')
		                                       )
		                                   /*--------------------------------------------------------------------------*/
		                                   /* 조제정보 생성 전 반납*/
		                                   and nvl((select /*+ index ( a1 mdmedordt_pk )
		                                                      index ( b1 sdjdgrtnt_pk ) */
		                                                  'Y'
		                                             from
		                                                  MDMEDORDT a1,
		                                                  SDJDGRTNT b1
		                                            where
		                                                  a1.PTNO     = b.PTNO
		                                              and a1.ORDR_YMD = b.ORDR_YMD
		                                              and a1.ORDR_SNO = b.ORDR_SNO
		                                              and a1.DRUG_ORDR_PRSS_CD <> '0'
		                                              and (nvl(a1.DC_DVSN_CD, 'N') = 'Y' or nvl(a1.CMMD_BEFR_RTRN_DVSN_CD,'N') = 'Y')
		                                              and a1.ORDR_YMD = b1.ORDR_YMD
		                                              and a1.PTNO = b1.PTNO
		                                              and a1.ORDR_SNO = b1.ORDR_SNO
		                                              and b1.DRUG_RTRE_CD = '7'
		                                              and rownum = 1
		                                         ), 'N') <> 'Y'
		                                   /* 미수령 반납 : 조제정보 생성 불출 처리 전 반납 */
		                                   and ( ( b.BSIS_CMMD_PLAC_CD in ('1', '2', '3', '4', '5', '6', '7', 'A') and
		                                          not exists ( select  'Y'
		                                                         from  SDJDGRTNT s
		                                                        where  s.ORDR_YMD        = b.ORDR_YMD
		                                                          and  s.MDTN_NO_DVSN_CD = b.MDTN_NO_DVSN_CD
		                                                          and  s.MDTN_NO         = b.MDTN_NO
		                                                          and  s.MDTN_LCDV_CD    = b.MDTN_LCDV_CD
		                                                          and  s.ORDR_SNO        = b.ORDR_SNO
		                                                          and  s.MDPR_CD         = b.MDPR_CD
		                                                          and  nvl(s.MDPR_RTRN_NTM, -1) != 0
		                                                          and  b.INVN_TOTL_QTY <= (select  sum(RTRN_RQST_CQY)
		                                                                                     from  SDJDGRTNT t
		                                                                                    where  s.ORDR_YMD         = t.ORDR_YMD
		                                                                                      and  s.MDTN_NO_DVSN_CD  = t.MDTN_NO_DVSN_CD
		                                                                                      and  s.MDTN_NO          = t.MDTN_NO
		                                                                                      and  s.ORDR_SNO         = t.ORDR_SNO
		                                                                                      and  s.MDTN_LCDV_CD     = t.MDTN_LCDV_CD
		                                                                                      and  s.MDPR_CD          = t.MDPR_CD
		                                                                                      and  t.RTRN_DETL_DVSN_CD = 'B' /* A 수령반납, B 미수령반납, Z 잔량반납 */
		                                                                                      and  nvl(t.MDPR_RTRN_NTM, -1) != 0)
		                                                     )
		                                         )
		                                       )
		                                   /*--------------------------------------------------------------------------*/                                       
		                               )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhdpPrinYnByP () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhdpPrinYnByP"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhdpPrinYnByP */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u18$U01_약제부 출력여부 수정 */
		                MDMEDORDT
		           set
		                PHDP_PRIN_YN = 'P'
		             ,  LAST_UPDR_ID = #{gvUserId}
		             ,  LAST_UPDT_IP = #{gvUserIp}
		             ,  LAST_UPDT_DT = sysdate
		             ,  LAST_UPDT_CLNT_PRGM_ID =  #{gvClntPrgmId}
					 ,  LAST_UPDT_SRVR_PRGM_ID =  #{gvSrvrPrgmId}
		         where  PTNO = #{ptno}
		           and  ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		           and  MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		           and  MDTN_NO = #{mdtnNo}
		           and  MDTN_LCDV_CD = #{mdtnLcdvCd}
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhdpPrinYnByY () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhdpPrinYnByY"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhdpPrinYnByY */
		<![CDATA[
		     update  /*+ mdd_sdmdmed_u19$U01_약제부 출력여부 수정2 */
		                MDMEDORDT
		           set
		                PHDP_PRIN_YN = 'Y'
		             ,  DRUG_ORDR_PRSS_CD = '5'
		             ,  LAST_UPDR_ID = #{gvUserId}
					 ,  LAST_UPDT_IP = #{gvUserIp}
					 ,  LAST_UPDT_DT =  sysdate
					 ,  LAST_UPDT_CLNT_PRGM_ID =  #{gvClntPrgmId}
					 ,  LAST_UPDT_SRVR_PRGM_ID =  #{gvSrvrPrgmId}
		         where  PTNO = #{ptno}
		           and  ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		           and  MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		           and  MDTN_NO = #{mdtnNo}
		           and  MDTN_LCDV_CD = #{mdtnLcdvCd}
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateAdltAcdgDetlVl (성인항암제상세값) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateAdltAcdgDetlVl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateAdltAcdgDetlVl */
			update    /*+ mdd_sdordrc_u01$I01_약물정보_처방마스터 UPDATE */
		            MDORDRCMT a
		       set
		            a.ADLT_USE_QTY = to_number(#{adltUseQty}),
		            a.BSIS_NTM = to_number(#{bsisNtm}),
		            a.DRUS_CD = #{drusCd},
		            a.DYS1_CECK_QTY = decode(#{dys1PcunAdltMxmmQty}, 0, null, null, null, #{dys1PcunAdltMxmmQty} ),
		            a.ORLM_VLM =case when #{dys1PcunAdltMxmmQty} = 0 then null
		                             when #{dys1PcunAdltMxmmQty} is null then null
		                             else
		                                  case when (select stst_dvsn_cd
		                                               from SDDDGCDMT
		                                              where mdpr_cd = #{mdprCd}) = 2
		                                       then round(to_number(#{dys1PcunAdltMxmmQty}) * (select PCUN_INLS_QTY
		                                                                                         from SDDDGCDMT
		                                                                                        where mdpr_cd = #{mdprCd}) ,2)
		                                       else a.ORLM_VLM
		                                   end
		                         end
		         ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		    where  ORDR_CD = #{mdprCd}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrmRtrnQtyPh (약반납 수량 수정) 
        Description :                                           약반납 수량 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrmRtrnQtyPh"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhrmRtrnQtyPh */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u07$U01_약반납 수량 수정 */
		              MDMEDORDT a
		        set
		             a.PHRM_RTRN_QTY  =
		          (
				   select
						   nvl(a.PHRM_RTRN_QTY, 0) + ( #{rtrnCnfrCqy} -  #{phrmRtrnQty} ) * decode(a.SLCT_UNIT_DVSN_CD, '2', b.PCUN_INLS_QTY, 1)
					 from
						    SDDDGCDMT b
					where  b.MDPR_CD = a.ORDR_CD
		          )
		          ,  a.PACL_AFTR_DRRT_QTY  = nvl(a.PACL_AFTR_DRRT_QTY, 0) +  #{rtrnCnfrCqy} -  #{phrmRtrnQty}
		          ,  a.FRNS_RTRN_CQY = decode(nvl(a.PACL_AFTR_DRRT_QTY, 0) +  #{rtrnCnfrCqy} - #{phrmRtrnQty} , 0, null,
		                                decode(a.FRNS_CTRL_DVSN_CD, null, null, a.FRNS_VLM))
		         ,  a.rcpc_aft_dc_psbl_yn = case when codv_cd in ('O','E' ) and nvl(  RCST_CD  , 'N' ) in ( 'Y','W' ) then 'Y'
		                                                  else nvl( a.rcpc_aft_dc_psbl_yn , 'N' ) 
		                                            end
		         , LAST_UPDR_ID      = nvl( #{userId}, #{gvUserId} )
			 	 ,  LAST_UPDT_IP      = #{gvUserIp}
				 ,  LAST_UPDT_DT      = sysdate
				 ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
				 ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		      where
		                a.PTNO          = #{ptno}
		        and  a.ORDR_YMD  = to_date( #{ordrYmd}, 'YYYYMMDD')
		        and  a.ORDR_SNO  = #{ordrSno}
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDurvRtrnDdcnPh (약반납 수량 수정) 
        Description :                                           약반납 수량 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDurvRtrnDdcnPh"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDurvRtrnDdcnPh */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u08$U01_약반납 수량 수정 */
		            MDMEDORDT a
		        set
		            a.DURV_RTRN_DDCN  = DDCN
		            ,  a.rcpc_aft_dc_psbl_yn = case when codv_cd in ('O','E' ) and nvl(  RCST_CD  , 'N' ) in ( 'Y','W' ) then 'Y'
		                                                  else nvl( a.rcpc_aft_dc_psbl_yn , 'N' ) 
		                                            end
		            , LAST_UPDR_ID      = nvl( #{userId},  #{gvUserId})
					,  LAST_UPDT_IP      = #{gvUserIp}
					,  LAST_UPDT_DT      = sysdate
					,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
					,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		      where  a.PTNO         = #{ptno}
		        and  a.ORDR_YMD  = to_date( #{ordrYmd}, 'YYYYMMDD')
		        and  a.ORDR_SNO  = #{ordrSno}
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDurvRtrnDdcnCancel (약반납 수량 수정) 
        Description :                                           약반납 수량 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDurvRtrnDdcnCancel"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDurvRtrnDdcnCancel */
		<![CDATA[
		update  /*+ mdd_sdmdmed_u09$U01_약반납 수량 수정 */
		              MDMEDORDT a
		        set
		             a.DURV_RTRN_DDCN  = ''
		            ,  a.rcpc_aft_dc_psbl_yn = case when codv_cd in ('O','E' ) and nvl(  RCST_CD  , 'N' ) in ( 'Y','W' ) then 'N'
		                                                     else nvl( a.rcpc_aft_dc_psbl_yn , 'N' ) 
		                                                end
		            , LAST_UPDR_ID      = nvl( #{userId} , #{gvUserId} )
					,  LAST_UPDT_IP      = #{gvUserIp}
					,  LAST_UPDT_DT      = sysdate
					,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
					,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		      where  a.PTNO         = #{ptno}
		        and  a.ORDR_YMD  = to_date( #{ordrYmd}, 'YYYYMMDD')
		        and  a.ORDR_SNO  = #{ordrSno}
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrDfntCncl (TPN처방 확정 취소) 
        Description :                                           TPN처방 확정 취소
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrDfntCncl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrDfntCncl */
		    update  /*+ mdd_sdtpnor_u02$U01_TPN처방 확정 취소 */
		            MDTPNORDT
		       set  ADPA_DVSN_CD      = #{adpaDvsnCd}           /* C-Central, P-Peripheral */
		         ,  TPN_ORDR_CD       = #{tpnOrdrCd}            /* TPN코드 */
		         ,  TPBG_CD           = #{tpbgCd}               /* TPN BAG코드 */
		         ,  ADPA_VLM          = #{adpaVlm}              /* VOLUME */
		         ,  CMMD_DFNT_YN      = #{cmmdDfntYn}           /* 조제완료(확정) */
		         ,  CMMD_DFNT_DT      = sysdate                 /* 조제확정시간 */
		         ,  CMMD_DFNT_PHRC_ID = #{cmmdDfntPhrcId}       /* 조제확정자(약사) */
		         ,  CHLD_GTTN_VL      = #{chldGttnVl}           /* (소아)배수 */
		         ,  BAG_NTM           = #{bagNtm}               /* BAG 회수 */
		        /* 서버 프로그램 전환시 자동 추가된 항목 */
		        , LAST_UPDR_ID = LAST_UPDR_ID
		      	/* , LAST_UPDR_ID = gvUserId */
		      	, LAST_UPDT_IP = #{gvUserIp}
		      	, LAST_UPDT_DT = sysdate
		      	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		      	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  PTNO     = #{ptno}                               /* 환자번호 */
		       and  ORDR_YMD = to_date(#{mdtnStrtYmd}, 'YYYYMMDD')   /* 처방일자 */
		       and  ORDR_SNO = #{ordrSno}                            /* 처방순번 */
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrCdMdfc (TPN처방코드 변경) 
        Description :                                           TPN처방코드 변경
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrCdMdfc"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrCdMdfc */
		    update /*+ mdd_sdtpnor_u03$U01_TPN처방코드 변경 */
		           MDMEDORDT
		       set
		           ORDR_CD   = #{tpnOrdrCd}
		        /* 서버 프로그램 전환시 자동 추가된 항목 */
		      	, LAST_UPDR_ID = #{gvUserId}
		      	, LAST_UPDT_IP = #{gvUserIp}
		      	, LAST_UPDT_DT = sysdate
		      	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		      	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  ORDR_YMD     = to_date(#{ordrYmd}, 'YYYYMMDD')
		       and  PTNO         = #{ptno}
		       and  ORDR_SNO     = #{ordrSno1}
		       and  MDPR_CLSF_CD = '8'
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrLablPrinSttsMdfc () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrLablPrinSttsMdfc"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateTpnOrdrLablPrinSttsMdfc */
		    update  /*+ mdd_sdtpnor_u01$U01_TPN처방 라벨출력 상태수정 */
		            MDTPNORDT
		       set
		            LABL_PRIN_YN = decode(#{lablPrinYn}, 'Y', nvl(LABL_PRIN_YN, #{lablPrinYn}), #{lablPrinYn})
		            /* 서버 프로그램 전환시 자동 추가된 항목 */
		            , LAST_UPDR_ID = LAST_UPDR_ID
		          	/* , LAST_UPDR_ID = gvUserId */
		          	, LAST_UPDT_IP = #{gvUserIp}
		          	, LAST_UPDT_DT = sysdate
		          	, LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		          	, LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  PTNO = #{ptno}
		       and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')     /* 처방일자             */
		       and  ORDR_SNO = #{ordrSno}            /* 처방순번             */
		       and  nvl(CMMD_DFNT_YN, 'N') = 'Y'
		       and  #{cmmdDfntYn} = '1'
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrgrSttsCdMdfc (약처방 진행 상태코드 5 로 변경) 
        Description :                                           약처방 진행 상태코드 5 로 변경
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrgrSttsCdMdfc"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrgrSttsCdMdfc */
		<![CDATA[	
		update  /*+ mdd_sdmdmed_u31$U01_SAVE 용법 진도변경1 */
		        MDMEDORDT
		    set
		        DRUG_ORDR_PRSS_CD = '5'
		      /* 서버 프로그램 전환시 자동 추가된 항목 */
		      , LAST_UPDR_ID = LAST_UPDR_ID
		      , LAST_UPDT_IP = #{gvUserIp}
		      , LAST_UPDT_DT = sysdate
		      , LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		      , LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}  
		    where PTNO = #{ptno}
		       and to_char(ORDR_YMD,'yyyymmdd')=#{ordrYmd}
					and 	ORDR_SNO= #{ordrSno}
					and 	mdtn_no = #{mdtnNo}
		]]>            
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateFdnoMdprUseSmtnRqst (정수약품사용집계요청) 
        Description :                                           정수약품사용집계요청
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateFdnoMdprUseSmtnRqst"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateFdnoMdprUseSmtnRqst */
		    update  /*+ mdd_sdmdmed_u29$U01_정수약품사용집계요청 update5 */
		            MDMEDORDT
		       set
		            DRUG_ORDR_PRSS_CD = '5'
		         /* 서버 프로그램 전환시 자동 추가된 항목 */
		         ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  PTNO     = #{ptno}
		       and  ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		       and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd5PhdpPrinYnO (약처방진행상태코드5 약제부출력여부O) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd5PhdpPrinYnO"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrugOrdrPrssCd5PhdpPrinYnO */
		    update  /*+ mdd_sdmdmed_u27$U01_외래주사 실시일자별 일괄불출 및 조회 y */
		            MDMEDORDT
		       set
		            DRUG_ORDR_PRSS_CD = '5'
		         ,  PHDP_PRIN_YN  = 'O'
		         /* 서버 프로그램 전환시 자동 추가된 항목 */
		         ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  PTNO     = #{ptno}
		       and  ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		       and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhdpPrinYnY (약제부출력여부Y) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhdpPrinYnY"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePhdpPrinYnY */
		    update  /*+ mdd_sdmdmed_u28$U01_외래주사 실시일자별 일괄불출 및 조회 o */
		         MDMEDORDT
		    set
		         PHDP_PRIN_YN  = 'Y'
		      /* 서버 프로그램 전환시 자동 추가된 항목 */
		      ,  LAST_UPDR_ID = #{gvUserId}
		      ,  LAST_UPDT_IP = #{gvUserIp}
		      ,  LAST_UPDT_DT = sysdate
		      ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		      ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		     where  PTNO     = #{ptno}
		       and  ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		       and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrrtPrgrMdfc (약반납 진행 변경) 
        Description :                                           약처방 테이블에서 환자번호, DUR 처방일자, 원처방일련번호 가 같은건에 대해 약처방진행상태코드를 입력받은 값으로
                                                                Update 한다
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrrtPrgrMdfc"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateDrrtPrgrMdfc */
		<![CDATA[		    
		update  /*+ mdd_sdmedor_u10$U01_반납 진도변경 DAM4 */
		       MDMEDORDT
		  set
		       DRUG_ORDR_PRSS_CD = #{drugOrdrPrssCd}
		    /* 서버 프로그램 전환시 자동 추가된 항목 */
		    ,  LAST_UPDR_ID = #{gvUserId}
		    ,  LAST_UPDT_IP = #{gvUserIp}
		    ,  LAST_UPDT_DT = sysdate
		    ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		    ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		 where  PTNO     = #{ptno}
		   and  ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		   and  ORDR_SNO = #{ordrSno}
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateAcdgOrdrPrss () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateAcdgOrdrPrss"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateAcdgOrdrPrss */
		<![CDATA[	
		    update  /*+ mdd_sdmdmed_u30$S01_항암제처방 진행상태 UPDATE */
		            MDMEDORDT
		     set DRUG_ORDR_PRSS_CD = '2'
		         /* 서버 프로그램 전환시 자동 추가된 항목 */
		        , LAST_UPDR_ID = LAST_UPDR_ID
		        , LAST_UPDT_IP = #{gvUserIp}
		        , LAST_UPDT_DT = sysdate
		        , LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		        , LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}     
		    where ORDR_YMD  = to_date(#{ordrYmd}, 'YYYYMMDD')
		      and (PTNO, ORDR_SNO) in (
		                                select
		                                    a.PTNO
		                                 ,  b.ORDR_SNO
		                                from
		                                    SDPORDBAT a
		                                 ,  SDPORDDET b
		                               where  a.ORDR_YMD  = to_date(#{ordrYmd}, 'YYYYMMDD')
		                                 and  a.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		                                 and  a.MDTN_NO    = #{mdtnNo}
		                                 and  a.MDTN_LCDV_CD = decode(#{mdtnLcdvCd}, null, a.MDTN_LCDV_CD, 'A', a.MDTN_LCDV_CD, #{mdtnLcdvCd}) /* 투약위치 */
		                                 and  b.ORDR_YMD  = a.ORDR_YMD
		                                 and  b.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		                                 and  b.MDTN_NO    = a.MDTN_NO
		                                 and  b.MDTN_LCDV_CD = a.MDTN_LCDV_CD
		                                 and  b.PHDP_CMMD_BNDL_NO  = #{phdpCmmdBndlNo}
		                              )
		 ]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePwdrDslwYnMdfc (산제불가여부 변경) 
        Description :                                           산제불가여부 변경
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePwdrDslwYnMdfc"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePwdrDslwYnMdfc */
		 update  /*+ mdd_ordrcmt_u06$I01_처방코드기본 산제불가여부 Update */
		         MDORDRCMT
		     set
		         PWDR_DSLW_YN           =  #{pwdrDslwYn}
		       , LAST_UPDR_ID           = #{gvUserId}
		       , LAST_UPDT_IP           = #{gvUserIp}
		       , LAST_UPDT_DT           = sysdate
		       , LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		       , LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		   where ORDR_CD = #{ordrCd}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertBrngDrugOrdrMstrInfm () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertBrngDrugOrdrMstrInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-sup-sd-sdp-dao-SdpBrngDrugIdntComnDAO-insertBrngDrugMdprMstrInfm */
		<![CDATA[
		 insert /*+ 지참약처방마스터정보 등록 */
		   into MDORDRCMT( ORDR_CD                                   /* 처방코드 NOT NULL */
		                 , APST_YMD                                  /* 적용시작일자 NOT NULL */
		                 , APFN_YMD                                  /* 적용종료일자 NOT NULL */
		                 , ORDR_NM                                   /* 처방명 NOT NULL */
		                 , UPRC_ORDR_NM                              /* 대문자처방명 NOT NULL */
		                 , ORCL_CD                                   /* 처방분류코드 NOT NULL */
		                 , ORDR_CLTY_CD                              /* 처방분류유형코드 NOT NULL */
		                 , SLIP_CD                                   /* SLIP코드 */
		                 , SORT_SQNC                                 /* 정렬순서 */
		                 , PTPT_CD                                   /* 환자가야할장소코드 */
		                 , ORDR_PSBL_DVSN_CD                         /* 처방가능구분코드 */
		                 , TMSR_PSBL_YN                              /* 시계열가능여부 */
		                 , MDPR_NM                                   /* 약품명 */
		                 , ORLM_VLM                                  /* 처방제한용량 */
		                 , INVN_PCUN_CD                              /* 재고포장단위코드 */
		                 , PCUN_INLS_QTY                             /* 포장단위포함량 */
		                 , ICUN_CD                                   /* 함량단위코드 */
		                 , KORN_PDCT_NM                              /* 한글상품명 */
		                 , ENSN_PDCT_NM                              /* 영문상품명 */
		                 , INGR_NM                                   /* 성분명 */
		                 , ADLT_USE_QTY                              /* 성인사용량 */
		                 , MDPR_CLSF_CD                              /* 약품분류코드 */
		                 , DRAP_DVSN_CD                              /* 약적용구분코드 */
		                 , DGFR_CD                                   /* 제형코드 */
		                 , MEGR_CD                                   /* 약효군코드 */
		                 , DRUS_CD                                   /* 용법코드 */
		                 , ANTB_YN                                   /* 항생제여부 */
		                 , ANTB_RPRS_INGR_CD                         /* 항생제대표성분코드 */
		                 , TOTL_QTY_CLCL_CD                          /* 총량계산코드 */
		                 , DVDN_DVSN_CD                              /* 분할구분코드 */
		                 , IHOH_DVSN_CD                              /* 원내원외구분코드 */
		                 , SDPF_EXRE_CD                              /* 의약분업예외사유코드 */
		                 , TIMS1_TOTL_QTY_YN                         /* 1회총량여부 */
		                 , PWDR_DSLW_YN                              /* 산제불가여부 */
		                 , DYS1_CECK_QTY                             /* 1일체크량 */
		                 , SAME_DGFR_MNMM_INLS_QTY                   /* 동일제형최소포함량 */
		                 , SAME_DGFR_MXMM_INLS_QTY                   /* 동일제형최대포함량 */
		                 , KIT_MDPR_DDCN                             /* 키트약품일수 */
		                 , STST_DVSN_CD                              /* 통계구분코드 */
		                 , RSTC_CMPN_NM                              /* 제약회사명 */
		                 , CNPL_CD                                   /* 계약처코드 */
		                 , ALL_EMIT_NM                               /* 전체검사항목명 */
		                 , EXRS_FRMT_CD                              /* 검사결과형태코드 */
		                 , RSLT_LNGT_VL                              /* 결과길이값 */
		                 , RSLT_FDNO_LNGT_VL                         /* 결과정수길이값 */
		                 , RSLT_DCML_LNGT_VL                         /* 결과소수길이값 */
		                 , SPCM_CD1                                  /* 검체코드1 */
		                 , SPCM_CD2                                  /* 검체코드2 */
		                 , SPCM_NEED_QTY1                            /* 검체필요량1 */
		                 , SPCM_NEED_QTY2                            /* 검체필요량2 */
		                 , SPCN_CD1                                  /* 검체용기코드1 */
		                 , SPCN_CD2                                  /* 검체용기코드2 */
		                 , SPCN_NEED_COT1                            /* 검체용기필요개수1 */
		                 , SPCN_NEED_COT2                            /* 검체용기필요개수2 */
		                 , EXCF_CD                                   /* 검사분류코드 */
		                 , SUN_EXMN_YN                               /* 일요일검사여부 */
		                 , MON_EXMN_YN                               /* 월요일검사여부 */
		                 , TUE_EXMN_YN                               /* 화요일검사여부 */
		                 , WED_EXMN_YN                               /* 수요일검사여부 */
		                 , THU_EXMN_YN                               /* 목요일검사여부 */
		                 , FRI_EXMN_YN                               /* 금요일검사여부 */
		                 , SAT_EXMN_YN                               /* 토요일검사여부 */
		                 , OTPT_EXRM_CD                              /* 외래검사실코드 */
		                 , CRTC_RANG_PRFM_YN                         /* Critical범위수행여부 */
		                 , EXMN_CYCL_CTN                             /* 검사주기내용 */
		                 , SCEX_TAT_MNGM_YN                          /* 검체검사TAT관리여부 */
		                 , RPRT_PERD_RQRD_HH_CTN                     /* 보고기간소요시간내용 */
		                 , EXMN_SPSB_CTN                             /* 검사특기사항내용 */
		                 , PCTS_EXMN_PSBL_YN                         /* POCT검사가능여부 */
		                 , SET_EXMN_YN                               /* SET검사여부 */
		                 , BLCL_EXMN_YN                              /* 채혈검사여부 */
		                 , ACMP_YN                                   /* 동반여부 */
		                 , SNGN_SPCM_YN                              /* 단독검체여부 */
		                 , NPO_YN                                    /* 금식여부 */
		                 , NPO_HH                                    /* 금식시간 */
		                 , BCTM_BLCL_YN                              /* 채혈팀채혈여부 */
		                 , MDCR_BEEX_YN                              /* 진료이전검사여부 */
		                 , STST_APDV_CD                              /* 통계적용구분코드 */
		                 , TDM_CD_DVSN_CD                            /* TDM코드구분코드 */
		                 , PHRK_EXMN_CD                              /* 약물동력학검사코드 */
		                 , ER_EXMN_PSBL_YN                           /* 응급검사가능여부 */
		                 , APNT_NEED_EN                              /* 예약필요유무 */
		                 , EXRS_UNIT_NM                              /* 검사결과단위명 */
		                 , BLOD_CRSP_CD                              /* 혈액대응코드 */
		                 , BLRE_CD                                   /* 혈액출고코드 */
		                 , BLOD_ABRV_NM                              /* 혈액약어명 */
		                 , BLOD_MDTE_DVSN_CD                         /* 혈액치료구분코드 */
		                 , ENSN_NM                                   /* 영문명 */
		                 , PACS_INRF_YN                              /* PACS인터페이스여부 */
		                 , JPSN_NM                                   /* 일문명 */
		                 , ITNT_NM                                   /* 인터넷명 */
		                 , HAME_CRCM_ROOM_NO                         /* 수진상황방번호 */
		                 , EXRS_INQR_SQNC                            /* 검사결과조회순서 */
		                 , PRSR_YN                                   /* 택배여부 */
		                 , USER_SET_YN                               /* 사용자SET여부 */
		                 , MVMN_DVSN_CD                              /* 이동구분코드 */
		                 , STST_EXMN_CCT                             /* 통계검사건수 */
		                 , EXRS_GRP_CD                               /* 검사결과그룹코드 */
		                 , DONE_PSBL_YN                              /* Done가능여부 */
		                 , CHLD_DVSN_CD                              /* 소아구분코드 */
		                 , MCDP_ASCT_YN                              /* 진료과연관여부 */
		                 , INTR_SITE_CD                              /* 판독부위코드 */
		                 , CNMD_PRVN_ANTB_TRGT_YN                    /* 조영제예방항생제대상여부 */
		                 , APNT_SCHD_SBTY_NM                         /* 예약스케줄서브타입명 */
		                 , WARD_APNT_PSBL_YN                         /* 병동예약가능여부 */
		                 , CENT_APNT_PSBL_YN                         /* 중앙예약가능여부 */
		                 , PACS_CD                                   /* PACS코드 */
		                 , PACS_CD_NM                                /* PACS코드명 */
		                 , PACS_EQPM_CLSF_CD                         /* PACS장비분류코드 */
		                 , PACS_PHTR_DPRT_CLSF_CD                    /* PACS촬영부서분류코드 */
		                 , PACS_GRP_NM                               /* PACS그룹명 */
		                 , PACS_DETL_SITE_NM                         /* PACS상세부위명 */
		                 , PRMS_YN                                   /* 허가여부 */
		                 , WARD_EXRM_CD                              /* 병동검사실코드 */
		                 , ORDR_INFM_DVSN_CD                         /* 처방정보구분코드 */
		                 , EXRS_INQR_SQNC_TYP_CD                     /* 검사결과조회순서타입코드 */
		                 , CLNC_PTHL_ORDR_SHRT_NM                    /* 임상병리처방단축명 */
		                 , CLNC_EXAM_DRUG_YN                         /* 임상시험약여부 */
		                 , BSIS_NTM                                  /* 기본횟수 */
		                 , MDPR_ORLM_AGE_DDCN                        /* 약품처방제한연령일수 */
		                 , CACN_EXMN_YN                              /* 암센터검사여부 */
		                 , MNHS_EXMN_YN                              /* 본원검사여부 */
		                 , CACN_PTPT_CD                              /* 암센터환자가야할장소코드 */
		                 , CAHS_SCHD_SBTY_CD                         /* 암병원스케줄서브타입코드 */
		                 , IQRY_EXRM_CTN                             /* 문의검사실내용 */
		                 , RCEQ_USE_YN                               /* 접수기사용여부 */
		                 , FLUD_CD                                   /* 수액코드 */
		                 , FLUD_VLM                                  /* 수액용량 */
		                 , CLCL_MTHD_CD                              /* 계산방법코드 */
		                 , DTLS_EXCF_CD                              /* 세부검사분류코드 */
		                 , FLUD_ORDR_YN                              /* 수액처방여부 */
		                 , BLCL_SPSB_CTN                             /* 채혈특기사항내용 */
		                 , PRTN_DLFL_YN                              /* 복막투석액여부 */
		                 , ACGR_CD                                   /* 항암제그룹코드 */
		                 , ANTC_THRP_MNGM_DVSN_CD                    /* 항암요법관리구분코드 */
		                 , BSIS_ORDR_VRSN_VL                         /* 기본처방버전값 */
		                 , BSIS_ORDR_IDCT_END_YN                     /* 기본처방지시완결여부 */
		                 , BSIS_ORDR_COMN_CD_YN                      /* 기본처방공통코드여부 */
		                 , BSIS_ORDR_APLY_PLAC_CD                    /* 기본처방적용장소코드 */
		                 , ORDR_AGDC_NEED_YN                         /* 처방동의서필요여부 */
		                 , MCDP_CD1                                  /* 진료과코드1 */
		                 , MCDP_CD2                                  /* 진료과코드2 */
		                 , MCDP_CD3                                  /* 진료과코드3 */
		                 , INDT_KIND_VL                              /* 적응증종류값 */
		                 , INGR_MNMM_CD                              /* 성분최소코드 */
		                 , PTAD_PSBL_YN                              /* 원무가능여부 */
		                 , OTPT_CARE_BLCL_YN                         /* 외래간호채혈여부 */
		                 , SCEX_ADTN_ORDV_CD                         /* 검체검사추가처방구분코드 */
		                 , INJT_MIX_CMMD_DVSN_CD                     /* 주사제혼합조제구분코드 */
		                 /* 서버 프로그램 전환시 자동 추가된 항목 */
		                 , FRST_RGSR_ID                              /* 최초등록자ID NOT NULL */
		                 , FRST_RGST_IP                              /* 최초등록IP NOT NULL */
		                 , FRST_RGST_DT                              /* 최초등록일시 NOT NULL */
		                 , FRST_RGST_CLNT_PRGM_ID                    /* 최초등록클라이언트프로그램ID NOT NULL */
		                 , FRST_RGST_SRVR_PRGM_ID                    /* 최초등록서버프로그램ID NOT NULL */
		                 , LAST_UPDR_ID                              /* 최종수정자ID NOT NULL */
		                 , LAST_UPDT_IP                              /* 최종수정IP NOT NULL */
		                 , LAST_UPDT_DT                              /* 최종수정일시 NOT NULL */
		                 , LAST_UPDT_CLNT_PRGM_ID                    /* 최종수정클라이언트프로그램ID NOT NULL */
		                 , LAST_UPDT_SRVR_PRGM_ID                    /* 최종수정서버프로그램ID NOT NULL */
		                 , HLSC_EXMN_YN                              /* 건강검진검사여부 */
		                 , SBSN_ORDR_CD                              /* 대체처방코드 */
		                 , OCS_TX_MRCH_YN                            /* OCS처치물품여부 */
		                 , HGPR_TX_MTER_YN                           /* 고가처치재료여부 */
		                 , EXMN_MOBL_RPTN_PSBL_YN                    /*  */
		                 , EXMN_BEF_MOBL_RPTN_PSBL_MI                /*  */
		                 , CIS_INRF_YN                               /* CIS인터페이스여부 */
		                 , AGDC_NEED_EN                              /* 동의서필요유무 */
		                 , DGMT_RGST_TYPE_CD                         /* 약제등록유형코드 */
		                  )
		           values
		                  (
		                    #{ordrCd}                                      /* 처방코드 NOT NULL */
		                  , to_date(#{apstYmd}, 'yyyymmdd')                /* 적용시작일자 NOT NULL */
		                  , to_date(#{apfnYmd}, 'yyyymmdd')                /* 적용종료일자 NOT NULL */
		                  , #{ordrNm}                                      /* 처방명 NOT NULL */
		                  , upper(#{uprcOrdrNm})                                  /* 대문자처방명 NOT NULL */
		                  , #{orclCd}                                      /* 처방분류코드 NOT NULL */
		                  , #{ordrCltyCd}                                  /* 처방분류유형코드 NOT NULL */
		                  , #{slipCd}                                      /* SLIP코드 */
		                  , #{sortSqnc}                                    /* 정렬순서 */
		                  , #{ptptCd}                                      /* 환자가야할장소코드 */
		                  , #{ordrPsblDvsnCd}                              /* 처방가능구분코드 */
		                  , #{tmsrPsblYn}                                  /* 시계열가능여부 */
		                  , #{mdprNm}                                      /* 약품명 */
		                  , #{orlmVlm}                                     /* 처방제한용량 */
		                  , #{invnPcunCd}                                  /* 재고포장단위코드 */
		                  , #{pcunInlsQty}                                 /* 포장단위포함량 */
		                  , #{icunCd}                                      /* 함량단위코드 */
		                  , #{kornPdctNm}                                  /* 한글상품명 */
		                  , #{ensnPdctNm}                                  /* 영문상품명 */
		                  , #{ingrNm}                                      /* 성분명 */
		                  , #{adltUseQty}                                  /* 성인사용량 */
		                  , #{mdprClsfCd}                                  /* 약품분류코드 */
		                  , #{drapDvsnCd}                                  /* 약적용구분코드 */
		                  , #{dgfrCd}                                      /* 제형코드 */
		                  , #{megrCd}                                      /* 약효군코드 */
		                  , #{drusCd}                                      /* 용법코드 */
		                  , #{antbYn}                                      /* 항생제여부 */
		                  , #{antbRprsIngrCd}                              /* 항생제대표성분코드 */
		                  , #{totlQtyClclCd}                               /* 총량계산코드 */
		                  , #{dvdnDvsnCd}                                  /* 분할구분코드 */
		                  , #{ihohDvsnCd}                                  /* 원내원외구분코드 */
		                  , #{sdpfExreCd}                                  /* 의약분업예외사유코드 */
		                  , #{tims1TotlQtyYn}                              /* 1회총량여부 */
		                  , #{pwdrDslwYn}                                  /* 산제불가여부 */
		                  , #{dys1Ceck_qty}                                /* 1일체크량 */
		                  , #{sameDgfrMnmmInlsQty}                         /* 동일제형최소포함량 */
		                  , #{sameDgfrMxmmInlsQty}                         /* 동일제형최대포함량 */
		                  , #{kitMdprDdcn}                                 /* 키트약품일수 */
		                  , #{ststDvsnCd}                                  /* 통계구분코드 */
		                  , #{rstcCmpnNm}                                  /* 제약회사명 */
		                  , #{cnplCd}                                      /* 계약처코드 */
		                  , #{allEmitNm}                                   /* 전체검사항목명 */
		                  , #{exrsFrmtCd}                                  /* 검사결과형태코드 */
		                  , #{rsltLngtVl}                                  /* 결과길이값 */
		                  , #{rsltFdnoLngtVl}                              /* 결과정수길이값 */
		                  , #{rsltDcmlLngtVl}                              /* 결과소수길이값 */
		                  , #{spcmCd1}                                     /* 검체코드1 */
		                  , #{spcmCd2}                                     /* 검체코드2 */
		                  , #{spcmNeedQty1}                                /* 검체필요량1 */
		                  , #{spcmNeedQty2}                                /* 검체필요량2 */
		                  , #{spcnCd1}                                     /* 검체용기코드1 */
		                  , #{spcnCd2}                                     /* 검체용기코드2 */
		                  , #{spcnNeedCot1}                                /* 검체용기필요개수1 */
		                  , #{spcnNeedCot2}                                /* 검체용기필요개수2 */
		                  , #{excfCd}                                      /* 검사분류코드 */
		                  , #{sunExmnYn}                                   /* 일요일검사여부 */
		                  , #{monExmnYn}                                   /* 월요일검사여부 */
		                  , #{tueExmnYn}                                   /* 화요일검사여부 */
		                  , #{wedExmnYn}                                   /* 수요일검사여부 */
		                  , #{thuExmnYn}                                   /* 목요일검사여부 */
		                  , #{friExmnYn}                                   /* 금요일검사여부 */
		                  , #{satExmnYn}                                   /* 토요일검사여부 */
		                  , #{otptExrmCd}                                  /* 외래검사실코드 */
		                  , #{crtcRangPrfmYn}                              /* Critical범위수행여부 */
		                  , #{exmnCyclCtn}                                 /* 검사주기내용 */
		                  , #{scexTatMngmYn}                               /* 검체검사TAT관리여부 */
		                  , #{rprtPerdRqrdHhCtn}                           /* 보고기간소요시간내용 */
		                  , #{exmnSpsbCtn}                                 /* 검사특기사항내용 */
		                  , #{pctsExmn_psbl_yn}                            /* POCT검사가능여부 */
		                  , #{setExmnYn}                                   /* SET검사여부 */
		                  , #{blclExmnYn}                                  /* 채혈검사여부 */
		                  , #{acmpYn}                                      /* 동반여부 */
		                  , #{sngnSpcmYn}                                  /* 단독검체여부 */
		                  , #{npoYn}                                       /* 금식여부 */
		                  , #{npoHh}                                       /* 금식시간 */
		                  , #{bctmBlclYn}                                  /* 채혈팀채혈여부 */
		                  , #{mdcrBeexYn}                                  /* 진료이전검사여부 */
		                  , #{ststApdvCd}                                  /* 통계적용구분코드 */
		                  , #{tdmCdDvsnCd}                                 /* TDM코드구분코드 */
		                  , #{phrkExmnCd}                                  /* 약물동력학검사코드 */
		                  , #{erExmnPsblYn}                                /* 응급검사가능여부 */
		                  , #{apntNeedEn}                                  /* 예약필요유무 */
		                  , #{exrsUnitNm}                                  /* 검사결과단위명 */
		                  , #{blodCrspCd}                                  /* 혈액대응코드 */
		                  , #{blreCd}                                      /* 혈액출고코드 */
		                  , #{blodAbrvNm}                                  /* 혈액약어명 */
		                  , #{blodMdteDvsnCd}                              /* 혈액치료구분코드 */
		                  , #{ensnNm}                                      /* 영문명 */
		                  , #{pacsInrfYn}                                  /* PACS인터페이스여부 */
		                  , #{jpsnNm}                                      /* 일문명 */
		                  , #{itntNm}                                      /* 인터넷명 */
		                  , #{hameCrcmRoomNo}                              /* 수진상황방번호 */
		                  , #{exrsInqrSqnc}                                /* 검사결과조회순서 */
		                  , #{prsrYn}                                      /* 택배여부 */
		                  , #{userSetYn}                                   /* 사용자SET여부 */
		                  , #{mvmnDvsnCd}                                  /* 이동구분코드 */
		                  , #{ststExmnCct}                                 /* 통계검사건수 */
		                  , #{exrsGrpCd}                                   /* 검사결과그룹코드 */
		                  , #{donePsblYn}                                  /* Done가능여부 */
		                  , #{chldDvsnCd}                                  /* 소아구분코드 */
		                  , #{mcdpAsctYn}                                  /* 진료과연관여부 */
		                  , #{intrSiteCd}                                  /* 판독부위코드 */
		                  , #{cnmdPrvnAntbTrgtYn}                          /* 조영제예방항생제대상여부 */
		                  , #{apntSchdSbtyNm}                              /* 예약스케줄서브타입명 */
		                  , #{wardApntPsblYn}                              /* 병동예약가능여부 */
		                  , #{centApntPsblYn}                              /* 중앙예약가능여부 */
		                  , #{pacsCd}                                      /* PACS코드 */
		                  , #{pacsCdNm}                                    /* PACS코드명 */
		                  , #{pacsEqpmClsfCd}                              /* PACS장비분류코드 */
		                  , #{pacsPhtrDprtClsfCd}                          /* PACS촬영부서분류코드 */
		                  , #{pacsGrpNm}                                   /* PACS그룹명 */
		                  , #{pacsDetlSiteNm}                              /* PACS상세부위명 */
		                  , #{prmsYn}                                      /* 허가여부 */
		                  , #{wardExrmCd}                                  /* 병동검사실코드 */
		                  , #{ordrInfmDvsnCd}                              /* 처방정보구분코드 */
		                  , #{exrsInqrSqncTypCd}                           /* 검사결과조회순서타입코드 */
		                  , #{clncPthlOrdrShrtNm}                          /* 임상병리처방단축명 */
		                  , #{clncExamDrugYn}                              /* 임상시험약여부 */
		                  , #{bsisNtm}                                     /* 기본횟수 */
		                  , #{mdprOrlmAgeDdcn}                             /* 약품처방제한연령일수 */
		                  , #{cacnExmnYn}                                  /* 암센터검사여부 */
		                  , #{mnhsExmnYn}                                  /* 본원검사여부 */
		                  , #{cacnPtptCd}                                  /* 암센터환자가야할장소코드 */
		                  , #{cahsSchdSbtyCd}                              /* 암병원스케줄서브타입코드 */
		                  , #{iqryExrmCtn}                                 /* 문의검사실내용 */
		                  , #{rceqUseYn}                                   /* 접수기사용여부 */
		                  , #{fludCd}                                      /* 수액코드 */
		                  , #{fludVlm}                                     /* 수액용량 */
		                  , #{clclMthdCd}                                  /* 계산방법코드 */
		                  , #{dtlsExcfCd}                                  /* 세부검사분류코드 */
		                  , #{fludOrdrYn}                                  /* 수액처방여부 */
		                  , #{blclSpsbCtn}                                 /* 채혈특기사항내용 */
		                  , #{prtnDlflYn}                                  /* 복막투석액여부 */
		                  , #{acgrCd}                                      /* 항암제그룹코드 */
		                  , #{antcThrpMngmDvsnCd}                          /* 항암요법관리구분코드 */
		                  , #{bsisOrdrVrsnVl}                              /* 기본처방버전값 */
		                  , #{bsisOrdrIdctEndYn}                           /* 기본처방지시완결여부 */
		                  , #{bsisOrdrComnCdYn}                            /* 기본처방공통코드여부 */
		                  , #{bsisOrdrAplyPlacCd}                          /* 기본처방적용장소코드 */
		                  , #{ordrAgdcNeedYn}                              /* 처방동의서필요여부 */
		                  , #{mcdpCd1}                                     /* 진료과코드1 */
		                  , #{mcdpCd2}                                     /* 진료과코드2 */
		                  , #{mcdpCd3}                                     /* 진료과코드3 */
		                  , #{indtKindVl}                                  /* 적응증종류값 */
		                  , #{ingrMnmmCd}                                  /* 성분최소코드 */
		                  , #{ptadPsblYn}                                  /* 원무가능여부 */
		                  , #{otptCareBlclYn}                              /* 외래간호채혈여부 */
		                  , #{scexAdtnOrdvCd}                              /* 검체검사추가처방구분코드 */
		                  , #{injtMixCmmdDvsnCd}                           /* 주사제혼합조제구분코드 */
		                  /*  서버 프로그램 전환시 자동 추가된 항목 */
		                  , #{gvUserId}                                    /* 최초등록자ID NOT NULL */
		                  , #{gvUserIp}                                    /* 최초등록IP NOT NULL */
		                  , sysdate                                        /* 최초등록일시 NOT NULL */
		                  , #{gvClntPrgmId}                                /* 최초등록클라이언트프로그램ID NOT NULL */
		                  , #{gvSrvrPrgmId}                                /* 최초등록서버프로그램ID NOT NULL */
		                  , #{gvUserId}                                    /* 최종수정자ID NOT NULL */
		                  , #{gvUserIp}                                    /* 최종수정IP NOT NULL */
		                  , sysdate                                        /* 최종수정일시 NOT NULL */
		                  , #{gvClntPrgmId}                                /* 최종수정클라이언트프로그램ID NOT NULL */
		                  , #{gvSrvrPrgmId}                                /* 최종수정서버프로그램ID NOT NULL */
		                  , #{hlscExmnYn}                                  /* 건강검진검사여부 */
		                  , #{sbsnOrdrCd}                                  /* 대체처방코드 */
		                  , #{ocsTxMrchYn}                                 /* OCS처치물품여부 */
		                  , #{hgprTxMterYn}                                /* 고가처치재료여부 */
		                  , #{exmnMoblRptnPsblYn}                          /*  */
		                  , #{exmnBefMoblRptnPsblMi}                       /*  */
		                  , #{cisInrfYn}                                   /* CIS인터페이스여부 */
		                  , #{agdcNeedEn}                                  /* 동의서필요유무 */
		                  , #{dgmtRgstTypeCd}                              /* 약제등록유형코드 */
		                  )
		]]>
	</insert>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneParameter-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="wodvCd" column="WODV_CD"/>
		<result property="inqrDvsnCd" column="INQR_DVSN_CD"/>
		<result property="mdprIdntDetlSno" column="MDPR_IDNT_DETL_SNO"/>
		<result property="mdprIdntCtn" column="MDPR_IDNT_CTN"/>
		<result property="mdprSmryMemoCtn" column="MDPR_SMRY_MEMO_CTN"/>
		<result property="tims1AdmnQty" column="TIMS1_ADMN_QTY"/>
		<result property="pcunCd" column="PCUN_CD"/>
		<result property="ntm" column="NTM"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="efccCtn" column="EFCC_CTN"/>
		<result property="inhsMdprCd" column="INHS_MDPR_CD"/>
		<result property="mdprCd" column="MDPR_CD"/>
		<result property="sbsnMdprCd" column="SBSN_MDPR_CD"/>
		<result property="mdprId" column="MDPR_ID"/>
		<result property="rpmdId" column="RPMD_ID"/>
		<result property="ingrId" column="INGR_ID"/>
		<result property="mdprIdntDbYn" column="MDPR_IDNT_DB_YN"/>
		<result property="mdprPhobFileYn" column="MDPR_PHOB_FILE_YN"/>
		<result property="japnMmsbYn" column="JAPN_MMSB_YN"/>
		<result property="otrsInstIqryYn" column="OTRS_INST_IQRY_YN"/>
		<result property="otrsInstIqryCtn" column="OTRS_INST_IQRY_CTN"/>
		<result property="etcYn" column="ETC_YN"/>
		<result property="mdprIdntEtcCtn" column="MDPR_IDNT_ETC_CTN"/>
		<result property="qstnRspnSpedVl" column="QSTN_RSPN_SPED_VL"/>
		<result property="mpidInfmPrvcCd" column="MPID_INFM_PRVC_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneParameter () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneParameter-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneParameter"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneParameter-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneParameter */
				select '' as WODV_CD
		         , '' as INQR_DVSN_CD
		         ,  0 as MDPR_IDNT_DETL_SNO
		         ,  '' as MDPR_IDNT_CTN
		         ,  '' as MDPR_SMRY_MEMO_CTN
		         ,  0 as TIMS1_ADMN_QTY
		         ,  '' as PCUN_CD
		         ,  0 as NTM
		         ,  '' as DRUS_CD
		         ,  '' as EFCC_CTN
		         ,  '' as INHS_MDPR_CD
		         ,  '' as MDPR_CD
		         ,  '' as SBSN_MDPR_CD
		         ,  '' as MDPR_ID
		         ,  '' as RPMD_ID
		         ,  '' as INGR_ID
		         ,  '' as MDPR_IDNT_DB_YN
		         ,  '' as MDPR_PHOB_FILE_YN
		         ,  '' as JAPN_MMSB_YN
		         ,  '' as OTRS_INST_IQRY_YN
		         ,  '' as OTRS_INST_IQRY_CTN
		         ,  '' as ETC_YN
		         ,  '' as MDPR_IDNT_ETC_CTN
		         ,  '' as QSTN_RSPN_SPED_VL
		         ,  '' as MPID_INFM_PRVC_CD
				  from dual                 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTablPkOrdrCdBsis-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTablPkOrdrCdBsis () 
        Description :                                           테이블PK 처방코드기본
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTablPkOrdrCdBsis-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTablPkOrdrCdBsis"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTablPkOrdrCdBsis-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTablPkOrdrCdBsis */
		<![CDATA[
		select ORDR_CD as ORDR_CD
		  from MDORDRCMT
		 where ORDR_CD = #{ordrCd}
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneDummy-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="hiraPrdcCd" column="HIRA_PRDC_CD"/>
		<result property="imagPathVl" column="IMAG_PATH_VL"/>
		<result property="dgstMingrNm" column="DGST_MINGR_NM"/>
		<result property="dgstDgfrNm" column="DGST_DGFR_NM"/>
		<result property="hgrsMdprYn" column="HGRS_MDPR_YN"/>
		<result property="meaIdntMdprCtn" column="MEA_IDNT_MDPR_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneDummy () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneDummy-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneDummy"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneDummy-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneDummy */
		<![CDATA[
		   select   '1' Hira_Prdc_Cd
		          , '' as IMAG_PATH_VL
		          , '' as DGST_MINGR_NM
		          , '' as  DGST_DGFR_NM
		          , '' as  HGRS_MDPR_YN 
		          , '' as Mea_Idnt_Mdpr_Ctn
		     from dual
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrNm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="acdgRprsIngrCd" column="ACDG_RPRS_INGR_CD"/>
		<result property="acdgRprsIngrNm" column="ACDG_RPRS_INGR_NM"/>
		<result property="dltnYn" column="DLTN_YN"/>
		<result property="sortSqnc" column="SORT_SQNC"/>
		<result property="acdgRprsCdRmrkCtn" column="ACDG_RPRS_CD_RMRK_CTN"/>
		<result property="acdgRprsCdMpngYn" column="ACDG_RPRS_CD_MPNG_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrNm () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrNm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrNm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrNm-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrNm */
		<![CDATA[
		select  /*+ med_bltcdmt_l01$S01_항암제대표성분명 조회 DAM */
		            a.ACDG_RPRS_INGR_CD          --    항암제대표성분코드
		         ,  a.ACDG_RPRS_INGR_NM          --    항암제대표성분명
		         ,  a.DLTN_YN                    --    삭제여부
		         ,  a.SORT_SQNC                  --    정렬순서
		         ,  a.ACDG_RPRS_CD_RMRK_CTN      --    항암제대표코드비고내용
		         ,  a.ACDG_RPRS_CD_MPNG_YN       --    항암제대표코드매핑여부
		      from  MEBLTCDMT a
		     where  1=1
		       and  a.ACDG_RPRS_INGR_NM = nvl(#{acdgRprsIngrNm}, a.ACDG_RPRS_INGR_NM)
		       and  nvl(a.ACDG_RPRS_CD_MPNG_YN, 'N') = 'N'
		     order
		        by  a.ACDG_RPRS_INGR_NM, a.SORT_SQNC
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="acdgRgmnCd" column="ACDG_RGMN_CD"/>
		<result property="acdgRprsIngrCd" column="ACDG_RPRS_INGR_CD"/>
		<result property="acdgRprsIngrNm" column="ACDG_RPRS_INGR_NM"/>
		<result property="acdgRprsCdRmrkCtn" column="ACDG_RPRS_CD_RMRK_CTN"/>
		<result property="acdgAdmnMi" column="ACDG_ADMN_MI"/>
		<result property="sortSqnc" column="SORT_SQNC"/>
		<result property="frstRgsrId" column="FRST_RGSR_ID"/>
		<result property="frstRgstIp" column="FRST_RGST_IP"/>
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
		<result property="lastUpdrId" column="LAST_UPDR_ID"/>
		<result property="lastUpdtIp" column="LAST_UPDT_IP"/>
		<result property="acdgAdmnMi1" column="ACDG_ADMN_MI_1"/>
		<result property="acdgAdmnMi2" column="ACDG_ADMN_MI_2"/>
		<result property="useYn" column="USE_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrCd () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAcdgRprsIngrCd */
		<![CDATA[
		    select /*+ med_acrpcdt_l01$S01_Chemo Code 조회 DAM */
		            A.ACDG_RGMN_CD
		         ,  A.ACDG_RPRS_INGR_CD
		         ,  b.ACDG_RPRS_INGR_NM as ACDG_RPRS_INGR_NM            /*항암제대표성분명*/
		         ,  b.ACDG_RPRS_CD_RMRK_CTN as ACDG_RPRS_CD_RMRK_CTN    /* 항암제대표코드비고내용 */
		         ,  a.ACDG_ADMN_MI          as ACDG_ADMN_MI             /* 투여시간 분 */
		         ,  a.SORT_SQNC          /* 정렬순서 */
		         ,  a.FRST_RGSR_ID
		         ,  a.FRST_RGST_IP
		         ,  to_char(a.FRST_RGST_DT , 'yyyymmddhh24miss') FRST_RGST_DT
		         ,  a.LAST_UPDR_ID
		         ,  a.LAST_UPDT_IP
		         ,  trunc(a.ACDG_ADMN_MI/60)     as ACDG_ADMN_MI_1
		         ,  mod(a.ACDG_ADMN_MI, 60) as ACDG_ADMN_MI_2
		         ,  nvl(a.USE_YN, 'Y')  as USE_YN
		      from  MEACRPCDT a
		         ,  MEBLTCDMT b
			 where  a.ACDG_RGMN_CD  = nvl(#{acdgRgmnCd}, a.ACDG_RGMN_CD ) /* 항암레지먼코드 */
			   and  b.ACDG_RPRS_INGR_CD    (+)= a.ACDG_RPRS_INGR_CD
			 order by a.SORT_SQNC
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listPrclAcdgRprsIngr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="emrDtlsCtrlCd" column="EMR_DTLS_CTRL_CD"/>
		<result property="emrDtlsCtrlNm" column="EMR_DTLS_CTRL_NM"/>
		<result property="sortSqnc" column="SORT_SQNC"/>
		<result property="apfnYmd" column="APFN_YMD"/>
		<result property="frstRgsrId" column="FRST_RGSR_ID"/>
		<result property="frstRgstIp" column="FRST_RGST_IP"/>
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
		<result property="lastUpdrId" column="LAST_UPDR_ID"/>
		<result property="lastUpdtIp" column="LAST_UPDT_IP"/>
		<result property="emrCtrlSno" column="EMR_CTRL_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listPrclAcdgRprsIngr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listPrclAcdgRprsIngr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listPrclAcdgRprsIngr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listPrclAcdgRprsIngr-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listPrclAcdgRprsIngr */
		<![CDATA[
		    select /*+ med_acrpcdt_l02$S01_MEF410F2_Chemo Code 조회 DAM */
					a.EMR_DTLS_CTRL_CD                        /* EMR세부제어코드 */
				 ,  a.EMR_DTLS_CTRL_NM                        /* EMR세부제어명 */
				 ,  0                  SORT_SQNC              /* 정렬순서 */
				 ,  to_char(a.APFN_YMD,'yyyymmdd')   APFN_YMD /* 적용종료일자 */
				 ,  a.FRST_RGSR_ID
				 ,  a.FRST_RGST_IP
				 ,  to_char(a.FRST_RGST_DT , 'yyyymmddhh24miss') FRST_RGST_DT
				 ,  a.LAST_UPDR_ID
				 ,  a.LAST_UPDT_IP
				 ,  0 EMR_CTRL_SNO
			  from  MECTRLMMT a
			 where  a.EMR_CTRL_CD (+)= 'MM015'
			   and  a.APLY_PART_CD   (+)= 'MEF'
			 order
			    by  a.EMR_DTLS_CTRL_CD
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTumrElpsRgmnDetl-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="acdgPrclCtn" column="ACDG_PRCL_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTumrElpsRgmnDetl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTumrElpsRgmnDetl-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTumrElpsRgmnDetl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTumrElpsRgmnDetl-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneTumrElpsRgmnDetl */
		<![CDATA[
		    select  /*+ med_acrgmnt_s01$S01_종양경과레지먼상세조회 */
		            rgm.ACDG_PRCL_CTN
		      from  MEACRGMNT rgm
		     where  rgm.ACDG_RGMN_CD = #{acdgRgmnCd}
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnPrcl-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="acdgLrclCd" column="ACDG_LRCL_CD"/>
		<result property="acdgRgmnNm" column="ACDG_RGMN_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnPrcl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnPrcl-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnPrcl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnPrcl-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnPrcl */
		<![CDATA[
		    select  /*+ med_acrgmnt_l03$S01_MEF410F1_Protocol 조회_DAM */
					ACDG_LRCL_CD as ACDG_LRCL_CD   /* 항암제대분류코드 */
				 ,  ACDG_RGMN_NM as ACDG_RGMN_NM
			  from  MEACRGMNT rgmC
			 where  rgmC.MCDP_CD = #{mcdpCd}
			   and  RGMN_GRP_SQNC = '1'
			   and  nvl(rgmC.DLTN_YN, 'N') = 'N'
		     order by to_number(ACDG_LRCL_CD)
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="acdgRgmnCd" column="ACDG_RGMN_CD"/>
		<result property="acdgLrclCd" column="ACDG_LRCL_CD"/>
		<result property="acdgMdcsCd" column="ACDG_MDCS_CD"/>
		<result property="acdgSmclCd" column="ACDG_SMCL_CD"/>
		<result property="acdgRgmnNm" column="ACDG_RGMN_NM"/>
		<result property="acdgPrclNm" column="ACDG_PRCL_NM"/>
		<result property="cdVl" column="CD_VL"/>
		<result property="cdVl1" column="CD_VL_1"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="dissClsfCd" column="DISS_CLSF_CD"/>
		<result property="antcRgmnAdmnDetlCtn" column="ANTC_RGMN_ADMN_DETL_CTN"/>
		<result property="antcRgmnAdmnAtflNm" column="ANTC_RGMN_ADMN_ATFL_NM"/>
		<result property="antcRgmnAtflId" column="ANTC_RGMN_ATFL_ID"/>
		<result property="rgmnRfrcSbjcCtn1" column="RGMN_RFRC_SBJC_CTN1"/>
		<result property="rgmnRfrcSbjcCtn" column="RGMN_RFRC_SBJC_CTN"/>
		<result property="rgmnRfrcSbjcCtn3" column="RGMN_RFRC_SBJC_CTN3"/>
		<result property="dltnYn" column="DLTN_YN"/>
		<result property="rgmnReptYn" column="RGMN_REPT_YN"/>
		<result property="rgmnGrpSqnc" column="RGMN_GRP_SQNC"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnList () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnList-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listAntcRgmnList */
		<![CDATA[
		select  /*+ med_acrgmnt_l05$S01_항암 레지먼 목록 조회 */
		            rgmC.ACDG_RGMN_CD
		         ,  rgmC.ACDG_LRCL_CD
		         ,  rgmC.ACDG_MDCS_CD
		         ,  rgmC.ACDG_SMCL_CD
		         ,  rgmC.ACDG_RGMN_NM
		         ,  rgmC.ACDG_PRCL_NM
		         ,  case when rgmC.RGMN_GRP_SQNC = 1 then ''
		                                             else rgmP.RegCode
		            end                                    as CD_VL     /* CD_VL 상위레지먼코드 */
		         ,  to_char(rgmC.RGMN_GRP_SQNC) as CD_VL_1              /* CD_VL_1 */
		         ,  rgmC.MCDP_CD
		         ,  rgmC.DISS_CLSF_CD
		         ,  rgmC.ANTC_RGMN_ADMN_DETL_CTN
		         ,  rgmC.ANTC_RGMN_ADMN_ATFL_NM
		         ,  rgmC.ANTC_RGMN_ATFL_ID
		         ,  rgmC.RGMN_RFRC_SBJC_CTN1
		         ,  rgmC.RGMN_RFRC_SBJC_CTN
		         ,  rgmC.RGMN_RFRC_SBJC_CTN3
		         ,  nvl(rgmC.DLTN_YN, 'N') as DLTN_YN
		         ,  nvl(rgmC.DLTN_YN, 'N') as RGMN_REPT_YN
		         ,  rgmC.RGMN_GRP_SQNC     as RGMN_GRP_SQNC
		      from  (
		            select  rgm.ACDG_RGMN_CD      as RegCode
		                 ,  rgm.ACDG_LRCL_CD      as G1Code
		                 ,  rgm.ACDG_MDCS_CD      as G2Code
		                 ,  rgm.RGMN_GRP_SQNC     as RegGrp
		              from  MEACRGMNT rgm
		             where  rgm.MCDP_CD = #{mcdpCd}
		               and  rgm.RGMN_GRP_SQNC < (select max(x.RGMN_GRP_SQNC) from MEACRGMNT x)
		               and  (  (nvl(#{dltnYn}, 'N') = 'Y') or
		                       (nvl(rgm.DLTN_YN, 'N') = nvl(#{dltnYn}, 'N'))
		                    )
		            ) rgmP
		         ,  MEACRGMNT rgmC
		     where  1=1
		       and  rgmC.MCDP_CD           = #{mcdpCd}
		       and  (  (nvl(#{dltnYn}, 'N') = 'Y') or
		               (nvl(rgmC.DLTN_YN, 'N') = nvl(#{dltnYn}, 'N'))
		            )
		       and  rgmC.ACDG_LRCL_CD      = rgmP.G1Code (+)
		       and  rgmC.RGMN_GRP_SQNC - 1 = rgmP.RegGrp (+)
		       and  ( ((rgmC.RGMN_GRP_SQNC = 3) and (rgmP.RegGrp = 2) and (rgmC.ACDG_MDCS_CD = rgmP.G2Code))
		              or
		              ((rgmC.RGMN_GRP_SQNC = 2) and (rgmP.RegGrp = 1) and (rgmC.ACDG_LRCL_CD = rgmP.G1Code))
		              or
		              (rgmC.RGMN_GRP_SQNC = 1)
		            )
		     order
		        by  rgmC.RGMN_GRP_SQNC
		         ,  rgmC.SORT_SQNC
		         ,  to_number(rgmC.ACDG_LRCL_CD)
		         ,  to_number(rgmC.ACDG_MDCS_CD)
		         ,  rgmC.ACDG_SMCL_CD
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listBltmImdpRgmnList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="acdgRgmnCd" column="ACDG_RGMN_CD"/>
		<result property="acdgLrclCd" column="ACDG_LRCL_CD"/>
		<result property="acdgMdcsCd" column="ACDG_MDCS_CD"/>
		<result property="acdgSmclCd" column="ACDG_SMCL_CD"/>
		<result property="acdgRgmnNm" column="ACDG_RGMN_NM"/>
		<result property="acdgPrclNm" column="ACDG_PRCL_NM"/>
		<result property="cdVl" column="CD_VL"/>
		<result property="cdVl1" column="CD_VL_1"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="dissClsfCd" column="DISS_CLSF_CD"/>
		<result property="antcRgmnAdmnDetlCtn" column="ANTC_RGMN_ADMN_DETL_CTN"/>
		<result property="antcRgmnAdmnAtflNm" column="ANTC_RGMN_ADMN_ATFL_NM"/>
		<result property="antcRgmnAtflId" column="ANTC_RGMN_ATFL_ID"/>
		<result property="rgmnRfrcSbjcCtn1" column="RGMN_RFRC_SBJC_CTN1"/>
		<result property="rgmnRfrcSbjcCtn" column="RGMN_RFRC_SBJC_CTN"/>
		<result property="rgmnRfrcSbjcCtn3" column="RGMN_RFRC_SBJC_CTN3"/>
		<result property="dltnYn" column="DLTN_YN"/>
		<result property="rgmnReptYn" column="RGMN_REPT_YN"/>
		<result property="rgmnGrpSqnc" column="RGMN_GRP_SQNC"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listBltmImdpRgmnList () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listBltmImdpRgmnList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listBltmImdpRgmnList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listBltmImdpRgmnList-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listBltmImdpRgmnList */
		<![CDATA[
		select  /*+ med_acrgmnt_l06$S01_성인 항암레지먼 목록 조회  DAM */ distinct
		            P.ACDG_RGMN_CD
		         ,  P.ACDG_LRCL_CD
		         ,  P.ACDG_MDCS_CD
		         ,  P.ACDG_SMCL_CD
		         ,  P.ACDG_RGMN_NM
		         ,  P.ACDG_PRCL_NM
		         , case when P.RGMN_GRP_SQNC = 1 then ''
		                when P.RGMN_GRP_SQNC = 2
		                then (select ACDG_RGMN_CD from MEACRGMNT S
		                       where S.ACDG_LRCL_CD = R.ACDG_LRCL_CD and  S.ACDG_MDCS_CD = '0' and s.ACDG_SMCL_CD = '00')
		                when P.RGMN_GRP_SQNC = 3
		                then nvl((select ACDG_RGMN_CD from MEACRGMNT S
		                           where S.ACDG_LRCL_CD = P.ACDG_LRCL_CD and S.ACDG_MDCS_CD = P.ACDG_MDCS_CD and s.ACDG_SMCL_CD = '00')
		                        ,(select ACDG_RGMN_CD from MEACRGMNT S
		                           where S.ACDG_LRCL_CD = P.ACDG_LRCL_CD and  S.ACDG_MDCS_CD = '0' and s.ACDG_SMCL_CD = '00'))
		                end   as CD_VL
		         ,  to_char(P.RGMN_GRP_SQNC) as CD_VL_1
		         ,  P.MCDP_CD
		         ,  P.DISS_CLSF_CD
		         ,  P.ANTC_RGMN_ADMN_DETL_CTN
		         ,  P.ANTC_RGMN_ADMN_ATFL_NM
		         ,  P.ANTC_RGMN_ATFL_ID
		         ,  P.RGMN_RFRC_SBJC_CTN1
		         ,  P.RGMN_RFRC_SBJC_CTN
		         ,  P.RGMN_RFRC_SBJC_CTN3
		         ,  nvl(P.DLTN_YN, 'N')   as DLTN_YN
		         ,  nvl(P.RGMN_REPT_YN, 'N')   as RGMN_REPT_YN
		         ,  P.RGMN_GRP_SQNC
		      from  MEACRGMNT P
		         , (
		            select  distinct
		                    R.ACDG_RGMN_CD
		                 ,  R.ACDG_LRCL_CD
		                 ,  R.ACDG_MDCS_CD
		                 ,  R.ACDG_SMCL_CD
		                 ,  R.ACDG_RGMN_NM
		                 ,  R.ACDG_PRCL_NM
		                 , case when R.RGMN_GRP_SQNC = 1 then ''
		                        when R.RGMN_GRP_SQNC = 2
		                        then (select ACDG_RGMN_CD from MEACRGMNT S
		                               where S.ACDG_LRCL_CD = R.ACDG_LRCL_CD and  S.ACDG_MDCS_CD = '0' and s.ACDG_SMCL_CD = '00')
		                        when R.RGMN_GRP_SQNC = 3
		                        then nvl((select ACDG_RGMN_CD from MEACRGMNT S
		                                   where S.ACDG_LRCL_CD = R.ACDG_LRCL_CD and S.ACDG_MDCS_CD = R.ACDG_MDCS_CD and s.ACDG_SMCL_CD = '00')
		                                ,(select ACDG_RGMN_CD from MEACRGMNT S
		                                   where S.ACDG_LRCL_CD = R.ACDG_LRCL_CD and  S.ACDG_MDCS_CD = '0' and s.ACDG_SMCL_CD = '00'))
		                        end   as CD_VL
		                 ,  R.RGMN_GRP_SQNC   as CD_VL_1
		                 ,  (select ACDG_RGMN_CD from MEACRGMNT S
		                     where S.ACDG_LRCL_CD = R.ACDG_LRCL_CD
		                       and  S.ACDG_MDCS_CD = '0'
		                       and s.ACDG_SMCL_CD = '00')               as ACDG_LRCL_CD_1
		                 ,  nvl((select ACDG_RGMN_CD from MEACRGMNT S
		                       where S.ACDG_LRCL_CD = R.ACDG_LRCL_CD and S.ACDG_MDCS_CD = R.ACDG_MDCS_CD and s.ACDG_SMCL_CD = '00')
		                       ,(select ACDG_RGMN_CD from MEACRGMNT S
		                         where S.ACDG_LRCL_CD = R.ACDG_LRCL_CD and  S.ACDG_MDCS_CD = '0' and s.ACDG_SMCL_CD = '00'))  as ACDG_MDCS_CD_1
		                 ,  case when nvl(R.DLTN_YN, 'N') = 'N'
		                          and R.RGMN_GRP_SQNC = 3
		                          and exists ( select 1
		                                         from MEACRGMNT
		                                        where ACDG_LRCL_CD = r.ACDG_LRCL_CD
		                                          and ACDG_MDCS_CD = r.ACDG_MDCS_CD
		                                          and ACDG_SMCL_CD = '00'
		                                          and RGMN_GRP_SQNC = 2
		                                          and nvl(DLTN_YN, 'N') = 'Y')
		                         then 'N'
		                         when nvl(R.DLTN_YN, 'N') = 'N'
		                          and R.RGMN_GRP_SQNC = 2
		                          and exists ( select 1
		                                         from MEACRGMNT
		                                        where ACDG_LRCL_CD = r.ACDG_LRCL_CD
		                                          and ACDG_MDCS_CD = '0'
		                                          and ACDG_SMCL_CD = '00'
		                                          and RGMN_GRP_SQNC = 1
		                                          and nvl(DLTN_YN, 'N') = 'Y')
		                         then 'N'
		                         else 'Y'
		                         end INQR_YN
		              from  MEACRPCDT a
		                 ,  MEBLTCDMT b
		                 ,  MEACRGMNT R
		             where  1=1
		               and  R.MCDP_CD = '111160'
		               and  upper(nvl(b.ACDG_RPRS_INGR_NM, '*'))  like '%'||upper(nvl(#{acdgRprsIngrNm} , nvl(b.ACDG_RPRS_INGR_NM, '*')))||'%'
		               --and  nvl(a.USE_YN, 'Y') = 'Y'
		               and  nvl(b.DLTN_YN, 'N') = 'N'
		               and  nvl(b.ACDG_RPRS_CD_MPNG_YN(+), 'Y') = 'Y'
		               and  a.ACDG_RPRS_INGR_CD = b.HGRN_ACDG_RPRS_INGR_CD(+)
		               and  upper(nvl(R.ACDG_RGMN_NM, '*'))  like '%'||upper(nvl(#{acdgRgmnNm} , nvl(R.ACDG_RGMN_NM, '*')))||'%'
		               and  R.ACDG_RGMN_CD = a.ACDG_RGMN_CD(+)
		            ) R
		     where 1=1
		       and  P.MCDP_CD            = #{mcdpCd}
		       and  (  (nvl(#{dltnYn}, 'N') = 'Y') or
		               (nvl(P.DLTN_YN, 'N') = nvl(#{dltnYn}, 'N') and R.INQR_YN = 'Y')
		            )
		       and (
		             (P.ACDG_RGMN_CD = R.ACDG_RGMN_CD)
		             or (P.ACDG_RGMN_CD = R.ACDG_LRCL_CD_1)
		             or (P.ACDG_RGMN_CD = R.ACDG_MDCS_CD_1)
		            )
		     order
		        by  8, 2, 3, 4
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneChldAntcRcrdExmnRslt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="str1" column="STR_1"/>
		<result property="str2" column="STR_2"/>
		<result property="str3" column="STR_3"/>
		<result property="str4" column="STR_4"/>
		<result property="str5" column="STR_5"/>
		<result property="str6" column="STR_6"/>
		<result property="str7" column="STR_7"/>
		<result property="str8" column="STR_8"/>
		<result property="str9" column="STR_9"/>
		<result property="exrmRptnDt1" column="EXRM_RPTN_DT_1"/>
		<result property="exrmRptnDt1" column="EXRM_RPTN_DT_1"/>
		<result property="exrmRptnDt1" column="EXRM_RPTN_DT_1"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneChldAntcRcrdExmnRslt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneChldAntcRcrdExmnRslt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneChldAntcRcrdExmnRslt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneChldAntcRcrdExmnRslt-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneChldAntcRcrdExmnRslt */
		<![CDATA[
		select  /*+ med_resulmt_s08$S01_소아항암기록용 검사결과 조회 */ 
		            max(
		               case when x.EXMN_CD = 'BL2001' and x.EXRS_FRMT_CD = 'N'
		                    then case when sign(to_number(x.NRML_LWLM_NCVL_VL) - to_number(x.EXRS_NCVL_VL)) = 1 then '▼'||x.EXRS_NCVL_VL
		                              when sign(to_number(x.EXRS_NCVL_VL) - to_number(x.NRML_UPLM_NCVL_VL)) = 1 then '▲'||x.EXRS_NCVL_VL
		                              else x.EXRS_NCVL_VL
		                          end
		                    else null
		                end
		               )
		            keep (dense_rank last order by decode(x.EXMN_CD, 'BL2001', 9, 1), X.ORDR_YMD, X.ORDR_SNO, x.RPRT_DT) as STR_1 /* WBC */
		         ,  max(
		               case when x.EXMN_CD = 'BL200817' and x.EXRS_FRMT_CD = 'N'
		                    then case when sign(to_number(x.NRML_LWLM_NCVL_VL) - to_number(x.EXRS_NCVL_VL)) = 1 then '('||'▼'||x.EXRS_NCVL_VL||')'
		                              when sign(to_number(x.EXRS_NCVL_VL) - to_number(x.NRML_UPLM_NCVL_VL)) = 1 then '('||'▲'||x.EXRS_NCVL_VL||')'
		                              else '('||x.EXRS_NCVL_VL||')'
		                          end
		                    else null
		                end
		               )
		            keep (dense_rank last order by decode(x.EXMN_CD, 'BL200817', 9, 1), X.ORDR_YMD, X.ORDR_SNO, x.RPRT_DT) as STR_2 /* ANC */
		         ,  max(
		               case when x.EXMN_CD = 'BL2003' and x.EXRS_FRMT_CD = 'N'
		                    then case when sign(to_number(x.NRML_LWLM_NCVL_VL) - to_number(x.EXRS_NCVL_VL)) = 1 then '▼'||x.EXRS_NCVL_VL
		                              when sign(to_number(x.EXRS_NCVL_VL) - to_number(x.NRML_UPLM_NCVL_VL)) = 1 then '▲'||x.EXRS_NCVL_VL
		                              else x.EXRS_NCVL_VL
		                          end
		                    else null
		                end
		               )
		            keep (dense_rank last order by decode(x.EXMN_CD, 'BL2003', 9, 1), X.ORDR_YMD, X.ORDR_SNO, x.RPRT_DT) as STR_3 /* HB */
		         ,  max(
		               case when x.EXMN_CD = 'BL2006' and x.EXRS_FRMT_CD = 'N'
		                    then case when sign(to_number(x.NRML_LWLM_NCVL_VL) - to_number(x.EXRS_NCVL_VL)) = 1 then '▼'||x.EXRS_NCVL_VL
		                              when sign(to_number(x.EXRS_NCVL_VL) - to_number(x.NRML_UPLM_NCVL_VL)) = 1 then '▲'||x.EXRS_NCVL_VL
		                              else x.EXRS_NCVL_VL
		                          end
		                    else null
		                end
		               )
		            keep (dense_rank last order by decode(x.EXMN_CD, 'BL2006', 9, 1), X.ORDR_YMD, X.ORDR_SNO, x.RPRT_DT) as STR_4 /* PLT */
		         ,  max(
		               case when x.EXMN_CD = 'BL3018' and x.EXRS_FRMT_CD = 'N'
		                    then case when sign(to_number(x.NRML_LWLM_NCVL_VL) - to_number(x.EXRS_NCVL_VL)) = 1 then '▼'||x.EXRS_NCVL_VL
		                              when sign(to_number(x.EXRS_NCVL_VL) - to_number(x.NRML_UPLM_NCVL_VL)) = 1 then '▲'||x.EXRS_NCVL_VL
		                              else x.EXRS_NCVL_VL
		                          end
		                    else null
		                end
		               )
		            keep (dense_rank last order by decode(x.EXMN_CD, 'BL3018', 9, 1), X.ORDR_YMD, X.ORDR_SNO, x.RPRT_DT) as STR_5 /* BUN BL31200-BXXXXX 없음 */
		         ,  max(
		               case when (x.EXMN_CD = 'BL3019') or (x.EXMN_CD = 'BXXXXX') and x.EXRS_FRMT_CD = 'N'
		                    then case when sign(to_number(x.NRML_LWLM_NCVL_VL) - to_number(x.EXRS_NCVL_VL)) = 1 then '▼'||x.EXRS_NCVL_VL
		                              else case when sign(to_number(x.EXRS_NCVL_VL) - to_number(x.NRML_UPLM_NCVL_VL)) = 1 then '▲'||x.EXRS_NCVL_VL
		                                        else x.EXRS_NCVL_VL
		                                    end
		                          end
		                    else null
		                end
		               )
		            keep (dense_rank last order by decode(x.EXMN_CD, 'BL3019', 9, 'BL31200', 9, 1), X.ORDR_YMD, X.ORDR_SNO, x.RPRT_DT) as STR_6 /* CR */
		         ,  max(
		               case when x.EXMN_CD = 'BL3007' and x.EXRS_FRMT_CD = 'N'
		                    then case when sign(to_number(x.NRML_LWLM_NCVL_VL) - to_number(x.EXRS_NCVL_VL)) = 1 then '▼'||x.EXRS_NCVL_VL
		                              when sign(to_number(x.EXRS_NCVL_VL) - to_number(x.NRML_UPLM_NCVL_VL)) = 1 then '▲'||x.EXRS_NCVL_VL
		                              else x.EXRS_NCVL_VL
		                          end
		                    else null
		                end
		               )
		            keep (dense_rank last order by decode(x.EXMN_CD, 'BL3007', 9, 1), x.ORDR_YMD, x.ORDR_SNO, x.RPRT_DT) as STR_7 /* TBIL */
		         ,  max(
		               case when x.EXMN_CD = 'BL3012' and x.EXRS_FRMT_CD = 'N'
		                    then case when sign(to_number(x.NRML_LWLM_NCVL_VL) - to_number(x.EXRS_NCVL_VL)) = 1 then '▼'||x.EXRS_NCVL_VL
		                              when sign(to_number(x.EXRS_NCVL_VL) - to_number(x.NRML_UPLM_NCVL_VL)) = 1 then '▲'||x.EXRS_NCVL_VL
		                              else x.EXRS_NCVL_VL
		                          end
		                    else null
		                end
		               )
		            keep (dense_rank last order by decode(x.EXMN_CD, 'BL3012', 9, 1), x.ORDR_YMD, x.ORDR_SNO, x.RPRT_DT) as STR_8 /* AST */
		         ,  max(
		               case when x.EXMN_CD = 'BL3013' and x.EXRS_FRMT_CD = 'N'
		                    then case when sign(to_number(x.NRML_LWLM_NCVL_VL) - to_number(x.EXRS_NCVL_VL)) = 1 then '▼'||x.EXRS_NCVL_VL
		                              when sign(to_number(x.EXRS_NCVL_VL) - to_number(x.NRML_UPLM_NCVL_VL)) = 1 then '▲'||x.EXRS_NCVL_VL
		                              else x.EXRS_NCVL_VL
		                          end
		                    else null
		                end
		               )
		            keep (dense_rank last order by decode(x.EXMN_CD, 'BL3013', 9, 1), X.ORDR_YMD, X.ORDR_SNO, x.RPRT_DT) as STR_9 /* ALT */
		         ,  max(case when X.EXMN_CD in ('BL2000G1', 'BL2000G2', 'BL2011', 'BL2001', 'BL2013', 'BL2003', 'BL2006') then TO_CHAR(X.EXRM_RPTN_DT, 'YYYYMMDD') end) as EXRM_RPTN_DT_1 /* ORDR_YMD1  CBC */
		         ,  max(case when X.EXMN_CD in ('BL3007', 'BL3012', 'BL3013') then TO_CHAR(X.EXRM_RPTN_DT, 'YYYYMMDD') end)           as EXRM_RPTN_DT_1 /* ORDR_YMD2  T Bili BL3100, BL310101, BL3102 없음 */
		         ,  max(case when X.EXMN_CD in ('BL3018', 'BL3019') then TO_CHAR(X.EXRM_RPTN_DT, 'YYYYMMDD') end)                                          as EXRM_RPTN_DT_1 /* ORDR_YMD3  BUN Cr BL31200 없음*/
		      from  (
		              select  /*+ med_resulmt_s08$S01_소아항암기록용 검사결과 조회 */
		                      t1.PTNO                                                                                                 as PTNO
		                   ,  t1.ORDR_CD                                                                                              as ORDR_CD
		                   ,  max(t1.ORDR_YMD         ) keep (dense_rank last order by t1.ORDR_YMD)                                   as ORDR_YMD
		                   ,  max(t1.EXRM_RPTN_DT     ) keep (dense_rank last order by t1.ORDR_YMD, t1.EXRM_RPTN_DT)                  as EXRM_RPTN_DT
		                   ,  max(t1.ORDR_SNO         ) keep (dense_rank last order by t1.ORDR_YMD, t1.ORDR_SNO)                      as ORDR_SNO
		                   ,  max(t2.RPRT_DT          ) keep (dense_rank last order by t1.ORDR_YMD, t1.ORDR_SNO, t1.EXRM_RPTN_DT)     as RPRT_DT
		                   ,  t2.EXMN_CD                                                                                              as EXMN_CD
		                   ,  max(t2.EXRS_FRMT_CD     ) keep (dense_rank last order by t1.ORDR_YMD, t1.ORDR_SNO, t1.EXRM_RPTN_DT)     as EXRS_FRMT_CD
		                   ,  max(t2.NRML_LWLM_NCVL_VL) keep (dense_rank last order by t1.ORDR_YMD, t1.ORDR_SNO, t1.EXRM_RPTN_DT)     as NRML_LWLM_NCVL_VL
		                   ,  max(t2.EXRS_NCVL_VL     ) keep (dense_rank last order by t1.ORDR_YMD, t1.ORDR_SNO, t1.EXRM_RPTN_DT)     as EXRS_NCVL_VL
		                   ,  max(t2.NRML_UPLM_NCVL_VL) keep (dense_rank last order by t1.ORDR_YMD, t1.ORDR_SNO, t1.EXRM_RPTN_DT)     as NRML_UPLM_NCVL_VL
		                from  MDEXMORDT t1
		                   ,  SZRESULMT t2
		               where  t1.PTNO          = t2.PTNO
		                 and  t1.ORDR_YMD      = t2.ORDR_YMD
		                 and  t1.ORDR_SNO      = t2.ORDR_SNO
		                 and  t1.PTNO          = #{ptno}
		                 and  t1.EXRM_RPTN_DT  < trunc(to_date(#{ordrYmd}, 'yyyymmddhh24miss')) + 1
		                 and  t1.EXRM_RPTN_DT  > add_months(trunc(to_date(#{ordrYmd}, 'yyyymmddhh24miss')), -3)
		                 and  t1.ORDR_YMD      < trunc(to_date(#{ordrYmd}, 'yyyymmddhh24miss')) + 1
		                 and  t1.ORDR_YMD      > add_months(trunc(to_date(#{ordrYmd}, 'yyyymmddhh24miss')), -3)
		                 and  t1.EXOR_PRSS_CD            = 'G'
		                 and  nvl(t1.DC_DVSN_CD, 'N')   <> 'X'  -- 취소 제외
		                 and  nvl(t1.ORFR_CD, 'N')      <> 'P'  -- PRN 제외
		                 and  nvl(t1.TMPR_ORDR_YN, 'N')  =  'N'  -- 임시처방 제외
		                 and  nvl(t2.EXRS_UPDT_YN, 'N')  = 'N'
		                 and  t1.ORDR_CD in ( 'BL2000G1', 'BL2000G2', 'BL2000G3', 'BL2000G4', 'BL2000G5', 'BL2000G6', 'BL2000G7', 'BL2000G8'
		                                    , 'BL2105',                           'BL3001', 'BL3007', 'BL3012', 'BL3013'   /* BL3100, BL310101, BL3102 없음 */
		                                    , 'BL3018', 'BL3019'                                                                /* BL31200, BL7019, BL7020, BL7022, BL702202, BL7040 없음 */
		                                    )
		                 and  t2.EXMN_CD in ( 'BL2001', 'BL2003', 'BL2006', 'BL200817'            /* CBC */
		                                    , 'BL3018', 'BL3019'                                  /* BUN/CR BL31200 없음 */
		                                    , 'BL3007', 'BL3012', 'BL3013'  /* T-bil/AST/ALT BL310101, BL3102 없음 */
		                                    )
		               group
		                  by  T1.PTNO
		                   ,  T1.ORDR_CD
		                   ,  t2.EXMN_CD
		            ) x
		     group
		        by x.PTNO
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneMtfrMdtnInfmApfn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="cct" column="CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneMtfrMdtnInfmApfn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneMtfrMdtnInfmApfn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneMtfrMdtnInfmApfn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneMtfrMdtnInfmApfn-result" useCache="true" flushCache="false">
		<![CDATA[	
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneMtfrMdtnInfmApfn */
		        count(*) as cct
		  from MDDRGCNPT
		 where (ptno, DRUG_TKNG_DLMT_CD, RCRD_DT) in 
		(select
		        e.PTNO
		     ,  '1'
		     ,  e.FRST_RGST_DT
		  from
		        SDDATGRPT a
		     ,  SDMDISCRT b
		     ,  MDORDRCMT c
		     ,  MDCONSRCT d
		     ,  SDOCONSDT e
		 where  a.MDEF_CLSF_1_CD = '68'
		   and  a.MDEF_CLSF_2_CD = '20'
		   and  a.MDEF_CLSF_3_CD = '04'
		   and  a.MDEF_CLSF_5_CD <> '**********'
		   and  b.RPMD_ID = a.MDEF_CLSF_5_CD
		   and  c.ORDR_CD = b.MDPR_CD
		   and  d.PTNO = #{ptno}
		   and  d.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
		   and  d.ORDR_SNO = #{ordrSno}
		   and  d.CMTX_DVSN_CD = '7'
		   and  d.CMTX_STTS_CD = '4'
		   and  e.PTNO = d.PTNO
		   and  e.ORDR_YMD = d.ORDR_YMD
		   and  e.ORDR_SNO = d.ORDR_SNO
		   and  nvl(e.SBSN_MDPR_CD, e.MDPR_CD) = c.ORDR_CD )
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listOutDcYnTarget-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listOutDcYnTarget (원외처방 반납 후 dc 대상 조회) 
        Description :                                           원외처방 반납 후 dc 대상 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listOutDcYnTarget-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listOutDcYnTarget"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listOutDcYnTarget-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-listOutDcYnTarget */
		<![CDATA[
		select distinct 
		            t.PTNO
		          , to_char( t.ORDR_YMD , 'yyyymmdd')  ORDR_YMD
		          , t.ORDR_SNO
		     from
		           SDPORDDET t
		    where  t.ORDR_YMD = to_date( #{ordrYmd} , 'YYYYMMDD')
		      and  t.MDTN_NO_DVSN_CD = #{mdtnNoDvsnCd}
		      and  t.MDTN_NO = #{mdtnNo}
		      and  t.MDTN_LCDV_CD = decode( #{mdtnLcdvCd}, null, t.MDTN_LCDV_CD, 'A', t.MDTN_LCDV_CD, #{mdtnLcdvCd} )
		      and  t.SDPF_EXRE_CD is null
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneAntgMdtnInfmAplyFnsh-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO">
	
		<result property="cct" column="CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneAntgMdtnInfmAplyFnsh () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneAntgMdtnInfmAplyFnsh-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneAntgMdtnInfmAplyFnsh"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneAntgMdtnInfmAplyFnsh-result" useCache="true" flushCache="false">
		<![CDATA[
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-selectOneAntgMdtnInfmAplyFnsh */
		       count(*) as cct
		  from MDDRGCNPT
		 where (ptno, DRUG_TKNG_DLMT_CD, RCRD_DT) in 
				(select
						e.PTNO
					 ,  '2'
					 ,  e.FRST_RGST_DT
				  from
						SDDATGRPT a
					 ,  SDMDISCRT b
					 ,  MDORDRCMT c
					 ,  MDCONSRCT d
					 ,  SDOCONSDT e
				 where  a.MDEF_CLSF_1_CD = '20'
				   and  a.MDEF_CLSF_2_CD = '12'
				   and  a.MDEF_CLSF_5_CD <> '**********'
				   and  b.RPMD_ID = a.MDEF_CLSF_5_CD
				   and  c.ORDR_CD = b.MDPR_CD
				   and  d.PTNO = #{ptno}
				   and  d.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
				   and  d.ORDR_SNO = #{ordrSno}
				   and  d.CMTX_DVSN_CD = '7'
				   and  d.CMTX_STTS_CD = '4'
				   and  e.PTNO = d.PTNO
				   and  e.ORDR_YMD = d.ORDR_YMD
				   and  e.ORDR_SNO = d.ORDR_SNO
				   and  nvl(e.SBSN_MDPR_CD, e.MDPR_CD) = c.ORDR_CD
				   and  rownum < 2)
		]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateFluidPrss (출고 N 인 약품 강제 진도 5 처리) 
        Description :                                           출고 N 인 약품 강제 진도 5 처리
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateFluidPrss"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateFluidPrss */
		<![CDATA[
		  update mdmedordt t
		      set   DRUG_ORDR_PRSS_CD = '5'
		          , PHDP_PRIN_YN = 'Y'
		          , LAST_UPDT_SRVR_PRGM_ID = 'BATCH_UPD'
		   where ( t.ORDR_YMD , t.MDTN_LCDV_CD, t.MDTN_NO_DVSN_CD , t.MDTN_NO , t.ORDR_SNO, t.PTNO ) in 
		        (
		         select a.ORDR_YMD , a.MDTN_LCDV_CD, a.MDTN_NO_DVSN_CD , a.MDTN_NO , a.ORDR_SNO, a.PTNO 
		          from
		               sdporddet a
		             , sdddgcdmt b  
		             , sdpordbat m
		         where   
		               a.ORDR_YMD >= trunc( sysdate ) -1
		           and a.ORDR_YMD < trunc( sysdate ) + 1    
		           and CMMD_STTS_CD < '5'
		           and a.BSIS_CMMD_PLAC_CD not in ( '8','9','B', '7', 'A' )
		           and a.MDTN_NO_DVSN_CD in ('A'   )
		           and b.MDPR_CD = a.MDPR_Cd
		           and nvl( b.RELS_YN, 'N' ) = 'N'
		           and m.ORDR_YMD = a.ORDR_YMD
		           and m.MDTN_LCDV_CD = a.MDTN_LCDV_CD
		           and m.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		           and m.MDTN_NO = a.MDTN_NO
		           and m.PTNO||'' = a.PTNO   
		           and m.ORDR_DT  <  sysdate - 0.01
		           and not exists ( select 1
		                              from sdjdgrtnt j
		                             where 
		                                   j.ORDR_YMD = a.ORDR_YMD
		                               and j.MDTN_LCDV_CD = a.MDTN_LCDV_CD
		                               and j.MDTN_NO_DVSN_CD = a.MDTN_NO_DVSN_CD
		                               and j.MDTN_NO = a.MDTN_NO
		                               and j.ordr_sno = a.ordr_sno
		                               and j.PTNO||'' = a.PTNO    
		                            )
		            and not  exists (
		                  select 1
		                    from sdjfixqtt t
		                   where 
		                         t.DPRT_CD = nvl( a.INJC_PLAC_CD, m.ward_cd )
		                     and t.MDPR_CD = a.mdpr_cd
		                     and t.EQPT_FDNO_DVSN_CD ='2'
		                )
		        )
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatercpcAftDcPsblYn () 
        Description :                                           수납후DC가능여부 update
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatercpcAftDcPsblYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatercpcAftDcPsblYn */
		<![CDATA[
		update MDMEDORDT 
		   set RCPC_AFT_DC_PSBL_YN = #{rcpcAftDcPsblYn}   /* 수납후DC가능여부 */
		 where PTNO = #{ptno}
		   and ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		   and ORDR_SNO = #{ordrSno}
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertOrdrMstrMdprDetl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertOrdrMstrMdprDetl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-insertOrdrMstrMdprDetl */
		<![CDATA[
		insert 
		  into MDORDRCMT
		  (
		            ORDR_CD                      
		         ,  APST_YMD
		         ,  APFN_YMD
		         ,  MDPR_NM                      
				 ,  ORDR_NM                      
				 ,  UPRC_ORDR_NM
				 ,  ORCL_CD                 
		         ,  MEGR_CD                     
		         ,  KORN_PDCT_NM                 
		         ,  ENSN_PDCT_NM                 
		         ,  RSTC_CMPN_NM                 
		         ,  DGFR_CD                      
		         ,  TOTL_QTY_CLCL_CD             
		         ,  DVDN_DVSN_CD                 
		         ,  SDPF_EXRE_CD                 
		         ,  IHOH_DVSN_CD                 
		         ,  ORDR_PSBL_DVSN_CD            
		         ,  TIMS1_TOTL_QTY_YN            
		         ,  PRTN_DLFL_YN                 
		         ,  STST_DVSN_CD                 
		         ,  KIT_MDPR_DDCN                
		         ,  INGR_MNMM_CD                 
		         ,  ANTB_YN                      
		         ,  ACGR_CD                      
		         ,  INJT_MIX_CMMD_DVSN_CD        
		         ,  CNPL_CD                      
		         ,  MDPR_CLSF_CD                 
		         ,  ANTB_RPRS_INGR_CD            
		         ,  SLIP_CD                      
		         ,  SAME_DGFR_MNMM_INLS_QTY                     
		         ,  SAME_DGFR_MXMM_INLS_QTY                     
		         ,  FLUD_ORDR_YN                                               
				 ,  INVN_PCUN_CD                                                                              
				 ,  PCUN_INLS_QTY                                                                     
				 ,  ICUN_CD                                                                                             
				 ,  INGR_NM                                                                                             
				 ,  DRAP_DVSN_CD                                                                              
				 ,  PWDR_DSLW_YN                                                                              
				 ,  CLNC_EXAM_DRUG_YN                                              
				 ,  CLCL_MTHD_CD                                                                              
		         ,  ORDR_CLTY_CD                 
				 ,  CIV_VLM
		         ,  CIV_TRGT_YN
		         ,  FRST_RGSR_ID                                
				 ,  FRST_RGST_IP                                
				 ,  FRST_RGST_DT                                
				 ,  FRST_RGST_CLNT_PRGM_ID                      
				 ,  FRST_RGST_SRVR_PRGM_ID                      
				 ,  LAST_UPDR_ID                                
				 ,  LAST_UPDT_IP                                
				 ,  LAST_UPDT_DT                                
				 ,  LAST_UPDT_CLNT_PRGM_ID                      
				 ,  LAST_UPDT_SRVR_PRGM_ID                      
		   )
			 values
			 (
		            #{mdprCd}
		         ,  nvl(#{apstYmd},sysdate)
		         ,  to_date(nvl(#{apfnYmd},'29991231'),'yyyymmdd')
		         ,  #{mdprNm}                                                                                                                     
		         ,  #{mdprNm}                                                                                                                     
		         ,  upper( #{ensnPdctNm} )
		         ,  decode(#{drapDvsnCd}, '2', 'IJ1', 'DG1')                                                                                                           
		         ,  #{megrCd}                                                                                                                     
		         ,  #{kornPdctNm}                                                                                                                 
		         ,  #{ensnPdctNm}                                                                                                                 
		         ,  #{rstcCmpnNm}                                                                                                                 
		         ,  #{dgfrCd}                                                                                                                     
		         ,  #{totlQtyClclCd}                                                                                                              
		         ,  #{dvdnDvsnCd}                                                                                                                 
		         ,  #{sdpfExreCd}                                                                                                                 
		         ,  #{ihohDvsnCd}                                                                                                                 
		         ,  #{ordrPsblDvsnCd}                                                                                                             
		         ,  #{tims1TotlQtyYn}                                                                                                             
		         ,  #{prtnDlflYn}                                                                                                                 
		         ,  decode(#{mdprClsfDetlCd}, '01','1','02','2','03','3','04','4','05','7',                                                       
		                                      '06','B','07','','08','','09','','10','5',                                                          
		                                      '11','9','12','F','13','6','14','C')                                                                 
		         ,   decode(#{afiKitMdprDdcnStr},null,null,to_number(#{afiKitMdprDdcnStr}))                                                       
		         ,   #{ingrMnmmCd}                                                                                                                
		         ,   #{antbYn}                                                                                                                    
		         ,   #{acgrCd}                                                                                                                    
		         ,   #{injtMixCmmdDvsnCd}                                                                                                         
		         ,   #{cnplCd}                                                                                                                    
		         ,   decode(#{mdprClsfDetlCd},'07','8','08','7','09','6',                                                                         
		                    decode(#{mdprClsfCd},'1','1','2','2','3','3','1' ))                                                                       
		         ,   #{antbRprsIngrCd}                                                                                                            
		         ,   decode(#{mdprClsfDetlCd}, '10', 'D11', '11', 'D12',                                                                          
		                    decode(#{drapDvsnCd}, '1', 'D21', '2', 'D12', '3', 'D31', 'D91'))                                                     
		         ,   decode(#{afiIngrMnmmQtyStr},null,null,to_number(#{afiIngrMnmmQtyStr}))  /* 동일제형최소포함량*/                              
		         ,   decode(#{afiIngrMxmmQtyStr},null,null,to_number(#{afiIngrMxmmQtyStr}))  /* 동일제형최대포함량*/                              
		         ,   #{totlQtyBaseInptYn}                                                    /* 수액처방여부*/                                    
		         ,   #{invnPcunCd}					                                                  /* 재고포장단위코드 */                               
		         ,   #{afiPcunInlsQtyStr}		                                                /* 포장단위포함량 */                                 
		         ,   #{icunCd}					                                                      /* 함량단위코드 */                                   
		         ,   #{ingrNm}					                                                      /* 성분명 */                                         
		         ,   #{drapDvsnCd}					                                                  /* 약적용구분코드 */                                 
		         ,   #{pwdrDslwYn}					                                                  /* 산제불가여부 */                                   
		         ,   case when#{dgmtRgstTypeCd} ='2' then 'Y' end	                          /* 임상시험약여부 */                                 
		         ,   #{clclMthdCd}					                                                  /* 계산방법코드 */                                   
		         ,   decode(#{drapDvsnCd}, '1', 'B2', '2', 'B1', '3', 'B3', '9', 'B9')       /* B1(주사) , B2(내복약), B3(외용약), B9(기타)  */   
		         ,   #{civVlm}					                                                  /* CIV용량 */                                   
		         ,   #{civTrgtYn}					                                                  /* CIV용량 */                                   
		         ,   #{gvUserId}                                                             /*  최초등록자ID             */                      
		         ,   #{gvUserIp}                                                             /*  최초등록IP              */                       
		         ,   sysdate                                                                 /*  최초등록일시              */                     
		         ,   #{gvClntPrgmId}                                                         /*  최초등록SMC클라이언트프로그램ID */               
		         ,   #{gvSrvrPrgmId}                                                         /*  최초등록SMC서버프로그램ID     */                 
		         ,   #{gvUserId}                                                             /*  최종수정자ID              */                     
		         ,   #{gvUserIp}                                                             /*  최종수정IP               */                      
		         ,   sysdate                                                                 /*  최종수정일시               */                    
		         ,   #{gvClntPrgmId}                                                         /*  최종수정SMC클라이언트프로그램ID  */              
		         ,   #{gvSrvrPrgmId}                                                         /*  최종수정SMC서버프로그램ID     */                 
			 )
			]]>                                                                                                                 
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgPnRealInfm () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgPnRealInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updatePnMntgPnRealInfm */
		<![CDATA[
		    update  /*+ mdd_sdtpnor_u09$U01_PN모니터링 조제확정정보 수정 */
		           MDTPNORDT
		      set
		            PN_REAL_ADMN_SPED_VL   = #{pnRealAdmnSpedVl}        /* PN 실제 투여속도     */
		         ,  PN_REAL_ADMN_HH_VL     = #{pnRealAdmnHhVl}          /* PN 실제 투여시간     */
		         ,  LPID_REAL_ADMN_SPED_VL = #{lpidRealAdmnSpedVl}      /* 약사 커멘트          */
		         ,  LPID_REAL_ADMN_HH_VL   = #{lpidRealAdmnHhVl}        /* 약사 커멘트          */
		         ,  LAST_UPDR_ID = LAST_UPDR_ID
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}  
		    where
		           PTNO = #{ptno}                                    /* 환자번호             */
		      and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')        /* 처방일자             */
		      and  ORDR_SNO = #{ordrSno}
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrMstrMdprDetl01 (항암제그룹코드 업데이트) 
        Description :                                           항암제그룹코드 업데이트
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrMstrMdprDetl01"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		    update  MDORDRCMT
		           /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrMstrMdprDetl01 */
		            /*+ mdd_sdmdord_u01$U01_약품상세 처방마스터 update */  
		       set
		            ACGR_CD      = #{acgrCd}
		         ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		    where  ORDR_CD = #{ordrCd}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrMstrMdprDetl02 (CIV 정보 업데이트) 
        Description :                                           CIV 정보 업데이트
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrMstrMdprDetl02"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPhrmDrugOrdrPrsgDVO"  >
		    update  MDORDRCMT
		           /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPhrmDrugOrdrPrsgDAO-updateOrdrMstrMdprDetl02 */
		            /*+ mdd_sdmdord_u01$U01_약품상세 처방마스터 update */  
		       set  CIV_TRGT_YN  = #{civTrgtYn}
		         ,  CIV_VLM      = #{civVlm}
		         ,  LAST_UPDR_ID = #{gvUserId}
		         ,  LAST_UPDT_IP = #{gvUserIp}
		         ,  LAST_UPDT_DT = sysdate
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		    where  ORDR_CD = #{ordrCd}
	</update>

</mapper>