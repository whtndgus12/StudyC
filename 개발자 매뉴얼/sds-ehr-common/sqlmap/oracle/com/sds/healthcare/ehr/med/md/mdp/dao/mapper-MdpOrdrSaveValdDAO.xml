<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_MdpOrdrSaveValdDAO_sql.xml 
    Description :                                      처방저장유효DAO
                  -->
<mapper namespace="MdpOrdrSaveValdDAO">


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrYn (대상처방여부조회) 
        Description :                                           대상처방여부조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrYn */
		        decode(count(1), 0, 'N', 'Y') as YN
		  from
		        MZCTRLMMT
		 where
		        MDCR_CTRL_CD = #{mdcrCtrlCd}
		   and  MDCR_DTLS_CTRL_CD = #{ordrCd}
		   and  to_date(#{ordrYmd}, 'YYYYMMDD') between APST_YMD and APFN_YMD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAlbnExmnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAlbnExmnYn (알부민검사여부) 
        Description :                                           알부민검사여부를 얻는다. doChckdoChck008
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAlbnExmnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAlbnExmnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAlbnExmnYn-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAlbnExmnYn */
		       decode(count(*), 0, 'Y', 'N') as YN
		  from
		     (
		       select
		              EXCD
		         from
		            (
		              select
		                     nvl(b.EXMN_CD, a.ORDR_CD) EXCD
		                from
		                     MDEXMORDT a
		                   , SZSETEXMT b
		               where
		                     a.PTNO = #{ptno}
		                 and a.ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd') - 3
		                                    and to_date(#{ordrYmd}, 'yyyymmdd')
		                 and a.DC_DVSN_CD = 'N'
		<![CDATA[
		                 and nvl(a.EXOR_PRSS_CD, 'A') >= 'C'
		]]>
		                 and b.SET_EXOR_CD(+)       = a.ORDR_CD
		                 and b.EXMN_CD(+)           = 'BL3002' 
		                 /* and {orocCd} in ('O', 'H') */
		            )
		        where
		              EXCD   = 'BL3002'
		          and rownum = 1
		        union  all
		       select
		              EXCD
		         from
		            (
		              select
		                     nvl(b.EXMN_CD, a.ORDR_CD) EXCD
		                from
		                     MDEXMORDT a
		                   , SZSETEXMT b
		               where
		                     a.PTNO = #{ptno}
		                 and a.ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd') - 1
		                                    and to_date(#{ordrYmd}, 'yyyymmdd')
		                 and a.DC_DVSN_CD = 'N'
		                 and b.SET_EXOR_CD(+)       = a.ORDR_CD
		                 and b.EXMN_CD(+)           = 'BL3002'
		                 /* and {orocCd} in ('O', 'H') */
		            )
		        where
		              EXCD   = 'BL3112'
		          and rownum = 1
		     )
		 where
		       rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAscsApdcYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="rsltVl" column="RSLT_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAscsApdcYn (산정특례신청서여부조회) 
        Description :                                           산정특례신청서여부조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAscsApdcYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAscsApdcYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAscsApdcYn-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAscsApdcYn */
		       FN_AC_CHECK_APQLQLDLT_R (   
		       #{ptno}  
		     , #{istyCd}   
		     , #{mainScinCd}   
		     , 'A'   
		     , #{mcdpCd}   
		     , '00' ) as RSLT_VL
		  from dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKtasLvel-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKtasLvel (환자KTAS레벨 조회) 
        Description :                                           환자KTAS레벨 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKtasLvel-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKtasLvel"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKtasLvel-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKtasLvel */
		        decode(count(*), 0, 'N', 'Y') as YN
		  from 
		        MNEERRPAT a  /* 응급환자정보조사 */ 
		 where 
		        a.MDRP_NO = #{mdrpNo}
		   and  ( case when a.FRST_KTAS_SQNC in (1, 2, 3) then 'T' 
		               when a.LAST_KTAS_SQNC in (1, 2, 3) then 'T' 
		               else 'F' end ) = 'T' 
		   and  exists 
		        ( 
		        select  1 
		          from  MNEERHIST b  /* 응급환자정보조사이력 */ 
		         where  b.MDRP_NO      = a.MDRP_NO 
		           and  b.DCLR_SCKB_YN = 'Y' 
		        )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRhblOrdrInsrDdcn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrDdcn" column="ORDR_DDCN"/>
		<result property="excsDdcn" column="EXCS_DDCN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRhblOrdrInsrDdcn (재활처방보험일수조회) 
        Description :                                           재활처방보험일수조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRhblOrdrInsrDdcn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRhblOrdrInsrDdcn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRhblOrdrInsrDdcn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRhblOrdrInsrDdcn */
		        nvl(sum(days), 0) as ORDR_DDCN
		     ,  60 - nvl(sum(days), 0) as EXCS_DDCN
		  from  (
		        select
		                PTNO
		             ,  ORDR_YMD
		             ,  decode(nvl(DDCN, 0), 0, 1, DDCN) days
		             ,  ORDR_SNO
		          from
		                MDMEDORDT a
		         where
		                PTNO    = #{ptno}
		           and  ORDR_CD = #{ordrCd}
		           and  NTM * DDCN             != nvl(PHRM_RTRN_QTY, 0)
		           and  nvl(ORDR_IPDV_CD, '1')  = '1'
		           and  nvl(RCST_CD     , 'N') != 'R'
		           and  DC_DVSN_CD    = 'N'
		           and  TMPR_ORDR_YN  = 'N'
		           and  ORDR_YMD    <![CDATA[ >= ]]> trunc( sysdate - 365 )
		        )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBoneDensExmnYmd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
		<result property="rsltVl" column="RSLT_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBoneDensExmnYmd (골밀도검사희망일자확인) 
        Description :                                           골밀도검사희망일자확인
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBoneDensExmnYmd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBoneDensExmnYmd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBoneDensExmnYmd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBoneDensExmnYmd */
		<![CDATA[
		SELECT  
		           CASE WHEN TRUNC(MAX(A.ENFR_DT))+366 > TO_DATE(substr(#{wntdDt},1,8),'YYYYMMDD') THEN 'Y'
		                ELSE 'N'
		           END AS YN    
		          ,  to_char(trunc(max(a.ENFR_DT)) + 366, 'YYYYMMDD') as RSLT_VL
		  FROM
		        MDEXMORDT A   
		 WHERE 1=1
		   AND A.PTNO =#{ptno} 
		   AND A.ENFR_DT      >= TRUNC(SYSDATE) - 366
		   AND NVL(A.DC_DVSN_CD,'N') = 'N'
		   AND NVL(A.TMPR_ORDR_YN,'N')= 'N'
		   AND EXISTS (SELECT 1
		                 FROM AIMFMDFET
		                WHERE MDFE_CD = A.ORDR_CD 
		                  AND A.ORDR_YMD BETWEEN APST_YMD AND APFN_YMD
		                  AND INSR_EDI_CD IN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD = 'MDK_0042' AND TRUNC(SYSDATE) BETWEEN APST_YMD AND APFN_YMD)                                             
		               )
		]]>               
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFesImplNtm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFesImplNtm (FES실시횟수조회) 
        Description :                                           FES실시횟수조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFesImplNtm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFesImplNtm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFesImplNtm-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFesImplNtm */
		        count(*) as TOTL_CCT
		  from   
		        SHREHTDMT a
		     ,  (
		        select  regexp_substr(x.VAL, '[^,]+', 1, LEVEL) as VAL
		          from  (
		                select  ORCT_ITEM_CTN as VAL
		                  from  MDPORCTIT
		                 where  ORCT_CD = '#S00000397'
		                   and  ORCT_ITEM_CD = 'ordrCd'
		                   and  rownum = 1
		                ) x
		       connect  by
		<![CDATA[
		                LEVEL <= length(regexp_replace(x.VAL, '[^,]+', '')) + 1
		]]>
		        ) t
		 where   
		        a.PTNO     = #{ptno}
		<![CDATA[
		   and  a.ENFR_DT >= trunc(sysdate) - 365    
		]]>
		   and  a.MDTE_ITEM_CD = t.VAL
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErrmChotDt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="cohsDt" column="COHS_DT"/>
		<result property="arvlDt" column="ARVL_DT"/>
		<result property="errmLctnCd" column="ERRM_LCTN_CD"/>
		<result property="chotDt" column="CHOT_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErrmChotDt (응급실퇴실일시 조회) 
        Description :                                           응급실퇴실일시 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErrmChotDt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErrmChotDt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErrmChotDt-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErrmChotDt */
		        a.PTNO
		     ,  to_char(a.COHS_DT, 'YYYYMMDDHH24MISS') as COHS_DT
		     ,  to_char(a.ARVL_DT, 'YYYYMMDDHH24MISS') as ARVL_DT
		     ,  a.ERRM_LCTN_CD
		     ,  to_char(a.CHOT_DT, 'YYYYMMDDHH24MISS') as CHOT_DT
		  from
		        MNEERRPAT a
		     ,  APRCRPTNT b
		 where
		        a.MDRP_NO  = #{mdrpNo}
		   and  b.PTNO     = a.PTNO
		   and  b.MDRP_NO  = a.MDRP_NO
		   and  b.CODV_CD  = 'E'
		   and  rownum     = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstCct (NST처방횟수 조회(6개월)) 
        Description :                                           NST처방횟수 조회(6개월)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstCct-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstCct */
		        count(*) as TOTL_CCT
		     ,  decode(count(*), 0, 'Y', 'N') as YN
		  from  (
		        select
		                a.ORDR_CD
		             ,  c.ORDR_NM
		             ,  a.ORDR_YMD
		          from
		                MDTRTORDT a
		             ,  MDORDRCMT c
		         where
		                a.PTNO         = #{ptno}
		           and  a.ORDR_YMD between trunc(sysdate) - to_number(nvl(180, '0'))  and trunc(sysdate)
		           and  a.ORDR_CD      = #{ordrCd}
		           and  a.DC_DVSN_CD   = 'N'
		<![CDATA[
		           and  a.ORDR_NTM_QTY > 0
		]]>
		           and  c.ORDR_CD      = a.ORDR_CD
		         union  all
		        select
		                a.ORDR_CD
		             ,  c.ORDR_NM
		             ,  a.ORDR_YMD
		          from
		                MDTRTORDT a
		             ,  MNZTRTRET b
		             ,  MDORDRCMT c
		         where
		                a.PTNO         = #{ptno}
		           and  a.ORDR_YMD between trunc(sysdate) - to_number(nvl(180, '0'))  and trunc(sysdate)
		           and  a.ORDR_CD      = #{ordrCd}
		           and  a.DC_DVSN_CD   = 'N'
		<![CDATA[
		           and  a.ORDR_NTM_QTY > 0
		           and  b.PTNO         = a.PTNO
		           and  b.ORDR_YMD     = a.ORDR_YMD
		           and  b.ORDR_SNO     = a.ORDR_SNO
		           and  b.RTRN_NTM_QTY > 0
		           and  b.RTRN_NTM_QTY > a.ORDR_NTM_QTY
		           and  c.ORDR_CD      = a.ORDR_CD
		]]>
		        )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePaliCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePaliCct (시나지스처방횟수 조회) 
        Description :                                           시나치스처방횟수 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePaliCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePaliCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePaliCct-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePaliCct */
		        to_char(ORDR_YMD, 'YYYYMMDD') as ORDR_YMD
		     ,  sum(nvl(a.NTM, 0)) as TOTL_CCT
		  from
		         MDMEDORDT a
		       , SDDDGCDMT b
		 where a.ORDR_CD = b.MDPR_CD
		   and  a.PTNO      = #{ptno}
		--   and  a.ORDR_CD  in ('XPALI', 'XPALI10')
		   and  b.RPMD_ID in (select ORCT_ITEM_CTN
		                        from MDPORCTIT
		                       where ORCT_ITEM_CD = 'rpmdId'
		                         and ORCT_CD = '#S00000391') /* 성분명 : Palivizumab, 성분코드로 체크하도록 변경 2020.02.12 obh */
		   and  a.ORDR_YMD <![CDATA[ >= ]]> to_date(decode(sign( trunc(sysdate) - to_date(to_char( trunc(sysdate), 'yyyy' ) || '0901' , 'yyyymmdd'))
		                              , -1
		                              , to_char( trunc(sysdate)-365, 'yyyy' )||'0901'
		                              , to_char( trunc(sysdate)    , 'yyyy' )||'0901'
		                              ),'yyyymmdd')
		<![CDATA[
		   and  nvl(a.PHRM_RTRN_QTY,  0 ) <=  0
		]]>
		   and  nvl(a.RCST_CD      , 'N') != 'R'
		   and  a.DC_DVSN_CD   = 'N'
		   and  a.TMPR_ORDR_YN = 'N'
		 group
		    by ORDR_YMD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckSpcmCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckSpcmCd (검체검사 수가 확인) 
        Description :                                           검체검사 수가 확인
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckSpcmCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckSpcmCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckSpcmCd-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckSpcmCd */
		        'Y'  as YN
		  from  
		        AIMFMDFET a       
		 where  
		        a.MDFE_CD   = #{ordrCd} || #{spcmCd2}
		   and  a.APFN_YMD &gt;= trunc(sysdate)
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDgmtRgstTypeCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDgmtRgstTypeCd (약제등록유형코드 확인) 
        Description :                                           약제등록유형코드가 3인지 확인
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDgmtRgstTypeCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDgmtRgstTypeCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDgmtRgstTypeCd-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDgmtRgstTypeCd */
		        decode(DGMT_RGST_TYPE_CD, '3', 'Y', 'N') YN
		  from
		        SDDDGCDMT
		 where
		        MDPR_CD = #{ordrCd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrstCancVltnTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrstCancVltnTrgtYn (유방암적정성평가대상여부) 
        Description :                                           유방암적정성평가대상여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrstCancVltnTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrstCancVltnTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrstCancVltnTrgtYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrstCancVltnTrgtYn */
		        'Y' as YN
		  from
		        MDPRPRPAT
		 where
		        PTNO          = #{ptno}
		   and  VLTN_KIND_CD  = 'BC'
		   and  CNCL_DT      is null
		   and  FNSH_DT      is null
		   and  rownum        = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBmdExmnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBmdExmnYn (BMD검사여부 조회) 
        Description :                                           BMD검사여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBmdExmnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBmdExmnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBmdExmnYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBmdExmnYn */
		        'Y' as YN
		  from
		        MDEXMORDT a
		      , AIMFMDFET b
		 where
		        PTNO    = #{ptno}
		   and  a.ORDR_CD = b.MDFE_CD
		--   and  ORDR_CD = 'RG9214'
		   and  b.INSR_EDI_CD = #{insrEdiCd}
		   and  ORDR_YMD between trunc(sysdate) - 365
		                     and trunc(sysdate)
		   and  DC_DVSN_CD = 'N'
		   and  rownum     = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnOrdrCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnOrdrCct (TPN조성처방개수 조회) 
        Description :                                           TPN조성처방개수 조회 0 = Y, 그 이외 = N
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnOrdrCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnOrdrCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnOrdrCct-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnOrdrCct */
		        decode(count(TPN_ORDR_CD), 0, 'Y', 'N') as YN
		  from 
		        MDTPNORDT   
		 where 
		        PTNO        = #{ptno}
		   and  ORDR_YMD    = to_date(#{ordrYmd}, 'YYYYMMDD')   
		   and  TPN_ORDR_CD = #{ordrCd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct (NST자문의뢰 건수조회) 
        Description :                                           NST자문의뢰 건수조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct */
		        sum(cnt) as TOTL_CCT
		  from  (
		        select  decode(count(*), 0, 0, 2) cnt
		          from  MDNSTPABT a
		         where  a.PTNO     = #{ptno}
		           and  a.REFR_YMD &gt; trunc(sysdate) - 28
		           and  a.NSTM_ACCS_PATH_CD in ('2', '4')
		         union  all
		        select  decode(count(*), 0, 0, 1) cnt
		          from  MDMEDORDT a
		         where  a.PTNO         = #{ptno}
		           and  a.ORDR_CD     in
		                (
		                select  regexp_substr(X.VAL, '[^,]+', 1, LEVEL) as VAL
		                  from  (
		                        select  ORCT_ITEM_CTN as VAL
		                          from  MDPORCTIT
		                         where  ORCT_CD = '#S00000510'
		                           and  ORCT_ITEM_CD = 'ordrCd'
		                           and  rownum = 1
		                        ) X
		                connect  by
		<![CDATA[
		                         LEVEL <= length(regexp_replace(X.VAL, '[^,]+', '')) + 1
		]]>
		                )
		           and  a.DC_DVSN_CD   = 'N'
		           and  a.TMPR_ORDR_YN = 'N'
		<![CDATA[
		           and  a.ORDR_YMD     > trunc(sysdate) - 7
		]]>
		     )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct2-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct2 (NST자문의뢰 건수조회2) 
        Description :                                           NST자문의뢰 건수조회2
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct2-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct2"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct2-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneNstRqstCct2 */
		        sum(cnt) as TOTL_CCT
		  from  (
		        select  decode(count(*), 0, 0, 2) cnt
		          from  MDNSTPABT a
		         where  a.PTNO     = #{ptno}
		           and  a.REFR_YMD &gt; trunc(sysdate) - 28
		 <choose>
		   <when test='ordrCd = "NUT-S"'>
		           and  a.NSTM_ACCS_PATH_CD in ('1', '3')
		   </when>
		   <otherwise>
		           and  a.NTSM_ACCS_PATH_CD in ('1', '4', '5')
		   </otherwise>
		 </choose>
		         union  all
		        select  decode(count(*), 0, 0, 1) cnt
		          from  MDMEDORDT a
		         where  a.PTNO         = #{ptno}
		           and  a.ORDR_CD      = #{ordrCd}
		           and  a.DC_DVSN_CD   = 'N'
		           and  a.TMPR_ORDR_YN = 'N'
		<![CDATA[           
		           and  a.ORDR_YMD     > trunc(sysdate) - 7
		]]>
		     )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEgfrRslt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="exrsNcvlVl" column="EXRS_NCVL_VL"/>
		<result property="exrsUnitNm" column="EXRS_UNIT_NM"/>
		<result property="rprtDt" column="RPRT_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEgfrRslt (EGFR검사결과 조회) 
        Description :                                           EGFR검사결과 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEgfrRslt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEgfrRslt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEgfrRslt-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEgfrRslt */
		        to_char(EXRS_NCVL_VL) as EXRS_NCVL_VL
		     ,  EXRS_UNIT_NM as EXRS_UNIT_NM
		     ,  to_char(RPRT_DT, 'yyyy-mm-dd') as RPRT_DT
		  from  (
		        select
		               EXMN_CD
		             , EXRS_NCVL_VL
		             , EXRS_UNIT_NM
		             , RPRT_DT
		          from  (
		                select
		                       a.EXMN_CD
		                     , a.EXRS_NCVL_VL
		                     , a.EXRS_UNIT_NM
		                     , a.RPRT_DT
		                  from
		                       SZRESULMT a
		                 where
		                       a.PTNO          = #{ptno}
		<![CDATA[                       
		                   and a.RPRT_DT      >= to_date(#{ordrYmd}, 'yyyymmdd') - 93
		]]>
		                   and a.EXCF_CD       = 'SL'
		                   and a.EXMN_CD       = 'BL312002'
		                   and a.EXMN_PRSS_CD  = 'G'
		                   and a.EXRS_NCVL_VL is not null
		                 order
		                    by a.RPRT_DT desc
		                )
		         where rownum = 1
		        )
		<![CDATA[
		 where  to_number(EXRS_NCVL_VL) < 60
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRdtnExorYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRdtnExorYn (최근1년 방사성동위원소처방여부 체크) 
        Description :                                           최근1년 방사성동위원소처방여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRdtnExorYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRdtnExorYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRdtnExorYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRdtnExorYn */
		        'Y' as YN
		  from
		        MDEXMORDT a
		     ,  MZCTRLMMT b
		 where
		        a.PTNO = #{ptno}
		   and  a.ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd') - 365
		                       and to_date(#{ordrYmd}, 'yyyymmdd')
		   and  a.EXCF_CD            = 'SV'
		   and  a.DC_DVSN_CD         = 'N'
		   and  b.MDCR_CTRL_CD       = 'MM981'
		   and  b.MDCR_CTRL_CHRC_VL1 = 'SV'
		   and  a.ORDR_CD            = b.MDCR_DTLS_CTRL_CD
		   and  rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtExorYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtExorYn (CT검사처방여부 조회) 
        Description :                                           CT검사처방여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtExorYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtExorYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtExorYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtExorYn */
		        YN
		  from  (
		        select
		                'Y' YN
		          from
		               MDEXMORDT a
		             , AIMFMDFET b
		         where
		               a.PTNO   = #{ptno}
		           and a.ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd') - 365
		                              and to_date(#{ordrYmd}, 'yyyymmdd')
		           and a.EXCF_CD              = 'SR'
		           and a.ORDR_CD           LIKE 'RC%'
		           and nvl(a.DC_DVSN_CD, 'N') = 'N'
		           and b.MDFE_CD              = a.ORDR_CD
		           and a.ORDR_YMD between b.APST_YMD
		                              and b.APFN_YMD
		           and b.MDPR_UICM_TABO_CD    = '1'
		           and rownum = 1
		         union
		        select
		               'Y' YN
		          from
		               MDEXMORDT a
		             , MZCTRLMMT b
		         where
		               a.PTNO = #{ptno}
		           and a.ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd') - 365
		                              and to_date(#{ordrYmd}, 'yyyymmdd')
		           and a.EXCF_CD            = 'SR'
		           and a.DC_DVSN_CD         = 'N'
		           and b.MDCR_CTRL_CD       = 'MM981'
		           and b.MDCR_CTRL_CHRC_VL1 = 'SR'
		           and a.ORDR_CD            = b.MDCR_DTLS_CTRL_CD
		           and rownum = 1
		     )
		 where rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKpngSpcmExptYmd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="kpngSpcmDiscDt" column="KPNG_SPCM_DISC_DT"/>
		<result property="ordrCd" column="ORDR_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKpngSpcmExptYmd (보관검체만료일자 조회) 
        Description :                                           보관검체만료일자 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKpngSpcmExptYmd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKpngSpcmExptYmd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKpngSpcmExptYmd-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneKpngSpcmExptYmd */
		        (select  to_char(KPNG_SPCM_DISC_DT, 'yyyymmdd')   
		           from  SLBBRESVT   
		          where  PTNO = #{ptno}) as KPNG_SPCM_DISC_DT
		     ,  (select  listagg(MDCR_DTLS_CTRL_CD, '|') within group (order by MDCR_DTLS_CTRL_CD) as ORDR_CD
		           from  MZCTRLMMT
		          where  MDCR_CTRL_CD = 'MDP_027') as ORDR_CD      
		  from dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfOrdrYn (최근3개월 와파린 처방건수 조회) 
        Description :                                           최근3개월 와파린 처방건수 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfOrdrYn */
		        case when count(*) > 0 then 'Y' else 'N' end as YN
		  from
		        MDMEDORDT
		 where
		        PTNO          = #{ptno}
		   and  ORDR_CD      in (select MDCR_DTLS_CTRL_CD from MZCTRLMMT where MDCR_CTRL_CD = 'MDP_021')
		   and  DC_DVSN_CD    = 'N'
		   and  TMPR_ORDR_YN  = 'N'
		   and  ORDR_YMD     >= trunc(sysdate) - 90
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadWarfOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadWarfOrdrYn (원외 항응고제 처방여부 조회) 
        Description :                                           원외 항응고제 처방여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadWarfOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadWarfOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadWarfOrdrYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadWarfOrdrYn */
		        DRUG_TKNG_YN as YN
		  from
		        MDDRGCNPT a
		 where
		        a.PTNO    = #{ptno}
		   and  a.DRUG_TKNG_DLMT_CD  = '2'	/* 항응고제 */
		   and  a.APFN_DT is null
		   and  a.DLTN_DT is null
		   and  rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfAspOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="codvNm" column="CODV_NM"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ntm" column="NTM"/>
		<result property="ddcn" column="DDCN"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfAspOrdrYn (아스피린/와파린 복용여부 조회) 
        Description :                                           아스피린/와파린 복용여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfAspOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfAspOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfAspOrdrYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWarfAspOrdrYn */
		        (
		        select
		               nvl(b.DETL_CD_NM, a.DETL_CD_NM)
		          from
		               CCCMCDDMT a
		             , CCCMCDDLT b
		         where
		               a.COMN_GRP_CD    = b.COMN_GRP_CD(+)
		           and a.COMN_DTLS_CD   = b.COMN_DTLS_CD(+)
		           and a.COMN_GRP_CD    = 'MM262'
		           and a.COMN_DTLS_CD   = c.CODV_CD
		           and b.LNGG_CD(+)     = nvl('', '*')
		        ) as CODV_NM
		     ,  to_char(ORDR_YMD,'YYYYMMDD') as ORDR_YMD
		     ,  MCDP_CD
		     ,  WARD_CD
		     ,  ORDR_CD
		     ,  NTM
		     ,  DDCN
		     ,  DRUS_CD
		     ,  (
		          select
		                 ORDR_NM
		            from
		                 MDORDRCMT
		           where
		                 ORDR_CD = c.ORDR_CD
		        ) as ORDR_NM
		  from
		        MDMEDORDT c
		 where
		        PTNO           = #{ptno}
		   and  ORDR_CD       in
		   (
		      'ASP5'
		   ,  'ASPC'
		   ,  'ASPP'
		   ,  'XASP'
		   ,  'ASPM'
		   ,  'CLOPI'
		   ,  'SARPO'
		   ,  'CILO'
		   ,  'WARF'
		   ,  'WARF5'
		 <choose>
		   <when test='ordrCd == "BU1032" or ordrCd == "BU1040"'>
		   ,  'ASP'
		   ,  'ASPA-R'
		   ,  'ASPCLO'
		   ,  'ASPCP'
		   ,  'ASPE'
		   ,  'ASPM'
		   ,  'ASPM5'
		   ,  'CLOPID'
		   ,  'GINK'
		   ,  'GINK8'
		   ,  'CILO1'
		   </when>
		   <otherwise>
		   ,  'ANAG'
		   ,  'SULO2'
		   ,  'TICL1'
		   ,  'TICL'
		   ,  'TFLU'
		   </otherwise>
		 </choose>
		   )
		<![CDATA[
		   and  ORDR_YMD >= to_date(#{ordrYmd}, 'YYYYMMDD') - 365
		   and  ORDR_YMD <= to_date(#{ordrYmd}, 'YYYYMMDD')
		]]>
		   and  DC_DVSN_CD in ('Y', 'N')
		   and  TMPR_ORDR_YN = 'N'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadMtfrOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadMtfrOrdrYn (타원메포민처방이력 조회) 
        Description :                                           타원메포민처방이력 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadMtfrOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadMtfrOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadMtfrOrdrYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOhadMtfrOrdrYn */
		        DRUG_TKNG_YN as YN
		  from  
		        MDDRGCNPT a
		 where  
		        a.PTNO               = #{ptno}
		   and  a.DRUG_TKNG_DLMT_CD  = '1'
		   and  a.APFN_DT           is null
		   and  a.DLTN_DT           is null
		   and  rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneClrsPrjcInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneClrsPrjcInfm (임상연구정보 조회) 
        Description :                                           임상연구정보 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneClrsPrjcInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneClrsPrjcInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneClrsPrjcInfm-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneClrsPrjcInfm */
		select FN_RP_CHECK_CLRS_PT_MDPR(#{clrsPrjcCd}, #{ptno}, #{ordrCd}) as TOTL_CCT
		  from dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgOrdrCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgOrdrCct (항응고제/항혈소판제 처방건수 조회) 
        Description :                                           최근 1년간 항응고제/항혈소판제 처방건수 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgOrdrCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgOrdrCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgOrdrCct-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgOrdrCct */
		        count(*) as TOTL_CCT
		  from
		        MDMEDORDT a
		     ,  MZCTRLMMT b
		 where
		        a.PTNO     = #{ptno}
		   and  a.ORDR_YMD between to_date(#{ordrYmd}, 'YYYYMMDD') - 365
		                       and to_date(#{ordrYmd}, 'YYYYMMDD')
		   and  NVL(a.DC_DVSN_CD  , 'N') = 'N'
		   and  NVL(a.TMPR_ORDR_YN, 'N') = 'N'
		   and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
		   and  b.MDCR_CTRL_CD      = 'MDP_134'
		   and  trunc(sysdate) between b.APST_YMD
		                           and b.APFN_YMD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgScinCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgScinCct (항응고제 처방 가능 상병 건수 조회) 
        Description :                                           항응고제 처방 가능 상병 건수 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgScinCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgScinCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgScinCct-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntgScinCct */
		        count(*) as TOTL_CCT
		  from  (
		         select
		                case when substr(a.SCIN_CD, 1, 3) between 'I20' and 'I25' then 'Y'    /* 허혈성 심질환 관련          */
		                     when substr(a.SCIN_CD, 1, 3) between 'I26' and 'I28' then 'Y'    /* 폐관련 심질환 등            */
		                     when substr(a.SCIN_CD, 1, 3) between 'I30' and 'I33' then 'Y'    /* 심낭염/심내막염 등          */
		                     when substr(a.SCIN_CD, 1, 3) between 'I34' and 'I39' then 'Y'    /* 판막 관련                   */
		                     when substr(a.SCIN_CD, 1, 3) between 'I05' and 'I09' then 'Y'    /* 류마티스성, 상세불명 등     */
		                     when substr(a.SCIN_CD, 1, 3) between 'I42' and 'I43' then 'Y'    /* Cardiomypathy 관련 등       */
		                     when substr(a.SCIN_CD, 1, 3) between 'I44' and 'I50' then 'Y'    /* 부정맥 관련                 */
		                     when substr(a.SCIN_CD, 1, 3) between 'I60' and 'I69' then 'Y'    /* 뇌혈관 질환 관련            */
		                     when substr(a.SCIN_CD, 1, 3) between 'I70' and 'I79' then 'Y'    /* 대동맥질환 죽상경화 and disection 말초혈관질환 등 */
		                     when substr(a.SCIN_CD, 1, 3) between 'I80' and 'I83' then 'Y'    /* 기타 정맥류 하지 정맥류 등                      */
		                     else 'N' end  A_SCIN_CD_YN
		           from
		                MDPADIAGT a      /* 환자상병내역 */
		          where a.MDRP_NO = #{mdrpNo}
		        )
		 where  A_SCIN_CD_YN = 'Y'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyprEdctCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyprEdctCct (1년내 고혈압교육횟수 조회) 
        Description :                                           1년내 고혈압교육횟수 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyprEdctCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyprEdctCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyprEdctCct-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyprEdctCct */
		        count(*) as TOTL_CCT
		  from
		        MDTRTORDT a
		 where
		        a.PTNO = #{ptno}
		   and  a.ORDR_YMD between trunc(sysdate - 365)
		                       and trunc(sysdate)
		   and  a.ORDR_CD  in (select ORCT_ITEM_CTN from MDPORCTIT where ORCT_CD = '#S00000400' and ORCT_ITEM_CD = 'ordrCd')
		   and  a.DC_DVSN_CD = 'N'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtntDsblYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtntDsblYn (환자장애여부조회) 
        Description :                                           환자장애여부조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtntDsblYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtntDsblYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtntDsblYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtntDsblYn */
		        'Y' as YN
		  from
		        APPTDSBLT
		 where
		        PTNO = #{ptno}
		   and  DBPR_DVSN_CD in ('5', '9', '4', '10')
		   and  rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneObdpUltsPrgnInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="prgnYn" column="PRGN_YN"/>
		<result property="ptrtPrrnYmd" column="PTRT_PRRN_YMD"/>
		<result property="nrmlYn" column="NRML_YN"/>
		<result property="yn" column="YN"/>
		<result property="strtYmd" column="STRT_YMD"/>
		<result property="fnshYmd" column="FNSH_YMD"/>
		<result property="prgnWeekCnt" column="PRGN_WEEK_CNT"/>
		<result property="obdpUltsInpyAcknNtm" column="OBDP_ULTS_INPY_ACKN_NTM"/>
		<result property="obdpUltsInpyAcknWeekCd" column="OBDP_ULTS_INPY_ACKN_WEEK_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneObdpUltsPrgnInfm (산과초음파 및 임신정보 조회) 
        Description :                                           산과초음파 및 임신정보 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneObdpUltsPrgnInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneObdpUltsPrgnInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneObdpUltsPrgnInfm-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneObdpUltsPrgnInfm */
		       a.PTNT_CTRL_CHRC_VL1    as PRGN_YN  -- 임신여부
		     , a.PTNT_CTRL_CHRC_VL2    as PTRT_PRRN_YMD -- 분만예정일
		     , case when a.PTNT_CTRL_CHRC_VL2 is null then 'N'
		            when to_date(a.PTNT_CTRL_CHRC_VL2,'yyyymmdd') + 14 < to_date(#{ordrYmd}, 'yyyymmdd') then 'N'
		            else 'Y'
		        end                    as NRML_YN  -- 분만예정일 정상여부, 분만예정일 + 14일로 변경
		     , case when (280 - (to_date(a.PTNT_CTRL_CHRC_VL2,'yyyymmdd') - trunc(sysdate))) between b.OBDP_ULTS_APST_DDCN
		                                                                                         and b.OBDP_ULTS_APFN_DDCN then 'Y'
		            else 'N'
		        end                    as YN  -- 인정주수 확인
		     ,  to_char((to_date(a.PTNT_CTRL_CHRC_VL2,'yyyymmdd') - 280) + b.OBDP_ULTS_APST_DDCN , 'yyyymmdd')  as STRT_YMD  -- 인정일 시작
		     ,  to_char((to_date(a.PTNT_CTRL_CHRC_VL2,'yyyymmdd') - 280) + b.OBDP_ULTS_APFN_DDCN , 'yyyymmdd')  as FNSH_YMD   -- 인정일 종료
		     ,  trunc((280 - (to_date(a.PTNT_CTRL_CHRC_VL2,'yyyymmdd') - trunc(sysdate))) / 7)                  as PRGN_WEEK_CNT -- 임신주수
		     ,  b.OBDP_ULTS_INPY_ACKN_NTM                                                                                     -- 인정횟수
		     ,  b.OBDP_ULTS_INPY_ACKN_WEEK_CD                                                                                 -- 인정주코드
		  FROM  MEPTNTCLT a
		     ,  (
		        select OBDP_ULTS_APST_DDCN
		             , OBDP_ULTS_APFN_DDCN
		             , OBDP_ULTS_INPY_ACKN_NTM
		             , OBDP_ULTS_INPY_ACKN_WEEK_CD
		          from AIMFMDFET b
		         where b.MDFE_CD = #{ordrCd}
		           and trunc(sysdate) between b.APST_YMD
		                                  and b.APFN_YMD
		        ) b
		 where a.PTNO         = #{ptno}
		   and a.PTNT_CTRL_CD = '001'
		   and rownum          = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listScinCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="scinCd" column="SCIN_CD"/>
		<result property="mainScinYn" column="MAIN_SCIN_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listScinCd (환자상병 목록 조회) 
        Description :                                           환자상병목록 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listScinCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listScinCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listScinCd-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listScinCd */
		        a.SCIN_CD            /* 상병코드    */        
		     ,  a.MAIN_SCIN_YN       /* 주진단여부  */        
		  from   
		        MDPADIAGT a , APRCRPTNT b   /* 환자상병    */     
		 where 
		        a.MDRP_NO  = #{mdrpNo}
		   and  b.MDRP_NO  = a.MDRP_NO
		   and  b.CNCL_DT is null
		   and  a.MCDP_CD  = decode(a.CODV_CD, 'I', a.MCDP_CD, #{mcdpCd})
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listPsblIpdvCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrIpdvCd" column="ORDR_IPDV_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listPsblIpdvCd (가능보험구분 조회) 
        Description :                                           가능보험구분 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listPsblIpdvCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listPsblIpdvCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listPsblIpdvCd-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIpdvCd */
		        substr(a.COMN_DTLS_CD,3,1) as ORDR_IPDV_CD
		  from
		        (
		         select
		                b.COMN_GRP_CD     COMN_GRP_CD
		              , b.COMN_DTLS_CD    COMN_DTLS_CD
		              , max(decode(b.COMN_ITEM_CD, 'OPTION2', b.COMN_ITEM_CHRC_VL, NULL)) OPTION2
		           from
		                CCCMCDIDT b
		          where
		                b.COMN_GRP_CD = 'AI112'
		          group by b.COMN_GRP_CD
		                 , b.COMN_DTLS_CD
		        ) a
		 where
		        a.COMN_DTLS_CD like
		        (
		        select decode(
		                (
		                select  
		                        b.MDFE_APDV_CD
		                  from
		                        AIMFAPRTT b
		                 where
		                        b.ISTY_CD      = #{istyCd}
		                   and  b.ISTY_ASST_CD = #{istyAsstCd}
		                   and  nvl(to_date(#{ordrYmd},'yyyymmdd'), trunc(sysdate)) between b.APST_YMD
		                                                                                and b.APFN_YMD
		                   and  rownum = 1
		                ),
		                '1', b.INSR_IPDV_CD || b.INSR_BTTY_CD,
		                '2', b.PRTC_IPDV_CD || b.PRTC_BTTY_CD,
		                '3', b.INCS_IPDV_CD || b.INCS_BTTY_CD,
		                '4', b.TAIN_IPDV_CD || b.TAIN_BTTY_CD,
		                     b.INSR_IPDV_CD || b.INSR_BTTY_CD
		            )
		          from  AIMFMDFET b
		         where  b.MDFE_CD = #{ordrCd}
		           and  nvl(to_date(#{ordrYmd}, 'yyyymmdd'), trunc(sysdate)) between b.APST_YMD
		                                                                         and b.APFN_YMD
		        ) || '%'
		   and  a.OPTION2         = 'Y'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRsrcExmnHx-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="enfrDt" column="ENFR_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRsrcExmnHx (연구검사이력조회) 
        Description :                                           연구검사이력조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRsrcExmnHx-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRsrcExmnHx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRsrcExmnHx-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRsrcExmnHx */
		        PTNO
		     ,  PTNT_NM
		     ,  ORDR_YMD
		     ,  ORDR_CD
		     ,  substr(ORDR_NM, 1, 50) as ORDR_NM
		     ,  ENFR_DT
		  from  (
		        select
		                a.PTNO
		             ,  b.PTNT_NM
		             ,  to_char(a.ORDR_YMD, 'yyyy-mm-dd') as ORDR_YMD
		             ,  a.ORDR_CD
		             ,  c.ORDR_NM
		             ,  to_char(a.ENFR_DT, 'yyyy-mm-dd hh24:mi') as ENFR_DT
		          from
		                MDEXMORDT a
		             ,  APPTPTNTT b
		             ,  MDORDRCMT c
		         where
		                a.PTNO   = #{ptno}
		           and  a.ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd') - 735 /* 대략 2년 */
		                               and to_date(#{ordrYmd}, 'yyyymmdd')
		           and  a.EXCF_CD = 'SL'
		           and  a.ORDR_CD in ('BLR9001', 'BLR9002')
		           and  a.MCDP_CD = fn_cc_get_dprt_cd('DPRT_IM_HOC')
		           and  a.DC_DVSN_CD not in ('X', 'Y')
		           and  b.PTNO = a.PTNO
		           and  c.ORDR_CD = a.ORDR_CD
		         order
		            by  a.ORDR_YMD desc
		        )
		<![CDATA[
		  where rownum < 11
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listBlodInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="blodNm" column="BLOD_NM"/>
		<result property="blodNo" column="BLOD_NO"/>
		<result property="blodAbrvNm" column="BLOD_ABRV_NM"/>
		<result property="ordrBldpCd" column="ORDR_BLDP_CD"/>
		<result property="donoDbltCtn" column="DONO_DBLT_CTN"/>
		<result property="bldtYmd" column="BLDT_YMD"/>
		<result property="exptYmd" column="EXPT_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listBlodInfm (자가/지정혈액 정보 조회) 
        Description :                                           자가/지정혈액 정보 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listBlodInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listBlodInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listBlodInfm-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listBlodInfm */
		        decode(substr(a.BLOD_NO, 1, 2), '70', '지정', '80', '자가', '')  AS BLOD_NM
		     ,  a.BLOD_NO
		     ,  c.BLOD_ABRV_NM
		     ,  b.ORDR_BLDP_CD
		     ,  a.DONO_DBLT_CTN
		     ,  to_char(a.BLDT_YMD, 'yyyy-mm-dd') AS BLDT_YMD
		     ,  to_char(b.EXPT_YMD, 'yyyy-mm-dd') AS EXPT_YMD
		  from
		        SLBBDONRT a
		     ,  SLBBLDINT b
		     ,  (
		         select
		                ORDR_CD
		              , BLOD_ABRV_NM
		           from
		                MDORDRCMT
		          where
		                SLIP_CD in ('BL2', 'B11') /* 수혈SLIP 확정 후 변경필요 */
		        ) c
		 where
		        a.PTNO = #{ptno}
		   and  b.BLOD_NO = a.BLOD_NO
		   and  b.USE_YN = 'Y'
		   and  c.ORDR_CD = b.ORDR_BLDP_CD
		   and  substr(a.BLOD_NO, 1, 2) in ('70', '80')
		 union
		select
		        decode(substr(b.BLOD_NO, 1, 2), '70', '지정', '80', '자가', '외부') AS BLOD_NM
		     ,  b.BLOD_NO
		     ,  c.BLOD_ABRV_NM
		     ,  b.ORDR_BLDP_CD
		     ,  b.BLDP_BBLT_CTN
		     ,  to_char(b.WRHG_DT, 'yyyy-mm-dd') AS WRHG_DT
		     ,  to_char(b.EXPT_YMD, 'yyyy-mm-dd') AS EXPT_YMD
		  from
		        SLBBLDINT b
		     ,  (
		          select
		                 ORDR_CD
		               , BLOD_ABRV_NM
		            from
		                 MDORDRCMT
		           where
		                 SLIP_CD in ('BL2', 'B11') /* 수혈SLIP 확정 후 변경필요 */
		        ) c
		 where
		        b.USE_TRGT_PTNO = #{ptno}
		   and  b.USE_YN = 'Y'
		   and  c.ORDR_CD = b.ORDR_BLDP_CD
		 order  by  2
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneExmnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneExmnYn (유전자검사 동의서 필요여부 조회) 
        Description :                                           유전자검사 동의서 필요여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneExmnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneExmnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneExmnYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneExmnYn */
		        'Y' as YN
		  from  SFCORDRAT
		 where  ORDR_CD = #{ordrCd}
		   and  SPCM_EXOR_ATRB_CD = 'I0039'  /* SFC_015 - I0039 유전자검사동의서 */
		   and  SPCM_EXOR_ATRB_CD_CTN in ('1', '2') /* 1 면제, 2 필수 */
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneAgdcNotPrin-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneAgdcNotPrin (유전자검사동의서 미출력 여부) 
        Description :                                           유전자검사동의서 미출력 여부 (미출력=Y, 출력=0 line)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneAgdcNotPrin-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneAgdcNotPrin"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneAgdcNotPrin-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneGeneAgdcNotPrin */
		        'Y' as YN
		  from  dual
		 where  not exists
		        (
		        select 'X'
		        from
		              MEOCRPRNT a
		            , MEFITMOBT b
		        where
		                a.PTNO = #{ptno}
		            and a.PBLC_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
		            and a.PNPR_ID = #{gvUserId}
		            and a.CODV_CD = #{codvCd}
		            and nvl(a.DLTN_YN, 'N') = 'N'
		            and a.FORM_NO = b.FORM_NO
		            and b.OBJ_ID = 'TSMCMOrder'
		            and b.DTLS_SCOP_CD_VL = 'GENE' /* 유전자검사동의서 */
		            and b.FORM_ITM_ID = '0'
		            and rownum = 1
		        )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOrdrYn2860-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOrdrYn2860 (금속스탠트 재료처방 여부) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOrdrYn2860-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOrdrYn2860"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOrdrYn2860-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOrdrYn2860 금속스탠트 재료처방 여부*/
		       decode(count(1), 0, 'N', 'Y') as YN
		  from MDORDRCMT a
		     , AIMFMDFET b
		 where a.ORDR_CD = #{ordrCd}
		   and a.ORDR_CLTY_CD = 'D2'
		   and a.ORCL_CD = 'MAT'
		   and to_date(#{ordrYmd}, 'YYYYMMDD') between a.APST_YMD and a.APFN_YMD
		   and a.ORDR_CD = b.MDFE_CD
		   and (b.INSR_EDI_CD like 'J521%' or b.INSR_EDI_CD like 'J522%')   
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperDiagYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperDiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperDiagYn */
		select  decode(count(1), 0,'Y','N')   as YN
		 from  MDPADIAGT  a
		         , MDPACLNCT  b
		where a.ptno                     =  #{ptno}
		    and  a.MDRP_NO     		 =  #{mdrpNo}
		    and  b.PTNO         	     	 = a.PTNO
		    and  b.MDRP_NO          =  a.MDRP_NO 
		    and  b.PTNT_CLNC_DX_SNO 	 = a.PTNT_CLNC_DX_SNO
		    and  ( 
		                   (
		                      exists ( select 1
		                                  from MZCTRLMMT c
		                                 where c.MDCR_CTRL_CD ='MDK_0010'
			                                 and c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD,1, 3)
				                             and trunc(sysdate) between c.APST_YMD
				                                                              and c.APFN_YMD
		                                   ) 
		                    )
		              or
		                    (                             
		                       exists (select 1 
		                                  from MZCTRLMMT c
		                                 where c.MDCR_CTRL_CD = 'MDK_0011'
			                                 and c.MDCR_DTLS_CTRL_CD = a.SCIN_CD
				                             and trunc(sysdate) between c.APST_YMD
				                                                               and c.APFN_YMD
		                                  )
		                    )  
		              )        
		    and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperIgrdYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperIgrdYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperIgrdYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperIgrdYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperIgrdYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHyperIgrdYn */
		 select  decode(count(1), 0,'N','Y')   as YN
		   from SDDDGCDMT  A, SDRPMDDET B, SDRPMDIDT C
		 where A.MDPR_CD = #{ordrCd}
		      and B.RPMD_ID = A.RPMD_ID     
		      and C.RPMD_ID = B.INGR_DETL_ID
		      and exists ( select 1 from MZCTRLMMT X
		                              where MDCR_CTRL_CD = 'MDK_0009'
		                                 and MDCR_DTLS_CTRL_CD = B.INGR_DETL_ID
		                            )
		      and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtCareYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totCnt" column="TOT_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtCareYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtCareYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtCareYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtCareYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtCareYn */
		<![CDATA[
		select sum(x.cnt) as TOT_CNT
		  from (
		               select count(*) cnt
		                  from MDTRTORDT a
		                where a.PTNO = #{ptno}
		                     and a.ORDR_YMD >= trunc(sysdate) - #{diff}
		                     and a.DC_DVSN_CD= 'N'
		                     and a.TMPR_ORDR_YN = 'N'
		                     and #{diff} = #{diff}
		                     and a.ORDR_CD in ( select MDFE_CD 
		                                                   from AIMFMDFET b
		                                                     where b.APST_YMD <= trunc(sysdate)
		                                                          and b.APFN_YMD >= trunc(sysdate)
		                                                          and b.INSR_EDI_CD in (select MDCR_DTLS_CTRL_CD 
		                                                                                           from MZCTRLMMT c
		                                                                                          where c.MDCR_CTRL_CD = 'MDK_0020' )
		                                                   )
		                union all                                              
		                select count(*) cnt
		                   from MDEXMORDT a
		                 where a.PTNO = #{ptno}
		                      and a.ORDR_YMD >= trunc(sysdate) -  #{diff}                    
		                      and a.DC_DVSN_CD = 'N'
		                      and a.TMPR_ORDR_YN = 'N'
		                      and #{diff} = #{diff}
		                      and a.ORDR_CD in ( select MDFE_CD
		                                                     from AIMFMDFET b
		                                                     where b.APST_YMD <= trunc(sysdate)
		                                                          and b.APFN_YMD >= trunc(sysdate)
		                                                          and b.INSR_EDI_CD in (select MDCR_DTLS_CTRL_CD 
		                                                                                           from MZCTRLMMT c
		                                                                                         where c.MDCR_CTRL_CD = 'MDK_0020' )
		                                                   )
		               )  x       
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmK0015Cnt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmK0015Cnt () 
        Description :                                           처방일 기준 21일 사이에 처방 건수
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmK0015Cnt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmK0015Cnt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmK0015Cnt-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmK0015Cnt */
		SELECT nvl(count(*),0)  AS totl_cct
		  FROM MDEXMORDT a
		 WHERE a.PTNO =  #{ptno}
		    AND a.ORDR_YMD BETWEEN to_date(#{ordrYmd},'yyyymmdd')-21 AND to_date(#{ordrYmd},'yyyymmdd')
		    AND a.ORDR_CD = #{ordrCd}
		   AND nvl(a.DC_DVSN_CD, 'N') = 'N'      --DC 제외
		   AND nvl(a.ORDR_CRTN_DVSN_CD, 'X' ) NOT IN ('08') -- PRN실시처방  제외
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpapScinYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpapScinYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpapScinYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpapScinYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpapScinYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpapScinYn */
		select decode(count(1), 0, 'N', 'Y') as YN
		  from MDPADIAGT
		 where MDRP_NO = #{mdrpNo}
		   and MCDP_CD = #{mcdpCd}
		   and trim(substr(SCIN_CD, 0, 5)) in (select MDCR_DTLS_CTRL_CD
		                                                     from MZCTRLMMT
		                                                   where MDCR_CTRL_CD = 'MDK_0016'
		                                                    )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrttCheck-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="crttWrtgDt" column="CRTT_WRTG_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrttCheck () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrttCheck-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrttCheck"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrttCheck-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrttCheck */
		<![CDATA[
		  select  max(CRTT_WRTG_DT)  as CRTT_WRTG_DT /* 제증명 작성일자 */
		    from  APVCISNCT a 
		          ,  APVCCRTTT b
		  where   a.PTNO = #{ptno}
		      and   a.CRTT_ID = #{crttId}
		      and   NVL(a.ELSG_YN,'N') = 'Y'  /* 인증유무 */ 
		      and   b.CRTT_ID = a.CRTT_ID
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneosteoporosis-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
		<result property="passDt" column="PASS_DT"/>
		<result property="enfrDt" column="ENFR_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneosteoporosis () 
        Description :                                           1년이내 골다공증검사 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneosteoporosis-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneosteoporosis"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneosteoporosis-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneosteoporosis */
		    select
		               decode(sign(365 - (to_date(#{ordrYmd}, 'yyyymmdd') - trunc(a.ENFR_DT))), 1, 'Y', 'N') as YN
		             , 365 - (to_date(#{ordrYmd}, 'yyyymmdd') - trunc(a.ENFR_DT)) PASS_DT        
		             , to_char(add_months(a.ENFR_DT,12), 'yyyymmdd') ENFR_DT
		          from
		               (
		        		select
		        		              max(a.ENFR_DT) as ENFR_DT
		        		  from
		        		             MDORDRCMT c,
		        		             AIMFMDFET  b,
		        		             MDEXMORDT a
		        		 where  a.PTNO  = #{ptno}
		        		   and a.ORDR_YMD between add_months(to_date(#{ordrYmd}, 'yyyymmdd'), -12) and to_date(#{ordrYmd}, 'yyyymmdd')
		        		   and a.DC_DVSN_CD    = 'N'
		        		   and a.TMPR_ORDR_YN = 'N'
		        		   and a.ENFR_DT is not null
		        		   and a.ORDR_CD    = b.MDFE_CD
		        		   and b.INSR_EDI_CD  in ('HC341', 'HC342')
		        		   and to_date(#{ordrYmd}, 'yyyymmdd') between b.APST_YMD and b.APFN_YMD
		        		   and c.ORDR_CD    = b.MDFE_CD
		               ) a
		         where 1=1		
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrGetDdcn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ddcn" column="DDCN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrGetDdcn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrGetDdcn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrGetDdcn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrGetDdcn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTrgtOrdrGetDdcn */
		        nvl(MDCR_LWRN_CTRL_CD, 0) as DDCN
		  from
		        MZCTRLMMT
		 where
		        MDCR_CTRL_CD = #{mdcrCtrlCd} 
		   and  MDCR_DTLS_CTRL_CD = #{ordrCd}
		   and  to_date(#{ordrYmd}, 'YYYYMMDD') between APST_YMD and APFN_YMD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdtxRdtnExmnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
		<result property="nmbrVl1" column="NMBR_VL1"/>
		<result property="nmbrVl2" column="NMBR_VL2"/>
		<result property="chrcVl1" column="CHRC_VL1"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdtxRdtnExmnYn (근관치료관련 방사선검사여부 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdtxRdtnExmnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdtxRdtnExmnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdtxRdtnExmnYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdtxRdtnExmnYn */
		<![CDATA[
		select  count(*) as TOTL_CCT
		     ,  nvl((select MDCR_CTRL_NMBR_VL1 from MZCTRLMMT where MDCR_CTRL_CD = 'MDP_951' and MDCR_DTLS_CTRL_CD = #{insrEdiCd}), 0) as NMBR_VL1
		     ,  nvl((select MDCR_CTRL_NMBR_VL2 from MZCTRLMMT where MDCR_CTRL_CD = 'MDP_951' and MDCR_DTLS_CTRL_CD = #{insrEdiCd}), 0) as NMBR_VL2
		     ,  (select listagg(MDCR_DTLS_CTRL_CD, '|') within group (order by MDCR_DTLS_CTRL_NM) as CHRC_VL1 from MZCTRLMMT where MDCR_CTRL_CD = 'MDK_0020') as CHRC_VL1
		  from  (
		        select  PTNO
		             ,  ORDR_YMD
		             ,  ORDR_SNO
		             ,  ORDR_CD
		          from  MDTRTORDT a
		         where  PTNO = #{ptno}
		           and  a.ORDR_YMD >= (trunc(sysdate) - (select MDCR_CTRL_NMBR_VL1 from MZCTRLMMT where MDCR_CTRL_CD = 'MDP_951' and MDCR_DTLS_CTRL_CD = #{insrEdiCd}))
		           and  a.DC_DVSN_CD= 'N'
		           and  a.TMPR_ORDR_YN = 'N'
		         union  all
		        select  PTNO
		             ,  ORDR_YMD
		             ,  ORDR_SNO
		             ,  ORDR_CD
		          from  MDTRTORDT a
		         where  PTNO = #{ptno}
		           and  a.ORDR_YMD >= (trunc(sysdate) - (select MDCR_CTRL_NMBR_VL1 from MZCTRLMMT where MDCR_CTRL_CD = 'MDP_951' and MDCR_DTLS_CTRL_CD = #{insrEdiCd})) 
		           and  a.DC_DVSN_CD= 'N'
		           and  a.TMPR_ORDR_YN = 'N'
		        ) a
		     ,  AIMFMDFET b
		 where  a.ORDR_CD = b.MDFE_CD
		   and  b.APST_YMD <= trunc(sysdate)
		   and  b.APFN_YMD >= trunc(sysdate)
		   and  b.INSR_EDI_CD in (select MDCR_DTLS_CTRL_CD from  MZCTRLMMT where MDCR_CTRL_CD = 'MDK_0020')
				]]>
	</select>




	<resultMap id="com-selectOneK0020YndselectOneK0020Yn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0020Yn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-selectOneK0020YndselectOneK0020Yn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0020Yn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-selectOneK0020YndselectOneK0020Yn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0020Yn-result
    -->
	<select id="com-selectOneK0020YndselectOneK0020Yn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0020Yn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-selectOneK0020YndselectOneK0020Yn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0020Yn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-selectOneK0020YndselectOneK0020Yn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0020Yn */
		select  decode(count(1), 0, 'N', 'Y') as YN       
		 from  MDPADIAGT   a
		 where 
		        a.MDRP_NO    = #{mdrpNo}
		   and  a.MCDP_CD    = decode(a.CODV_CD,'I',a.MCDP_CD,#{mcdpCd})
		   and  exists (select 1 
		                      from MZCTRLMMT c
		                    where c.MDCR_CTRL_CD = 'MDK_0013'
			                    and (   
		                                    (c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD, 1,3))
		                               or  (c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD, 1,5))
		                              )
		                        and trunc(sysdate) between c.APST_YMD  and c.APFN_YMD
		                     ) 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrusMemo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="drusCd" column="DRUS_CD"/>
		<result property="envlMemoCtn" column="ENVL_MEMO_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrusMemo () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrusMemo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrusMemo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrusMemo-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrusMemo */
		select
			a.DRUS_CD as DRUS_CD
			, a.ENVL_MEMO_CTN1 || a.ENVL_MEMO_CTN2 as ENVL_MEMO_CTN
		from SDDMETCDT a
		where a.drus_cd = #{drusCd}
		;
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0032RsltVl-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="rsltVl" column="RSLT_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0032RsltVl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0032RsltVl-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0032RsltVl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0032RsltVl-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0032RsltVl */
		SELECT b.KORN_DPRT_NM||'('||c.USER_NM||')'  AS rslt_vl
		  FROM MDTRTORDT a
		           ,HZDEPTMMT b
		           ,CCUSRDPHT c
		  WHERE a.PTNO = #{ptno}
		    AND a.ORDR_YMD = trunc(sysdate)
		    AND a.ORDR_CD = 'T001224'
		    AND a.DC_DVSN_CD = 'N'
		    AND NVL(a.DC_DVSN_CD,'N') = 'N'
		    AND NVL(a.TMPR_ORDR_YN,'N')= 'N'
		    AND b.DPRT_CD = a.MCDP_CD
		    AND c.USER_ID = a.CHDR_ID
		    AND rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDschIDctYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDschIDctYn () 
        Description :                                           입원환자 퇴원지시 여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDschIDctYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDschIDctYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDschIDctYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDschIDctYn */
		SELECT DECODE(COUNT(1),1,'Y','N') AS yn  
		  FROM APRCRPTNT a
		 WHERE a.PTNO =#{ptno}
		     AND a.MDRP_NO = #{mdrpNo}
		     AND a.DSCH_DT       = to_date('29991231', 'yyyymmdd')
		     AND a.CODV_CD       = 'I'		
		     AND a.CNCL_DT is NULL
		     AND a.DSCH_IDCT_DT IS NOT NULL
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtqlChck-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
		<result property="ptqlFnshYmd" column="PTQL_FNSH_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtqlChck () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtqlChck-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtqlChck"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtqlChck-result" useCache="true" flushCache="false">
		<![CDATA[
				select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtqlChck */
				          decode(sign(count(case when to_date(#{wntdDt}, 'yyyymmdd') <= PTQL_FNSH_YMD then null else PTNO end)), 1, 'Y', 'N') as YN
				         ,to_char(max(PTQL_FNSH_YMD), 'yyyymmdd') as PTQL_FNSH_YMD
				   from APQLQLDLT  
				 where PTNO = #{ptno}  
				    and ASCS_CLSF_CD = '1' 
				    and trunc(sysdate) between PTQL_STRT_YMD and PTQL_FNSH_YMD 
				    and SRIL_PTNT_APDC_STTS_CD = 'Y'
				    and SPSD_ID = 'V193'    
				    and SRIL_MDCR_RGST_NO is not null
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFluYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFluYn () 
        Description :                                           외래 예약이 2차진료이고, 무료사유가 신종플루(예방접종) 인 경우
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFluYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFluYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFluYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFluYn */
		SELECT decode(count(1),0,'Y','N') AS yn
		  FROM APRCRPTNT a 
		 WHERE a.PTNO     = #{ptno}
		   AND a.MDRP_NO  = #{mdrpNo}
		   AND a.CODV_CD  = 'O'  
		   AND a.MDCR_ANDV_CD = '8'        -- 2차진료
		   AND a.CHFR_RPTN_DVSN_CD = 'S'   -- 신종플루(예방접종)
		   AND a.CNCL_DT is NULL
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChartPatYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChartPatYn () 
        Description :                                           외래환자 챠트및필름복사 처방만 가능한 환자 여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChartPatYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChartPatYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChartPatYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChartPatYn */
		SELECT decode(count(1),0,'N','Y') AS yn
		  FROM APRCRPTNT a 
		 WHERE a.PTNO     = #{ptno}
		   AND a.MDRP_NO  = #{mdrpNo}
		   AND a.CODV_CD  = 'O'  
		   AND a.MDCR_ANDV_CD = '8'           -- 2차진료
		   AND a.CHFR_RPTN_DVSN_CD = 'F'    -- 의무기록 복사(의사 미상담)
		   AND a.CNCL_DT is NULL
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0042-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="cnt1" column="CNT1"/>
		<result property="cnt2" column="CNT2"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0042 () 
        Description :                                           안구 광학단층 촬영 처방횟수
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0042-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0042"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0042-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0042 */
		SELECT nvl(SUM(DECODE(B.MDCR_CTRL_CHRC_VL1,'001',1,0)),0) CNT1
		           ,nvl(SUM(DECODE(B.MDCR_CTRL_CHRC_VL1,'002',1,0)),0) CNT2
		  FROM MDEXMORDT A 
		      ,MZCTRLMMT B
		WHERE 1=1    
		  AND A.PTNO = #{ptno}
		  AND A.ORDR_YMD = TO_DATE(#{ordrYmd},'YYYYMMDD')
		  AND nvl(A.ORDR_IPDV_CD,'1') = '1' --급여 
		  AND NVL(A.DC_DVSN_CD,'N') = 'N'
		  AND NVL(A.TMPR_ORDR_YN,'N')= 'N'
		  AND B.MDCR_CTRL_CD ='MDK_0026'
		  AND B.MDCR_DTLS_CTRL_CD = A.ORDR_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAsthmaDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAsthmaDiagYn () 
        Description :                                           천식 진단 (rule out 제외)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAsthmaDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAsthmaDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAsthmaDiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAsthmaDiagYn */
		<![CDATA[
		select  decode(count(1), 1,'Y','N') as YN
		 from  MDPADIAGT  a
		     , MDPACLNCT  b
		where  1=1
		    and  a.MDRP_NO        =  #{mdrpNo}
		   AND A.MCDP_CD         =  #{mcdpCd}
		    and  b.PTNO          	    = a.PTNO
		    and  b.MDRP_NO            =  a.MDRP_NO 
		    and  b.PTNT_CLNC_DX_SNO 	= a.PTNT_CLNC_DX_SNO
		    and  NVL(b.RUL_OUT_YN,'N')         <> 'Y'    
		    and  exists ( select 1
		                    from MZCTRLMMT c
		                   where c.MDCR_CTRL_CD ='MDK_0028'
		                     and c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD,1, 3)
		                     and trunc(sysdate) between c.APST_YMD and c.APFN_YMD
		                   ) 
		   and rownum = 1
		 ]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEvalYm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="rsltVl" column="RSLT_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEvalYm () 
        Description :                                           적정성 평가 기준 년월
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEvalYm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEvalYm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEvalYm-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEvalYm */
		SELECT SUBSTR(MDCR_DTLS_CTRL_CD,1,4)||'년 '||SUBSTR(MDCR_DTLS_CTRL_CD,5,2)||'월' AS RSLT_VL
		  FROM MZCTRLMMT
		 WHERE MDCR_CTRL_CD = #{mdcrCtrlCd}
		   AND TO_DATE(#{ordrYmd},'YYYYMMDD') BETWEEN APST_YMD AND APFN_YMD;
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045EnfrDt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="rsltVl" column="RSLT_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045EnfrDt () 
        Description :                                           헤모글로빈 희망일자 기준 12개월 전처방 조회 하되 검사일이 2개월 이내 가장 최근 검사일시+처방일자+검사결과
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045EnfrDt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045EnfrDt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045EnfrDt-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045EnfrDt */
		SELECT  MAX(TRIM(TO_CHAR(A.ENFR_DT,'YYYYMMDDHH24MI')||TO_CHAR(A.ORDR_YMD,'YYYYMMDD')||TRIM(B.EXRS_NCVL_VL))) AS RSLT_VL     
		  FROM MDEXMORDT A
		      ,SZRESULMT B
		WHERE 1=1   
		  AND A.PTNO = #{ptno}
		  -- 희망일자 기준 12개월 전처방 조회 하되 검사일이 2개월 이내 인것
		  AND A.ORDR_YMD BETWEEN ADD_MONTHS(TO_DATE(#{wntdDt},'YYYYMMDD'),-12) AND TO_DATE(#{wntdDt},'YYYYMMDD') 
		  AND A.ENFR_DT  BETWEEN ADD_MONTHS(TO_DATE(#{wntdDt},'YYYYMMDD'),-2)  AND TO_DATE(#{wntdDt},'YYYYMMDD') + 0.99999
		  AND NVL(A.DC_DVSN_CD,'N') = 'N'
		  AND NVL(A.TMPR_ORDR_YN,'N')= 'N'  
		  AND A.ORDR_CD IN (
		                    SELECT A.MDCR_DTLS_CTRL_CD 
		                      FROM SEHRMGR.MZCTRLMMT A
		                     WHERE A.MDCR_CTRL_CD = 'MDK_0031'
		                    ) 
		  AND  B.PTNO              =   A.PTNO
		  AND  B.ORDR_YMD          =   A.ORDR_YMD
		  AND  B.ORDR_SNO          =   A.ORDR_SNO
		  AND  B.EXRS_NCVL_VL IS NOT NULL;
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045WntdDt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="rsltVl" column="RSLT_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045WntdDt () 
        Description :                                           희망일자 기준 12개월 전처방으로 조회하되, 희망일 전후 2개월 (60일) 결과 없는 희망일자+처방일자
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045WntdDt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045WntdDt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045WntdDt-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0045WntdDt */
		  SELECT MAX(TRIM(TO_CHAR(A.WNTD_DT,'YYYYMMDD')||TO_CHAR(A.ORDR_YMD,'YYYYMMDD'))) AS RSLT_VL               
		     FROM MDEXMORDT A
		    WHERE 1=1 
		      AND A.PTNO = #{ptno}
		      AND A.ORDR_YMD BETWEEN ADD_MONTHS(TO_DATE(#{wntdDt},'YYYYMMDD'),-12) AND TO_DATE(#{wntdDt},'YYYYMMDD')
		      AND A.WNTD_DT BETWEEN ADD_MONTHS(TO_DATE(#{wntdDt},'YYYYMMDD'),-2) AND ADD_MONTHS(TO_DATE(#{wntdDt},'YYYYMMDD'),2)
		      AND NVL(A.DC_DVSN_CD,'N') = 'N'
		      AND NVL(A.TMPR_ORDR_YN,'N')= 'N'  
		      AND A.ORDR_CD IN (
		                    SELECT A.MDCR_DTLS_CTRL_CD 
		                      FROM SEHRMGR.MZCTRLMMT A
		                     WHERE A.MDCR_CTRL_CD = 'MDK_0031'
		                    ) 
		      AND NOT EXISTS (SELECT 1
		                        FROM SZRESULMT B
		                       WHERE B.PTNO        =   A.PTNO
		                         AND B.ORDR_YMD    =   A.ORDR_YMD
		                         AND B.ORDR_SNO    =   A.ORDR_SNO 
		                      );   
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCopdDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCopdDiagYn () 
        Description :                                           만성폐쇄성질환(COPD) 평가지표 진단 유무 체크 (rule out 제외)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCopdDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCopdDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCopdDiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCopdDiagYn */
		<![CDATA[
		select  decode(count(1), 1,'Y','N') as YN
		 from  MDPADIAGT  a
		     , MDPACLNCT  b
		where  1=1
		    and  a.MDRP_NO        =  #{mdrpNo}
		   AND A.MCDP_CD         =  decode(a.CODV_CD,'I',A.MCDP_CD,#{mcdpCd})
		    and  b.PTNO          	    = a.PTNO
		    and  b.MDRP_NO            =  a.MDRP_NO 
		    and  b.PTNT_CLNC_DX_SNO 	= a.PTNT_CLNC_DX_SNO
		    and  NVL(b.RUL_OUT_YN,'N')         <> 'Y'    
		    and  exists ( select 1
		                    from MZCTRLMMT c
		                   where c.MDCR_CTRL_CD ='MDK_0033'
		                     and c.MDCR_DTLS_CTRL_CD = SUBSTR(A.SCIN_CD,1, C.MDCR_CTRL_NMBR_VL1)
		                     and trunc(sysdate) between c.APST_YMD and c.APFN_YMD
		                   ) 
		   and rownum = 1
		 ]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listK0047InsrEdiCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="insrEdiCd" column="INSR_EDI_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listK0047InsrEdiCd () 
        Description :                                           만성폐쇄성질환(COPD) 평가지표 관련 EDI 리스트 (MDK_0035,MDK_0036,MDK_0037)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listK0047InsrEdiCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listK0047InsrEdiCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listK0047InsrEdiCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listK0047InsrEdiCd */
		        SELECT MDCR_DTLS_CTRL_CD AS INSR_EDI_CD  
		  FROM MZCTRLMMT 
		 WHERE MDCR_CTRL_CD = #{mdcrCtrlCd}
		   AND TO_DATE(#{ordrYmd}, 'YYYYMMDD') BETWEEN APST_YMD AND APFN_YMD  
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDiagYn (결핵 진단 여부) 
        Description :                                           결핵 진단 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDiagYn */
		 select decode(count(1),0,'Y','N') as YN
		   from MDPADIAGT a /* 환자상병내역 */
		      , MDPACLNCT b /* 환자임상진단내역 */
		  where a.ptno = #{ptno}
		    and a.MDRP_NO = #{mdrpNo}
		    and b.PTNO = a.PTNO
		    and b.MDRP_NO = a.MDRP_NO
		    and b.PTNT_CLNC_DX_SNO = a.PTNT_CLNC_DX_SNO
		    and (exists (select 1
						   from QDCTRLMMT c 
						  where c.IFMN_CTRL_CD = 'QDT_SCIN_CD'
						    and c.IFMN_DETL_CTRL_VL = substr(a.SCIN_CD,1,3)
						    )) 
		    and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDrugYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDrugYn (결핵약 여부) 
        Description :                                           결핵약 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDrugYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDrugYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDrugYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbrcDrugYn */
		 select decode(count(1),0,'N','Y') as YN
		   from SDDDGCDMT a
		      , QDCTRLMMT b
		  where a.MDPR_CD = #{ordrCd}
		    and a.MDPR_CD = b.IFMN_DETL_CTRL_VL
		    and b.IFMN_CTRL_CD = 'QDT_DRUG_CD'
		    and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0047OrdCnt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="nmbrVl1" column="NMBR_VL_1"/>
		<result property="nmbrVl2" column="NMBR_VL_2"/>
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0047OrdCnt () 
        Description :                                           만성폐쇄성질환(COPD) 평가지표 약제, 흡입기관지확장제, 폐기능 검사 처방 건수
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0047OrdCnt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0047OrdCnt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0047OrdCnt-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0047OrdCnt */
		<![CDATA[
		SELECT nvl(SUM(ORDCNT1),0) AS NMBR_VL_1  
		          ,nvl(SUM(ORDCNT2),0) AS NMBR_VL_2  
		          ,nvl(SUM(ORDCNT3),0) AS TOTL_CCT
		  FROM       
		   (
		   SELECT A.PTNO
		         ,NVL(COUNT(DISTINCT A.ORDR_YMD),0) ORDCNT1
		         ,0 ORDCNT2
		         ,0 ORDCNT3
		     FROM MDMEDORDT A
		    WHERE 1=1
		      AND A.PTNO =#{ptno}      
		      AND A.ORDR_YMD BETWEEN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD = 'MDK_0034' AND TRUNC(SYSDATE) BETWEEN APST_YMD AND APFN_YMD)   
		                         AND TO_DATE(#{ordrYmd},'YYYYMMDD')
		      AND NVL(DC_DVSN_CD,'N') = 'N'
		      AND NVL(TMPR_ORDR_YN,'N')= 'N'
		      AND IHOH_DVSN_CD = 'O' --원외약
		      AND EXISTS (SELECT 1
		                    FROM AIMFMDFET
		                   WHERE MDFE_CD = A.ORDR_CD 
		                     AND A.ORDR_YMD BETWEEN APST_YMD AND APFN_YMD
		                     AND INSR_EDI_CD IN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD = 'MDK_0035' AND TRUNC(SYSDATE) BETWEEN APST_YMD AND APFN_YMD)                                             
		                 )
		      GROUP BY A.PTNO 
		      UNION ALL
		      SELECT A.PTNO
		         ,0 ORDCNT1
		         ,NVL(COUNT(DISTINCT A.ORDR_YMD),0) ORDCNT2
		         ,0 ORDCNT3
		     FROM MDMEDORDT A
		    WHERE 1=1
		      AND A.PTNO =#{ptno}        
		      AND A.ORDR_YMD BETWEEN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD = 'MDK_0034' AND TRUNC(SYSDATE) BETWEEN APST_YMD AND APFN_YMD)   
		                         AND TO_DATE(#{ordrYmd},'YYYYMMDD')
		      AND NVL(DC_DVSN_CD,'N') = 'N'
		      AND NVL(TMPR_ORDR_YN,'N')= 'N'
		      AND IHOH_DVSN_CD = 'O' --원외약
		      AND EXISTS (SELECT 1
		                    FROM AIMFMDFET
		                   WHERE MDFE_CD = A.ORDR_CD 
		                     AND A.ORDR_YMD BETWEEN APST_YMD AND APFN_YMD
		                     AND INSR_EDI_CD IN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD = 'MDK_0036' AND TRUNC(SYSDATE) BETWEEN APST_YMD AND APFN_YMD)                                             
		                 )
		      GROUP BY A.PTNO
		       UNION ALL
		      SELECT A.PTNO
		         ,0 ORDCNT1
		         ,0 ORDCNT2
		         ,NVL(COUNT(DISTINCT A.ORDR_YMD),0) ORDCNT3
		     FROM MDEXMORDT A
		    WHERE 1=1
		      AND A.PTNO =#{ptno}              
		      AND A.ENFR_DT BETWEEN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD = 'MDK_0034' AND TRUNC(SYSDATE) BETWEEN APST_YMD AND APFN_YMD)   
		                         AND TO_DATE(#{ordrYmd},'YYYYMMDD') + 0.99999
		      AND NVL(DC_DVSN_CD,'N') = 'N'
		      AND NVL(TMPR_ORDR_YN,'N')= 'N'      
		      AND EXISTS (SELECT 1
		                    FROM AIMFMDFET
		                   WHERE MDFE_CD = A.ORDR_CD 
		                     AND A.ORDR_YMD BETWEEN APST_YMD AND APFN_YMD
		                     AND INSR_EDI_CD IN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD = 'MDK_0037' AND TRUNC(SYSDATE) BETWEEN APST_YMD AND APFN_YMD)                                             
		                 )
		      GROUP BY A.PTNO
		)
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsApplyInfo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="mdcrCtrlChrcVl1" column="MDCR_CTRL_CHRC_VL1"/>
		<result property="mdcrCtrlChrcVl3" column="MDCR_CTRL_CHRC_VL3"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsApplyInfo () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsApplyInfo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsApplyInfo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsApplyInfo-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsApplyInfo */
		select
		    a.MDCR_CTRL_CHRC_VL1 as MDCR_CTRL_CHRC_VL1
		    , case 
		        when a.MDCR_CTRL_CHRC_VL1 = '1' then b.dprt_cd
		        when a.MDCR_CTRL_CHRC_VL1 = '2' then c.user_id
		        else ''
		        end as MDCR_CTRL_CHRC_VL3
		from MZCTRLMMT a, HZDEPTMMT b, CCUSRDPHT c 
		where 
		    a.MDCR_CTRL_CD ='MDL_0004'
		    and a.MDCR_CTRL_CHRC_VL8 = #{ordrCd}
		    and a.MDCR_CTRL_CHRC_VL4 = 'A'
		    and a.MDCR_CTRL_CHRC_VL3 = b.ABRV_DPRT_CD(+)
		    and a.MDCR_CTRL_CHRC_VL3 = c.user_id(+)
		order by MDCR_CTRL_CHRC_VL8
		;
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsInMsgInfo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="mdcrLwrnCtrlCd" column="MDCR_LWRN_CTRL_CD"/>
		<result property="ctrlDscrCtn" column="CTRL_DSCR_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsInMsgInfo () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsInMsgInfo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsInMsgInfo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsInMsgInfo-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listOrdrInsInMsgInfo */
		select 
		    a.MDCR_LWRN_CTRL_CD as MDCR_LWRN_CTRL_CD,  /* 수가코드 */
		    a.CTRL_DSCR_CTN as CTRL_DSCR_CTN   /* Inline 메세지 */
		from MZCTRLMMT a
		where 
		    a.MDCR_CTRL_CD ='MDL_0003'
		    and trunc(sysdate) between a.APST_YMD and a.APFN_YMD 
		    and a.MDCR_LWRN_CTRL_CD in
		                            (
		                                select
		                                    b.MDFE_CD
		                                from AIMFMDFET b
		                                where 
		                                    b.MDFE_CD = #{ordrCd}
		                                    and trunc(sysdate) between b.APST_YMD and b.APFN_YMD
		                                    and b.MDFE_CD = a.MDCR_LWRN_CTRL_CD
		                            )
		;
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtdpSameOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtdpSameOrdrYn (타과 동일약 처방 유무 체크) 
        Description :                                           타과 동일약 처방 유무 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtdpSameOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtdpSameOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtdpSameOrdrYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtdpSameOrdrYn */
		<![CDATA[
		SELECT  
		        NVL2(MAX(A.PTNO), 'Y', 'N') AS YN  /* 오늘 다른과에서 동일약 처방 여부 */
		  FROM  APRCRPTNT A  /* [진료접수] */
		      , MDMEDORDT B  /* [약처방] */
		 WHERE  1=1
		   AND  A.MDRP_NO       = B.MDRP_NO              /* 진료접수번호 */
		   AND  A.PTNO          = B.PTNO                 /* 환자번호 */
		   AND  A.PTNO          = #{ptno}                /* 환자번호 */
		   AND  A.CODV_CD       = 'O'                    /* 내원구분코드(O:외래) */
		/* AND  A.MDCR_YMD      = TRUNC(SYSDATE) */      /* 진료일자 (오늘) */
		   AND  A.MDCR_YMD      = TO_DATE(SUBSTR(#{ordrYmd}, 1, 8), 'yyyymmdd')   /* 진료일자 (처방일자=진료일자 이므로) */
		   AND  B.ORDR_YMD      = TO_DATE(SUBSTR(#{ordrYmd}, 1, 8), 'yyyymmdd')   /* 처방일자 (처방일자=진료일자 이므로) */
		   AND  B.ORDR_CD       = #{ordrCd}              /* 오더코드 */
		   AND  A.MDRP_NO      <> #{mdrpNo}              /* 진료접수번호 (본인 진료 제외) */
		   AND  B.DC_DVSN_CD    = 'N'                    /* DC구분코드(Y/N/...) */
		   AND  B.TMPR_ORDR_YN  = 'N'                    /* 임시처방여부(Y/N) */
		   AND  A.CNCL_DT       IS NULL                  /* 취소일시 */
		   AND  ROWNUM = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrExstWeekYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrExstWeekYn (Methotrexate 경구약 처방 존재 여부 조회) 
        Description :                                           Methotrexate 경구약 처방 1주일 이내 존재 여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrExstWeekYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrExstWeekYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrExstWeekYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrExstWeekYn */
		 select decode(count(1), 0, 'N', 'Y') as YN
		   from MDMEDORDT a					/* 약처방 */
		   	  , SDDDGCDMT b					/* 약품코드 */
		  where b.MDPR_CD = a.ORDR_CD		/* 약품코드 */
		    and a.PTNO = #{ptno}			/* 환자번호 */
		    and a.ORDR_YMD between to_date(#{ordrYmd},'yyyymmdd') - 7 and to_date(#{ordrYmd},'yyyymmdd')	/* 처방일자 */
		    and a.MDRP_NO ! = #{mdrpNo}		/* 진료접수번호 */
		    and nvl(a.DC_DVSN_CD,'N') = 'N'	/* DC구분코드 */
		    and a.ORDR_CLTY_CD = 'B2'		/* 처방분류유형코드 (B1 : 주사약, B2:경구약) */  
		    and b.RPMD_ID = 'MTX'			/* 성분ID */
		    and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrVincYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrVincYn (빈크리스틴 투약오류 예방) 
        Description :                                           빈크리스틴 주사약 처방이 있는지 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrVincYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrVincYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrVincYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrVincYn */
		 select decode(count(1), 0, 'N', 'Y') as YN
		   from MDMEDORDT a 					/* 약처방 */
		      , SDDDGCDMT b 					/* 약품코드 */
		  where b.MDPR_CD = a.ORDR_CD 			/* 약품코드 */
		    and a.PTNO = #{ptno} 				/* 환자번호 */
		    and a.ORDR_YMD = to_date(#{ordrYmd},'yyyymmdd') /* 처방일자 */
		    and nvl(a.DC_DVSN_CD, 'N') = 'N' 	/* DC구분코드 */
		    and a.ORDR_CLTY_CD = 'B1' 			/* 처방분류유형코드 (B1 : 주사약, B2:경구약) */
		    and a.DRUS_CD = 'CHV' 				/* 용법코드 */
		    and b.RPMD_ID = 'VCR' 		/* 성분ID */
		    and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrMethYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrMethYn (빈크리스틴 투약오류 예방) 
        Description :                                           시타라빈, 메토트렉세이트, 하이드로코티손 처방이 있는지 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrMethYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrMethYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrMethYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrMethYn */
		 select decode(count(1), 0, 'N', 'Y') as YN
		   from MDMEDORDT a 					/* 약처방 */
		      , SDDDGCDMT b 					/* 약품코드 */
		  where b.MDPR_CD = a.ORDR_CD 			/* 약품코드 */
		    and a.PTNO = #{ptno}	 			/* 환자번호 */
		    and a.ORDR_YMD = to_date(#{ordrYmd},'yyyymmdd') /* 처방일자 */
		    and nvl(a.DC_DVSN_CD, 'N') = 'N' 	/* DC구분코드 */
		    and a.ORDR_CLTY_CD = 'B1' 			/* 처방분류유형코드 (B1 : 주사약, B2:경구약) */
		    and a.DRUS_CD = 'ITC' 				/* 용법코드 */
		    and b.RPMD_ID in ('CAD', 'MTX', 'HC') /* 성분ID */
		    and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0060-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ddcn" column="DDCN"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="mcdpCd" column="MCDP_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0060 () 
        Description :                                           항우울제 계열 약품이 7일이상 여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0060-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0060"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0060-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0060 */
		<![CDATA[
		SELECT  SUBSTR(MAX(TO_CHAR(A.ORDR_YMD+A.DDCN,'YYYYMMDD')||TO_CHAR(A.ORDR_YMD,'YYYYMMDD')||LPAD(TO_CHAR(A.DDCN),5,'0')),9,8) ORDR_YMD
		       ,SUBSTR(MAX(TO_CHAR(A.ORDR_YMD+A.DDCN,'YYYYMMDD')||TO_CHAR(A.ORDR_YMD,'YYYYMMDD')||LPAD(TO_CHAR(A.DDCN),5,'0')),17,5) DDCN
		       ,SUBSTR(MAX(TO_CHAR(A.ORDR_YMD+A.DDCN,'YYYYMMDD')||TO_CHAR(A.ORDR_YMD,'YYYYMMDD')||B.ORDR_NM),17,100) ORDR_NM
		       ,SUBSTR(MAX(TO_CHAR(A.ORDR_YMD+A.DDCN,'YYYYMMDD')||TO_CHAR(A.ORDR_YMD,'YYYYMMDD')||C.ABRV_DPRT_CD),17,10) MCDP_CD
		  FROM MDMEDORDT A
		      ,MDORDRCMT B
		      ,HZDEPTMMT C
		  WHERE 1=1
		    AND A.PTNO = #{ptno}
		    AND A.ORDR_YMD BETWEEN TRUNC(ADD_MONTHS(TO_DATE(#{ordrYmd},'YYYYMMDD'),-3)) AND TO_DATE(#{ordrYmd},'YYYYMMDD')
		    AND NVL(A.DC_DVSN_CD,'N') = 'N'
		    AND A.ORDR_YMD+A.DDCN-TO_DATE(#{ordrYmd},'YYYYMMDD') >=7     
		    AND A.ORFR_CD <> 'S' -- 지참약 아님;    
		    AND B.ORDR_CD  = A.ORDR_CD
		    --AND B.MEGR_CD = '117' --정신 신경요제, 확인필요
		    AND A.ORDR_CD in (SELECT MDPR_CD
		                        FROM SDDGEFFCT 
		                       WHERE EFCC_LRCL_CD ||EFCC_MDCS_CD||EFCC_SMCL_CD = '281604' --항우울제 효능코드
		                     )   
		    AND C.DPRT_CD  = A.MCDP_CD
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0061-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0061 () 
        Description :                                           근골격계 상병 존재 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0061-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0061"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0061-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneK0061 */
		<![CDATA[
		SELECT DECODE(COUNT(1),0,'N','Y') as Yn
		  FROM MDPADIAGT A
		 WHERE 1=1
		   AND MDRP_NO =#{mdrpNo}
		   AND EXISTS (SELECT  'Y'
		                 FROM MZCTRLMMT B
		                WHERE B.MDCR_CTRL_CD = 'MDK_0024' --근골격계 상병
		                  AND SUBSTR(A.SCIN_CD,1,B.MDCR_CTRL_NMBR_VL1) = B.MDCR_DTLS_CTRL_CD
		              )
		   AND ROWNUM = 1 
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugBefrOrdrTotlQty-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totlQty" column="TOTL_QTY"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugBefrOrdrTotlQty () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugBefrOrdrTotlQty-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugBefrOrdrTotlQty"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugBefrOrdrTotlQty-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugBefrOrdrTotlQty */
		select nvl(sum(PCKN_UNAD_QTY * NTM), 0) as TOTL_QTY
		  from MDMEDORDT
		 where PTNO = #{ptno}
		   and ORDR_CD = #{ordrCd}
		   and ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		   and (INJC_PRRN_YMD is null or INJC_PRRN_YMD = ORDR_YMD)
		   and TMPR_ORDR_YN = 'N'
		   and DC_DVSN_CD = 'N'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugBefrOrdrTotlQty-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="pcknUnadQty" column="PCKN_UNAD_QTY"/>
		<result property="ntm" column="NTM"/>
		<result property="totlQtyClclYn" column="TOTL_QTY_CLCL_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugBefrOrdrTotlQty () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugBefrOrdrTotlQty-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugBefrOrdrTotlQty"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugBefrOrdrTotlQty-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugBefrOrdrTotlQty */
		select a.ORDR_CD as ORDR_CD
		       ,  a.ORDR_CLTY_CD
		       ,  a.PCKN_UNAD_QTY as PCKN_UNAD_QTY
		       ,  a.NTM as NTM
		       ,  b.TOTL_QTY_CLCL_YN as TOTL_QTY_CLCL_YN
		  from MDMEDORDT a
		       ,  SDDDGCDMT b
		 where PTNO = #{ptno}
		   and ORDR_CD = #{ordrCd}
		   and ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		   and ODKI_CD = #{odkiCd}
		   and ORDR_SNO != #{ordrSno}
		   and (INJC_PRRN_YMD is null or INJC_PRRN_YMD = ORDR_YMD)
		   and TMPR_ORDR_YN = 'N'
		   and DC_DVSN_CD = 'N'
		   and a.ORDR_CD = b.MDPR_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnYn () 
        Description :                                           TPN조성처방 발행유무 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnYn-result" useCache="true" flushCache="false">
		  select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTpnYn */
		           decode(count(*), 0, 'N', 'Y') as YN  
		   from  MDORDRCMT a
		         ,  SDDDGCDMT b
		  where  a.ORDR_CD = #{ordrCd}
		    and  a.ORDR_PSBL_DVSN_CD =   'Y'
		--    and  a.MDPR_CLSF_CD      =   '8'     /* 약품분류 : 8-TPN */
		--    and  b.PRCH_DGPR_DVSN_CD =   '2'    /* 구입제제 구분 : 1-구입약, 2-제제약 */
		    and  ORDR_CD in (select  PHRM_DTLS_CTRL_CD
		                       from  SDMCTRLMT
		                      where  1=1
		                      <choose>
		                       <when test='chrcVl == "BAG"'>
		                        and  #{chrcVl} = 'BAG'
		                        and  PHRM_CTRL_CD = 'SDH_036' /* 조성처방은 필요없지만 TPN처방이라 BAG이 자동으로 발생되어야 하는 처방 2021.01.29 obh */
		                       </when>
		                       <otherwise>
		                        and  PHRM_CTRL_CD = 'SDH_034' /* 조성처방 대상목록 약국제어코드로 관리. 2020.11.11 obh */
		                       </otherwise>
		                      </choose>
		                    ) 
		    and  b.MDPR_CD           =   a.ORDR_CD
		    and not exists ( select 1 from MDTPNORDT c   
		                           where  c.PTNO  = #{ptno}
		                              and  c.ORDR_YMD  = to_date(#{ordrYmd}, 'YYYYMMDD')   
		                              and  c.TPN_ORDR_CD = a.ORDR_CD
		                         )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCKDDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCKDDiagYn () 
        Description :                                           만성신질환이 있으면 N 당뇨병 적정성 평가 제외
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCKDDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCKDDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCKDDiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCKDDiagYn */
		SELECT DECODE(COUNT(1),0,'Y','N') AS YN
		  FROM MDPADIAGT A      
		 WHERE 1=1  
		   AND MDRP_NO =#{mdrpNo}
		   AND EXISTS (SELECT  Y
		                 FROM MZCTRLMMT B
		                WHERE B.MDCR_CTRL_CD = 'MDK_0040' --만성신질환
		                  AND SUBSTR(A.SCIN_CD,1,B.MDCR_CTRL_NMBR_VL1) = B.MDCR_DTLS_CTRL_CD
		                  AND TRUNC(SYSDATE) BETWEEN B.APST_YMD AND B.APFN_YMD
		               )
		   AND ROWNUM = 1 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWntdYmdDtlcScexOrdrInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="mcdpCd" column="MCDP_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWntdYmdDtlcScexOrdrInfm (안암 입원, 응급 검체검사 희망일 기준 중복검체처방 알림메시지 : 당일 동일검사 처방일 가져오기) 
        Description :                                           안암 입원, 응급 검체검사 희망일 기준 중복검체처방 알림메시지 : 당일 동일검사 처방일 가져오기
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWntdYmdDtlcScexOrdrInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWntdYmdDtlcScexOrdrInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWntdYmdDtlcScexOrdrInfm-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWntdYmdDtlcScexOrdrInfm */
		<![CDATA[
		SELECT  
		        TO_CHAR(B.ORDR_YMD, 'YYYYMMDD')   AS ORDR_YMD       /* 처방일자 */
		      , C.ORDR_NM                         AS ORDR_NM        /* 처방명 */
		/*    , B.MCDP_CD                         AS MCDP_CD  */    /* 진료과코드 */
		      , D.ABRV_DPRT_CD                    AS MCDP_CD        /* 진료과 약어 */
		  FROM  MDEXMORDT B  /* [검사처방] */
		      , MDORDRCMT C  /* [처방코드 마스터] */
		      , HZDEPTMMT D  /* [진료과 마스터] */
		 WHERE  1=1
		   AND  B.ORDR_CD      = C.ORDR_CD              /* 처방코드 */ 
		   AND  B.MCDP_CD      = D.DPRT_CD              /* 진료과코드 */ 
		   AND  B.PTNO         = #{ptno}                /* 환자번호 */
		   AND  B.ORDR_CD      = #{ordrCd}              /* 오더코드 */
		/*   AND  B.MDRP_NO     <> #mdrpNo  */            /* 진료접수번호 */
		   AND  (     B.ORDR_YMD    <> TRUNC(SYSDATE)
		          OR  B.MCDP_CD     <> #{mcdpCd}
		        )
		   AND  B.MCDP_CD      NOT IN ( SELECT  NVL2(MAX(X.MDCR_DTLS_CTRL_CD), #{mcdpCd}, '*') 
		                                  FROM  MZCTRLMMT X 
		                                 WHERE  X.MDCR_CTRL_CD  = 'MM911' 
		                                   AND  X.MDCR_DTLS_CTRL_CD = #{gvUserId}
		                                   AND  ROWNUM = 1
		                              )                 /* 진료과 (특정인의 경우 본인의 진료과는 제외하고 조회)*/
		   AND  B.DC_DVSN_CD   = 'N'                    /* DC구분코드(Y/N/...) */
		   AND  B.TMPR_ORDR_YN = 'N'                    /* 임시처방여부(Y/N) */
		   AND  B.WNTD_DT      BETWEEN TO_DATE(SUBSTR(#{wntdDt}, 1, 8), 'YYYYMMDD') AND TO_DATE(SUBSTR(#{wntdDt}, 1, 8), 'YYYYMMDD') + 0.99999  /* 희망일시 */
		   AND  C.ORDR_CLTY_CD = 'C1'                   /* 처방분류유형코드(C1:검체검사) */
		   AND  ROWNUM = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneYr1WthnExorWrnn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="enfrDt" column="ENFR_DT"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrNm" column="ORDR_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneYr1WthnExorWrnn (희망일 기준 헤모글로빈 검사 등 3개월이내 실시 검사 삭감 알람) 
        Description :                                           12개월 전처방으로 조회하되 검사일이 3개월이내인 것 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneYr1WthnExorWrnn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneYr1WthnExorWrnn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneYr1WthnExorWrnn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneYr1WthnExorWrnn */
		<![CDATA[
		SELECT  /*+ INDEX_DESC(A MDEXMORDT_PK) */
		        TO_CHAR(A.ENFR_DT,  'YYYYMMDD')   AS ENFR_DT        /* 시행일자 */
		      , TO_CHAR(A.ORDR_YMD, 'YYYYMMDD')   AS ORDR_YMD       /* 처방일자 */
		      , #{ordrNm}                         AS ORDR_NM        /* 처방명 */
		  FROM  MDEXMORDT A  /* [검사처방] */
		 WHERE  1=1
		   AND  'Y'            = (SELECT  NVL2(MAX(X.MDCR_DTLS_CTRL_CD), 'Y', 'N') 
		                            FROM  MZCTRLMMT X 
		                           WHERE  X.MDCR_CTRL_CD      = 'MM912'                           /* 처방시 제한/경고 항목 - 검사실시후 일년이내 처방 경고 메시지 */
		                             AND  X.MDCR_DTLS_CTRL_CD = #{ordrCd}                         /* 처방코드 */
		                             AND  TRUNC(SYSDATE)      BETWEEN X.APST_YMD AND X.APFN_YMD  /* 적용기간 */
		                             AND  ROWNUM = 1
		                         )
		   AND  A.PTNO         = #{ptno}                /* 환자번호 */
		   AND  A.ORDR_YMD     BETWEEN ADD_MONTHS(TO_DATE(SUBSTR(#{wntdDt}, 1, 8), 'YYYYMMDD'), -12) AND TO_DATE(SUBSTR(#{wntdDt}, 1, 8), 'YYYYMMDD')             /* 처방일자(희망일-12개월 ~ 희망일) */
		   AND  A.ENFR_DT      BETWEEN ADD_MONTHS(TO_DATE(SUBSTR(#{wntdDt}, 1, 8), 'YYYYMMDD'), -3)  AND TO_DATE(SUBSTR(#{wntdDt}, 1, 8), 'YYYYMMDD') + 0.99999   /* 시행일시(희망일-3개월  ~ 희망일) */
		   AND  A.CLRS_PRJC_CD IS NULL                  /* 임상연구과제코드 (제외처리) */
		/* AND  A.MDRP_NO     <> #mdrpNo  */          /* 진료접수번호 */
		   AND  (     A.ORDR_YMD    <> TRUNC(SYSDATE)
		          OR  A.MCDP_CD     <> #{mcdpCd}
		        )
		   AND  A.DC_DVSN_CD   = 'N'                    /* DC구분코드(Y/N/...) */
		   AND  A.TMPR_ORDR_YN = 'N'                    /* 임시처방여부(Y/N) */
		   AND  EXISTS  ( SELECT  'X'                   /* ASIS: ('05') 처방 제한코드 MDMCOMCT.COMCD1=550 */
		                    FROM  MZCTRLMMT X 
		                   WHERE  X.MDCR_CTRL_CD      = 'MM912'                           /* 처방시 제한/경고 항목 - 검사실시후 일년이내 처방 경고 메시지 */
		                     AND  X.MDCR_DTLS_CTRL_CD = A.ORDR_CD                         /* 처방코드 */
		                     AND  TRUNC(SYSDATE)      BETWEEN X.APST_YMD AND X.APFN_YMD  /* 적용기간 */
		                )
		   AND  ROWNUM = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMvmnDvsnCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="mvmnDvsnCd" column="MVMN_DVSN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMvmnDvsnCd (검사처방 PORTABLE 가능유무) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMvmnDvsnCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMvmnDvsnCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMvmnDvsnCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMvmnDvsnCd */
		select MVMN_DVSN_CD
		 from MDORDRCMT
		where ORDR_CD = #{ordrCd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhdpPrinYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhdpPrinYn (약처방 약제부출력여부 조회) 
        Description :                                           약처방의 약제부출력여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhdpPrinYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhdpPrinYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhdpPrinYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhdpPrinYn */
		 select decode(count(1), 0, 'N', 'Y') as YN
		   from MDMEDORDT
		 where PTNO = #{ptno}
		   and ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		   and MDRP_NO = #{mdrpNo}
		   and IHOH_DVSN_CD = #{ihohDvsnCd}
		   and DC_DVSN_CD = 'N'
		   and PHDP_PRIN_YN = 'Y'
		   /* 원외약은 수납되었으면 일괄 취소 후 처방 가능 */
		   /* 원내약은 경구/외용/자가주사인 경우 일괄 수납 취소,처방D/C 후 처방 가능 */
		   /* 원내주사약은 수납과 관계없이 계속 처방 가능 */
		 <if test='ihohDvsnCd == "I"'>
		   and (FRNS_DPRT_CD = FN_CC_GET_DPRT_CD('DPRT_PHD') or nvl(OSLF_ADMN_DRUG_YN, 'N') = 'Y') 
		 </if>
		 <if test='ihohDvsnCd == "O"'>
		   and nvl(SUB_TYPE_CD, 'ZZ') = nvl(#{subTypeCd}, 'ZZ')
		 </if>
		   and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChemo25Over-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
		<result property="totqty" column="TOTQTY"/>
		<result property="pcknUnadQty" column="PCKN_UNAD_QTY"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChemo25Over (항암제처방시 전처방 용량체크) 
        Description :                                           항암제 처방시 전처방 용량 25% 초과여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChemo25Over-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChemo25Over"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChemo25Over-result" useCache="true" flushCache="false">
		<![CDATA[
		       select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChemo25Over */
		               case when (((b.PCKN_UNAD_QTY * b.NTM) - ((b.PCKN_UNAD_QTY * b.NTM) * (to_number('25') / 100)) ) >(to_number(#{pcknUnadQty}) * to_number(#{ntm}) ) ) or
		                         (((b.PCKN_UNAD_QTY * b.NTM) + ((b.PCKN_UNAD_QTY * b.NTM) * (to_number('25') / 100)) ) < (to_number(#{pcknUnadQty}) * to_number(#{ntm}) )) then 'Y' else 'N' end as YN
		             , (b.PCKN_UNAD_QTY * b.NTM) totqty
		             , b.PCKN_UNAD_QTY
		]]>
		          from
		               MDMEDORDT b,
		               (
		                select
		                       a.PTNO
		                     , a.ORDR_YMD
		                     , a.ORDR_SNO
		                     , RANK() OVER (PARTITION BY a.PTNO ORDER BY a.ORDR_YMD desc, a.ORDR_SNO desc) as LASTROW
		                  from
		                       MDMEDORDT a
		                 where 1=1
		                   and a.PTNO    = #{ptno} 
		                   and a.ORDR_YMD  between add_months(to_date(#{ordrYmd}, 'yyyymmdd'), -1 * to_number('3') ) and to_date(#{ordrYmd}, 'yyyymmdd')
		                   and a.DC_DVSN_CD = 'N'
		                   and a.TMPR_ORDR_YN = 'N'
		                   and a.ORDR_CD    = #{ordrCd} 
		               ) a
		         where 1=1
		           and a.LASTROW  = 1
		           and b.PTNO    = a.PTNO
		           and b.ORDR_YMD  = a.ORDR_YMD
		           and b.ORDR_SNO = a.ORDR_SNO 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listCtrlCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="mdcrDtlsCtrlCd" column="MDCR_DTLS_CTRL_CD"/>
		<result property="mdcrDtlsCtrlNm" column="MDCR_DTLS_CTRL_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listCtrlCd () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listCtrlCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listCtrlCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listCtrlCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listCtrlCd */
		select
		    a.MDCR_DTLS_CTRL_CD 		AS MDCR_DTLS_CTRL_CD
			, a.MDCR_DTLS_CTRL_NM 	AS MDCR_DTLS_CTRL_NM
		from  
		    MZCTRLMMT a 
		where  
		    a.MDCR_CTRL_CD      = #{mdcrCtrlCd}
		    and trunc(sysdate) between a.APST_YMD and a.APFN_YMD
		order by a.MDCR_DTLS_CTRL_CD
		;
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDual-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="orctCd" column="ORCT_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDual () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDual-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDual"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDual-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDual */
		select '' as ORCT_CD
		  from dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugSdpfExreCd45Yn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugSdpfExreCd45Yn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugSdpfExreCd45Yn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugSdpfExreCd45Yn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugSdpfExreCd45Yn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugSdpfExreCd45Yn */
		select  decode(count(*), 0, 'Y', 'N') as YN
		  from  MDMEDORDT
		 where  MDRP_NO = #{mdrpNo}
		   and  PTNO = #{ptno}
		   and  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
		   and  CODV_CD = 'O'
		   and  DC_DVSN_CD = 'N'
		   and  TMPR_ORDR_YN = 'N'
		   and  IHOH_DVSN_CD = 'I'
		   and  SDPF_EXRE_CD = '45'  /* 예외사유 : *제제,임상,마약,방사성,희귀,투석,이식정 */
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckTbrcScinYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
		<result property="ordrCd" column="ORDR_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckTbrcScinYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckTbrcScinYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckTbrcScinYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckTbrcScinYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckTbrcScinYn */
		select  decode(count(b.SCIN_CD), 0, 'Y', 'N') as YN
		       ,  #{ordrCd} as ORDR_CD
		  from  QDCTRLMMT a
		     ,  MDPADIAGT b
		 where  a.IFMN_CTRL_CD = 'QDT_SCIN_CD'
		   and  b.MDRP_NO = #{mdrpNo}
		   and  substr(b.SCIN_CD, 1, 3) = a.IFMN_DETL_CTRL_VL
		<if test='ordrCd == "ASPE"'>
		  and a.IFMN_DETL_CTRL_VL not in ('A17' ,'A18', 'A19')
		</if>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckScinBurnsYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckScinBurnsYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckScinBurnsYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckScinBurnsYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckScinBurnsYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCeckScinBurnsYn */
		<![CDATA[
		SELECT decode(count(SCIN_CD), 0, 'Y', 'N') AS YN
		  FROM MDPADIAGT A
		 WHERE A.MDRP_NO = #{mdrpNo}
		   AND A.SCIN_CD LIKE 'T%'
		   AND substr(A.SCIN_CD, 2, 3) >= 20
		   AND substr(A.SCIN_CD, 2, 3) <= 31
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnCountForYear-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
		<result property="rsltVl" column="RSLT_VL"/>
		<result property="strtYmd" column="STRT_YMD"/>
		<result property="enfrDt" column="ENFR_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnCountForYear () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnCountForYear-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnCountForYear"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnCountForYear-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnCountForYear */
		SELECT 'Y'                                  AS YN
			 , count(*)                             AS RSLT_VL
			 , to_char(min(ENFR_DT), 'yyyy-mm-dd') AS STRT_YMD
			 , to_char(max(ENFR_DT), 'yyyy-mm-dd') AS ENFR_DT
		  FROM MDEXMORDT
		 WHERE ORDR_CD = #{ordrCd}
		   AND PTNO = #{ptno}
		   AND ENFR_DT between to_date(substr(#{wntdDt}, 1, 8), 'yyyymmdd') - 365 and to_date(substr(#{wntdDt}, 1, 8), 'yyyymmdd')
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneReductOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneReductOrdrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneReductOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneReductOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneReductOrdrYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneReductOrdrYn */
		<![CDATA[
				   select  decode(sign(count(c.MDFE_CD) -1) , 0, 'Y', 1, 'Y', 'N') as YN
				    from  AIRRNFCLT x       -- 통보서
				        , AIRRNFORT a       -- 삭감처방
				        , AICRSPCFT b       -- 청구명세서
				        , AICRORDRT C       -- 청구처방
				      WHERE x.JDDC_RDMP_NTFC_YMD >= trunc(sysdate - 90)     --통보일자
				      and a.CLAM_NO   = x.CLAM_NO
				      and a.RPTN_NO   = x.RPTN_NO
				      and a.CHCK_ORNO = x.CHCK_ORNO
				      and x.JDDC_ADJM_DVSN_CD = 'A' -- 심결
				      and b.CLAM_NO = a.CLAM_NO
				      and b.RPTN_NO = a.RPTN_NO
				      and b.CHAF_CLSP_SNO = a.CLSP_SNO
				      and b.CLPR_VL = a.CLPR_VL
				      and c.CLPR_VL = b.CLPR_VL
				      and c.ORLI_NO = a.ORLI_NO
				      and b.ptno    = #{ptno}        -- 환자번호
				      and b.CODV_CD = 'O'           -- 내원구분(입원(I)/외래(O))             		      
				      and c.CHAF_MDDR_ID = #{oddrId}
				      and c.ORDR_CD      = #{ordrCd} -- 처방코드
				]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHemophiliaDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHemophiliaDiagYn () 
        Description :                                           혈우병 상병 존재 여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHemophiliaDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHemophiliaDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHemophiliaDiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHemophiliaDiagYn */
		<![CDATA[
		SELECT DECODE(COUNT(1),0,'N','Y') as Yn
		  FROM MDPADIAGT A
		 WHERE 1=1
		   AND MDRP_NO =#{mdrpNo}
		   AND EXISTS (SELECT  Y
		                 FROM MZCTRLMMT B
		                WHERE B.MDCR_CTRL_CD = 'MDK_0025' --혈우병 상병
		                  AND SUBSTR(A.SCIN_CD,1,B.MDCR_CTRL_NMBR_VL1) = B.MDCR_DTLS_CTRL_CD
		              )
		   AND ROWNUM = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIcuYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIcuYn (selectOneIcuYn) 
        Description :                                           selectOneIcuYn
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIcuYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIcuYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIcuYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIcuYn */
				select decode(count(1), 0, 'N', 'Y') as YN
				from APCTRLMMT e
				where e.PTNT_CTRL_CD = 'APZ_007'
				and e.PTNT_DTLS_CTRL_CD = #{wardCd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDmntExmnReVltnCeckYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDmntExmnReVltnCeckYn (치매검사 재평가 체크 (6개월 ~1년이내)) 
        Description :                                           치매검사 재평가 체크 (6개월 ~1년이내)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDmntExmnReVltnCeckYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDmntExmnReVltnCeckYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDmntExmnReVltnCeckYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDmntExmnReVltnCeckYn */
		SELECT
		        DECODE(SIGN(270 - (TO_DATE(#{ordrYmd}, 'YYYYMMDD') - TRUNC(A.ENFR_DT))), 1, 'Y', 'N')    AS yn   /* 270일이상 지난경우 N (안내 메세지 팝업 대상) */
		  FROM  (
		          SELECT  MAX(A.ENFR_DT)  AS ENFR_DT
		            FROM  MDEXMORDT A   /* 검사처방 */
		           WHERE  1=1
		             AND  A.PTNO          = #{ptno}                                                                                     /* 환자번호 */
		             AND  A.ENFR_DT       BETWEEN TO_DATE(#{ordrYmd}, 'YYYYMMDD') - 270 AND TO_DATE(#{ordrYmd}, 'YYYYMMDD') + 0.99999   /* 시행일시 */
		             and  A.DC_DVSN_CD    = 'N'                                                                                         /* DC구분코드 */
		             and  A.TMPR_ORDR_YN  = 'N'                                                                                         /* 임시처방여부 */
		             AND  A.ENFR_DT       IS NOT NULL                                                                                   /* 시행일시 */
		             AND  EXISTS  ( SELECT  'X'
		                              FROM  AIMFMDFET X   /* 수가코드 */
		                             WHERE  X.MDFE_CD       = A.ORDR_CD                         -- 수가코드 = 처방코드
		                               AND  A.ORDR_YMD      BETWEEN X.APST_YMD AND X.APFN_YMD   -- 처방일자
		                               AND  X.INSR_EDI_CD   IN ('F6212', 'F6222', 'F6221')      -- 보험EDI코드 ('F6212', 'F6222', 'F6221' - 제어코드: ?????)
		                          )
		        )   A
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneStsmMdtePsblYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneStsmMdtePsblYn (금연치료오더발행가능여부) 
        Description :                                           금연치료오더발행가능여부 (N:메시지 팝업 없음, 1~3: 각 메시지 팝업 및 오더 발행 금지)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneStsmMdtePsblYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneStsmMdtePsblYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneStsmMdtePsblYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneStsmMdtePsblYn */
		SELECT
		        CASE
		            WHEN  A.HSPT_ABRV = 'AA'                                                  THEN A.ISTY_YN  /* 안암-모든과 가능-산재/자보 경우 1번 메시지 그 외 패스 */
		            WHEN  A.HSPT_ABRV = 'GR' AND #{mcdpCd} = SEHRFUN.FN_CC_GET_CNST_VL('CCD_001', 'DPRT_FM')       THEN A.ISTY_YN  /* 구로-FM만 가능-산재/자보 경우 1번 메시지 그 외 패스 */
		            WHEN  A.HSPT_ABRV = 'AS' AND #{mcdpCd} IN (SEHRFUN.FN_CC_GET_CNST_VL('CCD_001', 'DPRT_FM'), SEHRFUN.FN_CC_GET_CNST_VL('CCD_001', 'DPRT_PY'), SEHRFUN.FN_CC_GET_CNST_VL('CCD_001', 'DPRT_SLPY'))  THEN A.ISTY_YN  /* 안산-FM, PY, SLPY 가능-산재/자보 경우 1번 메시지 그 외 패스 */
		            WHEN  A.HSPT_ABRV = 'AS'                                                  THEN '2'        /* 안산-2번 메시지 */
		            ELSE  '3'                                                                                 /* 그외-3번 메시지(안암/구로) */
		        END     AS YN
		  FROM  (
		          SELECT  DECODE(#{gvHsptCd}
		                    , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_FIRST'),  'AA'  /* 1 - 안암 */
		                    , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_SECOND'), 'GR'  /* 2 - 구로 */
		                    , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_THIRD'),  'AS'  /* 3 - 안산 */
		                    , 'AA'                                                  /* 1 - 안암 */
		                  )       AS HSPT_ABRV
		                , CASE
		                    WHEN SUBSTR(A.ISTY_CD, 1, 1) IN ('3', '5') THEN '1' /* 산재(3), 자보(5) 불가 - 1번 메세지 */
		                    ELSE 'N'
		                  END     AS ISTY_YN    /* 보험종류에 따른 조건 체크 */
		            FROM  APRCRPTNT   A  /* 진료접수 */
		           WHERE  A.MDRP_NO     = #{mdrpNo}   /* 진료접수번호 */
		        )   A
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneInsInfoActTime1-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="notify" column="NOTIFY"/>
		<result property="insinfo" column="INSINFO"/>
		<result property="insinfo2" column="INSINFO2"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneInsInfoActTime1 () 
        Description :                                           처방시 인정기준 정보조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneInsInfoActTime1-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneInsInfoActTime1"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneInsInfoActTime1-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneInsInfoActTime1 */
		select
		          a.NOTIFY,
		          b.INSINFO,
		          b.INSINFO2
		  from
		             /* MAINSTGT */
		             (
		                 select  ORDR_CD                    AS ORDR_CD
		                        ,  SEQN_SNO                   AS SEQNO
		                        ,  TRGT_SNO                    AS TGTSEQ
		                        ,  DLVY_CTN                     AS NOTIFY
		                        ,  GEND_CD                     AS GEND_CD
		                        ,  AGE_CTN                      AS AGE
		                        ,  AGE_PRSG_CNDT_CD      AS AGEFLAG
		                   from MDQINSTGT
		               ) a,
		              /* MAINSINT */
		              (
		                 select   ORDR_CD                      AS ORDR_CD
		                           ,SEQN_SNO                     AS SEQNO
		                           ,INSR_ACKN_BASE_CTN     AS INSINFO
		                           ,INSR_ACKN_BASE_2_CTN   AS INSINFO2
		                           ,MEMO_CTN                    AS MEMO
		                  from MDQINSINT
		               ) b
		         where
		                    a.ORDR_CD    = #{ordrCd}
		             and a.SEQNO      = #{seqno}
		             and a.TGTSEQ     = nvl(#{tgtseq}, a.TGTSEQ)
		             and (a.GEND_CD is null or a.GEND_CD = #{gendCd})
		<![CDATA[
		           and (
		                    (a.AGEFLAG is null ) or
		                    (a.AGEFLAG = '1' and to_number(a.AGE) <= #{age}) or  /* 이상 */
		                    (a.AGEFLAG = '2' and to_number(a.AGE) >= #{age}) or  /* 이하 */
		                    (a.AGEFLAG = '3' and to_number(a.AGE) < #{age})  or  /* 초과 */
		                    (a.AGEFLAG = '4' and to_number(a.AGE) > #{age})  or  /* 미만 */
		                    (a.AGEFLAG = '5' and to_number(a.AGE) = #{age})      /* 같음 */
		               )
		 ]]>
		           and b.ORDR_CD   = a.ORDR_CD
		           and b.SEQNO      = a.SEQNO
	</select>







   <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-executeSpMdInsCheck () 
        Description : 보험인정기준 선택메시지 표시 체크

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
    -->	
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-executeSpMdInsCheck"  statementType="CALLABLE"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-executeSpMdInsCheck */
		{ call
		                SP_MD_INS_CHECK
		                        (    #{ptno, mode=IN, jdbcType=VARCHAR, javaType=string}                 --환자번호
		   	                      ,  #{codvCd, mode=IN, jdbcType=VARCHAR, javaType=string}             -- 내원구분
			                      ,  #{ordrCd, mode=IN, jdbcType=VARCHAR, javaType=string}              -- 처방코드
		       	                  ,  #{ordrYmd, mode=IN, jdbcType=VARCHAR, javaType=string}            -- 처방일자
			                      ,  #{ordrCltyCd, mode=IN, jdbcType=VARCHAR, javaType=string}         -- 처방구분
			                      ,  #{slipCd, mode=IN, jdbcType=VARCHAR, javaType=string}               -- SLIP CODE
			                      ,  #{userId, mode=IN, jdbcType=VARCHAR, javaType=string}               -- 사번
		                          ,  #{userDprtCd, mode=IN, jdbcType=VARCHAR, javaType=string}        -- 사용자부서
		                          ,  #{acttime, mode=IN, jdbcType=VARCHAR, javaType=string}             -- ACTTIME
		                          ,  #{odkiCd, mode=IN, jdbcType=VARCHAR, javaType=string}
		                          ,  #{ihohDvsnCd, mode=IN, jdbcType=VARCHAR, javaType=string}
		                          ,  #{mdcrDt, mode=IN, jdbcType=VARCHAR, javaType=string}
		                          ,  #{mdrpNo, mode=IN, jdbcType=VARCHAR, javaType=BigDecimal}
		                          ,  #{mcdpCd, mode=IN, jdbcType=VARCHAR, javaType=string}
		                          ,  #{chdrId, mode=IN, jdbcType=VARCHAR, javaType=string}
		                          ,  #{result, mode=INOUT, jdbcType=VARCHAR, javaType=string}          -- 저장결과
		                          ,  #{errYn, mode=INOUT, jdbcType=VARCHAR, javaType=string}          -- 에러여부
		                          ,  #{errCtn, mode=INOUT, jdbcType=VARCHAR, javaType=string}         -- 에러내용
		                        )
		}
	</select>	

	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOne0InsrAcknBaseCeckYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="insrAcknBaseCeckYn" column="INSR_ACKN_BASE_CECK_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOne0InsrAcknBaseCeckYn () 
        Description :                                           보험인정기준 체크처방 유무
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOne0InsrAcknBaseCeckYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOne0InsrAcknBaseCeckYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOne0InsrAcknBaseCeckYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOne0InsrAcknBaseCeckYn */
		select INSR_ACKN_BASE_CECK_YN
		  from MDORDRCMT
		 where ORDR_CD = #{ordrCd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImntRsrrOrdrCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="mainScinYn" column="MAIN_SCIN_YN"/>
		<result property="ctrlDscrCtn" column="CTRL_DSCR_CTN"/>
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImntRsrrOrdrCd (장기이식 면역환자 산정특례 기준 개정 고시관련 대상 Check) 
        Description :                                           - 중증(암) 여부 및 산정특례(장기이식) 진단 존재 여부 및 면역억제제 오더코드 리스트 조회 (구분자로 구성)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImntRsrrOrdrCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImntRsrrOrdrCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImntRsrrOrdrCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImntRsrrOrdrCd */
		<![CDATA[
		SELECT  (
		          SELECT  NVL(MAX(A.MAIN_SCIN_YN), 'X')  AS YN     -- 대상진단없으면 X, 있으면 주상병여부(Y/N) 반환
		            FROM  MDPADIAGT  A   /* 환자상병내역 */
		                , MDPACLNCT  B   /* 환자임상진단내역 */
		           WHERE  1=1
		             AND  A.MDRP_NO           = #{mdrpNo}             /* 진료접수번호 */
		             AND  A.MCDP_CD           = #{mcdpCd}             /* 진료과코드 */
		             AND  B.PTNO              = A.PTNO                /* 환자번호 */
		             AND  B.MDRP_NO           = A.MDRP_NO             /* 진료접수번호 */
		             AND  B.PTNT_CLNC_DX_SNO  = A.PTNT_CLNC_DX_SNO    /* 환자임상진단일련번호 */
		             AND  NVL(B.RUL_OUT_YN,'N')       <> 'Y'                   /* RULE_OUT여부 */
		             AND  EXISTS  ( SELECT  1
		                              FROM  MZCTRLMMT C   /* 진료제어정보 */
		                             WHERE  C.MDCR_CTRL_CD      ='MM712'                        /* 진료제어코드(장기이식-산정특례 대상상병) */
		                               AND  C.MDCR_DTLS_CTRL_CD = A.SCIN_CD                     /* 진료세부제어코드 = 진단코드(1 ~ 지정한 길이만큼 잘라서 비교) */
		                               AND  TRUNC(SYSDATE) BETWEEN C.APST_YMD AND C.APFN_YMD    /* 오늘 = 적용시작일자 ~ 적용종료일자 */
		                          )
		--           AND  ROWNUM = 1
		        )                     AS MAIN_SCIN_YN                 /* 주상병여부(Y/N), 없으면 X */
		      , ( SELECT  '|' || LISTAGG(A.MDCR_DTLS_CTRL_CD, '|') WITHIN GROUP (ORDER BY A.MDCR_DTLS_CTRL_CD) || '|' AS ORDR_CD
		            FROM  MZCTRLMMT A
		           WHERE  A.MDCR_CTRL_CD = 'MM711'
		             AND  TRUNC(SYSDATE) BETWEEN A.APST_YMD AND A.APFN_YMD                      /* 오늘 = 적용시작일자 ~ 적용종료일자 */
		        )                     AS CTRL_DSCR_CTN      /* 면역억제제 오더코드 리스트(오더코드 앞뒤로 구분자 붙임) */
		      , ( SELECT  NVL(MAX('Y'), 'N')
		            FROM  MDPEDCANT A  -- [산정특례중증이력환자]
		                , AIIMASABT B  -- [산정특례적용기준코드]
		           WHERE  A.MDRP_NO           = #{mdrpNo}                             /* 진료접수번호  */
		             AND  B.ASCS_APLY_BASE_CD = NVL(A.SRIL_PTNT_CD, A.ASCS_CD)        /* 산정특례적용기준코드 = NVL(중증환자코드, 산정특례코드) */
		             AND  B.SPCS_DVSN_CD      = '01'                                  /* 특례구분코드  */
		             AND  NVL(A.FNSH_YMD, TRUNC(SYSDATE)) >= TRUNC(SYSDATE)           /* 종료일자 */
		        )                   AS YN                             /* 중증암여부(Y/N)  */
		  FROM  DUAL
		 ]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWrfDplcYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWrfDplcYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWrfDplcYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWrfDplcYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWrfDplcYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneWrfDplcYn */
		<![CDATA[
		SELECT
			case when
				count(a.ordr_cd) > 0 then 'N'
			else
				'Y'
			end as YN
		from
			MDMEDORDT a
			,  MDORDRCMT b
			,  AIMFMDFET c
			,  SDDDGCDMT d
			,  SDAAUDIFT f
		where
			a.PTNO = #{ptno}
			and  a.ORDR_YMD = to_date ( #{ordrYmd}, 'YYYYMMDD' )
			and  a.CODV_CD  = #{codvCd}
		]]>
		<![CDATA[
			and  a.DC_DVSN_CD not in ( 'X' , 'F' , 'E' ) /*  취소, 실처방 전환, 임시처방 취소 는 조회 제외 */
			and  'TRUE' =
									case
									when a.CODV_CD <> 'O'
								  then
								  		case
								  		when a.MDRP_NO = #{mdrpNo}
											then 'TRUE'
											else 'FALSE'
											end
							 		else 'TRUE'
							 		end
			/*  DC_DVSN_CD 가 'N' 이거나 NULL 인 경우 전체조회 */
			/*  DC_DVSN_CD 임시처방인 경우는 DC_DVSN_CD 'Y' 것도 같이 조회 */
			and  a.ORDR_CD  = b.ORDR_CD(+)
			and  a.ORDR_CD  = c.MDFE_CD(+)
			and  to_date ( #{ordrYmd} , 'YYYYMMDD' ) between c.APST_YMD(+) and c.APFN_YMD (+)
			and  d.MDPR_CD(+) = c.MDFE_CD
			and  d.ORDR_PSBL_DVSN_CD(+) = 'Y'
			/* and  nvl ( ORDR_CRTN_DVSN_CD, '00' ) not in ('08','09','10','11') /*  PRN실시처방, 응급실1차실시처방, 1회추가실시처방 제외 */
			and  a.ORDR_CD = f.MDPR_CD(+)
			and  a.ORDR_CD in ('A1WFR11', 'A1WFR21')
		order	by
			decode(a.ORDR_CRTN_DVSN_CD,'08','ZZZ','09','ZZZ','10','ZZZ','11','ZZZ','1')
			,  a.FRST_RGST_DT
			,  a.SORT_SQNC
			,  a.ORDR_SNO
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSrilMdcrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSrilMdcrYn () 
        Description :                                           산정특례 중증대상 여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSrilMdcrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSrilMdcrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSrilMdcrYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSrilMdcrYn */
		select decode(sign(count(*) -1),0,'Y',1,'Y',-1,'N') yn
		 from APQLQLDLT
		where PTNO =  #{ptno}
		  and ASCS_CLSF_CD in( lower(#{ascsClsfCd}), upper(#{ascsClsfCd}) )
		  and trunc(sysdate) between PTQL_STRT_YMD and PTQL_FNSH_YMD
		  and SRIL_PTNT_APDC_STTS_CD = 'Y' /* 승인 */
		  and SRIL_MDCR_RGST_NO is not null  /* 중증진료 등록번호 */
		;
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbScinYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbScinYn () 
        Description :                                           감염관리 제어 결핵진단 유무 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbScinYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbScinYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbScinYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTbScinYn */
		select decode(SIGN(count(a.SCIN_CD)-1), 1,'Y', 0, 'Y','N') YN
		  from MDPADIAGT a, QDCTRLMMT b
		 where a.PTNO    = #{ptno}
		   and a.MDRP_NO = #{mdrpNo}
		   and b.IFMN_DETL_CTRL_VL = substr(a.SCIN_CD,1,3)
		   and b.IFMN_CTRL_CD =  'QDT_SCIN_CD'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMegrRpmdChk-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMegrRpmdChk () 
        Description :                                           약효군 및 Pyridoxine HCl 성분체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMegrRpmdChk-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMegrRpmdChk"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMegrRpmdChk-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMegrRpmdChk */
		select decode(SIGN(count(x.ORDR_CD)-1), 1,'Y', 0, 'Y','N') YN
		  from
		       (
		        select a.ORDR_CD
		          from MDORDRCMT a
		         where a.MEGR_CD in('613','622')
		           and a.ORDR_CD = #{ordrCd}
		        union all
		        select MDPR_CD as "ORDR_CD"
		          from SDDDGCDMT
		         where MDPR_CD = #{ordrCd}
		           and RPMD_ID = 'VB6'
		        ) x
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImlnTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImlnTrgtYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImlnTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImlnTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImlnTrgtYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImlnTrgtYn */
		<![CDATA[
		select max(case when PTNT_QLDV_CD = 'I' /*  'I' 임플란트 */
		                 and IMLN_MDPC_CD is null /*  임플란트시술코드 (AP277) */
		                 and trunc(sysdate) between nvl(a.IMLN_ISTL_YMD, trunc(sysdate))
		                                        and nvl(a.IMLN_ISTL_YMD, trunc(sysdate)) + 90 /*  임플란트 장착일자 */
		                    then 'Y'
		                    else 'N'
		            end
		       ) as YN /*  급여임플란트 대상여부 */
		  from APQLQLDLT a /*  환자기타자격 */
		 where a.PTNO = #{ptno}
		   and FN_AP_AGE_S(a.PTNO, sysdate) >= 65 /*  65세이상환자 */
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCount-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="rsltVl" column="RSLT_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCount () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCount-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCount"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCount-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCount */
		SELECT count(*) AS RSLT_VL
		  FROM MDTRTORDT
		 WHERE ORDR_CD = #{ordrCd}
		   AND PTNO = #{ptno}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listExmnOrdrHxForYear-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrCnt" column="ORDR_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listExmnOrdrHxForYear (산부인과 비자극 검사 1년 이내 검사내역 조회) 
        Description :                                           산부인과 비자극 검사 1년 이내 검사내역 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listExmnOrdrHxForYear-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listExmnOrdrHxForYear"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listExmnOrdrHxForYear-result" useCache="true" flushCache="false">
		 select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listExmnOrdrHxForYear */
		          ORDR_CD                                                                        as ORDR_CD
		        , min(to_char(ORDR_YMD, 'yyyy-mm-dd'))                              as ORDR_YMD
		        , count(*)                                                                           as ORDR_CNT
		  from MDEXMORDT
		where PTNO = #{ptno}
		   and ORDR_CD in ('SG7325', 'SAE7325', 'BL2000G3')
		   and #{ordrCd} in ('SG7325', 'SAE7325', 'BL2000G3')
		   and to_char(ORDR_YMD, 'yyyy') = substr(#{ordrYmd},1,4)
		   and DC_DVSN_CD = 'N'
		   and nvl(ORDR_IPDV_CD,' ') in ('1',' ')
		group by ORDR_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRhmdOrdrHxForYear-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrCnt" column="ORDR_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRhmdOrdrHxForYear (자보환자에게 증식치료 처방 1년 이내 검사내역 조회) 
        Description :                                           자보환자에게 증식치료 처방 1년 이내 검사내역 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRhmdOrdrHxForYear-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRhmdOrdrHxForYear"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRhmdOrdrHxForYear-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listRhmdOrdrHxForYear */
		 select
		          ORDR_CD                                                                        as ORDR_CD
		        , min(to_char(ORDR_YMD, 'yyyy-mm-dd'))                              as ORDR_YMD
		        , count(*)                                                                           as ORDR_CNT
		  from MDREHORDT
		where PTNO = #{ptno}
		   and ORDR_CD in ('FH100', 'FH101', 'FH102', 'FH103', 'F200710')
		   and #{ordrCd} in ('FH100', 'FH101', 'FH102', 'FH103', 'F200710')
		   and to_char(ORDR_YMD, 'yyyy') = substr(#{ordrYmd},1,4)
		   and DC_DVSN_CD = 'N'
		   and nvl(ORDR_IPDV_CD,' ') in ('1',' ')
		group by ORDR_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnOrdrElpsForYear-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrElps" column="ORDR_ELPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnOrdrElpsForYear (치매약 삭감예방 관련 1년 이낸 검사경과 내역 조회) 
        Description :                                           치매약 삭감예방 관련 1년 이낸 검사경과 내역 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnOrdrElpsForYear-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnOrdrElpsForYear"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnOrdrElpsForYear-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneExmnOrdrElpsForYear */
		 select
		          nvl(max(to_char(ORDR_YMD, 'yyyy-mm-dd')), '9999-12-31')                                                                                                       as ORDR_YMD
		        , nvl((to_date(to_char(max(ORDR_YMD),'yyyymmdd'),'yyyymmdd') - to_date(#{ordrYmd},'yyyymmdd')) + 1, 0)      as ORDR_ELPS
		  from AIMFMDFET, MDEXMORDT
		where INSR_EDI_CD in ('F6221','F6222','F6261')
		   and to_date(#{ordrYmd}, 'yyyymmdd') between APST_YMD and APFN_YMD
		   and ORDR_CD =  MDFE_CD
		   and PTNO = #{ptno}
		   and to_char(ORDR_YMD, 'yyyy') = substr(#{ordrYmd},1,4)
		   and DC_DVSN_CD = 'N'
		   and nvl(ORDR_IPDV_CD,' ') in ('1',' ')
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForMonth-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="mcdpAbrvCd" column="MCDP_ABRV_CD"/>
		<result property="ordrQty" column="ORDR_QTY"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForMonth (듀로제식 디트랜스 패치는 월 이내 내역 조회) 
        Description :                                           듀로제식 디트랜스 패치는 월 이내 내역 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForMonth-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForMonth"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForMonth-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForMonth */
		 select
		          to_char(a.ORDR_YMD, 'yyyy-mm-dd')                                     as ORDR_YMD
		        , a.MCDP_CD                                                                        as MCDP_CD
		        , b.MCDP_ABRV_CD                                                               as MCDP_ABRV_CD
		        , a.PCKN_UNAD_QTY * a.NTM * a.DDCN                                    as ORDR_QTY
		        , a.ORDR_CD                                                                         as ORDR_CD
		        , a.ORDR_SNO                                                                       as ORDR_SNO
		  from MDMEDORDT a, MRCDPRTCT b
		where a.PTNO = #{ptno}
		   and a.ORDR_CD in ('FEND1H-T','FEND50-T','FEND25-T', 'FEND12-T')
		   and #{ordrCd} in ('FEND1H-T','FEND50-T','FEND25-T', 'FEND12-T')
		   and to_char(a.ORDR_YMD, 'yyyymm') = substr(#{ordrYmd},1,6)
		   and a.DC_DVSN_CD = 'N'
		   and nvl(a.ORDR_IPDV_CD,' ') in ('1',' ')
		   and b.MCDP_CD = a.MCDP_CD
		order by to_char(a.ORDR_YMD, 'yyyy-mm-dd'), b.MCDP_ABRV_CD, a.ORDR_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrptAsndrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrptAsndrYn (치매조기검진 대상 조회) 
        Description :                                           치매조기검진 대상 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrptAsndrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrptAsndrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrptAsndrYn-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCrptAsndrYn */
		       decode (count(*), 0, 'N', 'Y') as YN
		  from MDICUSCHT
		 where MDCR_YMD = to_char(sysdate, 'yyyymmdd')
		   -- 처방의사
		   and (
		        ((AM_MJDR_ID = #{oddrId}) or (AM_SPDR_ID = #{oddrId}) or (AM_SPDR_ID2 = #{oddrId})) and (to_char(sysdate, 'hh24miss') between '083000' and '115959')
		     or ((PM_MJDR_ID = #{oddrId}) or (PM_SPDR_ID = #{oddrId}) or (PM_SPDR_ID2 = #{oddrId})) and (to_char(sysdate, 'hh24miss') between '120000' and '172959')
		     or (DNDT_MJDR_ID = #{oddrId}) and ((to_char(sysdate, 'hh24miss') between '173000' and '235959') or (to_char(sysdate, 'hh24miss') between '000000' and '082959'))
		        )
		   --처방발행부서코드
		   and ICU_DVSN_CD != decode(#{orocDprtCd}, '532040' , 'M', '532080', 'M', '532020', 'S', '532050', 'N', '-')
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrDdcn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrDdcn" column="ORDR_DDCN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrDdcn (약처방 일수 조회 (반납 제외)) 
        Description :                                           약처방 일수 조회 (반납 제외)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrDdcn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrDdcn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrDdcn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOrdrDdcn */
		        nvl(sum(a.DAYS), 0)   as ORDR_DDCN
		  from  ( select
		                  a.ORDR_YMD
		/*             ,  decode(nvl(a.DDCN, 0), 0, 1)  as DAYS */
		               ,  decode(nvl(a.DDCN, 0), 0, 1, a.DDCN)  as DAYS
		            from
		                  MDMEDORDT a   /* 약처방 */
		           where
		                  a.PTNO                  = #{ptno}         /* 환자번호  */
		             and  a.ORDR_CD               = #{ordrCd}       /* 처방코드 */
		             and  a.DC_DVSN_CD            = 'N'             /* D/C구분코드 */
		             and  a.TMPR_ORDR_YN          = 'N'             /* 임시처방여부 */
		             and  a.RTRN_RQPR_ID          is null           /* 반납요청자ID */
		        ) a
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneScinChkYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneScinChkYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneScinChkYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneScinChkYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneScinChkYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneScinChkYn */
		<![CDATA[
		select  decode(count(a.SCIN_CD),0,'N','Y') YN
		 from  MDPADIAGT  a
		       ,  MDPACLNCT  b
		where  a.MDRP_NO      		 = #{mdrpNo}
		    and  b.PTNO         	     	 = a.PTNO
		    and  b.MDRP_NO             = a.MDRP_NO
		    and  b.PTNT_CLNC_DX_SNO 	 = a.PTNT_CLNC_DX_SNO
		    and #{selDvsnCd} = #{selDvsnCd}
		]]>
		<if test='selDvsnCd=="1"'>
		<![CDATA[
		    and  exists ( select 1
		                       from MZCTRLMMT c
		                      where c.MDCR_CTRL_CD = #{mdcrCtrlCd}
			                      and c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD,1, 3)
				                  and trunc(sysdate) between c.APST_YMD
				                                                    and c.APFN_YMD
		                      )
		]]>
		</if>
		<if test='selDvsnCd=="2"'>
		<![CDATA[
		    and a.SCIN_CD like #{scinCd} || '%'
		]]>
		</if>
		<if test='selDvsnCd=="3"'>
		<![CDATA[
		    and a.SCIN_CD = #{scinCd}
		]]>
		</if>
		<if test='selDvsnCd=="4"'>
		<![CDATA[
		    and  exists (select 1
		                      from MZCTRLMMT c
		                     where c.MDCR_CTRL_CD = #{mdcrCtrlCd}
			                     and c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD,1, 5)
				                 and trunc(sysdate) between c.APST_YMD
				                                                   and c.APFN_YMD
		                     )
		]]>
		</if>
		<if test='selDvsnCd=="5"'>
		<![CDATA[
		    and  exists (select 1
		                      from MZCTRLMMT c
		                     where c.MDCR_CTRL_CD = #{mdcrCtrlCd}
			                     and c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD,1, 3)
				                 and a.MAIN_SCIN_YN = 'Y'
		                         and trunc(sysdate) between c.APST_YMD
				                                                   and c.APFN_YMD
		                     )
		]]>
		</if>
		<if test='selDvsnCd=="6"'>
		<![CDATA[
		    and  exists (select 1
		                      from MZCTRLMMT c
		                     where c.MDCR_CTRL_CD = #{mdcrCtrlCd}
			                     and c.MDCR_DTLS_CTRL_CD = a.SCIN_CD
		                         and trunc(sysdate) between c.APST_YMD
				                                                   and c.APFN_YMD
		                     )
		]]>
		</if>
		<if test='selDvsnCd=="7"'>
		<![CDATA[
		    and  exists (select 1
		                      from MZCTRLMMT c
		                    where c.MDCR_CTRL_CD = #{mdcrCtrlCd}
			                    and (
		                                    (c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD, 1,3))
		                               or  (c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD, 1,5))
		                              )
		                        and trunc(sysdate) between c.APST_YMD
				                                                  and c.APFN_YMD
		                     )
		]]>
		</if>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRpmdYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRpmdYn () 
        Description :                                           특정성분의 약 유무체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRpmdYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRpmdYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRpmdYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRpmdYn */
		select decode(count(x.ORDR_CD),  0, 'N','Y') YN
		  from
		       (
		        select MDPR_CD as "ORDR_CD"
		          from SDDDGCDMT
		         where MDPR_CD = #{ordrCd}
		           and RPMD_ID = #{rpmdId}
		        ) x
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIstyAsstCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="istyAsstCd" column="ISTY_ASST_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIstyAsstCd () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIstyAsstCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIstyAsstCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIstyAsstCd-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIstyAsstCd */
		          ISTY_ASST_CD                                                    as ISTY_ASST_CD
		  from APRCRPTNT
		 where MDRP_NO = #{mdrpNo}
		   and PTNO = #{ptno}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForDay-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="mcdpAbrvCd" column="MCDP_ABRV_CD"/>
		<result property="ordrQty" column="ORDR_QTY"/>
		<result property="ddcn" column="DDCN"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForDay (비암성 한자에 대해 옥시콘티 1일당 처방 조회) 
        Description :                                           비암성 한자에 대해 옥시콘티 1일당 처방 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForDay-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForDay"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForDay-result" useCache="true" flushCache="false">
		 select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listDrugOrdrHxForDay */
		          to_char(a.ORDR_YMD, 'yyyy-mm-dd')                                     as ORDR_YMD
		        , a.MCDP_CD                                                                        as MCDP_CD
		        , b.MCDP_ABRV_CD                                                               as MCDP_ABRV_CD
		        , a.PCKN_UNAD_QTY * a.NTM                                                  as ORDR_QTY
		        , a.DDCN                                                                              as DDCN
		        , a.ORDR_CD                                                                         as ORDR_CD
		        , a.ORDR_SNO                                                                       as ORDR_SNO
		  from MDMEDORDT a, MRCDPRTCT b
		where a.PTNO = #{ptno}
		   and a.ORDR_CD in ('DOCD','DOCD2','DULOX30','DULOX60')
		   and #{ordrCd} in ('DOCD','DOCD2','DULOX30','DULOX60')
		   and to_char(a.ORDR_YMD, 'yyyymmdd') = #{ordrYmd}
		   and a.DC_DVSN_CD = 'N'
		   and nvl(a.ORDR_IPDV_CD,' ') in ('1',' ')
		   and b.MCDP_CD = a.MCDP_CD
		order by to_char(a.ORDR_YMD, 'yyyy-mm-dd'), b.MCDP_ABRV_CD, a.ORDR_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugCountForAll-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrCnt" column="ORDR_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugCountForAll (만성 간염 환자 - 페그인터페론 제재 최대사용량 조회) 
        Description :                                           만성 간염 환자 - 페그인터페론 제재 최대사용량 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugCountForAll-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugCountForAll"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugCountForAll-result" useCache="true" flushCache="false">
		 select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugCountForAll */
		          count(*)                                                                           as ORDR_CNT
		  from MDMEDORDT a
		where a.PTNO = #{ptno}
		   and a.ORDR_CD in ('MIFP13','MIFP18','XNS50')
		   and #{ordrCd} in ('MIFP13','MIFP18','XNS50')
		<![CDATA[
		   and to_char(a.ORDR_YMD, 'yyyymmdd') <= #{ordrYmd}
		]]>
		   and a.DC_DVSN_CD = 'N'
		   and a.MCDP_CD = #{mcdpCd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumTotalVlm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="rsltVl" column="RSLT_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumTotalVlm (전담의 여부 체크) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumTotalVlm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumTotalVlm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumTotalVlm-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumTotalVlm */
		select sum(ICUN_ADMN_VLM * NTM) as RSLT_VL
		  from MDMEDORDT
		 where PTNO = #{ptno} and ORDR_CD = #{ordrCd}
		   and to_char(ORDR_YMD, 'yyyymmdd') = #{ordrYmd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdiCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="insrEdiCd" column="INSR_EDI_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdiCd (보험EDI코드 조회) 
        Description :                                           보험EDI코드 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdiCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdiCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdiCd-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneEdiCd */
		       INSR_EDI_CD                                                                          as INSR_EDI_CD   -- 보험EDI코드
		  from AIMFMDFET
		 where MDFE_CD = #{ordrCd}
		   and #{ordrYmd} between to_char(APST_YMD, 'yyyymmdd') and to_char(APFN_YMD, 'yyyymmdd')
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCountForPrgn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrCnt" column="ORDR_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCountForPrgn (산부인과 초음파 검사건수 조회) 
        Description :                                           산부인과 초음파 검사건수 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCountForPrgn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCountForPrgn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCountForPrgn-result" useCache="true" flushCache="false">
		 select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxCountForPrgn */
		          count(*)                                                                           as ORDR_CNT
		  from MDTRTORDT a
		where a.PTNO = #{ptno}
		   and ((#{ordrCd} in ('RUOG151','RUOG151A','RUOG151B','RUOG151C','RUOG151D','II9012HSS') and a.ORDR_CD in ('RUOG151','RUOG151A','RUOG151B','RUOG151C','RUOG151D','II9012HSS')) or
		        (#{ordrCd} in ('RUOG152','RUOG152A','RUOG152B','RUOG152C','RUOG152D','IU01141') and a.ORDR_CD in ('RUOG152','RUOG152A','RUOG152B','RUOG152C','RUOG152D','IU01141')) or
		        (#{ordrCd} in ('RUOG153','RUOG153A','RUOG153B','RUOG153C','RUOG153D','II902L') and a.ORDR_CD in ('RUOG153','RUOG153A','RUOG153B','RUOG153C','RUOG153D','II902L')) or
		        (#{ordrCd} in ('RUOG161','RUOG161A','RUOG161B','RUOG161C','RUOG161D','IU01178') and a.ORDR_CD in ('RUOG161','RUOG161A','RUOG161B','RUOG161C','RUOG161D','IU01178')) or
		        (#{ordrCd} in ('RUOG162','RUOG162A','RUOG162B','RUOG162C','RUOG162D','II9012HS') and a.ORDR_CD in ('RUOG162','RUOG162A','RUOG162B','RUOG162C','RUOG162D','II9012HS')) or
		        (#{ordrCd} in ('RUOG163','RUOG163A','RUOG163B','RUOG163C','RUOG163D','IU01140') and a.ORDR_CD in ('RUOG163','RUOG163A','RUOG163B','RUOG163C','RUOG163D','IU01140')))
		   and to_char(a.ORDR_YMD, 'yyyymmdd') between #{strtYmd} and #{ptprYmd}
		   and a.DC_DVSN_CD = 'N'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxEtcCountForPrgn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrCnt" column="ORDR_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxEtcCountForPrgn (산부인과 기타 초음파 검사건수 조회) 
        Description :                                           산부인과 기타 초음파 검사건수 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxEtcCountForPrgn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxEtcCountForPrgn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxEtcCountForPrgn-result" useCache="true" flushCache="false">
		 select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneTxEtcCountForPrgn */
		          count(*)                                                                           as ORDR_CNT
		  from MDTRTORDT a
		 where a.PTNO = #{ptno}
		   and a.ORDR_CD not in ('RUOG091','RUOG090')
		   and to_char(a.ORDR_YMD, 'yyyymmdd') between #{strtYmd} and #{ptprYmd}
		   and a.DC_DVSN_CD = 'N'
		   and a.ORDR_CD in ( select MDFE_CD
		                        from AIMFMDFET
		                       where substr(INSR_EDI_CD,1,5) = substr(#{insrEdiCd},1,5)
		                         and #{ordrYmd} between to_char(APST_YMD, 'yyyymmdd') and to_char(APFN_YMD, 'yyyymmdd') )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIjstDiltYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIjstDiltYn (주사제 안정성 희석필수여부 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIjstDiltYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIjstDiltYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIjstDiltYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneIjstDiltYn */
		select  decode(b.DILT_YN, '1', 'Y', 'N') as yn
		  from  SDDDGCDMT a 
		     ,  SDIJSTMAT b
		 where  a.MDPR_CD = #{ordrCd}
		   and  a.MIX_RPRS_PDCT_CD = b.MIX_RPRS_PDCT_CD(+)
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCprsRtOrdYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCprsRtOrdYn () 
        Description :                                           압박률 입력여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCprsRtOrdYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCprsRtOrdYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCprsRtOrdYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCprsRtOrdYn */
		 select decode(sign(count(MDCR_DTLS_CTRL_CD)-1),-1,'N','Y') as YN
		   from MZCTRLMMT
		  where MDCR_CTRL_CD = 'MDP_281'
		    and MDCR_DTLS_CTRL_CD = #{ordrCd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn () 
        Description :                                           3rd Generation Cephalosporins, 4th generation cephalosporines,
                                                                Quinolones 효능약 여부체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn */
		select decode(sign(count(MDPR_CD)-1),-1,'N','Y') as YN
		  from SDDGEFFCT a /* 약품효능 */
		     , MDORDRCMT b
		 where b.ORDR_CD = #{ordrCd}
		   and a.MDPR_CD = b.ORDR_CD
		   and a.EFCC_LRCL_CD = '08'
		   and a.EFCC_MDCS_CD = '12'
		   and (  (a.EFCC_SMCL_CD = '06' and a.EFCC_DTCL_CD in ('3' ,'4'))  /* 3rd Generation Cephalosporins, 4th generation cephalosporines */
		       or (a.EFCC_SMCL_CD = '18')                                                /* Quinolones */
		       );
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrainVesselYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="mdcrCtrlNm" column="MDCR_CTRL_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrainVesselYn () 
        Description :                                           뇌혈관 질환개선제 유무 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrainVesselYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrainVesselYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrainVesselYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBrainVesselYn */
		select a.MDCR_CTRL_NM  
				  from MZCTRLMMT a 
				 where a.MDCR_CTRL_CD in( 'MDK_0057','MDK_0058','MDK_0059')
				   and a.MDCR_DTLS_CTRL_CD = #{ordrCd}
				   and exists(select 1 from AIMFEDICT b
		                       where b.HIRA_DRUG_MAIN_INGR_CD = a.MDCR_LWRN_CTRL_CD
				                 and trunc(sysdate) between b.APST_YMD and b.APFN_YMD
		                     );  
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHpttVacnOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHpttVacnOrdrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHpttVacnOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHpttVacnOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHpttVacnOrdrYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHpttVacnOrdrYn */
				select
				    decode(sign(count(a.PTNO)), 1, 'Y', 'N') as YN
				from
				    	MDMEDORDT a,
				    	MDORDRCMT b,
		                SDDDGCDMT c 					/* 약품코드 */
				where 
				    a.PTNO    = #{ptno}
				    and a.ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd') - to_number('20') and to_date(#{ordrYmd}, 'yyyymmdd')
				    and  nvl(a.DC_DVSN_CD, 'N') = 'N'          
				    and b.ORDR_CD    = a.ORDR_CD      
		            and c.MDPR_CD = a.ORDR_CD
					/*조건추가.. 20210214 */
		            and c.RPMD_ID in ('HBV') /* 성분ID */           
		            and not exists           /* prn 처방 아님 */
		            (
		                select
		                1
		                from MZCTRLMMT f
		                where 
		                    f.MDCR_DTLS_CTRL_CD = a.ORDR_CD
		                    and f.MDCR_CTRL_CD = 'MM969' /* PRN 대상약제 */
		                    and trunc(sysdate) between nvl(trunc(f.APST_YMD), trunc(sysdate)) and nvl(trunc(f.APFN_YMD), trunc(sysdate))     
		            ) 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLntrAntbAdmnInfm2-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ingrId" column="INGR_ID"/>
		<result property="ingrNm" column="INGR_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLntrAntbAdmnInfm2 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLntrAntbAdmnInfm2-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLntrAntbAdmnInfm2"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLntrAntbAdmnInfm2-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLntrAntbAdmnInfm2 */
				<![CDATA[
				    select /* 장기항생제투여 체크 */
						a.INGR_ID	as INGR_ID--성분코드 
						, a.INGR_NM	as INGR_NM-- 성분명 
				    from  
				        (
				            select 
				                c.INGR_ID 
				                , c.INGR_NM 
				                , count(distinct b.ORDR_YMD) CNT
				            from 
				                MDMEDORDT b 
				                , SDDDGCDMT c  
				            where 
				                b.PTNO   = #{ptno}
				                and b.ORDR_YMD between to_date(#{ordrYmd},'yyyymmdd') - to_number('14') and to_date(#{ordrYmd},'yyyymmdd')-1 
				                and b.ORDR_CLTY_CD = 'B1'	-- 처방분류 
								and nvl(b.DC_DVSN_CD, 'N')  = 'N'  -- D/C여부 
				                and c.MDPR_CD = b.ORDR_CD 
								and c.MDPR_CLSF_DETL_CD in ('04','05') --약품분류상세코드 
				            group by c.INGR_ID, c.INGR_NM 
							having count(distinct b.ORDR_YMD) >= to_number('1')   -- 14
				        ) a
				    where rownum = 1
				]]>    
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePwdrDslwInfmYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePwdrDslwInfmYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePwdrDslwInfmYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePwdrDslwInfmYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePwdrDslwInfmYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePwdrDslwInfmYn */
						select
							DECODE(COUNT(1),0,'N','Y') AS YN
						from  
						    MDORDRCMT a
						    , SDDDGCDMT b       /*  약품코드 */
						    , CCCMCDDMT c
						where  
						    b.MDPR_CD   = a.ORDR_CD
						    and b.PWDR_DSLW_RESN_CD is not null
						    and b.PWDR_DSLW_YN = 'Y'
						    and c.COMN_GRP_CD = 'SDA_007'
						    and b.PWDR_DSLW_RESN_CD = c.COMN_DTLS_CD 
						    and a.ordr_cd = #{ordrCd}
							and c.COMN_DTLS_CD = '01'  /* 서방정/서방캡슐 */
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneApneaDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneApneaDiagYn () 
        Description :                                           수면 무호흡 관련 진단 존재 여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneApneaDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneApneaDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneApneaDiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneApneaDiagYn */
		<![CDATA[
		select  decode(count(1), 1,'Y','N') as YN
		 from  MDPADIAGT  a
		     , MDPACLNCT  b
		where  1=1
		    and  a.MDRP_NO        =  #{mdrpNo}
		    AND A.MCDP_CD         =  #{mcdpCd}
		    and  b.PTNO          	    = a.PTNO
		    and  b.MDRP_NO            =  a.MDRP_NO 
		    and  b.PTNT_CLNC_DX_SNO 	= a.PTNT_CLNC_DX_SNO    
		    and  exists ( select 1
		                    from MZCTRLMMT c
		                   where c.MDCR_CTRL_CD ='MDK_0016'
		                     and c.MDCR_DTLS_CTRL_CD = SUBSTR(A.SCIN_CD,1, C.MDCR_CTRL_NMBR_VL1)
		                     and trunc(sysdate) between c.APST_YMD and c.APFN_YMD
		                   ) 
		   and rownum = 1
		 ]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDiabetes2DiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDiabetes2DiagYn () 
        Description :                                           2형 당뇨 진단 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDiabetes2DiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDiabetes2DiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDiabetes2DiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDiabetes2DiagYn */
		<![CDATA[
		select  decode(count(1), 1,'Y','N') as YN
		 from  MDPADIAGT  a
		     , MDPACLNCT  b
		where  1=1
		    and  a.MDRP_NO        =  #{mdrpNo}
		   AND A.MCDP_CD         =  #{mcdpCd}
		    and  b.PTNO          	    = a.PTNO
		    and  b.MDRP_NO            =  a.MDRP_NO 
		    and  b.PTNT_CLNC_DX_SNO 	= a.PTNT_CLNC_DX_SNO
		    and  NVL(b.RUL_OUT_YN,'N')         <> 'Y'    
		    and  exists ( select 1
		                    from MZCTRLMMT c
		                   where c.MDCR_CTRL_CD ='MDK_0038'
		                     and c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD,1, 3)
		                     and trunc(sysdate) between c.APST_YMD and c.APFN_YMD
		                   ) 
		   and rownum = 1
		 ]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtptSpcmExmnWntdDtCeck-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="kornDprtNm" column="KORN_DPRT_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtptSpcmExmnWntdDtCeck () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtptSpcmExmnWntdDtCeck-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtptSpcmExmnWntdDtCeck"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtptSpcmExmnWntdDtCeck-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneOtptSpcmExmnWntdDtCeck */
				<![CDATA[
				    select /*+ INDEX (A MDEXMORDT_I14) */
		                /* 외래검체검사희망일시체크 */
				        to_char(a.ORDR_YMD,'yyyymmdd') as ORDR_YMD
				        , b.KORN_DPRT_NM as KORN_DPRT_NM
				    from 
				        MDEXMORDT a,
				        HZDEPTMMT b
				    where
				        a.PTNO = #{ptno}
				        and a.WNTD_DT between to_date(#{ordrYmd},'yyyymmdd') - to_number(#{chrcVl1}) and to_date(#{ordrYmd},'yyyymmdd') + to_number(#{chrcVl1})
				        and a.ORDR_CD = #{ordrCd}
				        and a.DC_DVSN_CD = 'N' 
				        and a.MCDP_CD <> nvl(#{chrcVl2},'*') /*과 정보가 있으면 해당 진료과 제외 */
				        and a.MCDP_CD = b.DPRT_CD
				        and rownum = 1
				]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtexLvelDvsnCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtexLvelDvsnCd () 
        Description :                                           병리 Level 시행목적 그룹코드
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtexLvelDvsnCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtexLvelDvsnCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtexLvelDvsnCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePtexLvelDvsnCd */
		select decode(count(*),0,'N','Y') as YN
		  from MDORDRCMT 
		 where ORDR_CD = #{ordrCd}
		   and PTEX_LVEL_DVSN_CD is not null;
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdEnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdEnYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdEnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdEnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdEnYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdEnYn */
		select
			decode (count(*), 0, 'N', 'Y') as YN
		from 
			MZCTRLMMT a
		where 
			a.MDCR_CTRL_CD = #{mdcrCtrlCd}                      
			and a.MDCR_DTLS_CTRL_CD = #{mdcrDtlsCtrlCd} 
			and  sysdate between APST_YMD and APFN_YMD 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMdcrApntCdCeckYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMdcrApntCdCeckYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMdcrApntCdCeckYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMdcrApntCdCeckYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMdcrApntCdCeckYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneMdcrApntCdCeckYn */
		SELECT /* 진료예약코드체크여부 */ 
		    decode(count(1),0,'N','Y') AS yn
		FROM APRCRPTNT a 
		WHERE 
		    a.MDRP_NO  = #{mdrpNo}
		    AND a.CODV_CD  = 'O'  
		    AND a.MDCR_ANDV_CD = #{chrcVl1}
		    AND a.CNCL_DT is NULL
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdDetlInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="mdcrCtrlChrcVl1" column="MDCR_CTRL_CHRC_VL1"/>
		<result property="mdcrCtrlChrcVl2" column="MDCR_CTRL_CHRC_VL2"/>
		<result property="ctrlDscrCtn" column="CTRL_DSCR_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdDetlInfm () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdDetlInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdDetlInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdDetlInfm-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDtlsCtrlCdDetlInfm */
		select  /* 세부제어코드상세정보 */
		    a.MDCR_CTRL_CHRC_VL1 as MDCR_CTRL_CHRC_VL1
		    , a.MDCR_CTRL_CHRC_VL2 as MDCR_CTRL_CHRC_VL2
			, a.CTRL_DSCR_CTN as CTRL_DSCR_CTN
		from 
		    MZCTRLMMT a
		where
		    a.MDCR_CTRL_CD = #{mdcrCtrlCd}
		    and  a.MDCR_DTLS_CTRL_CD = #{mdcrDtlsCtrlCd}
		    and  to_date(#{ordrYmd}, 'YYYYMMDD') between a.APST_YMD and a.APFN_YMD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneConsPhdYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneConsPhdYn () 
        Description :                                           약제팀 진통제 복약지도 (JC9005) 컨설트 여부 체크 Y 이면 복약지도 컨설트 없음
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneConsPhdYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneConsPhdYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneConsPhdYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneConsPhdYn */
		<![CDATA[
		SELECT DECODE(COUNT(1),0,'Y','N') AS YN 
		  FROM MDCONSRCT
		 WHERE  MDRP_NO = #{mdrpNo}
		   AND  ORDR_CD  = 'T008194'                       /* 진통제 복약지도 */    
		   AND  NVL(DLTN_YN, 'N') <> 'Y'                  /*  삭제건 제외 */
		   AND  NVL(CMTX_STTS_CD, '1') NOT IN ('0', '9')  /*  임시저장 및 취소건 제외 */
		]]>   
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBdenExmnPerdCeck-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBdenExmnPerdCeck () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBdenExmnPerdCeck-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBdenExmnPerdCeck"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBdenExmnPerdCeck-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBdenExmnPerdCeck */
		<![CDATA[
			select
				decode(count(1), 1,'Y','N') as YN
			from 
				(
					select		/*골밀도검사기간체크 */
					    'Y' as YN /* 싱글 수가 Check */
					from
					    SZRESULMT a,
					    AIMFMDFET b
					where
					    a.PTNO      = #{ptno}
					    and 	trunc(a.RPRT_DT) between to_date(#{mdcrDt}, 'yyyymmdd') - 365 and to_date(#{mdcrDt}, 'yyyymmdd')	/* ASIS : 검사실행일자(EXECDATE). 확인필요 */
					    and 	b.MDFE_CD   = a.EXMN_CD
					    and 	b.INSR_EDI_CD    in ('HC343', 'HC342')
					    and 	a.ORDR_YMD between b.APST_YMD and b.APFN_YMD
					union
					select	/* 그룹 수가 Check */
					    'Y' as YN
					from
					    SZRESULMT a,
					    AIMFMDFET b,
					    AIMFGROPT c,
					    AIMFMDFET d
					where
					    a.PTNO      = #{ptno}
					    and 	trunc(a.RPRT_DT) between to_date(#{mdcrDt}, 'yyyymmdd') - 365and to_date(#{mdcrDt}, 'yyyymmdd') /* ASIS : 검사실행일자(EXECDATE). 확인필요 */  
					    and 	b.MDFE_CD   = a.EXMN_CD
					    and 	a.ORDR_YMD between b.APST_YMD and b.APFN_YMD
					    and 	b.INSR_EDI_CD is null
					    and 	c.GRP_MDFE_CD   = a.EXMN_CD
					    and 	a.ORDR_YMD between c.APST_YMD and c.APFN_YMD
					    and 	d.MDFE_CD   = c.MDFE_CD
					    and 	a.ORDR_YMD between d.APST_YMD and d.APFN_YMD
					    and 	d.INSR_EDI_CD    in ('HC343', 'HC342')
					/*
					union
					select	 -- 종합건진 수가 Check 
					    oras1.fn_submdyn(in_Patno, 
					    to_date(in_Meddate, 'yyyymmdd') - 365, 
					    to_date(in_Meddate, 'yyyymmdd'), 
					    'WB0026') 			BONEDENSYN
					from
					    DUAL
					*/
				) a
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAIMdprOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAIMdprOrdrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAIMdprOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAIMdprOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAIMdprOrdrYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAIMdprOrdrYn */
		<![CDATA[
		    select	/* AI약품처방여부 */
		        decode(count(c.PTNO), 0, 'Y', 'N') as YN
		    from
		        SDDDGCDMT a 
		        , MDORDRCMT b
		        , MDMEDORDT c
		        , APRCRPTNT d
		    where
		        1 =1
		        and b.ORDR_CD = a.MDPR_CD
		        and	b.ORDR_PSBL_DVSN_CD = 'Y'
		        and	c.PTNO = #{ptno}
		        and c.MDRP_NO = d.MDRP_NO
		        and	d.MDCR_DT between to_date(#{mdcrDt}, 'yyyymmdd') - 365 and to_date(#{mdcrDt}, 'yyyymmdd')
		        and	c.DC_DVSN_CD = 'N'
		    --    and	c.PRNYN  is null
		        and	c.ORDR_CD = b.ORDR_CD
		        and a.RPMD_ID in
		                        ( 
		                            select MDCR_DTLS_CTRL_CD
		                            from MZCTRLMMT e
		                            where 
		                                e.MDCR_CTRL_CD = #{mdcrCtrlCd}
		                                and trunc(sysdate) between e.APST_YMD and e.APFN_YMD
		                        )         
		]]>         
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtrlCdClbyDxYn -result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtrlCdClbyDxYn  () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtrlCdClbyDxYn -result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtrlCdClbyDxYn "  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtrlCdClbyDxYn -result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCtrlCdClbyDxYn  */
		<![CDATA[
		    select  /* 제어코드조건별진단여부 */
		        decode(count(1), 1,'Y','N') as YN
		    from  
		        MDPADIAGT  a
		        , MDPACLNCT  b
		    where  
		        1=1
		        and  a.MDRP_NO            =  #{mdrpNo}
		        and  A.MCDP_CD            =  #{mcdpCd}
		        and  b.PTNO          	  = a.PTNO
		        and  b.MDRP_NO            =  a.MDRP_NO 
		        and  b.PTNT_CLNC_DX_SNO   = a.PTNT_CLNC_DX_SNO    
				and  #{selDvsnCd}		  = #{selDvsnCd}  
		]]>
		<if test='selDvsnCd=="1"'>
		<![CDATA[
		        AND  NVL(B.RUL_OUT_YN,'N')       <> 'Y'                   /* RULE_OUT여부 */
		]]>
		</if>    
		<if test='selDvsnCd=="2"'>
		<![CDATA[
		        AND  a.MAIN_SCIN_YN      = 'Y'                   /* 주진단 여부 */
		]]>
		</if>   
		<![CDATA[  
		        and  exists 
		                    ( 
		                        select 1
		                        from MZCTRLMMT c
		                        where 
		                            c.MDCR_CTRL_CD = #{mdcrCtrlCd}
		                            and c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD,1, 3)
		                            and trunc(sysdate) between c.APST_YMD and c.APFN_YMD
		                    ) 
		    and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUltsGrpOrdrCeck-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUltsGrpOrdrCeck () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUltsGrpOrdrCeck-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUltsGrpOrdrCeck"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUltsGrpOrdrCeck-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUltsGrpOrdrCeck */
				select 
					decode(sign(count(z.GRP_MDFE_CD)), 1, 'Y', 'N') as YN
				from 
					AIMFGROPT z
				where 
					z.GRP_MDFE_CD  = #{ordrCd}
					and nvl(to_date(#{ordrYmd},'yyyymmdd'),trunc(sysdate)) between z.APST_YMD and z.APFN_YMD
					and exists     
										(
											select 1 
											from AIMFMDFET x 
											where 
												x.MDFE_CD = z.GRP_MDFE_CD 
												and nvl(to_date(#{ordrYmd},'yyyymmdd'),trunc(sysdate)) between x.APST_YMD and x.APFN_YMD
												and x.INSR_IPDV_CD = '1' 
												and x.MDAC_CLSF_CD = '21'
										)
					and exists 
										(
											select 1 
											from AIMFMDFET x
											where 
												x.MDFE_CD 	= z.MDFE_CD 
												and nvl(to_date(#{ordrYmd},'yyyymmdd'),trunc(sysdate)) between x.APST_YMD and x.APFN_YMD 
												and x.INSR_IPDV_CD 	!= '1' 
												and x.MDAC_CLSF_CD 	= '21'
										)
					and exists     
										(
											select 1 
											from AIMFMDFET x 
											where 
												x.MDFE_CD = z.MDFE_CD 
												and nvl(to_date(#{ordrYmd},'yyyymmdd'),trunc(sysdate)) between x.APST_YMD and x.APFN_YMD 
												and x.INSR_IPDV_CD = '1' 
												and x.MDAC_CLSF_CD != '21'
				)
	</select>




	<resultMap id="com-selectOneCpOrdrAplyYndselectOneCpOrdrAplyYn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpOrdrAplyYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-selectOneCpOrdrAplyYndselectOneCpOrdrAplyYn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpOrdrAplyYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-selectOneCpOrdrAplyYndselectOneCpOrdrAplyYn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpOrdrAplyYn-result
    -->
	<select id="com-selectOneCpOrdrAplyYndselectOneCpOrdrAplyYn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpOrdrAplyYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-selectOneCpOrdrAplyYndselectOneCpOrdrAplyYn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpOrdrAplyYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-selectOneCpOrdrAplyYndselectOneCpOrdrAplyYn-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCpOrdrAplyYn */
				select 
				     decode(count(b.PTNO), 0, 'N', 'Y') as YN
				from
					MDCPPATBT a, -- CP 환자기본
					MDCPPATDT b  -- CP 환자상세
				where    
				    a.MDRP_NO               = #{mdrpNo}
				    and a.CP_CD             = #{cpCd}
				    and a.PTNO              = b.PTNO
				    and a.STRT_YMD          = b.STRT_YMD
				    and a.CP_RGST_SNO       = b.CP_RGST_SNO
				    and a.CP_CD             = b.CP_CD
				    and a.CP_DLTN_YMD is null
				    and b.DLTN_DT is null
				    and b.ORDR_APLY_YMD is not null        /* 적용된것은 제외 */
				    and b.DLTN_DT is null              /* 삭제된것은 제외 */
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImdpOtptOrdrPsblYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImdpOtptOrdrPsblYn (내과 외래 처방가능여부 체크) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImdpOtptOrdrPsblYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImdpOtptOrdrPsblYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImdpOtptOrdrPsblYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneImdpOtptOrdrPsblYn */
				select  decode(count(a.MDRP_NO), 1, 'N', 'Y') as YN
				  from  APRCRPTNT a
		             ,  MZCTRLMMT b
				 where  b.MDCR_CTRL_CD       = 'MDP_910'
		           and  b.MDCR_CTRL_CHRC_VL2 = a.MCDP_CD
		           and a.MDRP_NO = #{mdrpNo}
		           and exists (select 1
		                         from MZCTRLMMT
		                        where MDCR_CTRL_CD = 'MDP_910'
		                          and MDCR_CTRL_CHRC_VL2 = #{userDprtCd}
		                          and MDCR_CTRL_CHRC_VL3 = b.MDCR_CTRL_CHRC_VL3	/* 동일그룹으로 묶이는 진료과인지 */
		                          and nvl(MDCR_CTRL_CHRC_VL3, 'N') != 'N'
		                       )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listValdOtptDrugOrdrbyMdrpNo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="gndrId" column="GNDR_ID"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ihohDvsnCd" column="IHOH_DVSN_CD"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listValdOtptDrugOrdrbyMdrpNo (접수번호로 유효한 외래 약처방 조회.) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listValdOtptDrugOrdrbyMdrpNo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listValdOtptDrugOrdrbyMdrpNo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listValdOtptDrugOrdrbyMdrpNo-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listValdOtptDrugOrdrbyMdrpNo */
		select  PTNO
		     ,  to_char(ORDR_YMD, 'yyyymmdd') as ORDR_YMD
		     ,  ORDR_SNO
		     ,  ODDR_ID
		     ,  CHDR_ID
		     ,  GNDR_ID
		     ,  MDRP_NO
		     ,  IHOH_DVSN_CD
		     ,  DC_DVSN_CD
		  from  MDMEDORDT
		 where  PTNO = #{ptno}
		   and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		   and  MDRP_NO = #{mdrpNo}
		   and  DC_DVSN_CD = 'N'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137 () 
        Description :                                           안전정맥내 유치침,주사침, 주사기, 나비침 처방시 감염 적응증 유무 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137 */
		<![CDATA[
		select  nvl(max('Y'),'N') as yn  
		  from DUAL
		 where exists   ( select 1
		                    from QDSINFCDT                          -- Caution 의심
		                   where PTNO               = #{ptno}
		                     and CUTN_SGN_RGST_DT   <= to_date(#{ordrYmd},'yyyymmdd')
		                     and INFD_CD            in ( '00002'    -- HCV (C형 간염)
		                                               , '00003'))  -- HIV (인체면역결핍바이러스)
		    or exists   ( select 1
		                    from QDSINFMDT                          -- Caution 확정
		                   where PTNO               = #{ptno}
		                     and to_date(#{ordrYmd},'yyyymmdd')   between CUTN_STRT_YMD                                    
		                                                              and CUTN_RELE_YMD
		                     and INFD_CD            in ( '00002'    -- HCV (C형 간염)
		                                               , '00003'    -- HIV (인체면역결핍바이러스)
		                                               , '00004'    -- VDRL (매독)
		                                               , '00001'    -- HBsAg (B형 간염)
		                                               , '00017'))  -- CJD (야콥병)
		    -- 법정전염병신고서                                                               
		    or exists   ( select 1
		                    from MDINFCRPT a
		                       , MRBSSCINT b
		                   where a.PTNO             = #{ptno}
		                     and a.ORDR_YMD         <= to_date(#{ordrYmd},'yyyymmdd')
		                     and b.SCIN_CD = a.SCIN_CD
		                     and to_date(#{ordrYmd},'yyyymmdd')   between b.SCIN_CD_VRSN_STRT_YMD 
		                                                              and b.SCIN_CD_VRSN_FNSH_YMD
		                     and b.INFD_CD in ( '00115'	    -- 말라리아
		                                  --    , '00017'		-- 야콥병
		                                  --    , '00004'		-- 매독
		                                  --    , '00002'		-- C형 간염
		                                      , '00036'		-- 브루셀라증
		                                      ))
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137DrugYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137DrugYn () 
        Description :                                           항 악성종양제 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137DrugYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137DrugYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137DrugYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChckK0137DrugYn */
		SELECT NVL(MAX('Y'),'N') AS YN 
		  FROM MDMEDORDT A 
		 WHERE A.PTNO = #{ptno}
		   AND A.ORDR_YMD BETWEEN TRUNC(SYSDATE)-3 AND TRUNC(SYSDATE)+3
		   AND NVL(A.DC_DVSN_CD, 'N') = 'N'
		   AND NVL(A.TMPR_ORDR_YN,'N') = 'N' 
		   AND EXISTS (SELECT 1 
		                 FROM SDDDGCDMT B
		                WHERE B.MDPR_CD = A.ORDR_CD 
		                  AND B.MDPR_CLSF_DETL_CD = '02'  --항암제
		                  AND B.ORDR_CLTY_CD      = 'B1'  --주사약 
		                  AND B.MEGR_CD           = '421' --항악성종양제
		              )    
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUserMdcrDprtInqr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="mdcrDprtCd" column="MDCR_DPRT_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUserMdcrDprtInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUserMdcrDprtInqr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUserMdcrDprtInqr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUserMdcrDprtInqr-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUserMdcrDprtInqr */
		select
		    a.MDCR_DPRT_CD  as MDCR_DPRT_CD -- 진료부서코드
		from 
		    CCUSRDPHT a -- NEXMED-EHR 사용자 역할정보
		where a.USER_ID = #{userId}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBldlelDvsnCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="bldleDvsnCd" column="BLDLE_DVSN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBldlelDvsnCd () 
        Description :                                           유효한 무수혈/최소수혈 환자유무 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBldlelDvsnCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBldlelDvsnCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBldlelDvsnCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneBldlelDvsnCd */
		select BLDLE_DVSN_CD  
		  from MNBLDLEMT
		 where PTNO =  #{ptno}
		   and DLTN_YN = 'N'
		   and RELE_YMD is null
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHiraDrugMainIngrCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="hiraDrugMainIngrCd" column="HIRA_DRUG_MAIN_INGR_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHiraDrugMainIngrCd () 
        Description :                                           약제 급여 적정성 평가(근골격계질환 약 품목수 제한)시 약품품목수 산출시 성분 및 제형이 동일하고 함량만 다른 경우
                                                                1품목으로 산출용
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHiraDrugMainIngrCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHiraDrugMainIngrCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHiraDrugMainIngrCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneHiraDrugMainIngrCd */
		SELECT SUBSTR(A.HIRA_DRUG_MAIN_INGR_CD,1,4) || SUBSTR(A.HIRA_DRUG_MAIN_INGR_CD,7) AS HIRA_DRUG_MAIN_INGR_CD       
		 FROM AIMFEDICT A 
		 WHERE A.EDI_CD = #{insrEdiCd}
		   AND TRUNC(SYSDATE) BETWEEN A.APST_YMD AND A.APFN_YMD 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntidepressantDrugYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntidepressantDrugYn () 
        Description :                                           항우울제 효능 약 여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntidepressantDrugYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntidepressantDrugYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntidepressantDrugYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAntidepressantDrugYn */
		SELECT DECODE(COUNT(1),0,'N','Y') AS YN   
		  FROM SDDGEFFCT A
		 WHERE EFCC_LRCL_CD ||EFCC_MDCS_CD||EFCC_SMCL_CD = '281604' --항우울제 효능코드
		   AND MDPR_CD = #{ordrCd}
		   AND ROWNUM = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsPtntYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsPtntYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsPtntYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsPtntYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsPtntYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsPtntYn */
		select	/* 응급재원환자여부 */
		    a.STHS_YN as YN /* 재원여부 */
		from 
		    MNEERRPAT a /*응급환자정보조사*/
		where 
		    a.MDRP_NO = #{mdrpNo}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsChckSttsCdCeck-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="chckSttsCd" column="CHCK_STTS_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsChckSttsCdCeck () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsChckSttsCdCeck-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsChckSttsCdCeck"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsChckSttsCdCeck-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneErSthsChckSttsCdCeck */
		select /* 응급재원심사상태코드체크여부 */
		    a.CHCK_STTS_CD as CHCK_STTS_CD
		from
		    APRCRPTNT a
		where
		    1=1
		    and a.MDRP_NO = #{mdrpNo}
		    and a.CHCK_STTS_CD in ('I','P') /*I = 심사중, P = 심사완료 */
		    and a.CODV_CD  = 'E'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePrnOrdrDslwCeck-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePrnOrdrDslwCeck () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePrnOrdrDslwCeck-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePrnOrdrDslwCeck"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePrnOrdrDslwCeck-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePrnOrdrDslwCeck */
		select  /* PRN처방불가체크 */
		    decode(count(1), 1,'N','Y') as YN /* PRN처방불가: N으로 막음 */
		from
		    MDORDRCMT
		where
		    1=1
		    and ORDR_CD = #{ordrCd}
		    and PRN_PSBL_YN = 'N'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOneAddTgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOneAddTgtYn () 
        Description :                                           투약1회 추가 대상여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOneAddTgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOneAddTgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOneAddTgtYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneDrugOneAddTgtYn */
		select decode(sign(count(*)-1),0,'Y',1,'Y','N') yn
		  from (
		         select  ( select  /*+index(med MDMEDORDT_I02)*/
		                          case when count(med.PTNO) = 0 then 'Y' else 'N' end
		                     from  MDMEDORDT med
		                    where  med.MDRP_NO = #{mdrpNo}              
		                      and  med.ORDR_CD = #{ordrCd}
		                      and  med.ODKI_CD = 'G'                                     /*  재원처방 */
		                      and  med.DC_DVSN_CD in ( 'N','Y')                          /*  실처방만 발행된 처방임 */
		                      and  nvl( med.ORFR_CD, 'X' ) not in  ( 'P', 'F' )          /*  임시처방 ( PRN, 응급실 1차 제외 ) */
		                      and  rownum = 1 ) yn
		           from SDDMETCDT
		          where TIMS1_ADTN_PSBL_YN ='Y'
		            and DRUS_CD = #{drusCd}
		        ) x
		where x.yn ='Y'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRtcaMdtePrprTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRtcaMdtePrprTrgtYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRtcaMdtePrprTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRtcaMdtePrprTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRtcaMdtePrprTrgtYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRtcaMdtePrprTrgtYn */
		<![CDATA[
		select  /* 근관치료적정성대상여부 */
		    decode(sign(count(a.ordr_cd)-1),-1,'N','Y') as YN
		from 
		    MDORDRCMT a,
		    AIMFMDFET b
		where
		    1=1
		    and a.ordr_cd = b.mdfe_cd
		    and a.ordr_psbl_dvsn_cd  = 'Y'
		    and b.INSR_EDI_CD
		    in
		    (
		        select
		            distinct a.MDCR_DTLS_CTRL_CD
		        from  
		            MZCTRLMMT a
		        where  
		            1=1
		            and a.MDCR_CTRL_CD      in
		            (               
		                #{mdcrCtrlCd}    	/* MDK_0203 */   
		            )
		    )
		    and b.ORDR_PSBL_YN = 'Y'
		    and trunc(sysdate) between b.APST_YMD and b.APFN_YMD
		    and a.ordr_cd = #{ordrCd}
		]]> 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRubberDamCnt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totCnt" column="TOT_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRubberDamCnt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRubberDamCnt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRubberDamCnt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRubberDamCnt-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneRubberDamCnt */
		<![CDATA[
		select sum(x.cnt) as TOT_CNT
		  from (
		               select count(*) cnt
		                  from MDTRTORDT a
		                where a.PTNO = #{ptno}
		                     and a.ORDR_YMD >= trunc(sysdate) - #{diff}
		                     and a.DC_DVSN_CD= 'N'
		                     and a.TMPR_ORDR_YN = 'N'
		                     and #{diff} = #{diff}
		                     and a.ORDR_CD in ( select MDFE_CD 
		                                                   from AIMFMDFET b
		                                                     where b.APST_YMD <= trunc(sysdate)
		                                                          and b.APFN_YMD >= trunc(sysdate)
		                                                          and b.INSR_EDI_CD in (select MDCR_DTLS_CTRL_CD 
		                                                                                           from MZCTRLMMT c
		                                                                                          where c.MDCR_CTRL_CD = 'MDK_0203' )
		                                                   )
		                union all                                              
		                select count(*) cnt
		                   from MDEXMORDT a
		                 where a.PTNO = #{ptno}
		                      and a.ORDR_YMD >= trunc(sysdate) -  #{diff}                    
		                      and a.DC_DVSN_CD = 'N'
		                      and a.TMPR_ORDR_YN = 'N'
		                      and #{diff} = #{diff}
		                      and a.ORDR_CD in ( select MDFE_CD
		                                                     from AIMFMDFET b
		                                                     where b.APST_YMD <= trunc(sysdate)
		                                                          and b.APFN_YMD >= trunc(sysdate)
		                                                          and b.INSR_EDI_CD in (select MDCR_DTLS_CTRL_CD 
		                                                                                           from MZCTRLMMT c
		                                                                                         where c.MDCR_CTRL_CD = 'MDK_0203' )
		                                                   )
		               )  x       
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUicmMdprOrdrItemCnt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totCnt" column="TOT_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUicmMdprOrdrItemCnt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUicmMdprOrdrItemCnt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUicmMdprOrdrItemCnt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUicmMdprOrdrItemCnt-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneUicmMdprOrdrItemCnt */
		<![CDATA[
			select  /* 병용약품처방항목수 */
				count(distinct a.ordr_cd) as TOT_CNT
			from 
				MDMEDORDT a
			where 
			1=1
			and a.PTNO = #{ptno}
			and a.ORDR_YMD = #{ordrYmd}
			and a.DC_DVSN_CD= 'N'
			and a.TMPR_ORDR_YN = 'N'
		    and a.oddr_id = #{userId}
			and a.ORDR_CD in 
				( 
					select 
						MDFE_CD 
					from 
						AIMFMDFET b
					where 
					1=1
					and b.APST_YMD <= trunc(sysdate)
					and b.APFN_YMD >= trunc(sysdate)
					and b.MDFE_CD in 
						(
							select 
								MDCR_DTLS_CTRL_CD 
							from 
								MZCTRLMMT c
						where 
							1=1
							and c.MDCR_CTRL_CD = 'MDK_0206' 
						)
				)
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAplbOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAplbOrdrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAplbOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAplbOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAplbOrdrYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneAplbOrdrYn */
		<![CDATA[
		select  /* 해당처방여부 */
		    decode(sign(count(a.ordr_cd)-1),-1,'N','Y') as YN
		from 
		    MDORDRCMT a,
		    AIMFMDFET b
		where
		    1=1
		    and a.ordr_cd = b.mdfe_cd
		    and a.ordr_psbl_dvsn_cd  = 'Y'
		    and b.MDFE_CD
		    in
		    (
		        select
		            distinct a.MDCR_DTLS_CTRL_CD
		        from  
		            MZCTRLMMT a
		        where  
		            1=1
		            and a.MDCR_CTRL_CD      in
		            (               
		                #{mdcrCtrlCd}    	/* MDK_0203 */   
		            )
		    )
		    and b.ORDR_PSBL_YN = 'Y'
		    and trunc(sysdate) between b.APST_YMD and b.APFN_YMD
		    and a.ordr_cd = #{ordrCd}
		]]> 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listUicmMdprOrdrItem-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listUicmMdprOrdrItem () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listUicmMdprOrdrItem-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listUicmMdprOrdrItem"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listUicmMdprOrdrItem-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-listUicmMdprOrdrItem */
		<![CDATA[
			select  /* 병용약품처방항목 */
		        distinct a.ordr_cd
			from 
				MDMEDORDT a
			where 
			1=1
			and a.PTNO = #{ptno}
			and a.ORDR_YMD = #{ordrYmd}
			and a.DC_DVSN_CD= 'N'
			and a.TMPR_ORDR_YN = 'N'
		    and a.oddr_id = #{userId}
			and a.ORDR_CD in 
				( 
					select 
						MDFE_CD 
					from 
						AIMFMDFET b
					where 
					1=1
					and b.APST_YMD <= trunc(sysdate)
					and b.APFN_YMD >= trunc(sysdate)
					and b.MDFE_CD in 
						(
							select 
								MDCR_DTLS_CTRL_CD 
							from 
								MZCTRLMMT c
						where 
							1=1
							and c.MDCR_CTRL_CD = 'MDK_0206' 
						)
				)
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhrmDtlsInqr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="age" column="AGE"/>
		<result property="dvsnCd" column="DVSN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhrmDtlsInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhrmDtlsInqr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhrmDtlsInqr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhrmDtlsInqr-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOnePhrmDtlsInqr */
		select a.PHRM_CTRL_CHRC_VL1 AGE
		    ,  a.PHRM_CTRL_CHRC_VL2 DVSN_CD
		  from SDMCTRLMT a
		 where a.PHRM_CTRL_CD = #{mdcrCtrlCd} 
		   and a.PHRM_DTLS_CTRL_CD = #{ordrCd} 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumDdcn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="ddcn" column="DDCN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumDdcn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumDdcn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumDdcn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumDdcn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneSumDdcn */
		select nvl(sum(a.ddcn),0) ddcn 
		  from mdmedordt a
		 where a.ptno = #{ptno}
		   and a.ordr_ymd = to_date(#{ordrYmd},'YYYYMMDD')
		   and a.oddr_id = #{oddrId}
		   and a.ordr_cd = #{ordrCd}
		   and a.drus_cd = #{drusCd}
		   and a.dc_dvsn_cd = 'N'
		   and a.tmpr_ordr_yn ='N'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn2-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn2 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn2-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn2"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn2-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn2 */
				<![CDATA[
				select
				    decode(sign(count(a.mdpr_cd)-1),-1,'N','Y') as YN
				from  
				    SDDDGCDMT a
				    , AIMFMDFET b /*  수가코드 */
				    ,  (
				        select   
				            a1.PHRM_DTLS_CTRL_NM as MDPR_CD  /* 약코드 */
				        from 
				            sdmctrlmt a1
				            , RPRSRPRJT b1 
				            , (
				                select 
				                    m.RSRC_PRJC_CD
				                    , WM_CONCAT(n.USER_NM) as COMM_USER_NM 
				                from 
				                    RPJONRSRT m
				                    , CCUSERAMT n
				                where 
				                    m.RSRH_ID = n.LGIN_ID
				                /* and m.USE_YN = 'Y' */
				                group by m.RSRC_PRJC_CD
				            ) c1
				        where 
				            1=1
				            and a1.phrm_ctrl_cd = 'SD117'
				            and a1.phrm_lwrn_ctrl_cd = b1.RSRC_PRJC_CD
				            and b1.RSRC_PRJC_CD = c1.RSRC_PRJC_CD
				            and rownum =1
				    ) c
				    , SDDGEFFCT d /*  약품효능 */
				    , MDORDRCMT e
				    , AIMFMDFET f
				where  
				1=1
				--   and a.MDPR_CD = 'A1CPX31'
				    and  b.MDFE_CD(+) = a.MDPR_CD
				    and  b.APST_YMD(+) <= trunc(sysdate)
				    and  b.APFN_YMD(+) >= trunc(sysdate)
				    and  c.MDPR_CD(+) = a.MDPR_CD   
				    and d.MDPR_CD = a.MDPR_CD
				    and (
				        (
				            a.MEGR_CD = '629'
				            and (
				            d.EFCC_LRCL_CD      = '08' 
				            and d.EFCC_MDCS_CD  = '12' 
				            and d.EFCC_SMCL_CD  = '18' 
				        	)                             
				        )      
		                or
		                (
		                    d.EFCC_LRCL_CD = '08'
		                    and d.EFCC_MDCS_CD = '12'
		                    and d.EFCC_SMCL_CD = '06'
		                    and d.EFCC_DTCL_CD in ( '12', '16', '20')
		                )          
				    )
				    and e.ordr_cd = a.mdpr_cd
				    and e.ordr_psbl_dvsn_cd = 'Y'
				    and a.mdpr_cd = f.mdfe_cd
				    and f.ORDR_PSBL_YN = 'Y'
				    and trunc(sysdate) between f.APST_YMD and f.APFN_YMD 
				    and e.ordr_cd = #{ordrCd}
					and a.ORDR_CLTY_CD <> 'B3' 
				]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFentanylPatchPsblOrdrQty-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="totCnt" column="TOT_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFentanylPatchPsblOrdrQty () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFentanylPatchPsblOrdrQty-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFentanylPatchPsblOrdrQty"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFentanylPatchPsblOrdrQty-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneFentanylPatchPsblOrdrQty */
				<![CDATA[ 
				    select  /* 펜타닐패치가능처방일수 */
				    	CASE 
				    	WHEN nvl(CEIL(sum(a.DDCN * a.NTM * a.pckn_Unad_Qty*3) - (to_date(#{ordrYmd},'yyyymmdd')-min(a.ordr_ymd) +1)),0) > 0
				    	THEN 
				        	63 - nvl(CEIL(sum(a.DDCN * a.NTM * a.pckn_Unad_Qty*3) - (to_date(#{ordrYmd},'yyyymmdd')-min(a.ordr_ymd) +1)),0)
				    	ELSE
				        	63 
				    	end as TOT_CNT
				    from 
				        MDMEDORDT  a
				    where 
				    1=1 
				    and a.PTNO = #{ptno}
				    and a.ORDR_YMD > trunc(to_date(#{ordrYmd}, 'yyyymmdd') - 60)
				    and a.DC_DVSN_CD= 'N'
				    and a.TMPR_ORDR_YN = 'N'
				    and a.ORDR_CD in 
				        ( 
				            select 
				                MDFE_CD 
				            from 
				                AIMFMDFET b
				            where 
				            1=1
				            and b.APST_YMD <= trunc(sysdate)
				            and b.APFN_YMD >= trunc(sysdate)
				            and b.MDFE_CD in 
				                (
				                    select 
				                        MDCR_DTLS_CTRL_CD 
				                    from 
				                        MZCTRLMMT c
				                where 
				                    1=1
				                    and c.MDCR_CTRL_CD = 'MDK_0207' 
				                )
				        )
				]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn3-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn3 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn3-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn3"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn3-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneCepaEffYn3 */
						<![CDATA[
						select
						    decode(sign(count(a.mdpr_cd)-1),-1,'N','Y') as YN
						from  
						    SDDDGCDMT a
						    , AIMFMDFET b /*  수가코드 */
						    ,  (
						        select   
						            a1.PHRM_DTLS_CTRL_NM as MDPR_CD  /* 약코드 */
						        from 
						            sdmctrlmt a1
						            , RPRSRPRJT b1 
						            , (
						                select 
						                    m.RSRC_PRJC_CD
						                    , WM_CONCAT(n.USER_NM) as COMM_USER_NM 
						                from 
						                    RPJONRSRT m
						                    , CCUSERAMT n
						                where 
						                    m.RSRH_ID = n.LGIN_ID
						                /* and m.USE_YN = 'Y' */
						                group by m.RSRC_PRJC_CD
						            ) c1
						        where 
						            1=1
						            and a1.phrm_ctrl_cd = 'SD117'
						            and a1.phrm_lwrn_ctrl_cd = b1.RSRC_PRJC_CD
						            and b1.RSRC_PRJC_CD = c1.RSRC_PRJC_CD
						            and rownum =1
						    ) c
						    , SDDGEFFCT d /*  약품효능 */
						    , MDORDRCMT e
						    , AIMFMDFET f
						where  
						1=1
						--   and a.MDPR_CD = 'A1CPX31'
						    and  b.MDFE_CD(+) = a.MDPR_CD
						    and  b.APST_YMD(+) <= trunc(sysdate)
						    and  b.APFN_YMD(+) >= trunc(sysdate)
						    and  c.MDPR_CD(+) = a.MDPR_CD   
						    and d.MDPR_CD = a.MDPR_CD
						    and (
						        (
						            a.MEGR_CD in('611', '612', '613', '614', '615', '618', '619', '625')           
						        )
						        or
						        (
						            a.MEGR_CD = '621'
						            and a.RPMD_ID <> 'SSZ'                                  
						        )        
						        or
						        (
						            a.MEGR_CD = '629'
						            and (
						            d.EFCC_LRCL_CD      = '08' 
						            and d.EFCC_MDCS_CD  = '12' 
						            and d.EFCC_SMCL_CD  = '18' 
						        )                             
						        )        
						        or
						        (
						            a.MEGR_CD = '641'
						            and a.RPMD_ID = 'MTN'                          
						        )           
						    )
						    and e.ordr_cd = a.mdpr_cd
						    and e.ordr_psbl_dvsn_cd = 'Y'
						    and a.mdpr_cd = f.mdfe_cd
						    and f.ORDR_PSBL_YN = 'Y'
						    and trunc(sysdate) between f.APST_YMD and f.APFN_YMD 
						    and e.ordr_cd = #{ordrCd}
							and a.ORDR_CLTY_CD <> 'B3'
						]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLsttFeeOrdrPsblYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLsttFeeOrdrPsblYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLsttFeeOrdrPsblYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLsttFeeOrdrPsblYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLsttFeeOrdrPsblYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneLsttFeeOrdrPsblYn */
		<![CDATA[ 
		select
		    decode(count(*), 0, 'N', 'Y') as YN
		from
		    (
		        select
		            case 
		            when a.count >= b.MDCR_CTRL_NMBR_VL1 then 'Y'
		            else 'N'
		            end as OVER_YN
		        from
		            (
		                select
		                    ordr_cd, count(a.ordr_cd) as count 
		                from 
		                    MDTRTORDT  a
		                where
		                    1=1
		                    and ptno = #{ptno}
		                    and trunc(a.ordr_ymd) >=
		                                            (
		                                            select
		                                                trunc(mdcr_ymd)
		                                            from 
		                                                aprcrptnt
		                                            where
		                                                1=1
		                                                and mdrp_no = #{mdrpNo}
		                                            )
		                    and a.ordr_cd IN 
		                                    (
		                                        select MDCR_DTLS_CTRL_CD
		                                        from MZCTRLMMT
		                                        where MDCR_CTRL_CD = 'MDK_0213'
		                                    )   
		                    and a.dc_dvsn_cd = 'N'
		                    and a.tmpr_ordr_yn ='N'
		                group by ordr_cd
		            ) a
		            , MZCTRLMMT b
		        where
		            1=1
		            and b.MDCR_CTRL_CD = 'MDK_0213'
		            and b.MDCR_DTLS_CTRL_CD = a.ordr_cd
					and a.ordr_cd = #{ordrCd}
		    ) a
		where
		    1=1
		    and a.OVER_YN = 'Y'
		]]> 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8913-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
		<result property="notify" column="NOTIFY"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8913 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8913-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8913"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8913-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8913 */
		select decode(count(*), 0, 'N', 'Y') as YN
		       ,case when max(a.RCKI_CD)||max(a.INCM_STTS_DVSN_CD) = '182I' then 
		                   '수술후기록 미작성 상태입니다. 해당 기록을 작성하지 않으면 처방을 입력할 수 없습니다.'
		             when max(a.RCKI_CD)||max(a.INCM_STTS_DVSN_CD) = '182S' then 
		                   '수술후기록 서명미비 상태입니다. 해당 기록을 작성하지 않으면 처방을 입력할 수 없습니다.'
		             when max(a.RCKI_CD)||max(a.INCM_STTS_DVSN_CD) = '185I' then 
		                   '시술후기록 미작성 상태입니다. 해당 기록을 작성하지 않으면 처방을 입력할 수 없습니다.'
		             when max(a.RCKI_CD)||max(a.INCM_STTS_DVSN_CD) = '185S' then 
		                   '시술후기록 서명미비 상태입니다. 해당 기록을 작성하지 않으면 처방을 입력할 수 없습니다.'  
		             else ''
		        end as Notify
		from MRINDORCT a 
		  where 1=1
		    and a.PTNO = #{ptno}
		    and a.MDRP_NO = #{mdrpNo}
		    and a.MR_ICDR_ID = #{oddrId}
		    and a.RCKI_CD in ('182','185') /* 수술후기록, 시술후기록 */
		    and a.INCM_STTS_DVSN_CD in ('I','S') /* I: 미작성, S: 서명미비  */
		    and rownum =1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8914-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO">
	
		<result property="yn" column="YN"/>
		<result property="notify" column="NOTIFY"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8914 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8914-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8914"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveValdDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8914-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveValdDAO-selectOneChck8914 */
		 
		select 
		   case when count(YN) = 0 then 'N'
		        else 'Y'
		   end as YN
		  ,case when count(YN) = 0 then ''
		        else max(Notify)
		   end as Notify
		from
		(
		  select 'Y' as YN
		         ,'[중복 처방 안내] 처방일: '|| to_char(a.ORDR_YMD,'YYYY-MM-DD') || '/ 치료일수: '|| a.MDTE_DDCN ||' 일 처방이 존재합니다. 그래도 처방내림하시겠습니까?' as Notify
		 from MDREHORDT a 
		  where 1=1
		   and  a.PTNO = #{ptno} 
		   and  a.ORDR_CLTY_CD = 'F1'
		   and  a.DC_DVSN_CD = 'N'
		   and  a.ORDR_CD  = nvl(#{ordrCd},'XXXXX') 
		   and  a.ORDR_YMD + a.MDTE_DDCN > trunc(sysdate)
		   and rownum =1
		)  
	</select>



</mapper>