<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_MdpOrdrSaveChupDAO_sql.xml 
    Description : -->
<mapper namespace="MdpOrdrSaveChupDAO">


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCnntOrdrBndlSno-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrSno" column="ORDR_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCnntOrdrBndlSno () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCnntOrdrBndlSno-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCnntOrdrBndlSno"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCnntOrdrBndlSno-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCnntOrdrBndlSno_동시처방 묶음 번호 sequence 조회 */
				   CNNTBNDLNOQ.nextval as ORDR_SNO
			 from  dual
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDlysOrdrCnfrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDlysOrdrCnfrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDlysOrdrCnfrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDlysOrdrCnfrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDlysOrdrCnfrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDlysOrdrCnfrYn_투석처방확인여부 조회 */
				   case when a.RGOR_CNNU_ID is not null /*  정규처방확인간호사   */
				        then 'Y'
				        else 'N' end YN
			 from  MNHPBASET a
			where
				   a.PTNO  = #{ptno}
			  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOrdrBsisInfmRgorFinsYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOrdrBsisInfmRgorFinsYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOrdrBsisInfmRgorFinsYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOrdrBsisInfmRgorFinsYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOrdrBsisInfmRgorFinsYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOrdrBsisInfmRgorFinsYn_환자처방기본 정보 유무 및 정규처방 완료 여부 조회 */
				   case when count ( RGOR_CNNU_ID ) > 0  then 'Y' else 'N' end as YN /*  정규처방 확인간호사가 있을 경우 정규처방 완료 */
			 from  MDPAORDBT
			where  PTNO    = #{ptno}
			  and  MDRP_NO = #{mdrpNo}
			  and  ORDR_YMD = to_date( #{ordrYmd},'yyyymmdd')
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntCsrnScinList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="scinCd" column="SCIN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntCsrnScinList () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntCsrnScinList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntCsrnScinList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntCsrnScinList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntCsrnScinList_환자상병목록조회_제왕절개용 다건조회 */
				   b.SCIN_CD as SCIN_CD
			 from
				   APRCRPTNT a      /*  진료접수 */
				,  MDPADIAGT b      /*  환자상병내역 */
			where
				   a.PTNO    = #{ptno}
			  and  a.MCDP_CD = #{mcdpCd}
			  and  (
					   ((a.CODV_CD = 'O') and (a.MDCR_YMD = to_date(substr(#{mdcrDt}, 1, 8), 'YYYYMMDD')))
					or ((a.CODV_CD <> 'O') and (a.MDCR_DT = to_date(#{mdcrDt}, 'YYYYMMDDHH24MISS')))
				   )
			  and  a.CNCL_DT is null       /*  해당 진료과의 진료접수 번호를 모두 얻는다. */
			  and  b.MDRP_NO = a.MDRP_NO
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDmntDgmtScinExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrNm" column="ORDR_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDmntDgmtScinExstYn () 
        Description :                                           치매 약제 상병 존재 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDmntDgmtScinExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDmntDgmtScinExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDmntDgmtScinExstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDmntDgmtScinExstYn_치매약제_상병존재여부조회 단건조회 */
				   t.ORDR_NM as ORDR_NM
			 from
				   MDORDRCMT t
			where
				   t.ORDR_CD = #{ordrCd}
			  and  not exists
				   (
				   select  1
					 from  MDPADIAGT m
						,  MZCTRLMMT c
					where  m.MDRP_NO            = #{mdrpNo}
					  and  m.PTNO               = #{ptno}
					  and  m.MCDP_CD            = #{mcdpCd}
					  and  c.MDCR_CTRL_CD       = 'MM834'
					  and  c.MDCR_DTLS_CTRL_NM  = #{rpmdId}
					  and  c.MDCR_CTRL_CHRC_VL1 = m.SCIN_CD
				   )
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIdtrExmnWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIdtrExmnWrtgYn () 
        Description :                                           척도 검사 작성 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIdtrExmnWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIdtrExmnWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIdtrExmnWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIdtrExmnWrtgYn_척도검사작성여부 단건조회 */
				   a.CNT1 + b.CNT2 as TOTL_CCT
			 from
				   (
				   select  count(PTNO) as CNT1
					 from  MEDOCMBST a      /*  진료기록 */
						,  MEDOCMDTT b      /*  진료기록상세 */
					where  a.PTNO = #{ptno}
					  and  a.RCRD_DT between trunc(to_date(#{ordrYmd}, 'YYYYMMDD'), 'DAY') - 365
										 and to_date(#{ordrYmd}, 'YYYYMMDD')
					  and  b.RCRD_NO = a.RCRD_NO
					  and  b.RCAM_NO = a.RCAM_NO
					  and  (b.FORM_NO like '120073%' or b.FORM_NO like '120075%')
					  and  rownum = 1
				   )  a
				,  (
				   select  count(PTNO) as CNT2
					 from  MEDOCMBST a      /*  진료기록 */
						,  MEDOCMDTT b      /*  진료기록상세 */
					where  a.PTNO = #{ptno}
					  and  a.RCRD_DT between trunc(to_date(#{ordrYmd}, 'YYYYMMDD'), 'DAY') - 365
										 and to_date(#{ordrYmd}, 'YYYYMMDD')
					  and  b.RCRD_NO = a.RCRD_NO
					  and  b.RCAM_NO = a.RCAM_NO
					  and  b.FORM_NO like '120005%'
					  and  rownum = 1
				   )  b
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOtptOprtHxYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOtptOprtHxYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOtptOprtHxYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOtptOprtHxYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOtptOprtHxYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOtptOprtHxYn_환자외래수술력체크 단건조회 */
				   count(*) as TOTL_CCT
			 from
				   MDOPSCHET a      /*  수술스케쥴 */
			where
				   a.PTNO      = #{ptno}
			  and  a.CNCL_YMD is null
			  and  a.OPRT_YMD between to_date(#{oprtYmd}, 'YYYYMMDD')
								  and to_date(#{oprtYmd}, 'YYYYMMDD') + 1
			  and  a.CODV_CD   = 'O'
			  and  nvl(a.OPRT_STTS_CD, '1') not in ('6', '7', '8', '9')
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntGnotSlotYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntGnotSlotYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntGnotSlotYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntGnotSlotYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntGnotSlotYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntGnotSlotYn_외출외박여부조회 단건조회 */
				   count(*) as TOTL_CCT
			 from
				   MDPAGNOTT a        										   /*  환자외출외박 */
			where
				   a.PTNO = #{ptno}
			  and  to_date(#{ordrYmd}, 'YYYYMMDD')
				   between trunc(a.GNOT_PRRN_DT) and trunc(a.RVRS_PRRN_DT)     /*  처방일자가 예정일자 내인 경우 */
			  and  a.REAL_RVRS_DT is null           						   /*  복귀 시각이 없어야 외출 중으로 판단 */
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDschSmryRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDschSmryRcrdWrtgYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDschSmryRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDschSmryRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDschSmryRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDschSmryRcrdWrtgYn_퇴원요약작성여부조회 단건조회 */
				   'Y' as YN
			 from
				   APRCRPTNT a      /*  진료접수 */
				,  MEDOCMBST b      /*  진료기록 */
			where  a.MDRP_NO  = #{mdrpNo}
			  and  a.CNCL_DT is null
			  and  b.MDRP_NO  = a.MDRP_NO
			  and  b.RCKI_CD  = FN_CC_GET_CNST_VL('MED_002', 'S_ADDS_SMRY_RCRD')                 /*  003: 퇴원요약 */
			  and  b.WRDR_DCDR_APPR_ID is not null    /*  1차결재 된 것 */
			/*  and  b.RCRD_DT  = trunc(a.DSCH_PRRN_DT) */ /*  퇴원예정일에 기록된것_퇴원예정일 체크 제외 */
			  and  rownum     = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRsrn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="rsrn" column="RSRN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRsrn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRsrn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRsrn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRsrn-result" useCache="true" flushCache="false">
		<![CDATA[
		   select  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRsrn_환자주민번호조회 */
		                   FRRN||BRRN RSRN
		             from  APPTPTNTV
		            where  PTNO = #{ptno}
			]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertDrOnslNrdrUse () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertDrOnslNrdrUse"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
			   INSERT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertDrOnslNrdrUse */   /*+ mdd_durlogt_i02$I01_본인마약사용등록 다건등록DAM */
				 into  MDDURLOGT
					   (
					   ORDR_YMD
					,  MDRP_NO
					,  DPLC_LOG_SNO
					,  PTNO
					,  MCDP_CD
					,  CODV_CD
					,  ODDR_ID
					,  BEFR_ORDR_CD
					,  DVSN_NM
					,  FRST_RGSR_ID
					,  FRST_RGST_IP
					,  FRST_RGST_DT
					,  FRST_RGST_CLNT_PRGM_ID
					,  FRST_RGST_SRVR_PRGM_ID
					,  LAST_UPDR_ID
					,  LAST_UPDT_IP
					,  LAST_UPDT_DT
					,  LAST_UPDT_CLNT_PRGM_ID
					,  LAST_UPDT_SRVR_PRGM_ID
					   )
			   values  (
					   to_date(#{ordrYmd}, 'YYYYMMDD')
					,  #{mdrpNo}
					,  (
					   select  nvl(max(DPLC_LOG_SNO), 0) + 1
						 from  MDDURLOGT
						where  ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
						  and  MDRP_NO  = #{mdrpNo}
					   )
					,  #{ptno}
					,  #{mcdpCd}
					,  #{codvCd}
					,  #{oddrId}
					,  #{ordrCd}
					,  '본인마약'
					,  #{gvUserId}
					,  #{gvUserIp}
					,  sysdate
					,  #{gvClntPrgmId}
					,  #{gvSrvrPrgmId}
					,  #{gvUserId}
					,  #{gvUserIp}
					,  sysdate
					,  #{gvClntPrgmId}
					,  #{gvSrvrPrgmId}
					   )
			]]>
	</insert>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMdcrPrprTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMdcrPrprTrgtYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMdcrPrprTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMdcrPrprTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMdcrPrprTrgtYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMdcrPrprTrgtYn_진료적정성대상여부조회 단건조회 */
				   count(*) as TOTL_CCT
			 from
				   MDPRPRPAT c      /*  진료적정성평가대상환자 */
				,  APPTADIFT a      /*  환자부가정보 */
			where
				   c.VLTN_KIND_CD           = nvl(#{vltnKindCd}, c.VLTN_KIND_CD)
			  and  c.RGST_YMD between to_date(nvl('19940101', to_char(c.RGST_YMD, 'YYYYMMDD')), 'YYYYMMDD')
								  and to_date(nvl(#{ordrYmd}, to_char(c.RGST_YMD, 'YYYYMMDD')), 'YYYYMMDD')
			  and  nvl(c.PTSS_CD, 'x')      = nvl('1', nvl(c.PTSS_CD, 'x'))
			  and  nvl(c.PTNO, 'x')         = nvl(#{ptno}, nvl(c.PTNO, 'x'))
			  and  a.PTNO = c.PTNO
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLwcnOrdrInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="pcunInlsQty" column="PCUN_INLS_QTY"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="ihohDvsnCd" column="IHOH_DVSN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLwcnOrdrInfm () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLwcnOrdrInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLwcnOrdrInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLwcnOrdrInfm-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLwcnOrdrInfm_저함량처방조회 단건조회 */
				   a.ORDR_CD as ORDR_CD
				,  a.PCUN_INLS_QTY as PCUN_INLS_QTY
				,  a.ORDR_NM as ORDR_NM
				,  a.IHOH_DVSN_CD as IHOH_DVSN_CD
			 from
				   MDORDRCMT a      /*  처방코드 */
				,  AIMFMDFET b      /*  수가코드 */
			where
				   a.INGR_MNMM_CD  = #{ingrMnmmCd}
			  and  a.PCUN_INLS_QTY = #{pcunInlsQty}
			  and  a.ORDR_PSBL_DVSN_CD = 'Y'
			  and  a.ORDR_CLTY_CD in ('B1', 'B2', 'B3', 'B9')
			  and  a.IHOH_DVSN_CD <> '3'
			  and  b.MDFE_CD = a.ORDR_CD
			  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
			  and  ORDR_PSBL_YN = 'Y'
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfHxYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfHxYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfHxYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfHxYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfHxYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfHxYn_3년간수혈이력조회 단건조회DAM */
				   count(*) as TOTL_CCT
			 from
				   MDBLDORDT
			where
				   PTNO = #{ptno}
			  and  ORDR_CD in ('ML11054', 'ML12064')
			  and  ORDR_YMD between add_months(trunc(sysdate), -36)
								and trunc(sysdate)
			  and  nvl(DC_DVSN_CD, 'N') = 'N'
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfSdefYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfSdefYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfSdefYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfSdefYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfSdefYn-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntTrnfSdefYn_3년간수혈부작용조회 단건조회 */
		        nvl(sum(TOTL_CCT), 0)   as TOTL_CCT
		  from  (   select  count(*) as TOTL_CCT
		              from  MDBLDORDT a
		                 ,  MZCTRLMMT b
		             where  a.PTNO          =   #{ptno}
		               and  a.DC_DVSN_CD    =   'N'
		               and  a.ORDR_YMD between add_months(trunc(sysdate), -36) and trunc(sysdate)
		               and  b.MDCR_CTRL_CD          =   'MDI_8210'
		               and  b.MDCR_CTRL_CHRC_VL1    =   'E'
		               and  b.MDCR_DTLS_CTRL_CD     =   a.ORDR_CD
		               and  a.ORDR_YMD between b.APST_YMD and b.APFN_YMD
		            union  all
		            select  count(*)
		              from  MDEXMORDT a
		                 ,  MZCTRLMMT b
		             where  a.PTNO          =   #{ptno}
		               and  a.DC_DVSN_CD    =   'N'
		               and  a.ORDR_YMD between add_months(trunc(sysdate), -36) and trunc(sysdate)
		               and  b.MDCR_CTRL_CD          =   'MDI_8210'
		               and  b.MDCR_CTRL_CHRC_VL1    =   'C'
		               and  b.MDCR_DTLS_CTRL_CD     =   a.ORDR_CD
		               and  a.ORDR_YMD between b.APST_YMD and b.APFN_YMD
		        )
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnRcrdWrtgYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnRcrdWrtgYn_폐렴기록작성여부 단건조회 */
				   decode(count(*), 0, 'N', 'Y') as YN       /*  기록이 있다면 Y, 없다면 N을 반환한다. */
			 from  (
				   select
						   'Y' as YN
					 from
						   MEDOCMBST a
						,  MEDOCMDTT b
						,  MEFITMOBT c
					where
						   a.MDRP_NO           = #{mdrpNo}
					  and  a.RCRD_SAVE_DVSN_CD = '1'
					  and  a.ADMS_CNCL_YMD    is null
					  and  b.RCRD_NO           = a.RCRD_NO
					  and  c.OBJ_ID = 'mdd_medocmb_s13'
					  and  c.DTLS_SCOP_CD_VL = '0560085'       /*  폐렴기록 */
					  and  c.FORM_NO = b.FORM_NO
					union  all
				   select
						   'Y'
					 from
						   APRCRPTNT a
						,  APRCRPTNT b
						,  MEDOCMBST c
						,  MEDOCMDTT d
						,  MEFITMOBT e
					where
						   a.MDRP_NO           = #{mdrpNo}
					  and  b.PTNO              = a.PTNO
					  and  b.MDCR_DT           = a.ERRM_ARVL_DT
					  and  b.CODV_CD           = 'E'
					  and  b.CNCL_DT          is null
					  and  c.MDRP_NO           = b.MDRP_NO
					  and  c.RCRD_SAVE_DVSN_CD = '1'
					  and  c.ADMS_CNCL_YMD    is null
					  and  d.RCRD_NO           = c.RCRD_NO
					  and  e.OBJ_ID = 'mdd_medocmb_s13'
					  and  e.DTLS_SCOP_CD_VL = '0560085'       /*  폐렴기록 */
					  and  e.FORM_NO = d.FORM_NO
				   )
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBefOrdrRdtnPrsg-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="abrvMcdpCd" column="ABRV_MCDP_CD"/>
		<result property="yn" column="YN"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="oddrNm" column="ODDR_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBefOrdrRdtnPrsg () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBefOrdrRdtnPrsg-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBefOrdrRdtnPrsg"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBefOrdrRdtnPrsg-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBefOrdrRdtnPrsg_전처방방사선처리여부조회 단건조회 */
				   x.ORDR_CD as ORDR_CD
				,  x.ORDR_NM as ORDR_NM
				,  to_char(x.ORDR_YMD, 'YYYYMMDD') as ORDR_YMD
				,  x.CODV_CD as CODV_CD
				,  x.MCDP_CD as MCDP_CD
				,  (
				   select  ABRV_DPRT_CD
					 from  HZDEPTMMT
					where  DPRT_CD = x.MCDP_CD
				   ) as ABRV_MCDP_CD
				,  x.RDTN_PRSG_YN as YN
				,  x.ODDR_ID as ODDR_ID
				,  (
				   select  USER_NM
					 from  CCUSRDPHT
					where  USER_ID = x.ODDR_ID
				   ) as ODDR_NM
			 from  (
				   select  a.ORDR_CD
						,  a.ORDR_NM
						,  a.BLOD_ABRV_NM
						,  b.ORDR_YMD
						,  b.CODV_CD
						,  b.MCDP_CD
						,  b.RDTN_PRSG_YN
						,  b.ODDR_ID
					 from  MDORDRCMT a
						,  MDBLDORDT b
					where  upper(trim(a.BLOD_ABRV_NM)) in ('LDRBC', 'PLRBC', 'LDPC', 'SDP')
					  and  b.PTNO       = #{ptno}
					  and  b.ORDR_CD    = a.ORDR_CD
					  and  b.DC_DVSN_CD = 'N'
					order
					   by  b.ORDR_YMD desc
				   ) x
			where  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfRcdcSdefYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfRcdcSdefYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfRcdcSdefYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfRcdcSdefYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfRcdcSdefYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfRcdcSdefYn_수혈기록지부작용조회 단건조회 */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from
				   MNRBLOODT a          /*  수혈기록 */
				,  MDORDRCMT b          /*  처방코드기본 */
			where
				   a.PTNO = #{ptno}
			  and  (
					  nvl(a.TRNF_SDEF_YN, 'N') <> 'Y'           /*  Y가 아닌 경우 수혈중 부작용 있음 */
				   or nvl(a.TRNF_FNSH_NA_YN, 'N') <> 'Y'        /*  Y가 아닌 경우 수혈종료시 부작용 있음 */
				   )
			  and  b.ORDR_CD      = a.FRNS_BLOD_ORDR_CD
			  and  b.INDT_KIND_VL = #{indtKindVl}   /*  혈액제제구분코드 */
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnTrgtYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnTrgtYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPnmnTrgtYn_폐렴대상여부 단건조회 */
				   count(*) as TOTL_CCT
			 from
				   MDPNEUMDT        /*  폐렴적정성평가 */
			where
				   PNMN_PTSS_CD = '1'          /*  폐렴환자상태코드 */
			  and  MDRP_NO in
				   (
				   select  /*  입원진료접수번호 */
						   MDRP_NO
					 from
						   APRCRPTNT        /*  진료접수 */
					where
						   MDRP_NO = #{mdrpNo}
					  and  CNCL_DT is null
					union  all
				   select  /*  응급실->입원시 응급진료접수번호 */
						   b.MDRP_RLTN_MDRP_NO     /*  진료접수관계진료접수번호 */
					 from
						   APRCRPTNT a      /*  진료접수 */
						,  APRCRLTNT b      /*  진료접수관계 */
					where
						   a.MDRP_NO = #{mdrpNo}
					  and  a.CNCL_DT is null
					  and  a.AMPA_CD = '7'     /*  7: 응급실경유입원 */
					  and  a.MDRP_NO = b.MDRP_NO
					  and  b.MDRP_RLTN_DVSN_CD = '01'          /*  01 : ER -> 입원 */
				   )
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntAnagOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntAnagOrdrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntAnagOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntAnagOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntAnagOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntAnagOrdrYn_항균제처방횟수조회 단건조회 */
				   count(*) as TOTL_CCT
			 from
				   MDMEDORDT a      /*  약처방 */
				,  MDORDRCMT b      /*  처방코드기본 */
			where
				   a.MDRP_NO      = #{mdrpNo}
			  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			  and  b.ORDR_CD = a.ORDR_CD
			  and  b.ANTB_YN = 'Y'     /*  항균제여부 = Y */
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsRcrdWrtgYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsRcrdWrtgYn_입원기록작성여부 단건조회 */
		select YN as YN
		  from (select 'Y' as YN
		          from MEDOCMBST /*  진료기록 */
		         where MDRP_NO = #{mdrpNo}
		           and CHRT_OTAM_DVSN_CD = 'I'	/* 차트외래입원구분코드 */
		           and RCRD_SAVE_DVSN_CD = '1'	/* 기록저장구분코드 (1:서명) */
		           and DLTN_YN = 'N'
		           and RCKI_CD in (FN_CC_GET_CNST_VL('MED_002','S_DYS1_ADDS_RCRD'), FN_CC_GET_CNST_VL('MED_002','S_ADMS_RCRD'))
		           and ADMS_CNCL_YMD is null
		           and rownum = 1
		         union all
		        select 'Y' as YN
		          from MRBLOCKMT /*  처방블록해지등록 */
		         where PTNO = #{ptno}
		           and sysdate between TRNT_STRT_DT and TRNT_FNSH_DT
		           and nvl(RGST_CNCL_YN,'Y') = 'Y'
		           and rownum = 1)
		 where rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLntrAdmsVltnRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
		<result property="rcrdYmd" column="RCRD_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLntrAdmsVltnRcrdWrtgYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLntrAdmsVltnRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLntrAdmsVltnRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLntrAdmsVltnRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLntrAdmsVltnRcrdWrtgYn_장기입원재평가기록작성여부 단건조회 */
				   RCRD_WRTG_YN as YN
				,  to_char(TRGT_RCRD_YMD, 'YYYYMMDD') as RCRD_YMD
			 from  (
				   select  a.PTNO
						,  a.ADMS_DT
						,  a.APST_YMD + a.DDCN as TRGT_RCRD_YMD
						,  b.MCDP_CD
						,  a.DDCN
						,  (
						   select  decode(count(1), 1, 'Y', 'N')
							 from  MEDOCMBST i
								,  MEDOCMDTT j
								,  MEFITMOBT k
							where  i.PTNO = a.PTNO
							  and  i.RCRD_DT between a.APST_YMD + a.DDCN - 1
												 and a.APST_YMD + a.DDCN + 1
							  and  i.RCRD_SAVE_DVSN_CD = '1'
							  and  i.RCRD_NO = j.RCRD_NO
							  and  j.FORM_NO = k.FORM_NO
							  and  k.OBJ_ID = 'mdd_medocmb_s06'
							  and  k.DTLS_SCOP_CD_VL = '0560078'    /*  0560078 : 재평가기록 */
							  and  rownum = 1
						   ) as RCRD_WRTG_YN
						,  row_number() over (partition by a.PTNO order by a.APST_YMD desc) as ROW_NUM
					 from  (
						   select  /*+ leading(xxx yyy) no_merge(xxx)*/
		                           xxx.MDRP_NO
								,  xxx.PTNO
								,  xxx.ADMS_DT
								,  xxx.MCDP_CD
								,  xxx.APST_YMD
								,  xxx.APFN_YMD
								,  yyy.LV * 29 as DDCN
							 from  (
								   /*  1. fromdate부터 첫 recdate까지 */
								   select  t1.MDRP_NO
										,  t1.PTNO
										,  t1.ADMS_DT
										,  t1.MCDP_CD
										,  t1.APST_YMD
										,  nvl(min(t2.RCRD_DT), t1.APFN_YMD) as APFN_YMD
										,  case when nvl(min(t2.RCRD_DT), t1.APFN_YMD) = to_date('29991231', 'YYYYMMDD')
													 then trunc(sysdate) - t1.APST_YMD + 1
												else nvl(min(t2.RCRD_DT), t1.APFN_YMD) - t1.APST_YMD + 1
										   end as DDCN
									 from  (
										   select  xx.MDRP_NO
												,  xx.PTNO
												,  xx.ADMS_DT
												,  min(xx.MCDP_CD) keep (dense_rank first order by xx.APST_YMD) as MCDP_CD
												,  xx.GRP
												,  min(xx.APST_YMD) as APST_YMD
												,  max(xx.APFN_YMD) as APFN_YMD
												,  case when max(xx.APFN_YMD) = to_date('29991231', 'YYYYMMDD') then trunc(sysdate) - min(xx.APST_YMD) + 1
														else max(xx.APFN_YMD) - min(xx.APST_YMD) + 1
												   end as DDCN
											 from  (
												   select  x.*
														,  sum(x.FLAG) over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as GRP
													 from  (
														   select  t1.*
																,  t2.RSRN as RSRN_1
																,  t3.RSRN as RSRN_2
																,  case when (t1.MCDP_CD = t1.PREV_MCDP_CD or t1.GNDR_ID = t1.PREV_GNDR_ID or t2.RSRN = nvl(t3.RSRN, ''))
																			 and t1.APST_YMD = t1.PREV_APFN_YMD + 1 then 0
																   else 1 end as FLAG
															 from  (
																   select  x.MDRP_NO
																		,  x.PTNO
																		,  x.ADMS_DT
																		,  x.MCDP_CD
																		,  x.APST_YMD
																		,  x.APFN_YMD
																		,  x.GNDR_ID
																		,  x.CHDR_ID
																		,  lag(x.APST_YMD) over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as PREV_APST_YMD
																		,  lag(x.APFN_YMD) over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as PREV_APFN_YMD
																		,  lag(x.MCDP_CD)  over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as PREV_MCDP_CD
																		,  lag(x.GNDR_ID)  over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as PREV_GNDR_ID
																		,  lag(x.CHDR_ID)  over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as PREV_CHDR_ID
																	 from  (
																		   select  t1.MDRP_NO
																				,  t1.PTNO
																				,  t1.ADMS_DT
																				,  t1.MCDP_CD
																				,  t1.APST_YMD
																				,  t1.APFN_YMD
																				,  t1.GNDR_ID
																				,  t1.CHDR_ID
																			 from  APRCDTRTT t1     /*  전과전실 */
																				,  APRCRPTNT t2     /*  진료접수 */
																			where  t2.MDRP_NO = #{mdrpNo}
																			  and  to_char(t2.MDCR_DT,'YYYYMMDD') >= fn_cc_get_cnst_vl('CCO_001', 'OPEN_DT')
																			  and  t1.MDRP_NO = t2.MDRP_NO
																			  and  t2.DSCH_DT = to_date('29991231', 'YYYYMMDD')
																			  and  t1.MCDP_CD <> fn_cc_get_dprt_cd('DPRT_ER')     /*  응급실은 제외 */
																		   ) x
																	order
																	   by  x.APST_YMD
																		,  x.APFN_YMD
																   ) t1
																,  (
																   select  t21.USER_ID
																		,  t23.EMPL_FRRN || t23.EMPL_BRRN as RSRN
																	 from  CCUSRDPHT t21
																		,  CCUSERAMT t22
																		,  HZUSERMMT t23
																	where  t21.LGIN_ID = t22.LGIN_ID
																	  and  t22.EMNO    = t23.EMNO
																   ) t2
																,  (
																   select  t31.USER_ID
																		,  t33.EMPL_FRRN || t33.EMPL_BRRN as RSRN
																	 from  CCUSRDPHT t31
																		,  CCUSERAMT t32
																		,  HZUSERMMT t33
																	where  t31.LGIN_ID = t32.LGIN_ID
																	  and  t32.EMNO    = t33.EMNO
																   ) t3
															where  t2.USER_ID(+) = t1.CHDR_ID
															  and  t3.USER_ID(+) = t1.PREV_CHDR_ID
														   ) x
												   ) xx
											where  1 = 1
											group
											   by  xx.MDRP_NO
												,  xx.PTNO
												,  xx.ADMS_DT
												,  xx.GRP
										   ) t1            /*  WITH구문 사용 불가 : 하단의 t1과 완전히 같으므로 수정시 양쪽을 수정해야 한다. */
										,  (
										   select  t2_1.PTNO
												,  t2_1.MDRP_NO
												,  t2_1.RCRD_DT
											 from  MEDOCMBST t2_1
												,  MEDOCMDTT t2_2
												,  MEFITMOBT t2_3
											where  t2_3.OBJ_ID = 'mdd_medocmb_s06'
											  and  t2_3.DTLS_SCOP_CD_VL = '0560078'
											  and  t2_2.FORM_NO = t2_3.FORM_NO
											  and  t2_2.RCRD_NO = t2_1.RCRD_NO
											  and  t2_1.MDRP_NO = #{mdrpNo}
										   ) t2
									where  t2.PTNO(+)    = t1.PTNO
									  and  t2.MDRP_NO(+) = t1.MDRP_NO
									  and  t2.RCRD_DT(+) between t1.APST_YMD and t1.APFN_YMD
									group
									   by  t1.MDRP_NO
										,  t1.PTNO
										,  t1.ADMS_DT
										,  t1.MCDP_CD
										,  t1.APST_YMD
										,  t1.APFN_YMD
									union  all
								   select  x.MDRP_NO
										,  x.PTNO
										,  x.ADMS_DT
										,  x.MCDP_CD
										,  x.APST_YMD
										,  nvl(x.NEXT_RCRD_DT, x.APFN_YMD) as APFN_YMD
										,  case when nvl(x.NEXT_RCRD_DT, x.APFN_YMD) = to_date('29991231', 'YYYYMMDD') then trunc(sysdate) - x.APST_YMD + 1
												else nvl(x.NEXT_RCRD_DT, x.APFN_YMD) - x.APST_YMD + 1 end
									 from  (
										   select  t1.MDRP_NO
												,  t1.PTNO
												,  t1.ADMS_DT
												,  t1.MCDP_CD
												,  t2.RCRD_DT as APST_YMD
												,  t1.APFN_YMD
												,  lead(t2.RCRD_DT) over (partition by t1.PTNO, t1.ADMS_DT, t1.MCDP_CD order by t2.RCRD_DT) as NEXT_RCRD_DT
											 from  (
												   select  xx.MDRP_NO
														,  xx.PTNO
														,  xx.ADMS_DT
														,  min(xx.MCDP_CD) keep (dense_rank first order by xx.APST_YMD) as MCDP_CD
														,  xx.GRP
														,  min(xx.APST_YMD) as APST_YMD
														,  max(xx.APFN_YMD) as APFN_YMD
														,  case when max(xx.APFN_YMD) = to_date('29991231', 'YYYYMMDD') then trunc(sysdate) - min(xx.APST_YMD) + 1
																else max(xx.APFN_YMD) - min(xx.APST_YMD) + 1
														   end as DDCN
													 from  (
														   select  x.*
																,  sum(x.FLAG) over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as GRP
															 from  (
																   select  t1.*
																		,  t2.RSRN as RSRN_1
																		,  t3.RSRN as RSRN_2
																		,  case when (t1.MCDP_CD = t1.PREV_MCDP_CD or t1.GNDR_ID = t1.PREV_GNDR_ID or t2.RSRN = nvl(t3.RSRN, ''))
																					 and t1.APST_YMD = t1.PREV_APFN_YMD + 1 then 0
																		   else 1 end as FLAG
																	 from  (
																		   select  x.MDRP_NO
																				,  x.PTNO
																				,  x.ADMS_DT
																				,  x.MCDP_CD
																				,  x.APST_YMD
																				,  x.APFN_YMD
																				,  x.GNDR_ID
																				,  x.CHDR_ID
																				,  lag(x.APST_YMD) over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as PREV_APST_YMD
																				,  lag(x.APFN_YMD) over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as PREV_APFN_YMD
																				,  lag(x.MCDP_CD)  over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as PREV_MCDP_CD
																				,  lag(x.GNDR_ID)  over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as PREV_GNDR_ID
																				,  lag(x.CHDR_ID)  over (partition by x.PTNO, x.ADMS_DT order by x.APST_YMD, x.APFN_YMD) as PREV_CHDR_ID
																			 from  (
																				   select  t1.MDRP_NO
																						,  t1.PTNO
																						,  t1.ADMS_DT
																						,  t1.MCDP_CD
																						,  t1.APST_YMD
																						,  t1.APFN_YMD
																						,  t1.GNDR_ID
																						,  t1.CHDR_ID
																					 from  APRCDTRTT t1     /*  전과전실 */
																						,  APRCRPTNT t2     /*  진료접수 */
																					where  t2.MDRP_NO = #{mdrpNo}
																					  and  to_char(t2.MDCR_DT,'YYYYMMDD') >= fn_cc_get_cnst_vl('CCO_001', 'OPEN_DT')
																					  and  t1.MDRP_NO = t2.MDRP_NO
																					  and  t2.DSCH_DT = to_date('29991231', 'YYYYMMDD')
																					  and  t1.MCDP_CD <> fn_cc_get_dprt_cd('DPRT_ER')     /*  응급실은 제외 */
																				   ) x
																			order
																			   by  x.APST_YMD
																				,  x.APFN_YMD
																		   ) t1
																		,  (
																		   select  t21.USER_ID
																				,  t23.EMPL_FRRN || t23.EMPL_BRRN as RSRN
																			 from  CCUSRDPHT t21
																				,  CCUSERAMT t22
																				,  HZUSERMMT t23
																			where  t21.LGIN_ID = t22.LGIN_ID
																			  and  t22.EMNO    = t23.EMNO
																		   ) t2
																		,  (
																		   select  t31.USER_ID
																				,  t33.EMPL_FRRN || t33.EMPL_BRRN as RSRN
																			 from  CCUSRDPHT t31
																				,  CCUSERAMT t32
																				,  HZUSERMMT t33
																			where  t31.LGIN_ID = t32.LGIN_ID
																			  and  t32.EMNO    = t33.EMNO
																		   ) t3
																	where  t2.USER_ID(+) = t1.CHDR_ID
																	  and  t3.USER_ID(+) = t1.PREV_CHDR_ID
																   ) x
														   ) xx
													where  1 = 1
													group
													   by  xx.MDRP_NO
														,  xx.PTNO
														,  xx.ADMS_DT
														,  xx.GRP
												   ) t1          /*  WITH구문 사용 불가 : 상단의 t1과 완전히 같으므로 수정시 양쪽을 수정해야 한다. */
												,  (
												   select  t2_1.PTNO
														,  t2_1.MDRP_NO
														,  t2_1.RCRD_DT
													 from  MEDOCMBST t2_1
														,  MEDOCMDTT t2_2
														,  MEFITMOBT t2_3
													where  t2_3.OBJ_ID = 'mdd_medocmb_s06'
													  and  t2_3.DTLS_SCOP_CD_VL = '0560078'
													  and  t2_2.FORM_NO = t2_3.FORM_NO
													  and  t2_2.RCRD_NO = t2_1.RCRD_NO
												   ) t2
											where  t2.PTNO    = t1.PTNO
											  and  t2.MDRP_NO = t1.MDRP_NO
											  and  t2.RCRD_DT between t1.APST_YMD and t1.APFN_YMD
										   ) x
								   ) xxx
								,  (select level as LV from dual connect by level <= 1000) yyy
							where  yyy.LV <= (xxx.DDCN / 29)
						   ) a
						,  APRCDTRTT b
						,  APRCRPTNT c      /*  진료접수 */
					where  1 = 1
					  and  b.MDRP_NO(+) = a.MDRP_NO
					  and  (a.APST_YMD + a.DDCN) between b.APST_YMD(+) and b.APFN_YMD(+)
					  and  b.WARD_CD not in (fn_cc_get_dprt_cd('WARD_ANTC_DAY'), fn_cc_get_dprt_cd('WARD_PSY_DAY'))   /*  C02C, PTC2, 09C, A5E */
					  and  c.MDRP_NO = a.MDRP_NO
					  and  to_char(c.MDCR_YMD,'YYYYMMDD') >= fn_cc_get_cnst_vl('CCO_001', 'OPEN_DT')
		              and  not exists (select 1 from MRCTRLMMT where MR_CTRL_CD = 'MRI_038' and MR_DTLS_CTRL_CD = c.PTNO)   /* 의무기록 제어코드에 등록된 장기입원환자는 미비 제외 */
				   )
			where  ROW_NUM = 1
			  and  trunc(sysdate) >= TRGT_RCRD_YMD
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="formNo" column="FORM_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtRcrdWrtgYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtRcrdWrtgYn_수술기록작성여부 단건조회 */
				   min(FORM_NO) as FORM_NO
			 from
				   (
				   select
						   '011111' as FORM_NO
					 from
						   APRCRPTNT x      /*  진료접수, a의MDRP_NO에 INDEX가 없어 추가 */
						,  MDOPSCHET a      /*  수술스케쥴 */
						,  MNSOPNRMT b      /*  수술간호기록 */
					where
						   x.MDRP_NO  = #{mdrpNo}
					  and  a.PTNO     = x.PTNO
					  and  a.MDRP_NO  = x.MDRP_NO
					  and  a.OPRM_CHOT_DT is not null      /*  수술실퇴실일시 */
		              and  a.OPRM_CHOT_DT >= to_date(fn_cc_get_cnst_vl('CCO_001', 'OPEN_DT'),'YYYYMMDD')  /* 퇴실일이 오픈일 이후 */
					  and  sysdate - a.OPRM_CHOT_DT > 0.5  /*  수술종료시간12시간이후 */
					  and  b.PTNO     = a.PTNO
					  and  b.OPRT_YMD = a.OPRT_YMD
					  and  b.OPRT_SNO = a.OPRT_SNO
					union  all
				   select
						   /*  substr(b.FORM_NO, 1, 6) FORM_NO */
						   c.DTLS_SCOP_CD_VL as FORM_NO
					 from
						   MEDOCMBST a      /*  진료기록 */
						,  MEDOCMDTT b      /*  진료기록상세 */
						,  MEFITMOBT c
					where
						   a.MDRP_NO = #{mdrpNo}
					  and  a.CHRT_OTAM_DVSN_CD = 'I'
					  and  a.RCRD_SAVE_DVSN_CD = '1'
					  and  a.RCKI_CD = '05'
					  and  a.ADMS_CNCL_YMD is null
					  and  b.RCRD_NO = a.RCRD_NO
					  and  b.RCAM_NO = a.RCAM_NO
					  and  sysdate - a.RCRD_DT > 0.5  /*  시술시간 12시간 이후 */
					  and  c.OBJ_ID  = 'mdd_medocmb_s07'
					  and  c.DTLS_SCOP_CD_VL in ('050085', '050086', '050087', '050088', '050144', '050142')
					  and  c.FORM_NO = b.FORM_NO
				   )
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntFormWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntFormWrtgYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntFormWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntFormWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntFormWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntFormWrtgYn */   /*+ mdd_medocmb_s08$S01_서식작성여부조회 단건조회DAM */
				   'Y' as YN
			 from
				   MEDOCMBST a      /*  진료기록 */
				,  MEDOCMDTT b      /*  진료기록상세 */
				,  MEFITMOBT c      /*  아이템정보사용객체관리 */
			where
				   a.MDRP_NO   = #{mdrpNo}
			  and  a.CHRT_OTAM_DVSN_CD = 'I'
			  and  a.RCRD_SAVE_DVSN_CD = '1'
			  and  a.ADMS_CNCL_YMD is null
			  and  b.RCRD_NO   = a.RCRD_NO
			  and  b.RCAM_NO   = a.RCAM_NO
			  and  c.OBJ_ID    = 'mdd_medocmb_s08'
			  and  c.DTLS_SCOP_CD_VL = '0560053'
			  and  c.FORM_NO   = b.FORM_NO
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomEnrmRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomEnrmRcrdWrtgYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomEnrmRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomEnrmRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomEnrmRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomEnrmRcrdWrtgYn_중환자실입실기록작성여부 단건조회 */
				   RCRD_WRTG_YN as YN
			 from
				(
				   select
						   'Y' as RCRD_WRTG_YN
					 from
						   MEDOCMBST a      /*  진료기록 */
						,  MEDOCMDTT b      /*  진료기록상세 */
						,  MEFITMOBT c
					where
						   a.MDRP_NO   = #{mdrpNo}
					  and  a.CHRT_OTAM_DVSN_CD = 'I'
					  and  a.RCRD_SAVE_DVSN_CD = '1'
					  and  a.ADMS_CNCL_YMD is null
					  and  b.RCRD_NO   = a.RCRD_NO
					  and  b.RCAM_NO   = a.RCAM_NO
					  and  c.OBJ_ID    = 'mdd_medocmb_s10'     /*  mdd_medocmb_s10와 공용으로 쓸 수 있다. */
					  and  c.DTLS_SCOP_CD_VL in ('0560070', '0560082', '0510032', '0510031')
					  and  c.FORM_NO   = b.FORM_NO
					union  all
				   select
						   'Y'
					 from
						   MRBLOCKMT        /*  처방블록해지등록 */
					where
						   PTNO = #{ptno}
					  and  sysdate between TRNT_STRT_DT and TRNT_FNSH_DT
					  and  nvl(RGST_CNCL_YN, 'Y') = 'Y'
					  and  rownum = 1
				)
			where  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomAdmsRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomAdmsRcrdWrtgYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomAdmsRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomAdmsRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomAdmsRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCrptRomAdmsRcrdWrtgYn_중환자실입원기록작성여부 단건조회 */
				   RCRD_WRTG_YN as YN
			 from
				(
				   select
						   'Y' as RCRD_WRTG_YN
					 from
						   MEDOCMBST a      /*  진료기록 */
						,  MEDOCMDTT b      /*  진료기록상세 */
						,  MEFITMOBT c      /*  */
					where
						   a.MDRP_NO   = #{mdrpNo}
					  and  a.CHRT_OTAM_DVSN_CD = 'I'
					  and  a.RCRD_SAVE_DVSN_CD = '1'
					  and  a.ADMS_CNCL_YMD is null
					  and  b.RCRD_NO   = a.RCRD_NO
					  and  b.RCAM_NO   = a.RCAM_NO
					  and  c.OBJ_ID = 'mdd_medocmb_s10'
					  and  c.DTLS_SCOP_CD_VL in ('0510057','0510032','0560070','0560082','0510031')    /*  중환자실 관련 기록들을 뽑기 위한 KEY */
					  and  b.FORM_NO = c.FORM_NO
					union  all
				   select
						   'Y'
					 from
						   MRBLOCKMT        /*  처방블록해지등록 */
					where
						   PTNO = #{ptno}
					  and  sysdate between TRNT_STRT_DT and TRNT_FNSH_DT
					  and  nvl(RGST_CNCL_YN, 'Y') = 'Y'
					  and  rownum = 1
				)
			where  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpcyTermRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpcyTermRcrdWrtgYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpcyTermRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpcyTermRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpcyTermRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpcyTermRcrdWrtgYn_특수치료실기록작성여부 단건조회 */
				   RCRD_WRTG_YN as YN
			 from
				(
				   select
						   'Y' as RCRD_WRTG_YN
					 from
						   MEDOCMBST a      /*  진료기록 */
						,  MEDOCMDTT b      /*  진료기록상세 */
						,  MEFITMOBT c
					where
						   a.MDRP_NO   = #{mdrpNo}
					  and  a.CHRT_OTAM_DVSN_CD = 'I'
					  and  a.RCRD_SAVE_DVSN_CD = '1'
					  and  a.ADMS_CNCL_YMD is null
					  and  b.RCRD_NO   = a.RCRD_NO
					  and  b.RCAM_NO   = a.RCAM_NO
					  and  c.OBJ_ID    = 'mdd_medocmb_s11'
					  and  c.DTLS_SCOP_CD_VL = '0560090'
					  and  c.FORM_NO   = b.FORM_NO
		              and  not exists (select 1 from MRCTRLMMT where MR_CTRL_CD = 'MRI_038' and MR_DTLS_CTRL_CD = a.PTNO) /* 의무기록제어코드에 등록된 장기재원환자 제외 */
				)
			where  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntItsvNtrtMnfeOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntItsvNtrtMnfeOrdrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntItsvNtrtMnfeOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntItsvNtrtMnfeOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntItsvNtrtMnfeOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntItsvNtrtMnfeOrdrYn_일일집중영양관리료처방건수 단건조회 */
				   count(a.PTNO) as TOTL_CCT
			 from
				   MDTRTORDT a      /*  처치처방 */
			where
				   a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
			  and  a.ORDR_CD  in (select CNST_VL from  COCONSTDT where CNST_GRP_ID = 'CCD_002' and  CNST_ID = 'ORDR_NST_FEE')
			  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtnt1WeekPerdItsvNtrtMnfeOrdr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtnt1WeekPerdItsvNtrtMnfeOrdr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtnt1WeekPerdItsvNtrtMnfeOrdr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtnt1WeekPerdItsvNtrtMnfeOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtnt1WeekPerdItsvNtrtMnfeOrdr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtnt1WeekPerdItsvNtrtMnfeOrdr_개인집중영양관리료 처방건수조회 단건조회 */
				   count(*) as TOTL_CCT
			 from
				   MDTRTORDT
			where
				   PTNO     = #{ptno}
			  and  ORDR_YMD between trunc(sysdate) - 6 and trunc(sysdate)
			  and  ORDR_CD  in (select CNST_VL from  COCONSTDT where CNST_GRP_ID = 'CCD_002' and  CNST_ID = 'ORDR_NST_FEE')
			  and  nvl(DC_DVSN_CD, 'N') = 'N'
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlVltnTrgtExmnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="etcVl" column="ETC_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlVltnTrgtExmnYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlVltnTrgtExmnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlVltnTrgtExmnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlVltnTrgtExmnYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlVltnTrgtExmnYn_당뇨평가대상검사여부 단건조회 */
				   nvl(a.HBA1C_EXMN_NEED_YN, 'N') ||
				   nvl(a.LPID_PROF_EXMN_NEED_YN, 'N') ||
				   nvl(a.ACRT_EXMN_NEED_YN, 'N') ||
				   nvl(a.FNDS_CAMR_EXMN_NEED_YN, 'N') as ETC_VL
			 from
				   MDDBMLAST a      /*  당뇨평가대상환자 */
				,  MZCTRLMMT b
			where
				   a.PTNO         = #{ptno}
			  and  a.VLTN_TRGT_YY = b.MDCR_DTLS_CTRL_CD     /*  평가대상년도 */
			  and  b.MDCR_CTRL_CD = 'MM705'
			  and  b.MDCR_CTRL_CHRC_VL1 = 'Y'
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsAplyBaseCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
		<result property="spsdId" column="SPSD_ID"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsAplyBaseCd () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsAplyBaseCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsAplyBaseCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsAplyBaseCd-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsAplyBaseCd_상병V코드 단건조회 */
				   'Y' as YN       			/*  조회성공여부 */
				,  SPSD_ID as SPSD_ID           /*  특정기호ID */
			 from
				   AIIMASABT        			/*  산정특례적용기준코드 */
			where
				   lpad(ASCS_APLY_BASE_CD, 4, '0') <= '7000'   /*  7000이하 = MM506 */
			  and  ASCS_SCIN_CLSF_CD = 'A'
			  and  trunc(sysdate) between nvl(APST_YMD, to_date('19950101', 'YYYYMMDD'))
									  and nvl(APFN_YMD, to_date('29991231', 'YYYYMMDD'))
			  and  STRT_SCIN_CD <= #{scinCd}
			  and  FNSH_SCIN_CD >  #{scinCd}
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlEdctYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlEdctYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlEdctYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlEdctYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlEdctYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDbmlEdctYn_1년내당뇨교육여부 단건조회 */
			       max(a.yn) as YN
			  FROM (
			        SELECT
			               decode(count(*), 0, 'N', 'Y') as YN
			         from
			               MDEXMORDT a      /*  검사처방 */
			            ,  MZCTRLMMT b      /*  처방제어코드 */
			        where
			               a.PTNO = #{ptno}
			          and  a.ORDR_YMD between to_date(#{ordrYmd}, 'YYYYMMDD') - 365
			                              and to_date(#{ordrYmd}, 'YYYYMMDD')
			          and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			          and  b.MDCR_CTRL_CD = 'MDP_131'
			          and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
			          and  rownum = 1
			        union all
			        SELECT
			               decode(count(*), 0, 'N', 'Y') as YN
			         from
			               MDTRTORDT a      /*  처치재료처방 */
			            ,  MZCTRLMMT b      /*  처방제어코드 */
			        where
			               a.PTNO = #{ptno}
			          and  a.ORDR_YMD between to_date(#{ordrYmd}, 'YYYYMMDD') - 365
			                              and to_date(#{ordrYmd}, 'YYYYMMDD')
			          and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			          and  b.MDCR_CTRL_CD = 'MDP_131'
			          and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
			          and  rownum = 1
			        ) a
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listVreInfcYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listVreInfcYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listVreInfcYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listVreInfcYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listVreInfcYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listVreInfcYn_입퇴원 시 VRE 관리 대상 환자 확인 */
				   'Y' as YN
			 from  QDSINFMDT QMD
				,  QDAINFDCT QDC
			where  1=1
			  and  QMD.PTNO          = #{ptno}
			  and  QMD.INFD_CD       = '00005'                     /*  151221 감염병코드 변경 : 접촉주의 VRE T001 >> 00005 */
			  and  QMD.CUTN_RELE_YMD = to_date('29991231', 'YYYYMMDD')
			  and  QDC.INFD_CD       = QMD.INFD_CD
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listUserDprtInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="dprtCd" column="DPRT_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listUserDprtInfm () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listUserDprtInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listUserDprtInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listUserDprtInfm-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listUserDprtInfm_사용자정보 부서정보조회 */
				   A.MDCR_DPRT_CD as DPRT_CD
			 from CCUSRDPHT A
				 , CCUSERAMT B
				 , HZDEPTMMT C
			where
				  A.USER_ID = #{userId}
			  and trunc(sysdate) between  A.APST_YMD and A.APFN_YMD
			  and A.MNSB_YN = 'Y'
			  and A.LGIN_ID  = B.LGIN_ID
			  and A.MDCR_DPRT_CD = c.DPRT_CD
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtHhMngmRgstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtHhMngmRgstYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtHhMngmRgstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtHhMngmRgstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtHhMngmRgstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtHhMngmRgstYn_수술시간관리등록여부 다건조회 */
				   decode(a.STRT_DT, a.FNSH_DT, '0', '1') as YN
			 from  (
				   select  OPRT_PTCP_ID
						,  STRT_DT
						,  FNSH_DT
					 from  MDOPTIMET        /*  수술시간관리 */
					where  PTNO     = #{ptno}
					  and  OPRT_YMD = to_date(#{oprtYmd}, 'YYYYMMDD')
					  and  OPRT_SNO = #{oprtSno}
					  and  OPRT_PTCP_DVSN_CD in ('D', 'A', 'C')     /*  수술참여자구분코드 D: 집도의, A: 지원의, C: 협진의 */
				   ) a
				,  CCUSRDPHT b
			where
				   b.USER_ID      = a.OPRT_PTCP_ID
			  and  b.MDCR_DPRT_CD = #{dprtCd}
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listWrfrOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listWrfrOrdrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listWrfrOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listWrfrOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listWrfrOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listWrfrOrdrYn_최근90일간와파린처방여부 단건조회 */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from
				   MDMEDORDT        /*  약처방 */
			where
				   PTNO         = #{ptno}
			  and  ORDR_YMD    >= to_date(#{ordrYmd}, 'YYYYMMDD') - 90       /*  최근 90일 */
		      and  TMPR_ORDR_YN = 'N'
			  and  DC_DVSN_CD   = 'N'                    /*  DC되지 않은 처방 */
			  and  ORDR_CD in (select s1.MDCR_DTLS_CTRL_CD from MZCTRLMMT s1
		                        where s1.MDCR_CTRL_CD = 'MDP_021'  /*  Warfarin */
		                          and to_date(#{ordrYmd},'YYYYMMDD') between s1.APST_YMD and s1.APFN_YMD)
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmtxRgstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmtxRgstYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmtxRgstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmtxRgstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmtxRgstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmtxRgstYn_협진등록여부조회 단건조회 */
				   count(*) as TOTL_CCT
			 from
				   MDCONSRCT
			where
				   PTNO            = #{ptno}
			  and  WNTD_DR_MCDP_CD = #{mcdpCd}
			  and  ORDR_YMD        = to_date(#{ordrYmd}, 'YYYYMMDD')
			  and  ORDR_CD         = nvl(#{ordrCd}, ORDR_CD)
			  and  nvl(DLTN_YN, 'N') <> 'Y'                  /*  삭제건 제외 */
			  and  nvl(CMTX_STTS_CD, '1') not in ('0', '9')  /*  임시저장 및 취소건 제외 */
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfAgdcExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfAgdcExstYn (수혈동의서 작성필요여부 체크.) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfAgdcExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfAgdcExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfAgdcExstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTrnfAgdcExstYn_1년내수혈동의서존재여부 단건조회 **/
		   select  FN_MD_GET_TRNF_AGDC_YN( #{ptno}
		                                               , #{codvCd}
		                                               , #{mdrpNo}
		                                               , #{mcdpCd}
		                                               , #{odkiCd}
		                                               , to_date(#{ordrYmd}, 'yyyymmdd')) as yn
			 from dual
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSrilDissTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSrilDissTrgtYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSrilDissTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSrilDissTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSrilDissTrgtYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSrilDissTrgtYn_4대중증질환대상여부 단건조회 */
				   'Y' as YN
			 from
				   MDPADIAGT a      /*  환자상병내역 */
				,  AIIMASABT b      /*  산정특례적용기준코드 */
			where
				   a.MDRP_NO       = #{mdrpNo}
			  and  b.SPCS_DVSN_CD  in ('01', '03')  /*  AI252, 01: 중증특례(암 질환), 03: 산정특례(희귀·난치질환) */
			  and  a.SCIN_CD       between b.STRT_SCIN_CD
									   and b.FNSH_SCIN_CD
			  and  a.SCIN_CD       not like b.FNSH_SCIN_CD || '%'
			  and  trunc(sysdate)  between b.APST_YMD
									   and b.APFN_YMD
			  and  exists          (select 1
									  from MDPEDCANT x
									 where x.PTNO    = a.PTNO
									   and x.MDRP_NO = a.MDRP_NO
								   )
			  and  exists
				   (
				   select  'Y'
					 from  APQLQLDLT x
					where  x.PTNO = a.PTNO
					  and  (
							  (x.SRIL_MDCR_RGST_NO is null and x.PTAD_AGNC_YMD between trunc(sysdate) - 7 and trunc(sysdate) + 0.99999)
							  or
							  (x.SRIL_MDCR_RGST_NO is null and x.CRTT_ISNC_DT >= trunc(sysdate))
							  or
							  (x.SRIL_MDCR_RGST_NO is not null and trunc(sysdate) between x.PTQL_STRT_YMD and x.PTQL_FNSH_YMD)
						   )
					  and  x.CNCL_DT is null
				   )
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRfslCtn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="etcVl" column="ETC_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRfslCtn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRfslCtn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRfslCtn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRfslCtn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRfslCtn_환자체크사항 조회 */
				  listagg(PTNT_RFRC_CLSF_CD, ',') within group(order by rownum) as ETC_Vl   /*  환자거부내용 */
			 from APPTCECKT a
			where 1=1
			  and a.PTNO         = #{ptno}
			  and a.CNCL_DT      is null
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDxUltsRoScinList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="scinCd" column="SCIN_CD"/>
		<result property="scinEnsnNm" column="SCIN_ENSN_NM"/>
		<result property="scinKornNm" column="SCIN_KORN_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDxUltsRoScinList () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDxUltsRoScinList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDxUltsRoScinList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDxUltsRoScinList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDxUltsRoScinList_진단초음파RO상병조회 다건조회 */
				   a.SCIN_CD as SCIN_CD
				,  a.SCIN_ENSN_NM as SCIN_ENSN_NM
				,  a.SCIN_KORN_NM as SCIN_KORN_NM
			 from  MRBSSCINT a
				,  (
				   select
						   STRT_SCIN_CD
						,  FNSH_SCIN_CD
					 from  AIIMASABT        /*  산정특례상병 */
					where  RO_SCIN_YN = 'Y'        /*  RO상병대상, MM506 MM507 통합자료 */
					  and  trunc(sysdate) between APST_YMD and APFN_YMD
				   ) b
			where  /*  입력한 조회 조건에 따라 조회 */
				   case
					 when #{inqrDvsnCd} = '0' and a.SCIN_CD like #{srchKywrCtn} || '%'                    then 1
					 when #{inqrDvsnCd} = '1' and upper(a.SCIN_ENSN_NM) like upper(#{srchKywrCtn}) || '%' then 1
					 when #{inqrDvsnCd} = '2' and a.SCIN_KORN_NM like #{srchKywrCtn}                      then 1
				   else 0
				   end           = 1
			  and  a.MDCR_USE_YN = 'Y'
			  and  trunc(sysdate) between a.APLY_YMD and a.FNSH_YMD
			  and  substr(a.SCIN_CD, 1, 1) <> '`'
			  and  a.SCIN_CD >= b.STRT_SCIN_CD
			  and  a.SCIN_CD <  b.FNSH_SCIN_CD
			order
			   by  SCIN_CD
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDproWardYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="wardCd" column="WARD_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDproWardYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDproWardYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDproWardYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDproWardYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDproWardYn_이중방병동 단건조회 */
				   DPRO_WARD_CD as WARD_CD
			 from
				   APRCRPTNT
			where
				   MDRP_NO = #{mdrpNo}
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDigestiveScinExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="scinCd" column="SCIN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDigestiveScinExstYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDigestiveScinExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDigestiveScinExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDigestiveScinExstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDigestiveScinExstYn_정장제관련상병존재여부 단건조회 */
				   a.SCIN_CD as SCIN_CD
			 from
				   MDPADIAGT a      /*  환자상병내역 */
			where
				   MDRP_NO = #{mdrpNo}
			  and  (
					  SCIN_CD like 'A08%'
				   or SCIN_CD like 'A09%'
				   or SCIN_CD like 'K50%'
				   or SCIN_CD like 'K51%'
				   or SCIN_CD like 'K52%'
				   )
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMri4SrilDissTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMri4SrilDissTrgtYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMri4SrilDissTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMri4SrilDissTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMri4SrilDissTrgtYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMri4SrilDissTrgtYn_MRI용 4대중증질환대상여부 단건조회 */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from
				   MDPADIAGT a      /*  환자상병내역 */
				,  AIIMASABT b      /*  특례상병코드 */
			where
				   a.MDRP_NO = #{mdrpNo}
			  and  a.MAIN_SCIN_YN = 'Y'
			  and  a.SCIN_CD <> 'I67.5'
			  and  b.SPCS_DVSN_CD = '03'       /*  특례구분코드(AI252) */
			  and  a.SCIN_CD >= b.STRT_SCIN_CD     /*  이상 */
			  and  a.SCIN_CD <  b.FNSH_SCIN_CD     /*  미만 */
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetBltnSrilDissTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetBltnSrilDissTrgtYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetBltnSrilDissTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetBltnSrilDissTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetBltnSrilDissTrgtYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetBltnSrilDissTrgtYn_PET고시용 4대중증질환대상여부 단건조회 */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from
				   MDPADIAGT a  /*  환자상병내역 */
				,  AIIMASABT b  /*  산정특례적용기준코드 */
			where
				   a.MDRP_NO = #{mdrpNo}
			  and  a.MAIN_SCIN_YN = 'Y'
			  and  b.SPCS_DVSN_CD in ('01', '02', '03')        /*  특례구분코드(AI252) */
			  and  a.SCIN_CD >= b.STRT_SCIN_CD
			  and  a.SCIN_CD <  b.FNSH_SCIN_CD
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetExmnOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetExmnOrdrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetExmnOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetExmnOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetExmnOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPetExmnOrdrYn_PET검사처방여부 단건조회 */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from
				   MDEXMORDT        /*  검사처방 */
			where
				   PTNO = #{ptno}
			  and  ORDR_CD in
				   (
				   select  MDCR_DTLS_CTRL_CD
					 from  MZCTRLMMT
					where  MDCR_CTRL_CD = 'MDP_119'       /*  MDP_119 : PET검사처방목록 */
					  and  to_date(#{ordrYmd}, 'YYYYMMDD') between APST_YMD and APFN_YMD    /*  사용기간 내의 처방들만 사용한다. */
				   )
			  and  nvl(WNTD_DT, ORDR_YMD) = to_date(#{ordrYmd}, 'YYYYMMDD')     /*  희망일자를 우선으로 보고 희망일자가 없는 경우 처방일자를 본다. */
			  and  DC_DVSN_CD = 'N'        /*  DC되지 않은 처방 */
			  and  ENFR_DT   is null       /*  아직 시행되지 않은 처방 */
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCancScinExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCancScinExstYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCancScinExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCancScinExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCancScinExstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCancScinExstYn_C상병존재여부 단건조회 */
				   'Y' as YN
			 from
				   MDPADIAGT    /*  환자상병내역 */
			where
				   MDRP_NO = #{mdrpNo}
			  and  SCIN_CD like 'C%'
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAcutUpprrespiratoryInfcPrprVltnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAcutUpprrespiratoryInfcPrprVltnYn () 
        Description :                                           급성 상기도 감염 적정성 평가 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAcutUpprrespiratoryInfcPrprVltnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAcutUpprrespiratoryInfcPrprVltnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAcutUpprrespiratoryInfcPrprVltnYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAcutUpprrespiratoryInfcPrprVltnYn_급성상기도감염적정성평가 단건조회 */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from  (
				   select
						   b.MDCR_DTLS_CTRL_CD
					 from
						   MDDURDUPT a
						,  MZCTRLMMT b
					where
						   a.PTNO     = #{ptno}
					  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
					  and  a.MCDP_CD  = #{mcdpCd}
					  and  b.MDCR_CTRL_CD      = 'MM157'
					  and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
					union  all
				   select
						   b.MDCR_DTLS_CTRL_CD
					 from
						   MDMEDORDT a
						,  MZCTRLMMT b
					where
						   a.PTNO      = #{ptno}
					  and  a.ORDR_YMD  = to_date(#{ordrYmd}, 'YYYYMMDD')
					  and  a.MCDP_CD   = #{mcdpCd}
					  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
					  and  b.MDCR_CTRL_CD = 'MM157'
					  and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
				   )
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDplcExmnTrgtOrdrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="abrvMcdpCd" column="ABRV_MCDP_CD"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="nextMdcrYmd" column="NEXT_MDCR_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDplcExmnTrgtOrdrList () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDplcExmnTrgtOrdrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDplcExmnTrgtOrdrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDplcExmnTrgtOrdrList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ LEADING(a) INDEX(a MDEXMORDT_I05) SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDplcExmnTrgtOrdrList_중복검사대상처방조회_다건조회DAM */
				   distinct
				   a.ORDR_CD as ORDR_CD                                       /*  검사코드 */
				,  b.ORDR_NM as ORDR_NM                                       /*  검사명   */
				,  to_char(a.ORDR_YMD, 'YYYYMMDD') as ORDR_YMD     /*  처방일자 */
				,  a.MCDP_CD as MCDP_CD                                       /*  진료과   */
				,  (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = a.MCDP_CD) as ABRV_MCDP_CD   /*  약어진료과명 */
				,  decode(a.APNT_DT,
					   null, decode(to_char(a.WNTD_DT, 'YYYYMMDD'),
					   to_char(a.ORDR_YMD, 'YYYYMMDD'), '--------', to_char(a.WNTD_DT, 'YYYYMMDD')),
					   to_char(a.APNT_DT, 'YYYYMMDD')) as APNT_DT  /*  예약일시 */
				,  (
				   select  to_char(min(MDCR_YMD), 'YYYYMMDD')
					 from  APRCRPTNT
					where  PTNO = a.PTNO
					  and  CODV_CD = 'O'
					  and  MDCR_YMD > trunc(sysdate)
					  and  CNCL_DT is null
					  and  MDCR_ANDV_CD not in ('8', '9')
					  and  MDDR_ID <> a.CHDR_ID
				   ) as NEXT_MDCR_YMD
			 from
				   MDEXMORDT a      /*  검사처방 */
				,  MDORDRCMT b      /*  처방코드마스터 */
				--,  MZCTRLMMT c      /*  처방제어코드 */
			where
				   a.PTNO      = #{ptno}
			  and  b.ORDR_CD = a.ORDR_CD
			  --and  c.MDCR_CTRL_CD = 'MM111'
			  --and  c.MDCR_DTLS_CTRL_CD = a.ORDR_CD
			  --and  a.ORDR_YMD between trunc(sysdate - c.MDCR_CTRL_NMBR_VL1)  /*  현재일로부터 처방마스터에 설정된 일자 이전까지의 검사처방검색 */
			  --			  and trunc(sysdate)
			  and  a.ORDR_YMD = trunc(sysdate)
			  and  a.PTAD_CODV_CD = #{codvCd}
			  and  a.ENFR_DT is null
			  and  nvl(a.DC_DVSN_CD, 'N') = 'N'         /*  취소된 처방 + DC된 처방 제외 */
			  and  nvl(a.RTRN_STTS_CD, 'N') = 'N'       /*  반환된 처방 제외 */
			order
			   by  MCDP_CD
				,  ORDR_CD
				,  ORDR_YMD
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOpioidDrugOrdrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="abrvMcdpCd" column="ABRV_MCDP_CD"/>
		<result property="pcknUnadQty" column="PCKN_UNAD_QTY"/>
		<result property="pcunCd" column="PCUN_CD"/>
		<result property="icunAdmnVlm" column="ICUN_ADMN_VLM"/>
		<result property="icunCd" column="ICUN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOpioidDrugOrdrList () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOpioidDrugOrdrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOpioidDrugOrdrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOpioidDrugOrdrList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntOpioidDrugOrdrList_타과Opioid처방조회 다건조회 */
				   a.PTNO as PTNO
				,  to_char(a.ORDR_YMD, 'YYYYMMDD') as ORDR_YMD
				,  a.ORDR_SNO as ORDR_SNO
				,  a.ORDR_CD as ORDR_CD
				,  b.ORDR_NM as ORDR_NM
				,  a.MCDP_CD as MCDP_CD
				,  (
				   select  ABRV_DPRT_CD
					 from  HZDEPTMMT
					where  DPRT_CD = a.MCDP_CD
				   ) as ABRV_MCDP_CD
				,  a.PCKN_UNAD_QTY as PCKN_UNAD_QTY
				,  a.PCUN_CD as PCUN_CD
				,  a.ICUN_ADMN_VLM as ICUN_ADMN_VLM
				,  a.ICUN_CD as ICUN_CD
			 from
				   MDMEDORDT a      /*  약처방 */
				,  MDORDRCMT b      /*  처방기본 */
			where
				   a.PTNO      = #{ptno}
			  and  a.ORDR_YMD >= to_date(#{ordrYmd}, 'YYYYMMDD') - 30
			  and  a.ORDR_CD  in
				   (
				   select  MDCR_DTLS_CTRL_CD
					 from  MZCTRLMMT
					where  MDCR_CTRL_CD = 'MDP_012'        /*  OPIOID 약처방 목록 */
					  and  to_date(#{ordrYmd}, 'YYYYMMDD') between APST_YMD and APFN_YMD
				   )
			  and  a.MCDP_CD <> #{mcdpCd}       /*  타과에서 입력한 처방만 조회 */
			  and  a.DC_DVSN_CD = 'N'          /*  DC되지 않은 처방 */
			  and  b.ORDR_CD    = a.ORDR_CD
			order
			   by  ORDR_YMD desc
				,  MCDP_CD
				,  ORDR_SNO desc
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagCmtxRefrBrkd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="cmtxWntdYmd" column="CMTX_WNTD_YMD"/>
		<result property="cnfrDvsnCd" column="CNFR_DVSN_CD"/>
		<result property="lmttAnagValdYmd" column="LMTT_ANAG_VALD_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagCmtxRefrBrkd () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagCmtxRefrBrkd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagCmtxRefrBrkd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagCmtxRefrBrkd-result" useCache="true" flushCache="false">
		<![CDATA[
		        select  /* 동일 제한항균제 협진의뢰내역 */
				        to_char(a.ORDR_YMD, 'YYYYMMDD')             as CMTX_WNTD_YMD /*  협진의뢰일자       */
				     ,  a.CNFR_DVSN_CD                              as CNFR_DVSN_CD         -- 확인구분코드(승인여부) - Y,N,Null
				     ,  decode(a.CNFR_DVSN_CD, 'N', nvl(to_char(a.LMTT_ANAG_VALD_YMD, 'YYYYMMDD'), to_char(a.CMTX_WNTD_YMD + 7, 'YYYYMMDD'))
		                          , to_char(a.LMTT_ANAG_VALD_YMD, 'YYYYMMDD')) as LMTT_ANAG_VALD_YMD  /*  유효일자 */
				  from  MDANTBRIT a
				     ,  MDORDRCMT b
				 where  a.MDRP_NO       =   #{mdrpNo}
				   and  b.ORDR_CD       =   a.ANAG_ORDR_CD
				   and  (   b.ORDR_CD   =   #{ordrCd}
				            or
				            b.ANTB_RPRS_INGR_CD =   (   select  ANTB_RPRS_INGR_CD
				                                          from  MDORDRCMT
				                                         where  ORDR_CD = #{ordrCd}
				                                    )
				        )
		         union
		        select  to_char(APST_YMD, 'YYYYMMDD')    /*  적용시작일자 */
		             ,  'A'                              /*  승인여부 : A 신청은 해야 하지만 신청하면 자동으로 승인 */
		             ,  to_char(APFN_YMD, 'YYYYMMDD')    /*  적용종료일자(유효일자) */
		          from  MDANTBRCT             /*  항균제추천 */
		         where  MDRP_NO    = #{mdrpNo}
		           and  ORDR_CD = #{ordrCd}
		           and  trunc(sysdate) between APST_YMD and APFN_YMD
		         order
		            by  1 desc, 2 desc
		        ]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ststDvsnCd" column="STST_DVSN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagList () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLmttAnagList_제한항균제목록 다건조회 */
				   ORDR_CD as ORDR_CD
				,  STST_DVSN_CD as STST_DVSN_CD
			 from
				   MDORDRCMT    /*  처방코드기본 */
			where
				   ORDR_CLTY_CD like 'B%'
			  and  STST_DVSN_CD in ('7', 'B')
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAgeTaboOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAgeTaboOrdrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAgeTaboOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAgeTaboOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAgeTaboOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAgeTaboOrdrYn_연령금기조회 다건조회 */
				   'Y' YN
			 from
				   SDMAGETBT        /*  연령금기관리 */
			where
				   MDPR_CD = #{ordrCd}
			  and  #{ddcn} between STRT_DDCN and FNSH_DDCN
			  and  ORDR_YN = 'S'
			  	and  rownum < 2
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listChrnKidnEdctYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listChrnKidnEdctYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listChrnKidnEdctYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listChrnKidnEdctYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listChrnKidnEdctYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listChrnKidnEdctYn_만성콩팥병교육여부 단건조회 */
				   ORDR_YMD as ORDR_YMD
			 from  (
				   select
						   to_char(ORDR_YMD, 'YYYYMMDD') as ORDR_YMD
						,  to_char(IMPL_YMD, 'YYYYMMDD') as IMPL_YMD
					 from
						   MDTRTORDT
					where
						   PTNO       = #{ptno}
					  and  ORDR_CD    = 'XB842'
					  and  DC_DVSN_CD = 'N'
					  and  nvl(RCST_CD, 'N') != 'R'        /*  수납된 교육만 2016.07.23 */
					order
					   by  ORDR_YMD desc
				   )
			where  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDietCmtxOrdrCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDietCmtxOrdrCd () 
        Description :                                           식사 협진 처방 코드를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDietCmtxOrdrCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDietCmtxOrdrCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDietCmtxOrdrCd-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDietCmtxOrdrCd_식이협진처방코드 다건조회 */
				   MDCR_CTRL_CHRC_VL1 as ORDR_CD
			 from
				   MZCTRLMMT
			where
				   MDCR_CTRL_CD = 'MDP_115'
			  and  MDCR_DTLS_CTRL_CD like #{ordrCd} || '%'
			order
			   by  MDCR_CTRL_CD
				,  MDCR_DTLS_CTRL_CD
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntDietCmtx-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntDietCmtx () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntDietCmtx-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntDietCmtx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntDietCmtx-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntDietCmtx_식이협진여부 단건조회 */
				   decode(count(*), 0, 'Y', 'N') as YN
			 from  (
				   select  1
					 from  MDCONSRCT        /*  협진기록 */
					where  PTNO = #{ptno}
					  and  ORDR_CD in
						   (
						   select  MDCR_DTLS_CTRL_CD
							 from  MZCTRLMMT
							where  MDCR_CTRL_CD = 'MDP_115'
							  and MDCR_DTLS_CTRL_CD = #{ordrCd}
						   )
					  and  ORDR_YMD between to_date(#{ordrYmd}, 'YYYYMMDD') - 180
										and to_date(#{ordrYmd}, 'YYYYMMDD')
					  and  nvl(DLTN_YN, 'N') <> 'Y'                  /*  삭제건 제외 */
					  and  nvl(CMTX_STTS_CD, '1') not in ('0', '9')  /*  임시저장 및 취소건 제외 */
					union  all
				   select  1
					 from  MDDURDUPT
					where  PTNO = #{ptno}
					  and  RGST_DT = to_date(#{mdcrDt}, 'YYYYMMDDHH24MISS')
					  and  THDY_BEFR_DVSN_CD = 'D'
				   )
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPrjtCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPrjtCd () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPrjtCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPrjtCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPrjtCd-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPrjtCd_임상연구프로젝트코드조회 다건조회 */
				   distinct
				   CLRS_PRJC_CD as CLRS_PRJC_CD
			 from  (
				   /*  VIEW사용에서 각 테이블 사용으로 변경 - 2016-05-27 */
				   select MDRP_NO, CLRS_PRJC_CD, DC_DVSN_CD from MDBASORDT union
				   select MDRP_NO, CLRS_PRJC_CD, DC_DVSN_CD from MDMEDORDT union
				   select MDRP_NO, CLRS_PRJC_CD, DC_DVSN_CD from MDEXMORDT union
				   select MDRP_NO, CLRS_PRJC_CD, DC_DVSN_CD from MDTRTORDT union
				   select MDRP_NO, CLRS_PRJC_CD, DC_DVSN_CD from MDBLDORDT union
				   select MDRP_NO, CLRS_PRJC_CD, DC_DVSN_CD from MDREHORDT
				   )
			where
				   MDRP_NO = #{mdrpNo}
			  and  nvl(DC_DVSN_CD, 'N') = 'N'
			  and  CLRS_PRJC_CD is not null
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPtntRgstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPtntRgstYn () 
        Description :                                           임상 연구 환자 등록 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPtntRgstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPtntRgstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPtntRgstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncRsrcPtntRgstYn_임상연구환자등록여부 단건조회*/
				   count(*) as TOTL_CCT
			from   (
				   select
						   'X'
					 from  RPTCLIPAT
					where  PRJT_CD    = #{clrsPrjcCd}
					  and  PTNO            = #{ptno}
					  and  rownum          = 1
				   )
			]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-deleteAcutUpprrespiratoryInfcPrprVltnTmprSave () 
        Description :                                           급성 상기도 감염 적정성 평가 약 임시 저장 삭제.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<delete id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-deleteAcutUpprrespiratoryInfcPrprVltnTmprSave"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
		   DELETE  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-deleteAcutUpprrespiratoryInfcPrprVltnTmprSave */   /*+ mdd_durdupt_d02$D01_약vs검사병용금기임시자료 삭제DAM */
			 from  MDDURDUPT
			where
				   PTNO    = #{ptno}
			  and  RGST_DT = to_date(#{ordrYmd}, 'YYYYMMDD')
			  and  THDY_BEFR_DVSN_CD in ('A', 'B', 'C')
			  and  FRST_RGST_SRVR_PRGM_ID = #{gvSrvrPrgmId}
			]]>
	</delete>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateImlnRltdYmd () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateImlnRltdYmd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
		update /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateImlnChfrMdex_임플란트관련일자 단건수정 */
		                APQLQLDLT
		       	   set
		                IMLN_DX_PLAN_YMD  = to_date(#{imlnDxPlanYmd}, 'YYYYMMDD')
		             ,  IMLN_OPRT_YMD     = to_date(#{imlnOprtYmd}, 'YYYYMMDD')
		             ,  IMLN_ISTL_YMD     = to_date(#{imlnIstlYmd}, 'YYYYMMDD')
		             ,  LAST_UPDR_ID = #{gvUserId}
		             ,  LAST_UPDT_IP = #{gvUserIp}
		             ,  LAST_UPDT_DT = current_timestamp
		             ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		             ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		         where
		                PTNO = #{ptno}
		           and  trunc(sysdate) between nvl(IMLN_ISTL_YMD, trunc(sysdate))
		                               and nvl(IMLN_ISTL_YMD, trunc(sysdate)) + 90
		           and  IMLN_MDPC_CD is null
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateImlnChfrMdex () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateImlnChfrMdex"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
		update  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateImlnChfrMdex_임플란트무료진찰 단건수정 */
		        APRCRPTNT    /* 진료접수 */
		   set  MCFE_RCPC_CD      = decode(#{sttsCd}, '1', #{sttsCd}, MCFE_RCPC_CD) /* 무료접수처리코드 */
		     ,  CHFR_RPTN_DVSN_CD = decode(#{sttsCd}, '1', '41', CHFR_RPTN_DVSN_CD) /* 임플란트 */
		     ,  LAST_UPDR_ID = #{gvUserId}
		     ,  LAST_UPDT_IP = #{gvUserIp}
		     ,  LAST_UPDT_DT = current_timestamp
		     ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		     ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		 where  MDRP_NO = #{mdrpNo}
		   and  CODV_CD = 'O'
		   and  CNCL_DT is null
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateClncRsrcPtntUpdtDt () 
        Description :                                           임상 연구 환자를 등록한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateClncRsrcPtntUpdtDt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		update  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateClncRsrcPtntUpdtDt_임상연구환자 단건수정 */
		        RPTCLIPAT
		 set  TRNT_YMD = null
		     ,  TRNR_ID  = null
		     ,  LAST_UPDR_ID      = #{gvUserId}
		     ,  LAST_UPDT_IP      = #{gvUserIp}
			 ,  LAST_UPDT_DT      = sysdate
			 ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
			 ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		 where PRJT_CD = #{clrsPrjcCd}
		   and PTNO = #{ptno}
		   and nvl(TRNT_YMD, to_date('29991231', 'yyyymmdd')) <![CDATA[ < ]]> sysdate
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateCscrDfntOrdrClrsCd () 
        Description :                                           접수내역에 임상연구코드 및 임상연구감면코드를 update한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateCscrDfntOrdrClrsCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
		update /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-updateCscrDfntOrdrClrsCd_CaseCart확정처방_진료접수_임상연구과제코드 수정 */
		       APRCRPTNT
		   set CLRS_PRJC_CD  = #{clrsPrjcCd}  /* 임상연구과제코드 */
		     , CLRS_RDEX_CD  = (select CLRS_RDEX_CD from RPRSRPRJT where RSRC_PRJC_CD = #{clrsPrjcCd} and rownum = 1)
		     , LAST_UPDR_ID  = #{gvUserId}
		     , LAST_UPDT_IP  = #{gvUserIp}
		     , LAST_UPDT_DT  = current_timestamp
		     , LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		     , LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		        where  MDRP_NO       = #{mdrpNo}       /* 진료접수번호 */
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertAcutUpprrespiratoryInfcPrprVltnDrugTmpr () 
        Description :                                           급성 상기도 감염 적정성 평가 약 임시 저장.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertAcutUpprrespiratoryInfcPrprVltnDrugTmpr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
			   INSERT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertAcutUpprrespiratoryInfcPrprVltnDrugTmpr */   /*+ mdd_durdupt_i10$I01_급성상기도감염적정성평가 다건등록DAM */
				 into  MDDURDUPT
					(
					   THDY_BEFR_DVSN_CD
					,  PTNO
					,  RGST_DT
					,  CMRS_SNO
					,  MCDP_CD
					,  ORDR_YMD
					,  ORDR_CD
					,  ORDR_CLTY_CD
					,  GRID_ROW_NO
					,  FRST_RGSR_ID
					,  FRST_RGST_IP
					,  FRST_RGST_DT
					,  FRST_RGST_CLNT_PRGM_ID
					,  FRST_RGST_SRVR_PRGM_ID
					,  LAST_UPDR_ID
					,  LAST_UPDT_IP
					,  LAST_UPDT_DT
					,  LAST_UPDT_CLNT_PRGM_ID
					,  LAST_UPDT_SRVR_PRGM_ID
					)
			   values  (
					   'A'
					,  #{ptno}
					,  to_date(#{ordrYmd}, 'YYYYMMDD')
					,  (
					   select  nvl(max(CMRS_SNO), 0) + 1
						 from  MDDURDUPT
						where  THDY_BEFR_DVSN_CD = 'A'
						  and  PTNO    = #{ptno}
						  and  RGST_DT = to_date(#{ordrYmd}, 'YYYYMMDD')
					   )
					,  #{mcdpCd}
					,  to_date(#{ordrYmd}, 'YYYYMMDD')
					,  #{ordrCd}
					,  #{ordrCltyCd}
					,  #{gridRowNo}
					,  #{gvUserId}
					,  #{gvUserIp}
					,  sysdate
					,  #{gvClntPrgmId}
					,  #{gvSrvrPrgmId}
					,  #{gvUserId}
					,  #{gvUserIp}
					,  sysdate
					,  #{gvClntPrgmId}
					,  #{gvSrvrPrgmId}
					)
			]]>
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertDietOrdrNtrtCmtxUnfl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertDietOrdrNtrtCmtxUnfl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
		   INSERT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertDietOrdrNtrtCmtxUnfl_식이처방영양협진미수행 단건등록DAM */
			 into  MDDURDUPT
				   (
				   THDY_BEFR_DVSN_CD
				,  PTNO
				,  RGST_DT
				,  CMRS_SNO
				,  FRST_RGSR_ID
				,  FRST_RGST_IP
				,  FRST_RGST_DT
				,  FRST_RGST_CLNT_PRGM_ID
				,  FRST_RGST_SRVR_PRGM_ID
				,  LAST_UPDR_ID
				,  LAST_UPDT_IP
				,  LAST_UPDT_DT
				,  LAST_UPDT_CLNT_PRGM_ID
				,  LAST_UPDT_SRVR_PRGM_ID
				   )
		   values  (
				   'D'
				,  #{ptno}
				,  to_date(#{mdcrDt}, 'YYYYMMDDHH24MISS')
				,  1
				,  #{gvUserId}
				,  #{gvUserIp}
				,  sysdate
				,  #{gvClntPrgmId}
				,  #{gvSrvrPrgmId}
				,  #{gvUserId}
				,  #{gvUserIp}
				,  sysdate
				,  #{gvClntPrgmId}
				,  #{gvSrvrPrgmId}
				   )
			]]>
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertClncRsrcPtntRgst () 
        Description :                                           임상 연구 환자를 등록한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertClncRsrcPtntRgst"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		insert /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertClncRsrcPtntRgst_임상연구환자등록 단건등록 */
		  into  RPTCLIPAT
		     (
		        PRJT_CD
		     ,  PTNO
		     ,  STRT_YMD
		     ,  TRNT_YMD
		     ,  TRNR_ID
		     ,  SPSB_CTN
		     ,  FRST_RGSR_ID
		     ,  FRST_RGST_IP
		     ,  FRST_RGST_DT
		     ,  FRST_RGST_CLNT_PRGM_ID
		     ,  FRST_RGST_SRVR_PRGM_ID
		     ,  LAST_UPDR_ID
		     ,  LAST_UPDT_IP
		     ,  LAST_UPDT_DT
		     ,  LAST_UPDT_CLNT_PRGM_ID
		     ,  LAST_UPDT_SRVR_PRGM_ID
		     )
		values
		     (
		        #{clrsPrjcCd}
		     ,  #{ptno}
			 ,  to_date(#{frstRgstDt}, 'YYYYMMDD')
		     ,  null
		     ,  null
			 ,  #{ctrlDscrCtn}
			 ,  #{gvUserId}
			 ,  #{gvUserIp}
			 ,  sysdate
			 ,  #{gvClntPrgmId}
			 ,  #{gvSrvrPrgmId}
			 ,  #{gvUserId}
			 ,  #{gvUserIp}
			 ,  sysdate
			 ,  #{gvClntPrgmId}
			 ,  #{gvSrvrPrgmId}
			 )
	</insert>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtCnvnTrgt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtCnvnTrgt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtCnvnTrgt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtCnvnTrgt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtCnvnTrgt-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtCnvnTrgt_복잡수술전환대상조회 단건조회 */
				   b.MDCR_DTLS_CTRL_CD as ORDR_CD
			 from
				   MDTMPCMTT a
				,  MZCTRLMMT b      /*  진료제어코드 */
			where
				   a.PTNO              = #{ptno}
			  and  a.RGST_YMD          = trunc(sysdate)
			  and  a.RESN_GRP_CD      is null
			  and  b.MDCR_CTRL_CD      = 'MM024'
			  and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
			  and  rownum              = 1
			]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertCmplOprtResnMngm () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertCmplOprtResnMngm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
			   INSERT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertCmplOprtResnMngm_복잡수술사유관리 다건등록 */
				 into  MDTMPCMTT
					   (
						PTNO
					 ,  RGST_YMD
					 ,  SQNC
					 ,  MCDP_CD
					 ,  CODV_CD
					 ,  ORDR_CD
					 ,  ORDR_NM
					 /*  AUDIT */
					 ,  FRST_RGSR_ID
					 ,  FRST_RGST_IP
					 ,  FRST_RGST_DT
					 ,  FRST_RGST_CLNT_PRGM_ID
					 ,  FRST_RGST_SRVR_PRGM_ID
					 ,  LAST_UPDR_ID
					 ,  LAST_UPDT_IP
					 ,  LAST_UPDT_DT
					 ,  LAST_UPDT_CLNT_PRGM_ID
					 ,  LAST_UPDT_SRVR_PRGM_ID
					   )
			   values  (
					   #{ptno}
					,  trunc(sysdate)
					,  (
					   select  nvl(max(SQNC), 0) + 1
						 from  MDTMPCMTT
						where  PTNO     = #{ptno}
						  and  RGST_YMD = trunc(sysdate)
					   )
					,  #{mcdpCd}
					,  #{codvCd}
					,  #{ordrCd}
					,  #{ordrNm}
					/*  AUDIT */
					,  #{gvUserId}
					,  #{gvUserIp}
					,  sysdate
					,  #{gvClntPrgmId}
					,  #{gvSrvrPrgmId}
					,  #{gvUserId}
					,  #{gvUserIp}
					,  sysdate
					,  #{gvClntPrgmId}
					,  #{gvSrvrPrgmId}
					   )
			]]>
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-deleteCmplOprtResnMngm () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<delete id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-deleteCmplOprtResnMngm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
		   DELETE  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-deleteCmplOprtResnMngm_복잡수술사유관리 삭제 */
			 from
				   MDTMPCMTT
			where
				   PTNO         = #{ptno}
			  and  RGST_YMD     = trunc(sysdate)
			  and  FRST_RGSR_ID = #{gvUserId}
			]]>
	</delete>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtResnList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="resnDetlCd" column="RESN_DETL_CD"/>
		<result property="ctrlDscrCtn" column="CTRL_DSCR_CTN"/>
		<result property="sqnc" column="SQNC"/>
		<result property="resnGrpCd" column="RESN_GRP_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtResnList () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtResnList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtResnList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtResnList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listCmplOprtResnList */   /*+ mdd_tmpcmtt_l01$S01_복잡수술사유 다건조회DAM */
				   a.ORDR_CD as ORDR_CD
				,  a.ORDR_NM as ORDR_NM
				,  c.MDCR_DTLS_CTRL_CD as RESN_DETL_CD
				,  c.CTRL_DSCR_CTN as CTRL_DSCR_CTN
				,  a.SQNC as SQNC
				,  c.MDCR_CTRL_CHRC_VL1 as RESN_GRP_CD
			 from
				   MDTMPCMTT a      /*  사유임시저장내역 */
				,  MZCTRLMMT b      /*  진료제어정보(MM023) */
				,  MZCTRLMMT c      /*  진료제어정보(MM022) */
			where
				   a.PTNO               = #{ptno}
			  and  a.RGST_YMD           = trunc(sysdate)
			  and  a.RESN_GRP_CD       is null
			  and  b.MDCR_CTRL_CD       = 'MM023'
			  and  b.MDCR_DTLS_CTRL_CD  = a.ORDR_CD
			  and  c.MDCR_CTRL_CD       = 'MM022'
			  and  c.MDCR_CTRL_CHRC_VL1 = b.MDCR_CTRL_CHRC_VL1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listFormNoInqr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="formNo" column="FORM_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listFormNoInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listFormNoInqr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listFormNoInqr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listFormNoInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listFormNoInqr */   /*+ mdd_mefitmo_s01$S01_서식번호조회 단건조회DAM */
				   FORM_NO as FORM_NO
			 from  (
				   select
						   a.FORM_NO
					 from
						   MEFITMOBT a       /*  아이템정보사용객체관리 */
						,  MEFORMBST b       /*  진료기록서식 */
					where
						   a.OBJ_ID          = #{objId}
					  and  a.DTLS_SCOP_CD_VL = #{dtlsScopCdVl}
					  and  a.FORM_ITM_ID     = '0'           /*  서식번호만 있으면 되기 때문에 아이템 번호를 0으로 고정 */
					  and  b.SPRN_DPRT_CD    = a.SPRN_DPRT_CD
					  and  b.FORM_NO         = a.FORM_NO
					  /* and  nvl(b.FORM_STTS_CD, 'S1') in ('S1', 'S6')    /*  MED_021 - S1:사용서식 */
					  and  nvl(b.DLTN_YN, 'N') = 'N'                      /*  삭제여부 */
					  and  trunc(sysdate) between b.STRT_DT and nvl(b.FNSH_YMD, to_date('29991231', 'yyyymmdd')) + .99999  /*  사용기간체크 */
					order
					   by  OBJ_SNO desc
				   )
			where
				   rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listScipIndxMngm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listScipIndxMngm () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listScipIndxMngm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listScipIndxMngm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listScipIndxMngm-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listScipIndxMngm_SCIP지표관리여부조회 단건조회 */
				   decode(max(PTNO), null, 'N', 'Y') as YN
			 from  (
				   select
						   a.PTNO
					 from
						   APRCRPTNT a      /*  진료접수 */
						,  MDOPSCHET b      /*  수술스케쥴 */
						,  APPTADIFT c      /*  환자부가정보 */
					where
						   a.MDRP_NO = #{mdrpNo}
					  and  a.CODV_CD  = 'I'
					  and  a.CNCL_DT  is null
					  and  c.PTNO     = a.PTNO
					  and  b.PTNO     = a.PTNO
					  and  b.OPRT_YMD between a.MDCR_DT - 1 and a.DSCH_DT + 1
					  and  b.ORDP_CD  = fn_cc_get_dprt_cd('DPRT_TS')       /*  111220 : TS */
					  and  b.CSCR_CD  = 'TSS000010'
					  and  b.OPSR_ID1 in
						   (
						   select  MDCR_DTLS_CTRL_CD
							 from  MZCTRLMMT
							where  MDCR_CTRL_CD = 'MDP_132'
							  and  MDCR_CTRL_CHRC_VL1 = fn_cc_get_dprt_cd('DPRT_TS')
						   )
					  and  b.OPRT_STTS_CD not in ('1', '9')
					  and  b.OPRT_YMD = c.LTST_OPRT_YMD
					union  all
				   select
						   a.PTNO
					 from
						   APRCRPTNT a      /*  진료접수 */
						,  MDOPSCHET b      /*  수술스케쥴 */
						,  APPTADIFT c      /*  환자부가정보 */
					where
						   a.MDRP_NO = #{mdrpNo}
					  and  a.CODV_CD  = 'I'
					  and  a.CNCL_DT  is null
					  and  c.PTNO     = a.PTNO
					  and  b.PTNO     = a.PTNO
					  and  b.OPRT_YMD between a.MDCR_DT - 1 and a.DSCH_DT + 1
					  and  b.ORDP_CD  = fn_cc_get_dprt_cd('DPRT_GS')       /*  111210 : GS */
					  and  b.CSCR_CD in ('GSS000007' , 'GSS000057', 'GSS000094', 'GSS000095', 'GSS000137', 'GSS000139',
							   'GSS000140', 'GSS000176', 'GSS000398', 'GSS000399', 'GSSC00007', 'GSSC00057',
							   'GSSC00094', 'GSSC00095', 'GSSC00137', 'GSSC00139', 'GSSC00140', 'GSSC00176',
							   'GSSC00398', 'GSSC00399', 'GSSC00443')
					  and  b.OPSR_ID1 in
						   (
						   select  MDCR_DTLS_CTRL_CD
							 from  MZCTRLMMT
							where  MDCR_CTRL_CD = 'MDP_132'
							  and  MDCR_CTRL_CHRC_VL1 = fn_cc_get_dprt_cd('DPRT_GS')
						   )
					  and  b.OPRT_STTS_CD not in ('1', '9')
					  and  b.OPRT_YMD = c.LTST_OPRT_YMD
				   )
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBeblOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBeblOrdrYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBeblOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBeblOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBeblOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listBeblOrdrYn_최근90일베타차단제처방여부 단건조회DAM */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from
				   MDMEDORDT a      /*  약처방 */
				,  MZCTRLMMT b
			where
				   a.PTNO     = #{ptno}
			  and  a.ORDR_YMD >= trunc(sysdate - 93)       /*  3개월 */
			  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			  and  b.MDCR_CTRL_CD      = 'MM986'
			  and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsExpaTrgtMtrl-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ascsScinClsfCd" column="ASCS_SCIN_CLSF_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsExpaTrgtMtrl () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsExpaTrgtMtrl-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsExpaTrgtMtrl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsExpaTrgtMtrl-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsExpaTrgtMtrl_산정특례확대대상자료조회 단건조회 */
				   b.ASCS_SCIN_CLSF_CD as ASCS_SCIN_CLSF_CD         /*  산정특례상병분류코드 */
			 from
				   MDPADIAGT a      /*  환자상병내역 */
				,  AIIMASABT b      /*  산정특례적용기준코드 */
			where
				   a.MDRP_NO      = #{mdrpNo}
			  and  lpad(b.ASCS_APLY_BASE_CD, 4, '0') between '7001' and '7999' /*  7001 ~ 7999 : 심장/뇌혈관질환 산정특례 상병목록 */
			  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
			  and  a.SCIN_CD >= b.STRT_SCIN_CD
			  and  a.SCIN_CD <  b.FNSH_SCIN_CD
			  and  not exists
				   (
				   select  1
					 from  MDPEDCANT x
						,  AIIMASABT y
					where  x.MDRP_NO = #{mdrpNo}
					  and  x.ASCS_CD = y.ASCS_APLY_BASE_CD
					  and  y.ASCS_SCIN_CLSF_CD in ('A', 'B')
					  and  y.SPSD_ID in ('V193', 'V000')       /*  V193 : 5%중증암, V000 : 0%결핵 */
				   )
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsScinOrdrExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsScinOrdrExstYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsScinOrdrExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsScinOrdrExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsScinOrdrExstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAssnSpcsScinOrdrExstYn_상병관련처방존재여부 단건조회 */
				   'Y' as YN       /*  처방존재여부 */
			 from
				   MDPASCINT a  /*  작업용환자상병내역 -  */
				,  AIMFMDFET b  /*  수가MASTER */
				,  AIIMASABT c  /*  산정특례적용기준코드 */
			where
				   a.PTNO    = #{ptno}
			  and  a.RGST_YMD = to_date(#{mdcrDt}, 'YYYYMMDD')
			  and  a.SCIN_CD is null
			  and  b.MDFE_CD = a.SCIN_CLNC_DX_NM               /*  주의 : a.SCIN_CD에는 처방코드가 들어 있음 */
			  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
			  and  c.ASCS_SCIN_CLSF_CD = #{ascsScinClsfCd}        /*  D1/D2 구분 */
			  and  c.SCIN_EDID_CD = '2'                                               /*  2 : EDI코드 */
			  and  c.EDI_CD = b.INSR_EDI_CD
			  and  trunc(sysdate) between c.APST_YMD and c.APFN_YMD
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrLcnsNo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrLcnsNo () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrLcnsNo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrLcnsNo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrLcnsNo-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrLcnsNo_사용자면허번호 단건조회 */
				   case when b.USER_LCNS_NO is null then 'N' else 'Y' end YN
			 from
				   CCUSRDPHT a
				,  CCUSERAMT b
			where
				   a.USER_ID = #{userId}
			  and  b.LGIN_ID = a.LGIN_ID
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="oprtKindCd" column="OPRT_KIND_CD"/>
		<result property="trgtExclResnCtn" column="TRGT_EXCL_RESN_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbYn_예방적항생제대상환자여부 다건조회 */
				   b.OPRT_KIND_CD as OPRT_KIND_CD
				,  (
				   select  nvl(min(INSR_CTRL_CHRC_VL2), 'E')
					 from  AICTRLMMT        /*  보험제어코드 */
					where  INSR_CTRL_CD = 'AI918'  /*  AI918 : 수술의예방적항생제 제외사유 */
					  and  instr(b.TRGT_EXCL_RESN_CTN, INSR_DTLS_CTRL_CD) > 0
				   ) as TRGT_EXCL_RESN_CTN
			 from
				   MDOPSCHET a      /*  수술스케쥴 */
				,  AIPVPAB4T b      /*  수술예방적항생제적정성평가조사표내역 */
			where
				   a.PTNO = #{ptno}
			  and  (
					 (
					 #{codvCd} in ('I', 'E') and
					 a.OPRT_YMD between to_date(substr(#{mdcrDt}, 1, 8), 'YYYYMMDD') and to_date('29991231', 'YYYYMMDD')
					 )
					 or
					 (
					 #{codvCd} in ('O', 'D') and
					 a.OPRT_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
				   )
			  and  a.CODV_CD = #{codvCd}
			  and  a.OPRT_STTS_CD not in ('1', '3', '9')       /*  MM126 수술Status */
			  and  a.CNCL_YMD is null
			  and  b.PTNO = a.PTNO
			  and  b.OPRT_YMD = a.OPRT_YMD
			  and  b.OPRT_ORNO = a.OPRT_SNO
			  and  nvl(b.OPRT_KIND_CD, 'Z') not in ('Y', 'Z')
			order
			   by  a.PTNO
				,  a.OPRT_YMD
				,  a.OPRM_CD
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOprtYmdInqr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="oprtYmd" column="OPRT_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOprtYmdInqr () 
        Description :                                           수술 예방적 항생제 수술 일자 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOprtYmdInqr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOprtYmdInqr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOprtYmdInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOprtYmdInqr_예방적항생제수술일자조회 단건조회 */
				   to_char(OPRT_YMD, 'YYYYMMDD') as OPRT_YMD
			 from  (
				   select
						   a.OPRT_YMD
					 from
						   MDOPSCHET a      /*  수술스케쥴 */
						,  AIPVPAB4T b      /*  수술예방적항생제적정성평가조사표내역 */
					where
						   a.PTNO = #{ptno}
					  and  (
							 (
							 #{codvCd} in ('I', 'E') and
							 a.OPRT_YMD between to_date(substr(#{mdcrDt}, 1, 8), 'YYYYMMDD') and to_date('29991231', 'YYYYMMDD')
							 )
							 or
							 (
							 #{codvCd} in ('O', 'D') and
							 a.OPRT_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
							 )
						   )
					  and  a.CODV_CD = #{codvCd}
					  and  a.OPRT_STTS_CD not in ('1', '3', '9')
					  and  a.CNCL_YMD is null
					  and  b.PTNO = a.PTNO
					  and  b.OPRT_YMD = a.OPRT_YMD
					  and  b.OPRT_ORNO = a.OPRT_SNO
					  and  nvl(b.OPRT_KIND_CD, 'Z') not in ('Y', 'Z')
					order
					   by  a.OPRT_YMD
				   )
			where  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptTrgtYn () 
        Description :                                           수술 예방적 항생제 사유 입력 대상 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptTrgtYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptTrgtYn */   /*+ mdd_medordt_s22$S01_예방적항생제사유팝업여부 단건조회DAM */
				   decode(max(MDCR_CTRL_CHRC_VL3), 'Y', 'N',
					   decode(count(distinct MDCR_CTRL_CHRC_VL4), 0, 'Y', 1, 'Y', 'N')
				   ) as YN
			 from
				   MDMEDORDT a      /*  약처방 */
				,  MZCTRLMMT b      /*  진료제어코드 */
				,  CCUSRDPHT c
			where  a.MDRP_NO = #{mdrpNo}
			  and  (
					 (
						  #{codvCd} in ('I', 'E')
					 and  a.ORDR_YMD between to_date(#{oprtYmd}, 'YYYYMMDD') and
											 to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
					 or
					 (
						  #{codvCd} in ('O', 'D')
					 and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
				   )
			  and  a.CODV_CD               = #{codvCd}
			  and  nvl(a.DC_DVSN_CD, 'N')  = 'N'
			  and  nvl(a.RCST_CD, 'N')     <> 'R'
			  and  nvl(a.PHRM_RTRN_QTY, 0) <= 0
			  and  b.MDCR_CTRL_CD          = 'MM965'
			  and  b.MDCR_DTLS_CTRL_CD     = a.ORDR_CD
			  and  c.USER_ID               = a.ODDR_ID
			  and  'Y' = fn_cc_check_dprt_list(c.MDCR_DPRT_CD, 'DPRT_GS|DPRT_OS|DPRT_OBGY|DPRT_TS|DPRT_NS|DPRT_URO|'||
			                                                   'DPRT_OPH|DPRT_FM|DPRT_ER|DPRT_ENT|DPRT_NR|DPRT_REH')
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInpt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInpt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInpt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInpt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInpt-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInpt_예방적항생제사유입력여부1 단건조회 */
				   'Y' as YN
			 from
				   MDOPANTIT    /*  수술예방적항생제로그 */
			where
				   MDRP_NO      = #{mdrpNo}
			  and  ANTB_ORRE_CD not in ('E104', 'E113', 'E114', 'E134')
			  and  rownum < 2
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbResnInptYn_예방적항생제사유입력여부2 단건조회 */
				   'Y' as YN
			 from
				   MDOPANTIT    /*  수술예방적항생제로그 */
			where
				   MDRP_NO = #{mdrpNo}
			  and  rownum < 2
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntb2DdOrdrDt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntb2DdOrdrDt () 
        Description :                                           최종예방적항생제처방일시: 예방적 항생제의 최종 처방일시를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntb2DdOrdrDt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntb2DdOrdrDt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntb2DdOrdrDt-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntb2DdOrdrD_최종예방적항생제처방일시 단건조회 */
				   FRST_RGST_DT as FRST_RGST_DT
			 from  (
				   select
						   to_char(a.FRST_RGST_DT, 'YYYYMMDDHH24MISS') as FRST_RGST_DT
					 from
						   MDMEDORDT a      /*  약처방 */
						,  MZCTRLMMT b      /*  진료제어코드 */
						,  CCUSRDPHT c
					where  a.PTNO = #{ptno}
					  and  (
							 (
								  #{codvCd} in ('I', 'E')
							 and  a.CODV_CD = #{codvCd}
							 and  a.MDRP_NO = #{mdrpNo}
							 and  a.ORDR_YMD between to_date(#{ordrYmd}, 'YYYYMMDD') - 2
												 and to_date(#{ordrYmd}, 'YYYYMMDD')
							 )
							 or
							 (
								  #{codvCd} in ('O', 'D')
							 and  a.CODV_CD = #{codvCd}
							 and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
							 )
						   )
					  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
					  and  nvl(a.RCST_CD, 'N') <> 'R'
					  and  nvl(a.PHRM_RTRN_QTY, 0) <= 0
					  and  b.MDCR_CTRL_CD = 'MM965'
					  and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
					  and  c.USER_ID = a.ODDR_ID
					  and  'Y' = fn_cc_check_dprt_list(c.MDCR_DPRT_CD, 'DPRT_GS|DPRT_OS|DPRT_OBGY|DPRT_TS|DPRT_NS|DPRT_URO|'||
			                                                   'DPRT_OPH|DPRT_FM|DPRT_ER|DPRT_ENT|DPRT_NR|DPRT_REH')
					order
					   by  a.FRST_RGST_DT desc
				   )
			where  rownum < 2
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbClsfResnInptTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbClsfResnInptTrgtYn () 
        Description :                                           수술 예방적 항생제 분류 사유 입력 대상 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbClsfResnInptTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbClsfResnInptTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbClsfResnInptTrgtYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbClsfResnInptTrgtYn_예방적항생제처방비교1 단건조회 */
				   'N' as YN
			 from
				   MDMEDORDT a      /*  약처방 */
				,  MZCTRLMMT b      /*  진료제어코드 */
				,  CCUSRDPHT c
			where  a.PTNO         = #{ptno}
			  and  a.FRST_RGST_DT = to_date(#{frstRgstDt}, 'YYYYMMDDHH24MISS')
			  and  (
					 (
						  #{codvCd} in ('I', 'E')
					 and  a.CODV_CD = #{codvCd}
					 and  a.MDRP_NO = #{mdrpNo}
					 and  a.ORDR_YMD between to_date(#{ordrYmd}, 'YYYYMMDD') - 2 and
											 to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
					 or
					 (
						  #{codvCd} in ('O', 'D')
					 and  a.CODV_CD = #{codvCd}
					 and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
				   )
			  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			  and  nvl(a.RCST_CD, 'N') <> 'R'
			  and  nvl(a.PHRM_RTRN_QTY, 0) <= 0
			  and  b.MDCR_CTRL_CD       = 'MM965'
			  and  b.MDCR_DTLS_CTRL_CD  = a.ORDR_CD
			  and  b.MDCR_CTRL_CHRC_VL4 = #{etcVl}
			  and  c.USER_ID = a.ODDR_ID
			  and  'Y' = fn_cc_check_dprt_list(c.MDCR_DPRT_CD, 'DPRT_GS|DPRT_OS|DPRT_OBGY|DPRT_TS|DPRT_NS|DPRT_URO|'||
			                                                   'DPRT_OPH|DPRT_FM|DPRT_ER|DPRT_ENT|DPRT_NR|DPRT_REH')
			  and  exists
				   (
				   select  'Y'
					 from  MDOPANTIT        /*  수술예방적항생제로그 */
					where  MDRP_NO = #{mdrpNo}
					  and  ORDR_YMD between to_date(#{ordrYmd}, 'YYYYMMDD') - 2
										and to_date(#{ordrYmd}, 'YYYYMMDD')
					  and  CODV_CD  = #{codvCd}
					  and  ANTB_CLSF_CD = #{antbClsfCd}
				   )
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbCmrsResnInptTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbCmrsResnInptTrgtYn () 
        Description :                                           수술 예방적 항생제 분류 사유 입력 대상 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbCmrsResnInptTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbCmrsResnInptTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbCmrsResnInptTrgtYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbCmrsResnInptTrgtYn_예방적항생제처방비교2 단건조회 */
				   'Y' as YN
			 from
				   MDMEDORDT a      /*  약처방 */
				,  MZCTRLMMT b      /*  진료제어코드 */
				,  CCUSRDPHT c
			where  a.PTNO         = #{ptno}
			  and  a.FRST_RGST_DT = to_date(#{frstRgstDt}, 'YYYYMMDDHH24MISS')
			  and  (
					 (
						  #{codvCd} in ('I', 'E')
					 and  a.CODV_CD  = #{codvCd}
					 and  a.MDRP_NO  = #{mdrpNo}
					 and  a.ORDR_YMD <= to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
					 or
					 (
						  #{codvCd} in ('O', 'D')
					 and  a.CODV_CD = #{codvCd}
					 and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
				   )
			  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			  and  nvl(a.RCST_CD, 'N') <> 'R'
			  and  nvl(a.PHRM_RTRN_QTY, 0) <= 0
			  and  b.MDCR_CTRL_CD       = 'MM965'
			  and  b.MDCR_DTLS_CTRL_CD  = a.ORDR_CD
			  and  b.MDCR_CTRL_CHRC_VL4 <> #{antbClsfCd}
			  and  c.USER_ID = a.ODDR_ID
			  and  'Y' = fn_cc_check_dprt_list(c.MDCR_DPRT_CD, 'DPRT_GS|DPRT_OS|DPRT_OBGY|DPRT_TS|DPRT_NS|DPRT_URO|'||
			                                                   'DPRT_OPH|DPRT_FM|DPRT_ER|DPRT_ENT|DPRT_NR|DPRT_REH')
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbInptYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbInptYn () 
        Description :                                           수술 예방적 항생제 입력 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbInptYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbInptYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbInptYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbInptYn_예방적항생제처방비교3 단건조회 */
				   'N' as YN
			 from
				   MDMEDORDT a      /*  약처방 */
				,  MZCTRLMMT b      /*  진료제어코드 */
				,  CCUSRDPHT c
			where  a.PTNO         = #{ptno}
			  and  a.CODV_CD      = #{codvCd}
			  and  (
					 (
						  #{codvCd} in ('I', 'E')
					 and  a.MDRP_NO = #{mdrpNo}
					 and  a.ORDR_YMD between to_date(#{ordrYmd}, 'YYYYMMDD') - 2 and
											 to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
					 or
					 (
						  #{codvCd} in ('O', 'D')
					 and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
				   )
			  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			  and  nvl(a.RCST_CD, 'N') <> 'R'
			  and  nvl(a.PHRM_RTRN_QTY, 0) <= 0
			  and  b.MDCR_CTRL_CD       = 'MM965'
			  and  b.MDCR_DTLS_CTRL_CD  = a.ORDR_CD
			  and  b.MDCR_CTRL_CHRC_VL4 = #{antbClsfCd}
			  and  c.USER_ID = a.ODDR_ID
			  and  'Y' = fn_cc_check_dprt_list(c.MDCR_DPRT_CD, 'DPRT_GS|DPRT_OS|DPRT_OBGY|DPRT_TS|DPRT_NS|DPRT_URO|'||
			                                                   'DPRT_OPH|DPRT_FM|DPRT_ER|DPRT_ENT|DPRT_NR|DPRT_REH')
			  and  exists
				   (
				   select  'Y'
					 from  MDOPANTIT        /*  수술예방적항생제로그 */
					where  MDRP_NO  = #{mdrpNo}
					  and  ORDR_YMD between to_date(#{ordrYmd}, 'YYYYMMDD') - 2
										and to_date(#{ordrYmd}, 'YYYYMMDD')
					  and  CODV_CD      = #{codvCd}
					  and  ANTB_CLSF_CD = #{antbClsfCd}
				   )
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLastOprtPrvvAntbOrdr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLastOprtPrvvAntbOrdr () 
        Description :                                           최종 수술 예방적 항생제 처방 일시를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLastOprtPrvvAntbOrdr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLastOprtPrvvAntbOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLastOprtPrvvAntbOrdr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listLastOprtPrvvAntbOrdr_최종예방적항생제처방일시2 단건조회 */
				   FRST_RGST_DT as FRST_RGST_DT
			 from  (
				   select
						   to_char(a.FRST_RGST_DT, 'YYYYMMDDHH24MISS') as FRST_RGST_DT
					 from
						   MDMEDORDT a      /*  약처방 */
						,  MZCTRLMMT b      /*  진료제어코드 */
						,  CCUSRDPHT c
					where  a.PTNO = #{ptno}
					  and  (
							 (
								  #{codvCd} in ('I', 'E')
							 and  a.CODV_CD = #{codvCd}
							 and  a.MDRP_NO = #{mdrpNo}
							 and  a.ORDR_YMD <= to_date(#{ordrYmd}, 'YYYYMMDD')
							 )
							 or
							 (
								  #{codvCd} in ('O', 'D')
							 and  a.CODV_CD = #{codvCd}
							 and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
							 )
						   )
					  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
					  and  nvl(a.RCST_CD, 'N') <> 'R'
					  and  nvl(a.PHRM_RTRN_QTY, 0) <= 0
					  and  b.MDCR_CTRL_CD = 'MM965'
					  and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
					  and  c.USER_ID = a.ODDR_ID
					  and  'Y' = fn_cc_check_dprt_list(c.MDCR_DPRT_CD, 'DPRT_GS|DPRT_OS|DPRT_OBGY|DPRT_TS|DPRT_NS|DPRT_URO|'||
			                                                   'DPRT_OPH|DPRT_FM|DPRT_ER|DPRT_ENT|DPRT_NR|DPRT_REH')
					order
					   by  a.FRST_RGST_DT desc
				   )
			where  rownum < 2
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOrdrCmrs-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOrdrCmrs () 
        Description :                                           수술 예방적 항생제 처방 비교를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOrdrCmrs-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOrdrCmrs"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOrdrCmrs-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbOrdrCmrs_예방적항생제처방비교2 단건조회 */
				   'Y' as YN
			 from
				   MDMEDORDT a      /*  약처방 */
				,  MZCTRLMMT b      /*  진료제어코드 */
				,  CCUSRDPHT c
			where  a.PTNO         = #{ptno}
			  and  a.FRST_RGST_DT = to_date(#{frstRgstDt}, 'YYYYMMDDHH24MISS')
			  and  (
					 (
						  #{codvCd} in ('I', 'E')
					 and  a.CODV_CD  = #{codvCd}
					 and  a.MDRP_NO  = #{mdrpNo}
					 and  a.ORDR_YMD <= to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
					 or
					 (
						  #{codvCd} in ('O', 'D')
					 and  a.CODV_CD = #{codvCd}
					 and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
					 )
				   )
			  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			  and  nvl(a.RCST_CD, 'N') <> 'R'
			  and  nvl(a.PHRM_RTRN_QTY, 0) <= 0
			  and  b.MDCR_CTRL_CD       = 'MM965'
			  and  b.MDCR_DTLS_CTRL_CD  = a.ORDR_CD
			  and  b.MDCR_CTRL_CHRC_VL4 <> #{antbClsfCd}
			  and  c.USER_ID = a.ODDR_ID
			  and  'Y' = fn_cc_check_dprt_list(c.MDCR_DPRT_CD, 'DPRT_GS|DPRT_OS|DPRT_OBGY|DPRT_TS|DPRT_NS|DPRT_URO|'||
			                                                   'DPRT_OPH|DPRT_FM|DPRT_ER|DPRT_ENT|DPRT_NR|DPRT_REH')
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbExstYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbExstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbExstYn_동일항생제처방여부 단건조회 */
				   'Y' as YN
			 from
				   MDMEDORDT a1     /*  약처방 */
				,  MZCTRLMMT b1     /*  진료제어정보 */
				,  CCUSRDPHT c1     /*  사용자진료조직관계이력 */
				,  (
				   select
						   max(a.ORDR_YMD) as MAX_ORDR_YMD
					 from
						   MDMEDORDT a      /*  약처방 */
						,  MZCTRLMMT b      /*  진료제어정보 */
						,  CCUSRDPHT c      /*  사용자진료조직관계이력 */
					where
						   a.MDRP_NO               = #{mdrpNo}
					  and  a.CODV_CD               = 'I'
					  and  nvl(a.DC_DVSN_CD, 'N')  = 'N'
					  and  nvl(a.RCST_CD, 'N')     <> 'R'
					  and  nvl(a.PHRM_RTRN_QTY, 0) <= 0
					  and  b.MDCR_CTRL_CD          = 'MM965'
					  and  b.MDCR_DTLS_CTRL_CD     = a.ORDR_CD
					  and  c.USER_ID               = a.ODDR_ID
					  and  'Y' = fn_cc_check_dprt_list(c.MDCR_DPRT_CD, 'DPRT_GS|DPRT_OS|DPRT_OBGY|DPRT_TS|DPRT_NS|DPRT_URO|'||
			                                                   'DPRT_OPH|DPRT_FM|DPRT_ER|DPRT_ENT|DPRT_NR|DPRT_REH')
				   ) d1
			where  a1.MDRP_NO               = #{mdrpNo}
			  and  a1.CODV_CD               = 'I'
			  and  nvl(a1.DC_DVSN_CD, 'N')  = 'N'
			  and  nvl(a1.RCST_CD, 'N')     <> 'R'
			  and  nvl(a1.PHRM_RTRN_QTY, 0) <= 0
			  and  b1.MDCR_CTRL_CD          = 'MM965'
			  and  b1.MDCR_DTLS_CTRL_CD     = a1.ORDR_CD
			  and  c1.USER_ID               = a1.ODDR_ID
			  and  'Y' = fn_cc_check_dprt_list(c1.MDCR_DPRT_CD, 'DPRT_GS|DPRT_OS|DPRT_OBGY|DPRT_TS|DPRT_NS|DPRT_URO|'||
			                                                   'DPRT_OPH|DPRT_FM|DPRT_ER|DPRT_ENT|DPRT_NR|DPRT_REH')
			  and  a1.ORDR_YMD              = d1.MAX_ORDR_YMD
			  and  a1.ORDR_CD               = #{ordrCd}
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbSameOrdrPpupHxYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbSameOrdrPpupHxYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbSameOrdrPpupHxYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbSameOrdrPpupHxYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbSameOrdrPpupHxYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtPrvvAntbSameOrdrPpupHxYn */   /*+ mdd_opantit_s03$S01_예방적항생제동일처방팝업이력 단건조회DAM */
				   'Y' as YN
			 from
				   MDOPANTIT    /*  수술예방적항생제로그 */
			where
				   MDRP_NO = #{mdrpNo}
			  and  CODV_CD = 'I'
			  and  ORDR_CD = #{ordrCd}
			  and  ANTB_ORRE_CD not in ('E104', 'E113', 'E114', 'E134')
			  and  rownum = 1
			]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertPrvvAntbResn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertPrvvAntbResn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
		insert
		          into  MDOPANTIT       /* 수술예방적항생제로그테이블 */
		             (
		                MDRP_NO
		             ,  OPRT_PRVN_LOG_SNO
		             ,  PTNO            /* 환자번호 */
		             ,  ORDR_YMD        /* 처방일자 */
		             ,  ORDR_CD         /* 처방코드 */
		             ,  CODV_CD         /* 환자구분 */
		             ,  ANTB_CLSF_CD    /* 항생제분류 */
		             ,  ANTB_ORRE_CD    /* 항생제처방사유코드 */
		             ,  ANTB_ORRE_CTN   /* 항생제처방사유기타커멘트 */
			 ,  FRST_RGSR_ID
			 ,  FRST_RGST_IP
			 ,  FRST_RGST_DT
			 ,  FRST_RGST_CLNT_PRGM_ID
			 ,  FRST_RGST_SRVR_PRGM_ID
			 ,  LAST_UPDR_ID
			 ,  LAST_UPDT_IP
			 ,  LAST_UPDT_DT
			 ,  LAST_UPDT_CLNT_PRGM_ID
			 ,  LAST_UPDT_SRVR_PRGM_ID
			 )
			  values
			  (
		                #{mdrpNo}
		             ,  (
		                select  nvl(max(OPRT_PRVN_LOG_SNO), 0) + 1
		                  from  MDOPANTIT
		                 where  MDRP_NO = #{mdrpNo}
		                )
		             ,  #{ptno}                             /* 환자번호 */
		             ,  to_date(#{ordrYmd} , 'yyyymmdd')    /* 처방일자 */
		             ,  #{ordrCd}                          /* 처방코드 */
		             ,  #{codvCd}                          /* 환자구분 */
		             ,  #{antbClsfCd}                     /* 항생제분류 */
		             ,  #{antbOrreCd}                     /* 항생제처방사유코드 */
		             ,  #{antbOrreCtn}                    /* 항생제처방사유기타커멘트 */
			 , #{gvUserId}
			 , #{gvUserIp}
			 , current_timestamp
			 , #{gvClntPrgmId}
			 , #{gvSrvrPrgmId}
			 , #{gvUserId}
			 , #{gvUserIp}
			 , current_timestamp
			 , #{gvClntPrgmId}
			 , #{gvSrvrPrgmId}
					)
			]]>
	</insert>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtCct () 
        Description :                                           수술 건수를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtCct-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOprtCct */
				   count(*) as TOTL_CCT
			 from
				   MDOPSCHET    /*  수술스케쥴 */
			where
				   PTNO = #{ptno}
			  and  OPRT_YMD between to_date(substr(#{mdcrDt}, 1, 8), 'YYYYMMDD')
								and to_date('29991231', 'YYYYMMDD')
			  and  CODV_CD = 'I'
			  and  OPRT_STTS_CD not in ('1', '3', '9')
			  and  CNCL_YMD is null
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPrvvAntbBaseInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="afiAntbAfltCot" column="AFI_ANTB_AFLT_COT"/>
		<result property="afiSutrAftrElpsDdcn" column="AFI_SUTR_AFTR_ELPS_DDCN"/>
		<result property="afiBaseOrlmDdcn" column="AFI_BASE_ORLM_DDCN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPrvvAntbBaseInfm () 
        Description :                                           예방적 항생제 기준 정보를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPrvvAntbBaseInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPrvvAntbBaseInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPrvvAntbBaseInfm-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPrvvAntbBaseInfm_예방적항생제기준정보조회2 조회 */
				   max(AFI_ANTB_AFLT_COT) as AFI_ANTB_AFLT_COT        /*  항생제계열개수 */
				,  max(AFI_SUTR_AFTR_ELPS_DDCN) as AFI_SUTR_AFTR_ELPS_DDCN  /*  봉합이후경과일수 */
				,  max(AFI_BASE_ORLM_DDCN) as AFI_BASE_ORLM_DDCN       /*  기준처방제한일수 */
			 from  (
				   select
						   count(MDCR_CTRL_CHRC_VL4) as AFI_ANTB_AFLT_COT
						,  null as AFI_SUTR_AFTR_ELPS_DDCN
						,  null as AFI_BASE_ORLM_DDCN
					 from  (
						   select
								   distinct b.MDCR_CTRL_CHRC_VL4 as MDCR_CTRL_CHRC_VL4
							 from
								   MDMEDORDT a      /*  약처방 */
								,  MZCTRLMMT b      /*  진료제어정보 */
								,  CCUSRDPHT c      /*  사용자진료조직관계이력 */
							where
								   a.MDRP_NO               = #{mdrpNo}
							  and  a.CODV_CD               = 'I'
							  and  nvl(a.DC_DVSN_CD, 'N')  = 'N'
							  and  nvl(a.RCST_CD, 'N')     <> 'R'
							  and  nvl(a.PHRM_RTRN_QTY, 0) <= 0
							  and  b.MDCR_CTRL_CD          = 'MM965'
							  and  b.MDCR_DTLS_CTRL_CD     = a.ORDR_CD
							  and  c.USER_ID               = a.ODDR_ID
							  and  'Y' = fn_cc_check_dprt_list(c.MDCR_DPRT_CD, 'DPRT_GS|DPRT_OS|DPRT_OBGY|DPRT_TS|DPRT_NS|DPRT_URO|'||
			                                                   'DPRT_OPH|DPRT_FM|DPRT_ER|DPRT_ENT|DPRT_NR|DPRT_REH')
						   )
					union  all
				   select
						   null
						,  nvl(round(sysdate - min(SUTR_FNSH_DT), 1), 0)
						,  null
					 from
						   MDOPSCHET        /*  수술스케줄 */
					where
						   PTNO = #{ptno}
					  and  OPRT_YMD between to_date(substr(#{mdcrDt}, 1, 8), 'YYYYMMDD')
										and to_date('29991231', 'YYYYMMDD')
					  and  CODV_CD = 'I'
					  and  OPRT_STTS_CD not in ('1', '3', '9')
					  and  CNCL_YMD is null
					  and  SUTR_FNSH_DT is not null
					union  all
				   select
						   null
						,  null
						,  to_number(nvl(INSR_CTRL_CHRC_VL2, '0'))
					 from
						   AICTRLMMT        /*  보험제어정보 */
					where
						   INSR_CTRL_CD = 'AI912'
					  and  INSR_DTLS_CTRL_CD = #{oprtKindCd}
				   )
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntInfcImdpCmtxInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
		<result property="sttsCd" column="STTS_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntInfcImdpCmtxInfm () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntInfcImdpCmtxInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntInfcImdpCmtxInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntInfcImdpCmtxInfm-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntInfcImdpCmtxInfm_감염내과 협진/회신이 있는지 체크 */
				   decode(sign(count(*)), 1, 'Y', 'N') as YN  /*  협진여부 */
				,  decode(sign(nvl(sum(decode(CMTX_STTS_CD, '4', 1, 0)), 0)), 1, 'Y', 'N') as STTS_CD /*  협진상태코드 */
			 from
				   MDCONSRCT a  /*  협진기록 */
			where
				   MDRP_NO = #{mdrpNo}
			  and  WNTD_DR_MCDP_CD = #{mcdpCd}
			  and  nvl(CMTX_STTS_CD, '0')  <> '9'
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRcrdWrtgCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRcrdWrtgCct () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRcrdWrtgCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRcrdWrtgCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRcrdWrtgCct-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntRcrdWrtgCct_서식작성건수 조회 */
				   count(*) as TOTL_CCT
			 from
				   MEDOCMBST a      /*  진료기록 */
				,  MEDOCMDTT b      /*  진료기록상세 */
				,  MEFITMOBT c      /*  아이템정보사용객체관리 */
			where
				   a.MDRP_NO           = #{mdrpNo}
			  and  a.RCKI_CD           = FN_CC_GET_CNST_VL('MED_002', 'S_ELPS_RCRD')
			  and  a.RCRD_SAVE_DVSN_CD = '1'
			  and  a.CHRT_OTAM_DVSN_CD = 'I'
			  and  b.RCRD_NO           = a.RCRD_NO
			  and  b.RCAM_NO           = a.RCAM_NO
			  and  c.OBJ_ID            = #{objId}
			  and  c.DTLS_SCOP_CD_VL   = #{dtlsScopCdVl}
			  and  b.FORM_NO        like substr(c.FORM_NO, 1, 7) || '%'
			  and  c.FORM_ITM_ID       = '0'           /*  아이템 없이 서식만 필요하기 때문에 0로 고정 */
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdrBlckReleYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="comnDtlsCd" column="COMN_DTLS_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdrBlckReleYn () 
        Description :                                           처방 블럭 해제 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdrBlckReleYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdrBlckReleYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdrBlckReleYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdrBlckReleYn_처방블록해제여부 조회 */
				   'T' as COMN_DTLS_CD
			 from
				   MRBLOCKMT    /*  처방블록해지등록 */
			where
				   PTNO = #{ptno}
			  and  sysdate between TRNT_STRT_DT and TRNT_FNSH_DT
			  and  nvl(RGST_CNCL_YN, 'Y') = 'Y'
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIjcnAntcDgfrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="pcunInlsQty" column="PCUN_INLS_QTY"/>
		<result property="icunCd" column="ICUN_CD"/>
		<result property="invnPcunCd" column="INVN_PCUN_CD"/>
		<result property="chldPcunIcqyVl" column="CHLD_PCUN_ICQY_VL"/>
		<result property="chldIcunCd" column="CHLD_ICUN_CD"/>
		<result property="acgrCd" column="ACGR_CD"/>
		<result property="phrmCtrlNmbrVl1" column="PHRM_CTRL_NMBR_VL_1"/>
		<result property="phrmCtrlNmbrVl2" column="PHRM_CTRL_NMBR_VL_2"/>
		<result property="phrmCtrlNmbrVl3" column="PHRM_CTRL_NMBR_VL_3"/>
		<result property="dvsnVl" column="DVSN_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIjcnAntcDgfrList (주사약 항암 제형 목록 조회) 
        Description :                                           주사약 항암 제형 목록을 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIjcnAntcDgfrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIjcnAntcDgfrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIjcnAntcDgfrList-result" useCache="true" flushCache="false">
		select  ORDR_CD
		     ,  ORDR_NM
		     ,  PCUN_INLS_QTY
		     ,  ICUN_CD
		     ,  INVN_PCUN_CD
		     ,  CHLD_PCUN_ICQY_VL 			/* 소아포장단위함량값  */
		     ,  CHLD_ICUN_CD				/* 소아함량단위코드 */
		     ,  ACGR_CD
		     ,  PHRM_CTRL_NMBR_VL_1
		     ,  PHRM_CTRL_NMBR_VL_2
		     ,  PHRM_CTRL_NMBR_VL_3
		     ,  DVSN_VL
		  from  (
		        SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listIjcnAntcDgfrList_주사약 항암 제형 조회 */
			    	    b.ORDR_CD as ORDR_CD            /*  처방코드 */
		       		 ,  b.ORDR_NM as ORDR_NM            /*  처방명 */
				     ,  b.PCUN_INLS_QTY as PCUN_INLS_QTY      /*  포장단위포함량 */
				     ,  b.ICUN_CD as ICUN_CD            /*  함량단위코드 */
				     ,  b.INVN_PCUN_CD as INVN_PCUN_CD  /*  재고포장단위코드 */
		             ,  b.CHLD_PCUN_ICQY_VL 			/* 소아포장단위함량값  */
		             ,  b.CHLD_ICUN_CD				    /* 소아함량단위코드 */
				     ,  b.ACGR_CD as ACGR_CD            /*  항암제그룹코드 */
				     ,  a.PHRM_CTRL_NMBR_VL1 as PHRM_CTRL_NMBR_VL_1 /* 최소량 */
				     ,  a.PHRM_CTRL_NMBR_VL2 as PHRM_CTRL_NMBR_VL_2 /* 최대량 */
		             ,  a.PHRM_CTRL_NMBR_VL3 as PHRM_CTRL_NMBR_VL_3 /* 환산기준값 */
		             ,  #{dvsnVl} as DVSN_VL
		             ,  #{ihohDvsnCd} as IHOH_DVSN_CD
		             ,  #{codvCd}     as CODV_CD
		    	  from
				        SDMCTRLMT a
				     ,  MDORDRCMT b /* 조회대상이 되는 처방 */
		             ,  SDDDGCDMT c /* 조회조건이 되는 약품코드 */
		     	 where  1=1
		           and  c.MDPR_CD = #{ordrCd}
		         <if test='codvCd == "I" and (ihohDvsnCd != null and ihohDvsnCd != "")'>
		           and  b.IHOH_DVSN_CD not in ('3', '5', '7') /* 원내병동 처방 불가능한 약 제외 */
		         </if>
		         <if test='(codvCd == "O" or codvCd == "E") and (ihohDvsnCd != null and ihohDvsnCd != "")'>
		           and  (( #{ihohDvsnCd} = 'O' and b.IHOH_DVSN_CD not in ('1', '4', '5') ) /* 원외 불가능약 제외 */
		                or
		                ( #{ihohDvsnCd} = 'I' and b.IHOH_DVSN_CD not in ('3', '4', '6')))  /* 원내외래 처방 불가능한 약 제외 */
		         </if>
		           and  c.ACGR_CD = a.PHRM_LWRN_CTRL_CD
		           and  c.MIX_RPRS_PDCT_CD = a.PHRM_CTRL_CHRC_VL2
		           and  a.PHRM_CTRL_CD      = 'SD107'
			       and  b.ORDR_CD           = a.PHRM_CTRL_CHRC_VL1
			       and  b.ORDR_PSBL_DVSN_CD = 'Y'
		         <if test='dvsnVl=="2"'>
		           and  a.PHRM_CTRL_CHRC_VL1 = #{ordrCd}
		         </if>
		       	 order
		      	    by  a.PHRM_LWRN_CTRL_CD
			     	 ,  a.PHRM_CTRL_NMBR_VL1
		        )
		 where  1=1
		 <if test='dvsnVl=="2"'>
		   and  rownum <![CDATA[ <= ]]> 1
		 </if>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdgAntcDgfrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="icunAdmnVlm" column="ICUN_ADMN_VLM"/>
		<result property="pcunInlsQty" column="PCUN_INLS_QTY"/>
		<result property="icunCd" column="ICUN_CD"/>
		<result property="invnPcunCd" column="INVN_PCUN_CD"/>
		<result property="acgrCd" column="ACGR_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdgAntcDgfrList (경구약 항암 제형 목록 조회) 
        Description :                                           경구약 항암 제형 목록을 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdgAntcDgfrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdgAntcDgfrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdgAntcDgfrList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listOrdgAntcDgfrList_경구약 항암 제형 조회 */
				  d.ORDR_CD as ORDR_CD           /*  처방코드 */
				, d.ORDR_NM as ORDR_NM           /*  처방명 */
				, d.PCUN_INLS_QTY * c.MDCR_CTRL_NMBR_VL1 as ICUN_ADMN_VLM     /*  함량단위투여용량 */
				, d.PCUN_INLS_QTY as PCUN_INLS_QTY     /*  포장단위포함량 */
				, d.ICUN_CD as ICUN_CD           /*  함량단위코드 */
				, d.INVN_PCUN_CD as INVN_PCUN_CD      /*  재고포장단위코드 */
				, d.ACGR_CD as ACGR_CD           /*  항암제그룹코드 */
			 from
				  SDMDISCRT a
				, MZCTRLMMT b
				, MZCTRLMMT c
				, MDORDRCMT d
			where
				  a.MDPR_CD            = #{ordrCd}
			  and b.MDCR_CTRL_CD       = 'MM016'
			  and b.MDCR_LWRN_CTRL_CD  = a.RPMD_ID
			  and case when (b.MDCR_LWRN_CTRL_CD  = 'CAP000000' and to_number(#{acdgAdmnVlmVl}) in (1700, 2200, 2400, 2600)) then 'FALSE' else 'TRUE'
				  end                  = 'TRUE'
			  and to_number(#{acdgAdmnVlmVl})
									   between b.MDCR_CTRL_NMBR_VL1 and b.MDCR_CTRL_NMBR_VL2
			  and c.MDCR_CTRL_CD       = 'MM017'
			  and c.MDCR_LWRN_CTRL_CD  = b.MDCR_DTLS_CTRL_CD
			  and c.MDCR_CTRL_NMBR_VL1 > 0
			  and d.ORDR_CD            = c.MDCR_CTRL_CHRC_VL1
			  and d.ORDR_PSBL_DVSN_CD  = 'Y'
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneScinSpsdId-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
		<result property="spsdId" column="SPSD_ID"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneScinSpsdId (상병 특정기호ID 조회) 
        Description :                                           상병 특정기호ID를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneScinSpsdId-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneScinSpsdId"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneScinSpsdId-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneScinSpsdId_상병V코드 조회 */
				   'Y' as YN       /*  조회성공여부 */
				,  SPSD_ID as SPSD_ID             /*  특정기호ID */
			 from
				   AIIMASABT        /*  산정특례적용기준코드 */
			where
				   lpad(ASCS_APLY_BASE_CD, 4, '0') <= '7000'   /*  7000이하 = MM506 */
			  and  ASCS_SCIN_CLSF_CD = #{ascsScinClsfCd}
			  and  trunc(sysdate) between nvl(APST_YMD, to_date('19950101', 'YYYYMMDD'))
									  and nvl(APFN_YMD, to_date('29991231', 'YYYYMMDD'))
			  and  STRT_SCIN_CD <= #{scinCd}
			  and  FNSH_SCIN_CD >  #{scinCd}
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntErrmChotDt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="chotDt" column="CHOT_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntErrmChotDt (환자 응급실 퇴실 일시 조회) 
        Description :                                           환자 응급실 퇴실 일시를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntErrmChotDt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntErrmChotDt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntErrmChotDt-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntErrmChotDt_응급실퇴실일시 조회 */
				   to_char(CHOT_DT, 'YYYYMMDDHH24MISS') as CHOT_DT
			 from
				   MNEERRPAT        /*  응급환자정보조사 */
			where
				   MDRP_NO = #{mdrpNo}
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrBltnTypeCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="insrBttyCd" column="INSR_BTTY_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrBltnTypeCd (보험 고시 유형 코드 조회) 
        Description :                                           보험 고시 유형 코드를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrBltnTypeCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrBltnTypeCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrBltnTypeCd-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrBltnTypeCd_보험고시유형코드 조회 */
				   substr ( FN_AI_GET_INSR_BTTY_CD
				   (
				   #{istyCd}
				,  #{istyAsstCd}
				,  #{mdfeCd}
				,  to_date(#{ordrYmd}, 'YYYYMMDD')
				   ) , 0 , 1 ) as INSR_BTTY_CD
			 from  DUAL
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntOrdrMdcrApntYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="apntYmd" column="APNT_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntOrdrMdcrApntYn (환자 처방 진료 예약 여부 조회) 
        Description :                                           환자 처방 진료 예약 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntOrdrMdcrApntYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntOrdrMdcrApntYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntOrdrMdcrApntYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePtntOrdrMdcrApntYn_진료과 예약 조회 */
				   PTNO as PTNO
				,  to_char(APNT_YMD, 'YYYYMMDD') as APNT_YMD            /*  예약일자       */
			 from  MDAPNTMET  /*  진료과예약 */
			where  PTNO = #{ptno}
			  and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
			  and  ORDR_SNO = #{ordrSno}
			  and  rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpznCntrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="mccnCd" column="MCCN_CD"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpznCntrList (특성화 센터 목록 조회) 
        Description :                                           특성화 센터 목록을 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpznCntrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpznCntrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpznCntrList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSpznCntrList_특성화센터목록조회 조회 */
				   a.MCCN_CD as MCCN_CD
				,  b.KORN_DPRT_NM as MCCN_NM
				,  null as YN
			 from
				   APDSDRCNT a      /*  의사진료센터 */
				,  HZDEPTMMT b      /*  조직Master I/F(MDM연계) */
			where
				   a.MDDR_ID = #{oddrId}
			  and  a.MAIN_CNTR_YN is not null
			  and  a.MCCN_CD <> fn_cc_get_dprt_cd('DPRT_M')     /*  본원 M 은 제외 */
			  and  trunc(sysdate) between a.APST_YMD and a.APFN_YMD
			  and  b.DPRT_CD = a.MCCN_CD
			]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-deletePtntThdyTmprOrdrInfm (환자 당일 임시 처방 정보 삭제) 
        Description :                                           환자 당일 임시 처방 정보를 삭제한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<delete id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-deletePtntThdyTmprOrdrInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
		   DELETE  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-deletePtntThdyTmprOrdrInfm */   /*+ mdd_tmpcmtt_d02$D01_퇴원처방체크임시자료 삭제DAM */
			 from  MDTMPCMTT
			where
				   PTNO     = #{ptno}
			  and  RGST_YMD = trunc(sysdate)
			  and  MCDP_CD  = 'ZZZZZZ'
			  and  CODV_CD  = 'Z'
			]]>
	</delete>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertPtntThdyTmprOrdrInfm (환자 당일 임시 처방 정보 저장) 
        Description :                                           환자 당일 임시 처방 정보를 저장한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertPtntThdyTmprOrdrInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		<![CDATA[
			   INSERT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertPtntThdyTmprOrdrInfm */   /*+ mdd_tmpcmtt_i03$I01_퇴원처방확인 다건등록DAM */
				 into  MDTMPCMTT
					(
					   PTNO
					,  RGST_YMD
					,  SQNC
					,  MCDP_CD
					,  CODV_CD
					,  ORDR_CD
					   /*  AUDIT */
					,  FRST_RGSR_ID
					,  FRST_RGST_IP
					,  FRST_RGST_DT
					,  FRST_RGST_CLNT_PRGM_ID
					,  FRST_RGST_SRVR_PRGM_ID
					,  LAST_UPDR_ID
					,  LAST_UPDT_IP
					,  LAST_UPDT_DT
					,  LAST_UPDT_CLNT_PRGM_ID
					,  LAST_UPDT_SRVR_PRGM_ID
					)
			   values
					(
					   #{ptno}                    /*  환자번호 */
					,  trunc(sysdate)
					,  (
					   select  nvl(max(SQNC), 0) + 1
						 from  MDTMPCMTT
						where  PTNO = #{ptno}
						  and  RGST_YMD = trunc(sysdate)
					   )       /*  일련번호 */
					,  'ZZZZZZ'            /*  NOT NULL 컬럼 */
					,  'Z'                 /*  NOT NULL 컬럼 */
					,  #{ordrCd}                 /*  처방코드 */
					   /*  AUDIT */
					,  #{gvUserId}
					,  #{gvUserIp}
					,  sysdate
					,  #{gvClntPrgmId}
					,  #{gvSrvrPrgmId}
					,  #{gvUserId}
					,  #{gvUserIp}
					,  sysdate
					,  #{gvClntPrgmId}
					,  #{gvSrvrPrgmId}
					)
			]]>
	</insert>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTmprOrdrTrgtOrdrEn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTmprOrdrTrgtOrdrEn (환자 당일 임시 처방 대상 처방 유무 조회) 
        Description :                                           환자 당일 임시 처방 대상 처방 유무를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTmprOrdrTrgtOrdrEn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTmprOrdrTrgtOrdrEn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTmprOrdrTrgtOrdrEn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTmprOrdrTrgtOrdrEn */   /*+ mdd_tmpcmtt_s02$S01_임시처방중대상처방존재여부 단건조회DAM */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from
				   MDTMPCMTT a          /*  임시처방테이블 */
				,  MZCTRLMMT b          /*  처방제어코드 - 대상약처방목록 */
			where
				   a.PTNO              = #{ptno}
			  and  a.RGST_YMD          = trunc(sysdate)
			  and  a.MCDP_CD           = 'ZZZZZZ'
			  and  a.CODV_CD           = 'Z'
			  and  b.MDCR_CTRL_CD      = #{mdcrCtrlCd}
			  and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
			  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblAmiTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblAmiTrgtYn (베타차단제 AMI 대상 여부 조회) 
        Description :                                           베타차단제 AMI 대상 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblAmiTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblAmiTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblAmiTrgtYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblAmiTrgtYn */   /*+ mdd_crinwkt_s01$S01_베타차단제_AMI대상여부 단건조회DAM */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from
				   APRCRPTNT a      /*  진료접수 */
				,  APRCRLTNT b      /*  진료접수관계 */
				,  MDCRINWKT c      /*  뇌졸중관리 */
			where
				   a.PTNO    = #{ptno}
			  and  a.MDRP_NO = #{mdrpNo}
			  and  a.CNCL_DT is null
			  and  a.CODV_CD = 'I'
			  and  b.MDRP_NO = a.MDRP_NO
			  and  b.MDRP_RLTN_DVSN_CD = '01'      /*  01 : 입원 <- 응급 */
			  and  c.MDRP_NO = b.MDRP_RLTN_MDRP_NO
			  and  c.CODV_CD = 'E'
			  and  c.CRIN_MNGM_DVSN_CD in ('CHEST', 'AMI')
			  and  (nvl(c.CRIN_DVSN_CD, 'X') <> '3')
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAtdgStrokeTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAtdgStrokeTrgtYn (베타차단제 STROKE 대상 여부 조회) 
        Description :                                           베타차단제 STROKE 대상 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAtdgStrokeTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAtdgStrokeTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAtdgStrokeTrgtYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAtdgStrokeTrgtYn */   /*+ mdd_crinwkt_s02$S01_항혈전제_STROKE대상여부 단건조회DAM */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from
				   APRCRPTNT a      /*  진료접수 */
				,  APRCRLTNT b      /*  진료접수관계 */
				,  MDCRINWKT c      /*  뇌졸중관리 */
			where
				   a.MDRP_NO = #{mdrpNo}
			  and  a.CNCL_DT is null
			  and  a.CODV_CD = 'I'
			  and  b.MDRP_NO = a.MDRP_NO
			  and  b.MDRP_RLTN_DVSN_CD = '01'      /*  01 : 입원 <- 응급 */
			  and  c.MDRP_NO = b.MDRP_RLTN_MDRP_NO     /*  응급진료접수번호 */
			  and  c.CRIN_MNGM_DVSN_CD = 'STROKE'
			  and  c.CRIN_DVSN_CD = '2'
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblOrdrYn (베타차단제 처방 여부 조회) 
        Description :                                           베타차단제 처방 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblOrdrYn */   /*+ mdd_medordt_s17$S01_베타차단제처방여부조회 단건조회DAM */
				   decode(count(*), 0, 'N', 'Y') as YN
			 from
				   MDMEDORDT a      /*  약처방 */
				,  MZCTRLMMT b      /*  처방제어코드 */
			where
				   a.PTNO    = #{ptno}
			  and  a.MDRP_NO = #{mdrpNo}
			  and  a.CODV_CD = 'I'
			  and  a.ODKI_CD = 'D'
			  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')  /*  20100525YKC */
			  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			  and  b.MDCR_CTRL_CD = #{mdcrCtrlCd}
			  and  b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblNnorResn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblNnorResn (베타차단제 미처방 사유 존재여부 조회) 
        Description :                                           베타차단제 미처방 사유 존재여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblNnorResn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblNnorResn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblNnorResn-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBeblNnorResn */   /*+ mdd_medocmb_s12$S01_베타차단제미처방사유 단건조회DAM */
				   decode(count(*), 0, 'N', 'Y') as YN /*  존재여부 Y: 있음, N: 없음 */
			 from
				   MEDOCMBST a  /*  진료기록 */
				,  MEDOCMDTT b  /*  진료기록상세 */
				,  MEFITMOBT c  /*  아이템정보사용객체관리 */
			where
				   a.MDRP_NO = #{mdrpNo}
			  and  a.RCKI_CD = FN_CC_GET_CNST_VL('MED_002', 'S_ELPS_RCRD')
			  and  a.RCRD_DT between to_date(#{ordrYmd}, 'YYYYMMDD')
								 and to_date(#{ordrYmd}, 'YYYYMMDD') + 0.9999
			  and  a.RCRD_SAVE_DVSN_CD = '1'
			  and  a.CHRT_OTAM_DVSN_CD = 'I'
			  and  b.RCRD_NO = a.RCRD_NO
			  and  b.RCAM_NO = a.RCAM_NO
			  and  c.OBJ_ID = 'TSMCMOrder'
			  and  c.DTLS_SCOP_CD_VL = #{dtlsScopCdVl}
			  and  b.FORM_NO like substr(c.FORM_NO, 1, 7) || '%'
			  and  c.FORM_ITM_ID = '0'     /*  0 : FORM자체를 의미한다. */
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntNstmCmtxHx-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="nstmAccsPathCd" column="NSTM_ACCS_PATH_CD"/>
		<result property="nstmAccsPathNm" column="NSTM_ACCS_PATH_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntNstmCmtxHx (NST 환자 협진 이력 조회) 
        Description :                                           환자 협진 이력을 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntNstmCmtxHx-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntNstmCmtxHx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntNstmCmtxHx-result" useCache="true" flushCache="false">
		/*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntNstmCmtxHx */
		select  /* NST환자이력조회 */
		        a.NSTM_ACCS_PATH_CD                         as NSTM_ACCS_PATH_CD        /* NST접근경로코드 */
		     ,  (   select  DETL_CD_NM
		              from  CCCMCDDMT
		             where  COMN_GRP_CD     =   'MM601'
		               and  COMN_DTLS_CD    =   a.NSTM_ACCS_PATH_CD
		        )                                           as NSTM_ACCS_PATH_NM        /* NST접근경로명 */
		  from  MDNSTPABT a     /* NST환자정보 */
		     ,  SDONSTRET c     /* NST회신관리 */
		 where  a.PTNO              =   #{ptno}
		   and  a.MDRP_NO           =   #{mdrpNo}
		   and  c.PTNO          (+) =   a.PTNO
		   and  c.CNSN_REFR_YMD (+) =   a.REFR_YMD
		   and  c.REFR_SNO (+)      =   a.REFR_SNO
		 order
		    by  a.REFR_YMD desc
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrugExmnUicmTaboList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="tablNm" column="TABL_NM"/>
		<result property="newOrdrCd" column="NEW_ORDR_CD"/>
		<result property="newOrdrNm" column="NEW_ORDR_NM"/>
		<result property="befrOrdrCd" column="BEFR_ORDR_CD"/>
		<result property="befrOrdrNm" column="BEFR_ORDR_NM"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="rwidVl" column="RWID_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrugExmnUicmTaboList (약 검사 병용 금기 목록) 
        Description :                                           약 검사 병용 금기 목록 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrugExmnUicmTaboList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrugExmnUicmTaboList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrugExmnUicmTaboList-result" useCache="true" flushCache="false">
		<![CDATA[
		   select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDrugExmnUicmTaboList */
				   a1.FG as ORDR_CLTY_CD
				,  a1.TB as TABL_NM
				,  a1.CD1 as NEW_ORDR_CD
				,  b1.ORDR_NM as NEW_ORDR_NM
				,  a1.CD2 as BEFR_ORDR_CD
				,  c1.ORDR_NM as BEFR_ORDR_NM
				,  d1.ABRV_DPRT_CD as MCDP_CD
				,  a1.GRID_ROW_NO as RWID_VL
			 from  (
				   select  a.FG
						,  b.TB
						,  a.ORDR_CD as CD1
						,  b.ORDR_CD as CD2
						,  b.MCDP_CD
						,  a.GRID_ROW_NO
					 from  (
						   /*  현재처방 넣어둔곳. */
						   select  'D' FG
								,  ORDR_CD
								,  'MDDURDUPT' as TB
								,  a.MCDP_CD
								,  a.GRID_ROW_NO
							 from  MDDURDUPT a
								,  AIMFMDFET b      /*  수가마스터 */
							where  a.PTNO     = #{ptno}
							  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
							  and  a.THDY_BEFR_DVSN_CD = 'A'
							  and  a.ORDR_CLTY_CD = 'D'
							  and  substr(a.ORDR_CD, 1, 4) = 'METF'
							  and  b.MDFE_CD = a.ORDR_CD
							  and  b.MDPR_UICM_TABO_CD = '1'
							  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
							union  all
						   select  'E' FG
								,  ORDR_CD
								,  'MDDURDUPT' as TB
								,  a.MCDP_CD
								,  a.GRID_ROW_NO
							 from  MDDURDUPT a
								,  AIMFMDFET b      /*  수가마스터 */
							where  a.PTNO     = #{ptno}
							  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
							  and  a.THDY_BEFR_DVSN_CD = 'A'
							  and  a.ORDR_CLTY_CD = 'E'
							  and  b.MDFE_CD = a.ORDR_CD
							  and  b.MDPR_UICM_TABO_CD = '1'
							  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
						   ) a
						,  (
						   /*  이전 검사처방 */
						   select  'D' FG
								,  ORDR_CD
								,  'MDEXMORDT' as TB
								,  a.MCDP_CD
							 from  MDEXMORDT a      /*  검사처방 */
								,  AIMFMDFET b      /*  수가마스터 */
							where  a.PTNO     = #{ptno}
							  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
							  and  nvl(a.DC_DVSN_CD, 'N') not in ('X', 'Y')
							  and  b.MDFE_CD = a.ORDR_CD
							  and  b.MDPR_UICM_TABO_CD = '1'
							  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
							union  all
						   /*  이전 2차 오더 */
						   select  'D' FG
								,  a.MTER_CD as ORDR_CD
								,  'SWSNDMAMT' as TB
								,  a.MCDP_CD
							 from  SWSNDMAMT a      /*  2차재료처치처방 */
								,  AIMFMDFET b      /*  수가마스터 */
							where  PTNO = #{ptno}
							  and  ENFR_DT between to_date(#{ordrYmd}, 'YYYYMMDD')
											   and to_date(#{ordrYmd}, 'YYYYMMDD') + .99999
							  and  b.MDFE_CD = a.MTER_CD
							  and  b.MDPR_UICM_TABO_CD = '1'
							  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
						   /*  이전 약처방 */
							union  all
						   select  'E' FG
								,  a.ORDR_CD
								,  'MDMEDORDT' as TB
								,  a.MCDP_CD
							 from  MDMEDORDT a      /*  약처방 */
								,  AIMFMDFET b      /*  수가마스터 */
							where  a.PTNO = #{ptno}
							  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
							  and  nvl(a.DC_DVSN_CD, 'N') not in ('X', 'Y')
							  and  substr(a.ORDR_CD, 1, 4) = 'METF'
							  and  b.MDFE_CD = a.ORDR_CD
							  and  b.MDPR_UICM_TABO_CD = '1'
							  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
						   ) b
					where  b.FG = a.FG
					union
				   /*  현재 처방중 병용금기 체크 */
				   select  a.FG
						,  'MDDURDUPT'
						,  a.ORDR_CD CD1
						,  b.ORDR_CD CD2
						,  a.MCDP_CD
						,  a.GRID_ROW_NO
					 from  (
						   /*  현재 처방중 약기준 */
						   select  'D' as FG
								,  a.ORDR_CD
								,  'MDDURDUPT' TB
								,  a.MCDP_CD
								,  a.GRID_ROW_NO
							 from  MDDURDUPT a
								,  AIMFMDFET b
							where  a.PTNO = #{ptno}
							  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
							  and  a.THDY_BEFR_DVSN_CD = 'A'
							  and  a.ORDR_CLTY_CD = 'D'
							  and  substr(a.ORDR_CD, 1, 4) = 'METF'
							  and  b.MDFE_CD = a.ORDR_CD
							  and  b.MDPR_UICM_TABO_CD = '1'
							  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
						   ) a
						,  (
						   /*  현재 처방중 검사기준 */
						   select  'D' as FG
								,  ORDR_CD
								,  'MDDURDUPT' as TB
							 from  MDDURDUPT a
								,  AIMFMDFET b
							where  a.PTNO = #{ptno}
							  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
							  and  a.THDY_BEFR_DVSN_CD = 'A'
							  and  a.ORDR_CLTY_CD = 'E'
							  and  b.MDFE_CD = a.ORDR_CD
							  and  b.MDPR_UICM_TABO_CD = '1'
							  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
						   ) b
					union
				   select  a.FG
						,  a.TB
						,  a.ORDR_CD CD1
						,  b.ORDR_CD CD2
						,  a.MCDP_CD
						,  a.GRID_ROW_NO
					 from  (
						   /*  현재 처방중 검사기준 */
						   select  'E' as FG
								,  ORDR_CD
								,  'MDDURDUPT' as TB
								,  a.MCDP_CD
								,  a.GRID_ROW_NO
							 from  MDDURDUPT a
								,  AIMFMDFET b
							where  a.PTNO = #{ptno}
							  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
							  and  a.THDY_BEFR_DVSN_CD = 'A'
							  and  a.ORDR_CLTY_CD = 'E'
							  and  b.MDFE_CD = a.ORDR_CD
							  and  b.MDPR_UICM_TABO_CD = '1'
							  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
						  ) a,
						  (
						   select  'E' as FG
								,  ORDR_CD
								,  'MDDURDUPT' as TB
							 from  MDDURDUPT a
								,  AIMFMDFET b
							where  a.PTNO = #{ptno}
							  and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
							  and  a.THDY_BEFR_DVSN_CD = 'A'
							  and  a.ORDR_CLTY_CD = 'D'
							  and  substr(a.ORDR_CD, 1, 4) = 'METF'
							  and  b.MDFE_CD = a.ORDR_CD
							  and  b.MDPR_UICM_TABO_CD = '1'
							  and  trunc(sysdate) between b.APST_YMD and b.APFN_YMD
						   ) b
				   ) a1
				,  MDORDRCMT b1     /*  처방코드기본 */
				,  MDORDRCMT c1     /*  처방코드기본 */
				,  HZDEPTMMT d1     /*  부서 */
			where
				   b1.ORDR_CD = a1.CD1
			  and  c1.ORDR_CD = a1.CD2
			  and  d1.DPRT_CD = a1.MCDP_CD
		]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertDrugExmnUicmTaboOrdrTmpr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertDrugExmnUicmTaboOrdrTmpr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  >
		insert  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-insertDrugExmnUicmTaboOrdrTmpr */
		 into  MDDURDUPT
			(
			   THDY_BEFR_DVSN_CD
			,  PTNO
			,  RGST_DT
			,  CMRS_SNO
			,  ORDR_YMD
			,  MCDP_CD
			,  ORDR_CD
			,  ORDR_CLTY_CD
			,  GRID_ROW_NO
		    ,  FRST_RGSR_ID
		    ,  FRST_RGST_IP
		    ,  FRST_RGST_DT
		    ,  FRST_RGST_CLNT_PRGM_ID
		    ,  FRST_RGST_SRVR_PRGM_ID
		    ,  LAST_UPDR_ID
		    ,  LAST_UPDT_IP
		    ,  LAST_UPDT_DT
		    ,  LAST_UPDT_CLNT_PRGM_ID
		    ,  LAST_UPDT_SRVR_PRGM_ID
			)
		values
			(
			   'A'
			,  #{ptno}
			,  to_date(#{ordrYmd}, 'YYYYMMDD')
			,  (
			   select  nvl(max(CMRS_SNO), 0) + 1
				 from  MDDURDUPT
				where  THDY_BEFR_DVSN_CD = 'A'
				  and  PTNO    = #{ptno}
				  and  RGST_DT = to_date(#{ordrYmd}, 'YYYYMMDD')
			   )
			,  to_date(#{ordrYmd}, 'YYYYMMDD')
			,  #{mcdpCd}
			,  #{ordrCd}
			,  #{ordrCltyCd}
			,  #{rwidVl}
		    ,  #{gvUserId}
		    ,  #{gvUserIp}
		    ,  sysdate
		    ,  #{gvClntPrgmId}
		    ,  #{gvSrvrPrgmId}
		    ,  #{gvUserId}
		    ,  #{gvUserIp}
		    ,  sysdate
		    ,  #{gvClntPrgmId}
		    ,  #{gvSrvrPrgmId}
			)
	</insert>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOthsMtfrAdmnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="drugTkngYn" column="DRUG_TKNG_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOthsMtfrAdmnYn (원외 메포민 투여 여부를 조회한다.) 
        Description :                                           원외 메포민 투여 여부를 조회한다. ASIS: mdd_drgcnpt_l03
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOthsMtfrAdmnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOthsMtfrAdmnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOthsMtfrAdmnYn-result" useCache="true" flushCache="false">
		<![CDATA[
				select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOthsMtfrAdmnYn */
				           DRUG_TKNG_YN as DRUG_TKNG_YN   /*  약 복용 여부 */
				  from
				           MDDRGCNPT        /*  약복용관심환자 */
				where
				           PTNO = #{ptno}
				   and  DRUG_TKNG_DLMT_CD  = nvl(#{drugTkngDlmtCd}, '1')
				   and  APFN_DT is null
				   and  DLTN_DT is null
				   and  rownum < 2
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="btdt" column="BTDT"/>
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprTrgtYn (고혈압평가대상자여부 조회) 
        Description :                                           고혈압평가대상자여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprTrgtYn-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprTrgtYn */
		        to_char(BTDT, 'YYYYMMDD') as BTDT
		     ,  (
		        select  'Y'
		          from  MDPADIAGT
		         where  MDRP_NO = #{mdrpNo}
		           and  substr(SCIN_CD, 1, 3) in ('I10', 'I11', 'I12', '13')
		           and  rownum = 1
		        ) as YN
		  from  APRCRPTNT a
		     ,  APPTPTNTT b
		 where  a.MDRP_NO = #{mdrpNo}
		   and  a.PTNO = b.PTNO
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr1-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="mdfeCd" column="MDFE_CD"/>
		<result property="insrEdiCd" column="INSR_EDI_CD"/>
		<result property="insrCtrlChrcVl2" column="INSR_CTRL_CHRC_VL2"/>
		<result property="hiraMainIngrCd" column="HIRA_MAIN_INGR_CD"/>
		<result property="yn" column="YN"/>
		<result property="ingrNm" column="INGR_NM"/>
		<result property="dvsnNm" column="DVSN_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr1 (고혈압약처방정보1) 
        Description :                                           고혈압약처방정보1
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr1-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr1"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr1-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr1 */
		        a.MDFE_CD
		     ,  a.INSR_EDI_CD
		     ,  b.INSR_CTRL_CHRC_VL2
		     ,  substr(c.HIRA_MAIN_INGR_CD, 1, 4) as HIRA_MAIN_INGR_CD
		     ,  b.INSR_CTRL_CHRC_VL3 as YN
		     ,  substr(c.INGR_NM, 1, 6) as INGR_NM
		     ,  b.INSR_CTRL_CHRC_VL2 || substr(c.HIRA_MAIN_INGR_CD, 1, 4) as DVSN_NM
		  from
		        AIMFMDFET a
		     ,  AICTRLMMT b
		     ,  SDDDGCDMT c
		 where
		        a.MDFE_CD = #{ordrCd}
		   and  to_date(#{ordrYmd}, 'yyyymmdd') between a.APST_YMD
		                                            and a.APFN_YMD +.99999
		   and  b.INSR_CTRL_CD       = 'AI224'
		   and  b.INSR_CTRL_CHRC_VL1 = a.INSR_EDI_CD
		   and  to_date(#{ordrYmd}, 'yyyymmdd') between nvl(b.APST_YMD, to_date('18000101', 'yyyymmdd'))
		                                            and nvl(b.APFN_YMD, to_date('29991231', 'yyyymmdd'))
		   and  c.MDPR_CD = a.MDFE_CD
		   and  c.ORDR_PSBL_DVSN_CD <> 'H'
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr2-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="insrEdiCd" column="INSR_EDI_CD"/>
		<result property="insrCtrlChrcVl2" column="INSR_CTRL_CHRC_VL2"/>
		<result property="yn" column="YN"/>
		<result property="insrCtrlChrcVl3" column="INSR_CTRL_CHRC_VL3"/>
		<result property="ingrNm" column="INGR_NM"/>
		<result property="dvsnNm" column="DVSN_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr2 (고혈압약처방2) 
        Description :                                           전처방 목록중 고혈압 처방을 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr2-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr2"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr2-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprDrugOrdr2 */
		        a.ORDR_CD
		     ,  b.INSR_EDI_CD
		     ,  c.INSR_CTRL_CHRC_VL2
		     ,  substr(d.HIRA_MAIN_INGR_CD, 1, 4) as YN
		     ,  c.INSR_CTRL_CHRC_VL3
		     ,  substr(d.INGR_NM, 1, 6) as INGR_NM
		     ,  c.INSR_CTRL_CHRC_VL2 || substr(d.HIRA_MAIN_INGR_CD, 1, 4) as DVSN_NM
		  from
		        MDMEDORDT a
		     ,  AIMFMDFET b
		     ,  AICTRLMMT c
		     ,  SDDDGCDMT d
		 where
		        a.MDRP_NO  = #{mdrpNo}
		   and  a.ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		   and  nvl(a.RCST_CD   , 'N') not in ('R', 'Y')
		   and  a.IHOH_DVSN_CD           = 'O'
		   and  nvl(a.ORFR_CD   , 'N')  != 'P'
		   and  nvl(a.DC_DVSN_CD, 'N')   = 'N'
		   and  nvl(a.PHRM_RTRN_QTY, 0) <= 0
		   and  b.MDFE_CD  = a.ORDR_CD
		   and  a.ORDR_YMD between b.APST_YMD
		                       and b.APFN_YMD
		   and  c.INSR_CTRL_CD       = 'AI224'
		   and  c.INSR_CTRL_CHRC_VL1 = b.INSR_EDI_CD
		   and  to_date(#{ordrYmd}, 'yyyymmdd') between nvl(c.APST_YMD, to_date('18000101', 'yyyymmdd'))
		                                            and nvl(c.APFN_YMD, to_date('29991231', 'yyyymmdd'))
		   and  d.MDPR_CD = b.MDFE_CD
		   and  d.ORDR_PSBL_DVSN_CD <> 'H'
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprExcpScin-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprExcpScin (고혈압예외상병) 
        Description :                                           고혈압예외상병
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprExcpScin-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprExcpScin"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprExcpScin-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHyprExcpScin */
		        'Y' as YN
		  from
		        AICTRLMMT a
		     ,  (
		        select
		                PTNT_CLNC_DX_SNO
		             ,  PTNT_SCIN_SNO
		             ,  SCIN_CD
		          from  (
		                select
		                        a.PTNT_CLNC_DX_SNO PTNT_CLNC_DX_SNO
		                     ,  a.PTNT_SCIN_SNO    PTNT_SCIN_SNO
		                     ,  a.SCIN_CD          SCIN_CD
		                  from
		                        MDPADIAGT a
		                 where  a.MDRP_NO       = #{mdrpNo}
		                   and  a.MAIN_SCIN_YN  = 'N'
		                 order
		                   by  a.PTNT_CLNC_DX_SNO, a.PTNT_SCIN_SNO
		                )
		         where  rownum = 1
		        ) b
		 where
		        a.INSR_CTRL_CD       = 'AI225'
		   and  a.INSR_CTRL_CHRC_VL1 = b.SCIN_CD
		   and  to_date(#{ordrYmd}, 'yyyymmdd') between nvl(a.APST_YMD, to_date('18000101', 'yyyymmdd'))
		                                            and nvl(a.APFN_YMD, to_date('29991231', 'yyyymmdd'))
		   and  rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprNotEncrThrp-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="insrDtlsCtrlCd" column="INSR_DTLS_CTRL_CD"/>
		<result property="insrDtlsCtrlNm" column="INSR_DTLS_CTRL_NM"/>
		<result property="insrCtrlChrcVl1" column="INSR_CTRL_CHRC_VL1"/>
		<result property="insrCtrlChrcVl2" column="INSR_CTRL_CHRC_VL2"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprNotEncrThrp (고혈압성분 비권장요법 조회) 
        Description :                                           고혈압성분 비권장요법 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprNotEncrThrp-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprNotEncrThrp"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprNotEncrThrp-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listHyprNotEncrThrp */
		        INSR_DTLS_CTRL_CD
		     ,  INSR_DTLS_CTRL_NM
		     ,  INSR_CTRL_CHRC_VL1
		     ,  INSR_CTRL_CHRC_VL2
		  from
		        AICTRLMMT
		 where
		        INSR_CTRL_CD = 'AI226'
		   and  to_date(#{ordrYmd}, 'yyyymmdd') between nvl(APST_YMD, to_date('18000101', 'yyyymmdd'))
		                                            and nvl(APFN_YMD, to_date('29991231', 'yyyymmdd'))
		 order
		    by  INSR_DTLS_CTRL_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstmCndt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="rsltVl" column="RSLT_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstmCndt (NST조건 조회) 
        Description :                                           NST 협진의뢰 권고를 위한 조건 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstmCndt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstmCndt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstmCndt-result" useCache="true" flushCache="false">
		<![CDATA[
			/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstmCndt */
			select  case
			            when #{pathNm} = 'EN'
			                and exists (    select  1
			                                  from  MDBASORDT
			                                 where  PTNO            =   #{ptno}
			                                   and  MDRP_NO         =   #{mdrpNo}
			                                   and  DC_DVSN_CD      =   'N'
			                                   and  TMPR_ORDR_YN    =   'N'
			                                   and  SLIP_CD         =   FN_CC_GET_CNST_VL('MDP_005', 'SLIP_CD_DT_01')      ) then 'Y'
			            when #{pathNm} = 'TPN'
			                and exists (    select  1
			                                  from  MDMEDORDT a
			                                       ,   SDMCTRLMT b
					                                 where  PTNO            =   #{ptno}
					                                   and  MDRP_NO         =   #{mdrpNo}
					                                   and  DC_DVSN_CD      =   'N'
					                                   and  TMPR_ORDR_YN    =   'N'
					                                   and  b.PHRM_CTRL_CD ='SDH_032'
					                                   and  a.ORDR_CD = b.PHRM_DTLS_CTRL_CD   ) then 'Y'
			            when #{pathNm} = 'ICU'
			                and exists (    select  1
			                                  from  APRCRPTNT a
			                                     ,  MNWICUPAT b     -- 중환자실환자
			                                     ,  MDORDDATV c
			                                 where  a.MDRP_NO   =   #{mdrpNo}
			                                   and  a.WARD_CD in    (   select  PTNT_DTLS_CTRL_CD
			                                                              from  APCTRLMMT
			                                                             where  PTNT_CTRL_CD    =   'APZ_007'       -- 중환자실
			                                                               and  trunc(sysdate) between APST_YMD and APFN_YMD
			                                                        )
			                                   and  b.MDRP_NO   =   a.MDRP_NO
			                                   and  b.WARD_CD   =   a.WARD_CD
			                                   and  b.DLTN_YN   =   'N'
			                                   and  b.CHOT_DT is null
			                                   and  c.PTNO      =   #{ptno}         -- 속도이슈로 상수조건으로 변경
			                                   --and  c.PTNO      =   b.PTNO
			                                   and  c.ORDR_YMD between trunc(b.ENRM_DT) and trunc(b.ENRM_DT) + 2    -- 3일 이내 처방만 보면 될듯
			                                   and  c.ORDR_CRTN_DVSN_CD != '47'                                     -- 간호 처치/재료 입력건 제외
			                                   and  c.WARD_CD   =   b.WARD_CD       ) then 'Y'
			            when #{pathNm} = 'NICU'
			                        and (nvl(
			                                  (
			                                     SELECT
			                                            case when (instr(
			                                                            (select x.ward_cd||'|'||care_ward_cd||'|' from APRCRPTNT x where x.MDRP_NO = a.MDRP_NO and rownum = 1)
			                                                            ,FN_CC_GET_CNST_VL('CCD_001', 'WARD_ICU_NWBR')
			                                                            ) > 0
			                                                      ) and
			                                                      (r.DR_RPLY_DT is not null) and
			                                                      (trunc(sysdate) - trunc(r.DR_RPLY_DT) = 8) and
										                  (instr( (select x.DETL_CD_NM
										                             from CCCMCDDMT x
										                            where x.COMN_GRP_CD      =   'MM601'
										                              and x.COMN_DTLS_CD     =   a.NSTM_ACCS_PATH_CD)
										                          ,'EN'
										                        ) > 0
										                   )
			                                                   then 'Y'
			                                            else null
			                                            end as RSLT_VL
			                                      from  MDNSTPABT a         -- NST환자정보
			                                         ,  SDONSTRET r         -- NST회신관리
			                                     where  a.PTNO              =  #{ptno}
			                                       and  a.MDRP_NO           =  #{mdrpNo}
			                                       and  r.PTNO          (+) =  a.PTNO
			                                       and  r.CNSN_REFR_YMD (+) =  a.REFR_YMD
			                                       and  r.REFR_SNO      (+) =  a.REFR_SNO
			                                       and  a.REFR_YMD          = (select max(x.REFR_YMD)
			                                                                     from MDNSTPABT x
			                                                                    where x.PTNO    = a.PTNO
			                                                                      and x.MDRP_NO = a.MDRP_NO
			                                                                   )
			                                    )
			                                , 'N') = 'Y') then 'Y' -- NICU 환자 NST 경장영양 회신 후 8일 경과 시
			            when #{pathNm} = 'REREQ_EN'
			                 and (
			                      nvl(
			                           (SELECT  /* MdpNstmDAO-listNstmRefr_NST의뢰내역 조회 */
			                                    case when (r.RPLY_YMD is not null) and
			                                              (trunc(r.RPLY_YMD) + 7 = trunc(sysdate)) and
			                                              (nvl(a.CMTX_FNSH_YN,'N') = 'N')
			                                            then 'Y'
			                                     else 'N' END as RSLT_VL
			                              from  MDNSTPABT a         -- NST환자정보
			                                 ,  SDONSTRET r         -- NST회신관리
			                             where  a.PTNO           = #{ptno}
			                               and  a.MDRP_NO        = #{mdrpNo}
			                               and  a.REFR_YMD       = (select max(x.REFR_YMD)
			                                                          from MDNSTPABT x
			                                                         where x.PTNO = #{ptno}
			                                                           and x.MDRP_NO = #{mdrpNo}
			                                                           and x.NSTM_ACCS_PATH_CD = '1')
			                               and  r.PTNO           =   a.PTNO
			                               and  r.CNSN_REFR_YMD  =   a.REFR_YMD
			                               and  r.REFR_SNO       =   a.REFR_SNO
			                               and  r.NSTM_ACCS_PATH_CD = '1' /* NST접근경로코드 : EN */
			                               and  rownum = 1)
			                            ,'N') = 'Y'
			                      ) then 'Y'                    -- EN 회신 후 7일 경과 시(종료환자 제외)
			            when #{pathNm} = 'REREQ_TPN'
			                 and (
			                      nvl(
			                           (SELECT  /* MdpNstmDAO-listNstmRefr_NST의뢰내역 조회 */
			                                    case when (r.RPLY_YMD is not null) and
			                                              (trunc(r.RPLY_YMD) + 7 = trunc(sysdate)) and
			                                              (nvl(a.CMTX_FNSH_YN,'N') = 'N')
			                                            then 'Y'
			                                     else 'N' END as RSLT_VL
			                              from  MDNSTPABT a         -- NST환자정보
			                                 ,  SDONSTRET r         -- NST회신관리
			                             where  a.PTNO           = #{ptno}
			                               and  a.MDRP_NO        = #{mdrpNo}
			                               and  a.REFR_YMD       = (select max(x.REFR_YMD)
			                                                          from MDNSTPABT x
			                                                         where x.PTNO = #{ptno}
			                                                           and x.MDRP_NO = #{mdrpNo}
			                                                           and x.NSTM_ACCS_PATH_CD = '2')
			                               and  r.PTNO           =   a.PTNO
			                               and  r.CNSN_REFR_YMD  =   a.REFR_YMD
			                               and  r.REFR_SNO       =   a.REFR_SNO
			                               and  r.NSTM_ACCS_PATH_CD = '2' /* NST접근경로코드 : TPN */
			                               and  rownum = 1)
			                            ,'N') = 'Y'
			                      ) then 'Y'                    -- TPN 회신 후 7일 경과 시(종료환자 제외)
			           when #{pathNm} = 'DIET' and
								 (
						              nvl((select count(*) as cnt -- 경관유동식(치료식) 섭취 건수
						                     from sudiectmt a /* 식사력테이블 */
						                         ,sudiecdct b   /* 식사코드테이블 */
						                    where a.ptno      = #{ptno}         /* 환자번호     */
						                      and a.mdrp_no   = #{mdrpNo}       /* 진료접수번호 */
						                      and a.diet_ymd between trunc(sysdate - 2) and trunc(sysdate) /* 현재일 포함 3일 이내 처방만으로 변경 요청 20210722 */
						                      and a.diet_cd = b.diet_cd
						                      and b.TBFD_YN = 'Y'               /* 경관여부 */
						                      and a.RTRN_DT is null             /* 반납여부 */
						                   ),0) > 0
						           ) and
						           (
						            nvl(
						                 (SELECT  count(*)
						                    from  MDNSTPABT a         -- NST환자정보
						                         ,SDONSTRET r         -- NST회신관리
						                   where a.PTNO              = #{ptno}
						                     and a.MDRP_NO           = #{mdrpNo}
						                     and r.PTNO          (+) =   a.PTNO
						                     and r.CNSN_REFR_YMD (+) =   a.REFR_YMD
						                     and r.REFR_SNO      (+) =   a.REFR_SNO
						                     and a.NSTM_ACCS_PATH_CD = '1')
						                ,0) = 0
						           ) and
						           (
						            nvl(
						                 (select count(*)
		                                    from MDNSTPABT a
		                                   where a.PTNO     = #{ptno}
		                                     and a.MDRP_NO  = #{mdrpNo}
		                                     and a.REFR_YMD = to_date(#{nextMdcrYmd},'yyyymmdd')  --처방일자
		                                     and a.NSTM_ACCS_PATH_CD = '2' -- TPN
		                                     )
						                ,0) = 0
						           ) then 'Y'
						when #{pathNm} = 'NEW_DRUG'
			                and exists (    select  1
		                                              from MDMEDORDT a
		                                                  ,SDMCTRLMT b
		                                             where  PTNO            =   #{ptno}
		                                               and  MDRP_NO         =   #{mdrpNo}
		                                               and  ORDR_YMD       >= FN_CC_GET_CNST_VL('MED_001', 'OPEN_DT') /* 오픈일 이후 */
		                                               and  DC_DVSN_CD      =   'N'
		                                               and  TMPR_ORDR_YN    =   'N'
		                                               and  b.PHRM_CTRL_CD  = 'SD705'	-- Encover , Harmonilan 처방 발행 내역 존재여부 확인
		                                               and  a.ORDR_CD       = b.PHRM_DTLS_CTRL_CD   ) then 'Y'
		                when #{pathNm} = 'NICU_FEEDING' and
										 (
								              nvl((select  count(*) as cnt
				                                     from  MDTRTORDT a
				                                    where  a.PTNO        = #{ptno}                             /* 환자번호     */
				                                      and  a.MDRP_NO     = #{mdrpNo}                           /* 진료접수번호 */
				                                      and  a.ORDR_YMD   >= to_date(#{ordrYmd},'yyyymmdd')      /* 입원일자 */
				                                      and  a.ORDR_CD    in (
				                                                            select x.MDCR_DTLS_CTRL_CD
				                                                              from MZCTRLMMT x
				                                                             where x.MDCR_CTRL_CD = 'MDP_844' --분유 처치재료 처방
				                                                            )
				                                      and  a.CODV_CD     =   'I'
				                                      and  nvl(a.DC_DVSN_CD,'N') ='N'
								                   ),0) > 0
								           ) and
								           (
								            nvl(
								                 (SELECT  count(*)
								                    from  MDNSTPABT a         -- NST환자정보
								                         ,SDONSTRET r         -- NST회신관리
								                   where a.PTNO              = #{ptno}
								                     and a.MDRP_NO           = #{mdrpNo}
								                     and r.PTNO          (+) =   a.PTNO
								                     and r.CNSN_REFR_YMD (+) =   a.REFR_YMD
								                     and r.REFR_SNO      (+) =   a.REFR_SNO)
								                ,0) = 0
								           ) then 'Y'
			            else 'N'
			            end                 as RSLT_VL
			  from  dual
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInferDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInferDiagYn (환자 난임상병 조회) 
        Description :                                           환자가 난임상병이 있는지 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInferDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInferDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInferDiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInferDiagYn */
		SELECT DECODE(COUNT(1),0,'N','Y') AS YN
		  FROM MDPADIAGT A
			  ,APPTPTNTT B
		 WHERE 1=1
		   AND A.MDRP_NO = #{mdrpNo}
		   AND B.PTNO = A.PTNO
		   AND (   EXISTS (SELECT  MDCR_DTLS_CTRL_CD
						 FROM MZCTRLMMT B
						WHERE B.MDCR_CTRL_CD = 'MDK_0039' --보조생식술(난임치료)
						  AND SUBSTR(A.SCIN_CD,1,B.MDCR_CTRL_NMBR_VL1) = B.MDCR_DTLS_CTRL_CD
					   )
				   OR (
							   B.GEND_CD ='M'
						  AND  A.SCIN_CD ='Z31.8'
					)
				)
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAsthScinYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAsthScinYn (환자가 천식 상병이 있는지 조회) 
        Description :                                           환자가 천식 상병이 있는지 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAsthScinYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAsthScinYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAsthScinYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAsthScinYn */
		 select DECODE(COUNT(1),0,'N','Y') AS YN
		   from MDPACLNCT a				/* 환자임상진단내역 */
		      , MDPADIAGT b				/* 환자상병내역 */
		  where a.MDRP_NO = b.MDRP_NO
		    and a.PTNT_CLNC_DX_SNO = b.PTNT_CLNC_DX_SNO
		    and a.MDRP_NO = #{mdrpNo}
		    and NVL(a.RUL_OUT_YN,'N') != 'Y'
		    and exists (select 1
		                  from MZCTRLMMT
		                 where MDCR_CTRL_CD = 'MDK_0028'  /* 천식 적정성 평가 진단 리스트 */
		                   and MDCR_DTLS_CTRL_CD = substr(b.SCIN_CD, 1, 3)
		                   and to_date(#{ordrYmd}, 'yyyymmdd') between APST_YMD and APFN_YMD)
		    and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLungFnctEximYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLungFnctEximYn (환자 폐기능검사 실행 여부 조회) 
        Description :                                           환자 폐기능검사 실행 여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLungFnctEximYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLungFnctEximYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLungFnctEximYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLungFnctEximYn */
		select DECODE(COUNT(1),0,'N','Y') AS YN
		  from MDEXMORDT a			-- 검사처방
		     , AIMFMDFET b 			-- 수가코드
		 where a.ORDR_CD = b.MDFE_CD
		   and a.ORDR_YMD between b.APST_YMD and b.APFN_YMD
		   and a.PTNO = #{ptno}
		   and a.DC_DVSN_CD = 'N'
		   and a.TMPR_ORDR_YN = 'N'
		   and a.ENFR_DT >= FN_CC_GET_CNST_VL('MDP_003', 'ASTH_PPVL_BASE_YMD')	/* 천식적정성평가 검사체크 기준일자 */
		   and a.ENFR_DT <= to_date(#{ordrYmd}, 'yyyymmdd')
		   and b.INSR_EDI_CD in (select MDCR_DTLS_CTRL_CD
		                                     from MZCTRLMMT
		                                   where MDCR_CTRL_CD = 'MDK_0029'
		                                      and to_date(#{ordrYmd}, 'yyyymmdd') between APST_YMD and APFN_YMD) /* 천식적정성 평가 폐기능 검사 EDI 리스트 */
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAsthPpvlPtntDrugOrdr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
		<result property="ordrCct1" column="ORDR_CCT_1"/>
		<result property="ordrCct2" column="ORDR_CCT_2"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAsthPpvlPtntDrugOrdr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAsthPpvlPtntDrugOrdr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAsthPpvlPtntDrugOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAsthPpvlPtntDrugOrdr-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAsthPpvlPtntDrugOrdr */
		<![CDATA[
		select  decode(sign(count(a.PTNO)), 1, 'Y', 'N') AS YN
		     ,  0 as ORDR_CCT_1
		     ,  0 as ORDR_CCT_2
		  from  MDMEDORDT a
		 where  1=1
		   and  a.PTNO = #{ptno}
		   and  a.ORDR_YMD >= FN_CC_GET_CNST_VL('MDP_003', 'ASTH_PPVL_BASE_YMD') /* 천식적정성평가 검사 또는 약처방 체크 기준일자 */
		   and  a.ORDR_YMD < to_date(#{ordrYmd},'YYYYMMDD')+1
		   and  a.DC_DVSN_CD = 'N'
		   and  a.TMPR_ORDR_YN = 'N'
		   and  a.ORDR_CD in (select  MDCR_DTLS_CTRL_CD
		                        from  MZCTRLMMT
		                       where MDCR_CTRL_CD = 'MDK_0030'
		                         and to_date(#{ordrYmd}, 'yyyymmdd') between APST_YMD and APFN_YMD
		                         and MDCR_CTRL_CHRC_VL1 = 'I' --ICS 약제
		                     )
		 union  all
		select  '' as YN
		     ,  sum(decode(b.MDCR_CTRL_CHRC_VL1, 'Y', 1, 0)) as ORDR_CCT_1  --천식기타약제
		     ,  sum(decode(b.MDCR_CTRL_CHRC_VL1,'I',1, 0)) AS ORDR_CCT_2  --ICS 약제
		  from  MDMEDORDT a
		     ,  MZCTRLMMT b
		 WHERE 1=1
		   and a.PTNO = #{ptno}
		   and a.ORDR_YMD >= FN_CC_GET_CNST_VL('MDP_003', 'ASTH_PPVL_BASE_YMD') /* 천식적정성평가 검사 또는 약처방 체크 기준일자 */
		   and a.ORDR_YMD < to_date(#{ordrYmd},'YYYYMMDD')+1
		   and a.IHOH_DVSN_CD = 'O'
		   and a.CODV_CD <> 'I'
		   and  a.DC_DVSN_CD = 'N'
		   and  a.TMPR_ORDR_YN = 'N'
		   and B.MDCR_CTRL_CD = 'MDK_0030'
		   and to_date(#{ordrYmd}, 'yyyymmdd') between b.APST_YMD and b.APFN_YMD
		   and b.MDCR_DTLS_CTRL_CD = a.ORDR_CD
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteDiagYn (환자가 골다공증 진단이 있는지 조회) 
        Description :                                           환자가 골다공증 진단이 있는지 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteDiagYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteDiagYn */
		 select decode(count(1), 0, 'N', 'Y') AS YN
		   from MDPADIAGT A
		      , APPTPTNTT B
		  where A.MDRP_NO = #{mdrpNo}
		    and A.PTNO = B.PTNO
		    and (EXISTS ( select 1
		                    from MZCTRLMMT C
		                   where C.MDCR_CTRL_CD = 'MDP_103' /*골다공증 진단 상병코드 */
		                     and C.MDCR_DTLS_CTRL_CD = SUBSTR(A.SCIN_CD, 1, 3) )
		         )
		    and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteExmnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteExmnYn (환자가 골다공증 검사가 있는지 조회) 
        Description :                                           환자가 골다공증 검사가 있는지 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteExmnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteExmnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteExmnYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOsteExmnYn */
		select decode(count(1), 0, 'N', 'Y') as YN
		  from MDEXMORDT a
		     , AIMFMDFET b
		     , MDORDRCMT c
		 where a.ORDR_CD = b.MDFE_CD
		   and b.MDFE_CD = c.ORDR_CD
		   and a.PTNO = #{ptno}
		   and trunc(a.ENFR_DT) between add_months(to_date(#{ordrYmd}, 'yyyymmdd'), -12)
		   and to_date(#{ordrYmd}, 'yyyymmdd')
		   and a.DC_DVSN_CD = 'N'
		   and a.TMPR_ORDR_YN = 'N'
		   and a.ENFR_DT is not null
		   and b.INSR_EDI_CD in('HC341', 'HC342')
		   and to_date(#{ordrYmd}, 'yyyymmdd') between b.APST_YMD
		   and b.APFN_YMD
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStntOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStntOrdrYn (환자의 처방이 스텐트 처방인지 여부를 조회) 
        Description :                                           환자의 처방이 스텐트 처방인지 여부를 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStntOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStntOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStntOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStntOrdrYn */
		select decode(count(1), 0, 'N', 'Y') as YN
		  from MDORDRCMT a
		     , AIMFMDFET b
		 where a.ORDR_CD = b.MDFE_CD
		   and a.ORDR_CD = #{ordrCd}
		   and to_date(#{ordrYmd}, 'yyyymmdd') between b.APST_YMD and b.APFN_YMD
		   and EXISTS (select 1
		                 from MZCTRLMMT c
		                where c.MDCR_CTRL_CD = 'MDP_121' /* 관상동맥 스텐트 처방 보험EDI코드 */
		                  and c.MDCR_DTLS_CTRL_CD = substr(b.INSR_EDI_CD, 1, 5)
		               )
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDbmlScinExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
		<result property="ijcnEn" column="IJCN_EN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDbmlScinExstYn (당뇨상병존재여부 체크) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDbmlScinExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDbmlScinExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDbmlScinExstYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDbmlScinExstYn */
		select  DECODE(COUNT(1),0,'N','Y') AS YN
		       ,   #{ijcnOthrExstYn}	as IJCN_EN
		  from  MDPACLNCT a				-- 환자임상진단내역
		     ,  MDPADIAGT b				-- 환자상병내역
		     ,  MZCTRLMMT c
		 where  a.MDRP_NO = b.MDRP_NO
		   and  NVL(a.RUL_OUT_YN,'N') <![CDATA[ <> ]]>  'Y'
		   and  a.MDRP_NO = #{mdrpNo}
		   and  c.MDCR_CTRL_CD = 'MDP_283' /* 당뇨관련 상병 */
		   and  substr(b.SCIN_CD, 1, to_number(c.MDCR_CTRL_CHRC_VL1)) = c.MDCR_DTLS_CTRL_CD
		 <if test='ijcnOthrExstYn == "Y"'>
		   /* 당뇨관련 처방된 약중 주사약이 아닌 약제가 있다면 주사제일 때만 인정되는 상병은 제외한다. */
		   and  nvl(c.MDCR_CTRL_CHRC_VL2, 'ALL') <![CDATA[ <> ]]>  'Y'
		 </if>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneFludFltrOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneFludFltrOrdrYn (수액필터(재료) 처방인지 여부를 조회) 
        Description :                                           수액필터(재료) 처방인지 여부를 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneFludFltrOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneFludFltrOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneFludFltrOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneFludFltrOrdrYn */
		select decode(count(1), 0, 'N', 'Y') as YN
		  from MDORDRCMT a
		     , AIMFMDFET b
		 where a.ORDR_CD = b.MDFE_CD
		   and a.ORDR_CD = #{ordrCd}
		   and to_date(#{ordrYmd}, 'yyyymmdd') between b.APST_YMD and b.APFN_YMD
		   and EXISTS (select 1
		                 from MZCTRLMMT c
		                where c.MDCR_CTRL_CD = 'MDP_122' /* 수액필터(재료) 보험EDI코드 */
		                  and c.MDCR_DTLS_CTRL_CD = substr(b.INSR_EDI_CD, 1, 5)
		              )
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrExreScinYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrExreScinYn (장기재원 예외상병코드 여부 조회) 
        Description :                                           장기재원 예외상병코드 여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrExreScinYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrExreScinYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrExreScinYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrExreScinYn */
				select DECODE(COUNT(1),0,'N','Y') AS YN
				  from MDPACLNCT a                -- 환자임상진단내역
				        , MDPADIAGT b                -- 환자상병내역
				where  a.MDRP_NO 				= b.MDRP_NO
				    and  a.PTNT_CLNC_DX_SNO 	= b.PTNT_CLNC_DX_SNO
				    and  a.MDRP_NO 				= #{mdrpNo}
				    and  a.MAIN_CLNC_DX_YN 	!= 'Y'
				   and (EXISTS ( select  1
				                         from  MZCTRLMMT C
				                         where c.MDCR_CTRL_CD = 'MDP_911' --장기재원 예외상병코드
				                         	and 1 = case when c.MDCR_CTRL_NMBR_VL1 = 4 then
						 										case when c.MDCR_DTLS_CTRL_CD = SUBSTR(b.SCIN_CD, 1, 4)   then 1
						 												else 0
						 												end
						 										when c.MDCR_CTRL_NMBR_VL1 = 3 then
						 										case when C.MDCR_DTLS_CTRL_CD = SUBSTR(b.SCIN_CD, 1, 3)   then 1
						 												else 0
						 												end
						 										when c.MDCR_CTRL_NMBR_VL1 = 1 then
						 										case when C.MDCR_DTLS_CTRL_CD = SUBSTR(b.SCIN_CD, 1, 1)   then 1
						 												else 0
						 												end
														end
				                     )
				          )
				    and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInfcRltnScinRgstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="scinCd" column="SCIN_CD"/>
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInfcRltnScinRgstYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInfcRltnScinRgstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInfcRltnScinRgstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInfcRltnScinRgstYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInfcRltnScinRgstYn */
		select MDCR_DTLS_CTRL_CD as ORDR_CD
		     , MDCR_CTRL_CHRC_VL1 as SCIN_CD
		     , 'N' as YN
		 from MZCTRLMMT a
		 where MDCR_CTRL_CD = 'MDP_380'	/* 법정감염병관련 검사처방코드 관리 */
		   and MDCR_DTLS_CTRL_CD = #{ordrCd}
		   and not exists (select 1
		                     from MDPADIAGT
		                    where MDRP_NO = #{mdrpNo}
		                      and SCIN_CD = a.MDCR_CTRL_CHRC_VL1
		                  )
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncDxCdByScinCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="clncDxCd" column="CLNC_DX_CD"/>
		<result property="scinCd" column="SCIN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncDxCdByScinCd (입력된 상병을 가지고 있는 임상진단코드 목록 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncDxCdByScinCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncDxCdByScinCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncDxCdByScinCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listClncDxCdByScinCd */
		<![CDATA[
		select b.TRMN_ID as CLNC_DX_CD
		     , b.TRMN_ID as SCIN_CD
		  from MRBSSCINT a
		     , MRBSCLSCT b
		 where a.SCIN_CD = #{scinCd}
		   and a.SCIN_CD_VRSN_STRT_YMD <= to_date(#{ordrYmd}, 'yyyymmdd')
		   and a.SCIN_CD_VRSN_FNSH_YMD >= to_date(#{ordrYmd}, 'yyyymmdd')
		   and a.SCIN_CD = b.SCIN_CD
		   and a.SCIN_CD_VRSN_STRT_YMD = b.SCIN_CD_VRSN_STRT_YMD
		   and b.TRMN_MPNG_STRT_YMD <= to_date(#{ordrYmd}, 'yyyymmdd')
		   and b.TRMN_MPNG_FNSH_YMD >= to_date(#{ordrYmd}, 'yyyymmdd')
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrUnprAmt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="insrUnprAmt" column="INSR_UNPR_AMT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrUnprAmt (처방코드의 보험단가금액을 조회) 
        Description :                                           처방코드의 보험단가금액을 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrUnprAmt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrUnprAmt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrUnprAmt-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneInsrUnprAmt */
		       INSR_UNPR_AMT                                    as INSR_UNPR_AMT   -- 보험단가금액
		  from AIMFMDFET
		 where MDFE_CD = #{ordrCd}
		   and #{ordrYmd} between to_char(APST_YMD, 'yyyymmdd') and to_char(APFN_YMD, 'yyyymmdd')
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeuroExmnOrdrYnForYear-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeuroExmnOrdrYnForYear (신경인지기능검사 1년내 처방여부를 조회) 
        Description :                                           신경인지기능검사 1년내 처방여부를 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeuroExmnOrdrYnForYear-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeuroExmnOrdrYnForYear"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeuroExmnOrdrYnForYear-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeuroExmnOrdrYnForYear */
		        decode(count(*), 0, 'N', 'Y')      as YN
		  from AIMFMDFET, MDEXMORDT
		 where substr(INSR_EDI_CD,1,5) in ('FB001','FB002','FB003','FB004','FB011','FB012','FB013','FB021','FB022')
		   and to_date(#{ordrYmd}, 'yyyymmdd') between APST_YMD and APFN_YMD
		   and ORDR_CD =  MDFE_CD
		   and PTNO = #{ptno}
		   and to_char(ORDR_YMD, 'yyyymmdd') between to_char(to_date(#{ordrYmd}, 'yyyy-mm-dd') - 365, 'yyyymmdd') and #{ordrYmd}
		   and DC_DVSN_CD = 'N'
		   and nvl(ORDR_IPDV_CD,' ') in ('1',' ')
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDrugCtntOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDrugCtntOrdrYn (TDM검사처방 및 협진이 필요한 약처방의 연속처방여부 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDrugCtntOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDrugCtntOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDrugCtntOrdrYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDrugCtntOrdrYn */
		select  'Y' as YN
		  from  (
		        select  distinct a.ORDR_YMD
		             ,  to_number(c.PHRM_CTRL_CHRC_VL2) as ORDR_PERD_VL
		          from  MDMEDORDT a
		             ,  MDORDRCMT b
		             ,  SDMCTRLMT c
		         where  a.PTNO = #{ptno}
		           and  a.ORDR_CD = b.ORDR_CD
		           and  b.ORDR_CD = c.PHRM_DTLS_CTRL_CD
		           and  c.PHRM_CTRL_CD = 'SDB_041'
		           and  c.PHRM_CTRL_CHRC_VL1 = #{phrkExmnCd}
		           and  a.DC_DVSN_CD = 'N'
		           and  a.TMPR_ORDR_YN = 'N'
		           and  a.ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd') - to_number(c.PHRM_CTRL_CHRC_VL2) + 1
		                               and to_date(#{ordrYmd}, 'yyyymmdd')
		           and  not exists (select  '1'
		                              from  MDEXMORDT d /* TDM검사에 묶여 있는 검사협진 */
		                                 ,  MDORDRCMT e /* 약처방에 의해 입력된 TDM검사 */
		                             where  e.ORDR_CD = #{phrkExmnCd}
		                               and  d.PTNO = #{ptno}
		                               and  e.PHRK_EXMN_CD = d.ORDR_CD
		                               and  d.ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd') - to_number(c.PHRM_CTRL_CHRC_VL2) + 1
		                                                   and to_date(#{ordrYmd}, 'yyyymmdd')
		                               and  d.DC_DVSN_CD = 'N'
		                               and  d.TMPR_ORDR_YN = 'N')
		        ) a
		 group  by a.ORDR_PERD_VL
		having  count(*) &gt;= (a.ORDR_PERD_VL - 1)
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnSmknYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnSmknYn () 
        Description :                                           병동간호정보조사에서 폐렴 적정성 환자의 흡연 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnSmknYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnSmknYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnSmknYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnSmknYn */
		select decode(count(1), 1, 'Y', 'N') as YN
		  from MNWNISEMT /* 병동간호정보조사 */
		 where MDRP_NO = #{mdrpNo}
		   and SMKN_DVSN_CD = '2' /* 1:무, 2:흡연중, 3:금연 */
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneEicuPtrmYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneEicuPtrmYn () 
        Description :                                           환자의 병실이 응급전용 중환자실인지 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneEicuPtrmYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneEicuPtrmYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneEicuPtrmYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneEicuPtrmYn */
		select decode(count(1), 1, 'Y', 'N') as YN
		  from APRCRPTNT a /* 진료접수 */
		     , APRCPTRMT b /* 병실 */
		 where a.WARD_CD = b.WARD_CD
		   and a.PTRM_NO = b.PTRM_NO
		   and trunc(sysdate) between b.APST_YMD AND b.APFN_YMD
		   and a.MDRP_NO = #{mdrpNo}
		   and b.PTRM_DVSN_CD = '25' /* 25 : 응급전용 중환자실 */
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNghtAditRt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="nghtAditRt" column="NGHT_ADIT_RT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNghtAditRt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNghtAditRt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNghtAditRt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNghtAditRt-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNghtAditRt */
		         NGHT_ADIT_RT                  as NGHT_ADIT_RT        -- 야간가산율
		  from AIMFMDFET
		 where MDFE_CD = #{ordrCd}
		   and #{ordrYmd} between to_char(APST_YMD, 'yyyymmdd') and to_char(APFN_YMD, 'yyyymmdd')
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCarePlanYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCarePlanYn () 
        Description :                                           환자의 의사 Care Plan 작성 유무를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCarePlanYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCarePlanYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCarePlanYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCarePlanYn */
		 select decode(count(1),1,'Y','N') as YN
		   from APRCRPTNT a
		      , MDPPLANDT b
		  where a.MDRP_NO = b.MDRP_NO
		    and a.CODV_CD = 'I'
		    and a.CNCL_DT IS NULL
		    and a.DSCH_DT = TO_DATE('29991231', 'yyyymmdd')
		    and b.MDRP_NO = #{mdrpNo}
		    and b.PLAN_RCRD_TYPE_CD = 'A'
		    and b.DLTN_YMD is null
		    and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOprtMdfeCdYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
		<result property="chotDt" column="CHOT_DT"/>
		<result property="oprtYmd" column="OPRT_YMD"/>
		<result property="ordpCd" column="ORDP_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOprtMdfeCdYn () 
        Description :                                           입력된 수술료 처방 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOprtMdfeCdYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOprtMdfeCdYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOprtMdfeCdYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOprtMdfeCdYn*/
		select a.YN
		     , a.chot_dt
		     , a.OPRT_YMD
		     , a.ORDP_CD
		  from (
		       select nvl(to_char(a.RCVY_ROM_ENRM_DT, 'yyyymmddhh24mi'), to_char(a.OPRM_CHOT_DT, 'yyyymmddhh24mi')) as CHOT_DT  -- 회복실입실일시가 없을 경우 수술실 퇴실일시
		            , to_char(a.OPRT_YMD, 'yyyymmdd')                                                               as OPRT_YMD --수술일자
		            , a.ORDP_CD                                                                                     as ORDP_CD  -- 집도과코드
		            , case when c.ordr_cd is not null
		                     or e.ordr_cd is not null
		                     or g.ordr_cd is not null
		                       then 'Y'
		                       else 'N'
		                   end                                                                                      as YN
		            , row_number() over (partition by a.ptno order by nvl(a.RCVY_ROM_ENRM_DT, a.OPRM_CHOT_DT) desc) as sno
		         from MDOPSCHET a /* 수술스케줄 */
		            , MNSOPNRMT b /* 수술간호기록 */
		            , MDTRTORDT c /* 처치채료처방 */
		            , AIMFMDFET d /* 수가마스터 */
		            , MDEXMORDT e /* 검사처방 */
		            , AIMFMDFET f /* 수가마스터 */
		            , MDBLDORDT g /* 수혈처방 */
		            , AIMFMDFET h /* 수가마스터 */
		        where a.ptno = #{ptno}
		          and a.mdrp_no = #{mdrpNo}
		          and a.OPRT_STTS_CD in ('6', '7', '8')                --수술완료, 회복중
		          and a.CNCL_YMD is null
		          and a.ORDP_CD = #{ordpCd}                            --집도과
		          and a.ptno = b.ptno(+)
		          and a.oprt_ymd = b.oprt_ymd(+)
		          and a.oprt_sno = b.oprt_sno(+)
		          and a.ptno = c.ptno(+)
		          and a.mdrp_no = c.mdrp_no(+)
		          and a.oprt_ymd = c.oprt_ymd(+)
		          and a.oprt_sno = c.oprt_sno(+)
		          and c.ORDR_YMD(+) >= to_date(#{mdcrYmd}, 'yyyymmdd') --입원일자
		          and c.CODV_CD(+) = 'I'                               --입원처방만
		          and c.DC_DVSN_CD(+) = 'N'                            --DC 처방제외
		          and c.ordr_cd = d.mdfe_cd(+)
		          and c.ORDR_YMD between d.APST_YMD(+) and d.APFN_YMD(+)
		          and d.OPRT_MDFE_CD_YN(+) = 'Y'                       -- 수술수가코드여부
		          and a.mdrp_no = e.mdrp_no(+)
		          and a.oprt_ymd = e.oprt_ymd(+)
		          and a.oprt_sno = e.oprt_sno(+)
		          and e.ORDR_YMD(+) >= to_date(#{mdcrYmd}, 'yyyymmdd') --입원일자
		          and e.CODV_CD(+) = 'I'                               --입원처방만
		          and e.DC_DVSN_CD(+) = 'N'                            --DC 처방제외
		          and e.ordr_cd = f.mdfe_cd(+)
		          and e.ORDR_YMD between f.APST_YMD(+) and f.APFN_YMD(+)
		          and f.OPRT_MDFE_CD_YN(+) = 'Y'                       -- 수술수가코드여부
		          and a.mdrp_no = g.mdrp_no(+)
		          and a.oprt_ymd = g.oprt_ymd(+)
		          and a.oprt_sno = g.oprt_sno(+)
		          and g.ORDR_YMD(+) >= to_date(#{mdcrYmd}, 'yyyymmdd') --입원일자
		          and g.CODV_CD(+) = 'I'                               --입원처방만
		          and g.DC_DVSN_CD(+) = 'N'                            --DC 처방제외
		          and g.ordr_cd = h.mdfe_cd(+)
		          and g.ORDR_YMD between h.APST_YMD(+) and h.APFN_YMD(+)
		          and h.OPRT_MDFE_CD_YN(+) = 'Y' -- 수술수가코드여부
		       ) a
		 where sno = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOpfnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOpfnYn () 
        Description :                                           종료된 수술 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOpfnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOpfnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOpfnYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneOpfnYn */
		 select decode(count(1), 1, 'N', 'Y') as YN
		   from APRCRPTNT a /* 진료접수 */
		      , MDOPSCHET b /* 수술스케쥴 */
		  where a.PTNO = b.PTNO
		    and a.MDRP_NO = #{mdrpNo}
		    and a.PTNO = #{ptno}
		    and b.OPRT_YMD between to_date(decode(#{hsptCd}, '11100117', greatest(#{mdcrYmd},'20100315')
		    										  	   , '11100494', greatest(#{ordrYmd},'20101011')
		    										  	   , '31100252', greatest(#{ordrYmd},'20110302')
		    										  	   , #{ordrYmd}), 'yyyymmdd')
		    and to_date(#{ordrYmd},'yyyymmdd') /* 수술일자 (안암, 구로, 안산, 그 외)*/
		    and nvl(b.RCVY_ROM_ENRM_DT, b.OPRM_CHOT_DT) is not null /* nvl(회복실 입실 일시, 수술실퇴실일시) */
		    and b.OPRM_CHOT_DT is not null
		    and sysdate > decode(#{hsptCd}, '31100252', trunc(b.OPRM_CHOT_DT + 1), nvl(b.RCVY_ROM_ENRM_DT, b.OPRM_CHOT_DT))
		    and b.CODV_CD <> 'D'
		    and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErComnRcRdYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErComnRcRdYn () 
        Description :                                           로그인 사용자의 진료부서로 작성된 ER Note 작성 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErComnRcRdYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErComnRcRdYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErComnRcRdYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErComnRcRdYn */
		select decode(count(1), 1, 'Y', 'N') as YN
		  from MNEERRPAT a
		     , MEDOCMBST b
		 where a.MDRP_NO = b.MDRP_NO
		   and a.MDRP_NO = #{mdrpNo}
		   and b.RCKI_CD in (FN_CC_GET_CNST_VL('MED_002', 'S_ER_NOTE_RCRD'),FN_CC_GET_CNST_VL('MED_002', 'S_MSPL_CMTX_RCRD'))  /* ER Note, ocs기준 적용으로 기록번호 134 추가 */
		   --and b.RCRD_SAVE_DVSN_CD = '1'  /* 1.인증  2.미서명 */ asis에서는 존재여부만 체크한다고 하여 조검 제거함. 2021.03.27 obh
		   and nvl(b.DLTN_YN, 'N') = 'N'
		   and nvl((select decode(MDCR_CTRL_CHRC_VL3, 'N', ORGL_BLNG_MCDP_CD, MDCR_CTRL_CHRC_VL3)
		              from MZCTRLMMT
		             where MDCR_CTRL_CD = 'MDP_910'
		               and MDCR_CTRL_CHRC_VL2 = b.ORGL_BLNG_MCDP_CD
		               and nvl(MDCR_CTRL_CHRC_VL3, 'N') != 'N'), ORGL_BLNG_MCDP_CD)
		       = nvl((select decode(MDCR_CTRL_CHRC_VL3, 'N', #{mcdpCd}, MDCR_CTRL_CHRC_VL3)
		                from MZCTRLMMT
		               where MDCR_CTRL_CD = 'MDP_910'
		                 and MDCR_CTRL_CHRC_VL2 = #{mcdpCd}
		                 and nvl(MDCR_CTRL_CHRC_VL3, 'N') != 'N'), #{mcdpCd}) /* 원소속진료과코드 - 로그인한 의사의 사용자부서코드 */
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrReVltnRcrdCrtfCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="totlCct" column="TOTL_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrReVltnRcrdCrtfCct (장기입원재평가기록 건수를 조회한다.) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrReVltnRcrdCrtfCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrReVltnRcrdCrtfCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrReVltnRcrdCrtfCct-result" useCache="true" flushCache="false">
		<![CDATA[
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLntrReVltnRcrdCrtfCct */
			count(*) as TOTL_CCT
		 from
		       MEDOCMBST        /*  진료기록 */
		where
		       MDRP_NO = #{mdrpNo}
		  and  CHRT_OTAM_DVSN_CD = 'I'
		  and  RCRD_SAVE_DVSN_CD in
							(
								'1'
								,
								case when
								exists (
								    select
								        a.MDCR_CTRL_CD
								        from MZCTRLMMT a
								        where
								        1=1
								        and MDCR_CTRL_CD = 'MDK_0190'
								        and MDCR_DTLS_CTRL_CD = 'Y'
								)
								then '9'
								else
								    ''
								end
							)
		  and  RCKI_CD = FN_CC_GET_CNST_VL('MED_002', 'S_RE_VLTN_RCRD') -- 재평가기록
		  and  ADMS_CNCL_YMD is null
		  and  DLTN_YN = 'N'
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneMdtnPntmSpccDissAnct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
		<result property="yn1" column="YN1"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneMdtnPntmSpccDissAnct (투약 시점 특정 질환 알림 조회(스티븐스-존슨 증후군, TEN)) 
        Description :                                           투약 시점 특정 질환 알림(스티븐스-존슨 증후군, TEN) 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneMdtnPntmSpccDissAnct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneMdtnPntmSpccDissAnct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneMdtnPntmSpccDissAnct-result" useCache="true" flushCache="false">
		<![CDATA[
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneMdtnPntmSpccDissAnct */
		        max(case when b.SCIN_CD in (select MDCR_CTRL_CHRC_VL1  --스티븐스 존슨 증후군
		                                      from mzctrlmmt y
		                                     where y.MDCR_CTRL_CD = 'MDP_140'
		                                       and y.MDCR_DTLS_CTRL_CD = 'S')
		                     THEN 'Y' ELSE '' END ) as yn
		     ,  max(case when b.SCIN_CD in (select MDCR_CTRL_CHRC_VL1  --toxic epidermal necrolysis
		                                      from mzctrlmmt y
		                                     where y.MDCR_CTRL_CD = 'MDP_140'
		                                       and y.MDCR_DTLS_CTRL_CD = 'T')
		                     THEN 'Y' ELSE '' END ) as yn1
		  from APRCRPTNT a
		      ,MDPADIAGT b
		      ,MDPACLNCT c
		      ,MRBSSCINT d
		 where a.ptno      = #{ptno}
		   and a.MDCR_YMD >= ADD_MONTHS(trunc(sysdate), -120) -- 10년이내 등록된 진단
		   and a.MDCR_YMD <= trunc(sysdate)
		   and a.MDRP_NO   = b.MDRP_NO
		   and b.MDRP_NO   = c.MDRP_NO
		   and b.PTNT_CLNC_DX_SNO = c.PTNT_CLNC_DX_SNO
		   and b.SCIN_CD   = d.SCIN_CD
		   and a.MDCR_YMD between d.APLY_YMD and nvl(d.FNSH_YMD, sysdate)
		   and (
		        (
		          (b.SCIN_CD in (select MDCR_CTRL_CHRC_VL1  --스티븐스 존슨 증후군
		                           from mzctrlmmt y
		                          where y.MDCR_CTRL_CD = 'MDP_140'
		                            and y.MDCR_DTLS_CTRL_CD = 'S')) and
		          (not exists (select x.PTNO
				                 from MDEXCEPIT x
				                where x.PTNO              = a.PTNO
				                  and x.ORDR_YMD          = trunc(sysdate)
				                  and x.ORDR_SNO          = 1
				                  and x.OPTN_CTN1         = 'S'
				                  and x.INQR_EXCL_DVSN_CD = 'DX01'
				                  and x.OPTN_CTN2         = #{gvUserId})
		                                                        )
		        ) OR
		        (
		          (b.SCIN_CD in (select MDCR_CTRL_CHRC_VL1  --toxic epidermal necrolysis
		                           from mzctrlmmt y
		                          where y.MDCR_CTRL_CD = 'MDP_140'
		                            and y.MDCR_DTLS_CTRL_CD = 'T')) and
		          (not exists (select x.PTNO
				                 from MDEXCEPIT x
				                where x.PTNO              = a.PTNO
				                  and x.ORDR_YMD          = trunc(sysdate)
				                  and x.ORDR_SNO          = 1
				                  and x.OPTN_CTN1         = 'T'
				                  and x.INQR_EXCL_DVSN_CD = 'DX01'
				                  and x.OPTN_CTN2         = #{gvUserId})
		                                                        )
		        )
		       )
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmptYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmptYn () 
        Description :                                           응급실 경유 입원환자 여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmptYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmptYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmptYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmptYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from APRCRLTNT a
		     , MDCRINWKT b /* 뇌졸중관리  */
		 where a.MDRP_NO = #{mdrpNo}
		   and a.MDRP_RLTN_DVSN_CD = '01' /* 응급실경유입원 */
		   and b.MDRP_NO = a.MDRP_RLTN_MDRP_NO
		   and b.CRIN_MNGM_DVSN_CD = 'STROKE'
		   and nvl(b.CRIN_DVSN_CD,'1') != '3' /* 뇌졸중구분 MDA_012 ('3' 대상아님) */
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmpt24Yn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmpt24Yn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmpt24Yn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmpt24Yn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmpt24Yn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneErViaAmpt24Yn */
		<![CDATA[
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from APRCRLTNT a
		     , MDCRINWKT b /* 뇌졸중관리  */
		 where a.MDRP_NO = #{mdrpNo}
		   and a.MDRP_RLTN_DVSN_CD = '01' /* 응급실경유입원 */
		   and b.MDRP_NO = a.MDRP_RLTN_MDRP_NO
		   and b.CRIN_MNGM_DVSN_CD = 'STROKE'
		   and nvl(b.CRIN_DVSN_CD,'1') != '3' /* 뇌졸중구분 MDA_012 ('3' 대상아님) */
		   and b.ERRM_ENRM_DT is NOT NULL /* 응급실입실일시 */
		   and b.SYMP_OCRN_DT IS NOT NULL /* 증상발생일시 */
		   and (b.ERRM_ENRM_DT-b.SYMP_OCRN_DT)*24<=24 /* 응급실내원시간 - 증상발생시간이 24시간 이내 */
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinScinExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinScinExstYn () 
        Description :                                           I60~I63 뇌졸중 상병 존재여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinScinExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinScinExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinScinExstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinScinExstYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from MDPADIAGT a
		     , APPTPTNTT b
		 where a.MDRP_NO = #{mdrpNo}
		   and a.PTNO = B.PTNO
		   and substr(a.SCIN_CD, 1, 3) in (select c.MDCR_DTLS_CTRL_CD
		                                     from MZCTRLMMT c
		                                    where c.MDCR_CTRL_CD = 'MDP_112' /* 뇌졸중 진단 상병코드 */
		                                  )
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinEdmrFormWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinEdmrFormWrtgYn () 
        Description :                                           뇌졸중 교육서식 작성 여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinEdmrFormWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinEdmrFormWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinEdmrFormWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinEdmrFormWrtgYn */
		select decode(count(1), 1, 'Y', 'N') as YN
		  from MDSTREPDT
		 where MDRP_NO = #{mdrpNo}
		   and PTNO = #{ptno}
		   and ADMS_YMD = to_date(#{mdcrYmd}, 'YYYYMMDD')
		   and STND_FORM_TYPE_CD = 'STROKE'
		   and STND_FORM_TYAS_CD = 'NOMAL'
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinPtntRmdpCmtxWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinPtntRmdpCmtxWrtgYn (뇌졸중 환자 재활의학과 협진 작성 또는 제외사유 처방 존재 여부 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinPtntRmdpCmtxWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinPtntRmdpCmtxWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinPtntRmdpCmtxWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCrinPtntRmdpCmtxWrtgYn */
		       max(a.yn) as YN
		  from (
		        select decode(count(1), 0, 'N', 'Y') AS YN
		          from MDCONSRCT a
		         where a.ptno    = #{ptno}
		           and a.MDRP_NO = #{mdrpNo}
		           and a.CODV_CD = 'I'
		           and a.ORDR_YMD between to_date(#{mdcrYmd}, 'yyyymmdd') and to_date(#{ordrYmd}, 'yyyymmdd')
		           and a.WNTD_DR_MCDP_CD   = FN_CC_GET_DPRT_CD('DPRT_REH') /* 재활의학과 */
		           and a.CMTX_STTS_CD not in ('0', '9')                    /* 협진회신화면은 임시저장, 취소 상태는 조회대상 제외 */
		           and nvl(a.DLTN_YN, 'N') = 'N'
		        union all
		        select decode(count(1), 0, 'N', 'Y') AS YN
		          from MDBASORDT a
		         where a.PTNO          =  #{ptno}
		           and a.ORDR_YMD between to_date(#{mdcrYmd}, 'yyyymmdd') and to_date(#{ordrYmd}, 'yyyymmdd')
		           and a.MDRP_NO       = #{mdrpNo}
		           and a.ORDR_CD       =  'CF2111100' /* 재활컨설트 제외사유 기본처방 */
		           and nvl(a.DC_DVSN_CD, 'N') = 'N'
		        ) a
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneGstrCancDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneGstrCancDiagYn () 
        Description :                                           환자가 위암 진단이 있는지 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneGstrCancDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneGstrCancDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneGstrCancDiagYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneGstrCancDiagYn */
		select decode(count(a.PTNO), 1, 'Y', 'N') as YN
		  from MDPADIAGT a
		     , APRCRPTNT b
		 where a.PTNO = #{ptno}
		   and b.MDCR_YMD >= to_date(#{mdcrYmd}, 'yyyymmdd')
		   and a.CODV_CD = 'O'
		   and a.MDRP_NO = b.MDRP_NO
		   and (EXISTS ( select 1
		                   from MZCTRLMMT c
		                  where c.MDCR_CTRL_CD = 'MDP_102' /* 위암 진단 상병코드 */
		                    and c.MDCR_DTLS_CTRL_CD = SUBSTR(a.SCIN_CD, 1, 3) )
		        )
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnDiagYn () 
        Description :                                           환자가 대장암 진단이 있는지 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnDiagYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnDiagYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from MDPACLNCT a	/* 환자임상진단내역 */
		     , MDPADIAGT b	/* 환자상병내역 */
		 where a.MDRP_NO = #{mdrpNo}
		   and a.MDRP_NO = b.MDRP_NO
		   and a.PTNT_CLNC_DX_SNO = b.PTNT_CLNC_DX_SNO
		   and NVL(a.RUL_OUT_YN,'N') = 'N'
		   and (EXISTS ( select 1
		                   from MZCTRLMMT c
		                  where c.MDCR_CTRL_CD = 'MDP_116'	/* 대장암 진단 상병코드 */
		                    and c.MDCR_DTLS_CTRL_CD = SUBSTR(b.SCIN_CD, 1, 3))
		                    and rownum = 1
		            )
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePwdijslvn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="pwdijDvsnDetlCd" column="PWDIJ_DVSN_DETL_CD"/>
		<result property="mdprCd" column="MDPR_CD"/>
		<result property="mdprNm" column="MDPR_NM"/>
		<result property="ordrPsblDvsnCd" column="ORDR_PSBL_DVSN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePwdijslvn (분말주사제 용매정보 조회) 
        Description :                                           분말주사제에 사용해야 하는 용매정보를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePwdijslvn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePwdijslvn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePwdijslvn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePwdijslvn */
				select  a.ORDR_CD
				     ,  a.ORDR_NM
				     ,  b.PWDIJ_DVSN_DETL_CD
				     ,  d.ORDR_CD  as MDPR_CD
				     ,  d.ORDR_NM  as MDPR_NM
				     ,  d.ORDR_PSBL_DVSN_CD
				  from  MDORDRCMT a /* 재입력한 분말제형 주사제 */
				     ,  SDDDGCDMT b /* 현재입력한 분말제형 주사제 */
				     ,  SDMCTRLMT c /* 분말제형 주사제의 용법에 따라 매핑되어 있는 용매 */
				     ,  MDORDRCMT d /* 용매의 처방코드 */
				 where  a.ORDR_CD = b.MDPR_CD
				   and  a.ORDR_CD = #{ordrCd}
				   and  b.PWDIJ_YN = 'Y'
				   and  c.PHRM_CTRL_CD = 'SDC_024'
				   and  substr(b.PWDIJ_DVSN_DETL_CD, (select PHRM_CTRL_CHRC_VL1 /* 분말제형 주사제의 용법에 따라 사용해야 하는 분말형주사제구분상세코드의 몇번째 자리를 사용해야 하는지 관리하고 있음. */
				                                        from SDMCTRLMT
				                                       where PHRM_CTRL_CD = 'SDC_025'
				                                         and PHRM_DTLS_CTRL_CD = #{drusCd}), 1) = c.PHRM_DTLS_CTRL_CD
				   and  PHRM_CTRL_CHRC_VL1 = d.ORDR_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeopterinDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeopterinDiagYn () 
        Description :                                           만성신질환 상병 존재 여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeopterinDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeopterinDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeopterinDiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNeopterinDiagYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from MDPACLNCT a	/* 환자임상진단내역 */
		     , MDPADIAGT b	/* 환자상병내역 */
		 where a.MDRP_NO = #{mdrpNo}
		   and a.MDRP_NO = b.MDRP_NO
		   and a.PTNT_CLNC_DX_SNO = b.PTNT_CLNC_DX_SNO
		   and EXISTS ( select Y
		                   from MZCTRLMMT c
		                  where c.MDCR_CTRL_CD = 'MDK_0040'	/* 만성신질환 상병코드 */
		                    and c.MDCR_DTLS_CTRL_CD = b.SCIN_CD
		            )
		   and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetesDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetesDiagYn () 
        Description :                                           당뇨병 적정성 평가 대상 상병 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetesDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetesDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetesDiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetesDiagYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from MDPACLNCT a	/* 환자임상진단내역 */
		     , MDPADIAGT b	/* 환자상병내역 */
		 where  1=1
		   and a.MDRP_NO = #{mdrpNo}
		   and a.MDRP_NO = b.MDRP_NO
		   and a.PTNT_CLNC_DX_SNO = b.PTNT_CLNC_DX_SNO
		   and NVL(a.RUL_OUT_YN,'N') = 'N'
		   and EXISTS  (select Y
		                   from MZCTRLMMT c
		                  where c.MDCR_CTRL_CD = 'MDK_0074'	/* 당뇨병 적정성평가 진단 상병코드 */
		                    and c.MDCR_DTLS_CTRL_CD = SUBSTR(b.SCIN_CD, 1, 3)
		            )
		   and rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnDiagYn () 
        Description :                                           환자가 폐렴 진단이 있는지 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnDiagYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnDiagYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from MDPACLNCT a	/* 환자임상진단내역 */
		     , MDPADIAGT b	/* 환자상병내역 */
		 where a.MDRP_NO = #{mdrpNo}
		   and a.MDRP_NO = b.MDRP_NO
		   and a.PTNT_CLNC_DX_SNO = b.PTNT_CLNC_DX_SNO
		   and (EXISTS ( select 1
		                   from MZCTRLMMT c
		                  where c.MDCR_CTRL_CD = 'MDP_118' /* 폐렴 적정성 상병 코드 */
		                    and c.MDCR_DTLS_CTRL_CD = b.SCIN_CD
		                    and rownum = 1
		                )
		       )
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetExam-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="blodExmnCd" column="BLOD_EXMN_CD"/>
		<result property="nmbrVl1" column="NMBR_VL_1"/>
		<result property="nmbrVl2" column="NMBR_VL_2"/>
		<result property="nmbrVl3" column="NMBR_VL_3"/>
		<result property="nmbrVl4" column="NMBR_VL_4"/>
		<result property="nmbrVl5" column="NMBR_VL_5"/>
		<result property="nmbrVl6" column="NMBR_VL_6"/>
		<result property="otrsHsptEximYmd" column="OTRS_HSPT_EXIM_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetExam () 
        Description :                                           당뇨병 적정성 평가 관련 검사, 투석 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetExam-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetExam"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetExam-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetExam */
		<![CDATA[
				SELECT
				       /* 지질검사 3항목 모두 시행 */
				       DECODE(NVL(SUM(DECODE(A.MDCR_DTLS_CTRL_CD,'CHOL',1)),0),0,'N','Y') ||	/* 총콜레스테롤 	*/
				       DECODE(NVL(SUM(DECODE(A.MDCR_DTLS_CTRL_CD,'HDL' ,1)),0),0,'N','Y') ||	/* HDL 콜레스테롤 	*/
				       DECODE(NVL(SUM(DECODE(A.MDCR_DTLS_CTRL_CD,'TRIG',1)),0),0,'N','Y') AS BLOD_EXMN_CD	/* 트리글리세라이드	*/
				      /* 지질검사 : LDL 콜레스테롤 */
				      ,NVL(MAX(DECODE(A.MDCR_DTLS_CTRL_CD,'LDL',1)),0) AS NMBR_VL_1
				      ,NVL(MAX(DECODE(SUBSTR(A.MDCR_DTLS_CTRL_CD,1,4),'HEMO',1,0)),0) AS NMBR_VL_2
				      /* TO BE 검체코드에 맞게 수정 필요 */
				      /*,NVL(SUM(DECODE(SUBSTR(A.MDCR_DTLS_CTRL_CD, 1, 3),'ALB',DECODE(A.SPCM_CD1,'601',1,'602',1,'604',1,'605',1,'301',1,'302',1))),0),*/
				      ,NVL(MAX(DECODE(SUBSTR(A.MDCR_DTLS_CTRL_CD, 1, 3),'ALB',1,0)),0) AS NMBR_VL_3
				      ,NVL(MAX(DECODE(SUBSTR(A.MDCR_DTLS_CTRL_CD, 1, 3),'EYE',1,0)),0) AS NMBR_VL_4
				      ,NVL(MAX(DECODE(SUBSTR(A.MDCR_DTLS_CTRL_CD, 1, 2),'UR',1,0)),0) AS  NMBR_VL_5
				      ,NVL(MAX(DECODE(A.MDCR_DTLS_CTRL_CD,'투석',1,0)),0) AS NMBR_VL_6
				      ,TO_CHAR(B.OTRS_HSPT_EXIM_YMD,'YYYYMMDD') AS OTRS_HSPT_EXIM_YMD
				  FROM
				        (
				        SELECT A.PTNO
				              ,A.ORDR_CD
				              ,B.INSR_EDI_CD
				              ,C.MDCR_DTLS_CTRL_CD
				              ,C.MDCR_CTRL_CHRC_VL1
				              ,A.SPCM_CD1
				          FROM MDEXMORDT A
				              ,AIMFMDFET B
				              ,MZCTRLMMT C
				              ,(
				                 SELECT  DECODE(#{gvHsptCd}
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_FIRST'),  'AA'  /* 1 - 안암 */
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_SECOND'), 'GR'  /* 2 - 구로 */
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_THIRD'),  'AS'  /* 3 - 안산 */
				                        , 'AA') AS HSPT_ABRV
				                    FROM DUAL
				               )D
				         WHERE 1=1
				           AND (
				                  (D.HSPT_ABRV = 'AA' AND A.ENFR_DT BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND SYSDATE) OR
				                  (D.HSPT_ABRV = 'GR' AND A.ENFR_DT BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND SYSDATE) OR
				                  (D.HSPT_ABRV = 'AS' AND A.BLCL_BRCD_PRIN_DT BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND SYSDATE)
				               )
				           AND A.PTNO = #{ptno}
				           AND A.DC_DVSN_CD    = 'N'                                                                                         /* DC구분코드 */
				           AND A.TMPR_ORDR_YN  = 'N'
				           AND B.MDFE_CD = A.ORDR_CD
				           AND A.ORDR_YMD BETWEEN B.APST_YMD AND B.APFN_YMD
				           AND C.MDCR_CTRL_CD  = 'MDK_0072'
				           AND B.INSR_EDI_CD LIKE  MDCR_CTRL_CHRC_VL1 || '%'
				        UNION ALL
				        SELECT A.PTNO
				              ,A.ORDR_CD
				              ,B.INSR_EDI_CD
				              ,C.MDCR_DTLS_CTRL_CD
				              ,C.MDCR_CTRL_CHRC_VL1
				              ,A.SPCM_CD1
				          FROM MDEXMORDT A
				              ,AIMFMDFET B
				              ,AIMFGROPT G
				              ,MZCTRLMMT C
				              ,(
				                 SELECT  DECODE(#{gvHsptCd}
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_FIRST'),  'AA'  /* 1 - 안암 */
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_SECOND'), 'GR'  /* 2 - 구로 */
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_THIRD'),  'AS'  /* 3 - 안산 */
				                        , 'AA') AS HSPT_ABRV
				                    FROM DUAL
				               )D
				         WHERE 1=1
				           AND (
				                  (D.HSPT_ABRV = 'AA' AND A.ENFR_DT BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND SYSDATE) OR
				                  (D.HSPT_ABRV = 'GR' AND A.ENFR_DT BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND SYSDATE) OR
				                  (D.HSPT_ABRV = 'AS' AND A.BLCL_BRCD_PRIN_DT BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND SYSDATE)
				               )
				           AND A.PTNO = #{ptno}
				           AND A.DC_DVSN_CD    = 'N'                                                                                         /* DC구분코드 */
				           AND A.TMPR_ORDR_YN  = 'N'
				           AND G.GRP_MDFE_CD = A.ORDR_CD
				           AND A.ORDR_YMD BETWEEN G.APST_YMD AND G.APFN_YMD
				           AND B.MDFE_CD = G.MDFE_CD
				           AND A.ORDR_YMD BETWEEN B.APST_YMD AND B.APFN_YMD
				           AND C.MDCR_CTRL_CD  = 'MDK_0072'
				           AND B.INSR_EDI_CD LIKE  MDCR_CTRL_CHRC_VL1 || '%'
				        UNION ALL
				        SELECT A.PTNO
				              ,'투석' ORDR_CD
				              ,'투석' INSR_EDI_CD
				              ,'투석' MDCR_DTLS_CTRL_CD
				              ,'투석' MDCR_CTRL_CHRC_VL1
				              ,''    SPCM_CD1
				          FROM MDTRTORDT A
				         WHERE A.PTNO = #{ptno}
				           AND A.ORDR_YMD BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND TRUNC(SYSDATE)+3
				           AND A.DC_DVSN_CD    = 'N'                                                                                         /* DC구분코드 */
				           AND A.TMPR_ORDR_YN  = 'N'
				           AND A.RCST_CD = 'Y'
				           AND A.ORDR_CD IN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD  = 'MDK_0081')
				        UNION ALL
				        SELECT A.PTNO
				              ,'투석' ORDR_CD
				              ,'투석' INSR_EDI_CD
				              ,'투석' MDCR_DTLS_CTRL_CD
				              ,'투석' MDCR_CTRL_CHRC_VL1
				              ,''    SPCM_CD1
				         FROM MDMEDORDT A
				        WHERE A.PTNO = #{ptno}
				          AND A.ORDR_YMD BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND TRUNC(SYSDATE)+3
				          AND A.DC_DVSN_CD    = 'N'                                                                                         /* DC구분코드 */
				          AND A.TMPR_ORDR_YN  = 'N'
				          AND A.RCST_CD = 'Y'
				          AND A.ORDR_CD IN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD  = 'MDK_0081')
				          AND ROWNUM = 1
				        )A
				        ,APPTADIFT B
				WHERE B.PTNO(+) = A.PTNO
				GROUP BY  B.OTRS_HSPT_EXIM_YMD
				]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNrElrcYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn1" column="YN1"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNrElrcYn () 
        Description :                                           첫번째 간호기록 작성 후 24시간 경과 여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNrElrcYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNrElrcYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNrElrcYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNrElrcYn */
		select case when (a.CURTIME - a.RCRD_DT) * 24 < 18 then 'Y' /* 18시간  이내 */
					when (a.CURTIME - a.RCRD_DT) * 24 >= 18 and (a.CURTIME - a.RCRD_DT) * 24 < 24 then 'P' /* 18시간 ~ 24시간 이내 */
					else 'N'
				end as YN1
		  from (
				select nvl(min(RCRD_DT), to_date('299912312359', 'yyyymmddhh24miss')) as RCRD_DT
					 , sysdate as CURTIME
				  from MNRRECOMT /* 환자간호기록 */
				 where MDRP_NO = #{mdrpNo}
				   and PTNO = #{ptno}
				   and RCRD_DT between to_date(#{mdcrDt}, 'yyyymmddhh24miss') and sysdate
			   ) a
		 where rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnExmOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn2" column="YN2"/>
		<result property="yn3" column="YN3"/>
		<result property="yn4" column="YN4"/>
		<result property="yn5" column="YN5"/>
		<result property="yn6" column="YN6"/>
		<result property="yn7" column="YN7"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnExmOrdrYn () 
        Description :                                           폐렴 적정성 평가 관련 처방 유무
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnExmOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnExmOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnExmOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOnePnmnExmOrdrYn */
		select max(d.YN2) as YN2
		     , max(d.YN3) as YN3
		     , max(d.YN4) as YN4
		     , max(d.YN5) as YN5
		     , max(d.YN6) as YN6
		     , max(d.YN7) as YN7
		  from (
				/* 산소포화도 처치유무(SPO2) */
				select decode(count(1), 1, 'Y', 'N') as YN2
				     , 'N' as YN3
				     , 'N' as YN4
				     , 'N' as YN5
				     , 'N' as YN6
				     , 'N' as YN7
				  from AIMFMDFET a	/* 수가코드 */
				     , MDTRTORDT b	/* 처방료처방 */
				 where a.MDFE_CD = b.ORDR_CD
				   and b.PTNO = #{ptno}
				   and b.ORDR_YMD between to_date(#{mdcrYmd}, 'yyyymmdd') and trunc(sysdate)
		           and b.MDRP_NO = #{mdrpNo}
				   and b.ORFR_CD <> 'P'	/* 처방형태코드 P = PRN */
				   and b.TMPR_ORDR_YN = 'N'
				   and b.DC_DVSN_CD = 'N'
				   and b.ORDR_YMD between a.APST_YMD and a.APFN_YMD
				   and EXISTS (select 1
				                 from MZCTRLMMT c
				                where c.MDCR_CTRL_CD = 'MDP_119'	/* 폐렴 적정성 EDI 코드 */
				                  and c.MDCR_DTLS_CTRL_CD = 'TRT1'	/* 산소포화도 처치유무(SPO2) */
				                  and c.MDCR_CTRL_CHRC_VL1 = a.INSR_EDI_CD
				                  and rownum = 1)
				 union all
				/* 산소포화도 결과입력 유무(SPO2) */
				select 'N' as YN2
				     ,  decode(count(1), 1, 'Y', 'N') as YN3
				     , 'N' as YN4
				     , 'N' as YN5
				     , 'N' as YN6
				     , 'N' as YN7
				  from MECFSDOMT a /* 임상관찰기록 */
				     , MECFSIRMT b /* 임상관찰항목기록 */
				 where a.CNOS_RCRD_NO = b.CNOS_RCRD_NO
				   and a.PTNO = #{ptno}
				   and a.MDRP_NO = #{mdrpNo}
				   and trunc(b.CNOS_ITEM_RCRD_DT) between to_date(#{mdcrYmd}, 'yyyymmdd') and trunc(sysdate)
		           and b.CNOS_ITEM_SNO = 177 /* SpO2 */
		           and b.CRTF_YN = 'Y'
				   and nvl(b.DLTN_YN, 'N') = 'N'
				 union all
				/* 환자 중증도 평가도구 (CURB-65, PSI) */
				select 'N' as YN2
				     , 'N' as YN3
				     , decode(count(1), 1, 'Y', 'N') as YN4
				     , 'N' as YN5
				     , 'N' as YN6
				     , 'N' as YN7
				  from MEDOCMBST a /* 진료기록 */
					 , MEDOCMDTT b /* 진료기록상세 */
				 where a.RCRD_NO = b.RCRD_NO
				   and a.MDRP_NO = #{mdrpNo}
				   and a.PTNO = #{ptno}
		           /* ◆CURB-65 */
				   and b.FORM_NO = DECODE(#{gvHsptCd}
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_FIRST'),  '14401581001'  /* 1 - 안암 */
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_SECOND'), '14401411001'  /* 2 - 구로 */
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_THIRD'),  '14401731001'  /* 3 - 안산 */
				                        , '14401581001')
				   and a.RCRD_SAVE_DVSN_CD = '1'  /* 1.인증  2.미서명 */
				   and nvl(a.DLTN_YN, 'N') = 'N'
				   and nvl(b.DLTN_YN, 'N') = 'N'
				 union all
				/* 객담도말검사 처방유무 */
				select 'N' as YN2
				     , 'N' as YN3
				     , 'N' as YN4
				     , decode(count(1), 1, 'Y', 'N') as YN5
				     , 'N' as YN6
				     , 'N' as YN7
				  from AIMFMDFET a	/* 수가코드 */
				     , MDEXMORDT b	/* 검사처방 */
				 where a.MDFE_CD = b.ORDR_CD
				   and b.PTNO = #{ptno}
				   and b.ORDR_YMD between to_date(#{mdcrYmd}, 'yyyymmdd') and trunc(sysdate)
		           and b.MDRP_NO = #{mdrpNo}
				   and b.ORFR_CD <> 'P'	/* 처방형태코드 P = PRN */
				   and b.TMPR_ORDR_YN = 'N'
				   and b.DC_DVSN_CD = 'N'
				   and b.ORDR_YMD between a.APST_YMD and a.APFN_YMD
				   and EXISTS (select 1
				                 from MZCTRLMMT c
				                where c.MDCR_CTRL_CD = 'MDP_119'	/* 폐렴 적정성 EDI 코드 */
				                  and c.MDCR_DTLS_CTRL_CD in ('EXM1', 'EXM2')	/* 객담도말검사 처방유무 */
				                  and c.MDCR_CTRL_CHRC_VL1 = a.INSR_EDI_CD
				                  and rownum = 1)
				 union all
				/* 객담배양검사 처방유무 */
				select 'N' as YN2
				     , 'N' as YN3
				     , 'N' as YN4
				     , 'N' as YN5
				     , decode(count(1), 1, 'Y', 'N') as YN6
				     , 'N' as YN7
				  from AIMFMDFET a	/* 수가코드 */
				     , MDEXMORDT b	/* 검사처방 */
				 where a.MDFE_CD = b.ORDR_CD
				   and b.PTNO = #{ptno}
				   and b.ORDR_YMD between to_date(#{mdcrYmd}, 'yyyymmdd') and trunc(sysdate)
		           and b.MDRP_NO = #{mdrpNo}
				   and b.ORFR_CD <> 'P'	/* 처방형태코드 P = PRN */
				   and b.TMPR_ORDR_YN = 'N'
				   and b.DC_DVSN_CD = 'N'
				   and b.ORDR_YMD between a.APST_YMD and a.APFN_YMD
				   and EXISTS (select 1
				                 from MZCTRLMMT c
				                where c.MDCR_CTRL_CD = 'MDP_119'	/* 폐렴 적정성 EDI 코드 */
				                  and c.MDCR_DTLS_CTRL_CD in ('EXM3')	/* 객담배양검사 처방유무 */
				                  and c.MDCR_CTRL_CHRC_VL1 = a.INSR_EDI_CD
				                  and rownum = 1)
				 union all
				/* 혈액배양검사 처방유무 */
				select 'N' as YN2
				     , 'N' as YN3
				     , 'N' as YN4
				     , 'N' as YN5
				     , 'N' as YN6
				     , decode(count(1), 1, 'Y', 'N') as YN7
				  from AIMFMDFET a	/* 수가코드 */
				     , MDEXMORDT b	/* 검사처방 */
				 where a.MDFE_CD = b.ORDR_CD
				   and b.PTNO = #{ptno}
				   and b.ORDR_YMD between to_date(#{mdcrYmd}, 'yyyymmdd') and trunc(sysdate)
		           and b.MDRP_NO = #{mdrpNo}
				   and b.ORFR_CD <> 'P'	/* 처방형태코드 P = PRN */
				   and b.TMPR_ORDR_YN = 'N'
				   and b.DC_DVSN_CD = 'N'
				   and b.ORDR_YMD between a.APST_YMD and a.APFN_YMD
				   and EXISTS (select 1
				                 from MZCTRLMMT c
				                where c.MDCR_CTRL_CD = 'MDP_119'	/* 폐렴 적정성 EDI 코드 */
				                  and c.MDCR_DTLS_CTRL_CD in ('EXM4', 'EXM5')	/* 객담배양검사 처방유무 */
				                  and c.MDCR_CTRL_CHRC_VL1 = a.INSR_EDI_CD
				                  and rownum = 1)
		       ) d
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnDiagYn () 
        Description :                                           환자가 폐암 진단이 있는지 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnDiagYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnDiagYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from MDPACLNCT a	/* 환자임상진단내역 */
		     , MDPADIAGT b	/* 환자상병내역 */
		 where a.MDRP_NO = #{mdrpNo}
		   and a.MDRP_NO = b.MDRP_NO
		   and a.PTNT_CLNC_DX_SNO = b.PTNT_CLNC_DX_SNO
		   and NVL(a.RUL_OUT_YN,'N') = 'N'
		   and (EXISTS ( select 1
		                   from MZCTRLMMT c
		                  where c.MDCR_CTRL_CD = 'MDP_142'	/* 폐암 진단 상병코드 */
		                    and c.MDCR_DTLS_CTRL_CD = SUBSTR(b.SCIN_CD, 1, 3))
		                    and rownum = 1
		            )
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnExmOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnExmOrdrYn () 
        Description :                                           수술일 이후 검사 실시 및 결과 나온 환자, TNM 입력 여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnExmOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnExmOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnExmOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneLncnExmOrdrYn */
		select decode(count(1), 1, 'Y', 'N') AS YN
		  from SZRESULMT a	/* 통합검사결과 */
			 , MDEXMORDT b	/* 검사처방 */
			 , MDOPSCHET d	/* 수술스케줄 */
		 where a.PTNO = #{ptno}
		   and a.RPRT_DT between to_date(#{ordrYmd},'yyyymmdd') - 31
		   and to_date(#{ordrYmd},'yyyymmdd') + 0.99999
		   and a.EXMN_PRSS_CD = 'G'
		   and a.PTNO = b.PTNO
		   and a.ORDR_YMD = b.ORDR_YMD
		   and a.ORDR_SNO = b.ORDR_SNO
		   and b.ORDR_CD in (select MDCR_DTLS_CTRL_CD
							   from MZCTRLMMT
							  where MDCR_CTRL_CD = 'MDP_143')
		   and b.DC_DVSN_CD = 'N'
		   and b.TMPR_ORDR_YN = 'N'
		   and b.SPCM_CD1 in ('P36')  /* 검체 = P36 : Lung */
		   and b.MCDP_CD = #{mcdpCd}
		   and b.PTNO = d.PTNO
		   and d.OPRT_YMD <= trunc(b.ENFR_DT)
		   and d.CODV_CD <> 'D'
		   and d.CNCL_YN = 'N'
		   and not exists (select 1
							 from MDPEDCANT	/* 산정특례중증이력환자 */
							where PTNO = b.PTNO
							  and MDRP_NO = b.MDRP_NO
							  and a.RPRT_DT between FRST_RGST_YMD and FNSH_YMD
							  and (CANC_CLST_BNUN_YN is not null or	/* 암병기미상여부 */
								   CANC_STEP_CLSF_CD is not null or	/* 암단계분류코드 */
								   TNM_CLSF_T_CD     is not null	/* TNM분류T코드 */
								  )
							  and rownum = 1
						   )
		   and exists (select 1
						 from MDTRTORDT	/* 처방료처방 */
						where PTNO = b.PTNO
						  and ORDR_YMD between trunc(a.RPRT_DT) - 31 and trunc(a.RPRT_DT)
						  and ORDR_CD in (select MDCR_DTLS_CTRL_CD
											from MZCTRLMMT
										   where MDCR_CTRL_CD = 'MDP_144')
						  and DC_DVSN_CD = 'N'
						  and TMPR_ORDR_YN = 'N'
						  and RCST_CD = 'Y'
		                  and rownum = 1
					   )
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDiabetOrder-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="mdcrDtlsCtrlCd" column="MDCR_DTLS_CTRL_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDiabetOrder () 
        Description :                                           당뇨병 적정성 평가 관련 처방코드 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDiabetOrder-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDiabetOrder"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDiabetOrder-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listDiabetOrder */
		<![CDATA[
		SELECT DISTINCT A.MDCR_DTLS_CTRL_CD
		      ,A.MDFE_CD as ORDR_CD
		  FROM
		    (
		    SELECT B.MDFE_CD
		          ,B.INSR_EDI_CD
		          ,C.MDCR_DTLS_CTRL_CD
		          ,C.MDCR_CTRL_CHRC_VL1
		      FROM AIMFMDFET B
		          ,MZCTRLMMT C
		     WHERE 1=1
		       AND TO_DATE(#{ordrYmd},'YYYYMMDD') BETWEEN B.APST_YMD AND B.APFN_YMD
		       AND C.MDCR_CTRL_CD = 'MDK_0072'
		       AND B.INSR_EDI_CD LIKE MDCR_CTRL_CHRC_VL1 || '%'
		     UNION ALL
		    SELECT G.GRP_MDFE_CD
		          ,B.INSR_EDI_CD
		          ,C.MDCR_DTLS_CTRL_CD
		          ,C.MDCR_CTRL_CHRC_VL1
		      FROM AIMFMDFET B
		          ,AIMFGROPT G
		          ,MZCTRLMMT C
		     WHERE 1=1
		       AND TO_DATE(#{ordrYmd},'YYYYMMDD') BETWEEN G.APST_YMD AND G.APFN_YMD
		       AND B.MDFE_CD = G.MDFE_CD
		       AND TO_DATE(#{ordrYmd},'YYYYMMDD') BETWEEN B.APST_YMD AND B.APFN_YMD
		       AND C.MDCR_CTRL_CD = 'MDK_0072'
		       AND B.INSR_EDI_CD LIKE MDCR_CTRL_CHRC_VL1 || '%'
		    )A
		ORDER BY 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetHistOrdr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="blodExmnCd" column="BLOD_EXMN_CD"/>
		<result property="nmbrVl1" column="NMBR_VL_1"/>
		<result property="nmbrVl2" column="NMBR_VL_2"/>
		<result property="nmbrVl3" column="NMBR_VL_3"/>
		<result property="nmbrVl4" column="NMBR_VL_4"/>
		<result property="nmbrVl5" column="NMBR_VL_5"/>
		<result property="nmbrVl6" column="NMBR_VL_6"/>
		<result property="otrsHsptEximYmd" column="OTRS_HSPT_EXIM_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetHistOrdr () 
        Description :                                           당뇨적정성 평가 기준일 기간 처방 유무 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetHistOrdr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetHistOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetHistOrdr-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCheckDiabetHistOrdr */
		<![CDATA[
				SELECT
				       /* 지질검사 3항목 모두 시행 */
				       DECODE(NVL(SUM(DECODE(A.MDCR_DTLS_CTRL_CD,'CHOL',1)),0),0,'N','Y') ||	/* 총콜레스테롤 	*/
				       DECODE(NVL(SUM(DECODE(A.MDCR_DTLS_CTRL_CD,'HDL' ,1)),0),0,'N','Y') ||	/* HDL 콜레스테롤 	*/
				       DECODE(NVL(SUM(DECODE(A.MDCR_DTLS_CTRL_CD,'TRIG',1)),0),0,'N','Y') AS BLOD_EXMN_CD	/* 트리글리세라이드	*/
				      /* 지질검사 : LDL 콜레스테롤 */
				      ,NVL(MAX(DECODE(A.MDCR_DTLS_CTRL_CD,'LDL',1)),0) AS NMBR_VL_1
				      ,NVL(MAX(DECODE(SUBSTR(A.MDCR_DTLS_CTRL_CD,1,4),'HEMO',1,0)),0) AS NMBR_VL_2
				      /* TO BE 검체코드에 맞게 수정 필요 */
				      /*,NVL(SUM(DECODE(SUBSTR(A.MDCR_DTLS_CTRL_CD, 1, 3),'ALB',DECODE(A.SPCM_CD1,'601',1,'602',1,'604',1,'605',1,'301',1,'302',1))),0),*/
		              /* 미량알부민검사 : 검체urine 내분비내과는 BG2200Z 처방 시, 처방은 가능 POP-UP은 계속띄움
		               	nvl(sum(decode(substr(i.EDIGB, 1, 3),'ALB',decode(i.SPCCODE1,'601',1,'602',1,'604',1,'605',1,'301',1,'302',1))),0) +
		               	decode(:sType4,'EC',nvl(sum(decode(i.ORDCD,'BG2200Z',decode(i.SPCCODE1,'601',1,'602',1,'604',1,'605',1,'301',1,'302',1))),0),0),
		              */
				      ,NVL(MAX(DECODE(SUBSTR(A.MDCR_DTLS_CTRL_CD, 1, 3),'ALB',1,0)),0) AS NMBR_VL_3
				      ,NVL(MAX(DECODE(SUBSTR(A.MDCR_DTLS_CTRL_CD, 1, 3),'EYE',1,0)),0) AS NMBR_VL_4
				      ,NVL(MAX(DECODE(SUBSTR(A.MDCR_DTLS_CTRL_CD, 1, 2),'UR',1,0)),0) AS  NMBR_VL_5
				      ,NVL(MAX(DECODE(A.MDCR_DTLS_CTRL_CD,'투석',1,0)),0) AS NMBR_VL_6
				      ,TO_CHAR(B.OTRS_HSPT_EXIM_YMD,'YYYYMMDD') AS OTRS_HSPT_EXIM_YMD
				  FROM
				        (
				        SELECT A.PTNO
				              ,A.ORDR_CD
				              ,B.INSR_EDI_CD
				              ,C.MDCR_DTLS_CTRL_CD
				              ,C.MDCR_CTRL_CHRC_VL1
				              ,A.SPCM_CD1
				          FROM MDEXMORDT A
				              ,AIMFMDFET B
				              ,MZCTRLMMT C
				              ,(
				                 SELECT  DECODE(#{gvHsptCd}
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_FIRST'),  'AA'  /* 1 - 안암 */
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_SECOND'), 'GR'  /* 2 - 구로 */
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_THIRD'),  'AS'  /* 3 - 안산 */
				                        , 'AA') AS HSPT_ABRV
				                    FROM DUAL
				               )D
				         WHERE 1=1
				           AND A.ORDR_YMD BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND trunc(SYSDATE)
				           AND A.PTNO = #{ptno}
				           AND A.DC_DVSN_CD    = 'N'
				           AND A.TMPR_ORDR_YN  = 'N'
				           AND B.MDFE_CD = A.ORDR_CD
				           AND A.ORDR_YMD BETWEEN B.APST_YMD AND B.APFN_YMD
				           AND C.MDCR_CTRL_CD  = 'MDK_0072'
				           AND B.INSR_EDI_CD LIKE  MDCR_CTRL_CHRC_VL1 || '%'
				        UNION ALL
				        SELECT A.PTNO
				              ,A.ORDR_CD
				              ,B.INSR_EDI_CD
				              ,C.MDCR_DTLS_CTRL_CD
				              ,C.MDCR_CTRL_CHRC_VL1
				              ,A.SPCM_CD1
				          FROM MDEXMORDT A
				              ,AIMFMDFET B
				              ,AIMFGROPT G
				              ,MZCTRLMMT C
				              ,(
				                 SELECT  DECODE(#{gvHsptCd}
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_FIRST'),  'AA'  /* 1 - 안암 */
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_SECOND'), 'GR'  /* 2 - 구로 */
				                        , FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_THIRD'),  'AS'  /* 3 - 안산 */
				                        , 'AA') AS HSPT_ABRV
				                    FROM DUAL
				               )D
				         WHERE 1=1
				           AND A.ORDR_YMD BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND trunc(SYSDATE)
				           AND A.PTNO = #{ptno}
				           AND A.DC_DVSN_CD    = 'N'
				           AND A.TMPR_ORDR_YN  = 'N'
				           AND G.GRP_MDFE_CD = A.ORDR_CD
				           AND A.ORDR_YMD BETWEEN G.APST_YMD AND G.APFN_YMD
				           AND B.MDFE_CD = G.MDFE_CD
				           AND A.ORDR_YMD BETWEEN B.APST_YMD AND B.APFN_YMD
				           AND C.MDCR_CTRL_CD  = 'MDK_0072'
				           AND B.INSR_EDI_CD LIKE  MDCR_CTRL_CHRC_VL1 || '%'
				        UNION ALL
				        SELECT A.PTNO
				              ,'투석' ORDR_CD
				              ,'투석' INSR_EDI_CD
				              ,'투석' MDCR_DTLS_CTRL_CD
				              ,'투석' MDCR_CTRL_CHRC_VL1
				              ,''    SPCM_CD1
				          FROM MDTRTORDT A
				         WHERE A.PTNO = #{ptno}
				           AND A.ORDR_YMD BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND TRUNC(SYSDATE)+3
				           AND A.DC_DVSN_CD    = 'N'
				           AND A.TMPR_ORDR_YN  = 'N'
				           AND A.RCST_CD = 'Y'
				           AND A.ORDR_CD IN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD  = 'MDK_0081')
				        UNION ALL
				        SELECT A.PTNO
				              ,'투석' ORDR_CD
				              ,'투석' INSR_EDI_CD
				              ,'투석' MDCR_DTLS_CTRL_CD
				              ,'투석' MDCR_CTRL_CHRC_VL1
				              ,''    SPCM_CD1
				         FROM MDMEDORDT A
				        WHERE A.PTNO = #{ptno}
				          AND A.ORDR_YMD BETWEEN TO_DATE(#{strtYmd},'YYYYMMDD') AND TRUNC(SYSDATE)+3
				          AND A.DC_DVSN_CD    = 'N'
				          AND A.TMPR_ORDR_YN  = 'N'
				          AND A.RCST_CD = 'Y'
				          AND A.ORDR_CD IN (SELECT MDCR_DTLS_CTRL_CD FROM MZCTRLMMT WHERE MDCR_CTRL_CD  = 'MDK_0081')
				          AND ROWNUM = 1
				        )A
				        ,APPTADIFT B
				WHERE B.PTNO(+) = A.PTNO
				GROUP BY  B.OTRS_HSPT_EXIM_YMD
				]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHolySunYmd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="hldyYmd" column="HLDY_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHolySunYmd () 
        Description :                                           처방일자가 공휴일 여부 체크 (일요일 포함)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHolySunYmd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHolySunYmd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHolySunYmd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneHolySunYmd */
		SELECT to_char(HLDY_YMD,'yyyymmdd') as HLDY_YMD
		  FROM  APDSPBHLT
		 WHERE  HLDY_YMD =  TO_DATE(#{ordrYmd}, 'YYYYMMDD')
		UNION
		/* 일요일 추가 */
		SELECT #{ordrYmd}  AS HLDY_YMD
		  FROM DUAL
		WHERE TO_CHAR(TO_DATE(#{ordrYmd},'YYYYMMDD'),'d') = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnExmOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn1" column="YN1"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnExmOrdrYn () 
        Description :                                           수술일 이후 검사 실시 및 결과 나온 환자, TNM 입력 여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnExmOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnExmOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnExmOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneCccnExmOrdrYn */
		select decode(count(1), 1, 'Y', 'N') AS YN1
		  from SZRESULMT a	/* 통합검사결과 */
			 , MDEXMORDT b	/* 검사처방 */
			 , MDOPSCHET d	/* 수술스케줄 */
		 where a.PTNO = #{ptno}
		   and a.RPRT_DT between to_date(#{ordrYmd},'yyyymmdd') - 31
		   and to_date(#{ordrYmd},'yyyymmdd') + 0.99999
		   and a.EXMN_PRSS_CD = 'G'
		   and a.PTNO = b.PTNO
		   and a.ORDR_YMD = b.ORDR_YMD
		   and a.ORDR_SNO = b.ORDR_SNO
		   and b.ORDR_CD in (select MDCR_DTLS_CTRL_CD
							   from MZCTRLMMT
							  where MDCR_CTRL_CD = 'MDP_113')
		   and b.DC_DVSN_CD = 'N'
		   and b.TMPR_ORDR_YN = 'N'
		   and b.SPCM_CD1 in ('P33')  /* 검체 = P33 : Large intestine, 직장 추가 해야함 */
		   and b.MCDP_CD = #{mcdpCd}
		   and b.PTNO = d.PTNO
		   and d.OPRT_YMD <= trunc(b.ENFR_DT)
		   and d.CODV_CD <> 'D'
		   and d.CNCL_YN = 'N'
		   and not exists (select 1
							 from MDPEDCANT	/* 산정특례중증이력환자 */
							where PTNO = b.PTNO
							  and MDRP_NO = b.MDRP_NO
							  and a.RPRT_DT between FRST_RGST_YMD and FNSH_YMD
		                      and CODV_CD = 'I'
							  and (CANC_CLST_BNUN_YN is not null or	/* 암병기미상여부 */
								   CANC_STEP_CLSF_CD is not null or	/* 암단계분류코드 */
								   TNM_CLSF_T_CD     is not null	/* TNM분류T코드 */
								  )
							  and rownum = 1
						   )
		   and exists (select 1
						 from MDTRTORDT	/* 처방료처방 */
						where PTNO = b.PTNO
						  and ORDR_YMD between trunc(a.RPRT_DT) - 31 and trunc(a.RPRT_DT)
						  and ORDR_CD in (select MDCR_DTLS_CTRL_CD
											from MZCTRLMMT
										   where MDCR_CTRL_CD = 'MDP_114')
						  and DC_DVSN_CD = 'N'
						  and TMPR_ORDR_YN = 'N'
						  and RCST_CD = 'Y'
		                  and rownum = 1
					   )
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMvinElpsRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="apstYmd" column="APST_YMD"/>
		<result property="apfnYmd" column="APFN_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="befDprtCd" column="BEF_DPRT_CD"/>
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
		<result property="yn1" column="YN_1"/>
		<result property="yn2" column="YN_2"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMvinElpsRcrdWrtgYn (전입 경과 기록 작성 여부 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMvinElpsRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMvinElpsRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMvinElpsRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listMvinElpsRcrdWrtgYn */
		       y.PTNO                                                          as PTNO         /* 환자번호 */
		      ,y.MDRP_NO                                                       as MDRP_NO      /* 진료접수번호 */
		      ,to_char(y.APST_YMD, 'YYYYMMDD')                                 as APST_YMD     /* 시작일시 */
		      ,to_char(y.APFN_YMD, 'YYYYMMDD')                                 as APFN_YMD     /* 종료일시 */
		      ,y.MCDP_CD                                                       as MCDP_CD      /* 현재부서 */
		      ,y.BEF_MCDP_CD                                                   as BEF_DPRT_CD  /* 전부서   */
		      ,to_char(y.FRST_RGST_DT,'yyyymmddhh24mi')                        as FRST_RGST_DT /* 전과승인일시 */
		      ,CASE WHEN y.BEF_MCDP_CD is null
		                then 'Y'
		            WHEN (y.APST_YMD = trunc(z.RCRD_DT))
		                 and (y.MCDP_CD <> y.BEF_MCDP_CD)
		                then 'Y'
		            WHEN y.MCDP_CD = y.BEF_MCDP_CD
				        then 'Y'
		            else 'N' end                                               as YN_1           /* 전입 경과기록 작성여부 */
		      , case when sysdate > (y.FRST_RGST_DT + 1) then 'Y' else 'N' end as YN_2           /* 24이내 해당여부 */
		  from (
		        select x.PTNO
		              ,x.MDRP_NO
		              ,to_char(x.ADMS_DT , 'YYYYMMDDHH24MISS') as ADMS_DT
		              ,x.APST_YMD                              as APST_YMD
		              ,x.APFN_YMD                              as APFN_YMD
		              ,x.MCDP_CD                               as MCDP_CD
		              ,x.AFI_ABRV_MCDP_CD                      as AFI_ABRV_MCDP_CD
		              ,y.MCDP_CD                               as BEF_MCDP_CD
		              ,to_char(y.APST_YMD, 'YYYYMMDD')         as BEF_APST_YMD
		              ,x.FRST_RGST_DT
		          from (
		                select
		                        a.PTNO                                                            as PTNO              -- 환자번호
		                     ,  a.MDRP_NO                                                         as MDRP_NO           -- 진료접수번호
		                     ,  a.ADMS_DT                                                         as ADMS_DT           -- 입원일시
		                     ,  a.APST_YMD                                                        as APST_YMD          -- 적용시작일자
		                     ,  case when to_char(a.APFN_YMD, 'YYYYMMDD') = '29991231'
		                                then null
		                             else a.APFN_YMD
		                        end                                                               as APFN_YMD          -- 적용종료일자
		                     ,  a.MCDP_CD                                                         as MCDP_CD           -- 진료과코드
		                     ,  ( select F_A.ABRV_DPRT_CD
		                            from HZDEPTMMT F_A
		                           where F_A.DPRT_CD = a.MCDP_CD
		                           group by F_A.ABRV_DPRT_CD )                                    as AFI_ABRV_MCDP_CD  -- 약어부서코드
		                     ,  (select max(y.APST_YMD)
		                           from APRCDTRTT y
		                          where y.PTNO     = a.PTNO
		                            and y.MDRP_NO  = a.MDRP_NO
		                            and y.APST_YMD < a.APST_YMD)                                  as BEF_APST_YMD
		                     ,  a.FRST_RGST_DT                                                    as FRST_RGST_DT
		                     , row_number() over(partition by a.MDRP_NO order by a.APST_YMD desc) as SEQ
		                  from
		                        APRCDTRTT a
		                 where  a.PTNO        = #{ptno}
		                   and  a.MDRP_NO     = #{mdrpNo}
		                ) x
		                ,APRCDTRTT y
		         where x.MDRP_NO      = y.MDRP_NO(+)
		           and x.PTNO         = y.PTNO(+)
		           and x.BEF_APST_YMD = y.APST_YMD(+)
		           and x.SEQ          = 1
		       ) y
		      ,MEDOCMBST z
		 where y.MDRP_NO    = z.MDRP_NO(+)
		   and y.PTNO       = z.PTNO(+)
		   and z.RCKI_CD(+) = FN_CC_GET_CNST_VL('MED_002', 'S_MVIN_RCRD')
		   and nvl(z.DLTN_YN, 'N') = 'N'
		   and y.APST_YMD = trunc(z.RCRD_DT(+))
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetes2DiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="scinCd" column="SCIN_CD"/>
		<result property="scinNm" column="SCIN_NM"/>
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetes2DiagYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetes2DiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetes2DiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetes2DiagYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDiabetes2DiagYn */
		<![CDATA[
		SELECT MAX(A.SCIN_CD) AS SCIN_CD
		      ,MAX(A.SCIN_NM) AS SCIN_NM
		      ,NVL(MAX(A.YN),'N') AS YN
		  FROM
		    (
		    SELECT
		            A.SCIN_CD
		           ,A.SCIN_NM
		           ,'Y' AS YN
		     FROM  MDPADIAGT  A
		         , MDPACLNCT  B
		    WHERE  1=1
		      AND  A.MDRP_NO            =  #{mdrpNo}
		      AND  A.MCDP_CD            =  #{mcdpCd}
		      AND  B.PTNO          	    =  A.PTNO
		      AND  B.MDRP_NO            =  A.MDRP_NO
		      AND  B.PTNT_CLNC_DX_SNO 	=  A.PTNT_CLNC_DX_SNO
		      AND  NVL(B.RUL_OUT_YN,'N')         <> 'Y'
		      AND  EXISTS ( SELECT 1
		                        FROM MZCTRLMMT C
		                       WHERE C.MDCR_CTRL_CD = #{mdcrCtrlCd}
		                         AND C.MDCR_DTLS_CTRL_CD = SUBSTR(A.SCIN_CD,1, 3)
		                         AND TRUNC(SYSDATE) BETWEEN C.APST_YMD AND C.APFN_YMD
		                       )
		       ORDER BY A.MAIN_SCIN_YN DESC
		    ) A
		 WHERE ROWNUM = 1
		 ]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSpczDrlcNo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="userNm" column="USER_NM"/>
		<result property="userLcnsNo" column="USER_LCNS_NO"/>
		<result property="userSpczDrlcNo" column="USER_SPCZ_DRLC_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSpczDrlcNo () 
        Description :                                           사용자의 면허번호 및 전문의 면헌번호 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSpczDrlcNo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSpczDrlcNo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSpczDrlcNo-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSpczDrlcNo */
		SELECT B.USER_NM
		      ,A.USER_LCNS_NO
		      ,A.USER_SPCZ_DRLC_NO
		  FROM CCUSERAMT A
		      ,CCUSRDPHT B
		 WHERE A.LGIN_ID = #{userId}
		   AND B.USER_ID = A.LGIN_ID
		   AND ROWNUM = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApCrttVrsnId-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="crttVrsnId" column="CRTT_VRSN_ID"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApCrttVrsnId () 
        Description :                                           제증명서 ID 의 가장 최근 제증명서 버전 ID
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApCrttVrsnId-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApCrttVrsnId"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApCrttVrsnId-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApCrttVrsnId */
		SELECT  A.CRTT_VRSN_ID
		  FROM  APVCCRTTT A
		 WHERE  1=1
		   AND  A.CRTT_ID = #{crttId}
		   AND  TRUNC(SYSDATE)  BETWEEN A.APST_YMD AND A.APFN_YMD
		   AND  A.HGRN_CRTT_ID       IS NULL
		   AND  A.DSPL_YN  = 'Y'
		   AND  ROWNUM  = 1
		 ORDER BY A.CRTT_VRSN_ID DESC
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsPtntMcdpClbyOprtRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="oprtYmd" column="OPRT_YMD"/>
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsPtntMcdpClbyOprtRcrdWrtgYn (입원 환자 진료과(처방과)별 수술 기록 작성 여부 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsPtntMcdpClbyOprtRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsPtntMcdpClbyOprtRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsPtntMcdpClbyOprtRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		SELECT /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listAdmsPtntMcdpClbyOprtRcrdWrtgYn */
		        a.PTNO                         as PTNO
		       ,to_char(a.OPRT_YMD,'yyyymmdd') as OPRT_YMD
			   ,decode(a.OPST_DT, null, 'Y', decode(c.PTNO,NULL,'N','Y'))  as YN   -- 수술기록 작성 및 인증 여부 체크
		  FROM MDOPSCCBV a
		      ,APRCRPTNT b
		      ,MEDOCMBST c
		 WHERE
		       a.PTNO    = #{ptno}
		   AND a.MDRP_NO = #{mdrpNo}
		   AND a.OPRT_STTS_CD not in ('1','9', '5')
		   AND a.CNCL_YMD     is null
		   AND nvl(a.RCVY_ROM_ENRM_DT, a.OPRM_CHOT_DT) is not null
		   AND a.CSCR_CD NOT IN (select MR_DTLS_CTRL_CD					/* 미비 제외 수술코드 제외추가 2023.04.25 */
								   from MRCTRLMMT
								  where MR_cTRL_CD in ('MRI_037'))
		]]>
		 <if test='mcdpCd != null and mcdpCd != ""'>
		   AND a.ORDP_CD         = #{mcdpCd}
		   AND a.ORDP_CD         = c.ORGL_BLNG_MCDP_CD (+)				/* 수술과에서 작성한 수술기록지 여부를 체크하도록 추가 2023.04.25 */
		 </if>
		<![CDATA[
		   AND a.MDRP_NO         = b.MDRP_NO
		   AND b.CODV_CD        <> 'D'
		   AND b.CNCL_DT      is null
		   AND a.MDRP_NO         = c.MDRP_NO(+)
		   AND a.PTNO            = c.PTNO(+)
		   AND a.OPRT_YMD        = c.RCRD_DT(+)
		   AND a.OPRT_SNO        = c.BHVR_SNO(+)
		   AND c.DLTN_YN(+)      = 'N'
		   AND c.RCKI_CD(+)      = FN_CC_GET_CNST_VL('MED_002', 'S_OPRT_RCRD')
		--   AND nvl(c.CRTF_YN(+),'N') = 'Y'
		 GROUP BY a.PTNO, a.OPRT_YMD, a.ORDP_CD, c.PTNO , decode(a.OPST_DT, null, 'Y', decode(c.PTNO,NULL,'N','Y'))
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutCrinScinExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutCrinScinExstYn () 
        Description :                                           환자가 급성기 뇌졸중 진단이 있는지 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutCrinScinExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutCrinScinExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutCrinScinExstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutCrinScinExstYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from MDPACLNCT a	/* 환자임상진단내역 */
		     , MDPADIAGT b	/* 환자상병내역 */
		 where a.MDRP_NO = #{mdrpNo}
		   and a.MDRP_NO = b.MDRP_NO
		   and a.PTNT_CLNC_DX_SNO = b.PTNT_CLNC_DX_SNO
		   and NVL(a.RUL_OUT_YN,'N') = 'N'
		   and (EXISTS ( select 1
		                   from MZCTRLMMT c
		                  where c.MDCR_CTRL_CD = 'MDP_101'	/* 급성기 뇌졸증 상병코드 */
		                    and c.MDCR_DTLS_CTRL_CD = SUBSTR(b.SCIN_CD, 1, 3))
		                    and rownum = 1
		            )
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNnorResnYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNnorResnYn () 
        Description :                                           입원기간중 미처방사유 입력 여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNnorResnYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNnorResnYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNnorResnYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNnorResnYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from MDBASORDT a /* 기본처방 */
		 where a.PTNO = #{ptno}
		   and a.ORDR_YMD between to_date(#{mdcrYmd}, 'YYYYMMDD') and to_date(#{ordrYmd}, 'YYYYMMDD')
		   and a.MDRP_NO = #{mdrpNo}
		   and a.CODV_CD = 'I'
		   and a.ODKI_CD = 'D' /* 처방종류코드 : D 퇴원처방 */
		   and a.ORDR_CD = FN_CC_GET_CNST_VL('CCD_002', 'ATDG_NNOR_RESN_CD') /* 경구 항혈전제 미처방사유 기본처방코드 */
		   and a.DC_DVSN_CD = 'N'
		   and a.TMPR_ORDR_YN = 'N'
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutDschOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutDschOrdrYn () 
        Description :                                           입원기간중 퇴원 처방 항혈전(응고)제 경구 기처방 여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutDschOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutDschOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutDschOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAcutDschOrdrYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from MDMEDORDT a /* 약처방 */
		     , AIMFMDFET b /* 수가코드 */
		 where b.MDFE_CD = a.ORDR_CD
		   and a.ORDR_YMD between b.APST_YMD and b.APFN_YMD
		   and (exists ( select 1
		                   from MZCTRLMMT c
		                  where c.MDCR_CTRL_CD = 'MDP_136'	/* 항혈전(응고)제 경구 EDI코드 */
		                    and c.MDCR_DTLS_CTRL_CD = b.INSR_EDI_CD
		                    and rownum = 1)
		       )
		   and a.PTNO = #{ptno}
		   and a.ORDR_YMD between to_date(#{mdcrYmd}, 'YYYYMMDD') and to_date(#{ordrYmd}, 'YYYYMMDD')
		   and a.MDRP_NO = #{mdrpNo}
		   and a.CODV_CD = 'I'
		   and a.ODKI_CD = 'D' /* 처방종류코드 : D 퇴원처방 */
		   and a.DC_DVSN_CD = 'N'
		   and a.TMPR_ORDR_YN = 'N'
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApacheInfo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="icuEnrmDt" column="ICU_ENRM_DT"/>
		<result property="tmprSaveFlagCd" column="TMPR_SAVE_FLAG_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApacheInfo () 
        Description :                                           중환자실 중증도 작성여부 및 가장최근 입실일 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApacheInfo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApacheInfo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApacheInfo-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneApacheInfo */
		SELECT A.ICU_ENRM_DT
		      ,A.TMPR_SAVE_FLAG_CD
		  FROM
		    (
		    SELECT TO_CHAR(NVL(C.ICU_ENRM_DT,B.ENRM_DT),'YYYYMMDD') AS ICU_ENRM_DT
		          ,C.TMPR_SAVE_FLAG_CD
		      FROM APRCRPTNT A
		          ,MNWICUPAT B
		          ,MDAPACHDT C
		    WHERE A.MDRP_NO = #{mdrpNo}
		      AND B.MDRP_NO = A.MDRP_NO
		      AND C.PTNO(+) = A.PTNO
		      AND C.ADMS_YMD(+) = A.MDCR_YMD
		      ORDER BY 1 DESC, nvl(C.TMPR_SAVE_FLAG_CD,'0') desc
		      )A
		WHERE ROWNUM = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsOrdrYn () 
        Description :                                           응급실 인공호흡처방 여부확인
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsOrdrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsOrdrYn */
		select decode(count(1), 1, 'Y', 'N') as YN
		  from MDBASORDT	/* 기본처방 */
		 where PTNO = #{ptno}
		   and ORDR_YMD between to_date(#{mdcrYmd}, 'yyyymmdd') and to_date(#{ordrYmd}, 'yyyymmdd')
		   and MDRP_NO = #{mdrpNo}
		   and ORDR_CD = FN_CC_GET_CNST_VL('CCD_002', 'ARRS_BSIS_ORDR_CD') /* 응급실 인공호흡처방 */
		   and DC_DVSN_CD = 'N'
		   and TMPR_ORDR_YN = 'N'
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsTxorYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn1" column="YN1"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsTxorYn () 
        Description :                                           응급실 인공호흡처방 여부확인
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsTxorYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsTxorYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsTxorYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneArrsTxorYn */
		select decode(count(1), 1, 'Y', 'N') as YN1
		  from MDTRTORDT	/* 처방료처방 */
		 where PTNO = #{ptno}
		   and ORDR_YMD between to_date(#{mdcrYmd}, 'yyyymmdd') and to_date(#{ordrYmd}, 'yyyymmdd')
		   and MDRP_NO = #{mdrpNo}
		   and ORDR_CD = FN_CC_GET_CNST_VL('CCD_002', 'ARRS_TX_ORDR_CD') /* 응급실 인공호흡 처치료처방 */
		   and DC_DVSN_CD = 'N'
		   and TMPR_ORDR_YN = 'N'
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAntpSthsDdcn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="antpSthsDdcn" column="ANTP_STHS_DDCN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAntpSthsDdcn () 
        Description :                                           입원예약의 예상재원일수를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAntpSthsDdcn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAntpSthsDdcn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAntpSthsDdcn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneAntpSthsDdcn */
		select case when b.AMDV_CD = 'B'
						and a.WARD_CD = FN_CC_GET_CNST_VL('CCD_001', 'WARD_121W')
						and a.PTRM_NO in ('09','10')
						and a.MDCR_YMD >= to_date('20160701', 'yyyymmdd')
		            then (case when b.ANTP_STHS_DDCN = 2
		            				and trunc(nvl(a.DSCH_DT, sysdate) - a.MDCR_DT + 1) > 2 then null
		                       else b.ANTP_STHS_DDCN
		                   end)
		            when b.AMDV_CD = '방사선치료(RT)'
		            then (case when b.ANTP_STHS_DDCN = 2
		            				and trunc(nvl(a.DSCH_DT, sysdate) - a.MDCR_DT + 1) > 2 then null
		                       else b.ANTP_STHS_DDCN
		                   end)
		            else null
		        end as ANTP_STHS_DDCN
		  from APRCRPTNT a  /* 진료접수 */
		     , APRCAMAPT b	/* 입원예약 */
		 where a.ADMS_APNT_NO = b.ADMS_APNT_NO	/* 입원예약번호 */
		   and a.MDRP_NO = #{mdrpNo}
		   and a.CNCL_DT is null
		   and b.CNCL_DT is null
		   and b.AMDV_CD = 'B'	/* 입원구분코드 (B : 항암치료실) */
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listElrcRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listElrcRcrdWrtgYn () 
        Description :                                           경과 기록 작성 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listElrcRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listElrcRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listElrcRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listElrcRcrdWrtgYn */
		select decode(count(case when #{gvHsptCd} = FN_CC_GET_CNST_VL('MED_001', 'HSPT_CD_THIRD') /* 안산 */
						 		 then case when nvl(a.MCDP_CD, '*') = 'GS'
						 				   then case when nvl(a.KIND_CD,'1') = '7' and nvl(a.DPRT_CD, '*') = 'GS'
						 					  	     then a.PTNO
						 							 else case when nvl(a.KIND_CD,'1') <> '7'
						 							           then a.PTNO
						 									   else null
						 							  	   end
						 						end
										  else case when nvl(a.KIND_CD,'1') <> '7'
										  	        then a.PTNO
										  	        else null
										  	    end
								      end
								else
									/*구로 의료정보팀 Staff progress note 작성 시, 경과기록 처방제한과 동일하게 적용되도록 요청 */
		                            case when
		                            exists (
		                                select
		                                    a.MDCR_CTRL_CD
		                                    from MZCTRLMMT a
		                                    where
		                                    1=1
		                                    and MDCR_CTRL_CD = 'MDK_0183'
		                                    and MDCR_DTLS_CTRL_CD = 'Y'
		                            )
		                            then a.PTNO
		                            else
		                                case when nvl(a.KIND_CD,'1') <> '7' then a.PTNO else null end
		                            end
							end), 0, 'N', 'Y') as YN
		  from (
				select PTNO
					 , case when nvl(RCKI_CD, '*') = FN_CC_GET_CNST_VL('MED_002', 'S_ELPS_RCRD') then '1'	/* 경과기록 */
							when nvl(RCKI_CD, '*') = FN_CC_GET_CNST_VL('MED_002', 'S_MVOT_RCRD') then '2'	/* 전출기록 */
							when nvl(RCKI_CD, '*') = FN_CC_GET_CNST_VL('MED_002', 'S_MVIN_RCRD') then '3'	/* 전입기록 */
							when nvl(RCKI_CD, '*') = FN_CC_GET_CNST_VL('MED_002', 'S_DUTY_ON_NOTE_RCRD') then '4' /* Duty on note */
							when nvl(RCKI_CD, '*') = FN_CC_GET_CNST_VL('MED_002', 'S_DUTY_OFF_NOTE_RCRD') then '5' /* Duty off note */
							when nvl(RCKI_CD, '*') = FN_CC_GET_CNST_VL('MED_002', 'S_FINL_NOTE_RCRD') then '6'	/* Final note */
							when nvl(RCKI_CD, '*') = FN_CC_GET_CNST_VL('MED_002', 'S_STFF_PRGR_NOTE_RCRD') then '7' /* Staff Progress Note 여부 */
							else null
						end KIND_CD
					 , #{abrvMcdpCd} as MCDP_CD
					 , (select ABRV_DPRT_CD
					      from HZDEPTMMT /* 조직Master I/F(MDM연계) */
					     where DPRT_CD = #{dprtCd}
				    	   and trunc(sysdate) between APST_YMD and APFN_YMD
				    	   and USE_YN = 'Y'
				    	   and rownum = 1
					    ) as DPRT_CD
				  from MEDOCMBST	/* 진료기록 */
				 where 1 = 1
				   and PTNO = #{ptno}
				   and MDRP_NO = #{mdrpNo}
				   and trunc(RCRD_DT) >= to_date(#{rcrdYmd},'yyyymmdd') /* 입력된 기록일자 포함 그 이후에 작성된 건이 있는지 체크 */
				   and RCKI_CD in (FN_CC_GET_CNST_VL('MED_002', 'S_ELPS_RCRD')				/* 경과기록 */
					   				, FN_CC_GET_CNST_VL('MED_002', 'S_MVOT_RCRD')			/* 전출기록 */
					   				, FN_CC_GET_CNST_VL('MED_002', 'S_MVIN_RCRD')			/* 전입기록 */
					   				, FN_CC_GET_CNST_VL('MED_002', 'S_DUTY_ON_NOTE_RCRD')	/* Duty on note */
					   				, FN_CC_GET_CNST_VL('MED_002', 'S_DUTY_OFF_NOTE_RCRD')	/* Duty off note */
					   				, FN_CC_GET_CNST_VL('MED_002', 'S_STFF_PRGR_NOTE_RCRD')	/* Staff Progress Note 여부 */
					   				, FN_CC_GET_CNST_VL('MED_002', 'S_FINL_NOTE_RCRD')		/* Final note */
				   				  )
				   --and RCRD_SAVE_DVSN_CD = '1'  /* 1.인증  2.미서명, 주석처리 2021.04.06 obh */
				   and nvl(DLTN_YN, 'N') = 'N'
				) a
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStrokeDiagYnConsYmd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
		<result property="refrDt" column="REFR_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStrokeDiagYnConsYmd () 
        Description :                                           뇌졸증 진단 상병 체크 및 재활의학과 컨선트 의뢰 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStrokeDiagYnConsYmd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStrokeDiagYnConsYmd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStrokeDiagYnConsYmd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneStrokeDiagYnConsYmd */
		<![CDATA[
		select decode(count(1), 0, 'N', 'Y') AS YN
		      ,to_char(min(c.LAST_UPDT_DT),'yyyymmddhh24mi') as  refr_dt  /* AS Is 에서는 CONSTIME(최종의뢰시간) to be 매칭 칼럼이 없음 확인 필요 ) */
		  from MDPACLNCT a	/* 환자임상진단내역 */
		     , MDPADIAGT b	/* 환자상병내역 */
		     , MDCONSRCT c
		 where  1=1
		   and a.MDRP_NO = #{mdrpNo}
		   and a.MDRP_NO = b.MDRP_NO
		   and a.PTNT_CLNC_DX_SNO = b.PTNT_CLNC_DX_SNO
		   and NVL(a.RUL_OUT_YN,'N') = 'N'
		   and c.mdrp_no(+) = a.mdrp_no
		   and c.CMTX_STTS_CD(+) not in ('0', '9')                    /* 협진회신화면은 임시저장, 취소 상태는 조회대상 제외 */
		   and nvl(c.DLTN_YN(+), 'N') = 'N'
		   and c.WNTD_DR_MCDP_CD(+)   = FN_CC_GET_DPRT_CD('DPRT_REH') /* 재활의학과 */
		   and c.ORDR_YMD (+) between to_date(#{mdcrYmd}, 'yyyymmdd') and to_date(#{ordrYmd}, 'yyyymmdd')
		   and EXISTS  (select Y
		                   from MZCTRLMMT c
		                  where c.MDCR_CTRL_CD = 'MDP_112'	/* 뇌졸중 진단 상병코드 */
		                    and c.MDCR_DTLS_CTRL_CD = SUBSTR(b.SCIN_CD, 1, 3)
		            )
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntMdstrepdt01-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="stndFormTypeCd" column="STND_FORM_TYPE_CD"/>
		<result property="stndFormTyasCd" column="STND_FORM_TYAS_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntMdstrepdt01 () 
        Description :                                           Stroke 작성 표준서식 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntMdstrepdt01-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntMdstrepdt01"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntMdstrepdt01-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntMdstrepdt01 */
		SELECT PTNO
		      ,MDRP_NO
		      ,STND_FORM_TYPE_CD
		      ,STND_FORM_TYAS_CD
		  FROM MDSTREPDT A
		 WHERE PTNO = #{ptno}
		  AND ADMS_YMD = TO_DATE(#{mdcrYmd},'YYYYMMDD')
		ORDER BY A.STND_FORM_TYPE_CD,A.STND_FORM_TYAS_CD,TO_CHAR(A.RGST_DT,'YYYYMMDDHH24MI');
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBrstCancDiagYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBrstCancDiagYn () 
        Description :                                           환자의 유방암 진단여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBrstCancDiagYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBrstCancDiagYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBrstCancDiagYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneBrstCancDiagYn */
		select decode(count(1), 1, 'Y', 'N') as YN
		  from MDPADIAGT a  /* 환자상병내역 */
		 where a.MDRP_NO = #{mdrpNo}
		   and exists (select 1
			 			 from MZCTRLMMT c
					    where c.MDCR_CTRL_CD = 'MDP_151'	/* 유방암 상병코드 */
						  and c.MDCR_DTLS_CTRL_CD = substr(a.SCIN_CD, 1, 3)
						  and rownum = 1)
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTumrElsmRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn1" column="YN1"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTumrElsmRcrdWrtgYn () 
        Description :                                           종양경과요약 작성 여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTumrElsmRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTumrElsmRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTumrElsmRcrdWrtgYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneTumrElsmRcrdWrtgYn */
		select decode(count(1), 1, 'Y', 'N') as YN1
		  from MEDOCMBST a	/* 진료기록 */
			 , MEACONDMT b	/* 종양경과요약 */
		 where a.RCRD_NO = b.RCRD_NO
		   and a.RCAM_NO = b.RCAM_NO
		   and a.PTNO = b.PTNO
		   and a.MDRP_NO = #{mdrpNo}
		   and a.PTNO = #{ptno}
		   and nvl(a.DLTN_YN, 'N') = 'N'
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSbsnDrusCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="tkmdInftDrusCtn2" column="TKMD_INFT_DRUS_CTN_2"/>
		<result property="tkmdInftDrusCtn" column="TKMD_INFT_DRUS_CTN"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="detlCdNm" column="DETL_CD_NM"/>
		<result property="dgstAdmnNtm" column="DGST_ADMN_NTM"/>
		<result property="sbsnDrusCd" column="SBSN_DRUS_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSbsnDrusCd () 
        Description :                                           대체용법 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSbsnDrusCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSbsnDrusCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSbsnDrusCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSbsnDrusCd */
		select decode(a.DRAP_DVSN_CD,'1',decode(#{codvCd},'I',replace(replace(a.TKMD_INFT_DRUS_CTN,'식후30분','식후'),'식후 30분','식후'),a.TKMD_INFT_DRUS_CTN)
		                            ,a.TKMD_INFT_DRUS_CTN) as TKMD_INFT_DRUS_CTN_2
		      ,a.TKMD_INFT_DRUS_CTN
		      ,a.DRUS_CD
		      ,b.DETL_CD_NM
		      ,a.DGST_ADMN_NTM
		      ,a.SBSN_DRUS_CD
		  from SDDMETCDT a
		      ,CCCMCDDMT b
		where 1=1
		  and a.DRUS_CD = #{drusCd}
		  and b.COMN_GRP_CD ='SD002'
		  and b.COMN_DTLS_CD = a.DRAP_DVSN_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSonoYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSonoYn () 
        Description :                                           수가마스터에서 sono 여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSonoYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSonoYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSonoYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneSonoYn */
		SELECT DECODE(COUNT(1),0,'N','Y') AS YN
		  FROM AIMFMDFET A
		 WHERE A.MDFE_CD = #{ordrCd}
		   AND A.MDAC_CLSF_CD = '34' --초음파 진단
		   AND TO_DATE(#{ordrYmd},'YYYYMMDD') BETWEEN A.APST_YMD AND A.APFN_YMD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntImplant-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="ptqlSno" column="PTQL_SNO"/>
		<result property="ptno" column="PTNO"/>
		<result property="imlnDnfrNo" column="IMLN_DNFR_NO"/>
		<result property="imlnReRgstDvsnCd" column="IMLN_RE_RGST_DVSN_CD"/>
		<result property="ptqlStrtYmd" column="PTQL_STRT_YMD"/>
		<result property="ptqlFnshYmd" column="PTQL_FNSH_YMD"/>
		<result property="rcprInsyId" column="RCPR_INSY_ID"/>
		<result property="imlnLastStepMdpcYmd" column="IMLN_LAST_STEP_MDPC_YMD"/>
		<result property="imlnExpsChupFnshYmd" column="IMLN_EXPS_CHUP_FNSH_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntImplant () 
        Description :                                           환자의 임플란트 자격 정보 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntImplant-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntImplant"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntImplant-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listPtntImplant */
		select a.PTQL_SNO                                                                   /* 환자자격일련번호 */
		     , a.PTNO as PTNO                                                               /*  환자번호    */
		     , a.IMLN_DNFR_NO as IMLN_DNFR_NO                                               /*  치식번호    */
		     , a.IMLN_RE_RGST_DVSN_CD as IMLN_RE_RGST_DVSN_CD                               /*  재등록 구분번호 */
		     , to_char(a.PTQL_STRT_YMD , 'yyyymmdd') as PTQL_STRT_YMD                       /*  시작 유효일자 */
		     , to_char(a.PTQL_FNSH_YMD , 'yyyymmdd') as PTQL_FNSH_YMD                       /*  상실 유효일자 */
		     , a.RCPR_INSY_ID as RCPR_INSY_ID                                               /*  요양기관기호  */
		     , to_char(a.IMLN_LAST_STEP_MDPC_YMD , 'yyyymmdd') as IMLN_LAST_STEP_MDPC_YMD   /*  최종단계 시술일자 */
		     , to_char(a.IMLN_EXPS_CHUP_FNSH_YMD , 'yyyymmdd') as IMLN_EXPS_CHUP_FNSH_YMD   /*  사후점검 종료일자 */
		  from APQLQLDLT a
		 where a.PTNO = #{ptno}
		   and a.PTNT_QLDV_CD = 'I'
		   and a.IMLN_DNFR_NO = #{imlnDnfrNo}
		   and a.CNCL_DT is null
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn () 
        Description :                                           NST TPN 자문 의뢰한 것이 있는지 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn */
		select decode(count(1), 1, 'Y', 'N') as YN
		  from MDNSTPABT a
		 where a.PTNO = #{ptno}
		   and a.MDRP_NO = #{mdrpNo}
		   and a.NSTM_ACCS_PATH_CD = '2' /* NST접근경로코드 = 2(TPN) */
		   and nvl(a.CMTX_FNSH_YN,'N') = 'N'
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsRefrLtstYmd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="cmtxFnshYmd" column="CMTX_FNSH_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsRefrLtstYmd () 
        Description :                                           처방일자 이전의 최근 NST TPN 의뢰 날짜를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsRefrLtstYmd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsRefrLtstYmd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsRefrLtstYmd-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsRefrLtstYmd */
		select max(CMTX_FNSH_YMD) as CMTX_FNSH_YMD
		  from MDNSTPABT a
		 where a.PTNO = #{ptno}
		   and a.REFR_YMD <= to_date(#{ordrYmd}, 'yyyymmdd')
		   and a.MDRP_NO = #{mdrpNo}
		   and a.NSTM_ACCS_PATH_CD = '2' /* NST접근경로코드 = 2(TPN) */
		   and nvl(a.CMTX_FNSH_YN,'N') = 'Y'
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn2-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="drugOrdrDdcn" column="DRUG_ORDR_DDCN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn2 () 
        Description :                                           NST TPN 자문 의뢰한 것이 있는지 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn2-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn2"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn2-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneNstCnsnRefrYn2 */
		select to_date(#{ordrYmd}, 'yyyymmdd') - nvl(min(x.ORDR_YMD), to_date(#{ordrYmd}, 'yyyymmdd')) + 1 as DRUG_ORDR_DDCN
		  from (
		       select nvl(min(a.ORDR_YMD), to_date(#{ordrYmd}, 'yyyymmdd')) as ORDR_YMD
		         from MDMEDORDT a
		        where a.PTNO = #{ptno}
		       <choose>
		       <when test='inqrDvsnCd == "1"'>
		          and '1' = #{inqrDvsnCd}
		          and a.ORDR_YMD between to_date(#{cmtxFnshYmd}, 'yyyymmdd') + 1 and to_date(#{ordrYmd}, 'yyyymmdd')
		       </when>
		       <otherwise>
		          and a.ORDR_YMD <![CDATA[<=]]> to_date(#{ordrYmd}, 'yyyymmdd')
		       </otherwise>
		       </choose>
		          and a.MDRP_NO = #{mdrpNo}
		          and a.ORDR_CD in (select PHRM_DTLS_CTRL_CD
		       		  	  		      from SDMCTRLMT
		       					     where PHRM_CTRL_CD = 'SDH_032') /* 자동 컨설트되는 약제팀 공통코드  */
		          and a.DC_DVSN_CD   = 'N'
		          and a.TMPR_ORDR_YN = 'N'
		       ) x
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneRsbnCarcYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneRsbnCarcYn (FlowSheet 간호사정에 신체보호대 임상관찰기록이 있는지 확인한다.) 
        Description :                                           FlowSheet 간호사정에 신체보호대 임상관찰기록이 있는지 확인한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneRsbnCarcYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneRsbnCarcYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneRsbnCarcYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneRsbnCarcYn */
		select decode(count(1), 1, 'Y', 'N') as YN
		  from (
				select b.*
				     , rank() over (partition by a.MDRP_NO, a.PTNO order by b.CNOS_ITEM_RCRD_DT desc) as seq
				  from MECFSDOMT a /* 임상관찰기록 */
				     , MECFSIRMT b /* 임상관찰항목기록 */
				 where a.MDRP_NO = #{mdrpNo}
				   and a.PTNO = #{ptno}
				   and a.CNOS_RCRD_NO = b.CNOS_RCRD_NO
				   and trunc(b.CNOS_ITEM_RCRD_DT) = to_date(#{ordrYmd}, 'yyyymmdd')
				   and b.CNOS_ITEM_GRP_SNO = 602
				   and b.CNOS_ITEM_SNO = 1330 /* 적용 또는 해제 */
				   and b.CNOS_TAB_CD = '04' /* FlowSheet Tab : 간호사정 */
				   and nvl(b.DLTN_YN, 'N') = 'N'
				   and b.CRTF_YN = 'Y'
			) x
		 where x.seq = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDpwrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="dpwrYn" column="DPWR_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDpwrYn (처방 당일 진료과로 전과 이력이 있는지 조회한다.) 
        Description :                                           처방 당일 진료과로 전과 이력이 있는지 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDpwrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDpwrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDpwrYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-selectOneDpwrYn */
		select decode(count(1), 1, 'Y', 'N') as DPWR_YN
		  from MNWMOVEMT
		 where MDRP_NO = #{mdrpNo}
		   and MVMN_RQST_DVSN_CD in ('02', '03') /* 전과전동이동요청구분코드 : 02(전과) 03(전동시전과) */
		   and PTNO = #{ptno}
		   and MVMN_RQST_PRSS_CD in ('F') /* 이동요청진행상태코드 : F(완료) */
		   and ASGM_MCDP_CD = #{dprtCd} /* 배정진료과코드 */
		   and trunc(ASGM_DT) = to_date(#{ordrYmd}, 'yyyymmdd') /* 배정일시 */
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTransferRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="apstYmd" column="APST_YMD"/>
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTransferRcrdWrtgYn () 
        Description :                                           전입한 환자 작성한 전입기록(Transfer-in Note 또는 Duty on Note) 작성여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTransferRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTransferRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTransferRcrdWrtgYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listTransferRcrdWrtgYn */
		 <![CDATA[
		SELECT TO_CHAR(X.ASGM_DT, 'YYYYMMDD') AS APST_YMD
		     , case when TO_CHAR(x.asgm_dt, 'YYYYMMDD') = TO_CHAR(Z.RCRD_DT, 'YYYYMMDD') THEN 'Y'
		            WHEN x.asgm_dt + numtodsinterval(6, 'HOUR') >= SYSDATE THEN 'Y' /* 전과 후 6시간 이내는 처방제한하지않음 */
		       ELSE 'N' END AS YN
		  FROM (
			SELECT T.MDRP_NO
		         , T.PTNO
		         , T.CRNT_MCDP_CD  												--전과전진료과
		 		 , T.ASGM_MCDP_CD 												--전과후진료과
				 , T.ASGM_DT 													--전과일시
		         , T.ASGM_CHDR_ID												--전과후지정의
				 , row_number() over(partition by T.MDRP_NO order by T.ASGM_DT desc) as SEQ
			  FROM  MNWMOVEMT T /* 전과전동전실 신청내역 */
			 WHERE  T.MDRP_NO = #{mdrpNo}
		       AND  T.MVMN_RQST_DVSN_CD in ('02','03') /* 이동요청구분코드 02 전과 03 전동시전과 (MNW_099) */
		       AND  T.RQST_CNCL_DT is null
		       AND  T.CRNT_MCDP_CD <> T.ASGM_MCDP_CD  /* CRNT_MCDP_CD: 현재진료과코드 ASGM_MCDP_CD: 배정진료과코드 */
		       AND  T.CRNT_MCDP_CD <> FN_CC_GET_CNST_VL('CCD_001','DPRT_EM')
		       and  T.MVMN_RQST_PRSS_CD  = 'F' /* 이동요청진행상태코드 : F(완료) */
		       and  TO_CHAR(T.ASGM_DT, 'YYYYMMDD') >= (SELECT NVL(MDCR_CTRL_CHRC_VL1, '20000101')	/* 특정일자 이후에 전입된 내역만 가져오도록 */
														 FROM MZCTRLMMT
														WHERE MDCR_CTRL_CD = 'MDP_100_RULE'
														  AND MDCR_DTLS_CTRL_CD = 'S90000233'
														  AND ROWNUM = 1)
		       AND  EXISTS ( SELECT 1 FROM HZDEPTMMT Z WHERE Z.DPRT_CD = T.WNTD_MCDP_CD AND Z.MDCR_TISS_DVSN_CD = 'M01' )) x
			, (SELECT * 
		         FROM MEDOCMBST m 
		        WHERE m.MDRP_NO = #{mdrpNo}
		          and RCRD_SAVE_DVSN_CD = '1'	/* 기록저장구분코드 (1:서명) */
		          and nvl(m.DLTN_YN, 'N') = 'N')  z	/* 삭제한 기록은 제외 */
		 WHERE x.SEQ = 1   
		   and x.ASGM_CHDR_ID = #{oddrId}
		   and x.ASGM_MCDP_CD = #{dprtCd}
		   and x.MDRP_NO = z.MDRP_NO (+)
		   and z.RCKI_CD(+) in (  FN_CC_GET_CNST_VL('MED_002', 'S_MVIN_RCRD')			--Transfer-in Note
		                        , FN_CC_GET_CNST_VL('MED_002', 'S_DUTY_ON_NOTE_RCRD') ) --Duty on Note
		   and TO_CHAR(x.ASGM_DT, 'YYYYMMDD') = TO_CHAR(z.RCRD_DT(+), 'YYYYMMDD');
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSlpnRcrdWrtgYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSlpnRcrdWrtgYn (진정 전 기록지 작성여부) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSlpnRcrdWrtgYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSlpnRcrdWrtgYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrSaveChupDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSlpnRcrdWrtgYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrSaveChupDAO-listSlpnRcrdWrtgYn */
		select 'Y' as YN
		  from MEDOCMBST /*  진료기록 */
		 where MDRP_NO = #{mdrpNo}
		   and RCRD_SAVE_DVSN_CD = '1'	/* 기록저장구분코드 (1:서명) */
		   and DLTN_YN = 'N'			/* 삭제되지 않은 기록만 */
		   and RCKI_CD = FN_CC_GET_CNST_VL('MED_002','S_CALM_BEF_RCRD')		/* 진정 전 기록지 */
		   and ADMS_CNCL_YMD is null
		   and TRUNC(SYSDATE) = (CASE WHEN #{codvCd} = 'I' THEN TRUNC(RCRD_DT)
		                              ELSE TRUNC(SYSDATE) END)			 	/* 외래와 응급은 기록일시를 보지않고, 병동은 기록일시가 당일인 기록만 */
		   and rownum = 1;
	</select>



</mapper>