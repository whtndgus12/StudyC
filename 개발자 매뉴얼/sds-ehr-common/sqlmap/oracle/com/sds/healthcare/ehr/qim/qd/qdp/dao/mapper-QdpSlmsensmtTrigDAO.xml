<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_QdpSlmsensmtTrigDAO_sql.xml 
    Description :                                      미생물감수성결과(SLMSENSMT) Table 트리거 DAO - 감염관리
                  -->
<mapper namespace="QdpSlmsensmtTrigDAO">


	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksTrgtCeck-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="stidDclrInptPathCd" column="STID_DCLR_INPT_PATH_CD"/>
		<result property="cmdsKindCd" column="CMDS_KIND_CD"/>
		<result property="infdCd" column="INFD_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksTrgtCeck (미생물 결과 법정 감염 병 대상 체크) 
        Description :                                           미생물감수성결과 등록 및 수정시 법정감염병 대상 여부를 체크한다.
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksTrgtCeck-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksTrgtCeck"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksTrgtCeck-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(a QDCTRLMMT_PK) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksTrgtCeck  */
		        IFMN_CTRL_CHRC_VL3 as STID_DCLR_INPT_PATH_CD  /* 법정감염병신고입력경로코드 */
		     ,  IFMN_CTRL_CHRC_VL4 as CMDS_KIND_CD            /* 전염병종류코드             */
		     ,  IFMN_CTRL_CHRC_VL5 as INFD_CD                 /* 감염성질병코드(Caution)    */
		  from  QDCTRLMMT a
		     ,  SFWWORKMT b
		 where  a.IFMN_CTRL_CD      = 'SEN_INFECT'
		   and  a.IFMN_CTRL_CHRC_VL1 = #{mcrrCd}    /* 균코드   */
		   and  ((a.IFMN_CTRL_CHRC_VL2 = '*') or
		         (a.IFMN_CTRL_CHRC_VL2 =  #{antbCd})
		        )    /* 항생제코드   */
		   and  ((a.IFMN_CTRL_CHRC_VL7 = '*') or
		          (a.IFMN_CTRL_CHRC_VL7 = #{snsbRsltCd}) or
		          (nvl(a.IFMN_CTRL_CHRC_VL8,'XX') = #{snsbRsltCd})
		        ) /* 감수성결과코드 */
		   and  #{scexPrssCd} >= a.IFMN_CTRL_CHRC_VL9   
		   and  (
		         (a.IFMN_CTRL_CHRC_VL10 = '*') or   /* 모든항생제코드 */
		         (a.IFMN_CTRL_CHRC_VL10 = #{spcmCd}) /* 검체코드 */            
		        )
		   and  b.SPCM_NO = #{spcmNo}
		   and  b.EXMN_CD = #{exmnCd}
		   and  rownum <= 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksRgstCct-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="infCnt" column="INF_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksRgstCct (미생물 결과 법정 감염 병 등록 건수) 
        Description :                                           미생물감수성결과 등록, 수정시 법정감염병 등록 여부 체크
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksRgstCct-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksRgstCct"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksRgstCct-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(a QDSINFLMT_I08) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltStttInfcScksRgstCct */
		        count(*) as INF_CNT
		  from  QDSINFLMT a
		 where  a.SPCM_NO       = #{spcmNo}
		   and  a.MCRR_RPTN_NO  = #{mcrrRptnNo}
		   and  a.MCRR_CD       = #{mcrrCd}
		   and  a.ANTB_CD       = #{antbCd}
		   and  a.EXRS_CD_NM    = #{mcrrCd}||decode(nvl(#{snsbRsltCd},'*'),#{snsbRsltCd},'-'||#{snsbRsltCd},null)
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltBsif-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="spcmCd" column="SPCM_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltBsif (미생물 결과 기본정보 조회) 
        Description :                                           미생물감수성결과 등록,수정시 검체작업목록에서 기본정보를 조회한다
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltBsif-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltBsif"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltBsif-result" useCache="true" flushCache="false">
		<![CDATA[
		SELECT  /*+ index(a SFWWORKMT_I06) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrRsltBsif */
		        MDRP_NO            /* 진료접수번호     */
		     ,  MCDP_CD            /* 진료과코드       */
		     ,  CODV_CD            /* 내원구분코드     */
		     ,  WARD_CD            /* 병동코드         */
		     ,  to_char(ORDR_YMD,'YYYYMMDD')  as  ORDR_YMD        /* 처방일자         */
		     ,  ORDR_SNO           /* 처방순번         */
		     ,  SPCM_CD            /* 검체코드         */
		  FROM  SFWWORKMT a
		 WHERE  SPCM_NO  = #{spcmNo}
		   AND  EXMN_CD  = #{exmnCd}
		]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-insertMcrrRsltStttInfcScks (미생물 결과 법정 감염 병 등록) 
        Description :                                           미생물감수성결과 등록, 수정시 법정감염병 등록
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
    -->	
	<insert id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-insertMcrrRsltStttInfcScks"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  >
		<![CDATA[
		insert /* SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-insertMcrrRsltStttInfcScks */
		   into  QDSINFLMT
		      (
		         PTNO                     /* 환자번호                        */
		      ,  CMDS_KIND_CD             /* 법정감염병종류코드              */
		      ,  STTT_INFC_SCKS_DCLR_SNO  /* 법정감염병신고일련번호          */
		      ,  STID_DCLR_INPT_PATH_CD   /* 법정감염병신고입력경로코드      */
		      ,  DX_YMD                   /* 진단일자                        */
		      ,  MDRP_NO                  /* 진료접수번호                    */
		      ,  MCDP_CD                  /* 진료과코드                      */
		      ,  PTAD_CODV_CD             /* 원무내원구분코드                */
		      ,  WARD_CD                  /* 병동코드                        */
		      ,  ORDR_YMD                 /* 처방일자                        */
		      ,  ORDR_SNO                 /* 처방일련번호                    */
		      ,  SPCM_NO                  /* 검체번호                        */
		      ,  EXMN_CD                  /* 검사코드                        */
		      ,  EXRS_CD_NM               /* 검사결과코드명(텍스트결과구분내용)*/
		      ,  EXMN_ODDR_ID             /* 검사처방의사ID                  */
		      ,  INFD_CD                  /* 감염성질병코드(Caution)         */
		      ,  MCRR_RPTN_NO             /* 미생물접수번호                  */
		      ,  MCRR_CD                  /* 미생물코드                      */
		      ,  ANTB_CD                  /* 항생제코드                      */
		      ,  MCRR_SNSB_RSLT_SNO       /* 미생물감수성결과일련번호        */
		      ,  FRST_RGSR_ID             /* 최초등록자ID                    */
		      ,  FRST_RGST_IP             /* 최초등록IP                      */
		      ,  FRST_RGST_DT             /* 최초등록일시                    */
		      ,  FRST_RGST_CLNT_PRGM_ID   /* 최초등록SMC클라이언트프로그램ID */
		      ,  FRST_RGST_SRVR_PRGM_ID   /* 최초등록SMC서버프로그램ID       */
		      ,  LAST_UPDR_ID             /* 최종수정자ID                    */
		      ,  LAST_UPDT_IP             /* 최종수정IP                      */
		      ,  LAST_UPDT_DT             /* 최종수정일시                    */
		      ,  LAST_UPDT_CLNT_PRGM_ID   /* 최종수정SMC클라이언트프로그램ID */
		      ,  LAST_UPDT_SRVR_PRGM_ID   /* 최종수정SMC서버프로그램ID       */
		      )
		      values
		      (
		         #{ptno}                               /* 환자번호                        */
		      ,  #{cmdsKindCd}                         /* 법정감염병종류코드              */
		      ,  (
		          select  /*+ index(a QDSINFLMT_PK)  */
		                  nvl(max(STTT_INFC_SCKS_DCLR_SNO),0)+1
		            from  QDSINFLMT a
		           where  a.PTNO         = #{ptno}
		             and  a.CMDS_KIND_CD = #{cmdsKindCd}
		          )                                    /* 법정감염병신고일련번호          */
		      ,  #{stidDclrInptPathCd}                 /* 법정감염병신고입력경로코드      */
		      ,  sysdate                               /* 진단일자                        */
		      ,  #{mdrpNo}                             /* 진료접수번호                    */
		      ,  #{mcdpCd}                             /* 진료과코드                      */
		      ,  #{codvCd}                             /* 원무내원구분코드                */
		      ,  #{wardCd}                             /* 병동코드                        */
		      ,  to_date(#{ordrYmd},'yyyymmdd')        /* 처방일자                        */
		      ,  #{ordrSno}                            /* 처방일련번호                    */
		      ,  #{spcmNo}                             /* 검체번호                        */
		      ,  #{exmnCd}                             /* 검사코드                        */
		      ,  #{mcrrCd}||decode(nvl(#{snsbRsltCd},'*'),#{snsbRsltCd},'-'||#{snsbRsltCd},null) /* 검사결과코드명(텍스트결과구분내용)*/
		      ,  (
		          select  /*+ index(a MDEXMORDT_PK)  */
		                  a.ODDR_ID
		            from  MDEXMORDT a
		           where  a.PTNO     = #{ptno}
		             and  a.ORDR_YMD = to_date(#{ordrYmd},'yyyymmdd')
		             and  a.ORDR_SNO = #{ordrSno}
		          )                                   /* 검사처방의사ID                  */
		      ,  #{infdCd}                            /* 감염성질병코드(Caution)         */
		      ,  #{mcrrRptnNo}                        /* 미생물접수번호                  */
		      ,  #{mcrrCd}                            /* 미생물코드                      */
		      ,  #{antbCd}                            /* 항생제코드                      */
		      ,  #{sno}                               /* 미생물감수성결과일련번호        */
		      ,  '000000'                             /* 최초등록자ID                    */
		      ,  'TRIGGER'                            /* 최초등록IP                      */
		      ,  sysdate                              /* 최초등록일시                    */
		      ,  'TR_SENSMT'                          /* 최초등록SMC클라이언트프로그램ID */
		      ,  'TR_SENSMT'                          /* 최초등록SMC서버프로그램ID       */
		      ,  '000000'                             /* 최종수정자ID                    */
		      ,  'TRIGGER'                            /* 최종수정IP                      */
		      ,  sysdate                              /* 최종수정일시                    */
		      ,  'TR_SENSMT'                          /* 최종수정SMC클라이언트프로그램ID */
		      ,  'TR_SENSMT'                          /* 최종수정SMC서버프로그램ID       */
		      )
		]]>
	</insert>


	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdSnsbRsltCutnCeck-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="infdCd" column="INFD_CD"/>
		<result property="crgnb" column="CRGNB"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdSnsbRsltCutnCeck (미생물 코드 감수성 결과 Caution 체크) 
        Description :                                           해당 미생물코드에 대한 항생제코드 및 감수성결과가 있는지 확인(Caution)
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdSnsbRsltCutnCeck-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdSnsbRsltCutnCeck"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdSnsbRsltCutnCeck-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(a QDCTRLMMT_PK) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdSnsbRsltCutnCeck  */
		        a.IFMN_CTRL_CHRC_VL2 as INFD_CD  /* 감염성질병코드(Caution) */
		     ,  a.IFMN_CTRL_CHRC_VL6 as CRGNB    /* CRGNB유형               */
		  from  QDCTRLMMT a
		     ,  SFWWORKMT b
		 where  a.IFMN_CTRL_CD         = 'SEN_CAUTION_MICD'
		   and  ((a.IFMN_CTRL_CHRC_VL3 = '1' and #{mcrrCd} = a.IFMN_CTRL_CHRC_VL1) or
		         (a.IFMN_CTRL_CHRC_VL3 = '2' and #{mcrrCd} like a.IFMN_CTRL_CHRC_VL1||'%')) /* 미생물코드 */
		   and  (
		         (a.IFMN_CTRL_CHRC_VL4 = '*') or   /* 모든항생제코드 */
		         (a.IFMN_CTRL_CHRC_VL4 = #{antbCd}) /* 항생제코드 */            
		        )
		   and  ((a.IFMN_CTRL_CHRC_VL7 = '*') or
		          (a.IFMN_CTRL_CHRC_VL7 = #{snsbRsltCd}) or
		          (nvl(a.IFMN_CTRL_CHRC_VL8,'XX') = #{snsbRsltCd})) /* 감수성결과코드 */
		   and  #{scexPrssCd} >= a.IFMN_CTRL_CHRC_VL9    /* 중간보고(F)상태 이상 => G */   
		   and  b.SPCM_NO = #{spcmNo}
		   and  b.EXMN_CD = #{exmnCd}
		   and a.IFMN_CTRL_CHRC_VL2 IS NOT NULL
		   and  rownum <= 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstTrgt-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="cauYn" column="CAU_YN"/>
		<result property="cutnSgnInptPathCd" column="CUTN_SGN_INPT_PATH_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstTrgt (미생물 코드 Caution 등록 대상) 
        Description :                                           미생물 코드 해당 검사코드가 Caution 등록코드인지 확인한다.
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstTrgt-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstTrgt"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstTrgt-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(a QDCTRLMMT_PK) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstTrgt  */
		        IFMN_CTRL_CHRC_VL3 as CAU_YN                 /* Caution등록여부            */
		     ,  IFMN_CTRL_CHRC_VL6 as CUTN_SGN_INPT_PATH_CD  /* 입력구분                   */
		  from  QDCTRLMMT a
		 where  a.IFMN_CTRL_CD       = 'SEN_CAUTION_EXCD'
		   and  (a.IFMN_CTRL_CHRC_VL1 = #{exmnCd} or
		         a.IFMN_CTRL_CHRC_VL1 = '*' 
		        )   /* 검사코드 */
		   and  a.IFMN_CTRL_CHRC_VL2 = #{infdCd}     /* 감염성질병코드(Caution)  */   
		   and  rownum <= 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnTrgtCct-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="spcCnt" column="SPC_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnTrgtCct (미생물 코드 Caution 대상 건수) 
        Description :                                           미생물 코드 Caution 대상 건수 -미생물 검사결과에서 CAUTION을 갖고 오는 검체코드
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnTrgtCct-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnTrgtCct"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnTrgtCct-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(a QDCTRLMMT_PK) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnTrgtCct  */
		        count(*) as SPC_CNT
		  from  QDCTRLMMT a
		 where  a.IFMN_CTRL_CD       = 'SEN_CAUTION_SPCD'
		   and  a.IFMN_CTRL_CHRC_VL2 = #{infdCd}     /* 감염성질병코드(Caution) */
		   and  ((a.IFMN_CTRL_CHRC_VL1 = '*') or     /*모든검체코드*/
		         (a.IFMN_CTRL_CHRC_VL1 = #{spcmCd}))  /* 검체코드 */
		   and  rownum <= 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstCct-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="cauCnt" column="CAU_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstCct (미생물 코드 Caution 징후 등록 건수) 
        Description :                                           미생물 코드 Caution 징후 등록 건수
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstCct-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstCct"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstCct-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(a QDSINFCDT_I08) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstCct */
		        count(*)  as CAU_CNT
		  from  QDSINFCDT a
		 where  a.SPCM_NO       = #{spcmNo}
		   and  a.MCRR_RPTN_NO  = #{mcrrRptnNo}
		   and  a.MCRR_CD       = #{mcrrCd}
		   and  a.ANTB_CD       = #{antbCd}
		   and  a.EXRS_CD_NM    = #{mcrrCd}||decode(nvl(#{snsbRsltCd},'*'),#{snsbRsltCd},'-'||#{snsbRsltCd},null)
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstNewSno-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="cutnSgnRgstSno" column="CUTN_SGN_RGST_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstNewSno (미생물 코드 Caution 징후 등록 신규 일련번호) 
        Description :                                           미생물 코드 Caution 징후 등록 신규 일련번호
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstNewSno-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstNewSno"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstNewSno-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(a QDSINFCDT_PK) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnRgstNewSno  */
		        nvl(max(a.CUTN_SGN_RGST_SNO),0)+1  as CUTN_SGN_RGST_SNO
		  from  QDSINFCDT a
		 where  a.PTNO    = #{ptno}
		   and  a.INFD_CD = #{infdCd}
		]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-insertMcrrCdCutnSgn (미생물 코드 Caution 징후 등록) 
        Description :                                           미생물 감수성 결과 등록/수정시 환자코션징후(QDSINFCDT) 테이블에 신규등록한다.
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
    -->	
	<insert id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-insertMcrrCdCutnSgn"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  >
		<![CDATA[
		insert /* SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-insertMcrrCdCutnSgn */
		   into  QDSINFCDT
		      (
		         PTNO                     /* 환자번호                       */
		      ,  INFD_CD                  /* 감염성질병코드(Caution)         */
		      ,  CUTN_SGN_RGST_SNO        /* CAUTION징후등록일련번호         */
		      ,  CUTN_SGN_RGST_DT         /* CAUTION징후등록일시             */
		      ,  CUTN_SGN_INPT_PATH_CD    /* CAUTION징후입력경로코드         */
		      ,  ORDR_YMD                 /* 처방일자                        */
		      ,  ORDR_SNO                 /* 처방일련번호                    */
		      ,  MDRP_NO                  /* 진료접수번호                    */
		      ,  CODV_CD                  /* 내원구분코드                    */
		      ,  WARD_CD                  /* 병동코드                        */
		      ,  EXRS_CD_NM               /* TEXT결과코드                    */
		      ,  SPCM_NO                  /* 검체번호                        */
		      ,  RPRT_DT                  /* 보고일시                        */
		      ,  EXMN_CD                  /* 검사코드                        */
		      ,  MCDP_CD                  /* 진료과코드                      */
		      ,  MCRR_RPTN_NO             /* 미생물접수번호                  */
		      ,  MCRR_CD                  /* 미생물코드                      */
		      ,  ANTB_CD                  /* 항생제코드                      */
		      ,  MCRR_SNSB_RSLT_SNO       /* 미생물순번                      */
		      ,  FRST_RGSR_ID             /* 최초등록자ID                    */
		      ,  FRST_RGST_IP             /* 최초등록IP                      */
		      ,  FRST_RGST_DT             /* 최초등록일시                    */
		      ,  FRST_RGST_CLNT_PRGM_ID   /* 최초등록SMC클라이언트프로그램ID  */
		      ,  FRST_RGST_SRVR_PRGM_ID   /* 최초등록SMC서버프로그램ID        */
		      ,  LAST_UPDR_ID             /* 최종수정자ID                    */
		      ,  LAST_UPDT_IP             /* 최종수정IP                      */
		      ,  LAST_UPDT_DT             /* 최종수정일시                    */
		      ,  LAST_UPDT_CLNT_PRGM_ID   /* 최종수정SMC클라이언트프로그램ID  */
		      ,  LAST_UPDT_SRVR_PRGM_ID   /* 최종수정SMC서버프로그램ID        */
		      )
		      values
		      (
		         #{ptno}                              /* 환자번호                       */
		      ,  #{infdCd}                            /* 감염성질병코드(Caution)         */
		      ,  #{cutnSgnRgstSno}                    /* CAUTION징후등록일련번호         */
		      ,  sysdate                              /* CAUTION징후등록일시             */
		      ,  #{cutnSgnInptPathCd}                 /* CAUTION징후입력경로코드         */
		      ,  to_date(#{ordrYmd},'yyyymmdd')       /* 처방일자                        */
		      ,  #{ordrSno}                           /* 처방일련번호                    */
		      ,  #{mdrpNo}                            /* 진료접수번호                    */
		      ,  #{codvCd}                            /* 내원구분코드                    */
		      ,  #{wardCd}                            /* 병동코드                        */
		      ,  #{mcrrCd}||decode(nvl(#{snsbRsltCd},'*'),#{snsbRsltCd},'-'||#{snsbRsltCd},null) /* TEXT결과코드 감수성결과  */
		      ,  #{spcmNo}                            /* 검체번호                        */
		      ,  sysdate                              /* 보고일시                        */
		      ,  #{exmnCd}                            /* 검사코드                        */
		      ,  #{mcdpCd}                            /* 진료과코드                      */
		      ,  #{mcrrRptnNo}                        /* 미생물접수번호                  */
		      ,  #{mcrrCd}                            /* 미생물코드                      */
		      ,  #{antbCd}                            /* 항생제코드                      */
		      ,  #{sno}                               /* 미생물순번                      */
		      ,  '000000'                             /* 최초등록자ID                    */
		      ,  'TRIGGER'                            /* 최초등록IP                      */
		      ,  sysdate                              /* 최초등록일시                    */
		      ,  'TR_SENSMT'                          /* 최초등록SMC클라이언트프로그램ID  */
		      ,  'TR_SENSMT'                          /* 최초등록SMC서버프로그램ID        */
		      ,  '000000'                             /* 최종수정자ID                    */
		      ,  'TRIGGER'                            /* 최종수정IP                      */
		      ,  sysdate                              /* 최종수정일시                    */
		      ,  'TR_SENSMT'                          /* 최종수정SMC클라이언트프로그램ID  */
		      ,  'TR_SENSMT'                          /* 최종수정SMC서버프로그램ID        */
		      )
		]]>
	</insert>


	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="qdsinfmdtCnt" column="QDSINFMDT_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck (미생물 코드 Caution 등록 여부 체크) 
        Description :                                           미생물감수성결과 등록/수정시 Caution 등록여부를 건수로 확인함.
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(QDSINFMDT QDSINFMDT_PK) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck */
		        count(*) as QDSINFMDT_CNT
		  from  QDSINFMDT
		 where  PTNO = #{ptno}
		   and  INFD_CD = #{infdCd}
		   and  (CUTN_STRT_YMD = trunc(sysdate) or CUTN_RELE_YMD =to_date('29991231', 'yyyymmdd'))
		]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-insertMcrrCdCutn (미생물 코드 Caution 등록) 
        Description :                                           미생물 감수성결과 등록수정시 Caution 등록
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
    -->	
	<insert id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-insertMcrrCdCutn"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  >
		<![CDATA[
		INSERT /* SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-insertMcrrCdCutn */
		   INTO QDSINFMDT
		      (
		         PTNO                      /* 환자번호                        */
		      ,  INFD_CD                  /* 감염성질병코드(Caution)         */
		      ,  CUTN_STRT_YMD            /* 경고시작일자                    */
		      ,  CUTN_RELE_YMD            /* 경고종료일자                    */
		      ,  CUTN_SGN_RGST_SNO        /* CAUTION징후등록일련번호         */
		      ,  CUTN_INPT_PATH_CD        /* CAUTION입력경로코드             */
		      ,  MDRP_NO                  /* 진료접수번호                    */
		      ,  FRST_RGSR_ID             /* 최초등록자ID                    */
		      ,  FRST_RGST_IP             /* 최초등록IP                      */
		      ,  FRST_RGST_DT             /* 최초등록일시                    */
		      ,  FRST_RGST_CLNT_PRGM_ID   /* 최초등록SMC클라이언트프로그램ID */
		      ,  FRST_RGST_SRVR_PRGM_ID   /* 최초등록SMC서버프로그램ID       */
		      ,  LAST_UPDR_ID             /* 최종수정자ID                    */
		      ,  LAST_UPDT_IP             /* 최종수정IP                      */
		      ,  LAST_UPDT_DT             /* 최종수정일시                    */
		      ,  LAST_UPDT_CLNT_PRGM_ID   /* 최종수정SMC클라이언트프로그램ID */
		      ,  LAST_UPDT_SRVR_PRGM_ID   /* 최종수정SMC서버프로그램ID       */
		      )
		      VALUES
		      (
		         #{ptno}                             /* 환자번호                        */
		      ,  #{infdCd}                           /* 감염성질병코드(Caution)         */
		      ,  TRUNC(SYSDATE)                      /* 경고시작일자                    */
		      ,  TO_DATE('29991231','yyyymmdd')      /* 경고종료일자                    */
		      ,  #{cutnSgnRgstSno}                   /* CAUTION징후등록일련번호         */
		      ,  #{cutnSgnInptPathCd}                /* CAUTION입력경로코드             */
		      ,  #{mdrpNo}                           /* 진료접수번호                    */
		      ,  '000000'                            /* 최초등록자ID                    */
		      ,  'TRIGGER'                           /* 최초등록IP                      */
		      ,  sysdate                             /* 최초등록일시                    */
		      ,  'TR_SENSMT'                         /* 최초등록SMC클라이언트프로그램ID */
		      ,  'TR_SENSMT'                         /* 최초등록SMC서버프로그램ID       */
		      ,  '000000'                            /* 최종수정자ID                    */
		      ,  'TRIGGER'                           /* 최종수정IP                      */
		      ,  sysdate                             /* 최종수정일시                    */
		      ,  'TR_SENSMT'                         /* 최종수정SMC클라이언트프로그램ID */
		      ,  'TR_SENSMT'                         /* 최종수정SMC서버프로그램ID       */
		      )
		]]>
	</insert>


	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleCd-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="infdCd" column="INFD_CD"/>
		<result property="crgnb" column="CRGNB"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleCd (미생물 코드 Caution 해제 코드 조회) 
        Description :                                           미생물 감수성결과 등록 수정시 Caution 해제 코드 조회
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleCd-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleCd"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleCd-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(a QDCTRLMMT_PK) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleCd  */
		        IFMN_CTRL_CHRC_VL2 as INFD_CD /* 감염성질병코드(Caution) */
		     ,  IFMN_CTRL_CHRC_VL6 as CRGNB   /* CRGNB유형               */
		  from  QDCTRLMMT a
		 where  a.IFMN_CTRL_CD         = 'SEN_CAUTION_MICD'
		   and  (
		         (a.IFMN_CTRL_CHRC_VL3 = '1' and #{mcrrCd} = a.IFMN_CTRL_CHRC_VL1) or
		         (a.IFMN_CTRL_CHRC_VL3 = '2' and #{mcrrCd} like a.IFMN_CTRL_CHRC_VL1||'%')
		        ) /* 미생물코드 */
		   and  (
		         (a.IFMN_CTRL_CHRC_VL4 = '*') or   /* 모든항생제코드 */
		         (a.IFMN_CTRL_CHRC_VL4 = #{antbCd})
		        )
		   and  (
		         (a.IFMN_CTRL_CHRC_VL7 = '*') or
		         (a.IFMN_CTRL_CHRC_VL7 = #{snsbRsltCd}) or
		         (nvl(a.IFMN_CTRL_CHRC_VL8,'XX') = #{snsbRsltCd})
		        ) /* 감수성결과코드 */
		   and  #{scexPrssCd} >= 'G'
		   and  rownum <= 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleYnCeck-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="cutnReleDvsnCd" column="CUTN_RELE_DVSN_CD"/>
		<result property="cauNeYn" column="CAU_NE_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleYnCeck (미생물 코드 Caution 해제 여부 체크) 
        Description :                                           미생물 감수성 결과 등록, 수정시 Caution 해제 대상여부를 체크 한다.
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleYnCeck-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleYnCeck"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleYnCeck-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(a QDCTRLMMT_PK) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleYnCeck  */
		        IFMN_CTRL_CHRC_VL7 as CUTN_RELE_DVSN_CD               /* 해제구분                   */
		     ,  IFMN_CTRL_CHRC_VL8 as CAU_NE_YN                 /* 해제여부                   */
		  from  QDCTRLMMT a
		 where  a.IFMN_CTRL_CD      = 'SEN_CAUTION_EXCD'
		   and  (
		         (a.IFMN_CTRL_CHRC_VL1 = '*') or
		         (a.IFMN_CTRL_CHRC_VL1 = #{exmnCd})     /* 검사코드 */
		        )   
		   and  a.IFMN_CTRL_CHRC_VL2 = #{infdCd}     /* 감염성질병코드(Caution)  */  
		   and  rownum <= 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnReleTrgtCct-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="cauCnt" column="CAU_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnReleTrgtCct (미생물 코드 Caution 징후 해제 대상 건수) 
        Description :                                           미생물 감수성 결과 Caution 징후 해제 대상이 있는지 건수 확인
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnReleTrgtCct-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnReleTrgtCct"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnReleTrgtCct-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(a QDSINFCDT_I08) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnSgnReleTrgtCct */
		        count(*) as CAU_CNT
		  from  QDSINFCDT a
		 where  a.SPCM_NO       = #{spcmNo}
		   and  a.MCRR_RPTN_NO  = #{mcrrRptnNo}
		   and  a.MCRR_CD       = #{mcrrCd}
		   and  a.ANTB_CD       = #{antbCd}
		   and  a.ANTB_CD <> '!!!!!'
		   and  nvl(#{snsbRsltCd},'XX') not in ('R','R*')
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleTrgtCct-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="qdsinfmdtCnt" column="QDSINFMDT_CNT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleTrgtCct (미생물 코드 Caution 해제 대상 건수) 
        Description :                                           미생물감수성결과 등록,수정시 Caution 해제 대상 건수 확인
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleTrgtCct-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleTrgtCct"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleTrgtCct-result" useCache="true" flushCache="false">
		<![CDATA[
		select  /*+ index(QDSINFMDT QDSINFMDT_PK) _SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnReleTrgtCct */
		        count(*) as QDSINFMDT_CNT
		  from  QDSINFMDT
		 where  PTNO          = #{ptno}
		   and  INFD_CD       = #{infdCd}
		   and  CUTN_RELE_YMD = to_date('29991231', 'yyyymmdd')
		]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-updateMcrrCdCutnRele (미생물 코드 Caution 해제) 
        Description :                                           미생물감수성결과 등록, 수정시 Caution 해제 처리
                                            
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
    -->	
	<update id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-updateMcrrCdCutnRele"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  >
		<![CDATA[
		update  /*+ index(QDSINFMDT QDSINFMDT_PK) -SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-updateMcrrCdCutnRele */
		        QDSINFMDT
		   set  CUTN_RELE_YMD     = trunc(sysdate)
		     ,  CUTN_RELE_DVSN_CD = #{cutnReleDvsnCd}
		     ,  CUTN_RLSR_ID = '000000'
		     ,  CUTN_RELE_IP = 'TRIGGER-D'
		     ,  CUTN_RELE_DT = sysdate
		     ,  LAST_UPDR_ID = '000000'
		     ,  LAST_UPDT_IP = 'TRIGGER'
		     ,  LAST_UPDT_DT = sysdate
		     ,  LAST_UPDT_CLNT_PRGM_ID = 'TR_SENSMT'
		     ,  LAST_UPDT_SRVR_PRGM_ID = 'TR_SENSMT'
		 where  PTNO          = #{ptno}
		   and  INFD_CD       = #{infdCd}
		   and  CUTN_RELE_YMD = to_date('29991231', 'yyyymmdd')
		]]>
	</update>


	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck2-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="cauCnt2" column="CAU_CNT2"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck2 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck2-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck2"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMcrrCdCutnRgstYnCeck2-result" useCache="true" flushCache="false">
		<![CDATA[
		 SELECT CASE WHEN SUM(CASE WHEN (IFMN_CTRL_CHRC_VL7 = EXRS_CD_NM_LIST_CTN) AND (EXRS_CD_NM = 'Y')  THEN 1 
		                           WHEN (IFMN_CTRL_CHRC_VL8 = EXRS_CD_NM_LIST_CTN) AND (EXRS_CD_NM = 'Y')  THEN 1
		            ELSE 0 END) <> COUNT(1) THEN 0 ELSE 1 END AS  CAU_CNT2
		   FROM(
						SELECT  B.IFMN_CTRL_CHRC_VL7
						      , B.IFMN_CTRL_CHRC_VL8
						      , SUBSTR(a.EXRS_CD_NM , INSTR(a.EXRS_CD_NM , '-' )+1) AS EXRS_CD_NM_LIST_CTN
						      , CASE WHEN IFMN_CTRL_CHRC_VL7 IS NOT NULL THEN  'Y'
		                     WHEN IFMN_CTRL_CHRC_VL8 IS NOT NULL THEN  'Y' ELSE 'N' END IFMN_CTRL_CHRC_VL			      
						      , CASE WHEN (B.IFMN_CTRL_CHRC_VL7 IS NOT NULL) AND (B.IFMN_CTRL_CHRC_VL4 = A.ANTB_CD)  THEN 
						           CASE WHEN ((B.IFMN_CTRL_CHRC_VL7 = SUBSTR(a.EXRS_CD_NM , INSTR(a.EXRS_CD_NM , '-' )+1))
				                       OR (B.IFMN_CTRL_CHRC_VL8 = SUBSTR(a.EXRS_CD_NM , INSTR(a.EXRS_CD_NM , '-' )+1))) THEN 'Y' ELSE 'N' END 
						              WHEN (B.IFMN_CTRL_CHRC_VL8 IS NOT NULL ) AND (B.IFMN_CTRL_CHRC_VL4 = A.ANTB_CD) THEN
						           CASE WHEN ((B.IFMN_CTRL_CHRC_VL8 = SUBSTR(a.EXRS_CD_NM , INSTR(a.EXRS_CD_NM , '-' )+1))
						                   OR (B.IFMN_CTRL_CHRC_VL7 = SUBSTR(a.EXRS_CD_NM , INSTR(a.EXRS_CD_NM , '-' )+1))) THEN 'Y' ELSE 'N' END
						        ELSE 'N' END EXRS_CD_NM
						  FROM QDSINFCDT a
						     , QDCTRLMMT b 
						WHERE 1=1
						  AND PTNO(+)  = #{ptno}
						  AND B.IFMN_CTRL_CD = 'SEN_CAUTION_MICD'
						  AND B.IFMN_CTRL_CHRC_VL1 = A.MCRR_CD(+)
						  AND B.IFMN_CTRL_CHRC_VL4 = A.ANTB_CD(+)
		                  AND b.IFMN_CTRL_CHRC_VL1 = #{mcrrCd} 
		                  AND b.IFMN_CTRL_CHRC_VL2 = #{infdCd} 
		                  AND a.SPCM_NO(+) = #{spcmNo}
		                  AND a.EXMN_CD(+) = #{exmnCd}
		        )
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMicdYn-result" type="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO">
	
		<result property="ifmnDetlCtrlVl" column="IFMN_DETL_CTRL_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMicdYn () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO
		resultMap : com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMicdYn-result
    -->
	<select id="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMicdYn"  parameterType="com.sds.healthcare.ehr.qim.qd.qdp.vo.QdpSlmsensmtTrigDVO"  resultMap="com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMicdYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-qim-qd-qdp-dao-QdpSlmsensmtTrigDAO-selectOneMicdYn */
		SELECT case when nvl(A.IFMN_DETL_CTRL_VL,'N') = 'Y' then 1
		        else 0 end as ifmn_detl_ctrl_vl
		  FROM QDCTRLMMT a
		 WHERE A.IFMN_CTRL_CD = 'SEN_CAUTION_MICD_YN'
	</select>



</mapper>