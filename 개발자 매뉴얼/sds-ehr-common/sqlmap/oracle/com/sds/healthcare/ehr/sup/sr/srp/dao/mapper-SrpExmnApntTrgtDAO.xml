<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_SrpExmnApntTrgtDAO_sql.xml 
    Description :                                      검사 예약접수 대상자
                  -->
<mapper namespace="SrpExmnApntTrgtDAO">


	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptn-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="apntYn" column="APNT_YN"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="exrmCd1" column="EXRM_CD_1"/>
		<result property="schdDtlsTypCd" column="SCHD_DTLS_TYP_CD"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="drNm" column="DR_NM"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="amprId" column="AMPR_ID"/>
		<result property="andvCd" column="ANDV_CD"/>
		<result property="exmnCd" column="EXMN_CD"/>
		<result property="ptno" column="PTNO"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="exrsGrpCd" column="EXRS_GRP_CD"/>
		<result property="admsYmd" column="ADMS_YMD"/>
		<result property="excfCd" column="EXCF_CD"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="centApntPsblYn" column="CENT_APNT_PSBL_YN"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="pacsAccsNo" column="PACS_ACCS_NO"/>
		<result property="rernYn" column="RERN_YN"/>
		<result property="cnmdUseYn" column="CNMD_USE_YN"/>
		<result property="rcpsId" column="RCPS_ID"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="careWardCd" column="CARE_WARD_CD"/>
		<result property="wntdDrNm" column="WNTD_DR_NM"/>
		<result property="exorUnslCtn" column="EXOR_UNSL_CTN"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="clrsPrjcDrId" column="CLRS_PRJC_DR_ID"/>
		<result property="clrsPrjcDrNm" column="CLRS_PRJC_DR_NM"/>
		<result property="wntdDt" column="WNTD_DT"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="bdsdYn" column="BDSD_YN"/>
		<result property="ordrLcdvCd" column="ORDR_LCDV_CD"/>
		<result property="cntrCd" column="CNTR_CD"/>
		<result property="implLcdvCd" column="IMPL_LCDV_CD"/>
		<result property="unmdRceqUseYn" column="UNMD_RCEQ_USE_YN"/>
		<result property="userDvsnCd" column="USER_DVSN_CD"/>
		<result property="wntdDt1" column="WNTD_DT_1"/>
		<result property="riskFctrMemoCtn" column="RISK_FCTR_MEMO_CTN"/>
		<result property="ptadCodvCd" column="PTAD_CODV_CD"/>
		<result property="indrNm" column="INDR_NM"/>
		<result property="paclYmd" column="PACL_YMD"/>
		<result property="intrPrrnDt" column="INTR_PRRN_DT"/>
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="smdvCd" column="SMDV_CD"/>
		<result property="smdpClsfCd" column="SMDP_CLSF_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="sctnCd" column="SCTN_CD"/>
		<result property="mtfrTkngYn" column="MTFR_TKNG_YN"/>
		<result property="dytmWardUseWntdYn" column="DYTM_WARD_USE_WNTD_YN"/>
		<result property="dtlsExcfCd" column="DTLS_EXCF_CD"/>
		<result property="asapYn" column="ASAP_YN"/>
		<result property="slpnPsblYn" column="SLPN_PSBL_YN"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ipdvNm" column="IPDV_NM"/>
		<result property="wt" column="WT"/>
		<result property="ht" column="HT"/>
		<result property="msrmYmd" column="MSRM_YMD"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="exrmCd2" column="EXRM_CD_2"/>
		<result property="exorUnslCtn" column="EXOR_UNSL_CTN"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="afiAmprNm" column="AFI_AMPR_NM"/>
		<result property="prvsTxDgstRcepYn" column="PRVS_TX_DGST_RCEP_YN"/>
		<result property="nnmtExmnYn" column="NNMT_EXMN_YN"/>
		<result property="nnmtExmnNtfcYmd" column="NNMT_EXMN_NTFC_YMD"/>
		<result property="fatrCd" column="FATR_CD"/>
		<result property="exmnWntdYmdDvsnCd" column="EXMN_WNTD_YMD_DVSN_CD"/>
		<result property="imlnClsfCd" column="IMLN_CLSF_CD"/>
		<result property="clsfNm" column="CLSF_NM"/>
		<result property="exmnFalrRgstResnCtn" column="EXMN_FALR_RGST_RESN_CTN"/>
		<result property="prvsTxDgstCtn" column="PRVS_TX_DGST_CTN"/>
		<result property="exmnAndvCd" column="EXMN_ANDV_CD"/>
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="chldCalmYn" column="CHLD_CALM_YN"/>
		<result property="apntRmrkCtn" column="APNT_RMRK_CTN"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="datNo" column="DAT_NO"/>
		<result property="enfrDt" column="ENFR_DT"/>
		<result property="scndOrdrYn" column="SCND_ORDR_YN"/>
		<result property="agdcYn" column="AGDC_YN"/>
		<result property="careWardNm" column="CARE_WARD_NM"/>
		<result property="dschDt" column="DSCH_DT"/>
		<result property="ipdvNm" column="IPDV_NM"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="odkiDetlNm" column="ODKI_DETL_NM"/>
		<result property="prvlRptnYn" column="PRVL_RPTN_YN"/>
		<result property="ptntExmnNm" column="PTNT_EXMN_NM"/>
		<result property="inftSmsrSndgCtn" column="INFT_SMSR_SNDG_CTN"/>
		<result property="etcMdrpNo" column="ETC_MDRP_NO"/>
		<result property="schdTypCd" column="SCHD_TYP_CD"/>
		<result property="prtbYn" column="PRTB_YN"/>
		<result property="mccnCd" column="MCCN_CD"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="detlCdDscrCtn" column="DETL_CD_DSCR_CTN"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="rcpcDt" column="RCPC_DT"/>
		<result property="schdTypNm" column="SCHD_TYP_NM"/>
		<result property="etcTlno" column="ETC_TLNO"/>
		<result property="nrdrPsdgDrugCtn" column="NRDR_PSDG_DRUG_CTN"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptn (검사 예약접수 조회 그외) 
        Description :                                           검사 예약접수 조회 그외 (SR,SV 외)
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptn-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptn"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptn */
		<![CDATA[
		select  /*+ index(a SWWORKMMT_I09) swd_workmmt_l48$S01_검사 예약접수 조회 그외 */
					  b.APNT_NEED_EN as APNT_YN		 
			     /* ,  fn_sw_roomcode_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as EXRM_CD  */          /*  2. 검사실코드       */
		           , b.OTPT_EXRM_CD as EXRM_CD   /*  2. 검사실코드       */
				   ,  nvl(c.RCST_CD, 'N') as EXRM_CD_1 /*  수납여부 */
				   ,  decode(c.EXCF_CD, 'SS', nvl(fn_sw_schsubtyp_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO), '****')
											, fn_sw_schsubtyp_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)) as SCHD_DTLS_TYP_CD
				   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CHDR_ID) as CHDR_NM   /*  지정의사             */
				   ,  mo.USER_NM as DR_NM   /*  2013.07.10 mobile번호->PDANO로 변경 박재연 선생님 요청 */
				   ,  '' as APNT_DT                            /*  예약일시             */
				   ,  ''  as RPTN_DT                           /*  접수일시             */
				   ,  to_char(c.ORDR_YMD, 'yyyymmdd')  as ORDR_YMD                                /*  처방일자             */
				   ,  c.MCDP_CD as MCDP_CD 
				   , b.ORDR_NM as ORDR_NM
				   ,  '' as AMPR_ID                                        /*  예약자               */
				   ,  '' as ANDV_CD                                      /*  예약구분 중앙: Y     */
				   ,  c.ORDR_CD as EXMN_CD                                       /*  검사코드             */
				   ,  c.PTNO as PTNO                                           /*  환자번호             */
				   ,  c.ORDR_SNO as ORDR_SNO                                         /*  처방순번             */
				   ,  c.EXOR_PRSS_CD as EXMN_PRSS_CD                                   /*  진행STATUS(진료지원) */
				   ,  b.EXRS_GRP_CD as EXRS_GRP_CD                                   /*  결과그룹 코드        */
				   ,  to_char(l.MDCR_DT, 'yyyymmdd') as ADMS_YMD                    /*  입원일자             */
				   ,  c.EXCF_CD as EXCF_CD                                        /*  검사분류             */
				   ,  c.CODV_CD as CODV_CD                                         /*  환자구분             */
				   ,  b.CENT_APNT_PSBL_YN as CENT_APNT_PSBL_YN                               /*  중앙예약가능여부     */
				   ,  '' as APNT_FRMT_CD     /*  일정/비일정 예약구분 */
				   ,  '' as PACS_ACCS_NO  
				   ,  '' as RERN_YN     /*  REPEAT 여부    */
				   ,  fn_sr_sidreaction_s(c.PTNO)  as CNMD_USE_YN                 /*  SIDE 여부            */
				   ,  ''  as RCPS_ID             /*  접수자               */
				   ,  ''  as RCPS_NM                        /*  접수자               */
				   ,  '' as RCPS_NM      /*  검사실 전화번호      */
				   ,  ( select F_A.ABRV_DPRT_CD from HZDEPTMMT F_A where F_A.DPRT_CD = c.WARD_CD group by F_A.ABRV_DPRT_CD)  as WARD_CD /*  병동                 */
				   ,  ( select ABRV_DPRT_CD
		                  from HZDEPTMMT
		                 where DPRT_CD = L.CARE_WARD_CD
		                 group by ABRV_DPRT_CD )   as CARE_WARD_CD                       /*  현병동                 */
				   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.EXMN_WNTD_DR_ID) as WNTD_DR_NM    /*  희망의               */
				   ,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null, ' <'||to_char(e.LAST_UPDT_DT, 'yyyymmddhh24miss')||' '||f.USER_NM||'>') as EXOR_UNSL_CTN
				   ,  c.CLRS_PRJC_CD as CLRS_PRJC_CD                                  /*  임상연구코드         */
				   ,  c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
				   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
				   ,  to_char(c.WNTD_DT, 'yyyymmdd') as WNTD_DT        /*  희망일시             */
				   ,  c.ODDR_ID as ODDR_ID
				   ,  c.ODKI_CD as ODKI_CD
				   ,  '' as BDSD_YN
				   ,  nvl(c.HSLC_DVSN_CD, 'M') as ORDR_LCDV_CD
				   ,  nvl(c.MCCN_CD, 'M') as CNTR_CD
				   ,  '' as IMPL_LCDV_CD
				   ,  b.RCEQ_USE_YN as UNMD_RCEQ_USE_YN
				   ,  c.INPT_USER_DVSN_CD as USER_DVSN_CD
				   ,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') as WNTD_DT_1        /*  예약일시             */
		       ,  decode(c.RISK_FCTR_VL,'1','Pacemaker'
		                               ,'2','심실재동기화 치료 제세동기'
		                               ,'3','체내제세동기'
		                               ,'4','인공와우'
		                               ,'5','캡슐내시경'
		                               ,'6','유방조직확장기'
		                               ,'7','해당없음'
		                               ,'/') as  RISK_FCTR_MEMO_CTN           /*  위험인자 */
				   ,  c.PTAD_CODV_CD as PTAD_CODV_CD
				   ,  '' as  INDR_NM     /*  판독예정의 */
				   ,  c.PTAD_CLBA_YMD as PACL_YMD
				   , '' as INTR_PRRN_DT      /*  판독예정의 */
				   ,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') as MDCR_YMD      /*  진료일자   */
				, ''  as SMDV_CD
				   ,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as SMDP_CLSF_CD 
				   ,  c.CHDR_ID as CHDR_ID
				   ,  '' as SCTN_CD
				   ,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y') as MTFR_TKNG_YN
				   ,  c.DYTM_WARD_USE_WNTD_YN as DYTM_WARD_USE_WNTD_YN
				   ,  b.DTLS_EXCF_CD as DTLS_EXCF_CD
				   ,  '' as ASAP_YN
				   ,  c.SLPN_YN as SLPN_PSBL_YN
				   ,  c.MDRP_NO as MDRP_NO
				   ,  fn_sw_decide_instyp_s( c.PTNO, c.ORDR_YMD, c.ORDR_SNO)  as IPDV_NM
				   ,  to_number(substr(
						  fn_sw_bodysize_s(c.PTNO)
						, instr(fn_sw_bodysize_s(c.PTNO),'@',1,2)+1
						, length(fn_sw_bodysize_s(c.PTNO))
						  - instr(fn_sw_bodysize_s(c.PTNO),'@',1,2)
					  ))                                                                as WT
				   ,  to_number(substr(
						  fn_sw_bodysize_s(c.PTNO)
						, 10
						, instr(fn_sw_bodysize_s(c.PTNO),'@',1,2)-10
					  ))                                                                as HT
			   ,  substr(fn_sw_bodysize_s(c.PTNO), 1,4) ||'-'||
				  substr(fn_sw_bodysize_s(c.PTNO), 5,2)||'-'||
				  substr(fn_sw_bodysize_s(c.PTNO), 7,2)       as MSRM_YMD
			   ,  '' as  AFI_ANDV_NM /*  예약구분 */
				, ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = c.MCDP_CD group by ABRV_DPRT_CD ) as MCDP_NM         /*  진료과               */
				, fn_sw_roomcode_s(c.PTNO, c.ORDR_YMD, to_char(c.ORDR_SNO)) as  EXRM_CD_2   /*  이전검사실 */
				, replace(replace(c.EXOR_UNSL_CTN, chr(13), chr(32)), chr(10), chr(32)) as EXOR_UNSL_CTN
				   , c.ORCL_CD as ORCL_CD
					, '' as AFI_AMPR_NM /*  예약자명 */
				   , '' as PRVS_TX_DGST_RCEP_YN
				   ,  c.NNMT_EXMN_YN as NNMT_EXMN_YN         /*  비대면 환자 여부     */
				   ,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /*  비대면검사통보일자   */
				   ,  (select case
								when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'           /*  Drop일자가 현재일까지면 D(Drop) */
								when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
							  end
						from  APRCRPTNT apr
						   ,  MDFASTRPT mdf
					   where  apr.MDRP_NO = c.MDRP_NO
						 and  apr.FATR_CD is not null
						 and  mdf.PTNO = apr.PTNO
						 and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
					   ) as FATR_CD                  /*  신속(Fast Track) */
				   ,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
						, '1', 'Y'
						, null
					  ) as EXMN_WNTD_YMD_DVSN_CD    /*  당일검사 FLAG */
					  , '' as IMLN_CLSF_CD
					  , ''as CLSF_NM   /*  임플란트 분류군 코드 */
					,  '' as EXMN_FALR_RGST_RESN_CTN
					,  '' as PRVS_TX_DGST_CTN
					,  ''as EXMN_ANDV_CD
					,  '' as ABRV_DPRT_CD
					,  '' as CHLD_CALM_YN
					,  (
						 select  F_A.CTRL_DSCR_CTN
						   from  SZCTRLMMT F_A
						  where  F_A.EXMN_CTRL_CD = 'SWA_180'
							and  F_A.EXMN_DTLS_CTRL_CD =c.ORDR_CD
					   ) as APNT_RMRK_CTN/*  진료예약정보(검사별특이사항) */
					,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = c.PTNO) as PTNT_NM
					, '' as DAT_NO 
					, '' as ENFR_DT       /*  83. 실시일시             */ 
					, 'N' as SCND_ORDR_YN  /*  84. 2차처방유무             */ 
					, decode( b.AGDC_NEED_EN ,'Y', FN_SW_EXMAGDC_YN(c.PTNO, c.ORDR_YMD, c.ORDR_SNO, '')
		                                                  ,'N' )  as AGDC_YN /* 85. 동의서여부 */
		    /* , case when  nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD ) 
				                when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
				                else '' end  as CARE_WARD_NM /* 89. 현재병동 */
		    /* , case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) || '/' || l.CARE_PTRM_NO
		          when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		          else '' 
		     end  as CARE_WARD_NM /* 89. 현재병동 */
		       , case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') and c.PTAD_CODV_CD <> 'E' then ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) || '/' || l.CARE_PTRM_NO
		              when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') and c.PTAD_CODV_CD = 'E' then ( select  loc.ERRM_ZONE_NM||'-'||err.SCKB_NO_VL from MNEERRPAT err, MNEERRMZT loc where err.MDRP_NO = c.MDRP_NO and err.ERRM_LCTN_CD = loc.ERRM_LCTN_CD)
		              when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		              else ''   end  as CARE_WARD_NM   /* 89. 현재병동 */
		        , to_char(l.DSCH_DT,'yyyymmddhh24mi')  as DSCH_DT
		   ,  (
						   select fn_sw_decide_instyp_s(
										c.PTNO
									  , c.ORDR_YMD
									  , c.ORDR_SNO
								  )
						   from DUAL
						 )                                                                as IPDV_NM
		   , decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		   , (  select DETL_CD_NM
		          from CCCMCDDMT com
		         where 1=1
		           and com.comn_grp_cd = 'MDP_048'
		           and com.COMN_DTLS_CD = c.ODKI_DETL_CD
		      )  as ODKI_DETL_NM  /* 처방종류상세명  */
		    , null as PRVL_RPTN_YN	
		    , ''     as PTNT_EXMN_NM
		    , ''  as INFT_SMSR_SNDG_CTN 
		    , null  as ETC_MDRP_NO
		    , '' as SCHD_TYP_CD
		    , c.prtb_yn  
		    , c.MCCN_CD
		    ,  ( select F_C.KORN_DPRT_NM from HZDEPTMMT F_C where F_C.DPRT_CD = c.MCCN_CD group by F_C.KORN_DPRT_NM)  as MCCN_NM /*  센터명                 */
			, ( select cc.DETL_CD_DSCR_CTN  from CCCMCDDMT cc  where cc.COMN_GRP_CD = 'MDP_048' and cc.COMN_DTLS_CD = c.ODKI_DETL_CD ) as DETL_CD_DSCR_CTN  /*처방종류상세구분*/
		    , c.PTAD_MDRP_NO
		    , to_char(c.RCPC_DT, 'yyyymmddhh24mi')  as RCPC_DT
		    , (select LISTAGG(x.SCHD_TYP_CD, ', ') WITHIN GROUP (ORDER BY ROWNUM) from SWSCHORDT x where x.excf_cd = c.excf_cd and x.exmn_cd = c.ordr_cd) SCHD_TYP_NM
		    , fn_sr_ward_telno(l.MDRP_NO) ETC_TLNO
		    , '' as NRDR_PSDG_DRUG_CTN
		   , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		from
			 MDEXMORDT c	   
		   , MDORDRCMT b
		   ,  SZCTRLMMT e                       /*  제어코드 */
		   ,  CCUSRDPHT f
		   ,  CCUSRDPHT mo
		   ,  CCUSERAMT mob
		   ,  SZCTRLMMT j
		   ,  APRCRPTNT l
		where  c.PTNO    = #{ptno}                           /*  환자번호             */
		 and  c.EXCF_CD  =  #{excfCd}                        /*  검사분류             */
		 and  c.EXOR_PRSS_CD is null                          /*  진행STATUS(진료지원) */
		 and  c.ORDR_SNO = nvl(#{ordrSno}, c.ORDR_SNO)     /*  처방순번             */
		 and  c.ORDR_CD = b.ORDR_CD                   /*  검사코드             */
		 and  ( (#{dtlsExcfCd}  is null)
							or ( b.DTLS_EXCF_CD = #{dtlsExcfCd} ) )
		 and  (
						   (
							(c.EXCF_CD = 'SY')
				 and  (nvl(c.RCST_CD, 'N') != 'R')
						   )
						   or
						   (
						   c.EXCF_CD != 'SY'
						   )
			  )
		 and  nvl(c.DC_DVSN_CD, 'N') not in ('X', 'Y') 
		 and (  instr(#{ptdvCtn} , c.CODV_CD) > 0 )
		 and  e.EXMN_CTRL_CD     (+) = 'SWA_180'     
		 and  e.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		 and  e.APLY_PART_CD     (+) = c.EXCF_CD
		 and  e.LAST_UPDR_ID = f.USER_ID(+)
		 and  c.ODDR_ID = mo.USER_ID(+)
		 and  mo.LGIN_ID  = mob.LGIN_ID(+)
		 and  j.EXMN_CTRL_CD(+) = 'SR210'
		 and  j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		 and  c.MDRP_NO = l.MDRP_NO
		 and  nvl(c.DC_DVSN_CD, 'N') = 'N'
		 and  (
				 nvl(#{valdHhDvsnCd}, 'Y') = 'N'
				 or
				 c.ORDR_YMD > trunc( sysdate - 365*2)
			  )
		 and  nvl(c.ORFR_CD, 'N') not in ('D', 'P') /* 과내검사 및 임시처방 제외)  */  
		 and  c.TMPR_ORDR_YN = 'N' 
		union  all
		select  /*+ index(a SWWORKMMT_I09) sw17703$S05_조회 */
			  b.APNT_NEED_EN
		    , nvl(a.EXRM_CD, nvl((select ty.EXRM_CD 
						                                        from SWSCHTYPT ty, szroomcmt ro
						                                        where ty.SCHD_TYP_CD    = a.SCHD_TYP_CD  
						                                      and ty.SCHD_DTLS_TYP_CD   = a.SCHD_DTLS_TYP_CD
						                                      and ty.EXCF_CD            = a.EXCF_CD
						                                      and ty.SCHD_DTLS_TYP_CD_USE_YN ='Y'
						                                      and ty.EXCF_CD            = ro.EXCF_CD
						                                      and ty.EXRM_CD            = ro.EXRM_CD), b.OTPT_EXRM_CD)) as  EXRM_CD  /*  검사실코드           */ 
				   ,  nvl(c.RCST_CD, 'N') as EXRM_CD_1 /*  수납여부 */
		   ,  a.SCHD_DTLS_TYP_CD                              /*  스케쥴 SUB TYPE      */
		   , ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CHDR_ID)      /*  지정의사             */
		   ,  mo.USER_NM      /*  2013.07.10 mobile번호->PDANO로 변경 박재연 선생님 요청*/
		   ,  to_char(a.APNT_DT, 'yyyymmddhh24mi')        /*  예약일시             */
		   ,  to_char(a.RPTN_DT, 'yyyymmddhh24mi')        /*  접수일시             */
		   ,  to_char(a.ORDR_YMD, 'yyyymmdd')                                 /*  처방일자             */
		   ,  c.MCDP_CD
		   , b.ORDR_NM as ORDR_NM
		   ,  a.AMPR_ID                                       /*  예약자               */
		   ,  a.ANDV_CD                                       /*  예약구분 중앙: Y     */
		   ,  a.EXMN_CD                               /*  검사코드             */
		   ,  a.PTNO                                  /*  환자번호             */
		   ,  a.ORDR_SNO                              /*  처방순번             */
		   ,  a.EXMN_STTS_CD                                  /*  진행STATUS(진료지원) */
		   ,  b.EXRS_GRP_CD                                   /*  결과그룹 코드        */
		   ,  to_char(l.MDCR_DT, 'yyyymmdd')             /*  입원일자             */
		   ,  a.EXCF_CD                               /*  검사분류             */
		   ,  c.CODV_CD as CODV_CD                                    /*  환자구분             */
		   ,  b.CENT_APNT_PSBL_YN                                     /*  중앙예약가능여부     */
		   ,  decode(a.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L'), nvl(a.ANDV_CD, 'L'))       /*  일정/비일정 예약구분 */
		   ,  a.PACS_ACCS_NO
		   ,  decode(to_char(a.RERN_PRRN_DT, 'dd'), '', 'N', 'Y')     /*  REPEAT 여부   */
		   ,  fn_sr_sidreaction_s(a.PTNO)                /*  SIDE 여부            */
		   ,  RCPS_ID               /*  접수자               */
		   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = a.RCPS_ID)               /*  접수자               */
		   ,  d.TLNO                                  /*  검사실 전화번호      */
		   ,  ( select F_A.ABRV_DPRT_CD from HZDEPTMMT F_A where F_A.DPRT_CD = c.WARD_CD group by F_A.ABRV_DPRT_CD ) /*  병동                 */
		   ,  ( select ABRV_DPRT_CD
		                  from HZDEPTMMT
		                 where DPRT_CD = L.CARE_WARD_CD
		                 group by ABRV_DPRT_CD )   as CARE_WARD_CD  
		   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.EXMN_WNTD_DR_ID)                   /*  희망의              */
		   ,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null, ' <'||to_char(e.LAST_UPDT_DT, 'yyyymmddhh24miss')||' '||f.USER_NM||'>')
		   ,  c.CLRS_PRJC_CD                                  /*  임상연구코드         */
		   ,  c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
		   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
		   ,  to_char(c.WNTD_DT, 'yyyymmdd')        /*  희망일시             */
		   ,  c.ODDR_ID
		   ,  c.ODKI_CD
		   ,  a.BDSD_YN
		   ,  nvl(c.HSLC_DVSN_CD, 'M')
		   ,  nvl(c.MCCN_CD, 'M')
		   ,  a.IMPL_HSDV_CD
		   ,  b.RCEQ_USE_YN
		   ,  c.INPT_USER_DVSN_CD
		   ,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') wntd_dt        /*  예약일시             */
		   ,  decode(c.RISK_FCTR_VL,'1','Pacemaker'
		                           ,'2','심실재동기화 치료 제세동기'
		                           ,'3','체내제세동기'
		                           ,'4','인공와우'
		                           ,'5','캡슐내시경'
		                           ,'6','유방조직확장기'
		                           ,'7','해당없음'
		                           ,'/') as  RISK_FCTR_MEMO_CTN           /*  위험인자 */
		   ,  c.PTAD_CODV_CD
		   ,  a.INTR_PRRN_DR_NM ||'  '|| ( select  USER_NM from CCUSRDPHT where   USER_ID = substr(a.INTR_PRRN_DR_NM, 1, 6))  /*  판독예정의 */
		   ,  c.PTAD_CLBA_YMD
		   ,  to_char(a.INTR_PRRN_DT, 'yyyymmddhh24mi') READTIME
		   ,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') MEDDATE         /*  진료일자   */
				, ''  HOPEDRTYP
		   ,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)
		   ,  c.CHDR_ID
		   ,  ''
		   ,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y')
		   ,  c.DYTM_WARD_USE_WNTD_YN
		   ,  b.DTLS_EXCF_CD
		   ,  a.ASAP_YN
		   ,  c.SLPN_YN
		   ,  c.MDRP_NO
		   ,  fn_sw_decide_instyp_s( a.PTNO, a.ORDR_YMD, a.ORDR_SNO) IPDV_NM
		   ,  to_number(substr(
				  fn_sw_bodysize_s(a.PTNO)
				, instr(fn_sw_bodysize_s(a.PTNO),'@',1,2)+1
				, length(fn_sw_bodysize_s(a.PTNO))
				  - instr(fn_sw_bodysize_s(a.PTNO),'@',1,2)
			  ))                                                               WT
		   ,  to_number(substr(
				  fn_sw_bodysize_s(a.PTNO)
				, 10
				, instr(fn_sw_bodysize_s(a.PTNO),'@',1,2)-10
			  ))                                                               HT
			   ,  substr(fn_sw_bodysize_s(c.PTNO), 1,4) ||'-'||
				  substr(fn_sw_bodysize_s(c.PTNO), 5,2)||'-'||
				  substr(fn_sw_bodysize_s(c.PTNO), 7,2)      MSRM_YMD
			   ,  decode(a.ANDV_CD, 'C', '[통합]'
								  , 'W', '병동'
								  , 'Y', '일반'
								  , 'S',  decode( a.IMPL_HSDV_CD, ''
																, '비일정'
																, '비일정/'|| a.IMPL_HSDV_CD)
								  , ''
						 ) /*  예약구분 */
				, ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = c.MCDP_CD group by ABRV_DPRT_CD ) MCDP_NM   /*  진료과               */
				,  a.EXRM_CD                               /*  검사실코드           */
				,  replace(replace(c.EXOR_UNSL_CTN, chr(13), chr(32)), chr(10), chr(32)) as EXOR_UNSL_CTN
		   , c.ORCL_CD
		   , ( select  USER_NM from CCUSRDPHT where USER_ID = a.AMPR_ID ) /*  예약자명 */
		   , a.PRVS_TX_DGST_RCEP_YN
		   ,  c.NNMT_EXMN_YN                            as NNMT_EXMN_YN         /*  비대면 환자 여부     */
		   ,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /*  비대면검사통보일자   */
		   ,  (select case
						when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'           /*  Drop일자가 현재일까지면 D(Drop) */
						when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
					  end
				from  APRCRPTNT apr
				   ,  MDFASTRPT mdf
			   where  apr.MDRP_NO = a.MDRP_NO
				 and  apr.FATR_CD is not null
				 and  mdf.PTNO = apr.PTNO
				 and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
			   )                                           as FATR_CD                  /*  신속(Fast Track) */
		   ,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
				, '1', 'Y'
				, null
			  )                                           as EXMN_WNTD_YMD_DVSN_CD    /*  당일검사 FLAG */
			  , a.IMLN_CLSF_CD
			  , (select  F_A.TMOT_DVSN_DETL_NM
				   from  MDEITMOCT F_A
				  where  F_A.TMOT_DVSN_CD = '01'
					and  F_A.MCDP_CD = a.MCDP_CD
					and  F_A.TMOT_DVSN_DETL_CD = a.IMLN_CLSF_CD )   /*  임플란트 분류군 코드 */
			,  a.EXMN_FALR_RGST_RESN_CTN
			,  a.PRVS_TX_DGST_CTN
			,  a.EXMN_ANDV_CD
			,  a.ABRV_DPRT_CD
			,  a.CHLD_CALM_YN
			,  (
				 select  F_A.CTRL_DSCR_CTN
				   from  SZCTRLMMT F_A
				  where  F_A.EXMN_CTRL_CD = 'SWA_180'
					and  F_A.EXMN_DTLS_CTRL_CD = a.EXMN_CD
			   )/*  진료예약정보(검사별특이사항) */
			,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = a.PTNO) as PTNT_NM
			,  a.DAT_NO  as DAT_NO 
			,  to_char(a.ENFR_DT, 'yyyymmddhh24mi') as ENFR_DT       /*  83. 실시일시             */ 
			,  (
				   select  case
							 when exists (
														  select  1
															from  SWSNDMAMT
														  where  PTNO = a.PTNO
															 and  ORDR_YMD = a.ORDR_YMD
															and  ORDR_SNO = a.ORDR_SNO
														   )
										then 'Y'
									   else      'N'
									   end
							   from  DUAL
			   )   as   SCND_ORDR_YN  /*  84. 2차처방유무             */ 
					, decode( b.AGDC_NEED_EN ,'Y', FN_SW_EXMAGDC_YN(c.PTNO, c.ORDR_YMD, c.ORDR_SNO, '')
		                                                  ,'N' )  as AGDC_YN /* 85. 동의서여부 */
		    /* , case when  nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD ) 
				                when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
				                else '' end  as CARE_WARD_NM /* 89. 현재병동 */
		    /*, case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) || '/' || l.CARE_PTRM_NO
		          when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		          else '' 
		     end  as CARE_WARD_NM /* 89. 현재병동 */
		       , case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') and c.PTAD_CODV_CD <> 'E' then ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) || '/' || l.CARE_PTRM_NO
		              when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') and c.PTAD_CODV_CD = 'E' then ( select  loc.ERRM_ZONE_NM||'-'||err.SCKB_NO_VL from MNEERRPAT err, MNEERRMZT loc where err.MDRP_NO = c.MDRP_NO and err.ERRM_LCTN_CD = loc.ERRM_LCTN_CD)
		              when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		              else ''   end  as CARE_WARD_NM   /* 89. 현재병동 */
		        , to_char(l.DSCH_DT,'yyyymmddhh24mi')  as DSCH_DT
		   ,  (
						   select fn_sw_decide_instyp_s(
										c.PTNO
									  , c.ORDR_YMD
									  , c.ORDR_SNO
								  )
						   from DUAL
						 )                                                                as IPDV_NM
		   , decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		   , (  select DETL_CD_NM
		          from CCCMCDDMT com
		         where 1=1
		           and com.comn_grp_cd = 'MDP_048'
		           and com.COMN_DTLS_CD = c.ODKI_DETL_CD
		      )  as ODKI_DETL_NM  /* 처방종류상세명  */
		   , a.PRVL_RPTN_YN						PRVL_RPTN_YN	
		   ,''     as PTNT_EXMN_NM
		   ,''  as INFT_SMSR_SNDG_CTN 
		   , a.ETC_MDRP_NO as ETC_MDRP_NO
		   , a.SCHD_TYP_CD as SCHD_TYP_CD
		   , c.prtb_yn 
		   , c.MCCN_CD
		   ,  ( select F_C.KORN_DPRT_NM from HZDEPTMMT F_C where F_C.DPRT_CD = c.MCCN_CD group by F_C.KORN_DPRT_NM)  as MCCN_NM /*  센터명                 */
		   , ( select cc.DETL_CD_DSCR_CTN  from CCCMCDDMT cc  where cc.COMN_GRP_CD = 'MDP_048' and cc.COMN_DTLS_CD = c.ODKI_DETL_CD ) as DETL_CD_DSCR_CTN  /*처방종류상세구분*/
		   , c.PTAD_MDRP_NO
		   , to_char(c.RCPC_DT, 'yyyymmddhh24mi')  as RCPC_DT
		   , (select LISTAGG(x.SCHD_TYP_CD, ', ') WITHIN GROUP (ORDER BY ROWNUM) from SWSCHORDT x where x.excf_cd = c.excf_cd and x.exmn_cd = c.ordr_cd) SCHD_TYP_NM
		    , fn_sr_ward_telno(l.MDRP_NO) ETC_TLNO
		    , '' as NRDR_PSDG_DRUG_CTN
		   , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		from
			  SWWORKMMT a                              /*  검사 WORK 관리 (계속) */
		   ,  MDORDRCMT b
		   ,  MDEXMORDT c
		   ,  SZROOMCMT d
		   ,  SZCTRLMMT e                       /*  제어코드 */
		   ,  CCUSRDPHT f
		   ,  CCUSRDPHT mo
		   ,  CCUSERAMT mob
		   ,  SZCTRLMMT j
		   ,  APRCRPTNT l
		where  a.PTNO    = #{ptno}                           /*  환자번호             */
		 and  a.EXCF_CD  = #{excfCd}                       /*  검사분류             */
		 and  a.EXMN_STTS_CD in ('A', 'C', #{dvsnVl})                    /*  진행STATUS(진료지원) */
		 and  a.EXMN_CD = b.ORDR_CD                   /*  검사코드             */
		 and  ( ( #{dtlsExcfCd} is null)
							or ( b.DTLS_EXCF_CD = #{dtlsExcfCd} ) )
		 and  a.PTNO    = c.PTNO                      /*  환자번호             */
		 and  a.ORDR_SNO = nvl(#{ordrSno}, a.ORDR_SNO)     /*  처방순번             */
		 and  a.ORDR_YMD  = c.ORDR_YMD                        /*  처방일자             */
		 and  a.ORDR_SNO = c.ORDR_SNO                         /*  처방순번             */
		 and  nvl(c.DC_DVSN_CD, 'N') not in ('X', 'Y') 
		 and (  instr(#{ptdvCtn} , c.CODV_CD) > 0 )
		 and  a.EXRM_CD = d.EXRM_CD(+)                /*  검사실코드           */
		 and  a.EXCF_CD  = d.EXCF_CD(+)                       /*  검사분류             */
		 and  e.EXMN_CTRL_CD     (+) = 'SWA_180'                   /*  검사항목별 특이사항 */
		 and  e.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		 and  e.APLY_PART_CD     (+) = a.EXCF_CD
		 and  e.LAST_UPDR_ID = f.USER_ID(+)
		 and  c.ODDR_ID = mo.USER_ID(+)
		 and  mo.LGIN_ID  = mob.LGIN_ID(+)
		 and  j.EXMN_CTRL_CD(+) = 'SR210'
		 and  j.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		 and  c.MDRP_NO = l.MDRP_NO
		 and  nvl(c.DC_DVSN_CD, 'N') = 'N'
		 and  (
				 nvl(#{valdHhDvsnCd}, 'Y') = 'N'
				 or
				 a.ORDR_YMD > trunc( sysdate - 365*2)
			  )
		 and  nvl(c.ORFR_CD, 'N') not in ('D', 'P') /* 과내검사 및 임시처방 제외)  */  
		 and  c.TMPR_ORDR_YN = 'N' 
		order
		  by  9 desc
		   ,  10
		   ,  14
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSW-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="apntYn" column="APNT_YN"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="exrmCd1" column="EXRM_CD_1"/>
		<result property="schdDtlsTypCd" column="SCHD_DTLS_TYP_CD"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="drNm" column="DR_NM"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="amprId" column="AMPR_ID"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="exmnCd" column="EXMN_CD"/>
		<result property="ptno" column="PTNO"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="exrsGrpCd" column="EXRS_GRP_CD"/>
		<result property="admsYmd" column="ADMS_YMD"/>
		<result property="excfCd" column="EXCF_CD"/>
		<result property="ptdvCd" column="PTDV_CD"/>
		<result property="centApntPsblYn" column="CENT_APNT_PSBL_YN"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="pacsAccsNo" column="PACS_ACCS_NO"/>
		<result property="rernYn" column="RERN_YN"/>
		<result property="cnmdUseYn" column="CNMD_USE_YN"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="careWardCd" column="CARE_WARD_CD"/>
		<result property="wntdDrNm" column="WNTD_DR_NM"/>
		<result property="apntRmrkCtn" column="APNT_RMRK_CTN"/>
		<result property="apntRmrkCtn" column="APNT_RMRK_CTN"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="clrsPrjcDrId" column="CLRS_PRJC_DR_ID"/>
		<result property="clrsPrjcDrNm" column="CLRS_PRJC_DR_NM"/>
		<result property="wntdDt" column="WNTD_DT"/>
		<result property="ipdvNm" column="IPDV_NM"/>
		<result property="otrsExmnLnkdCtn" column="OTRS_EXMN_LNKD_CTN"/>
		<result property="befrTxCtn" column="BEFR_TX_CTN"/>
		<result property="exmnSpsbCtn" column="EXMN_SPSB_CTN"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="ptadPtdvCd" column="PTAD_PTDV_CD"/>
		<result property="bdsdYn" column="BDSD_YN"/>
		<result property="emrTrasYn" column="EMR_TRAS_YN"/>
		<result property="ordrLcdvCd" column="ORDR_LCDV_CD"/>
		<result property="cntrCd" column="CNTR_CD"/>
		<result property="implLcdvCd" column="IMPL_LCDV_CD"/>
		<result property="unmdRceqUseYn" column="UNMD_RCEQ_USE_YN"/>
		<result property="userDvsnCd" column="USER_DVSN_CD"/>
		<result property="wntdDt1" column="WNTD_DT_1"/>
		<result property="riskFctrVl" column="RISK_FCTR_VL"/>
		<result property="intrPrrnDrNm" column="INTR_PRRN_DR_NM"/>
		<result property="paclYmd" column="PACL_YMD"/>
		<result property="intrPrrnDt" column="INTR_PRRN_DT"/>
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="smdvCd" column="SMDV_CD"/>
		<result property="smdpClsfCd" column="SMDP_CLSF_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="sctnCd" column="SCTN_CD"/>
		<result property="mtfrTkngYn" column="MTFR_TKNG_YN"/>
		<result property="dytmWardUseWntdYn" column="DYTM_WARD_USE_WNTD_YN"/>
		<result property="dtlsExcfCd" column="DTLS_EXCF_CD"/>
		<result property="asapYn" column="ASAP_YN"/>
		<result property="dgfrNm" column="DGFR_NM"/>
		<result property="exorUnslCtn" column="EXOR_UNSL_CTN"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="afiAmprNm" column="AFI_AMPR_NM"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="nnmtExmnYn" column="NNMT_EXMN_YN"/>
		<result property="nnmtExmnNtfcYmd" column="NNMT_EXMN_NTFC_YMD"/>
		<result property="fatrCd" column="FATR_CD"/>
		<result property="exmnWntdYmdDvsnCd" column="EXMN_WNTD_YMD_DVSN_CD"/>
		<result property="imlnClsfCd" column="IMLN_CLSF_CD"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="exmnAndvCd" column="EXMN_ANDV_CD"/>
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="chldCalmYn" column="CHLD_CALM_YN"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="exrmCd2" column="EXRM_CD_2"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="prvlRptnYn" column="PRVL_RPTN_YN"/>
		<result property="ptntExmnNm" column="PTNT_EXMN_NM"/>
		<result property="finsSmsrSndgCtn" column="FINS_SMSR_SNDG_CTN"/>
		<result property="inftSmsrSndgCtn" column="INFT_SMSR_SNDG_CTN"/>
		<result property="slpnPsblYn" column="SLPN_PSBL_YN"/>
		<result property="schdTypCd" column="SCHD_TYP_CD"/>
		<result property="exmnRqrdHhVl" column="EXMN_RQRD_HH_VL"/>
		<result property="npoHh" column="NPO_HH"/>
		<result property="tlno" column="TLNO"/>
		<result property="intgExrmApntYn" column="INTG_EXRM_APNT_YN"/>
		<result property="afiDywkNm" column="AFI_DYWK_NM"/>
		<result property="afiEtcNm" column="AFI_ETC_NM"/>
		<result property="mccnCd" column="MCCN_CD"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="detlCdDscrCtn" column="DETL_CD_DSCR_CTN"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="rcpcDt" column="RCPC_DT"/>
		<result property="schdTypNm" column="SCHD_TYP_NM"/>
		<result property="cdVl" column="CD_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSW (검사 예약접수 조회 (통합예약-외래)) 
        Description :                                           검사 예약접수 조회 SW
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSW-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSW"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSW-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSW */
		<![CDATA[
		select /*+ LEADING(C) NO_EXPAND */
		       b.APNT_NEED_EN  as APNT_YN                                                                            /* 예약 가능여부 */
		     , decode(c.EXCF_CD, 'SY', 'AR', fn_sw_roomcode_s(c.PTNO, c.ORDR_YMD, to_char(c.ORDR_SNO)))  as EXRM_CD  /* 검사실 코드   */
		     , nvl(c.RCST_CD, 'N')  as EXRM_CD_1            /* 수납여부 */
		     , ''                   as SCHD_DTLS_TYP_CD     /* 예약타입 */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = c.CHDR_ID)  as CHDR_NM     /* 지정의사 */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = c.ODDR_ID)  as DR_NM       /* 처방의사 */
		     , ''  as APNT_DT                               /* 예약일시 */
		     , ''  as RPTN_DT                               /* 접수일시 */
		     , to_char(c.ORDR_YMD,'yyyymmdd')  as ORDR_YMD  /* 처방일자 */
		     , c.MCDP_CD  as MCDP_CD                        /* 진료과   */
		     , decode(c.EXCF_CD, 'SO', decode(nvl(c.PRTB_YN, 'N'), 'Y', '[P]', null), null) ||
		       decode(c.DYTM_WARD_USE_WNTD_YN, 'Y', '(낮병상)', '')||
		       b.ORDR_NM  as ORDR_NM                        /* 처방명   */
		     , ''  as AMPR_ID                               /* 예약자   */
		     , ''  as AFI_ANDV_NM                           /* 예약구분 */
		     , c.ORDR_CD  as EXMN_CD                        /* 검사코드 */
		     , c.PTNO  as PTNO                              /* 환자번호 */
		     , c.ORDR_SNO  as ORDR_SNO                      /* 처방순번 */
		     , c.EXOR_PRSS_CD  as EXMN_PRSS_CD              /* 진행STATUS(진료지원) */
		     , b.EXRS_GRP_CD   as EXRS_GRP_CD               /* 결과그룹 코드 */
		     , to_char(l.MDCR_DT, 'yyyymmdd')  as ADMS_YMD  /* 입원일자 */
		     , c.EXCF_CD  as EXCF_CD                        /* 검사분류 */
		     , c.CODV_CD  as PTDV_CD                        /* 환자구분 */
		     , decode(b.CENT_APNT_PSBL_YN, 'Y', 'Y', '', 'N', 'N')  as CENT_APNT_PSBL_YN  /* 중앙예약가능여부 */
		     , ''  as APNT_FRMT_CD                          /* 일정/비일정 예약구분 */
		     , ''  as PACS_ACCS_NO
		     , ''  as RERN_YN                               /* REPEAT 여부 */
		     , ''  as CNMD_USE_YN                           /* SIDE 여부 */
		     , ''  as RCPS_NM                               /* 접수자 */
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = c.WARD_CD
		         group by ABRV_DPRT_CD)  as WARD_CD         /* 병동 */
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = L.CARE_WARD_CD
		         group by ABRV_DPRT_CD)  as CARE_WARD_CD    /* 현병동 */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = c.EXMN_WNTD_DR_ID)  as WNTD_DR_NM  /* 희망의 */
		     , e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
		                                                      , ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||(select F_A.USER_NM
		                                                                                                                        from CCUSRDPHT F_A
		                                                                                                                       where F_A.USER_ID = e.LAST_UPDR_ID)||'>')
		       as APNT_RMRK_CTN  /*  진료예약정보(검사별특이사항) */
		     , decode(c.CODV_CD, 'G', ''
		                       , 'U', ''
		                       , (select KORN_DPRT_NM
		                            from HZDEPTMMT
		                           where DPRT_CD = b.PTPT_CD
		                             and trunc(sysdate) between APST_YMD and APFN_YMD)
		                         )  as APNT_RMRK_CTN        /* 가야할곳 */
		     , c.CLRS_PRJC_CD  as CLRS_PRJC_CD              /* 임상연구코드 */
		     , c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID        /* 임상연구의사 */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = c.CLRS_PRJC_DR_ID)  as CLRS_PRJC_DR_NM  /* 임상연구의사 */
		     , to_char(c.WNTD_DT,'YYYYMMDD')  as WNTD_DT                 /* 희망일자 */
		     , fn_sw_decide_instyp_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)  as IPDV_NM
		     , b.OTRS_EXMN_LNKD_CTN  as OTRS_EXMN_LNKD_CTN               /* 타검사연계 */
		     , b.BEFR_TX_CTN  as BEFR_TX_CTN                             /* 전처치 */
		     , b.EXMN_SPSB_CTN  as EXMN_SPSB_CTN                         /* 검사특이사항 */
		     , c.ODDR_ID  as ODDR_ID
		     , c.ODKI_CD  as ODKI_CD
		     , c.PTAD_CODV_CD  as PTAD_PTDV_CD
		     , ''  as BDSD_YN
		     , ''  as EMR_TRAS_YN
		     , nvl(c.HSLC_DVSN_CD, 'M')  as ORDR_LCDV_CD
		     , nvl(c.MCCN_CD, 'M')  as CNTR_CD
		     , ''  as IMPL_LCDV_CD
		     , b.RCEQ_USE_YN  as UNMD_RCEQ_USE_YN
		     , c.INPT_USER_DVSN_CD  as USER_DVSN_CD
		     , to_char(c.WNTD_DT, 'yyyymmddhh24mi')  as WNTD_DT_1        /* 희망일시 */
		     , c.RISK_FCTR_VL  as RISK_FCTR_VL                           /* 위험인자 */
		     , ''  as INTR_PRRN_DR_NM                                    /* 판독예정의 */
		     , c.PTAD_CLBA_YMD  as PACL_YMD
		     , ''  as INTR_PRRN_DT
		     , to_char(l.MDCR_DT,'yyyymmddhh24mi')  as MDCR_YMD          /* 진료일자 */
		     , ''  as SMDV_CD
		     , fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)  as SMDP_CLSF_CD
		     , c.CHDR_ID  as CHDR_ID
		     , ''  as SCTN_CD
		     , decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y')  as MTFR_TKNG_YN
		     , c.DYTM_WARD_USE_WNTD_YN  as DYTM_WARD_USE_WNTD_YN
		     , b.DTLS_EXCF_CD  as DTLS_EXCF_CD
		     , ''  as ASAP_YN
		     , nvl(fn_sw_get_stresult(c.PTNO),'')  as DGFR_NM         /* eGFR검사결과 조회 */
		     , c.EXOR_UNSL_CTN  as EXOR_UNSL_CTN
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = c.MCDP_CD
		         group by ABRV_DPRT_CD)  as MCDP_NM                   /* 진료과 */
		     , ''  as AFI_AMPR_NM                                     /* 예약자 */
		     , c.MDRP_NO  as MDRP_NO
		     , c.ORCL_CD  as ORCL_CD
		     , c.NNMT_EXMN_YN  as NNMT_EXMN_YN                        /* 비대면 환자 여부 */
		     , to_char(c.NNMT_EXMN_NTFC_YMD,'YYYYMMDD')  as NNMT_EXMN_NTFC_YMD   /* 비대면검사통보일자 */
		     , (select case when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'
		                    when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101','YYYYMMDD')) > trunc(sysdate) then 'F/T'
		               end
		          from APRCRPTNT apr
		             , MDFASTRPT mdf
		         where apr.MDRP_NO = c.MDRP_NO
		           and apr.FATR_CD is not null
		           and mdf.PTNO = apr.PTNO
		           and mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
		       ) as FATR_CD
		     , decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
		             , '1', 'Y'
		             , null
		       ) as EXMN_WNTD_YMD_DVSN_CD                             /* 당일검사 FLAG */
		     , '' as IMLN_CLSF_CD
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = c.MCCN_CD
		         group by ABRV_DPRT_CD)  as MCCN_NM                   /* 진료과센터명 */
		     , ''  as EXMN_ANDV_CD
		     , ''  as ABRV_DPRT_CD
		     , ''  as CHLD_CALM_YN
		     , (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = c.PTNO)  as PTNT_NM
		     , decode(fn_sw_roomcode_s(c.PTNO, c.ORDR_YMD, to_char(c.ORDR_SNO))
		                              , 'BS2B', ''
		                              , 'BS2D', 'BS2D'  /*  외래심초음파 검사실 */
		                              , nvl(fn_sw_schsubtyp_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO), decode(c.EXCF_CD, 'SO', '', '****')))  as EXRM_CD_2 /* 계산예약타입 */
		     , decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		     , null  as PRVL_RPTN_YN
		     , b.PTNT_EXMN_NM  as PTNT_EXMN_NM
		     , fn_sr_apnt_sms(c.PTNO, to_char(c.ordr_ymd, 'yyyymmdd'), c.ordr_sno)  as FINS_SMSR_SNDG_CTN
		     , b.INFT_SMSR_SNDG_CTN  as INFT_SMSR_SNDG_CTN
		     , c.SLPN_YN  as SLPN_PSBL_YN
		     , ''  as SCHD_TYP_CD
		     , b.EXMN_RQRD_HH_VL  as EXMN_RQRD_HH_VL /* 검사소요시간 */
		     , b.NPO_HH  as NPO_HH /* 금식시간 */
		     , ''  as TLNO /* 검사실 전화번호 */
		     , ''  as INTG_EXRM_APNT_YN /* 통합검사실 예약수행 여부 */
		     , ''  as AFI_DYWK_NM   /* 요일명  */
		     , decode(c.SLPN_YN, 'Y', '수면', 'N', '비수면', '')  as AFI_ETC_NM    /* 기타명  */
		     , c.MCCN_CD  as MCCN_CD  /* 진료센터코드  */
		     , (select F_C.KORN_DPRT_NM from HZDEPTMMT F_C where F_C.DPRT_CD = c.MCCN_CD group by F_C.KORN_DPRT_NM)  as MCCN_NM  /* 센터명 */
		     , (select cc.DETL_CD_DSCR_CTN from CCCMCDDMT cc where cc.COMN_GRP_CD = 'MDP_048' and cc.COMN_DTLS_CD = c.ODKI_DETL_CD)  as DETL_CD_DSCR_CTN  /* 처방종류상세구분 */
		     , c.PTAD_MDRP_NO
		     , to_char(c.RCPC_DT, 'yyyymmddhh24mi')  as RCPC_DT
		     , (select LISTAGG(x.SCHD_TYP_CD, ', ') WITHIN GROUP (ORDER BY ROWNUM) from SWSCHORDT x where x.excf_cd = c.excf_cd and x.exmn_cd = c.ordr_cd)  as SCHD_TYP_NM
		     , FN_MD_GETAGE('', g.BTDT, trunc(sysdate))  as CD_VL
		  from SWORDRCMT b
		     , MDEXMORDT c
		     , SZCTRLMMT e
		     , CCUSRDPHT f
		     , APPTPTNTT g
		     , AIMFMDFET i
		     , SZCTRLMMT j
		     , SRNOCFMCT srn
		     , APRCRPTNT l
		     , MDORDRCMT m
		 where c.PTNO = #{ptno}
		   and c.EXOR_PRSS_CD||'' is null
		   and b.APNT_NEED_EN = 'Y'
		   and c.MCDP_CD = nvl(#{mcdpCd}, c.MCDP_CD)
		   and c.ORDR_YMD >= to_date(nvl(#{strtYmd},'19900101'),'YYYYMMDD')
		   and c.ORDR_YMD <= to_date(nvl(#{fnshYmd},'29991231'),'YYYYMMDD')
		   and c.ORDR_SNO = nvl(#{afiOrdrSnoStr}, c.ORDR_SNO)
		   and c.ORDR_CD = b.ORDR_CD
		   and (
		         (#{dtlsExcfCd} is null)
		         or
		         (b.DTLS_EXCF_CD = #{dtlsExcfCd})
		       )
		   and nvl(c.DC_DVSN_CD, 'N') = 'N'
		   and nvl(c.RCST_CD, '@') <> 'R'                                  /* 환불처방 제외 */
		   and (c.CODV_CD = 'O'                                            /* 외래만 */
		        or
		        c.PTAD_CODV_CD = 'O'                                       /* 원무 내원구분 외래도(퇴원 처방 및 입원 전환 시) */
		        or
		        c.CODV_CD = 'G'                                            /* 일검 */
		        or
		        c.CODV_CD = 'U'                                            /* 종검 */
		       )
		   and not exists (select 'Y'
		                    from SZCTRLMMT
		                   where EXMN_CTRL_CD = 'SR035'
		                     and EXMN_DTLS_CTRL_CD = c.ORDR_CD)
		   and e.EXMN_CTRL_CD     (+) = 'SWA_180'             /*  검사항목별 특이사항 */
		   and e.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		   and e.APLY_PART_CD     (+) = c.EXCF_CD
		   and e.LAST_UPDR_ID = f.USER_ID(+)
		   and g.PTNO = c.PTNO
		   and c.HSLC_DVSN_CD = NVL('',c.HSLC_DVSN_CD)
		   and i.MDFE_CD(+) = c.ORDR_CD
		   and i.APST_YMD(+) <= c.ORDR_YMD
		   and i.APFN_YMD(+) >= c.ORDR_YMD
		   and j.EXMN_CTRL_CD(+) = 'SR210'
		   and j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		   and srn.MCDP_CD(+) = c.MCDP_CD                      /* 진료과 */
		   and srn.ORDR_CD(+) = c.ORDR_CD                      /* 처방코드 */
		   and c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)
		   and c.MDRP_NO = l.MDRP_NO
		   and (nvl(#{valdHhDvsnCd}, 'Y') = 'N'
		        or
		        trunc(sysdate) <= nvl(c.ORDR_VALD_PERD_EXPT_YMD, sysdate)
		       )
		   and m.ORDR_CD = c.ORDR_CD
		   and nvl(c.ORFR_CD,'N') not in ('D', 'P')            /* 과내검사 및 임시처방 제외 */
		   and c.TMPR_ORDR_YN = 'N'
		 union
		select /*+ LEADING(C) NO_EXPAND */
		       b.APNT_NEED_EN
		     , nvl(a.EXRM_CD, nvl((select ty.EXRM_CD
		                             from SWSCHTYPT ty
		                                , szroomcmt ro
		                            where ty.SCHD_TYP_CD = a.SCHD_TYP_CD
		                              and ty.SCHD_DTLS_TYP_CD = a.SCHD_DTLS_TYP_CD
		                              and ty.EXCF_CD = a.EXCF_CD
		                              and ty.SCHD_DTLS_TYP_CD_USE_YN = 'Y'
		                              and ty.EXCF_CD = ro.EXCF_CD
		                              and ty.EXRM_CD = ro.EXRM_CD), b.OTPT_EXRM_CD))  as EXRM_CD
		     , nvl(c.RCST_CD,'N')  as EXRM_CD_1                                /*  수납여부             */
		     , a.SCHD_DTLS_TYP_CD                                              /*  스케쥴 SUB TYPE      */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = decode(a.EXCF_CD,'SO',a.schd_dtls_typ_cd,c.CHDR_ID))  as CHDR_NM /*  지정의사 */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = c.ODDR_ID)  as DR_NM                          /*  처방의사             */
		     , to_char(a.APNT_DT,'yyyymmddhh24mi')  as APNT_DT                 /*  예약일시             */
		     , to_char(a.RPTN_DT,'yyyymmddhh24mi')  as RPTN_DT                 /*  접수일시             */
		     , to_char(a.ORDR_YMD,'yyyymmdd')       as ORDR_YMD                /*  처방일자             */
		     , c.MCDP_CD
		     , decode(c.EXCF_CD, 'SO', decode(nvl(c.PRTB_YN, 'N'), 'Y', '[P]', null), null) ||
		              decode(c.DYTM_WARD_USE_WNTD_YN, 'Y', '(낮병상)', '')|| b.ORDR_NM   as ORDR_NM  /* 처방명 */
		     , a.AMPR_ID                                                       /*  예약자               */
		     , decode(a.ANDV_CD, 'C', '[통]', 'W', '병동', 'Y', '일반', 'S', '비일정', '')  as AFI_ANDV_NM
		                                                                       /*  예약구분             */
		     , a.EXMN_CD                                                       /*  검사코드             */
		     , a.PTNO                                                          /*  환자번호             */
		     , a.ORDR_SNO                                                      /*  처방순번             */
		     , a.EXMN_STTS_CD                                                  /*  진행STATUS(진료지원) */
		     , b.EXRS_GRP_CD                                                   /*  결과그룹 코드        */
		     , to_char(l.MDCR_DT, 'yyyymmdd')  as ADMS_YMD                     /*  입원일자             */
		     , a.EXCF_CD                                                       /*  검사분류             */
		     , c.CODV_CD                                                       /*  환자구분             */
		     , decode(b.CENT_APNT_PSBL_YN, 'Y', 'Y', '', 'Y', 'N')  as CENT_APNT_PSBL_YN /*  중앙예약가능여부     */
		     , decode(a.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L')
		             , nvl(a.ANDV_CD, 'L'))  as APNT_FRMT_CD                   /*  일정/비일정 예약구분 */
		     , a.PACS_ACCS_NO
		     , decode(to_char(a.RERN_PRRN_DT, 'dd'),'','N','Y')  as RERN_YN    /*  REPEAT 여부          */
		     , ''  as CNMD_USE_YN                                              /*  SIDE 여부            */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = a.RCPS_ID)  as RCPS_NM                        /*  접수자               */
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = c.WARD_CD
		         group by ABRV_DPRT_CD)      as WARD_CD                        /*  병동                 */
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = L.CARE_WARD_CD
		         group by ABRV_DPRT_CD)      as CARE_WARD_CD                   /*  현병동               */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = c.EXMN_WNTD_DR_ID)  as WNTD_DR_NM             /*  희망의               */
		     , e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
		                                  , ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||
		                                    (select F_A.USER_NM
		                                       from CCUSRDPHT F_A
		                                      where F_A.USER_ID = e.LAST_UPDR_ID )||'>')  /* 진료예약정보(검사별특이사항) */
		     , decode(a.EXCF_CD, 'SV', decode(nvl(a.IMPL_HSDV_CD, a.HSLC_DVSN_CD), 'C', (select KORN_DPRT_NM
		                                                                                   from HZDEPTMMT
		                                                                                  where DPRT_CD = b.CACN_PTPT_CD
		                                                                                    and trunc(sysdate) between APST_YMD and APFN_YMD)
		                                                                         , (select KORN_DPRT_NM
		                                                                              from HZDEPTMMT
		                                                                             where DPRT_CD = b.PTPT_CD
		                                                                               and trunc(sysdate) between APST_YMD and APFN_YMD)
		                                     )
		                       , nvl(d.EXRM_LCTN_NM, decode(nvl(a.IMPL_HSDV_CD, a.HSLC_DVSN_CD), 'C', (select KORN_DPRT_NM
		                                                                                                 from HZDEPTMMT
		                                                                                                where DPRT_CD = b.CACN_PTPT_CD
		                                                                                                  and trunc(sysdate) between  APST_YMD and APFN_YMD)
		                                                                                       , (select KORN_DPRT_NM
		                                                                                            from HZDEPTMMT
		                                                                                           where DPRT_CD = b.PTPT_CD
		                                                                                             and trunc(sysdate) between APST_YMD and APFN_YMD)
		                                                   )
		                            )
		             )  as TOGO                                                /*  가야할곳             */
		     , c.CLRS_PRJC_CD                                                  /*  임상연구코드         */
		     , c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID                           /*  임상연구의사         */
		     , (select USER_NM from CCUSRDPHT where USER_ID = c.CLRS_PRJC_DR_ID)  as CLRS_PRJC_DR_NM  /* 임상연구의사 */
		     , to_char(c.WNTD_DT, 'YYYYMMDD')  as WNTD_DT                      /*  희망일자             */
		     , fn_sw_decide_instyp_s(a.PTNO,a.ORDR_YMD,a.ORDR_SNO)  as IPDV_NM
		     , b.OTRS_EXMN_LNKD_CTN                                            /*  타검사연계           */
		     , b.BEFR_TX_CTN                                                   /*  전처치               */
		     , b.EXMN_SPSB_CTN                                                 /*  검사특이사항         */
		     , c.ODDR_ID
		     , c.ODKI_CD
		     , c.PTAD_CODV_CD
		     , a.BDSD_YN
		     , ''  as EMR_TRAS_YN
		     , nvl(c.HSLC_DVSN_CD, 'M')  as ORDR_LCDV_CD
		     , nvl(c.MCCN_CD, 'M')  as CNTR_CD
		     , a.IMPL_HSDV_CD
		     , b.RCEQ_USE_YN
		     , c.INPT_USER_DVSN_CD
		     , to_char(c.WNTD_DT, 'yyyymmddhh24mi')  as WNTD_DT_1              /*  희망일시             */
		     , c.RISK_FCTR_VL                                                  /*  위험인자             */
		     , a.INTR_PRRN_DR_NM||'  '|| (select USER_NM
		                                    from CCUSRDPHT
		                                   where USER_ID = substr(a.INTR_PRRN_DR_NM, 1, 6))
		       as INTR_PRRN_DR_NM                                              /* 판독예정의            */
		     , c.PTAD_CLBA_YMD
		     , to_char(a.INTR_PRRN_DT, 'yyyymmddhh24mi')  as INTR_PRRN_DT
		     , to_char(l.MDCR_DT, 'yyyymmddhh24mi')  as MDCR_YMD               /*  진료일시             */
		     , ''  as SMDV_CD
		     , fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)  as SMDP_CLSF_CD
		     , c.CHDR_ID
		     , decode(a.FILM_NO, null, decode(b.CHLD_DVSN_CD, 'Y', decode(sign((sysdate-g.BTDT)/365-18), -1, 'PE'
		                    , decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
		                    , decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
		                    , a.FILM_NO)  as SCTN_CD
		     , decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y')  as MTFR_TKNG_YN
		     , c.DYTM_WARD_USE_WNTD_YN  as DYTM_WARD_USE_WNTD_YN
		     , b.DTLS_EXCF_CD
		     , nvl(a.ASAP_YN, '')  as ASAP_YN
		     , nvl(fn_sw_get_stresult(a.PTNO), '')  as DGFR_NM                 /* eGFR검사결과 조회     */
		     , c.EXOR_UNSL_CTN
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = c.MCDP_CD
		         group by ABRV_DPRT_CD)  as MCDP_NM                            /* 진료과                */
		     , k.USER_NM
		     , c.MDRP_NO
		     , c.ORCL_CD
		     , c.NNMT_EXMN_YN                           as NNMT_EXMN_YN        /*  비대면 환자 여부     */
		     , to_char(c.NNMT_EXMN_NTFC_YMD,'YYYYMMDD') as NNMT_EXMN_NTFC_YMD  /*  비대면검사통보일자   */
		     , (select case when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'
		                    when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
		               end
		          from APRCRPTNT apr
		             , MDFASTRPT mdf
		         where apr.MDRP_NO = a.MDRP_NO
		           and apr.FATR_CD is not null
		           and mdf.PTNO = apr.PTNO
		           and mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
		       )  as FATR_CD
		     , decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X'), '1', 'Y', null)  as EXMN_WNTD_YMD_DVSN_CD    /* 당일검사 FLAG */
		     , a.IMLN_CLSF_CD
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = c.MCCN_CD
		         group by ABRV_DPRT_CD)  as MCCN_NM                            /* 진료과센터명          */
		     , a.EXMN_ANDV_CD
		     , a.ABRV_DPRT_CD
		     , a.CHLD_CALM_YN
		     , (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = a.PTNO)  as PTNT_NM
		     , decode(fn_sw_roomcode_s(a.PTNO, a.ORDR_YMD, to_char(a.ORDR_SNO)), 'BS2B', ''
		                                                                       , 'BS2D', 'BS2D'  /*  외래심초음파 검사실 */
		             , nvl(fn_sw_schsubtyp_s(a.PTNO, a.ORDR_YMD, a.ORDR_SNO), decode(a.EXCF_CD, 'SO', '', '****')))  as EXRM_CD_2 /* 예약타입 */
		     , decode(c.ODKI_DETL_CD,'B','Y','')  as ODKI_DETL_CD /* 입원전검사 유무 */
		     , a.PRVL_RPTN_YN  as PRVL_RPTN_YN
		     , b.PTNT_EXMN_NM  as PTNT_EXMN_NM
		     , fn_sr_apnt_sms(c.PTNO, to_char(c.ordr_ymd, 'yyyymmdd'), c.ordr_sno)  as FINS_SMSR_SNDG_CTN
		     , b.INFT_SMSR_SNDG_CTN  as INFT_SMSR_SNDG_CTN
		     , c.SLPN_YN          as SLPN_PSBL_YN
		     , a.SCHD_TYP_CD      as SCHD_TYP_CD
		     , b.EXMN_RQRD_HH_VL  as EXMN_RQRD_HH_VL /* 검사소요시간 */
		     , b.NPO_HH  as NPO_HH                   /* 금식시간 */
		     , (select TLNO
		          from SZROOMCMT
		         where EXCF_CD = a.EXCF_CD
		           and EXRM_CD = decode(nvl(a.EXMN_STTS_CD, 'A'), 'A', b.OTPT_EXRM_CD, a.EXRM_CD))  AS TLNO /* 검사실 전화번호 */
		     , a.INTG_EXRM_APNT_YN  /*통합검사실 예약수행 여부*/
		     , to_char(a.APNT_DT,'DY')  as AFI_DYWK_NM   /* 요일명  */
		     , decode(c.SLPN_YN,'Y','수면','N','비수면','')  as AFI_ETC_NM    /* 기타명  */
		     , c.MCCN_CD as MCCN_CD  /* 진료센터코드  */
		     , (select F_C.KORN_DPRT_NM from HZDEPTMMT F_C where F_C.DPRT_CD = c.MCCN_CD group by F_C.KORN_DPRT_NM)  as MCCN_NM /* 센터명 */
		     , (select cc.DETL_CD_DSCR_CTN from CCCMCDDMT cc where cc.COMN_GRP_CD = 'MDP_048' and cc.COMN_DTLS_CD = c.ODKI_DETL_CD)  as DETL_CD_DSCR_CTN  /* 처방종류상세구분 */
		     , c.PTAD_MDRP_NO
		     , to_char(c.RCPC_DT,'yyyymmddhh24mi')  as RCPC_DT
		     , (select LISTAGG(x.SCHD_TYP_CD,', ') WITHIN GROUP (ORDER BY ROWNUM) from SWSCHORDT x where x.excf_cd = c.excf_cd and x.exmn_cd = c.ordr_cd) SCHD_TYP_NM
		     , FN_MD_GETAGE('', g.BTDT, trunc(sysdate)) as CD_VL
		  from SWWORKMMT a                                                      /*  검사 WORK 관리 (계속) */
		     , MDEXMORDT c
		     , SWORDRCMT b
		     , SZROOMCMT d
		     , SZCTRLMMT e
		     , CCUSRDPHT f
		     , APPTPTNTT g
		     , AIMFMDFET i
		     , SZCTRLMMT j
		     , SRNOCFMCT srn
		     , CCUSRDPHT k
		     , APRCRPTNT l
		     , MDORDRCMT m
		where c.PTNO = #{ptno}
		  and a.EXMN_STTS_CD = 'A'
		  and b.APNT_NEED_EN = 'Y'
		  and c.MCDP_CD = nvl(#{mcdpCd}, c.MCDP_CD)
		  and c.ORDR_YMD >= to_date(nvl(#{strtYmd}, '19900101'), 'YYYYMMDD')
		  and c.ORDR_YMD <= to_date(nvl(#{fnshYmd}, '29991231'), 'YYYYMMDD')
		  and c.ORDR_SNO = nvl(#{afiOrdrSnoStr}, a.ORDR_SNO)
		  and c.ORDR_CD = b.ORDR_CD
		  and ( ( #{dtlsExcfCd} is null)
		        or
		        ( b.DTLS_EXCF_CD = #{dtlsExcfCd} )
		      )
		  and a.PTNO(+) = c.PTNO
		  and a.ORDR_YMD(+) = c.ORDR_YMD
		  and a.ORDR_SNO(+) = c.ORDR_SNO
		  and nvl(c.DC_DVSN_CD, 'N') = 'N'
		  and nvl(c.RCST_CD, '@') <> 'R'                                  /*  환불처방 제외 */
		  and (c.CODV_CD = 'O'                                            /*  외래만 */
		       or
		       c.PTAD_CODV_CD = 'O'                                       /* 원무 내원구분 외래도(퇴원 처방 및 입원 전환 시) */
		       or
		       c.CODV_CD = 'G'                                            /*  일검 */
		       or
		       c.CODV_CD = 'U'                                            /*  종검 */
		      )
		  and (#{afiOrdrSnoStr} is not null
		       or
		       not exists (select 'Y'
		                     from SZCTRLMMT
		                    where EXMN_CTRL_CD = 'SR035'
		                      and EXMN_DTLS_CTRL_CD = c.ORDR_CD)
		      )
		  and d.EXRM_CD(+) = a.EXRM_CD
		  and d.EXCF_CD(+) = a.EXCF_CD
		  and e.EXMN_CTRL_CD     (+) = 'SWA_180'
		  and e.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		  and e.APLY_PART_CD     (+) = a.EXCF_CD
		  and e.LAST_UPDR_ID = f.USER_ID(+)
		  and c.HSLC_DVSN_CD = NVL(#{hslcDvsnCd},c.HSLC_DVSN_CD)
		  and g.PTNO = c.PTNO
		  and i.MDFE_CD(+) = c.ORDR_CD
		  and i.APST_YMD(+) <= c.ORDR_YMD
		  and i.APFN_YMD(+) >= c.ORDR_YMD
		  and j.EXMN_CTRL_CD(+) = 'SR210'
		  and j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		  and srn.MCDP_CD(+) = c.MCDP_CD
		  and srn.ORDR_CD(+) = c.ORDR_CD
		  and c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)
		  and a.AMPR_ID = k.USER_ID(+)
		  and c.MDRP_NO = l.MDRP_NO
		  and (nvl(#{valdHhDvsnCd}, 'Y') = 'N'
		       or
		       trunc(sysdate) <= nvl(c.ORDR_VALD_PERD_EXPT_YMD, sysdate)
		      )
		  and m.ORDR_CD = c.ORDR_CD
		 union
		select /*+ LEADING(C) NO_EXPAND */
		       b.APNT_NEED_EN
		     , nvl(a.EXRM_CD, nvl((select ty.EXRM_CD
		                             from SWSCHTYPT ty, szroomcmt ro
		                            where ty.SCHD_TYP_CD        = a.SCHD_TYP_CD
		                              and ty.SCHD_DTLS_TYP_CD   = a.SCHD_DTLS_TYP_CD
		                              and ty.EXCF_CD            = a.EXCF_CD
		                              and ty.SCHD_DTLS_TYP_CD_USE_YN = 'Y'
		                              and ty.EXCF_CD            = ro.EXCF_CD
		                              and ty.EXRM_CD            = ro.EXRM_CD), b.OTPT_EXRM_CD))  as EXRM_CD
		     , nvl(c.RCST_CD, 'N')  as EXRM_CD_1
		     , a.SCHD_DTLS_TYP_CD                                              /*  스케쥴 SUB TYPE      */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = decode(a.EXCF_CD, 'SO', a.schd_dtls_typ_cd, c.CHDR_ID))  as CHDR_NM /* 지정의사 */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = c.ODDR_ID)  as DR_NM                          /*  처방의사             */
		     , to_char(a.APNT_DT, 'yyyymmddhh24mi')  as APNT_DT                /*  예약일시             */
		     , to_char(a.RPTN_DT, 'yyyymmddhh24mi')  as RPTN_DT                /*  접수일시             */
		     , to_char(a.ORDR_YMD, 'yyyymmdd')  as ORDR_YMD                    /*  처방일자             */
		     , c.MCDP_CD
		     , decode(c.EXCF_CD, 'SO', decode(nvl(c.PRTB_YN, 'N'), 'Y', '[P]', null), null) ||
		                               decode(c.DYTM_WARD_USE_WNTD_YN, 'Y', '(낮병상)', '') || b.ORDR_NM  as ORDR_NM /* 처방명 */
		     , a.AMPR_ID                                                       /*  예약자               */
		     , decode(a.ANDV_CD,'C','[통]','W','병동','Y','일반','S','비일정','')  as AFI_ANDV_NM /* 예약구분 */
		     , a.EXMN_CD                                                       /*  검사코드             */
		     , a.PTNO                                                          /*  환자번호             */
		     , a.ORDR_SNO                                                      /*  처방순번             */
		     , a.EXMN_STTS_CD                                                  /*  진행STATUS(진료지원) */
		     , b.EXRS_GRP_CD                                                   /*  결과그룹 코드        */
		     , to_char(l.MDCR_DT, 'yyyymmdd')  as ADMS_YMD                     /*  입원일자             */
		     , a.EXCF_CD                                                       /*  검사분류             */
		     , c.CODV_CD                                                       /*  환자구분             */
		     , decode(b.CENT_APNT_PSBL_YN, 'Y', 'Y', '', 'Y', 'N') as CENT_APNT_PSBL_YN /* 중앙예약여부 */
		     , decode(a.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L')
		                            , nvl(a.ANDV_CD, 'L'))  as APNT_FRMT_CD    /*  일정/비일정 예약구분 */
		     , a.PACS_ACCS_NO
		     , decode(to_char(a.RERN_PRRN_DT, 'dd'), '', 'N', 'Y')  as RERN_YN /*  REPEAT 여부          */
		     , fn_sr_sidreaction_s(a.PTNO)  as CNMD_USE_YN                     /*  SIDE 여부            */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = a.RCPS_ID)  as RCPS_NM                        /*  접수자               */
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = c.WARD_CD
		         group by ABRV_DPRT_CD)  as WARD_CD                            /*  병동                 */
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = L.CARE_WARD_CD
		         group by ABRV_DPRT_CD)  as CARE_WARD_CD                       /*  현병동               */
		     , (select USER_NM
		          from CCUSRDPHT
		         where USER_ID = c.EXMN_WNTD_DR_ID)  as WNTD_DR_NM             /*  희망의               */
		     , e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
		                                                      , ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||
		                                                        (select F_A.USER_NM
		                                                           from CCUSRDPHT F_A
		                                                          where F_A.USER_ID = e.LAST_UPDR_ID)||'>')
		       as APNT_RMRK_CTN /* 진료예약정보(검사별특이사항) */
		     , decode(c.CODV_CD, 'G', '', 'U', ''
		                       , (select KORN_DPRT_NM
		                            from HZDEPTMMT
		                           where DPRT_CD = b.PTPT_CD
		                             and trunc(sysdate) between APST_YMD and APFN_YMD)
		             )  as APNT_RMRK_CTN                                       /*  가야할곳             */
		     , c.CLRS_PRJC_CD                                                  /*  임상연구코드         */
		     , c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID                           /*  임상연구의사         */
		     , (select USER_NM from CCUSRDPHT where USER_ID = c.CLRS_PRJC_DR_ID)  as CLRS_PRJC_DR_NM     /* 임상연구의사         */
		     , to_char(c.WNTD_DT,'YYYYMMDD')  as WNTD_DT                       /*  희망일자             */
		     , fn_sw_decide_instyp_s( a.PTNO,a.ORDR_YMD,a.ORDR_SNO)  as IPDV_NM
		     , b.OTRS_EXMN_LNKD_CTN                                            /*  타검사연계           */
		     , b.BEFR_TX_CTN                                                   /*  전처치               */
		     , b.EXMN_SPSB_CTN                                                 /*  검사특이사항         */
		     , c.ODDR_ID
		     , c.ODKI_CD
		     , c.PTAD_CODV_CD
		     , a.BDSD_YN
		     , ''  as EMR_TRAS_YN
		     , nvl(c.HSLC_DVSN_CD, 'M')  as ORDR_LCDV_CD
		     , nvl(c.MCCN_CD, 'M')  as CNTR_CD
		     , a.IMPL_HSDV_CD
		     , b.RCEQ_USE_YN
		     , c.INPT_USER_DVSN_CD
		     , to_char(c.WNTD_DT, 'yyyymmddhh24mi')  as WNTD_DT_1              /*  희망일시             */
		     , c.RISK_FCTR_VL                                                  /*  위험인자             */
		     , a.INTR_PRRN_DR_NM ||'  '
		                         ||(select USER_NM
		                              from CCUSRDPHT
		                             where USER_ID = substr(a.INTR_PRRN_DR_NM,1,6))  as INTR_PRRN_DR_NM /* 판독예정의 */
		     , c.PTAD_CLBA_YMD  as PACL_YMD
		     , to_char(a.INTR_PRRN_DT,'yyyymmddhh24mi')  as INTR_PRRN_DT
		     , to_char(l.MDCR_DT,'yyyymmddhh24mi')  as MDCR_YMD
		     , ''  as SMDV_CD
		     , fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)  as SMDP_CLSF_CD
		     , c.CHDR_ID
		     , decode(a.FILM_NO, null, decode(b.CHLD_DVSN_CD, 'Y', decode(sign((sysdate-g.BTDT)/365-18), -1, 'PE'
		                             , decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
		                             , decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
		                             , a.FILM_NO)  as SCTN_CD
		     , decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y')  as MTFR_TKNG_YN
		     , c.DYTM_WARD_USE_WNTD_YN
		     , b.DTLS_EXCF_CD
		     , nvl(a.ASAP_YN, '')  as ASAP_YN
		     , nvl(fn_sw_get_stresult(a.PTNO), '')  as DGFR_NM                 /* eGFR검사결과 조회     */
		     , c.EXOR_UNSL_CTN
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = c.MCDP_CD
		         group by ABRV_DPRT_CD)  as MCDP_NM                            /*  진료과               */
		     , k.USER_NM
		     , c.MDRP_NO
		     , c.ORCL_CD
		     , c.NNMT_EXMN_YN                            as NNMT_EXMN_YN       /*  비대면 환자 여부     */
		     , to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD /*  비대면검사통보일자   */
		     , (select case when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'
		                    when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
		               end
		          from APRCRPTNT apr
		             , MDFASTRPT mdf
		         where apr.MDRP_NO = a.MDRP_NO
		           and apr.FATR_CD is not null
		           and mdf.PTNO = apr.PTNO
		           and mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
		       )  as FATR_CD
		     , decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X'), '1', 'Y', null)  as EXMN_WNTD_YMD_DVSN_CD
		     , a.IMLN_CLSF_CD
		     , (select ABRV_DPRT_CD
		          from HZDEPTMMT
		         where DPRT_CD = c.MCCN_CD
		         group by ABRV_DPRT_CD)  as MCCN_NM                            /*  진료과센터명         */
		     , a.EXMN_ANDV_CD
		     , a.ABRV_DPRT_CD
		     , a.CHLD_CALM_YN
		     , (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = a.PTNO)  as PTNT_NM
		     , decode(fn_sw_roomcode_s(a.PTNO,a.ORDR_YMD,to_char(a.ORDR_SNO)),'BS2B','','BS2D','BS2D'  /* 외래심초음파 검사실 */
		             , nvl(fn_sw_schsubtyp_s(a.PTNO, a.ORDR_YMD, a.ORDR_SNO), decode(a.EXCF_CD, 'SO', '', '****')))  as EXRM_CD_2 /* 예약타입 */
		     , decode(c.ODKI_DETL_CD,'B','Y','')  as ODKI_DETL_CD /* 입원전검사 유무 */
		     , a.PRVL_RPTN_YN  as PRVL_RPTN_YN
		     , b.PTNT_EXMN_NM  as PTNT_EXMN_NM
		     , fn_sr_apnt_sms(c.PTNO, to_char(c.ordr_ymd, 'yyyymmdd'), c.ordr_sno)  as FINS_SMSR_SNDG_CTN
		     , b.INFT_SMSR_SNDG_CTN  as INFT_SMSR_SNDG_CTN
		     , c.SLPN_YN          as SLPN_PSBL_YN
		     , a.SCHD_TYP_CD      as SCHD_TYP_CD
		     , b.EXMN_RQRD_HH_VL  as EXMN_RQRD_HH_VL /* 검사소요시간 */
		     , b.NPO_HH           as NPO_HH /* 금식시간 */
		     , (SELECT TLNO FROM SZROOMCMT WHERE EXCF_CD = a.EXCF_CD and EXRM_CD = decode(nvl(a.EXMN_STTS_CD, 'A'), 'A', b.OTPT_EXRM_CD, a.EXRM_CD)) AS TLNO  /* 검사실 전화번호 */
		     , a.INTG_EXRM_APNT_YN /* 통합검사실 예약수행 여부 */
		     , to_char(a.APNT_DT,'DY')  as AFI_DYWK_NM   /* 요일명  */
		     , decode(c.SLPN_YN,'Y','수면','N','비수면','')  as AFI_ETC_NM    /* 기타명 */
		     , c.MCCN_CD  as MCCN_CD  /* 진료센터코드 */
		     , (select F_C.KORN_DPRT_NM from HZDEPTMMT F_C where F_C.DPRT_CD = c.MCCN_CD group by F_C.KORN_DPRT_NM)  as MCCN_NM /* 센터명 */
		     , (select cc.DETL_CD_DSCR_CTN  from CCCMCDDMT cc  where cc.COMN_GRP_CD = 'MDP_048' and cc.COMN_DTLS_CD = c.ODKI_DETL_CD)  as DETL_CD_DSCR_CTN /* 처방종류상세구분 */
		     , c.PTAD_MDRP_NO
		     , to_char(c.RCPC_DT,'yyyymmddhh24mi')  as RCPC_DT
		     , (select LISTAGG(x.SCHD_TYP_CD, ', ') WITHIN GROUP (ORDER BY ROWNUM) from SWSCHORDT x where x.excf_cd = c.excf_cd and x.exmn_cd = c.ordr_cd) as SCHD_TYP_NM
		     , FN_MD_GETAGE('', g.BTDT, trunc(sysdate))  as CD_VL
		  from SWWORKMMT a                                                      /*  검사 WORK 관리 (계속) */
		     , MDEXMORDT c
		     , SWORDRCMT b
		     , SZROOMCMT d
		     , SZCTRLMMT e
		     , CCUSRDPHT f
		     , APPTPTNTT g
		     , AIMFMDFET i
		     , SZCTRLMMT j
		     , SRNOCFMCT srn
		     , CCUSRDPHT k
		     , APRCRPTNT l
		     , MDORDRCMT m
		 where c.PTNO = #{ptno}
		   and a.EXMN_STTS_CD >= 'C'
		   and #{apntYn} = 'Y'
		   and b.APNT_NEED_EN = 'Y'
		   and not (a.EXMN_CD like 'BE2%' or a.EXMN_CD like 'BE3%') /*  당뇨교육제외           */
		   and c.MCDP_CD = nvl(#{mcdpCd}, c.MCDP_CD)      /*  진료과               */
		   and c.ORDR_YMD >= to_date(nvl(#{strtYmd} , '19900101'), 'YYYYMMDD')
		   and c.ORDR_YMD <= to_date(nvl(#{fnshYmd} , '29991231'), 'YYYYMMDD')
		   and c.ORDR_SNO = nvl(#{afiOrdrSnoStr}, a.ORDR_SNO)     /*  처방순번             */
		   and c.ORDR_CD = b.ORDR_CD                                           /*  검사코드             */
		   and ((#{dtlsExcfCd} is null)
		        or
		        (b.DTLS_EXCF_CD = #{dtlsExcfCd})
		       )
		   and a.PTNO(+) = c.PTNO
		   and a.ORDR_YMD(+) = c.ORDR_YMD
		   and a.ORDR_SNO(+) = c.ORDR_SNO
		   and nvl(c.DC_DVSN_CD, 'N') = 'N'
		   and nvl(c.RCST_CD, '@') <> 'R'                                  /*  환불처방 제외 */
		   and (c.CODV_CD = 'O'                                            /*  외래만 */
		        or
		        c.PTAD_CODV_CD = 'O'                                       /* 원무 내원구분 외래도(퇴원 처방 및 입원 전환 시) */
		        or
		        c.CODV_CD = 'G'                                            /*  일검 */
		        or
		        c.CODV_CD = 'U'                                            /*  종검 */
		       )
		   and (#{afiOrdrSnoStr} is not null
		        or
		        not exists (select 'Y'
		                      from SZCTRLMMT
		                     where EXMN_CTRL_CD = 'SR035'
		                       and EXMN_DTLS_CTRL_CD = c.ORDR_CD)
		       )
		   and d.EXRM_CD(+) = a.EXRM_CD
		   and d.EXCF_CD(+) = a.EXCF_CD
		   and e.EXMN_CTRL_CD     (+) = 'SWA_180'
		   and e.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		   and e.APLY_PART_CD     (+) = a.EXCF_CD
		   and e.LAST_UPDR_ID = f.USER_ID(+)
		   and c.HSLC_DVSN_CD = NVL(#{hslcDvsnCd},c.HSLC_DVSN_CD)
		   and g.PTNO = c.PTNO
		   and i.MDFE_CD(+) = c.ORDR_CD
		   and i.APST_YMD(+) <= c.ORDR_YMD
		   and i.APFN_YMD(+) >= c.ORDR_YMD
		   and j.EXMN_CTRL_CD(+) = 'SR210'
		   and j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		   and srn.MCDP_CD(+) = c.MCDP_CD
		   and srn.ORDR_CD(+) = c.ORDR_CD
		   and c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)
		   and a.AMPR_ID = k.USER_ID(+)
		   and c.MDRP_NO = l.MDRP_NO
		   and (nvl(#{valdHhDvsnCd}, 'Y') = 'N'
		        or
		        trunc(sysdate) <= nvl(c.ORDR_VALD_PERD_EXPT_YMD, sysdate)
		       )
		   and m.ORDR_CD = c.ORDR_CD
		 order
		    by 22 desc /* 중앙예약여부 */
		     , 9  desc /* 처방일자     */
		     , 17      /* 진행 STATUS  */
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSM-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="apntYn" column="APNT_YN"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="exrmCd1" column="EXRM_CD_1"/>
		<result property="schdDtlsTypCd" column="SCHD_DTLS_TYP_CD"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="drNm" column="DR_NM"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="amprId" column="AMPR_ID"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="exmnCd" column="EXMN_CD"/>
		<result property="ptno" column="PTNO"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="exrsGrpCd" column="EXRS_GRP_CD"/>
		<result property="admsYmd" column="ADMS_YMD"/>
		<result property="excfCd" column="EXCF_CD"/>
		<result property="ptdvCd" column="PTDV_CD"/>
		<result property="centApntPsblYn" column="CENT_APNT_PSBL_YN"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="pacsAccsNo" column="PACS_ACCS_NO"/>
		<result property="rernYn" column="RERN_YN"/>
		<result property="cnmdUseYn" column="CNMD_USE_YN"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="tlno" column="TLNO"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="careWardCd" column="CARE_WARD_CD"/>
		<result property="wntdDrId" column="WNTD_DR_ID"/>
		<result property="apntRmrkCtn" column="APNT_RMRK_CTN"/>
		<result property="apntRmrkCtn" column="APNT_RMRK_CTN"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="clrsPrjcDrId" column="CLRS_PRJC_DR_ID"/>
		<result property="clrsPrjcDrNm" column="CLRS_PRJC_DR_NM"/>
		<result property="wntdDt" column="WNTD_DT"/>
		<result property="ipdvNm" column="IPDV_NM"/>
		<result property="otrsExmnLnkdCtn" column="OTRS_EXMN_LNKD_CTN"/>
		<result property="befrTxCtn" column="BEFR_TX_CTN"/>
		<result property="exmnSpsbCtn" column="EXMN_SPSB_CTN"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="ptadPtdvCd" column="PTAD_PTDV_CD"/>
		<result property="bdsdYn" column="BDSD_YN"/>
		<result property="emrTrasYn" column="EMR_TRAS_YN"/>
		<result property="ordrLcdvCd" column="ORDR_LCDV_CD"/>
		<result property="cntrCd" column="CNTR_CD"/>
		<result property="implLcdvCd" column="IMPL_LCDV_CD"/>
		<result property="unmdRceqUseYn" column="UNMD_RCEQ_USE_YN"/>
		<result property="userDvsnCd" column="USER_DVSN_CD"/>
		<result property="wntdDt1" column="WNTD_DT_1"/>
		<result property="riskFctrVl" column="RISK_FCTR_VL"/>
		<result property="intrPrrnDrNm" column="INTR_PRRN_DR_NM"/>
		<result property="paclYmd" column="PACL_YMD"/>
		<result property="intrPrrnDt" column="INTR_PRRN_DT"/>
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="smdvCd" column="SMDV_CD"/>
		<result property="smdpClsfCd" column="SMDP_CLSF_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="sctnCd" column="SCTN_CD"/>
		<result property="mtfrTkngYn" column="MTFR_TKNG_YN"/>
		<result property="dytmWardUseWntdYn" column="DYTM_WARD_USE_WNTD_YN"/>
		<result property="dtlsExcfCd" column="DTLS_EXCF_CD"/>
		<result property="asapYn" column="ASAP_YN"/>
		<result property="dgfrNm" column="DGFR_NM"/>
		<result property="exorUnslCtn" column="EXOR_UNSL_CTN"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="afiAmprNm" column="AFI_AMPR_NM"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="nnmtExmnYn" column="NNMT_EXMN_YN"/>
		<result property="nnmtExmnNtfcYmd" column="NNMT_EXMN_NTFC_YMD"/>
		<result property="fatrCd" column="FATR_CD"/>
		<result property="exmnWntdYmdDvsnCd" column="EXMN_WNTD_YMD_DVSN_CD"/>
		<result property="imlnClsfCd" column="IMLN_CLSF_CD"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="exmnAndvCd" column="EXMN_ANDV_CD"/>
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="chldCalmYn" column="CHLD_CALM_YN"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="exrmCd2" column="EXRM_CD_2"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="prvlRptnYn" column="PRVL_RPTN_YN"/>
		<result property="ptntExmnNm" column="PTNT_EXMN_NM"/>
		<result property="inftSmsrSndgCtn" column="INFT_SMSR_SNDG_CTN"/>
		<result property="exmnRqrdHhVl" column="EXMN_RQRD_HH_VL"/>
		<result property="npoHh" column="NPO_HH"/>
		<result property="tlno" column="TLNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSM (검사 예약접수 조회 SM) 
        Description :                                           검사 예약접수 조회 SM
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSM-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSM"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSM-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSM */
		<![CDATA[
				   select  /*+ NO_EXPAND LEADING(G, A, B, C, L) USE_NL(A, B, C, D, E, F, G, I, J, SRN, K, L) INDEX(A (PTNO)) OPT_PARAM('_OPTIMIZER_COST_BASED_TRANSFORMATION','OFF') swd_workmmt_l44$S01_검사 예약접수 조회 SW */
			            b.APNT_NEED_EN as APNT_YN                                              /*  예약 가능여부  */
		             ,  b.OTPT_EXRM_CD as EXRM_CD /*  검사실 코드        */
		             ,  nvl(c.RCST_CD, 'N') as EXRM_CD_1            /*  수납여부           */
		             ,  decode(fn_sw_roomcode_s( c.PTNO, c.ORDR_YMD, to_char(c.ORDR_SNO))
		                            , 'BS2B', ''
		                            , 'BS2D', 'BS2D'  /*  외래심초음파 검사실 */
		                            , nvl(fn_sw_schsubtyp_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO), decode(c.EXCF_CD, 'SO', '', '****'))) as SCHD_DTLS_TYP_CD /*  예약타입                       */
		            ,  ( select USER_NM
		                   from CCUSRDPHT
		                  where USER_ID = c.CHDR_ID) as CHDR_NM                               /*  지정의사             */
		            ,  ( select USER_NM
		                   from CCUSRDPHT
		                  where USER_ID = c.ODDR_ID) as DR_NM                               /*  처방의사             */
		            ,  '' as APNT_DT                        /*  예약일시             */
		            ,  '' as RPTN_DT                        /*  접수일시             */
		            ,  to_char(c.ORDR_YMD, 'yyyymmdd') as ORDR_YMD                             /*  처방일자             */
		            ,  c.MCDP_CD as MCDP_CD                                                   /*  진료과               */
		            ,  b.ORDR_NM  as ORDR_NM     /*  처방명               */
		            ,  '' as AMPR_ID                                                /*  예약자               */
		            ,  '' as AFI_ANDV_NM                                           /*  예약구분             */
		            ,  c.ORDR_CD  as EXMN_CD                                                /*  검사코드             */
		            ,  c.PTNO as PTNO                                                        /*  환자번호             */
		            ,  c.ORDR_SNO  as ORDR_SNO                                                 /*  처방순번             */
		            ,  c.EXOR_PRSS_CD  as EXMN_PRSS_CD                                             /*  진행STATUS(진료지원) */
		            ,  b.EXRS_GRP_CD  as EXRS_GRP_CD                                           /*  결과그룹 코드        */
		            ,  to_char(l.MDCR_DT, 'yyyymmdd') as ADMS_YMD                               /*  입원일자             */
		            ,  c.EXCF_CD  as EXCF_CD                                                         /*  검사분류             */
		            ,  c.CODV_CD   as PTDV_CD                                          /*  환자구분             */
		            ,  decode(b.CENT_APNT_PSBL_YN, 'Y', 'Y', '', 'Y', 'N')  as CENT_APNT_PSBL_YN        /*  중앙예약가능여부     */
		            ,  ''  as APNT_FRMT_CD               /*  일정/비일정 예약구분 */
		            ,  '' as PACS_ACCS_NO
		            ,  ''  as RERN_YN          /*  REPEAT 여부         */
		            ,  fn_sr_sidreaction_s(c.PTNO)    as CNMD_USE_YN                        /*  SIDE 여부           */
		            ,  '' as RCPS_NM                              /*  접수자               */
		            /*,  fn_sw_roomtelno_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)  as TLNO*/     /*  검사실 전화번호      */
		            ,  ( select ABRV_DPRT_CD
		                   from HZDEPTMMT
		                  where DPRT_CD = c.WARD_CD
		                  group by ABRV_DPRT_CD )   as WARD_CD                       /*  병동                 */
					,  ( select ABRV_DPRT_CD
		                   from HZDEPTMMT
		                  where DPRT_CD = L.CARE_WARD_CD
		                  group by ABRV_DPRT_CD )   as CARE_WARD_CD                       /*  현병동                 */
		            ,  ( select USER_NM
		                   from CCUSRDPHT
		                  where USER_ID = c.EXMN_WNTD_DR_ID)  as WNTD_DR_ID                   /*  희망의               */
		            ,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
		                                                , ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||( select F_A.USER_NM
		                                                                                                                   from CCUSRDPHT F_A
		                                                                                                                  where F_A.USER_ID = e.LAST_UPDR_ID )||'>') 
		                                                                                                                   as APNT_RMRK_CTN  /*  진료예약정보(검사별특이사항) */
		            ,  decode(c.CODV_CD, 'G', ''
		                               , 'U', ''
		                                    , ( select KORN_DPRT_NM
		                                        from HZDEPTMMT
		                                        where DPRT_CD = b.PTPT_CD
		                                        and trunc(sysdate) between  APST_YMD and APFN_YMD )                                         
		                     )  as APNT_RMRK_CTN    /*  가야할곳   */
		            ,  c.CLRS_PRJC_CD  as CLRS_PRJC_CD                                                    /*  임상연구코드         */
		               ,  c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
		               ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
		            ,  to_char(c.WNTD_DT, 'YYYYMMDD') as WNTD_DT                                     /*  희망일시             */
		            ,  fn_sw_decide_instyp_s( c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as IPDV_NM      /*  2014-01-08 이종찬 - [C14010002657]  */
		            ,  b.OTRS_EXMN_LNKD_CTN as OTRS_EXMN_LNKD_CTN                                               /*  타검사연계           */
		            ,  b.BEFR_TX_CTN as BEFR_TX_CTN                                                      /*  전처치               */
		            ,  b.EXMN_SPSB_CTN as EXMN_SPSB_CTN                                                    /*  검사특이사항         */
		            ,  c.ODDR_ID as ODDR_ID
		            ,  c.ODKI_CD as ODKI_CD
		            ,  c.PTAD_CODV_CD as PTAD_PTDV_CD
		            ,  '' as BDSD_YN
		            ,  '' as EMR_TRAS_YN
		            ,  nvl(c.HSLC_DVSN_CD, 'M') as ORDR_LCDV_CD
		            ,  nvl(c.MCCN_CD, 'M') as CNTR_CD
		            ,  '' as IMPL_LCDV_CD
		            ,  b.RCEQ_USE_YN as UNMD_RCEQ_USE_YN
		            ,  c.INPT_USER_DVSN_CD as USER_DVSN_CD
		            ,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') as WNTD_DT_1                       /*  예약일시             */
		            ,  c.RISK_FCTR_VL as RISK_FCTR_VL                                                     /*  위험인자             */
		            ,  '' as INTR_PRRN_DR_NM       /*  판독예정의 */
		            ,  c.PTAD_CLBA_YMD as PACL_YMD
		            ,  ''  as INTR_PRRN_DT
		            ,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') as MDCR_YMD                       /*  진료일자             */
		             , ''  as SMDV_CD
		            ,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as SMDP_CLSF_CD
		            ,  c.CHDR_ID as CHDR_ID
		            ,  '' as SCTN_CD
		            ,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y') as MTFR_TKNG_YN
		            ,  c.DYTM_WARD_USE_WNTD_YN as DYTM_WARD_USE_WNTD_YN
		            ,  b.DTLS_EXCF_CD as DTLS_EXCF_CD
		            ,  '' as ASAP_YN
		            ,  nvl(fn_sw_get_stresult(c.PTNO), '') as DGFR_NM        /* BL312002 검사 수치 조회*/
		            ,  c.EXOR_UNSL_CTN as EXOR_UNSL_CTN                               /*  [C13010000775] 2013-02-15 MRI검사실 연규진 */
		            , ( select ABRV_DPRT_CD
		                  from HZDEPTMMT
		                 where DPRT_CD = c.MCDP_CD
		                 group by ABRV_DPRT_CD ) as MCDP_NM                                   /*  진료과               */
		            ,  '' as AFI_AMPR_NM                                                           /*  예약자               */
		            ,  c.MDRP_NO as MDRP_NO
		            ,  c.ORCL_CD as ORCL_CD
		            ,  c.NNMT_EXMN_YN as NNMT_EXMN_YN         /*  비대면 환자 여부     */
		            ,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /*  비대면검사통보일자   */
		            ,  (select case
		                         when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'
		                         when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
		                       end
		                 from  APRCRPTNT apr
		                    ,  MDFASTRPT mdf
		                where  apr.MDRP_NO = c.MDRP_NO
		                  and  apr.FATR_CD is not null
		                  and  mdf.PTNO = apr.PTNO
		                  and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
		                ) as FATR_CD
		            ,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
		                 , '1', 'Y'
		                 , null
		               ) as EXMN_WNTD_YMD_DVSN_CD    /*  당일검사 FLAG */
		            ,  '' as IMLN_CLSF_CD
		            ,  ( select ABRV_DPRT_CD
		                   from HZDEPTMMT
		                  where DPRT_CD = c.MCCN_CD
		                  group by ABRV_DPRT_CD ) as MCCN_NM                                   /*  진료과센터명                 */
		            ,  '' as EXMN_ANDV_CD
		            ,  '' as ABRV_DPRT_CD
		            ,  '' as CHLD_CALM_YN
		            ,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = c.PTNO) as PTNT_NM
		            ,  decode(fn_sw_roomcode_s( c.PTNO, c.ORDR_YMD, to_char(c.ORDR_SNO))
		                            , 'BS2B', ''
		                            , 'BS2D', 'BS2D'  /*  외래심초음파 검사실 */
		                            , nvl(fn_sw_schsubtyp_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO), decode(c.EXCF_CD, 'SO', '', '****'))) as EXRM_CD_2 /*  계산예약타입                       */
		            ,  decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		            ,  null as PRVL_RPTN_YN	
		            ,  b.PTNT_EXMN_NM  as PTNT_EXMN_NM
		            ,  b.INFT_SMSR_SNDG_CTN  as INFT_SMSR_SNDG_CTN
		            ,  b.EXMN_RQRD_HH_VL as EXMN_RQRD_HH_VL /*검사소요시간*/
				   	,  b.NPO_HH as NPO_HH /*금식시간*/
					,  '' as TLNO /*검사실 전화번호*/ 
		 from
			   SWORDRCMT b
			,  MDEXMORDT c 
			,  SZCTRLMMT e     /*  제어코드 */
			,  CCUSRDPHT f
			,  APPTPTNTT g
			,  AIMFMDFET i
			,  SZCTRLMMT j
			,  SRNOCFMCT srn 
			,  APRCRPTNT l
		where  c.PTNO = #{ptno}                           /*  환자번호             */
		  and  c.EXOR_PRSS_CD||'' is null                          /*  진행STATUS(진료지원) */
		  and  b.APNT_NEED_EN = 'Y' 
		  and  c.MCDP_CD = nvl(#{mcdpCd}, c.MCDP_CD)      /*  진료과               */
		  and  c.ORDR_YMD >= to_date(nvl(#{strtYmd}, '19900101'), 'YYYYMMDD')
		  and  c.ORDR_YMD <= to_date(nvl(#{fnshYmd}, '29991231'), 'YYYYMMDD')
		  and  c.ORDR_SNO = nvl(#{afiOrdrSnoStr}, c.ORDR_SNO)     /*  처방순번             */
		  and  c.ORDR_CD = b.ORDR_CD
		  and  (
				 ( #{dtlsExcfCd} is null)
				 or
				 ( b.DTLS_EXCF_CD = #{dtlsExcfCd} )
			   ) 
		  and  nvl(c.DC_DVSN_CD, 'N') = 'N'
		  and  nvl(c.RCST_CD, '@') <> 'R'                                    /*  환불처방 제외 */
		  and  c.CODV_CD in ('G', 'U')     /* 검진처방만 */
		  and  not exists (select 'Y'
							 from SZCTRLMMT
							where EXMN_CTRL_CD = 'SR035'
							  and EXMN_DTLS_CTRL_CD = c.ORDR_CD)
		  and  e.EXMN_CTRL_CD     (+) = 'SWA_180'             /*  검사항목별 특이사항 */
		  and  e.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		  and  e.APLY_PART_CD     (+) = c.EXCF_CD
		  and  e.LAST_UPDR_ID = f.USER_ID(+)
		  and  g.PTNO = c.PTNO
		  and  c.HSLC_DVSN_CD = NVL('',c.HSLC_DVSN_CD)
		  and  i.MDFE_CD(+) = c.ORDR_CD
		  and  i.APST_YMD(+) <= c.ORDR_YMD
		  and  i.APFN_YMD(+) >= c.ORDR_YMD
		  and  j.EXMN_CTRL_CD(+) = 'SR210'
		  and  j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		  and  srn.MCDP_CD(+) = c.MCDP_CD                      /*  진료과               */
		  and  srn.ORDR_CD(+) = c.ORDR_CD                      /*  처방코드             */
		  and  c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)
		  and  c.MDRP_NO = l.MDRP_NO
		  and  (
				  c.ORDR_YMD < to_date('20160702', 'yyyymmdd')                          /*  처방 유효기간 다윈 오픈전 처방은 예외처리(통합예약) */
				  or
				  nvl('', 'Y') = 'N'
				  or
				  trunc(sysdate) <= nvl(c.ORDR_VALD_PERD_EXPT_YMD, c.ORDR_YMD + 365*2)
			   )
		union
				   select  /*+ NO_EXPAND LEADING(G, A, B, C, L) USE_NL(A, B, C, D, E, F, G, I, J, SRN, K, L) INDEX(A (PTNO)) #2 */
			   b.APNT_NEED_EN
			,  a.EXRM_CD                                                       /*  검사실코드           */
			,  nvl(c.RCST_CD, 'N')                /*  수납여부             */
			,  a.SCHD_DTLS_TYP_CD                                              /*  스케쥴 SUB TYPE    */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = decode(a.EXCF_CD, 'SO', a.schd_dtls_typ_cd, c.CHDR_ID) )                                   /*  지정의사             */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = c.ODDR_ID)                                   /*  처방의사             */
			,  to_char(a.APNT_DT, 'yyyymmddhh24mi')                            /*  예약일시             */
			,  to_char(a.RPTN_DT, 'yyyymmddhh24mi')                            /*  접수일시             */
			,  to_char(a.ORDR_YMD, 'yyyymmdd')                                 /*  처방일자             */
			,  c.MCDP_CD
			,  b.ORDR_NM 
			,  a.AMPR_ID                                                       /*  예약자               */
			,  decode(a.ANDV_CD , 'C', '[통합]', 'W', '병동', 'Y', '일반', 'S', '비일정', '')
																			   /*  예약구분             */
			,  a.EXMN_CD                                                       /*  검사코드             */
			,  a.PTNO                                                          /*  환자번호             */
			,  a.ORDR_SNO                                                      /*  처방순번             */
			,  a.EXMN_STTS_CD                                                  /*  진행STATUS(진료지원) */
			,  b.EXRS_GRP_CD                                                   /*  결과그룹 코드        */
			,  to_char(l.MDCR_DT, 'yyyymmdd')                                  /*  입원일자             */
			,  a.EXCF_CD                                                       /*  검사분류             */
			,  c.CODV_CD                                                       /*  환자구분             */
			,  decode(b.CENT_APNT_PSBL_YN, 'Y', 'Y', '', 'Y', 'N')             /*  중앙예약가능여부     */
			,  decode(a.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L')
										, nvl(a.ANDV_CD, 'L'))                 /*  일정/비일정 예약구분 */
			,  a.PACS_ACCS_NO
			,  decode(to_char(a.RERN_PRRN_DT, 'dd'), '', 'N', 'Y')             /*  REPEAT 여부          */
			,  fn_sr_sidreaction_s(a.PTNO)                              /*  SIDE 여부            */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = a.RCPS_ID)                                   /*  접수자               */
			/*,  decode(a.EXCF_CD, 'SV', decode(nvl(a.IMPL_HSDV_CD, c.HSLC_DVSN_CD), 'C', '2633'
																					  , '2620')
									 , d.TLNO)*/                                 /*  검사실 전화번호      */
			,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				  where DPRT_CD = c.WARD_CD
				  group by ABRV_DPRT_CD ) WARD_CD                              /*  병동                 */
			,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				  where DPRT_CD = L.CARE_WARD_CD
				  group by ABRV_DPRT_CD )   as CARE_WARD_CD                       /*  현병동                 */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = c.EXMN_WNTD_DR_ID)                           /*  희망의               */
			,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
												 , ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||( select F_A.USER_NM
																													from CCUSRDPHT F_A
																												   where F_A.USER_ID = e.LAST_UPDR_ID )||'>') /*  진료예약정보(검사별특이사항) */
			,  decode(a.EXCF_CD, 'SV', decode(nvl(a.IMPL_HSDV_CD, a.HSLC_DVSN_CD), 'C', ( select KORN_DPRT_NM
																							from HZDEPTMMT
																						   where DPRT_CD = b.CACN_PTPT_CD
																							 and trunc(sysdate) between  APST_YMD and APFN_YMD )
																					  , ( select KORN_DPRT_NM
																							from HZDEPTMMT
																						   where DPRT_CD = b.PTPT_CD
																							 and trunc(sysdate) between  APST_YMD and APFN_YMD )
											 )
									 , nvl(d.EXRM_LCTN_NM, decode(nvl(a.IMPL_HSDV_CD, a.HSLC_DVSN_CD), 'C', ( select KORN_DPRT_NM
																												from HZDEPTMMT
																											   where DPRT_CD = b.CACN_PTPT_CD
																												 and trunc(sysdate) between  APST_YMD and APFN_YMD )
																										  , ( select KORN_DPRT_NM
																												from HZDEPTMMT
																											   where DPRT_CD = b.PTPT_CD
																												 and trunc(sysdate) between  APST_YMD and APFN_YMD )
																)
										  )
					  ) as TOGO         /*  가야할곳   */
			,  c.CLRS_PRJC_CD                                                    /*  임상연구코드         */
		    ,  c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
		    ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
			,  to_char(c.WNTD_DT, 'YYYYMMDD')                                    /*  희망일시             */
			,  fn_sw_decide_instyp_s( a.PTNO, a.ORDR_YMD, a.ORDR_SNO) IPDV_NM   /*  2014-01-08 이종찬 - [C14010002657]  */
			,  b.OTRS_EXMN_LNKD_CTN                                              /*  타검사연계           */
			,  b.BEFR_TX_CTN                                                     /*  전처치               */
			,  b.EXMN_SPSB_CTN                                                   /*  검사특이사항         */
			,  c.ODDR_ID
			,  c.ODKI_CD
			,  c.PTAD_CODV_CD
			,  a.BDSD_YN
			,  ''
			,  nvl(c.HSLC_DVSN_CD, 'M')
			,  nvl(c.MCCN_CD, 'M')
			,  a.IMPL_HSDV_CD
			,  b.RCEQ_USE_YN
			,  c.INPT_USER_DVSN_CD
			,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') wntd_dt                     /*  예약일시             */
			,  c.RISK_FCTR_VL                                                   /*  위험인자             */
			,  a.INTR_PRRN_DR_NM ||'  '|| ( select USER_NM
											  from CCUSRDPHT
											 where USER_ID = substr(a.INTR_PRRN_DR_NM, 1, 6))      /*  판독예정의 */
			,  c.PTAD_CLBA_YMD
			,  to_char(a.INTR_PRRN_DT, 'yyyymmddhh24mi') READTIME
			,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') MEDDATE                     /*  진료일자             */
			, ''  HOPEDRTYP
			,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)
			,  c.CHDR_ID
			,  decode(a.FILM_NO, null, decode(b.CHLD_DVSN_CD, 'Y', decode(sign((sysdate-g.BTDT)/365-18), -1, 'PE'
											, decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
											, decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
											, a.FILM_NO)
			,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y')
			,  c.DYTM_WARD_USE_WNTD_YN
			,  b.DTLS_EXCF_CD
			,  nvl(a.ASAP_YN, '')
			,  nvl(fn_sw_get_stresult(a.PTNO), '')        /* BL312002 검사 수치 조회*/
			,  c.EXOR_UNSL_CTN                         /*  [C13010000775] 2013-02-15 MRI검사실 연규진 */
			, ( select  ABRV_DPRT_CD
				  from HZDEPTMMT
				 where DPRT_CD = c.MCDP_CD
				 group by ABRV_DPRT_CD ) MCDP_CM                                      /*  진료과               */
			, k.USER_NM
			, c.MDRP_NO
			, c.ORCL_CD
			,  c.NNMT_EXMN_YN                            as NNMT_EXMN_YN         /*  비대면 환자 여부     */
			,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /*  비대면검사통보일자   */
			,  (select case
						 when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'
						 when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
					   end
				 from  APRCRPTNT apr
					 ,  MDFASTRPT mdf
				where  apr.MDRP_NO = a.MDRP_NO
				  and  apr.FATR_CD is not null
				  and  mdf.PTNO = apr.PTNO
				  and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
				)                                           as FATR_CD
			,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
				 , '1', 'Y'
				 , null
			   )                                           as EXMN_WNTD_YMD_DVSN_CD    /*  당일검사 FLAG */
			,  a.IMLN_CLSF_CD
			,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				   where DPRT_CD = c.MCCN_CD
				   group
					  by ABRV_DPRT_CD ) MCCN_NM                                   /*  진료과센터명                 */
			,  a.EXMN_ANDV_CD
			,  a.ABRV_DPRT_CD
			,  a.CHLD_CALM_YN
			,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = a.PTNO)
			,  decode(fn_sw_roomcode_s( a.PTNO, a.ORDR_YMD, to_char(a.ORDR_SNO))
							, 'BS2B', ''
							, 'BS2D', 'BS2D'  /*  외래심초음파 검사실 */
							, nvl(fn_sw_schsubtyp_s(a.PTNO, a.ORDR_YMD, a.ORDR_SNO), decode(a.EXCF_CD, 'SO', '', '****'))) /*  계산예약타입                       */
		   , decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		   , a.PRVL_RPTN_YN						PRVL_RPTN_YN
		   , b.PTNT_EXMN_NM  as PTNT_EXMN_NM	
		   , b.INFT_SMSR_SNDG_CTN  as INFT_SMSR_SNDG_CTN
		   ,  b.EXMN_RQRD_HH_VL as EXMN_RQRD_HH_VL /*검사소요시간*/
		   ,  b.NPO_HH as NPO_HH /*금식시간*/
		   ,  (SELECT TLNO FROM SZROOMCMT WHERE EXCF_CD = a.EXCF_CD and EXRM_CD = decode(nvl(a.EXMN_STTS_CD, 'A'), 'A', b.OTPT_EXRM_CD, a.EXRM_CD)) AS TLNO /*검사실 전화번호*/	
		from
			   SWWORKMMT a                                                      /*  검사 WORK 관리 (계속) */
			,  MDEXMORDT c
			,  SWORDRCMT b
			,  SZROOMCMT d
			,  SZCTRLMMT e
			,  CCUSRDPHT f
			,  APPTPTNTT g
			,  AIMFMDFET i
			,  SZCTRLMMT j
			,  SRNOCFMCT srn
			,  CCUSRDPHT k
			,  APRCRPTNT l
		where  c.PTNO    = #{ptno}                                           /*  환자번호             */
		  and  a.EXMN_STTS_CD = 'A'                                          /*  진행STATUS(진료지원) */
		  and  b.APNT_NEED_EN = 'Y'
		  and  c.MCDP_CD = nvl(#{mcdpCd}, c.MCDP_CD)      /*  진료과               */
		  and  c.ORDR_YMD >= to_date(nvl(#{strtYmd} , '19900101'), 'YYYYMMDD')
		  and  c.ORDR_YMD <= to_date(nvl(#{fnshYmd} , '29991231'), 'YYYYMMDD')
		  and  c.ORDR_SNO = nvl(#{afiOrdrSnoStr}, a.ORDR_SNO)     /*  처방순번             */
		  and  c.ORDR_CD = b.ORDR_CD                                           /*  검사코드             */
		  and  (
				 ( #{dtlsExcfCd} is null)
				 or
				 ( b.DTLS_EXCF_CD = #{dtlsExcfCd} )
			   )
		  and  a.PTNO(+)    = c.PTNO                                              /*  환자번호             */
		  and  a.ORDR_YMD(+)  = c.ORDR_YMD                                        /*  처방일자             */
		  and  a.ORDR_SNO(+) = c.ORDR_SNO                                         /*  처방순번             */
		  and  nvl(c.DC_DVSN_CD, 'N') = 'N'
		  and  nvl(c.RCST_CD, '@') <> 'R'                                    /*  환불처방 제외 */
		  and  c.CODV_CD in ('G', 'U')     /* 검진처방만 */
		  and  (  #{afiOrdrSnoStr} is not null
				  or
				  not exists (select 'Y'
							 from SZCTRLMMT
							where EXMN_CTRL_CD = 'SR035'
							  and EXMN_DTLS_CTRL_CD = c.ORDR_CD)
			   )
		  and  d.EXRM_CD(+) = a.EXRM_CD                                      /*  검사실코드           */
		  and  d.EXCF_CD(+) = decode(a.EXRM_CD, 'EN7', 'SO', a.EXCF_CD)      /*  검사분류             */
		  and  e.EXMN_CTRL_CD     (+) = 'SWA_180'                   /*  검사항목별 특이사항 */
		  and  e.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		  and  e.APLY_PART_CD     (+) = a.EXCF_CD
		  and  e.LAST_UPDR_ID = f.USER_ID(+)
		  and  c.HSLC_DVSN_CD = NVL(#{hslcDvsnCd},c.HSLC_DVSN_CD)
		  and  g.PTNO = c.PTNO
		  and  i.MDFE_CD(+) = c.ORDR_CD
		  and  i.APST_YMD(+) <= c.ORDR_YMD
		  and  i.APFN_YMD(+) >= c.ORDR_YMD
		  and  j.EXMN_CTRL_CD(+) = 'SR210'
		  and  j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		  and  srn.MCDP_CD(+) = c.MCDP_CD                      /*  진료과               */
		  and  srn.ORDR_CD(+) = c.ORDR_CD                      /*  처방코드             */
		  and  c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)
		  and  a.AMPR_ID = k.USER_ID(+)
		  and  c.MDRP_NO = l.MDRP_NO
		  and  (
				  c.ORDR_YMD < to_date('20160702', 'yyyymmdd')                          /*  처방 유효기간 다윈 오픈전 처방은 예외처리(통합예약) */
				  or
				  nvl(#{valdHhDvsnCd}, 'Y') = 'N'
				  or
				  trunc(sysdate) <= nvl(c.ORDR_VALD_PERD_EXPT_YMD, c.ORDR_YMD + 365*2)
			   )
		union
				   select  /*+ NO_EXPAND LEADING(G, A, B, C, L) USE_NL(A, B, C, D, E, F, G, I, J, SRN, K, L) INDEX(A (PTNO)) #3 */
			   b.APNT_NEED_EN
			,  a.EXRM_CD                                                       /*  검사실코드           */
			,  nvl(c.RCST_CD, 'N')                /*  수납여부             */
			,  a.SCHD_DTLS_TYP_CD                                              /*  스케쥴 SUB TYPE    */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = decode(a.EXCF_CD, 'SO', a.schd_dtls_typ_cd, c.CHDR_ID))                                   /*  지정의사             */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = c.ODDR_ID)                                   /*  처방의사             */
			,  to_char(a.APNT_DT, 'yyyymmddhh24mi')                            /*  예약일시             */
			,  to_char(a.RPTN_DT, 'yyyymmddhh24mi')                            /*  접수일시             */
			,  to_char(a.ORDR_YMD, 'yyyymmdd')                                 /*  처방일자             */
			,  c.MCDP_CD
			,  decode(a.EXCF_CD, 'SO', decode(nvl(c.PRTB_YN, 'N'), 'Y', '[P]', null), null) ||
			   decode(c.DYTM_WARD_USE_WNTD_YN, 'Y', '(낮병상)', '')||b.CLNC_PTHL_ORDR_SHRT_NM
			,  a.AMPR_ID                                                       /*  예약자               */
			,  decode(a.ANDV_CD , 'C', '[통합]', 'W', '병동', 'Y', '일반', 'S', '비일정', '')
																			   /*  예약구분             */
			,  a.EXMN_CD                                                       /*  검사코드             */
			,  a.PTNO                                                          /*  환자번호             */
			,  a.ORDR_SNO                                                      /*  처방순번             */
			,  a.EXMN_STTS_CD                                                  /*  진행STATUS(진료지원) */
			,  b.EXRS_GRP_CD                                                   /*  결과그룹 코드        */
			,  to_char(l.MDCR_DT, 'yyyymmdd')                                  /*  입원일자             */
			,  a.EXCF_CD                                                       /*  검사분류             */
			,  c.CODV_CD                                                       /*  환자구분             */
			,  decode(b.CENT_APNT_PSBL_YN, 'Y', 'Y', '', 'Y', 'N')             /*  중앙예약가능여부     */
			,  decode(a.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L')
										, nvl(a.ANDV_CD, 'L'))                 /*  일정/비일정 예약구분 */
			,  a.PACS_ACCS_NO
			,  decode(to_char(a.RERN_PRRN_DT, 'dd'), '', 'N', 'Y')             /*  REPEAT 여부          */
			,  fn_sr_sidreaction_s(a.PTNO)                              /*  SIDE 여부            */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = a.RCPS_ID)                                   /*  접수자               */
			/*,  decode(a.EXCF_CD, 'SV', decode(nvl(a.IMPL_HSDV_CD, c.HSLC_DVSN_CD), 'C', '2633'
																					  , '2620')
									 , d.TLNO)*/                                 /*  검사실 전화번호      */
			,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				  where DPRT_CD = c.WARD_CD
				  group by ABRV_DPRT_CD ) WARD_CD                              /*  병동                 */
		    ,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				  where DPRT_CD = L.CARE_WARD_CD
				  group by ABRV_DPRT_CD )   as CARE_WARD_CD                       /*  현병동                 */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = c.EXMN_WNTD_DR_ID)                           /*  희망의               */
			,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
												 , ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||( select F_A.USER_NM
																													from CCUSRDPHT F_A
																												   where F_A.USER_ID = e.LAST_UPDR_ID )||'>') /*  진료예약정보(검사별특이사항) */
		    ,  decode(c.CODV_CD, 'G', ''
		                        , 'U', ''
		                            , ( select KORN_DPRT_NM
		                                from HZDEPTMMT
		                                where DPRT_CD = b.PTPT_CD
		                                and trunc(sysdate) between  APST_YMD and APFN_YMD )                                         
		                )  as APNT_RMRK_CTN    /*  가야할곳   */
			,  c.CLRS_PRJC_CD                                                    /*  임상연구코드         */
		    ,  c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
		    ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
			,  to_char(c.WNTD_DT, 'YYYYMMDD')                                    /*  희망일시             */
			,  fn_sw_decide_instyp_s( a.PTNO, a.ORDR_YMD, a.ORDR_SNO) IPDV_NM   /*  2014-01-08 이종찬 - [C14010002657]  */
			,  b.OTRS_EXMN_LNKD_CTN                                              /*  타검사연계           */
			,  b.BEFR_TX_CTN                                                     /*  전처치               */
			,  b.EXMN_SPSB_CTN                                                   /*  검사특이사항         */
			,  c.ODDR_ID
			,  c.ODKI_CD
			,  c.PTAD_CODV_CD
			,  a.BDSD_YN
			,  ''
			,  nvl(c.HSLC_DVSN_CD, 'M')
			,  nvl(c.MCCN_CD, 'M')
			,  a.IMPL_HSDV_CD
			,  b.RCEQ_USE_YN
			,  c.INPT_USER_DVSN_CD
			,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') wntd_dt                     /*  예약일시             */
			,  c.RISK_FCTR_VL                                                   /*  위험인자             */
			,  a.INTR_PRRN_DR_NM ||'  '|| ( select USER_NM
											  from CCUSRDPHT
											 where USER_ID = substr(a.INTR_PRRN_DR_NM, 1, 6))      /*  판독예정의 */
			,  c.PTAD_CLBA_YMD
			,  to_char(a.INTR_PRRN_DT, 'yyyymmddhh24mi') READTIME
			,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') MEDDATE                     /*  진료일자             */
			, ''  HOPEDRTYP
			,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)
			,  c.CHDR_ID
			,  decode(a.FILM_NO, null, decode(b.CHLD_DVSN_CD, 'Y', decode(sign((sysdate-g.BTDT)/365-18), -1, 'PE'
											, decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
											, decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
											, a.FILM_NO)
			,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y')
			,  c.DYTM_WARD_USE_WNTD_YN
			,  b.DTLS_EXCF_CD
			,  nvl(a.ASAP_YN, '')
			,  nvl(fn_sw_get_stresult(a.PTNO), '')        /* BL312002 검사 수치 조회*/
			,  c.EXOR_UNSL_CTN                         /*  [C13010000775] 2013-02-15 MRI검사실 연규진 */
			, ( select  ABRV_DPRT_CD
				  from HZDEPTMMT
				 where DPRT_CD = c.MCDP_CD
				 group by ABRV_DPRT_CD ) MCDP_CM                                      /*  진료과               */
			, k.USER_NM
			, c.MDRP_NO
			, c.ORCL_CD
			,  c.NNMT_EXMN_YN                            as NNMT_EXMN_YN         /*  비대면 환자 여부     */
			,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /*  비대면검사통보일자   */
			,  (select case
						 when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'
						 when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
					   end
				 from  APRCRPTNT apr
					 ,  MDFASTRPT mdf
				where  apr.MDRP_NO = a.MDRP_NO
				  and  apr.FATR_CD is not null
				  and  mdf.PTNO = apr.PTNO
				  and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
				)                                           as FATR_CD
			,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
				 , '1', 'Y'
				 , null
			   )                                           as EXMN_WNTD_YMD_DVSN_CD    /*  당일검사 FLAG */
			,  a.IMLN_CLSF_CD
			,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				   where DPRT_CD = c.MCCN_CD
				   group
					  by ABRV_DPRT_CD ) MCCN_NM                                   /*  진료과센터명                 */
			,  a.EXMN_ANDV_CD
			,  a.ABRV_DPRT_CD
			,  a.CHLD_CALM_YN
			,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = a.PTNO)
			,  decode(fn_sw_roomcode_s( a.PTNO, a.ORDR_YMD, to_char(a.ORDR_SNO))
							, 'BS2B', ''
							, 'BS2D', 'BS2D'  /*  외래심초음파 검사실 */
							, nvl(fn_sw_schsubtyp_s(a.PTNO, a.ORDR_YMD, a.ORDR_SNO), decode(a.EXCF_CD, 'SO', '', '****'))) /*  계산예약타입                       */
		    ,  decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		    ,  a.PRVL_RPTN_YN						PRVL_RPTN_YN	
		    ,  b.PTNT_EXMN_NM  as PTNT_EXMN_NM
		    ,  b.INFT_SMSR_SNDG_CTN  as INFT_SMSR_SNDG_CTN
		    ,  b.EXMN_RQRD_HH_VL as EXMN_RQRD_HH_VL /*검사소요시간*/
		    ,  b.NPO_HH as NPO_HH /*금식시간*/
		    ,  (SELECT TLNO FROM SZROOMCMT WHERE EXCF_CD = a.EXCF_CD and EXRM_CD = decode(nvl(a.EXMN_STTS_CD, 'A'), 'A', b.OTPT_EXRM_CD, a.EXRM_CD)) AS TLNO /*검사실 전화번호*/   
		from
			   SWWORKMMT a                                                      /*  검사 WORK 관리 (계속) */
			,  MDEXMORDT c
			,  SWORDRCMT b
			,  SZROOMCMT d
			,  SZCTRLMMT e
			,  CCUSRDPHT f
			,  APPTPTNTT g
			,  AIMFMDFET i
			,  SZCTRLMMT j
			,  SRNOCFMCT srn
			,  CCUSRDPHT k
			,  APRCRPTNT l
		where  c.PTNO    = #{ptno}                                           /*  환자번호             */
		  and  a.EXMN_STTS_CD >= 'C'                                          /*  진행STATUS(진료지원) */
		  and  #{apntYn} = 'Y'
		  and  b.APNT_NEED_EN = 'Y'
		  and  c.MCDP_CD = nvl(#{mcdpCd}, c.MCDP_CD)      /*  진료과               */
		  and  c.ORDR_YMD >= to_date(nvl(#{strtYmd} , '19900101'), 'YYYYMMDD')
		  and  c.ORDR_YMD <= to_date(nvl(#{fnshYmd} , '29991231'), 'YYYYMMDD')
		  and  c.ORDR_SNO = nvl(#{afiOrdrSnoStr}, a.ORDR_SNO)     /*  처방순번             */
		  and  c.ORDR_CD = b.ORDR_CD                                           /*  검사코드             */
		  and  (
				 ( #{dtlsExcfCd} is null)
				 or
				 ( b.DTLS_EXCF_CD = #{dtlsExcfCd} )
			   )
		  and  a.PTNO(+)    = c.PTNO                                              /*  환자번호             */
		  and  a.ORDR_YMD(+)  = c.ORDR_YMD                                        /*  처방일자             */
		  and  a.ORDR_SNO(+) = c.ORDR_SNO                                         /*  처방순번             */
		  and  nvl(c.DC_DVSN_CD, 'N') = 'N'
		  and  nvl(c.RCST_CD, '@') <> 'R'                                    /*  환불처방 제외 */
		  and  c.CODV_CD in ('G', 'U')     /* 검진처방만 */
		  and  (  #{afiOrdrSnoStr} is not null
				  or
				  not exists (select 'Y'
							 from SZCTRLMMT
							where EXMN_CTRL_CD = 'SR035'
							  and EXMN_DTLS_CTRL_CD = c.ORDR_CD)
			   )
		  and  d.EXRM_CD(+) = a.EXRM_CD                                      /*  검사실코드           */
		  and  d.EXCF_CD(+) = a.EXCF_CD                                       /*  검사분류             */
		  and  e.EXMN_CTRL_CD     (+) = 'SWA_180'                   /*  검사항목별 특이사항 */
		  and  e.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		  and  e.APLY_PART_CD     (+) = a.EXCF_CD
		  and  e.LAST_UPDR_ID = f.USER_ID(+)
		  and  c.HSLC_DVSN_CD = NVL(#{hslcDvsnCd},c.HSLC_DVSN_CD)
		  and  g.PTNO = c.PTNO
		  and  i.MDFE_CD(+) = c.ORDR_CD
		  and  i.APST_YMD(+) <= c.ORDR_YMD
		  and  i.APFN_YMD(+) >= c.ORDR_YMD
		  and  j.EXMN_CTRL_CD(+) = 'SR210'
		  and  j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		  and  srn.MCDP_CD(+) = c.MCDP_CD                      /*  진료과               */
		  and  srn.ORDR_CD(+) = c.ORDR_CD                      /*  처방코드             */
		  and  c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)
		  and  a.AMPR_ID = k.USER_ID(+)
		  and  c.MDRP_NO = l.MDRP_NO
		  and  (
				  c.ORDR_YMD < to_date('20160702', 'yyyymmdd')                          /*  처방 유효기간 다윈 오픈전 처방은 예외처리(통합예약) */
				  or
				  nvl(#{valdHhDvsnCd}, 'Y') = 'N'
				  or
				  trunc(sysdate) <= nvl(c.ORDR_VALD_PERD_EXPT_YMD, c.ORDR_YMD + 365*2)
			   )
		order
		   by  22 desc
			,  9  desc /*  처방일자 */
			,  17      /*  처방순번 */
		]]> 
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnMM-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="apntYn" column="APNT_YN"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="exrmCd1" column="EXRM_CD_1"/>
		<result property="schdDtlsTypCd" column="SCHD_DTLS_TYP_CD"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="amprId" column="AMPR_ID"/>
		<result property="andvCd" column="ANDV_CD"/>
		<result property="exmnCd" column="EXMN_CD"/>
		<result property="ptno" column="PTNO"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="exrsGrpCd" column="EXRS_GRP_CD"/>
		<result property="admsYmd" column="ADMS_YMD"/>
		<result property="excfCd" column="EXCF_CD"/>
		<result property="ptdvCd" column="PTDV_CD"/>
		<result property="centApntPsblYn" column="CENT_APNT_PSBL_YN"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="pacsAccsNo" column="PACS_ACCS_NO"/>
		<result property="rernYn" column="RERN_YN"/>
		<result property="cnmdUseYn" column="CNMD_USE_YN"/>
		<result property="rcpsId" column="RCPS_ID"/>
		<result property="tlno" column="TLNO"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="careWardCd" column="CARE_WARD_CD"/>
		<result property="wntdDrId" column="WNTD_DR_ID"/>
		<result property="exorUnslCtn" column="EXOR_UNSL_CTN"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="clrsPrjcDrId" column="CLRS_PRJC_DR_ID"/>
		<result property="wntdDt" column="WNTD_DT"/>
		<result property="ipdvCd" column="IPDV_CD"/>
		<result property="ipdvNm" column="IPDV_NM"/>
		<result property="otrsExmnLnkdCtn" column="OTRS_EXMN_LNKD_CTN"/>
		<result property="befrTxCtn" column="BEFR_TX_CTN"/>
		<result property="exmnUnsbCtn" column="EXMN_UNSB_CTN"/>
		<result property="drNm" column="DR_NM"/>
		<result property="ordvCd" column="ORDV_CD"/>
		<result property="ptadPtdvCd" column="PTAD_PTDV_CD"/>
		<result property="bdsdYn" column="BDSD_YN"/>
		<result property="emrTrasYn" column="EMR_TRAS_YN"/>
		<result property="ordrLcdvCd" column="ORDR_LCDV_CD"/>
		<result property="cntrCd" column="CNTR_CD"/>
		<result property="implLcdvCd" column="IMPL_LCDV_CD"/>
		<result property="unmdRceqUseYn" column="UNMD_RCEQ_USE_YN"/>
		<result property="userDvsnCd" column="USER_DVSN_CD"/>
		<result property="wntdDt1" column="WNTD_DT_1"/>
		<result property="riskFctrVl" column="RISK_FCTR_VL"/>
		<result property="intrPrrnDrNm" column="INTR_PRRN_DR_NM"/>
		<result property="indrNm" column="INDR_NM"/>
		<result property="paclYmd" column="PACL_YMD"/>
		<result property="intrPrrnDt" column="INTR_PRRN_DT"/>
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="smdvCd" column="SMDV_CD"/>
		<result property="smdpClsfCd" column="SMDP_CLSF_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="sctnCd" column="SCTN_CD"/>
		<result property="mtfrTkngYn" column="MTFR_TKNG_YN"/>
		<result property="dytmWardUseWntdYn" column="DYTM_WARD_USE_WNTD_YN"/>
		<result property="dtlsExcfCd" column="DTLS_EXCF_CD"/>
		<result property="asapYn" column="ASAP_YN"/>
		<result property="dgfrNm" column="DGFR_NM"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="cnsgHsptCd" column="CNSG_HSPT_CD"/>
		<result property="iodnMdteAdmnQty" column="IODN_MDTE_ADMN_QTY"/>
		<result property="prvlRptnYn" column="PRVL_RPTN_YN"/>
		<result property="ptntExmnNm" column="PTNT_EXMN_NM"/>
		<result property="inftSmsrSndgCtn" column="INFT_SMSR_SNDG_CTN"/>
		<result property="mdrpNo" column="MDRP_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnMM (검사 예약접수 조회 MM) 
        Description :                                           검사 예약접수 조회 MM
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnMM-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnMM"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnMM-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnMM */
		<![CDATA[
		   select  /*+ swd_workmmt_l47$S01_검사 예약접수 조회 MM */
				   b.APNT_NEED_EN as APNT_YN
				,  a.EXRM_CD as EXRM_CD                               /*  검사실코드           */
				,  nvl(c.RCST_CD, 'N') as EXRM_CD_1             /*  수납여부             */
				,  a.SCHD_DTLS_TYP_CD as SCHD_DTLS_TYP_CD                              /*  스케쥴 SUB TYPE      */
				,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CHDR_ID) as ODDR_ID                 /*  지정의사             */
				,  mo.USER_ID ||'(8-'||decode(mob.PDA_NO, null, null, mob.PDA_NO)||')'  as CHDR_NM    /*  2013.07.10 mobile번호->PDANO로 변경 박재연 선생님 요청*/
				,  to_char(a.APNT_DT, 'yyyy-mm-dd hh24:mi') as APNT_DT        /*  예약일시             */
				,  to_char(a.RPTN_DT, 'yyyy-mm-dd hh24:mi') as RPTN_DT        /*  접수일시             */
				,  to_char(a.ORDR_YMD, 'yyyy-mm-dd') as ORDR_YMD       /*  처방일자             */
				,  c.MCDP_CD as MCDP_CD
				,  decode(a.EXCF_CD, 'SO', decode(nvl(c.PRTB_YN , 'N'), 'Y', '[P]', null), null) ||
				   decode(c.DYTM_WARD_USE_WNTD_YN, 'Y', '(낮병상)', '')||b.CLNC_PTHL_ORDR_SHRT_NM as ORDR_NM
				,  a.AMPR_ID as AMPR_ID                                       /*  예약자               */
				,  a.ANDV_CD as ANDV_CD                                       /*  예약구분 중앙: Y    */
				,  a.EXMN_CD as EXMN_CD                                       /*  검사코드             */
				,  a.PTNO as PTNO                                          /*  환자번호             */
				,  a.ORDR_SNO as ORDR_SNO                                      /*  처방순번             */
				,  a.EXMN_STTS_CD as EXMN_PRSS_CD                                  /*  진행STATUS(진료지원) */
				,  b.EXRS_GRP_CD as EXRS_GRP_CD                                   /*  결과그룹 코드        */
				,  to_char(l.MDCR_DT, 'yyyymmdd') as ADMS_YMD                  /*  입원일자             */
				,  a.EXCF_CD as EXCF_CD                                       /*  검사분류             */
				,  c.CODV_CD as PTDV_CD                                       /*  환자구분             */
				,  b.CENT_APNT_PSBL_YN as CENT_APNT_PSBL_YN                             /*  중앙예약가능여부     */
				,  decode(a.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L'), nvl(a.ANDV_CD, 'L')) as APNT_FRMT_CD       /*  일정/비일정 예약구분 */
				,  a.PACS_ACCS_NO as PACS_ACCS_NO
				,  decode(to_char(a.RERN_PRRN_DT, 'dd'), '', 'N', 'Y') as RERN_YN     /*  REPEAT 여부   */
				,  fn_sr_sidreaction_s(a.PTNO) as CNMD_USE_YN                  /*  SIDE 여부            */
				,  ( select  USER_NM from CCUSRDPHT where   USER_ID = a.RCPS_ID) as RCPS_ID            /*  접수자               */
				,  d.TLNO as TLNO                                  /*  검사실 전화번호      */
				,  ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = c.WARD_CD group by ABRV_DPRT_CD ) as WARD_CD   /*  병동                 */
				,  ( select ABRV_DPRT_CD
		               from HZDEPTMMT
		              where DPRT_CD = L.CARE_WARD_CD
		              group by ABRV_DPRT_CD )   as CARE_WARD_CD                       /*  현병동                 */
				,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.EXMN_WNTD_DR_ID) as WNTD_DR_ID                   /*  희망의              */
				,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null, ' <'||to_char(e.LAST_UPDR_ID, 'yyyy-mm-dd hh24:mi:ss')||' '||f.USER_NM||'>') as EXOR_UNSL_CTN
				,  c.CLRS_PRJC_CD as CLRS_PRJC_CD                                  /*  임상연구코드         */
				,  c.CLRS_PRJC_DR_ID||' '|| ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_ID        /*  임상연구의사         */
				,  to_char(c.WNTD_DT, 'YYYY-MM-DD') as WNTD_DT        /*  희망일시             */
				,  c.ODDR_ID as IPDV_CD
				,  c.ODKI_CD as IPDV_NM
				, ''  as OTRS_EXMN_LNKD_CTN
				, ''  as BEFR_TX_CTN
				,  nvl(c.HSLC_DVSN_CD, 'M') as EXMN_UNSB_CTN
				,  nvl(c.MCCN_CD, 'M') as DR_NM
				,  a.IMPL_HSDV_CD as ORDV_CD
				,  b.RCEQ_USE_YN as PTAD_PTDV_CD
				,  c.INPT_USER_DVSN_CD as BDSD_YN
				,  to_char(c.WNTD_DT, 'yyyy-mm-dd hh24:mi') as EMR_TRAS_YN        /*  예약일시             */
				,  c.RISK_FCTR_VL as ORDR_LCDV_CD                                          /*  위험인자             */
				,  c.PTAD_CODV_CD as CNTR_CD
				,  a.INTR_PRRN_DR_NM ||'  '|| ( select  USER_NM from CCUSRDPHT where   USER_ID = substr(a.INTR_PRRN_DR_NM, 1, 6)) as IMPL_LCDV_CD      /*  판독예정의 */
				,  c.PTAD_CLBA_YMD as UNMD_RCEQ_USE_YN
				,  to_char(a.INTR_PRRN_DT, 'yyyy-mm-dd hh24:mi')  as USER_DVSN_CD
				,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') as WNTD_DT_1      /*  진료일자   */
				,  '' as RISK_FCTR_VL
			/* [PROB]fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO), nvl(decode(c.PTAD_CODV_CD, 'O', */
			/* [PROB]c.PTAD_CLBA_YMD, 'I', c.PACL_YMD, 'D', c.PACL_YMD, sysdate), sysdate)) HOPEDRTYP */
				,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as INTR_PRRN_DR_NM
				,  c.CHDR_ID as INDR_NM
				,  '' as PACL_YMD
				,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y') as INTR_PRRN_DT
				,  c.DYTM_WARD_USE_WNTD_YN as MDCR_YMD
				,  b.DTLS_EXCF_CD as SMDV_CD
				,  '' as SMDP_CLSF_CD
				, ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = c.MCDP_CD group by ABRV_DPRT_CD ) as CHDR_ID   /*  진료과               */
				,  c.NNMT_EXMN_YN as SCTN_CD         /*  비대면 환자 여부     */
				,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as MTFR_TKNG_YN   /*  비대면검사통보일자   */
				,  (select case
							 when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'           /*  Drop일자가 현재일까지면 D(Drop) */
							 when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
						   end
					 from  APRCRPTNT apr
						,  MDFASTRPT mdf
					where  apr.MDRP_NO = a.MDRP_NO
					  and  apr.FATR_CD is not null
					  and  mdf.PTNO = apr.PTNO
					  and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
					) as DYTM_WARD_USE_WNTD_YN                  /*  신속(Fast Track) */
				,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
					 , '1', 'Y'
					 , null
				   ) as DTLS_EXCF_CD    /*  당일검사 FLAG */
				   ,  a.IMLN_CLSF_CD as ASAP_YN    /*  임플란트 분류군 코드 */
				   ,  a.EXMN_FALR_RGST_RESN_CTN as DGFR_NM
				   ,  a.PRVS_TX_DGST_CTN as RCPS_NM
				   ,  a.EXMN_ANDV_CD as CNSG_HSPT_CD
				   ,  a.ABRV_DPRT_CD as IODN_MDTE_ADMN_QTY
		   , a.PRVL_RPTN_YN						PRVL_RPTN_YN
		   ,''      as PTNT_EXMN_NM
		   ,''  as INFT_SMSR_SNDG_CTN		
		   , c.MDRP_NO as MDRP_NO
			 from
				   SWWORKMMT a                              /*  검사 WORK 관리 (계속) */
		,  MDORDRCMT b
		,  MDEXMORDT c
		,  SZROOMCMT d
		,  SZCTRLMMT e                       /*  제어코드 */
		,  CCUSRDPHT f
		,  CCUSRDPHT mo
		,  CCUSERAMT mob
		,  SZCTRLMMT j
		,  APRCRPTNT l
		where  a.PTNO    = #{ptno}                      /*  환자번호             */
		and  a.ORDR_YMD = to_date(#{strtYmd} , 'YYYYMMDD')
		and  a.ORDR_SNO = #{ordrSno}     /*  처방순번             */
		and  ( (a.EXCF_CD != 'SG1') or
					 ( (a.EXCF_CD = 'SG1')
		  and  (a.EXMN_CD between 'BT11'
			  and  'BT17999') )
		)
		and  a.EXMN_STTS_CD = 'A'                    /*  진행STATUS(진료지원) */
		and  a.EXMN_CD = b.ORDR_CD                   /*  검사코드             */
		and  a.PTNO    = c.PTNO                      /*  환자번호             */
		and  a.ORDR_SNO = nvl(#{ordrSno} , a.ORDR_SNO)     /*  처방순번             */
		and  a.ORDR_YMD  = c.ORDR_YMD                        /*  처방일자             */
		and  a.ORDR_SNO = c.ORDR_SNO                         /*  처방순번             */
		and  nvl(c.DC_DVSN_CD, 'N') not in ('X', 'Y')                /*  윤기철 추가 2004.02.13 */
		and  a.EXRM_CD = d.EXRM_CD(+)                /*  검사실코드           */
		and  a.EXCF_CD  = d.EXCF_CD(+)                       /*  검사분류             */
		and  e.EXMN_CTRL_CD     (+) = 'SWA_180'                   /*  검사항목별 특이사항 */
		and  e.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		and  e.APLY_PART_CD     (+) = a.EXCF_CD
		and  e.LAST_UPDR_ID = f.USER_ID(+)
		and  c.ODDR_ID = mo.USER_ID
		and  mo.LGIN_ID  = mob.LGIN_ID
		and  j.EXMN_CTRL_CD(+) = 'SR210'
		and  j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		and  c.MDRP_NO = l.MDRP_NO
		and  (
		  nvl(#{valdHhDvsnCd}, 'Y') = 'N'
		  or
		  a.ORDR_YMD > trunc( sysdate - 365*2)
		)
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSR-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="apntYn" column="APNT_YN"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="exrmCd1" column="EXRM_CD_1"/>
		<result property="schdDtlsTypCd" column="SCHD_DTLS_TYP_CD"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="drNm" column="DR_NM"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="amprId" column="AMPR_ID"/>
		<result property="andvCd" column="ANDV_CD"/>
		<result property="exmnCd" column="EXMN_CD"/>
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="exrsGrpCd" column="EXRS_GRP_CD"/>
		<result property="admsYmd" column="ADMS_YMD"/>
		<result property="excfCd" column="EXCF_CD"/>
		<result property="ptdvCd" column="PTDV_CD"/>
		<result property="centApntPsblYn" column="CENT_APNT_PSBL_YN"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="pacsAccsNo" column="PACS_ACCS_NO"/>
		<result property="rernYn" column="RERN_YN"/>
		<result property="cnmdUseYn" column="CNMD_USE_YN"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="tlno" column="TLNO"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="careWardCd" column="CARE_WARD_CD"/>
		<result property="wntdDrNm" column="WNTD_DR_NM"/>
		<result property="exmnSpsbCtn" column="EXMN_SPSB_CTN"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="clrsPrjcDrId" column="CLRS_PRJC_DR_ID"/>
		<result property="clrsPrjcDrNm" column="CLRS_PRJC_DR_NM"/>
		<result property="wntdDt" column="WNTD_DT"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="bdsdYn" column="BDSD_YN"/>
		<result property="apntRmrkCtn" column="APNT_RMRK_CTN"/>
		<result property="ordrLcdvCd" column="ORDR_LCDV_CD"/>
		<result property="cntrCd" column="CNTR_CD"/>
		<result property="implLcdvCd" column="IMPL_LCDV_CD"/>
		<result property="unmdRceqUseYn" column="UNMD_RCEQ_USE_YN"/>
		<result property="userDvsnCd" column="USER_DVSN_CD"/>
		<result property="wntdDt1" column="WNTD_DT_1"/>
		<result property="riskFctrMemoCtn" column="RISK_FCTR_MEMO_CTN"/>
		<result property="ptadPtdvCd" column="PTAD_PTDV_CD"/>
		<result property="paclYmd" column="PACL_YMD"/>
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="smdvCd" column="SMDV_CD"/>
		<result property="smdpClsfCd" column="SMDP_CLSF_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="mtfrTkngYn" column="MTFR_TKNG_YN"/>
		<result property="dytmWardUseWntdYn" column="DYTM_WARD_USE_WNTD_YN"/>
		<result property="dtlsExcfCd" column="DTLS_EXCF_CD"/>
		<result property="asapYn" column="ASAP_YN"/>
		<result property="exorUnslCtn" column="EXOR_UNSL_CTN"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="wt" column="WT"/>
		<result property="ht" column="HT"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="lctnNm" column="LCTN_NM"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="afiAmprNm" column="AFI_AMPR_NM"/>
		<result property="cnsgHsptCd" column="CNSG_HSPT_CD"/>
		<result property="nnmtExmnYn" column="NNMT_EXMN_YN"/>
		<result property="nnmtExmnNtfcYmd" column="NNMT_EXMN_NTFC_YMD"/>
		<result property="fatrCd" column="FATR_CD"/>
		<result property="exmnWntdYmdDvsnCd" column="EXMN_WNTD_YMD_DVSN_CD"/>
		<result property="exmnFalrRgstResnCtn" column="EXMN_FALR_RGST_RESN_CTN"/>
		<result property="prvsTxDgstCtn" column="PRVS_TX_DGST_CTN"/>
		<result property="exmnAndvCd" column="EXMN_ANDV_CD"/>
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="chldCalmYn" column="CHLD_CALM_YN"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="ageVl" column="AGE_VL"/>
		<result property="prtbYn" column="PRTB_YN"/>
		<result property="orprVl" column="ORPR_VL"/>
		<result property="enfrDt" column="ENFR_DT"/>
		<result property="scndOrdrYn" column="SCND_ORDR_YN"/>
		<result property="agdcYn" column="AGDC_YN"/>
		<result property="anggInrvDvsnNm" column="ANGG_INRV_DVSN_NM"/>
		<result property="ordrIpdvCd" column="ORDR_IPDV_CD"/>
		<result property="careWardNm" column="CARE_WARD_NM"/>
		<result property="dschDt" column="DSCH_DT"/>
		<result property="ipdvNm" column="IPDV_NM"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="prvlRptnYn" column="PRVL_RPTN_YN"/>
		<result property="ptntExmnNm" column="PTNT_EXMN_NM"/>
		<result property="inftSmsrSndgCtn" column="INFT_SMSR_SNDG_CTN"/>
		<result property="slpnPsblYn" column="SLPN_PSBL_YN"/>
		<result property="orfrCd" column="ORFR_CD"/>
		<result property="schdTypCd" column="SCHD_TYP_CD"/>
		<result property="prtbYn" column="PRTB_YN"/>
		<result property="mccnCd" column="MCCN_CD"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="detlCdDscrCtn" column="DETL_CD_DSCR_CTN"/>
		<result property="exmnDtlsCtrlNm" column="EXMN_DTLS_CTRL_NM"/>
		<result property="atmtCrtnYn" column="ATMT_CRTN_YN"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="rcpcDt" column="RCPC_DT"/>
		<result property="schdTypNm" column="SCHD_TYP_NM"/>
		<result property="etcTlno" column="ETC_TLNO"/>
		<result property="cdVl" column="CD_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSR (검사 예약접수 조회 SR) 
        Description :                                           검사 예약접수 조회 SR
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSR-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSR"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSR-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSR */
		<![CDATA[
		 select 
				  b.APNT_NEED_EN as APNT_YN                                             /*  1. 예약필수구분      */
			  /* ,  fn_sw_roomcode_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as EXRM_CD  */          /*  2. 검사실코드       */
		         , b.OTPT_EXRM_CD as EXRM_CD   /*  2. 검사실코드       */
			   ,  decode(c.RCST_CD, 'Y', '수납', 'N', '미수', 'R', '환불', 'W', '수납') as EXRM_CD_1  /*  수납여부     */
			   ,  fn_sw_schsubtyp_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as SCHD_DTLS_TYP_CD  /*  4. 스케줄세부타입   */
			   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CHDR_ID)  as CHDR_NM  /*  5. 지정의사명       */
			   ,  mo.USER_NM as DR_NM                                        /*  6. 의사명                */
			   ,  '' as APNT_DT                                              /*  7. 예약일시             */
			   ,  '' as RPTN_DT                                              /*  8. 접수일시             */
			   ,  to_char(c.ORDR_YMD, 'yyyymmdd') as ORDR_YMD                /*  9. 처방일자             */
			   ,  c.MCDP_CD as MCDP_CD                                       /* 10. 진료과코드           */
			   ,   b.ORDR_NM as ORDR_NM       /* 11. 검사명               */
			   ,  '' as AMPR_ID                                              /* 12. 예약자               */
			   ,  '' as ANDV_CD                                              /* 13. 예약구분 중앙: Y     */
			   ,  c.ORDR_CD as EXMN_CD                                       /* 14. 검사코드             */
			   ,  c.PTNO as PTNO                                             /* 15. 환자번호             */
			   ,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = c.PTNO) as PTNT_NM  /* 16. 환자명         */
			   ,  c.ORDR_SNO as ORDR_SNO                                     /* 17. 처방순번             */
			   ,  c.EXOR_PRSS_CD as EXMN_PRSS_CD                             /* 18. 진행STATUS(진료지원) */
			   ,  b.EXRS_GRP_CD as EXRS_GRP_CD                               /* 19. 결과그룹 코드        */
			   ,  to_char(l.MDCR_DT, 'yyyymmdd') as ADMS_YMD                 /* 20. 입원일자             */
			   ,  c.EXCF_CD as EXCF_CD                                       /* 21. 검사분류             */
			   ,  c.CODV_CD as PTDV_CD                                       /* 22. 환자구분             */
			   ,  b.CENT_APNT_PSBL_YN as CENT_APNT_PSBL_YN                   /* 23. 중앙예약가능여부     */
			   ,  '' as APNT_FRMT_CD                                         /* 24. 일정 비일정 예약구분 */
			   ,  '' as PACS_ACCS_NO                             /* 25. PACS ACC NO           */
			   ,  '' as RERN_YN                                              /* 26. REPEAT 여부    */
			   ,  fn_sr_sidreaction_s(c.PTNO) as CNMD_USE_YN                 /*  27. SIDE 여부            */
			   ,  '' as RCPS_NM                                              /* 28. 접수자               */
			   ,  '' as TLNO                                                 /* 29. 검사실 전화번호      */
			   ,  ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = c.WARD_CD group by ABRV_DPRT_CD ) as WARD_CD    /*  30.병동                 */
			   ,  ( select ABRV_DPRT_CD
		                   from HZDEPTMMT
		                  where DPRT_CD = L.CARE_WARD_CD
		                  group by ABRV_DPRT_CD )   as CARE_WARD_CD                       /*  현병동                 */
			   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.EXMN_WNTD_DR_ID) as WNTD_DR_NM                   /* 31. 희망의               */
			   ,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null, ' <'||to_char(e.LAST_UPDT_DT, 'yyyymmddhh24miss')||' '||f.USER_NM||'>') as EXMN_SPSB_CTN /* 32. 검사항목별 특이사항*/
			   ,  c.CLRS_PRJC_CD as CLRS_PRJC_CD                                  /* 33. 임상연구코드         */
			   ,  c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
			   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
			   ,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') as WNTD_DT        /* 35. 희망일시             */
			   ,  c.ODDR_ID as ODDR_ID    /* 36. 처방의사ID   */
			   ,  c.ODKI_CD as ODKI_CD    /* 37. 처방종류코드 */
			   ,  '' as BDSD_YN    /* 38. Bedside여부  */
			   ,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
															, ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||( select F_A.USER_NM
																															   from CCUSRDPHT F_A
																															  where F_A.USER_ID = e.LAST_UPDR_ID )||'>') as APNT_RMRK_CTN /* 39. 진료예약정보(검사별특이사항) */
			   ,  nvl(c.HSLC_DVSN_CD, 'M') as ORDR_LCDV_CD  /* 40. 병원위치구분코드*/
			   ,  nvl(c.MCCN_CD, 'M') as CNTR_CD        /* 41. 진료센터코드      */
			   ,  '' as IMPL_LCDV_CD        /* 42. 실시병원구분코드  */
			   ,  b.RCEQ_USE_YN as UNMD_RCEQ_USE_YN     /* 43. 접수기사용여부    */
			   ,  c.INPT_USER_DVSN_CD as USER_DVSN_CD   /* 44. 입력사용자구분코드 */
			   ,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') as WNTD_DT_1        /* 45. 희망일시             */
		     ,  decode(c.RISK_FCTR_VL,'1','Pacemaker'
		                             ,'2','심실재동기화 치료 제세동기'
		                             ,'3','체내제세동기'
		                             ,'4','인공와우'
		                             ,'5','캡슐내시경'
		                             ,'6','유방조직확장기'
		                             ,'7','해당없음'
		                             ,'/') as  RISK_FCTR_MEMO_CTN           /*  위험인자 */
			   ,  c.PTAD_CODV_CD as PTAD_PTDV_CD   /* 47. 원무내원구분코드 */
			   ,  c.PTAD_CLBA_YMD as PACL_YMD  /* 48. 원무계산기준일자 */
			   ,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') as MDCR_YMD      /* 50. 진료일시   */
			   , ''   as SMDV_CD  /* 51. 선택진료신청구분   */
			   ,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as SMDP_CLSF_CD   /* 52. 원무계산일자 */
			   ,  c.CHDR_ID as CHDR_ID   /* 53. 지정의사ID  */
			   ,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y') as MTFR_TKNG_YN   /* 54. 메포민대상코드  */
			   ,  c.DYTM_WARD_USE_WNTD_YN as DYTM_WARD_USE_WNTD_YN    /* 55. 낮병동사용희망여부 */
			   ,  b.DTLS_EXCF_CD as DTLS_EXCF_CD  /* 56. 검사분류세부 */
			   ,  '' as ASAP_YN   /* 57. 가능한빨리 */
			   ,  replace(replace(c.EXOR_UNSL_CTN, chr(13), chr(32)), chr(10), chr(32)) as EXOR_UNSL_CTN   /* 59. 검사처방특이내용 */
			   ,  c.MDRP_NO as MDRP_NO   /* 60. 진료접수번호  */
			   ,  trunc(substr(
					  fn_sw_bodysize_s(c.PTNO)
					, instr(fn_sw_bodysize_s(c.PTNO),'@',1,2)+1
					, length(fn_sw_bodysize_s(c.PTNO))
					  - instr(fn_sw_bodysize_s(c.PTNO),'@',1,2)
				  ))                                                                 as WT  /* 61. 체중 */
			   ,  trunc(substr(
					  fn_sw_bodysize_s(c.PTNO)
					, 10
					, instr(fn_sw_bodysize_s(c.PTNO),'@',1,2)-10
				  ))                                                          as HT  /* 62. 신장 */
			   , ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = c.MCDP_CD group by ABRV_DPRT_CD ) as MCDP_NM      /* 64. 진료과명          */
			   , ( select
						  z.DETL_CD_NM
					 from  MNEERRPAT y
						  ,CCCMCDDMT z
					where y.PTNO = c.PTNO
					  and y.CHOT_DT IS NULL
					  and z.COMN_GRP_CD = 'MN229'
			   and z.COMN_DTLS_CD = y.ERRM_LCTN_CD) as LCTN_NM   /* 65. 응급실위치 */
			, c.ORCL_CD as ORCL_CD                                   /* 66. 처방분류코드 */
			, '' as AFI_AMPR_NM                                      /* 67. 예약자명 */
			, '' as CNSG_HSPT_CD                                     /* 68. 수탁병원코드 */
			,  c.NNMT_EXMN_YN as NNMT_EXMN_YN                        /* 69. 비대면 환자 여부     */
			,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /* 70. 비대면검사통보일자   */
			,  (select case
						 when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'           /*  Drop일자가 현재일까지면 D(Drop) */
						 when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
					   end
				 from  APRCRPTNT apr
					,  MDFASTRPT mdf
				where  apr.MDRP_NO = c.MDRP_NO
				  and  apr.FATR_CD is not null
				  and  mdf.PTNO = apr.PTNO
				  and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
				) as FATR_CD                                         /* 71. 신속(Fast Track) */
			,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
				 , '1', 'Y'
				 , null
			   ) as EXMN_WNTD_YMD_DVSN_CD                            /* 72. 당일검사 FLAG */
			   ,  '' as EXMN_FALR_RGST_RESN_CTN  /* 73. 검사실패등록사유내용 */ 
			   ,  '' as PRVS_TX_DGST_CTN   /* 74. 사전처치약물내용 */
			   ,  '' as EXMN_ANDV_CD    /* 75. 검사예약구분코드 */
			   ,  '' as ABRV_DPRT_CD    /* 76. 약어부서코드  */
			   ,  '' as CHLD_CALM_YN   /* 77. 소아진정여부 */
			   ,  (select F_A.ABRV_DPRT_CD from hzdeptmmt F_A where F_A.dprt_cd = c.mccn_cd) as MCCN_NM  /* 78. 진료센터코드 약어명*/
			   ,  g.GEND_CD                                                        as GEND_CD   /* 79. 성별 */
			   ,  trunc(months_between(trunc(sysdate), g.BTDT)  / 12)             as AGE_VL   /* 80. 나이 */
			   , c.PRTB_YN                                                        as PRTB_YN   /* 81. 포터블여부 */
			   , c.PTNO||to_char(c.ORDR_YMD, 'yyyy-mm-dd')||lpad(c.ORDR_SNO, 22, '0')   as ORPR_VL  /* 82. 처방키*/
			  , '' as ENFR_DT       /*  83. 실시일시  */ 
			  , 'N' as   SCND_ORDR_YN  /*  84. 2차처방유무             */ 
		    , decode( b.AGDC_NEED_EN ,'Y', FN_SW_EXMAGDC_YN(c.PTNO, c.ORDR_YMD, c.ORDR_SNO, '')
		                                                  ,'N' )  as AGDC_YN /* 85. 동의서여부 */
			, decode(c.ANGG_INRV_DVSN_CD,'1','100%','2','50%','3','70%','4','25%','-') as ANGG_INRV_DVSN_NM
			, c.ORDR_IPDV_CD  
		    /*   ,  case when  nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD ) 
				                when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
				                else '' end  as CARE_WARD_NM /* 89. 현재병동 */
		       , case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') and c.PTAD_CODV_CD <> 'E' then ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) || '/' || l.CARE_PTRM_NO
		                                when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') and c.PTAD_CODV_CD = 'E' then ( select  loc.ERRM_ZONE_NM||'-'||err.SCKB_NO_VL from MNEERRPAT err, MNEERRMZT loc where err.MDRP_NO = c.MDRP_NO and err.ERRM_LCTN_CD = loc.ERRM_LCTN_CD)
		                    when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		                    else ''   end  as CARE_WARD_NM   /* 89. 현재병동 */
		        , to_char(l.DSCH_DT,'yyyymmddhh24mi')  as DSCH_DT
		   ,  (
						   select fn_sw_decide_instyp_s(
										c.PTNO
									  , c.ORDR_YMD
									  , c.ORDR_SNO
								  )
						   from DUAL
						 )                                                                as IPDV_NM
		   , decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
			, null as PRVL_RPTN_YN	
		   , ''     as PTNT_EXMN_NM
		   , ''  as INFT_SMSR_SNDG_CTN
		   , c.SLPN_YN  as SLPN_PSBL_YN
		   , c.ORFR_CD 
		   , '' as  SCHD_TYP_CD
		   , c.prtb_yn as PRTB_YN	
		   , c.MCCN_CD as MCCN_CD  /* 진료센터코드  */	
		   ,  ( select F_C.KORN_DPRT_NM from HZDEPTMMT F_C where F_C.DPRT_CD = c.MCCN_CD group by F_C.KORN_DPRT_NM)  as MCCN_NM /*  센터명                 */
		   , ( select cc.DETL_CD_DSCR_CTN  from CCCMCDDMT cc  where cc.COMN_GRP_CD = 'MDP_048' and cc.COMN_DTLS_CD = c.ODKI_DETL_CD ) as DETL_CD_DSCR_CTN  /*처방종류상세구분*/
		   , '' as  EXMN_DTLS_CTRL_NM
		   , ( select max(x.atmt_crtn_yn) from SZEXMCMMT x where x.ptno  = c.ptno and x.ordr_ymd = c.ordr_ymd and x.ordr_sno = c.ordr_sno) ATMT_CRTN_YN
		   , c.PTAD_MDRP_NO
		    , to_char(c.RCPC_DT, 'yyyymmddhh24mi')  as RCPC_DT
		    , (select LISTAGG(x.SCHD_TYP_CD, ', ') WITHIN GROUP (ORDER BY ROWNUM) from SWSCHORDT x where x.excf_cd = c.excf_cd and x.exmn_cd = c.ordr_cd) SCHD_TYP_NM
		    , fn_sr_ward_telno(l.MDRP_NO) ETC_TLNO
		    , FN_MD_GETAGE('', g.BTDT, trunc(sysdate)) as CD_VL
		  from 
		       MDEXMORDT c
		    ,  MDORDRCMT b
		    ,  SZCTRLMMT e                       /*  제어코드 */
		    ,  CCUSRDPHT f
		    ,  APPTPTNTT g
		    ,  CCUSRDPHT mo
		    ,  CCUSERAMT mob
		    ,  SZCTRLMMT j
		    ,  SRNOCFMCT srn   /*  판독부위예외코드   */
		    ,  APRCRPTNT l
		where c.ptno =  #{ptno} 
			and c.excf_cd =  #{excfCd} 
			and c.exor_prss_cd is null /* 검사처방 진행상태 코드 */
			and  c.ORDR_SNO = nvl(#{ordrSno}, c.ORDR_SNO)     /* 처방순번             */
			and  c.ORDR_CD = b.ORDR_CD                   /* 검사코드             */
			and  ( (#{dtlsExcfCd} is null)
							 or ( b.DTLS_EXCF_CD = #{dtlsExcfCd} ) )
			and  nvl(c.DC_DVSN_CD, 'N') = 'N'  						/* 2020-10-15 수정  */
			and (  instr(#{ptdvCtn} , c.CODV_CD) > 0 )
			and  e.EXMN_CTRL_CD     (+) = 'SWA_180'                   /* 검사항목별 특이사항 */
			and  e.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
			and  e.APLY_PART_CD     (+) = c.EXCF_CD
			and  e.LAST_UPDR_ID = f.USER_ID(+)
			and  g.PTNO = c.PTNO
			and  c.ODDR_ID = mo.USER_ID(+)
			and  mo.LGIN_ID  = mob.LGIN_ID(+)
			and  j.EXMN_CTRL_CD(+) = 'SR210'
			and  j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
			and  srn.MCDP_CD(+) = c.MCDP_CD
			and  srn.ORDR_CD(+) = c.ORDR_CD
			and  c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)         /* 환자구분             */
			and  c.MDRP_NO = l.MDRP_NO
			and  (
				  nvl(#{valdHhDvsnCd}, 'Y') = 'N'
				  or
				  c.ORDR_YMD > trunc( sysdate - 365*2)
			   )
		    and  nvl(c.ORFR_CD, 'N') not in ('D', 'P') /* 과내검사 및 임시처방 제외)  */  
		    and  c.TMPR_ORDR_YN = 'N' 
		union all
		select 
				b.APNT_NEED_EN  as APNT_YN                                             /*  1. 예약필수구분      */
			    , nvl(a.EXRM_CD, nvl((select ty.EXRM_CD 
						                                        from SWSCHTYPT ty, szroomcmt ro
						                                        where ty.SCHD_TYP_CD    = a.SCHD_TYP_CD  
						                                      and ty.SCHD_DTLS_TYP_CD   = a.SCHD_DTLS_TYP_CD
						                                      and ty.EXCF_CD            = a.EXCF_CD
						                                      and ty.SCHD_DTLS_TYP_CD_USE_YN ='Y'
						                                      and ty.EXCF_CD            = ro.EXCF_CD
						                                      and ty.EXRM_CD            = ro.EXRM_CD), b.OTPT_EXRM_CD)) as  EXRM_CD      /*  2. 검사실코드 */
			   ,  decode(c.RCST_CD, 'Y', '수납', 'N', '미수', 'R', '환불', 'W', '수납') as EXRM_CD_1  /*  수납여부     */
			   ,  a.SCHD_DTLS_TYP_CD         as SCHD_DTLS_TYP_CD                         /*  4. 스케줄세부타입   */
			   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CHDR_ID)  as CHDR_NM  /*  5. 지정의사명       */
			   ,  mo.USER_NM as DR_NM                                        /*  6. 의사명                */
			   ,  to_char(a.APNT_DT, 'yyyymmddhh24mi') as APNT_DT            /*  7. 예약일시             */
			   ,  to_char(c.EXRM_RPTN_DT, 'yyyymmddhh24mi')as RPTN_DT       /*  8. 접수일시             */
			   ,  to_char(c.ORDR_YMD, 'yyyymmdd') as ORDR_YMD                /*  9. 처방일자             */
			   ,  c.MCDP_CD as MCDP_CD                                       /* 10. 진료과코드           */
			   , nvl(b.CLNC_PTHL_ORDR_SHRT_NM, b.ORDR_NM)  as ORDR_NM       /* 11. 검사명               */    
			   ,  a.AMPR_ID as AMPR_ID                                       /* 12. 예약자               */
			   ,  a.ANDV_CD as ANDV_CD                                       /* 13. 예약구분 중앙: Y     */
			   ,  c.ORDR_CD as EXMN_CD                                       /* 14. 검사코드             */
			   ,  c.PTNO as PTNO                                             /* 15. 환자번호             */
			   ,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = a.PTNO) as PTNT_NM  /* 16. 환자명         */
			   ,  c.ORDR_SNO  as ORDR_SNO                                     /* 17. 처방순번             */
			   ,  c.EXOR_PRSS_CD as EXMN_PRSS_CD                             /* 18. 진행STATUS(진료지원) */
			   ,  b.EXRS_GRP_CD as EXRS_GRP_CD                               /* 19. 결과그룹 코드        */
			   ,  to_char(l.MDCR_DT, 'yyyymmdd') as ADMS_YMD                 /* 20. 입원일자             */
			   ,  c.EXCF_CD as EXCF_CD                                       /* 21. 검사분류             */
			   ,  c.CODV_CD as PTDV_CD                                       /* 22. 환자구분             */
			   ,  b.CENT_APNT_PSBL_YN as CENT_APNT_PSBL_YN                   /* 23. 중앙예약가능여부     */
			   ,  decode(a.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L'), nvl(a.ANDV_CD, 'L')) as APNT_FRMT_CD       /* 24. 일정 비일정 예약구분 */
			   ,  a.PACS_ACCS_NO as PACS_ACCS_NO                             /* 25. PACS ACC NO           */
			   ,  decode(to_char(a.RERN_PRRN_DT, 'dd'), '', 'N', 'Y') as RERN_YN  /* 26. REPEAT 여부    */
			   ,  fn_sr_sidreaction_s(a.PTNO) as CNMD_USE_YN                /*  27. 조영제사용여부        */
			   ,  decode(a.EXMN_ATMT_RPTN_YN, 'Y', '자동접수', ( select  USER_NM from CCUSRDPHT where   USER_ID = a.RCPS_ID )) as RCPS_NM   /* 28. 접수자명              */
			   ,  d.TLNO as TLNO                                                /* 29. 검사실 전화번호      */
			   ,  ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = c.WARD_CD group by ABRV_DPRT_CD ) as WARD_CD                       /*  30.병동                 */
			   ,  ( select ABRV_DPRT_CD
		              from HZDEPTMMT
		             where DPRT_CD = L.CARE_WARD_CD
		             group by ABRV_DPRT_CD )   as CARE_WARD_CD                       /*  현병동                 */
			   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.EXMN_WNTD_DR_ID) as WNTD_DR_ID                                  /* 31. 희망의ID              */
			   ,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null, ' <'||to_char(e.LAST_UPDT_DT, 'yyyymmddhh24miss')||' '||f.USER_NM||'>') as EXMN_SPSB_CTN /* 32. 검사처방특이내용  */
			   ,  c.CLRS_PRJC_CD  as CLRS_PRJC_CD                                   /* 33. 임상연구과제ID         */
			   ,  c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
			   ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
			   ,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') as WNTD_DT        /* 35. 희망일시             */
			   ,  c.ODDR_ID as ODDR_ID    /* 36. 처방의사ID   */
			   ,  c.ODKI_CD as ODKI_CD    /* 37. 처방종류코드 */
			   ,  a.BDSD_YN as BDSD_YN    /* 38. Bedside여부  */
			   ,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
															, ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||( select F_A.USER_NM
																															   from CCUSRDPHT F_A
																															  where F_A.USER_ID = e.LAST_UPDR_ID )||'>') as APNT_RMRK_CTN /* 39. 진료예약정보(검사별특이사항) */
			   ,  nvl(c.HSLC_DVSN_CD, 'M') as ORDR_LCDV_CD  /* 40. 처방위치구분코드  */
			   ,  nvl(c.MCCN_CD, 'M') as CNTR_CD        /* 41. 진료센터코드      */
			   ,  a.IMPL_HSDV_CD as IMPL_LCDV_CD        /* 42. 실시병원구분코드  */
			   ,  b.RCEQ_USE_YN as UNMD_RCEQ_USE_YN     /* 43. 접수기사용여부    */
			   ,  c.INPT_USER_DVSN_CD as USER_DVSN_CD   /* 44. 입력사용자구분코드 */
			   ,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') as WNTD_DT_1        /* 45. 희망일시             */
		     ,  decode(c.RISK_FCTR_VL,'1','Pacemaker'
		                             ,'2','심실재동기화 치료 제세동기'
		                             ,'3','체내제세동기'
		                             ,'4','인공와우'
		                             ,'5','캡슐내시경'
		                             ,'6','유방조직확장기'
		                             ,'7','해당없음'
		                             ,'/') as  RISK_FCTR_MEMO_CTN           /*  위험인자 */
			   ,  c.PTAD_CODV_CD as PTAD_PTDV_CD   /* 47. 원무내원구분코드 */
			   ,  c.PTAD_CLBA_YMD as PACL_YMD  /* 48. 원무계산기준일자 */
			   ,  to_char(l.MDCR_DT, 'yyyymmddhh24mi')  as MDCR_YMD      /* 50. 진료일시   */
			   ,  ''  as SMDV_CD  /* 51. 선택진료신청구분   */
			   ,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as SMDP_CLSF_CD   /* 52. 원무계산일자 */
			   ,  c.CHDR_ID as CHDR_ID   /* 53. 지정의사ID  */
			   ,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y') as MTFR_TKNG_YN   /* 54. 메포민대상코드  */
			   ,  c.DYTM_WARD_USE_WNTD_YN as DYTM_WARD_USE_WNTD_YN    /* 55. 낮병동사용희망여부 */
			   ,  b.DTLS_EXCF_CD as DTLS_EXCF_CD  /* 56. 검사분류세부 */
			   ,  a.ASAP_YN as ASAP_YN   /* 57. 가능한빨리 */
			   ,  replace(replace(c.EXOR_UNSL_CTN, chr(13), chr(32)), chr(10), chr(32)) as EXOR_UNSL_CTN   /* 59. 검사처방특이내용 */
			   ,  c.MDRP_NO as MDRP_NO   /* 60. 진료접수번호  */
			   ,  trunc(substr(
					  fn_sw_bodysize_s(a.PTNO)
					, instr(fn_sw_bodysize_s(a.PTNO),'@',1,2)+1
					, length(fn_sw_bodysize_s(a.PTNO))
					  - instr(fn_sw_bodysize_s(a.PTNO),'@',1,2)
				  ))                                                          as WT  /* 61. 체중 */
			   ,  trunc(substr(
					  fn_sw_bodysize_s(a.PTNO)
					, 10
					, instr(fn_sw_bodysize_s(a.PTNO),'@',1,2)-10
				  ))                                                          as HT  /* 62. 신장 */
					  , ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = c.MCDP_CD group by ABRV_DPRT_CD )  as MCDP_NM      /* 64. 진료과명          */
					  , ( select
								  z.DETL_CD_NM
							 from  MNEERRPAT y
								  ,CCCMCDDMT z
							where y.PTNO = a.PTNO
							  and y.CHOT_DT IS NULL
							  and z.COMN_GRP_CD = 'MN229'
							  and z.COMN_DTLS_CD = y.ERRM_LCTN_CD ) as LCTN_NM                     /* 65. 응급실위치 */
					  , c.ORCL_CD as ORCL_CD                                                       /* 66. 처방분류코드 */
					  , ( select  USER_NM from CCUSRDPHT where USER_ID = a.AMPR_ID )as AFI_AMPR_NM /* 67. 예약자명 */
				,  a.CNSG_HSPT_CD as CNSG_HSPT_CD        /* 68. 수탁병원코드 */
				,  c.NNMT_EXMN_YN as NNMT_EXMN_YN         /* 69. 비대면 환자 여부     */
				,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /* 70. 비대면검사통보일자   */
				,  (select case
							 when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'           /*  Drop일자가 현재일까지면 D(Drop) */
							 when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
						   end
					 from  APRCRPTNT apr
						,  MDFASTRPT mdf
					where  apr.MDRP_NO = a.MDRP_NO
					  and  apr.FATR_CD is not null
					  and  mdf.PTNO = apr.PTNO
					  and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
					)                             as FATR_CD                  /* 71. 신속(Fast Track) */
				,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
					 , '1', 'Y'
					 , null
				   )                                           as EXMN_WNTD_YMD_DVSN_CD  /* 72. 당일검사 FLAG */
				   ,  a.EXMN_FALR_RGST_RESN_CTN  as EXMN_FALR_RGST_RESN_CTN  /* 73. 검사실패등록사유내용 */ 
				   ,  a.PRVS_TX_DGST_CTN as PRVS_TX_DGST_CTN   /* 74. 사전처치약물내용 */
				   ,  a.EXMN_ANDV_CD as EXMN_ANDV_CD    /* 75. 검사예약구분코드 */
				   ,  a.ABRV_DPRT_CD as ABRV_DPRT_CD    /* 76. 약어부서코드  */
				   ,  a.CHLD_CALM_YN as CHLD_CALM_YN   /* 77. 소아진정여부 */ 
				   ,  (select F_A.ABRV_DPRT_CD from hzdeptmmt F_A where F_A.dprt_cd = c.mccn_cd) as MCCN_NM  /* 78. 진료센터코드 약어명*/ 
				  ,  g.GEND_CD                                                        as GEND_CD   /* 79. 성별 */
				  ,  trunc(months_between(trunc(sysdate), g.BTDT)  / 12)             as AGE_VL   /* 80. 나이 */
				  , c.PRTB_YN                                                        as PRTB_YN   /* 81. 포터블여부 */
				  , c.PTNO||to_char(c.ORDR_YMD, 'yyyy-mm-dd')||lpad(c.ORDR_SNO, 22, '0')   as ORPR_VL  /* 82. 처방키*/
				   ,  to_char(c.ENFR_DT, 'yyyymmddhh24mi')as ENFR_DT       /*  83. 실시일시             */ 
				  ,  (
						select  case
								 when exists (
												   select  1
													 from  SWSNDMAMT
												  where  PTNO = a.PTNO
													 and  ORDR_YMD = a.ORDR_YMD
													and  ORDR_SNO = a.ORDR_SNO
												   )
								then 'Y'
							   else      'N'
							   end
					   from  DUAL
					  )   as   SCND_ORDR_YN  /*  84. 2차처방유무             */ 
		        , decode( b.AGDC_NEED_EN ,'Y', FN_SW_EXMAGDC_YN(c.PTNO, c.ORDR_YMD, c.ORDR_SNO, '')
		                                                  ,'N' )  as AGDC_YN /* 85. 동의서여부 */
				, decode(c.ANGG_INRV_DVSN_CD,'1','100%','2','50%','3','70%','4','25%','-') as ANGG_INRV_DVSN_NM
				, c.ORDR_IPDV_CD 
		       , case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') and c.PTAD_CODV_CD <> 'E' then ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) || '/' || l.CARE_PTRM_NO
		                                when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') and c.PTAD_CODV_CD = 'E' then ( select  loc.ERRM_ZONE_NM||'-'||err.SCKB_NO_VL from MNEERRPAT err, MNEERRMZT loc where err.MDRP_NO = c.MDRP_NO and err.ERRM_LCTN_CD = loc.ERRM_LCTN_CD)
		                    when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		                    else ''   end  as CARE_WARD_NM   /* 89. 현재병동 */
		        , to_char(l.DSCH_DT,'yyyymmddhh24mi')  as DSCH_DT
		   ,  (
						   select fn_sw_decide_instyp_s(
										c.PTNO
									  , c.ORDR_YMD
									  , c.ORDR_SNO
								  )
						   from DUAL
						 )                                                                as IPDV_NM
		              , decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		   , a.PRVL_RPTN_YN						PRVL_RPTN_YN	
		   , ''     as PTNT_EXMN_NM
		   , ''  as INFT_SMSR_SNDG_CTN	
		   , c.SLPN_YN  as SLPN_PSBL_YN
		   , c.ORFR_CD
		   , a.SCHD_TYP_CD as  SCHD_TYP_CD
		   , c.prtb_yn as PRTB_YN
		   , c.MCCN_CD as MCCN_CD  /* 진료센터코드  */	
		   ,  ( select F_C.KORN_DPRT_NM from HZDEPTMMT F_C where F_C.DPRT_CD = c.MCCN_CD group by F_C.KORN_DPRT_NM)  as MCCN_NM /*  센터명                 */
		   , ( select cc.DETL_CD_DSCR_CTN  from CCCMCDDMT cc  where cc.COMN_GRP_CD = 'MDP_048' and cc.COMN_DTLS_CD = c.ODKI_DETL_CD ) as DETL_CD_DSCR_CTN  /*처방종류상세구분*/
		   , DECODE(a.EXMN_DTLS_STTS_CD ,'W','임시','X','우선', 'Y', '응급', 'Z' ,'주의' ,'') as  EXMN_DTLS_CTRL_NM
		   , ( select max(x.atmt_crtn_yn) from SZEXMCMMT x where x.ptno  = c.ptno and x.ordr_ymd = c.ordr_ymd and x.ordr_sno = c.ordr_sno) ATMT_CRTN_YN
		   , c.PTAD_MDRP_NO
		    , to_char(c.RCPC_DT, 'yyyymmddhh24mi')  as RCPC_DT
		    , (select LISTAGG(x.SCHD_TYP_CD, ', ') WITHIN GROUP (ORDER BY ROWNUM) from SWSCHORDT x where x.excf_cd = c.excf_cd and x.exmn_cd = c.ordr_cd) SCHD_TYP_NM
		    , fn_sr_ward_telno(l.MDRP_NO) ETC_TLNO
		    , FN_MD_GETAGE('', g.BTDT, trunc(sysdate)) as CD_VL
		  from  SWWORKMMT a                              /*  검사 WORK 관리 (계속) */
		     ,  MDORDRCMT b
		     ,  MDEXMORDT c
		     ,  SZROOMCMT d
		     ,  SZCTRLMMT e                       /*  제어코드 */
		     ,  CCUSRDPHT f
		     ,  APPTPTNTT g
		     ,  CCUSRDPHT mo
		     ,  CCUSERAMT mob
		     ,  SZCTRLMMT j
		     ,  SRNOCFMCT srn   /*  판독부위예외코드   */
		     ,  APRCRPTNT l
		   where  a.PTNO    = #{ptno}                          /*  환자번호             */
		         and  a.EXCF_CD  =#{excfCd}                         /*  검사분류             */
		         and  a.EXMN_STTS_CD in ('A', 'C', #{dvsnVl})                    /*  진행STATUS(진료지원) */
		         and  a.EXMN_CD = b.ORDR_CD                   /*  검사코드             */
		         and  ( ( #{dtlsExcfCd}  is null)
		                            or ( b.DTLS_EXCF_CD = #{dtlsExcfCd}  ) )
		         and  a.PTNO     = c.PTNO                      /*  환자번호             */
		         and  a.ORDR_SNO = nvl(#{ordrSno}, a.ORDR_SNO)     /*  처방순번             */
		         and  a.ORDR_YMD   = c.ORDR_YMD                        /*  처방일자             */
		         and  a.ORDR_SNO  = c.ORDR_SNO                         /*  처방순번             */
				 and  nvl(c.DC_DVSN_CD, 'N')= 'N'
		         and (  instr(#{ptdvCtn} , c.CODV_CD) > 0 )
		         and  a.EXRM_CD = d.EXRM_CD(+)                /*  검사실코드           */
		         and  a.EXCF_CD  = d.EXCF_CD(+)                       /*  검사분류             */
		         and  e.EXMN_CTRL_CD     (+) = 'SWA_180'                   /*  검사항목별 특이사항 */
		         and  e.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		         and  e.APLY_PART_CD     (+) = a.EXCF_CD
		         and  e.LAST_UPDR_ID = f.USER_ID(+)
		         and  c.ODDR_ID = mo.USER_ID(+)
		         and  g.PTNO = a.PTNO
		         and  mo.LGIN_ID  = mob.LGIN_ID(+)
		         and  j.EXMN_CTRL_CD(+) = 'SR210'
		         and  j.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		         and  srn.MCDP_CD(+) = c.MCDP_CD
		         and  srn.ORDR_CD(+) = c.ORDR_CD
		         and  c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)         /*  환자구분             */
		         and  c.MDRP_NO = l.MDRP_NO
		         and  (
		                 nvl(#{valdHhDvsnCd}, 'Y') = 'N'
		                 or
		                 a.ORDR_YMD > trunc( sysdate - 365*2)
		              )
		         and  nvl(c.ORFR_CD, 'N') not in ('D', 'P') /* 과내검사 및 임시처방 제외)  */  
		         and  c.TMPR_ORDR_YN = 'N' 
		       order
		          by  9 desc /*  처방일자 8  -> 9             */
		           ,  10     /*  진료과  9  -> 10             */
		           ,  14     /*  검사코드 15 -> 14            */
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSV-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="cnsgHsptCd" column="CNSG_HSPT_CD"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="exrmCd1" column="EXRM_CD_1"/>
		<result property="schdDtlsTypCd" column="SCHD_DTLS_TYP_CD"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="drNm" column="DR_NM"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="amprId" column="AMPR_ID"/>
		<result property="andvCd" column="ANDV_CD"/>
		<result property="exmnCd" column="EXMN_CD"/>
		<result property="ptno" column="PTNO"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="iodnMdteAdmnQty" column="IODN_MDTE_ADMN_QTY"/>
		<result property="ht" column="HT"/>
		<result property="wt" column="WT"/>
		<result property="pacsAccsNo" column="PACS_ACCS_NO"/>
		<result property="ptdvCd" column="PTDV_CD"/>
		<result property="centApntPsblYn" column="CENT_APNT_PSBL_YN"/>
		<result property="apntYn" column="APNT_YN"/>
		<result property="rernYn" column="RERN_YN"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="wntdDrNm" column="WNTD_DR_NM"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="clrsPrjcDrId" column="CLRS_PRJC_DR_ID"/>
		<result property="clrsPrjcDrNm" column="CLRS_PRJC_DR_NM"/>
		<result property="bdsdYn" column="BDSD_YN"/>
		<result property="apntRmrkCtn" column="APNT_RMRK_CTN"/>
		<result property="emrTrasYn" column="EMR_TRAS_YN"/>
		<result property="ordrLcdvCd" column="ORDR_LCDV_CD"/>
		<result property="cntrCd" column="CNTR_CD"/>
		<result property="implLcdvCd" column="IMPL_LCDV_CD"/>
		<result property="unmdRceqUseYn" column="UNMD_RCEQ_USE_YN"/>
		<result property="wntdDt" column="WNTD_DT"/>
		<result property="smdvCd" column="SMDV_CD"/>
		<result property="smdpClsfCd" column="SMDP_CLSF_CD"/>
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="ptadPtdvCd" column="PTAD_PTDV_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="excfCd" column="EXCF_CD"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="riskFctrMemoCtn" column="RISK_FCTR_MEMO_CTN"/>
		<result property="afiAmprNm" column="AFI_AMPR_NM"/>
		<result property="dytmWardUseWntdYn" column="DYTM_WARD_USE_WNTD_YN"/>
		<result property="exrmCd2" column="EXRM_CD_2"/>
		<result property="nnmtExmnYn" column="NNMT_EXMN_YN"/>
		<result property="nnmtExmnNtfcYmd" column="NNMT_EXMN_NTFC_YMD"/>
		<result property="fatrCd" column="FATR_CD"/>
		<result property="exmnWntdYmdDvsnCd" column="EXMN_WNTD_YMD_DVSN_CD"/>
		<result property="clno" column="CLNO"/>
		<result property="imlnClsfCd" column="IMLN_CLSF_CD"/>
		<result property="clsfNm" column="CLSF_NM"/>
		<result property="exmnFalrRgstResnCtn" column="EXMN_FALR_RGST_RESN_CTN"/>
		<result property="prvsTxDgstCtn" column="PRVS_TX_DGST_CTN"/>
		<result property="exmnAndvCd" column="EXMN_ANDV_CD"/>
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="asapYn" column="ASAP_YN"/>
		<result property="chldCalmYn" column="CHLD_CALM_YN"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="enfrDt" column="ENFR_DT"/>
		<result property="scndOrdrYn" column="SCND_ORDR_YN"/>
		<result property="injcKindNm" column="INJC_KIND_NM"/>
		<result property="mdsiCd" column="MDSI_CD"/>
		<result property="exmnEnfrDt" column="EXMN_ENFR_DT"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="careWardNm" column="CARE_WARD_NM"/>
		<result property="dschDt" column="DSCH_DT"/>
		<result property="ipdvNm" column="IPDV_NM"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="dtlsExcfCd" column="DTLS_EXCF_CD"/>
		<result property="prvlRptnYn" column="PRVL_RPTN_YN"/>
		<result property="exorUnslCtn" column="EXOR_UNSL_CTN"/>
		<result property="ptntExmnNm" column="PTNT_EXMN_NM"/>
		<result property="ptntExmnNm" column="PTNT_EXMN_NM"/>
		<result property="inftSmsrSndgCtn" column="INFT_SMSR_SNDG_CTN"/>
		<result property="slpnPsblYn" column="SLPN_PSBL_YN"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="agdcYn" column="AGDC_YN"/>
		<result property="schdTypCd" column="SCHD_TYP_CD"/>
		<result property="schdDtlsTypCd" column="SCHD_DTLS_TYP_CD"/>
		<result property="prtbYn" column="PRTB_YN"/>
		<result property="wntdDrId" column="WNTD_DR_ID"/>
		<result property="mccnCd" column="MCCN_CD"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="detlCdDscrCtn" column="DETL_CD_DSCR_CTN"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="schdTypNm" column="SCHD_TYP_NM"/>
		<result property="cdVl" column="CD_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSV (검사 예약접수 조회 SV) 
        Description :                                           검사 예약접수 조회 SV
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSV-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSV"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSV-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnSV */
		<![CDATA[
		  select  /*+ swd_workmmt_l89$S01_검사 예약접수 조회 SV */
		                a.CNSG_HSPT_CD as CNSG_HSPT_CD                                              /*  수탁병원코드         */
		             , nvl(a.EXRM_CD, nvl((select ty.EXRM_CD 
						                                        from SWSCHTYPT ty, szroomcmt ro
						                                        where ty.SCHD_TYP_CD    = a.SCHD_TYP_CD  
						                                      and ty.SCHD_DTLS_TYP_CD   = a.SCHD_DTLS_TYP_CD
						                                      and ty.EXCF_CD            = a.EXCF_CD
						                                      and ty.SCHD_DTLS_TYP_CD_USE_YN ='Y'
						                                      and ty.EXCF_CD            = ro.EXCF_CD
						                                      and ty.EXRM_CD            = ro.EXRM_CD), b.OTPT_EXRM_CD)) as  EXRM_CD     /*  검사실코드           */
		             ,  decode(d.RCST_CD, 'Y', '수납', 'N', '미수', 'R', '환불', 'W', '수납') as EXRM_CD_1  /*  수납여부     */
		             ,  case when d.EXOR_PRSS_CD is null then  fn_sw_schsubtyp_s(d.PTNO, d.ORDR_YMD, d.ORDR_SNO)
		                    else a.SCHD_DTLS_TYP_CD end    as SCHD_DTLS_TYP_CD     /*  스케쥴 SUB TYPE      */
		             ,  ( select F_A.USER_NM from CCUSRDPHT F_A where F_A.USER_ID = d.CHDR_ID )as CHDR_NM                     /*  지정의사             */
		             ,  ( select F_A.USER_NM from CCUSRDPHT F_A where F_A.USER_ID = d.ODDR_ID )as DR_NM  /*  처방의사             */
		             ,  to_char(a.APNT_DT, 'yyyymmddhh24mi') as APNT_DT                               /*  예약일시             */
		             ,  to_char(a.RPTN_DT, 'yyyymmddhh24mi')as RPTN_DT                          /*  접수일시             */
		             ,  to_char(d.ORDR_YMD, 'yyyymmdd')as ORDR_YMD                                   /*  처방일자             */
		             ,  d.MCDP_CD as MCDP_CD
		             ,   b.ORDR_NM    as ORDR_NM          /*  [처방위치]처방명     */
		             ,  a.AMPR_ID as AMPR_ID                                                                 /*  예약자               */
		             ,  a.ANDV_CD as ANDV_CD                                                                 /*  예약구분 중앙: Y     */
		             ,  d.ORDR_CD as EXMN_CD                                                                 /*  검사코드             */
		             ,  d.PTNO as PTNO                                                                    /*  환자번호             */
		             ,  d.ORDR_SNO as ORDR_SNO                                                                /*  처방순번             */
		             ,  d.EXOR_PRSS_CD as EXMN_PRSS_CD                                                            /*  진행STATUS(진료지원) */
		             ,  to_char(c.IODN_MDTE_ADMN_QTY) as IODN_MDTE_ADMN_QTY                   /*  옥소치료시 투여량    */
		                ,  decode(nvl(to_char(c.HGHT_VL),'0'),'0', substr(
		                                                                   fn_sw_bodysize_s(d.PTNO)
		                                                                 , 10
		                                                                 , instr(fn_sw_bodysize_s(d.PTNO),'@',1,2)-10
		                                                               )
		                                                         , to_char(c.HGHT_VL))  as HT          /*  신장                 */
		             ,  decode(nvl(to_char(c.BDWG_VL),'0'),'0', substr(
		                                                                   fn_sw_bodysize_s(d.PTNO)
		                                                                 , instr(fn_sw_bodysize_s(d.PTNO),'@',1,2)+1
		                                                                 , length(fn_sw_bodysize_s(d.PTNO))
		                                                                   - instr(fn_sw_bodysize_s(d.PTNO),'@',1,2)
		                                                                  )
		                                                         , to_char(c.BDWG_VL))  as WT           /*  체중                 */
		             ,  a.PACS_ACCS_NO as PACS_ACCS_NO                                                            /*  ACCESSION NUMBER     */
		             ,  d.PTAD_CODV_CD as PTDV_CD                                                                 /*  환자구분             */
		             ,  b.CENT_APNT_PSBL_YN as CENT_APNT_PSBL_YN                                                       /*  중앙예약가능여부     */
		             ,  nvl(b.APNT_NEED_EN, 'N') as APNT_YN                                                  /*  예약 검사여부        */
		             ,  decode(to_char(a.RERN_PRRN_DT, 'dd'), '', 'N', 'Y') as RERN_YN                       /*  REPEAT 여부          */
		                 ,  ( select F_A.USER_NM from CCUSRDPHT F_A where F_A.USER_ID = a.RCPS_ID) as RCPS_NM    /*  접수자               */
		                 ,  ( select F_A.USER_NM from CCUSRDPHT F_A where F_A.USER_ID = d.EXMN_WNTD_DR_ID) as WNTD_DR_NM      /*  희망의               */
		          ,  d.CLRS_PRJC_CD as CLRS_PRJC_CD                                  /* 33. 임상연구코드         */
		                           ,  d.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
		                           ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = d.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
		             ,  a.BDSD_YN as BDSD_YN
		             ,  (
		                     select  F_A.CTRL_DSCR_CTN
		                       from  SZCTRLMMT F_A
		                      where  F_A.EXMN_CTRL_CD = 'SWA_180'
		                        and  F_A.EXMN_DTLS_CTRL_CD = d.ORDR_CD
		                   ) as APNT_RMRK_CTN/*  진료예약정보(검사별특이사항) */
		             , 'N' as EMR_TRAS_YN /* [PROB] fn_st_emr_pat_yn(d.PTNO, d.MCDP_CD, d.PTAD_CODV_CD)  emryn */
		             ,  nvl(d.HSLC_DVSN_CD, 'M') as ORDR_LCDV_CD                                                  /*  처방위치            */
		             ,  nvl(d.MCCN_CD, 'M') as CNTR_CD
		             ,  a.IMPL_HSDV_CD as IMPL_LCDV_CD
		             ,  b.RCEQ_USE_YN as UNMD_RCEQ_USE_YN
		             ,  to_char(d.WNTD_DT, 'yyyymmddhh24mi')  as WNTD_DT
		             , ''  as SMDV_CD
		             ,  fn_sw_spcsugacls_s(d.PTNO, d.ORDR_YMD, d.ORDR_SNO) as SMDP_CLSF_CD
		             ,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') as MDCR_YMD      /*  진료일자   */
		             ,  d.PTAD_CODV_CD as PTAD_PTDV_CD
		             ,  d.CHDR_ID as CHDR_ID
		             ,  d.EXCF_CD as EXCF_CD
		             ,  decode(a.ANDV_CD, 'C', '[통합]'
		                                 , 'W', '병동'
		                                , 'Y', '일반'
		                                , 'S',  decode( a.IMPL_HSDV_CD, ''
		                                                            , '비일정'
		                                                            , '비일정/'|| a.IMPL_HSDV_CD)
		                                , ''
		                       ) as AFI_ANDV_NM /*  예약구분 */
		             , ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = d.MCDP_CD group by ABRV_DPRT_CD ) as MCDP_NM  /*  진료과               */
		             ,  decode(d.RISK_FCTR_VL,'1','Pacemaker'
		                                     ,'2','심실재동기화 치료 제세동기'
		                                     ,'3','체내제세동기'
		                                     ,'4','인공와우'
		                                     ,'5','캡슐내시경'
		                                     ,'6','유방조직확장기'
		                                     ,'7','해당없음'
		                                     ,'/') as  RISK_FCTR_MEMO_CTN           /*  위험인자 */
		                , ( select  USER_NM from CCUSRDPHT where USER_ID = a.AMPR_ID) as AFI_AMPR_NM /*  예약자명 */
		               ,  d.DYTM_WARD_USE_WNTD_YN as DYTM_WARD_USE_WNTD_YN                                      /*  낮병동사용희망여부 */
		               ,  decode(nvl(d.HSLC_DVSN_CD, 'M'),
		                                             'C' , decode(b.CACN_EXMN_YN,
		                                                                     'Y', b.CAHS_SCHD_SBTY_CD
		                                                                        , b.APNT_SCHD_SBTY_NM)
		                                                 , decode(b.MAIN_EXMN_YN,
		                                                                     'Y', b.APNT_SCHD_SBTY_NM
		                                                                        , b.CAHS_SCHD_SBTY_CD)
		                  ) as EXRM_CD_2 /*  계산 스케줄 타입 */
		              ,  d.NNMT_EXMN_YN as NNMT_EXMN_YN         /*  비대면 환자 여부     */
		              ,  to_char(d.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /*  비대면검사통보일자   */
		              ,  (select case
		                           when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'           /*  Drop일자가 현재일까지면 D(Drop) */
		                           when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
		                         end
		                   from  APRCRPTNT apr
		                      ,  MDFASTRPT mdf
		                  where  apr.MDRP_NO = d.MDRP_NO
		                    and  apr.FATR_CD is not null
		                    and  mdf.PTNO = apr.PTNO
		                    and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
		                  ) as FATR_CD                  /*  신속(Fast Track) */
		              ,  decode(nvl(d.EXMN_WNTD_YMD_DVSN_CD,'X')
		                   , '1', 'Y'
		                   , null
		                 ) as EXMN_WNTD_YMD_DVSN_CD    /*  당일검사 FLAG */
		              ,  (
		                  select  /*+index_desc(APPTCNPNV APPTCNPNV_pk)*/
		                          translate(T1.PTNT_TLNO , '0123456789'||translate(T1.PTNT_TLNO , 'x0123456789','x'), '0123456789')
		                    from  APPTCNPNV   t1 /*  환자연락처 */
		                   where  T1.PTNO          = d.PTNO
		                     and  T1.CNPN_DVSN_CD  = 'BP'  /* 연락처구분 BP 기본휴대폰번호*/
		                     and  rownum           = 1
		                ) as CLNO
		                ,  a.IMLN_CLSF_CD as IMLN_CLSF_CD    /*  임플란트 분류군 코드 */
		                , (select  F_A.TMOT_DVSN_DETL_NM
		                     from  MDEITMOCT F_A
		                    where  F_A.TMOT_DVSN_CD = '01'
		                      and  F_A.MCDP_CD = a.MCDP_CD
		                       and  F_A.TMOT_DVSN_DETL_CD = a.IMLN_CLSF_CD) as CLSF_NM   /*  임플란트 분류군 코드 */
		                ,  a.EXMN_FALR_RGST_RESN_CTN as EXMN_FALR_RGST_RESN_CTN
		                ,  a.PRVS_TX_DGST_CTN as PRVS_TX_DGST_CTN
		                ,  a.EXMN_ANDV_CD as EXMN_ANDV_CD
		                ,  a.ABRV_DPRT_CD as ABRV_DPRT_CD
		                ,  a.ASAP_YN as ASAP_YN
		                ,  a.CHLD_CALM_YN as CHLD_CALM_YN
		                ,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = d.PTNO) as PTNT_NM
		                ,  (select F_A.ABRV_DPRT_CD from hzdeptmmt F_A where F_A.dprt_cd = d.mccn_cd) as MCCN_NM
		                ,  to_char(a.ENFR_DT, 'yyyymmddhh24mi')as ENFR_DT       /*  83. 실시일시             */ 
		       		    ,  (
		                            select  case
		                                     when exists (
		                                                       select  1
		                                                         from  SWSNDMAMT
		                                                      where  PTNO = a.PTNO
		                                                         and  ORDR_YMD = a.ORDR_YMD
		                                                        and  ORDR_SNO = a.ORDR_SNO
		                                                       )
		                                    then 'Y'
		                                   else      'N'
		                                   end
		                           from  DUAL
		                  )   as   SCND_ORDR_YN  /*  84. 2차처방유무             */ 
				        ,  c. INJC_KIND_NM as INJC_KIND_NM /* 85. 주사종류 */
						,  c.MDSI_CD    as MDSI_CD /* 86. 투여부위*/
						,  to_char(c. EXMN_ENFR_DT, 'yyyymmddhh24mi') as  EXMN_ENFR_DT   /* 88. 검사예정시간*/
		                ,  ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = d.WARD_CD group by ABRV_DPRT_CD ) as WARD_CD /* 90. 처방시 병동 */
			/*	,  case when  nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD ) 
				                when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
				                else '' end  as CARE_WARD_NM /* 89. 현재병동 */
		 , case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) || '/' || l.CARE_PTRM_NO
		          when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		          else '' 
		     end  as CARE_WARD_NM /* 89. 현재병동 */
		        , to_char(l.DSCH_DT,'yyyymmddhh24mi')  as DSCH_DT
		   ,  (
						   select fn_sw_decide_instyp_s(
										d.PTNO
									  , d.ORDR_YMD
									  , d.ORDR_SNO
								  )
						   from DUAL
						 )                                                                as IPDV_NM
		       ,  decode(d.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
			   ,  b.DTLS_EXCF_CD as DTLS_EXCF_CD  /* 56. 검사분류세부 */
			   , a.PRVL_RPTN_YN						PRVL_RPTN_YN
		       , d.EXOR_UNSL_CTN as EXOR_UNSL_CTN   /* 검사처방특이내용 */	
		       , b.PTNT_EXMN_NM  as PTNT_EXMN_NM
		       , b.PTNT_EXMN_NM      as PTNT_EXMN_NM
		       , b.INFT_SMSR_SNDG_CTN  as INFT_SMSR_SNDG_CTN	
		       , d.SLPN_YN  as SLPN_PSBL_YN
		       , d.MDRP_NO as MDRP_NO  
		       , decode( m.AGDC_NEED_EN ,'Y', FN_SW_EXMAGDC_YN(d.PTNO, d.ORDR_YMD, d.ORDR_SNO, '')
		                                                  ,'N' )  as AGDC_YN /* 85. 동의서여부 */   
		       , a.SCHD_TYP_CD as   SCHD_TYP_CD 
		       , a.SCHD_DTLS_TYP_CD as SCHD_DTLS_TYP_CD
			   , d.prtb_yn as PRTB_YN
		       , '' as WNTD_DR_ID
		       , d.MCCN_CD as MCCN_CD  /* 진료센터코드  */	
		       ,  ( select F_C.KORN_DPRT_NM from HZDEPTMMT F_C where F_C.DPRT_CD = d.MCCN_CD group by F_C.KORN_DPRT_NM)  as MCCN_NM /*  센터명                 */
			   , ( select cc.DETL_CD_DSCR_CTN  from CCCMCDDMT cc  where cc.COMN_GRP_CD = 'MDP_048' and cc.COMN_DTLS_CD = d.ODKI_DETL_CD ) as DETL_CD_DSCR_CTN  /*처방종류상세구분*/
		       , d.PTAD_MDRP_NO
		       , (select LISTAGG(x.SCHD_TYP_CD, ', ') WITHIN GROUP (ORDER BY ROWNUM) from SWSCHORDT x where x.excf_cd = d.excf_cd and x.exmn_cd = d.ordr_cd) SCHD_TYP_NM
		       , FN_MD_GETAGE('', g.BTDT, trunc(sysdate)) as CD_VL
		   from
		           MDEXMORDT d
		        ,  SWORDRCMT b
		        ,  SVWORKDMT c                                          /*  핵의학체내 WORK 관리 DETAIL */
		        ,  SWWORKMMT a                                           /*  검사 WORK 관리 (계속) */
		        ,  SZCTRLMMT e    /*  제어코드 */
		        ,  APRCRPTNT l 
		        ,  MDORDRCMT m
		        ,  APPTPTNTT g
		    where  d.PTNO    = #{ptno}                        /*  환자번호               */
		      and  d.EXCF_CD  = #{excfCd}                    /*  검사분류               */
		      and  ( ( #{dtlsExcfCd}  is null)
		                            or ( b.DTLS_EXCF_CD = #{dtlsExcfCd}  ) )
		      and  (d.EXOR_PRSS_CD is null or d.EXOR_PRSS_CD in ('A', 'C'))    /*  진행STATUS(진료지원)  */
		      and  d.ORDR_CD = b.ORDR_CD                                       /*  검사코드                */
		      and  d.PTNO    = c.PTNO(+)                                          /*  환자번호                */
		      and  d.ORDR_YMD  = c.ORDR_YMD(+)                                    /*  처방일자                */
		      and  d.ORDR_SNO = c.ORDR_SNO(+)                                     /*  처방순번                */
		      and  d.PTNO    = a.PTNO(+)                                          /*  환자번호                */
		      and  d.ORDR_YMD  = a.ORDR_YMD(+)                                    /*  처방일자                */
		      and  d.ORDR_SNO = a.ORDR_SNO(+)                                     /*  처방순번                */
		 	  and  nvl(d.DC_DVSN_CD, 'N') = 'N'	
		      and  d.ptno     = g.ptno
		      and (  instr(#{ptdvCtn} , d.CODV_CD) > 0 )
		      and  e.EXMN_CTRL_CD     (+) = 'SWA_180'  /*  검사항목별 특이사항 */
		      and  e.EXMN_DTLS_CTRL_CD(+) = d.ORDR_CD
		      and  e.APLY_PART_CD     (+) = d.EXCF_CD
		      and  d.MDRP_NO = l.MDRP_NO 
		      and  (
		              nvl(#{valdHhDvsnCd}, 'Y') = 'N'
		              or
		              d.ORDR_YMD > trunc( sysdate - 365*2)
		           )
		      and  m.ORDR_CD = d.ORDR_CD   
		      and  nvl(d.ORFR_CD, 'N') not in ('D', 'P') /* 과내검사 및 임시처방 제외)  */  
		      and  d.TMPR_ORDR_YN = 'N' 
		            order
		               by  d.ORDR_YMD desc
		    ]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll0-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="enfrDt" column="ENFR_DT"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="userNm1" column="USER_NM_1"/>
		<result property="userNm2" column="USER_NM_2"/>
		<result property="rcstCd" column="RCST_CD"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="cnsgHsptCd" column="CNSG_HSPT_CD"/>
		<result property="wntdDt" column="WNTD_DT"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="codvNm" column="CODV_NM"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="careWardNm" column="CARE_WARD_NM"/>
		<result property="dschDt" column="DSCH_DT"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="ptadCodvCd" column="PTAD_CODV_CD"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="rcstNm" column="RCST_NM"/>
		<result property="erptDvsnNm" column="ERPT_DVSN_NM"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
		<result property="dcOrdrDt" column="DC_ORDR_DT"/>
		<result property="prtbYn" column="PRTB_YN"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll0 ([처방일자기준] 예약 접수 대상자 전체 조회) 
        Description :                                           [처방일자기준] 예약 접수 대상자 전체 조회
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll0-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll0"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll0-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll0 */
		<![CDATA[
		select  /*+ leading(m b) index(m (ORDR_YMD,EXCF_CD)) *//* 처방일자기준 처방상태 */
		        m.PTNO /*환자번호*/
		     ,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /*환자명*/
		     ,  decode(m.EXCF_CD, 'SY', 'AR', fn_sw_roomcode_s(m.PTNO, m.ORDR_YMD, to_char(m.ORDR_SNO))) as EXRM_CD /*검사실*/
		     ,  to_char(m.ORDR_YMD, 'yyyymmdd') as ORDR_YMD    /*처방일자*/
		     ,  to_char(m.APNT_DT, 'yyyymmddhh24mi') as APNT_DT   /*예약일시*/
		     ,  to_char(m.EXRM_RPTN_DT, 'yyyymmddhh24mi') as RPTN_DT    /*접수일시*/
			 ,  to_char(m.ENFR_DT, 'yyyymmddhh24mi') as ENFR_DT    /*실시일시*/	 
		     ,  m.EXOR_PRSS_CD  as EXMN_PRSS_CD  /*진행상태*/
		     ,  m.ORDR_CD                       /*검사코드*/
		     ,  decode(nvl(m.dc_dvsn_Cd,'N'),'N','','[DC]') ||nvl(b.CLNC_PTHL_ORDR_SHRT_NM, b.ORDR_NM)  as ORDR_NM /*검사명*/
		     , ( select ABRV_DPRT_CD
		                      from HZDEPTMMT
		                     where DPRT_CD = m.MCDP_CD
		                     group by ABRV_DPRT_CD ) as MCDP_NM  /*진료과*/
		     ,  dr1.USER_NM as USER_NM_1    /* 36. 처방의사ID   */ 
		     ,  dr2.USER_NM as USER_NM_2   /* 53. 지정의사ID  */
		     ,  nvl(m.RCST_CD, 'N') as RCST_CD /*수납*/
		     ,  m.CODV_CD   as CODV_CD            /*환자구분*/
		     ,  m.ORDR_SNO  as ORDR_SNO           /*  처방순번             */
		     ,  m.MDRP_NO as MDRP_NO              /* 진료접수번호 */
		     ,  ''  as APNT_FRMT_CD               /*  일정/비일정 예약구분 */
		     ,  '' as AFI_ANDV_NM                 /*  예약구분             */
		     ,  '' as AFI_ANDV_NM                     /*  예약자               */
		     ,  '' as RCPS_NM                     /*  접수자               */
		     , '' as CNSG_HSPT_CD                                     /* 68. 수탁병원코드 */
		     , to_char(m.WNTD_DT, 'yyyymmddhh24mi') as WNTD_DT       /* 희망일시 */
		     ,  ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.WARD_CD group by ABRV_DPRT_CD ) as WARD_CD  /*  30.병동                 */
		     , decode(m.CODV_CD,'I',decode(m.ODKI_CD,'D','퇴원','입원')
		                ,'O','외래'
		                ,'E','응급'
		                ,'G','일검'
		                ,'U','종검') as codv_nm 
		     , m.MCDP_CD
		     , m.CHDR_ID
			 , case when (l.CODV_CD = 'O') and (m.MCDP_CD != m.OROC_DPRT_CD) 
		            then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD)
		            else case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') 
		                      then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) 
						      when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
						      else '' 
		                 end
		       end  as CARE_WARD_NM /* 89. 현재병동 */
		   , to_char(l.DSCH_DT,'yyyymmddhh24mi')  as DSCH_DT
		   , m.ODKI_CD
		   , m.PTAD_CODV_CD
		   , m.PTAD_MDRP_NO
		   , decode(m.RCST_CD, 'Y', '수납','W','가수납', 'R','환불','')  as RCST_NM 
		   , fn_mr_errm_unsb_infm(m.mdrp_no) as ERPT_DVSN_NM /*중증외상환자 표시*/
		   , decode(m.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/   
		   , nvl(m.DC_DVSN_CD,'N') as DC_DVSN_CD /*DC구분*/
		   , to_char(m.DC_ORDR_DT,'yyyymmddhh24mi')  as DC_ORDR_DT  /*DC일자*/
		   , m.PRTB_YN as PRTB_YN  /* 포터블여부  */
		   , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		from MDEXMORDT m
		     , SWORDRCMT b
		     ,  CCUSRDPHT dr1
		     ,  CCUSRDPHT dr2
		     ,  APRCRPTNT l
		     , APRCADBLT ad		     
		where  m.EXCF_CD = #{excfCd}
		  and ( instr(#{ptdvCtn} , m.CODV_CD) > 0 )
		  and m.ORDR_YMD between to_date( #{strtYmd} , 'YYYYMMDD') and to_date( #{fnshYmd} , 'YYYYMMDD')
		  and (  #{exrmCd} is null  or ( #{exrmCd} is not null and  b.OTPT_EXRM_CD = #{exrmCd}))
		  and b. DTLS_EXCF_CD = nvl(#{dtlsExcfCd},  b.DTLS_EXCF_CD)
		  and m.EXOR_PRSS_CD  is  null
		  and m.ORDR_CD = b.ORDR_CD
		  and m.ODDR_ID = dr1.USER_ID(+) 
		  and m.CHDR_ID = dr2.USER_ID(+) 
		  and ((#{dcDvsnCd} is null and  nvl(m.DC_DVSN_CD, 'N') = 'N' ) or (#{dcDvsnCd} ='Y' ))
		  and  m.PTAD_MDRP_NO = l.MDRP_NO
		  and  m.PTAD_MDRP_NO = ad.MDRP_NO(+)		  
		  and  nvl(m.ORFR_CD, 'N') not in ('D', 'P') /* 과내검사 및 임시처방 제외)  */
		order by ORDR_YMD, PTNO
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll1-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="enfrDt" column="ENFR_DT"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="userNm1" column="USER_NM_1"/>
		<result property="userNm2" column="USER_NM_2"/>
		<result property="rcstCd" column="RCST_CD"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="afiAmprNm" column="AFI_AMPR_NM"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="cnsgHsptCd" column="CNSG_HSPT_CD"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="codvNm" column="CODV_NM"/>
		<result property="careWardNm" column="CARE_WARD_NM"/>
		<result property="dschDt" column="DSCH_DT"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="ptadCodvCd" column="PTAD_CODV_CD"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="rcstNm" column="RCST_NM"/>
		<result property="erptDvsnNm" column="ERPT_DVSN_NM"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
		<result property="dcOrdrDt" column="DC_ORDR_DT"/>
		<result property="prtbYn" column="PRTB_YN"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll1 ([희망일자기준] 예약 접수 대상자 전체 조회) 
        Description :                                           [희망일자기준] 예약 접수 대상자 전체 조회
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll1-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll1"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll1-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll1 */
		<![CDATA[
		select   /*+ leading(m) index(m (WNTD_DT)) */ /* 희망일자기준 처방상태 */
		        m.PTNO /*환자번호*/
		     ,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /*환자명*/
		     ,  decode(m.EXCF_CD, 'SY', 'AR', fn_sw_roomcode_s(m.PTNO, m.ORDR_YMD, to_char(m.ORDR_SNO))) as EXRM_CD /*검사실*/
		     ,  to_char(m.ORDR_YMD, 'yyyymmdd') as ORDR_YMD    /*처방일자*/
		     ,  to_char(m.APNT_DT, 'yyyymmddhh24mi') as APNT_DT   /*예약일시*/
		     ,  to_char(m.EXRM_RPTN_DT, 'yyyymmddhh24mi') as RPTN_DT    /*접수일시*/
			 ,  to_char(m.ENFR_DT, 'yyyymmddhh24mi') as ENFR_DT    /*실시일시*/	 
		     ,  m.EXOR_PRSS_CD  as EXMN_PRSS_CD  /*진행상태*/
		     ,  m.ORDR_CD                       /*검사코드*/
		     ,  decode(nvl(m.dc_dvsn_Cd,'N'),'N','','[DC]') ||nvl(b.CLNC_PTHL_ORDR_SHRT_NM, b.ORDR_NM)  as ORDR_NM /*검사명*/
		     , ( select ABRV_DPRT_CD
		                      from HZDEPTMMT
		                     where DPRT_CD = m.MCDP_CD
		                     group by ABRV_DPRT_CD ) as MCDP_NM  /*진료과*/
		     ,  dr1.USER_NM as USER_NM_1    /* 36. 처방의사ID   */ 
		     ,  dr2.USER_NM as USER_NM_2   /* 53. 지정의사ID  */
		     ,  nvl(m.RCST_CD, 'N') as RCST_CD /*수납*/
		     ,  m.CODV_CD   as CODV_CD            /*환자구분*/
		     ,  m.ORDR_SNO  as ORDR_SNO           /*  처방순번             */
		     ,  m.MDRP_NO as MDRP_NO              /* 진료접수번호 */
		     ,  ''  as APNT_FRMT_CD               /*  일정/비일정 예약구분 */
		     ,  '' as AFI_ANDV_NM                 /*  예약구분             */
		     ,  '' as AFI_AMPR_NM                     /*  예약자               */
		     ,  '' as RCPS_NM                     /*  접수자               */
		     , '' as CNSG_HSPT_CD                                     /* 68. 수탁병원코드 */ 
		     ,  ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.WARD_CD group by ABRV_DPRT_CD ) as WARD_CD                       /*  30.병동                 */
		     , m.MCDP_CD
		     , m.CHDR_ID
		     , decode(m.CODV_CD,'I',decode(m.ODKI_CD,'D','퇴원','입원')
		                ,'O','외래'
		                ,'E','응급'
		                ,'G','일검'
		                ,'U','종검') as codv_nm 
			 , case when (l.CODV_CD = 'O') and (m.MCDP_CD != m.OROC_DPRT_CD) 
		            then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD)
		            else case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') 
		                      then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) 
						      when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
						      else '' 
		                 end
		       end  as CARE_WARD_NM /* 89. 현재병동 */
		   , to_char(l.DSCH_DT,'yyyymmddhh24mi')  as DSCH_DT
		   , m.ODKI_CD
		   , m.PTAD_CODV_CD
		   , m.PTAD_MDRP_NO
		   , decode(m.RCST_CD, 'Y', '수납','W','가수납', 'R','환불','')  as RCST_NM 
		   , fn_mr_errm_unsb_infm(m.mdrp_no) as ERPT_DVSN_NM /*중증외상환자 표시*/
		   , decode(m.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		   , nvl(m.DC_DVSN_CD,'N') as DC_DVSN_CD /*DC구분*/
		   , to_char(m.DC_ORDR_DT,'yyyymmddhh24mi')  as DC_ORDR_DT  /*DC일자*/
		   , m.PRTB_YN as PRTB_YN  /* 포터블여부  */
		   , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		 from MDEXMORDT m
		     , SWORDRCMT b
		     ,  CCUSRDPHT dr1
		     ,  CCUSRDPHT dr2
		     ,  APRCRPTNT l
		     , APRCADBLT ad
		where  m.EXCF_CD = #{excfCd}
		  and ((#{dcDvsnCd} is null and  nvl(m.DC_DVSN_CD, 'N') = 'N' ) or (#{dcDvsnCd} ='Y' ))
		  and (   instr(#{ptdvCtn} , m.CODV_CD) > 0 )
		  and m.WNTD_DT  between to_date( #{strtYmd} , 'YYYYMMDD') 
		                                   and to_date( #{fnshYmd} , 'YYYYMMDD') + 0.99999
		  and (  #{exrmCd} is null  or (  #{exrmCd} is not null and  b.OTPT_EXRM_CD =  #{exrmCd})) 
		  and b. DTLS_EXCF_CD = nvl(#{dtlsExcfCd},  b.DTLS_EXCF_CD)
		  and m.EXOR_PRSS_CD  is  null
		  and m.ORDR_CD = b.ORDR_CD
		  and m.ODDR_ID = dr1.USER_ID(+) 
		  and m.CHDR_ID = dr2.USER_ID(+) 
		  and  m.PTAD_MDRP_NO = l.MDRP_NO
		  and  m.PTAD_MDRP_NO = ad.MDRP_NO(+)
		  and  nvl(m.ORFR_CD, 'N') not in ('D', 'P') /* 과내검사 및 임시처방 제외)  */
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll2-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="enfrDt" column="ENFR_DT"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="userNm1" column="USER_NM_1"/>
		<result property="userNm2" column="USER_NM_2"/>
		<result property="rcstCd" column="RCST_CD"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="afiAmprNm" column="AFI_AMPR_NM"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="cnsgHsptCd" column="CNSG_HSPT_CD"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="codvNm" column="CODV_NM"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="careWardNm" column="CARE_WARD_NM"/>
		<result property="dschDt" column="DSCH_DT"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="ptadCodvCd" column="PTAD_CODV_CD"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="rcstNm" column="RCST_NM"/>
		<result property="erptDvsnNm" column="ERPT_DVSN_NM"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
		<result property="dcOrdrDt" column="DC_ORDR_DT"/>
		<result property="prvlRptnYn" column="PRVL_RPTN_YN"/>
		<result property="prtbYn" column="PRTB_YN"/>
		<result property="egfrbExrsVl" column="EGFRB_EXRS_VL"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll2 ([예약일자기준] 예약 접수 대상자 전체 조회) 
        Description :                                           [예약일자기준] 예약 접수 대상자 전체 조회
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll2-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll2"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll2-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll2 */
		<![CDATA[ 
		select /*+ LEADING (W) INDEX (W SWWORKMMT_I01 )  */ 
		      /* 예약일자기준 예약상태 */
		      m.PTNO /*환자번호*/
		     ,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /*환자명*/
		     , nvl(w.EXRM_CD, nvl((select ty.EXRM_CD 
						                                        from SWSCHTYPT ty, szroomcmt ro
						                                        where ty.SCHD_TYP_CD    = w.SCHD_TYP_CD  
						                                      and ty.SCHD_DTLS_TYP_CD   = w.SCHD_DTLS_TYP_CD
						                                      and ty.EXCF_CD            = w.EXCF_CD
						                                      and ty.SCHD_DTLS_TYP_CD_USE_YN ='Y'
						                                      and ty.EXCF_CD            = ro.EXCF_CD
						                                      and ty.EXRM_CD            = ro.EXRM_CD), b.OTPT_EXRM_CD)) as  EXRM_CD      /*  2. 검사실코드       */
		     ,  to_char(m.ORDR_YMD, 'yyyymmdd') as ORDR_YMD    /*처방일자*/
		     ,  to_char(m.APNT_DT, 'yyyymmddhh24mi') as APNT_DT   /*예약일시*/
		     ,  to_char(m.EXRM_RPTN_DT, 'yyyymmddhh24mi') as RPTN_DT    /*접수일시*/
			 ,  to_char(m.ENFR_DT, 'yyyymmddhh24mi') as ENFR_DT    /*실시일시*/	 	 
		     ,  m.EXOR_PRSS_CD  as EXMN_PRSS_CD  /*진행상태*/
		     ,  m.ORDR_CD                       /*검사코드*/
		     ,  decode(nvl(m.dc_dvsn_Cd,'N'),'N','','[DC]') ||nvl(b.CLNC_PTHL_ORDR_SHRT_NM, b.ORDR_NM)  as ORDR_NM /*검사명*/
		     , ( select ABRV_DPRT_CD
		                      from HZDEPTMMT
		                     where DPRT_CD = m.MCDP_CD
		                     group by ABRV_DPRT_CD ) as MCDP_NM  /*진료과*/
		     ,  dr1.USER_NM as USER_NM_1    /* 36. 처방의사ID   */ 
		     ,  dr2.USER_NM as USER_NM_2   /* 53. 지정의사ID  */
		     ,  nvl(m.RCST_CD, 'N') as RCST_CD /*수납*/
		     ,  m.CODV_CD   as CODV_CD           /*환자구분*/
		     ,  m.ORDR_SNO  as ORDR_SNO           /*  처방순번             */
		     ,  m.MDRP_NO as MDRP_NO              /* 진료접수번호 */
		     ,  decode(w.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L'), nvl(w.ANDV_CD, 'L'))   as APNT_FRMT_CD               /*  일정/비일정 예약구분 */
		     ,  decode(w.ANDV_CD, 'C', '[통합]'
		                                                 , 'W', '병동'
		                                                 , 'Y', '일반'
		                                                 , 'S',  decode( w.IMPL_HSDV_CD, ''
		                                                                               , '비일정'
		                                                                               , '비일정/'|| w.IMPL_HSDV_CD)
		                                                 , ''
		                                        )  as AFI_ANDV_NM                 /*  예약구분             */
		     ,  (select  USER_NM from CCUSRDPHT where   USER_ID = w.AMPR_ID ) as AFI_AMPR_NM            /*  예약자               */
		     , '' as RCPS_NM                     /*  접수자               */
		     , w.CNSG_HSPT_CD as CNSG_HSPT_CD                                     /* 68. 수탁병원코드 */
		     ,  ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.WARD_CD group by ABRV_DPRT_CD ) as WARD_CD                       /*  30.병동                 */
		     , decode(m.CODV_CD,'I',decode(m.ODKI_CD,'D','퇴원','입원')
		                ,'O','외래'
		                ,'E','응급'
		                ,'G','일검'
		                ,'U','종검') as codv_nm 
		     , m.MCDP_CD
		     , m.CHDR_ID
			 , case when (l.CODV_CD = 'O') and (m.MCDP_CD != m.OROC_DPRT_CD) 
		            then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD)
		            else case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') 
		                      then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) 
						      when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
						      else '' 
		                 end
		       end  as CARE_WARD_NM /* 89. 현재병동 */
		   , to_char(l.DSCH_DT,'yyyymmddhh24mi')  as DSCH_DT
		   , m.ODKI_CD
		   , m.PTAD_CODV_CD
		   , m.PTAD_MDRP_NO
		   , decode(m.RCST_CD, 'Y', '수납','W','가수납', 'R','환불','')  as RCST_NM 
		   , fn_mr_errm_unsb_infm(m.mdrp_no) as ERPT_DVSN_NM /*중증외상환자 표시*/
		   , decode(m.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		   , nvl(m.DC_DVSN_CD,'N') as DC_DVSN_CD /*DC구분*/
		   , to_char(m.DC_ORDR_DT,'yyyymmddhh24mi')  as DC_ORDR_DT  /*DC일자*/
		   , w.PRVL_RPTN_YN						PRVL_RPTN_YN	
		   , m.PRTB_YN as PRTB_YN  /* 포터블여부  */
		   , (case when #{excfCd} ='SR' then (select  nvl(to_char(EXRS_NCVL_VL),'N') as EGFRB_EXRS_VL
		                                          from  SZRESULMT 
		                                         where  PTNO         = m.PTNO 
		                                           and  EXMN_CD in ( 
		                                                            select  EXMN_DTLS_CTRL_CD 
		                                                            from SZCTRLMMT 
		                                                            where EXMN_CTRL_CD = 'SRB_101' 
		                                                            and EXMN_DTLS_CTRL_NM = 'C' ) 
		                                           and  EXMN_PRSS_CD = 'G' 
		                                           and  RPRT_DT      = ( 
		                                                               select  /* INDEX(SZRESULMT, SZRESULMT_I05) */ --- 기존 힌트 삭제
		                                                                       /*+ NL_SJ */ -- 신규 힌트 추가
		                                                                       max(RPRT_DT) 
		                                                                 from  SZRESULMT 
		                                                                where  PTNO         = m.PTNO 
		                                                                  and  EXMN_CD     in  ( 
		                                                                                        select /*+ NL_SJ */ 
		                                                                                             EXMN_DTLS_CTRL_CD 
		                                                                                        from SZCTRLMMT 
		                                                                                        where EXMN_CTRL_CD = 'SRB_101' 
		                                                                                        and EXMN_DTLS_CTRL_NM = 'C' ) 
		                                                                  and  EXMN_PRSS_CD = 'G' 
		                                                                  and  RPRT_DT      >= ADD_MONTHS(trunc(sysdate), -1) 
		                                                               )
												   and rownum = 1) else '' 
		                                                               end ) as EGFRB_EXRS_VL
		   , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		  from MDEXMORDT m
		    ,  SWWORKMMT w
		    ,  SWORDRCMT b
		    ,  CCUSRDPHT dr1
		    ,  CCUSRDPHT dr2
		    ,  SZROOMCMT d
		    ,  APRCRPTNT l
		    ,  APRCADBLT ad
		where   m.EXCF_CD = #{excfCd}
		  and ((#{dcDvsnCd} is null and  nvl(m.DC_DVSN_CD, 'N') = 'N' ) or (#{dcDvsnCd} ='Y' ))
		  and (    instr(#{ptdvCtn} , m.CODV_CD) > 0 )
		  and (#{exrmCd}  is null 
						                    or (#{exrmCd} is not null and nvl(w.EXRM_CD, nvl((select ty.EXRM_CD 
						                                                                          from SWSCHTYPT ty, szroomcmt ro
						                                                                        where ty.SCHD_TYP_CD = w.SCHD_TYP_CD  
						                                                                        and ty.SCHD_DTLS_TYP_CD = w.SCHD_DTLS_TYP_CD
						                                                                        and ty.EXCF_CD =#{excfCd}
						                                                                        and ty.SCHD_DTLS_TYP_CD_USE_YN ='Y'
						                                                                        and ty.EXCF_CD = ro.EXCF_CD
						                                                                        and ty.EXRM_CD = ro.EXRM_CD), b.OTPT_EXRM_CD)) = #{exrmCd}))  
		  and w.APNT_DT   between to_date( #{strtYmd} , 'YYYYMMDD') 
		                                   and to_date( #{fnshYmd} , 'YYYYMMDD') + 0.99999
		  and ( #{prvlRptnYn} is null or w.PRVL_RPTN_YN = #{prvlRptnYn} )
		  and m.EXOR_PRSS_CD = 'A'
		  and b. DTLS_EXCF_CD =  nvl(#{dtlsExcfCd},  b.DTLS_EXCF_CD)
		  and m.PTNO = w.PTNO
		  and m.ORDR_YMD = w.ORDR_YMD
		  and m.ORDR_SNO = w.ORDR_SNO
		  and m.ORDR_CD = b.ORDR_CD
		  and m.ODDR_ID = dr1.USER_ID(+) 
		  and m.CHDR_ID = dr2.USER_ID(+)
		  and w.EXRM_CD = d.EXRM_CD(+)                /*  검사실코드           */
		  and w.EXCF_CD  = d.EXCF_CD(+)                       /*  검사분류             */
		  and m.PTAD_MDRP_NO = l.MDRP_NO
		  and m.PTAD_MDRP_NO = ad.MDRP_NO(+)	  
		  and  nvl(m.ORFR_CD, 'N') not in ('D', 'P') /* 과내검사 및 임시처방 제외)  */
		order by  5,1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll3-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="enfrDt" column="ENFR_DT"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="userNm1" column="USER_NM_1"/>
		<result property="userNm2" column="USER_NM_2"/>
		<result property="rcstCd" column="RCST_CD"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="afiAmprNm" column="AFI_AMPR_NM"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="cnsgHsptCd" column="CNSG_HSPT_CD"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="codvNm" column="CODV_NM"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="careWardNm" column="CARE_WARD_NM"/>
		<result property="dschDt" column="DSCH_DT"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="ptadCodvCd" column="PTAD_CODV_CD"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="rcstNm" column="RCST_NM"/>
		<result property="erptDvsnNm" column="ERPT_DVSN_NM"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
		<result property="dcOrdrDt" column="DC_ORDR_DT"/>
		<result property="prtbYn" column="PRTB_YN"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll3 ([접수일자기준] 예약 접수 대상자 전체 조회) 
        Description :                                           [접수일자기준] 예약 접수 대상자 전체 조회
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll3-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll3"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll3-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll3 */
		<![CDATA[ 
		 select /*+ LEADING (W) INDEX (W SWWORKMMT_I03 ) */
		       m.PTNO /*환자번호*/
		     ,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /*환자명*/
		     ,  decode(m.EXCF_CD, 'SY', 'AR', fn_sw_roomcode_s(m.PTNO, m.ORDR_YMD, to_char(m.ORDR_SNO))) as EXRM_CD /*검사실*/
		     ,  to_char(m.ORDR_YMD, 'yyyymmdd') as ORDR_YMD    /*처방일자*/
		     ,  to_char(w.APNT_DT, 'yyyymmddhh24mi') as APNT_DT   /*예약일시*/
		     ,  to_char(w.RPTN_DT, 'yyyymmddhh24mi') as RPTN_DT    /*접수일시*/
			 ,  to_char(w.ENFR_DT, 'yyyymmddhh24mi') as ENFR_DT    /*실시일시*/
		     ,  m.EXOR_PRSS_CD  as EXMN_PRSS_CD  /*진행상태*/
		     ,  m.ORDR_CD                       /*검사코드*/
		     ,  decode(nvl(m.dc_dvsn_Cd,'N'),'N','','[DC]') ||nvl(b.CLNC_PTHL_ORDR_SHRT_NM, b.ORDR_NM)  as ORDR_NM /*검사명*/
		     , ( select ABRV_DPRT_CD
		                      from HZDEPTMMT
		                     where DPRT_CD = m.MCDP_CD
		                     group by ABRV_DPRT_CD ) as MCDP_NM  /*진료과*/
		     ,  dr1.USER_NM as USER_NM_1    /* 36. 처방의사ID   */ 
		     ,  dr2.USER_NM as USER_NM_2   /* 53. 지정의사ID  */
		     ,  nvl(m.RCST_CD, 'N') as RCST_CD  /*수납*/
		     ,  m.CODV_CD   as CODV_CD           /*환자구분*/
		     ,  m.ORDR_SNO  as ORDR_SNO           /*  처방순번             */
		     ,  m.MDRP_NO as MDRP_NO              /* 진료접수번호 */
		     , decode(w.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L'), nvl(w.ANDV_CD, 'L'))  as APNT_FRMT_CD               /*  일정/비일정 예약구분 */
		     ,  decode(w.ANDV_CD, 'C', '[통합]'
		                                             , 'W', '병동'
		                                             , 'Y', '일반'
		                                             , 'S',  decode( w.IMPL_HSDV_CD, ''
		                                                                           , '비일정'
		                                                                           , '비일정/'|| w.IMPL_HSDV_CD)
		                                             , ''
		                                    )  as AFI_ANDV_NM                 /*  예약구분             */
		     ,  (select  USER_NM from CCUSRDPHT where   USER_ID = w.AMPR_ID ) as AFI_AMPR_NM            /*  예약자               */
		     , ( select  USER_NM from CCUSRDPHT where   USER_ID = w.RCPS_ID ) as RCPS_NM                /*  접수자               */
		     , w.CNSG_HSPT_CD as CNSG_HSPT_CD                                     /* 68. 수탁병원코드 */
		,  ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.WARD_CD group by ABRV_DPRT_CD ) as WARD_CD                       /*  30.병동                 */
		     , decode(m.CODV_CD,'I',decode(m.ODKI_CD,'D','퇴원','입원')
		                ,'O','외래'
		                ,'E','응급'
		                ,'G','일검'
		                ,'U','종검') as codv_nm 
		     , m.MCDP_CD
		     , m.CHDR_ID
			 , case when (l.CODV_CD = 'O') and (m.MCDP_CD != m.OROC_DPRT_CD) 
		            then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD)
		            else case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') 
		                      then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) 
						      when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
						      else '' 
		                 end
		       end  as CARE_WARD_NM /* 89. 현재병동 */
		   , to_char(l.DSCH_DT,'yyyymmddhh24mi')  as DSCH_DT
		   , m.ODKI_CD
		   , m.PTAD_CODV_CD
		   , m.PTAD_MDRP_NO
		   , decode(m.RCST_CD, 'Y', '수납','W','가수납', 'R','환불','')  as RCST_NM 
		   , fn_mr_errm_unsb_infm(m.mdrp_no) as ERPT_DVSN_NM /*중증외상환자 표시*/
		   , decode(m.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		   , nvl(m.DC_DVSN_CD,'N') as DC_DVSN_CD /*DC구분*/
		   , to_char(m.DC_ORDR_DT,'yyyymmddhh24mi')  as DC_ORDR_DT  /*DC일자*/
		   , m.PRTB_YN as PRTB_YN  /* 포터블여부  */
		   , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		 from MDEXMORDT m
		    ,  SWWORKMMT w
		    ,  SWORDRCMT b
		    ,  CCUSRDPHT dr1
		    ,  CCUSRDPHT dr2
		    ,  SZROOMCMT d
		    ,  APRCRPTNT l
		    ,  APRCADBLT ad
		where   m.EXCF_CD = #{excfCd}
		  and ((#{dcDvsnCd} is null and  nvl(m.DC_DVSN_CD, 'N') = 'N' ) or (#{dcDvsnCd} ='Y' ))
		  and (     instr(#{ptdvCtn} , m.CODV_CD) > 0 )
		  and (#{exrmCd}  is null 
		            or (#{exrmCd} is not null and  w.EXRM_CD = #{exrmCd}) ) 
		  and w.RPTN_DT   between to_date( #{strtYmd} , 'YYYYMMDD') 
		                                   and to_date( #{fnshYmd} , 'YYYYMMDD') + 0.99999
		  and m.EXOR_PRSS_CD = 'C'
		  and b. DTLS_EXCF_CD =  nvl(#{dtlsExcfCd},  b.DTLS_EXCF_CD)
		  and m.PTNO = w.PTNO
		  and m.ORDR_YMD = w.ORDR_YMD
		  and m.ORDR_SNO = w.ORDR_SNO
		  and m.ORDR_CD = b.ORDR_CD
		  and m.ODDR_ID = dr1.USER_ID(+) 
		  and m.CHDR_ID = dr2.USER_ID(+)
		  and w.EXRM_CD = d.EXRM_CD(+)                /*  검사실코드           */
		  and w.EXCF_CD  = d.EXCF_CD(+)                       /*  검사분류             */
		  and m.PTAD_MDRP_NO = l.MDRP_NO
		  and m.PTAD_MDRP_NO = ad.MDRP_NO(+)		  
		  and  nvl(m.ORFR_CD, 'N') not in ('D', 'P') /* 과내검사 및 임시처방 제외)  */
		order by 6,1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll4-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="enfrDt" column="ENFR_DT"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="userNm1" column="USER_NM_1"/>
		<result property="userNm2" column="USER_NM_2"/>
		<result property="rcstCd" column="RCST_CD"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="afiAmprNm" column="AFI_AMPR_NM"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="cnsgHsptCd" column="CNSG_HSPT_CD"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="codvNm" column="CODV_NM"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="careWardNm" column="CARE_WARD_NM"/>
		<result property="dschDt" column="DSCH_DT"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="ptadCodvCd" column="PTAD_CODV_CD"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="rcstNm" column="RCST_NM"/>
		<result property="erptDvsnNm" column="ERPT_DVSN_NM"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
		<result property="dcOrdrDt" column="DC_ORDR_DT"/>
		<result property="prtbYn" column="PRTB_YN"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll4 ([실시일자기준] 예약 접수 대상자 전체 조회) 
        Description :                                           [실시일자기준] 예약 접수 대상자 전체 조회
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll4-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll4"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll4-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll4 */
		<![CDATA[   
		  /* 실시일자 */
		select  /*+ leading(w) index(w (ENFR_DT)) use_nl(m l b dr1 dr2 d)  */  
		       m.PTNO /*환자번호*/
		     ,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /*환자명*/
		     ,  decode(m.EXCF_CD, 'SY', 'AR', fn_sw_roomcode_s(m.PTNO, m.ORDR_YMD, to_char(m.ORDR_SNO))) as EXRM_CD /*검사실*/
		     ,  to_char(m.ORDR_YMD, 'yyyymmdd') as ORDR_YMD    /*처방일자*/
		     ,  to_char(w.APNT_DT, 'yyyymmddhh24mi') as APNT_DT   /*예약일시*/
		     ,  to_char(w.RPTN_DT, 'yyyymmddhh24mi') as RPTN_DT    /*접수일시*/
			 ,  to_char(w.ENFR_DT, 'yyyymmddhh24mi') as ENFR_DT    /*실시일시*/
		     ,  m.EXOR_PRSS_CD  as EXMN_PRSS_CD  /*진행상태*/
		     ,  m.ORDR_CD                       /*검사코드*/
		     ,  decode(nvl(m.dc_dvsn_Cd,'N'),'N','','[DC]') ||nvl(b.CLNC_PTHL_ORDR_SHRT_NM, b.ORDR_NM)  as ORDR_NM /*검사명*/
		     , ( select ABRV_DPRT_CD
		                      from HZDEPTMMT
		                     where DPRT_CD = m.MCDP_CD
		                     group by ABRV_DPRT_CD ) as MCDP_NM  /*진료과*/
		     ,  dr1.USER_NM as USER_NM_1    /* 36. 처방의사ID   */ 
		     ,  dr2.USER_NM as USER_NM_2   /* 53. 지정의사ID  */
		     ,  nvl(m.RCST_CD, 'N') as RCST_CD  /*수납*/
		     ,  m.CODV_CD   as CODV_CD           /*환자구분*/
		     ,  m.ORDR_SNO  as ORDR_SNO           /*  처방순번             */
		     ,  m.MDRP_NO as MDRP_NO              /* 진료접수번호 */
		     , decode(w.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L'), nvl(w.ANDV_CD, 'L'))  as APNT_FRMT_CD               /*  일정/비일정 예약구분 */
		     ,  decode(w.ANDV_CD, 'C', '[통합]'
		                                             , 'W', '병동'
		                                             , 'Y', '일반'
		                                             , 'S',  decode( w.IMPL_HSDV_CD, ''
		                                                                           , '비일정'
		                                                                           , '비일정/'|| w.IMPL_HSDV_CD)
		                                             , ''
		                                    )  as AFI_ANDV_NM                 /*  예약구분             */
		     ,  (select  USER_NM from CCUSRDPHT where   USER_ID = w.AMPR_ID ) as AFI_AMPR_NM            /*  예약자               */
		     , ( select  USER_NM from CCUSRDPHT where   USER_ID = w.RCPS_ID ) as RCPS_NM                /*  접수자               */
		     , w.CNSG_HSPT_CD as CNSG_HSPT_CD                                     /* 68. 수탁병원코드 */
		,  ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.WARD_CD group by ABRV_DPRT_CD ) as WARD_CD                       /*  30.병동                 */
		     , decode(m.CODV_CD,'I',decode(m.ODKI_CD,'D','퇴원','입원')
		                ,'O','외래'
		                ,'E','응급'
		                ,'G','일검'
		                ,'U','종검'
		      ) as codv_nm 
		     , m.MCDP_CD
		     , m.CHDR_ID
			 , case when (l.CODV_CD = 'O') and (m.MCDP_CD != m.OROC_DPRT_CD) 
		            then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD)
		            else case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') 
		                      then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD) 
						      when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
						      else '' 
		                 end
		       end  as CARE_WARD_NM /* 89. 현재병동 */
		        , to_char(l.DSCH_DT,'yyyymmddhh24mi')  as DSCH_DT
		   , m.ODKI_CD
		   , m.PTAD_CODV_CD
		   , m.PTAD_MDRP_NO
		   , decode(m.RCST_CD, 'Y', '수납','W','가수납', 'R','환불','')  as RCST_NM 
		   , fn_mr_errm_unsb_infm(m.mdrp_no) as ERPT_DVSN_NM /*중증외상환자 표시*/
		   , decode(m.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		   , nvl(m.DC_DVSN_CD,'N') as DC_DVSN_CD /*DC구분*/
		   , to_char(m.DC_ORDR_DT,'yyyymmddhh24mi')  as DC_ORDR_DT  /*DC일자*/
		   , m.PRTB_YN as PRTB_YN  /* 포터블여부  */
		   , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		 from MDEXMORDT m
		    ,  SWWORKMMT w
		    ,  SWORDRCMT b
		    ,  CCUSRDPHT dr1
		    ,  CCUSRDPHT dr2
		    ,  SZROOMCMT d
		    ,  APRCRPTNT l
		    ,  APRCADBLT ad
		where  m.EXCF_CD = #{excfCd}
		  and ((#{dcDvsnCd} is null and  nvl(m.DC_DVSN_CD, 'N') = 'N' ) or (#{dcDvsnCd} ='Y' ))
		  and (  instr(#{ptdvCtn} , m.CODV_CD) > 0 )
		  and (#{exrmCd}  is null 
		            or (#{exrmCd} is not null and  w.EXRM_CD = #{exrmCd}) ) 
		  and w.ENFR_DT between to_date( #{strtYmd} , 'YYYYMMDD') 
		                                   and to_date( #{fnshYmd} , 'YYYYMMDD') + 0.99999
		  and m.EXOR_PRSS_CD  in ( 'D','E','F','G')
		  and b. DTLS_EXCF_CD =  nvl(#{dtlsExcfCd},  b.DTLS_EXCF_CD)
		  and m.PTNO = w.PTNO
		  and m.ORDR_YMD = w.ORDR_YMD
		  and m.ORDR_SNO = w.ORDR_SNO
		  and m.ORDR_CD = b.ORDR_CD
		  and m.ODDR_ID = dr1.USER_ID(+) 
		  and m.CHDR_ID = dr2.USER_ID(+)
		  and w.EXRM_CD = d.EXRM_CD(+)                /*  검사실코드           */
		  and w.EXCF_CD  = d.EXCF_CD(+)                       /*  검사분류             */
		  and m.PTAD_MDRP_NO = l.MDRP_NO
		  and m.PTAD_MDRP_NO = ad.MDRP_NO(+)		  
		  and  nvl(m.ORFR_CD, 'N') not in ('D', 'P') /* 과내검사 및 임시처방 제외)  */
		order by 7 , 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnWD-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="apntYn" column="APNT_YN"/>
		<result property="exrmCd" column="EXRM_CD"/>
		<result property="exrmCd1" column="EXRM_CD_1"/>
		<result property="schdDtlsTypCd" column="SCHD_DTLS_TYP_CD"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="drNm" column="DR_NM"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="rptnDt" column="RPTN_DT"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="amprId" column="AMPR_ID"/>
		<result property="afiAndvNm" column="AFI_ANDV_NM"/>
		<result property="exmnCd" column="EXMN_CD"/>
		<result property="ptno" column="PTNO"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="exmnPrssCd" column="EXMN_PRSS_CD"/>
		<result property="exrsGrpCd" column="EXRS_GRP_CD"/>
		<result property="admsYmd" column="ADMS_YMD"/>
		<result property="excfCd" column="EXCF_CD"/>
		<result property="ptdvCd" column="PTDV_CD"/>
		<result property="centApntPsblYn" column="CENT_APNT_PSBL_YN"/>
		<result property="apntFrmtCd" column="APNT_FRMT_CD"/>
		<result property="pacsAccsNo" column="PACS_ACCS_NO"/>
		<result property="rernYn" column="RERN_YN"/>
		<result property="cnmdUseYn" column="CNMD_USE_YN"/>
		<result property="rcpsNm" column="RCPS_NM"/>
		<result property="tlno" column="TLNO"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="careWardCd" column="CARE_WARD_CD"/>
		<result property="wntdDrId" column="WNTD_DR_ID"/>
		<result property="apntRmrkCtn" column="APNT_RMRK_CTN"/>
		<result property="apntRmrkCtn" column="APNT_RMRK_CTN"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="clrsPrjcDrId" column="CLRS_PRJC_DR_ID"/>
		<result property="clrsPrjcDrNm" column="CLRS_PRJC_DR_NM"/>
		<result property="wntdDt" column="WNTD_DT"/>
		<result property="ipdvNm" column="IPDV_NM"/>
		<result property="otrsExmnLnkdCtn" column="OTRS_EXMN_LNKD_CTN"/>
		<result property="befrTxCtn" column="BEFR_TX_CTN"/>
		<result property="exmnSpsbCtn" column="EXMN_SPSB_CTN"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="ptadPtdvCd" column="PTAD_PTDV_CD"/>
		<result property="bdsdYn" column="BDSD_YN"/>
		<result property="emrTrasYn" column="EMR_TRAS_YN"/>
		<result property="ordrLcdvCd" column="ORDR_LCDV_CD"/>
		<result property="cntrCd" column="CNTR_CD"/>
		<result property="implLcdvCd" column="IMPL_LCDV_CD"/>
		<result property="unmdRceqUseYn" column="UNMD_RCEQ_USE_YN"/>
		<result property="userDvsnCd" column="USER_DVSN_CD"/>
		<result property="wntdDt1" column="WNTD_DT_1"/>
		<result property="riskFctrVl" column="RISK_FCTR_VL"/>
		<result property="intrPrrnDrNm" column="INTR_PRRN_DR_NM"/>
		<result property="paclYmd" column="PACL_YMD"/>
		<result property="intrPrrnDt" column="INTR_PRRN_DT"/>
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="smdvCd" column="SMDV_CD"/>
		<result property="smdpClsfCd" column="SMDP_CLSF_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="sctnCd" column="SCTN_CD"/>
		<result property="mtfrTkngYn" column="MTFR_TKNG_YN"/>
		<result property="dytmWardUseWntdYn" column="DYTM_WARD_USE_WNTD_YN"/>
		<result property="dtlsExcfCd" column="DTLS_EXCF_CD"/>
		<result property="asapYn" column="ASAP_YN"/>
		<result property="dgfrNm" column="DGFR_NM"/>
		<result property="exorUnslCtn" column="EXOR_UNSL_CTN"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="afiAmprNm" column="AFI_AMPR_NM"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="nnmtExmnYn" column="NNMT_EXMN_YN"/>
		<result property="nnmtExmnNtfcYmd" column="NNMT_EXMN_NTFC_YMD"/>
		<result property="fatrCd" column="FATR_CD"/>
		<result property="exmnWntdYmdDvsnCd" column="EXMN_WNTD_YMD_DVSN_CD"/>
		<result property="imlnClsfCd" column="IMLN_CLSF_CD"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="exmnAndvCd" column="EXMN_ANDV_CD"/>
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="chldCalmYn" column="CHLD_CALM_YN"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="exrmCd2" column="EXRM_CD_2"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="prvlRptnYn" column="PRVL_RPTN_YN"/>
		<result property="ptntExmnNm" column="PTNT_EXMN_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnWD () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnWD-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnWD"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnWD-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnWD */ 
		<![CDATA[
				   select  /*+ NO_EXPAND LEADING(G, A, B, C, L) USE_NL(A, B, C, D, E, F, G, I, J, SRN, K, L) INDEX(A (PTNO)) OPT_PARAM('_OPTIMIZER_COST_BASED_TRANSFORMATION','OFF') swd_workmmt_l44$S01_검사 예약접수 조회 SW */
			   b.APNT_NEED_EN as APNT_YN                                              /*  예약 가능여부  */
		             ,  decode(c.EXCF_CD, 'SY', 'AR', fn_sw_roomcode_s(c.PTNO, c.ORDR_YMD, to_char(c.ORDR_SNO))) as EXRM_CD /*  검사실 코드        */
		            ,  nvl(c.RCST_CD, 'N') as EXRM_CD_1            /*  수납여부           */
		            ,  decode(fn_sw_roomcode_s( c.PTNO, c.ORDR_YMD, to_char(c.ORDR_SNO))
		                            , 'BS2B', ''
		                            , 'BS2D', 'BS2D'  /*  외래심초음파 검사실 */
		                            , nvl(fn_sw_schsubtyp_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO), decode(c.EXCF_CD, 'SO', '', '****'))) as SCHD_DTLS_TYP_CD /*  예약타입                       */
		            ,  ( select USER_NM
		                   from CCUSRDPHT
		                  where USER_ID = c.CHDR_ID) as CHDR_NM                               /*  지정의사             */
		            ,  ( select USER_NM
		                   from CCUSRDPHT
		                  where USER_ID = c.ODDR_ID) as DR_NM                               /*  처방의사             */
		            ,  '' as APNT_DT                        /*  예약일시             */
		            ,  '' as RPTN_DT                        /*  접수일시             */
		            ,  to_char(c.ORDR_YMD, 'yyyymmdd') as ORDR_YMD                             /*  처방일자             */
		            ,  c.MCDP_CD as MCDP_CD                                                   /*  진료과               */
		            ,  decode(c.EXCF_CD, 'SO', decode(nvl(c.PRTB_YN, 'N'), 'Y', '[P]', null), null) ||
		               decode(c.DYTM_WARD_USE_WNTD_YN, 'Y', '(낮병상)', '')|| b.ORDR_NM
		                                                                         as ORDR_NM     /*  처방명               */
		            ,  '' as AMPR_ID                                                /*  예약자               */
		            ,  '' as AFI_ANDV_NM                                           /*  예약구분             */
		            ,  c.ORDR_CD  as EXMN_CD                                                /*  검사코드             */
		            ,  c.PTNO as PTNO                                                        /*  환자번호             */
		            ,  c.ORDR_SNO  as ORDR_SNO                                                 /*  처방순번             */
		            ,  c.EXOR_PRSS_CD  as EXMN_PRSS_CD                                             /*  진행STATUS(진료지원) */
		            ,  b.EXRS_GRP_CD  as EXRS_GRP_CD                                           /*  결과그룹 코드        */
		            ,  to_char(l.MDCR_DT, 'yyyymmdd') as ADMS_YMD                               /*  입원일자             */
		            ,  c.EXCF_CD  as EXCF_CD                                                         /*  검사분류             */
		            ,  c.CODV_CD   as PTDV_CD                                          /*  환자구분             */
		            ,  decode(b.WARD_APNT_PSBL_YN, 'Y', 'Y', '', 'Y', 'N')  as CENT_APNT_PSBL_YN        /*  중앙예약가능여부     */
		            ,  ''  as APNT_FRMT_CD               /*  일정/비일정 예약구분 */
		            ,  '' as PACS_ACCS_NO
		            ,  ''  as RERN_YN          /*  REPEAT 여부         */
		            ,  fn_sr_sidreaction_s(c.PTNO)    as CNMD_USE_YN                        /*  SIDE 여부           */
		            ,  '' as RCPS_NM                              /*  접수자               */
		            ,  fn_sw_roomtelno_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)  as TLNO     /*  검사실 전화번호      */
		            ,  ( select ABRV_DPRT_CD
		                   from HZDEPTMMT
		                  where DPRT_CD = c.WARD_CD
		                  group by ABRV_DPRT_CD )   as WARD_CD                       /*  병동                 */
					,  ( select ABRV_DPRT_CD
		                   from HZDEPTMMT
		                  where DPRT_CD = L.CARE_WARD_CD
		                  group by ABRV_DPRT_CD )   as CARE_WARD_CD                       /*  현병동                 */
		            ,  ( select USER_NM
		                   from CCUSRDPHT
		                  where USER_ID = c.EXMN_WNTD_DR_ID)  as WNTD_DR_ID                   /*  희망의               */
		            ,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
		                                                , ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||( select F_A.USER_NM
		                                                                                                                   from CCUSRDPHT F_A
		                                                                                                                  where F_A.USER_ID = e.LAST_UPDR_ID )||'>') 
		                                                                                                                   as APNT_RMRK_CTN  /*  진료예약정보(검사별특이사항) */
		            ,  decode(c.CODV_CD, 'G', ''
		                               , 'U', ''
		                                    , ( select KORN_DPRT_NM
		                                        from HZDEPTMMT
		                                        where DPRT_CD = b.PTPT_CD
		                                        and trunc(sysdate) between  APST_YMD and APFN_YMD )                                         
		                     )  as APNT_RMRK_CTN    /*  가야할곳   */
		            ,  c.CLRS_PRJC_CD  as CLRS_PRJC_CD                                                    /*  임상연구코드         */
		               ,  c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
		               ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
		            ,  to_char(c.WNTD_DT, 'YYYYMMDD') as WNTD_DT                                     /*  희망일시             */
		            ,  fn_sw_decide_instyp_s( c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as IPDV_NM      /*  2014-01-08 이종찬 - [C14010002657]  */
		            ,  b.OTRS_EXMN_LNKD_CTN as OTRS_EXMN_LNKD_CTN                                               /*  타검사연계           */
		            ,  b.BEFR_TX_CTN as BEFR_TX_CTN                                                      /*  전처치               */
		            ,  b.EXMN_SPSB_CTN as EXMN_SPSB_CTN                                                    /*  검사특이사항         */
		            ,  c.ODDR_ID as ODDR_ID
		            ,  c.ODKI_CD as ODKI_CD
		            ,  c.PTAD_CODV_CD as PTAD_PTDV_CD
		            ,  '' as BDSD_YN
		            ,  '' as EMR_TRAS_YN
		            ,  nvl(c.HSLC_DVSN_CD, 'M') as ORDR_LCDV_CD
		            ,  nvl(c.MCCN_CD, 'M') as CNTR_CD
		            ,  '' as IMPL_LCDV_CD
		            ,  b.RCEQ_USE_YN as UNMD_RCEQ_USE_YN
		            ,  c.INPT_USER_DVSN_CD as USER_DVSN_CD
		            ,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') as WNTD_DT_1                       /*  예약일시             */
		            ,  c.RISK_FCTR_VL as RISK_FCTR_VL                                                     /*  위험인자             */
		            ,  '' as INTR_PRRN_DR_NM       /*  판독예정의 */
		            ,  c.PTAD_CLBA_YMD as PACL_YMD
		            ,  ''  as INTR_PRRN_DT
		            ,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') as MDCR_YMD                       /*  진료일자             */
		             , ''  as SMDV_CD
		            ,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO) as SMDP_CLSF_CD
		            ,  c.CHDR_ID as CHDR_ID
		            ,  '' as SCTN_CD
		            ,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y') as MTFR_TKNG_YN
		            ,  c.DYTM_WARD_USE_WNTD_YN as DYTM_WARD_USE_WNTD_YN
		            ,  b.DTLS_EXCF_CD as DTLS_EXCF_CD
		            ,  '' as ASAP_YN
		            ,  nvl(fn_sw_get_stresult(c.PTNO), '') as DGFR_NM        /* BL312002 검사 수치 조회*/
		            ,  c.EXOR_UNSL_CTN as EXOR_UNSL_CTN                               /*  [C13010000775] 2013-02-15 MRI검사실 연규진 */
		            , ( select ABRV_DPRT_CD
		                  from HZDEPTMMT
		                 where DPRT_CD = c.MCDP_CD
		                 group by ABRV_DPRT_CD ) as MCDP_NM                                   /*  진료과               */
		            ,  '' as AFI_AMPR_NM                                                           /*  예약자               */
		            ,  c.MDRP_NO as MDRP_NO
		            ,  c.ORCL_CD as ORCL_CD
		            ,  c.NNMT_EXMN_YN as NNMT_EXMN_YN         /*  비대면 환자 여부     */
		            ,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /*  비대면검사통보일자   */
		            ,  (select case
		                         when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'
		                         when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
		                       end
		                 from  APRCRPTNT apr
		                    ,  MDFASTRPT mdf
		                where  apr.MDRP_NO = c.MDRP_NO
		                  and  apr.FATR_CD is not null
		                  and  mdf.PTNO = apr.PTNO
		                  and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
		                ) as FATR_CD
		            ,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
		                 , '1', 'Y'
		                 , null
		               ) as EXMN_WNTD_YMD_DVSN_CD    /*  당일검사 FLAG */
		            ,  '' as IMLN_CLSF_CD
		            ,  ( select ABRV_DPRT_CD
		                   from HZDEPTMMT
		                  where DPRT_CD = c.MCCN_CD
		                  group by ABRV_DPRT_CD ) as MCCN_NM                                   /*  진료과센터명                 */
		            ,  '' as EXMN_ANDV_CD
		            ,  '' as ABRV_DPRT_CD
		            ,  '' as CHLD_CALM_YN
		            ,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = c.PTNO) as PTNT_NM
		            ,  decode(fn_sw_roomcode_s( c.PTNO, c.ORDR_YMD, to_char(c.ORDR_SNO))
		                            , 'BS2B', ''
		                            , 'BS2D', 'BS2D'  /*  외래심초음파 검사실 */
		                            , nvl(fn_sw_schsubtyp_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO), decode(c.EXCF_CD, 'SO', '', '****'))) as EXRM_CD_2 /*  계산예약타입                       */
		   , decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
			, null as PRVL_RPTN_YN	
		    ,b.PTNT_EXMN_NM  as PTNT_EXMN_NM
		 from
			   SWORDRCMT b
			,  MDEXMORDT c 
			,  SZCTRLMMT e     /*  제어코드 */
			,  CCUSRDPHT f
			,  APPTPTNTT g
			,  AIMFMDFET i
			,  SZCTRLMMT j
			,  SRNOCFMCT srn 
			,  APRCRPTNT l
		where  c.PTNO = #{ptno}                           /*  환자번호             */
		  and  c.EXOR_PRSS_CD||'' is null                          /*  진행STATUS(진료지원) */
		  and  b.APNT_NEED_EN = 'Y' 
		  and  b.WARD_APNT_PSBL_YN ='Y' /*병동검사예약가능여부*/
		  and  c.MCDP_CD = nvl(#{mcdpCd}, c.MCDP_CD)      /*  진료과               */
		  and  c.ORDR_YMD >= to_date(nvl(#{strtYmd}, '19900101'), 'YYYYMMDD')
		  and  c.ORDR_YMD <= to_date(nvl(#{fnshYmd}, '29991231'), 'YYYYMMDD')
		  and  c.ORDR_SNO = nvl(#{afiOrdrSnoStr}, c.ORDR_SNO)     /*  처방순번             */
		  and  c.ORDR_CD = b.ORDR_CD
		  and  (
				 ( #{dtlsExcfCd} is null)
				 or
				 ( b.DTLS_EXCF_CD = #{dtlsExcfCd} )
			   ) 
		  and  nvl(c.DC_DVSN_CD, 'N') = 'N'
		  and  nvl(c.RCST_CD, '@') <> 'R'                                    /*  환불처방 제외 */
		   and c.CODV_CD = 'I'                                            /*  입원만 */
		  and  not exists (select 'Y'
							 from SZCTRLMMT
							where EXMN_CTRL_CD = 'SR035'
							  and EXMN_DTLS_CTRL_CD = c.ORDR_CD)
		  and  e.EXMN_CTRL_CD     (+) = 'SWA_180'             /*  검사항목별 특이사항 */
		  and  e.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		  and  e.APLY_PART_CD     (+) = c.EXCF_CD
		  and  e.LAST_UPDR_ID = f.USER_ID(+)
		  and  g.PTNO = c.PTNO
		  and  c.HSLC_DVSN_CD = NVL('',c.HSLC_DVSN_CD)
		  and  i.MDFE_CD(+) = c.ORDR_CD
		  and  i.APST_YMD(+) <= c.ORDR_YMD
		  and  i.APFN_YMD(+) >= c.ORDR_YMD
		  and  j.EXMN_CTRL_CD(+) = 'SR210'
		  and  j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		  and  srn.MCDP_CD(+) = c.MCDP_CD                      /*  진료과               */
		  and  srn.ORDR_CD(+) = c.ORDR_CD                      /*  처방코드             */
		  and  c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)
		  and  c.MDRP_NO = l.MDRP_NO
		  and  (
				  c.ORDR_YMD < to_date('20160702', 'yyyymmdd')                          /*  처방 유효기간 다윈 오픈전 처방은 예외처리(통합예약) */
				  or
				  nvl('', 'Y') = 'N'
				  or
				  trunc(sysdate) <= nvl(c.ORDR_VALD_PERD_EXPT_YMD, c.ORDR_YMD + 365*2)
			   )
		union
				   select  /*+ NO_EXPAND LEADING(G, A, B, C, L) USE_NL(A, B, C, D, E, F, G, I, J, SRN, K, L) INDEX(A (PTNO)) #2 */
			   b.APNT_NEED_EN
			,  a.EXRM_CD                                                       /*  검사실코드           */
			,  nvl(c.RCST_CD, 'N')                /*  수납여부             */
			,  a.SCHD_DTLS_TYP_CD                                              /*  스케쥴 SUB TYPE    */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = decode(a.EXCF_CD, 'SO', a.schd_dtls_typ_cd, c.CHDR_ID) )                                   /*  지정의사             */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = c.ODDR_ID)                                   /*  처방의사             */
			,  to_char(a.APNT_DT, 'yyyymmddhh24mi')                            /*  예약일시             */
			,  to_char(a.RPTN_DT, 'yyyymmddhh24mi')                            /*  접수일시             */
			,  to_char(a.ORDR_YMD, 'yyyymmdd')                                 /*  처방일자             */
			,  c.MCDP_CD
		    ,  decode(c.EXCF_CD, 'SO', decode(nvl(c.PRTB_YN, 'N'), 'Y', '[P]', null), null) ||
		               decode(c.DYTM_WARD_USE_WNTD_YN, 'Y', '(낮병상)', '')|| b.ORDR_NM   as ORDR_NM     /*  처방명               */
			,  a.AMPR_ID                                                       /*  예약자               */
			,  decode(a.ANDV_CD , 'C', '[통합]', 'W', '병동', 'Y', '일반', 'S', '비일정', '')
																			   /*  예약구분             */
			,  a.EXMN_CD                                                       /*  검사코드             */
			,  a.PTNO                                                          /*  환자번호             */
			,  a.ORDR_SNO                                                      /*  처방순번             */
			,  a.EXMN_STTS_CD                                                  /*  진행STATUS(진료지원) */
			,  b.EXRS_GRP_CD                                                   /*  결과그룹 코드        */
			,  to_char(l.MDCR_DT, 'yyyymmdd')                                  /*  입원일자             */
			,  a.EXCF_CD                                                       /*  검사분류             */
			,  c.CODV_CD                                                       /*  환자구분             */
			,  decode(b.WARD_APNT_PSBL_YN, 'Y', 'Y', '', 'Y', 'N')             /*  중앙예약가능여부     */
			,  decode(a.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L')
										, nvl(a.ANDV_CD, 'L'))                 /*  일정/비일정 예약구분 */
			,  a.PACS_ACCS_NO
			,  decode(to_char(a.RERN_PRRN_DT, 'dd'), '', 'N', 'Y')             /*  REPEAT 여부          */
			,  fn_sr_sidreaction_s(a.PTNO)                              /*  SIDE 여부            */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = a.RCPS_ID)                                   /*  접수자               */
			,  decode(a.EXCF_CD, 'SV', decode(nvl(a.IMPL_HSDV_CD, c.HSLC_DVSN_CD), 'C', '2633'
																					  , '2620')
									 , d.TLNO)                                 /*  검사실 전화번호      */
			,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				  where DPRT_CD = c.WARD_CD
				  group by ABRV_DPRT_CD ) WARD_CD                              /*  병동                 */
			  ,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				  where DPRT_CD = L.CARE_WARD_CD
				  group by ABRV_DPRT_CD )   as CARE_WARD_CD                       /*  현병동                 */	  
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = c.EXMN_WNTD_DR_ID)                           /*  희망의               */
			,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
												 , ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||( select F_A.USER_NM
																													from CCUSRDPHT F_A
																												   where F_A.USER_ID = e.LAST_UPDR_ID )||'>') /*  진료예약정보(검사별특이사항) */
			,  decode(a.EXCF_CD, 'SV', decode(nvl(a.IMPL_HSDV_CD, a.HSLC_DVSN_CD), 'C', ( select KORN_DPRT_NM
																							from HZDEPTMMT
																						   where DPRT_CD = b.CACN_PTPT_CD
																							 and trunc(sysdate) between  APST_YMD and APFN_YMD )
																					  , ( select KORN_DPRT_NM
																							from HZDEPTMMT
																						   where DPRT_CD = b.PTPT_CD
																							 and trunc(sysdate) between  APST_YMD and APFN_YMD )
											 )
									 , nvl(d.EXRM_LCTN_NM, decode(nvl(a.IMPL_HSDV_CD, a.HSLC_DVSN_CD), 'C', ( select KORN_DPRT_NM
																												from HZDEPTMMT
																											   where DPRT_CD = b.CACN_PTPT_CD
																												 and trunc(sysdate) between  APST_YMD and APFN_YMD )
																										  , ( select KORN_DPRT_NM
																												from HZDEPTMMT
																											   where DPRT_CD = b.PTPT_CD
																												 and trunc(sysdate) between  APST_YMD and APFN_YMD )
																)
										  )
					  ) as TOGO         /*  가야할곳   */
			,  c.CLRS_PRJC_CD                                                    /*  임상연구코드         */
		    ,  c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
		    ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
			,  to_char(c.WNTD_DT, 'YYYYMMDD')                                    /*  희망일시             */
			,  fn_sw_decide_instyp_s( a.PTNO, a.ORDR_YMD, a.ORDR_SNO) IPDV_NM   /*  2014-01-08 이종찬 - [C14010002657]  */
			,  b.OTRS_EXMN_LNKD_CTN                                              /*  타검사연계           */
			,  b.BEFR_TX_CTN                                                     /*  전처치               */
			,  b.EXMN_SPSB_CTN                                                   /*  검사특이사항         */
			,  c.ODDR_ID
			,  c.ODKI_CD
			,  c.PTAD_CODV_CD
			,  a.BDSD_YN
			,  ''
			,  nvl(c.HSLC_DVSN_CD, 'M')
			,  nvl(c.MCCN_CD, 'M')
			,  a.IMPL_HSDV_CD
			,  b.RCEQ_USE_YN
			,  c.INPT_USER_DVSN_CD
			,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') wntd_dt                     /*  예약일시             */
			,  c.RISK_FCTR_VL                                                   /*  위험인자             */
			,  a.INTR_PRRN_DR_NM ||'  '|| ( select USER_NM
											  from CCUSRDPHT
											 where USER_ID = substr(a.INTR_PRRN_DR_NM, 1, 6))      /*  판독예정의 */
			,  c.PTAD_CLBA_YMD
			,  to_char(a.INTR_PRRN_DT, 'yyyymmddhh24mi') READTIME
			,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') MEDDATE                     /*  진료일자             */
			, ''  HOPEDRTYP
			,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)
			,  c.CHDR_ID
			,  decode(a.FILM_NO, null, decode(b.CHLD_DVSN_CD, 'Y', decode(sign((sysdate-g.BTDT)/365-18), -1, 'PE'
											, decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
											, decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
											, a.FILM_NO)
			,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y')
			,  c.DYTM_WARD_USE_WNTD_YN
			,  b.DTLS_EXCF_CD
			,  nvl(a.ASAP_YN, '')
			,  nvl(fn_sw_get_stresult(a.PTNO), '')        /* BL312002 검사 수치 조회*/
			,  c.EXOR_UNSL_CTN                         /*  [C13010000775] 2013-02-15 MRI검사실 연규진 */
			, ( select  ABRV_DPRT_CD
				  from HZDEPTMMT
				 where DPRT_CD = c.MCDP_CD
				 group by ABRV_DPRT_CD ) MCDP_CM                                      /*  진료과               */
			, k.USER_NM
			, c.MDRP_NO
			, c.ORCL_CD
			,  c.NNMT_EXMN_YN                            as NNMT_EXMN_YN         /*  비대면 환자 여부     */
			,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /*  비대면검사통보일자   */
			,  (select case
						 when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'
						 when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
					   end
				 from  APRCRPTNT apr
					 ,  MDFASTRPT mdf
				where  apr.MDRP_NO = a.MDRP_NO
				  and  apr.FATR_CD is not null
				  and  mdf.PTNO = apr.PTNO
				  and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
				)                                           as FATR_CD
			,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
				 , '1', 'Y'
				 , null
			   )                                           as EXMN_WNTD_YMD_DVSN_CD    /*  당일검사 FLAG */
			,  a.IMLN_CLSF_CD
			,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				   where DPRT_CD = c.MCCN_CD
				   group
					  by ABRV_DPRT_CD ) MCCN_NM                                   /*  진료과센터명                 */
			,  a.EXMN_ANDV_CD
			,  a.ABRV_DPRT_CD
			,  a.CHLD_CALM_YN
			,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = a.PTNO)
			,  decode(fn_sw_roomcode_s( a.PTNO, a.ORDR_YMD, to_char(a.ORDR_SNO))
							, 'BS2B', ''
							, 'BS2D', 'BS2D'  /*  외래심초음파 검사실 */
							, nvl(fn_sw_schsubtyp_s(a.PTNO, a.ORDR_YMD, a.ORDR_SNO), decode(a.EXCF_CD, 'SO', '', '****'))) /*  계산예약타입                       */
		   , decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/
		   , a.PRVL_RPTN_YN						PRVL_RPTN_YN	
		    ,b.PTNT_EXMN_NM  as PTNT_EXMN_NM
		 from
			   SWWORKMMT a                                                      /*  검사 WORK 관리 (계속) */
			,  MDEXMORDT c
			,  SWORDRCMT b
			,  SZROOMCMT d
			,  SZCTRLMMT e
			,  CCUSRDPHT f
			,  APPTPTNTT g
			,  AIMFMDFET i
			,  SZCTRLMMT j
			,  SRNOCFMCT srn
			,  CCUSRDPHT k
			,  APRCRPTNT l
		where  c.PTNO    = #{ptno}                                           /*  환자번호             */
		  and  a.EXMN_STTS_CD = 'A'                                          /*  진행STATUS(진료지원) */
		  and  b.APNT_NEED_EN = 'Y'
		  and  b.WARD_APNT_PSBL_YN ='Y'  /*병동검사예약가능여부*/
		  and  c.MCDP_CD = nvl(#{mcdpCd}, c.MCDP_CD)      /*  진료과               */
		  and  c.ORDR_YMD >= to_date(nvl(#{strtYmd} , '19900101'), 'YYYYMMDD')
		  and  c.ORDR_YMD <= to_date(nvl(#{fnshYmd} , '29991231'), 'YYYYMMDD')
		  and  c.ORDR_SNO = nvl(#{afiOrdrSnoStr}, a.ORDR_SNO)     /*  처방순번             */
		  and  c.ORDR_CD = b.ORDR_CD                                           /*  검사코드             */
		  and  (
				 ( #{dtlsExcfCd} is null)
				 or
				 ( b.DTLS_EXCF_CD = #{dtlsExcfCd} )
			   )
		  and  a.PTNO(+)    = c.PTNO                                              /*  환자번호             */
		  and  a.ORDR_YMD(+)  = c.ORDR_YMD                                        /*  처방일자             */
		  and  a.ORDR_SNO(+) = c.ORDR_SNO                                         /*  처방순번             */
		  and  nvl(c.DC_DVSN_CD, 'N') = 'N'
		  and  nvl(c.RCST_CD, '@') <> 'R'                                    /*  환불처방 제외 */
		   and c.CODV_CD = 'I'                                            /*  입원만 */
		  and  (  #{afiOrdrSnoStr} is not null
				  or
				  not exists (select 'Y'
							 from SZCTRLMMT
							where EXMN_CTRL_CD = 'SR035'
							  and EXMN_DTLS_CTRL_CD = c.ORDR_CD)
			   )
		  and  d.EXRM_CD(+) = a.EXRM_CD                                      /*  검사실코드           */
		  and  d.EXCF_CD(+) = a.EXCF_CD     /*  검사분류             */
		  and  e.EXMN_CTRL_CD     (+) = 'SWA_180'                   /*  검사항목별 특이사항 */
		  and  e.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		  and  e.APLY_PART_CD     (+) = a.EXCF_CD
		  and  e.LAST_UPDR_ID = f.USER_ID(+)
		  and  c.HSLC_DVSN_CD = NVL(#{hslcDvsnCd},c.HSLC_DVSN_CD)
		  and  g.PTNO = c.PTNO
		  and  i.MDFE_CD(+) = c.ORDR_CD
		  and  i.APST_YMD(+) <= c.ORDR_YMD
		  and  i.APFN_YMD(+) >= c.ORDR_YMD
		  and  j.EXMN_CTRL_CD(+) = 'SR210'
		  and  j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		  and  srn.MCDP_CD(+) = c.MCDP_CD                      /*  진료과               */
		  and  srn.ORDR_CD(+) = c.ORDR_CD                      /*  처방코드             */
		  and  c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)
		  and  a.AMPR_ID = k.USER_ID(+)
		  and  c.MDRP_NO = l.MDRP_NO
		  and  (
				  c.ORDR_YMD < to_date('20160702', 'yyyymmdd')                          /*  처방 유효기간 다윈 오픈전 처방은 예외처리(통합예약) */
				  or
				  nvl(#{valdHhDvsnCd}, 'Y') = 'N'
				  or
				  trunc(sysdate) <= nvl(c.ORDR_VALD_PERD_EXPT_YMD, c.ORDR_YMD + 365*2)
			   )
		union
				   select  /*+ NO_EXPAND LEADING(G, A, B, C, L) USE_NL(A, B, C, D, E, F, G, I, J, SRN, K, L) INDEX(A (PTNO)) #3 */
			   b.APNT_NEED_EN
			,  a.EXRM_CD                                                       /*  검사실코드           */
			,  nvl(c.RCST_CD, 'N')                /*  수납여부             */
			,  a.SCHD_DTLS_TYP_CD                                              /*  스케쥴 SUB TYPE    */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = decode(a.EXCF_CD, 'SO', a.schd_dtls_typ_cd, c.CHDR_ID))                                   /*  지정의사             */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = c.ODDR_ID)                                   /*  처방의사             */
			,  to_char(a.APNT_DT, 'yyyymmddhh24mi')                            /*  예약일시             */
			,  to_char(a.RPTN_DT, 'yyyymmddhh24mi')                            /*  접수일시             */
			,  to_char(a.ORDR_YMD, 'yyyymmdd')                                 /*  처방일자             */
			,  c.MCDP_CD
		    ,  decode(c.EXCF_CD, 'SO', decode(nvl(c.PRTB_YN, 'N'), 'Y', '[P]', null), null) ||
		               decode(c.DYTM_WARD_USE_WNTD_YN, 'Y', '(낮병상)', '')|| b.ORDR_NM   as ORDR_NM     /*  처방명               */
			,  a.AMPR_ID                                                       /*  예약자               */
			,  decode(a.ANDV_CD , 'C', '[통합]', 'W', '병동', 'Y', '일반', 'S', '비일정', '')
																			   /*  예약구분             */
			,  a.EXMN_CD                                                       /*  검사코드             */
			,  a.PTNO                                                          /*  환자번호             */
			,  a.ORDR_SNO                                                      /*  처방순번             */
			,  a.EXMN_STTS_CD                                                  /*  진행STATUS(진료지원) */
			,  b.EXRS_GRP_CD                                                   /*  결과그룹 코드        */
			,  to_char(l.MDCR_DT, 'yyyymmdd')                                  /*  입원일자             */
			,  a.EXCF_CD                                                       /*  검사분류             */
			,  c.CODV_CD                                                       /*  환자구분             */
			,  decode(b.WARD_APNT_PSBL_YN, 'Y', 'Y', '', 'Y', 'N')             /*  중앙예약가능여부     */
			,  decode(a.EXMN_STTS_CD, '', nvl(d.APNT_FRMT_CD, 'L')
										, nvl(a.ANDV_CD, 'L'))                 /*  일정/비일정 예약구분 */
			,  a.PACS_ACCS_NO
			,  decode(to_char(a.RERN_PRRN_DT, 'dd'), '', 'N', 'Y')             /*  REPEAT 여부          */
			,  fn_sr_sidreaction_s(a.PTNO)                              /*  SIDE 여부            */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = a.RCPS_ID)                                   /*  접수자               */
			,  decode(a.EXCF_CD, 'SV', decode(nvl(a.IMPL_HSDV_CD, c.HSLC_DVSN_CD), 'C', '2633'
																					  , '2620')
									 , d.TLNO)                                 /*  검사실 전화번호      */
			,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				  where DPRT_CD = c.WARD_CD
				  group by ABRV_DPRT_CD ) WARD_CD                              /*  병동                 */
			,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				  where DPRT_CD = L.CARE_WARD_CD
				  group by ABRV_DPRT_CD )   as CARE_WARD_CD                       /*  현병동                 */
			,  ( select USER_NM
				   from CCUSRDPHT
				  where USER_ID = c.EXMN_WNTD_DR_ID)                           /*  희망의               */
			,  e.EXMN_DTLS_CTRL_NM||decode(e.EXMN_DTLS_CTRL_NM, null, null
												 , ' <'||to_char(e.LAST_UPDT_DT, 'yyyy-mm-dd hh24:mi:ss')||' '||( select F_A.USER_NM
																													from CCUSRDPHT F_A
																												   where F_A.USER_ID = e.LAST_UPDR_ID )||'>') /*  진료예약정보(검사별특이사항) */
		    ,  decode(c.CODV_CD, 'G', ''
		                        , 'U', ''
		                            , ( select KORN_DPRT_NM
		                                from HZDEPTMMT
		                                where DPRT_CD = b.PTPT_CD
		                                and trunc(sysdate) between  APST_YMD and APFN_YMD )                                         
		                )  as APNT_RMRK_CTN    /*  가야할곳   */
			,  c.CLRS_PRJC_CD                                                    /*  임상연구코드         */
		    ,  c.CLRS_PRJC_DR_ID  as CLRS_PRJC_DR_ID     /* 34. 임상연구의사         */
		     ,  ( select  USER_NM from CCUSRDPHT where   USER_ID = c.CLRS_PRJC_DR_ID) as CLRS_PRJC_DR_NM     /* 34. 임상연구의사         */
			,  to_char(c.WNTD_DT, 'YYYYMMDD')                                    /*  희망일시             */
			,  fn_sw_decide_instyp_s( a.PTNO, a.ORDR_YMD, a.ORDR_SNO) IPDV_NM   /*  2014-01-08 이종찬 - [C14010002657]  */
			,  b.OTRS_EXMN_LNKD_CTN                                              /*  타검사연계           */
			,  b.BEFR_TX_CTN                                                     /*  전처치               */
			,  b.EXMN_SPSB_CTN                                                   /*  검사특이사항         */
			,  c.ODDR_ID
			,  c.ODKI_CD
			,  c.PTAD_CODV_CD
			,  a.BDSD_YN
			,  ''
			,  nvl(c.HSLC_DVSN_CD, 'M')
			,  nvl(c.MCCN_CD, 'M')
			,  a.IMPL_HSDV_CD
			,  b.RCEQ_USE_YN
			,  c.INPT_USER_DVSN_CD
			,  to_char(c.WNTD_DT, 'yyyymmddhh24mi') wntd_dt                     /*  예약일시             */
			,  c.RISK_FCTR_VL                                                   /*  위험인자             */
			,  a.INTR_PRRN_DR_NM ||'  '|| ( select USER_NM
											  from CCUSRDPHT
											 where USER_ID = substr(a.INTR_PRRN_DR_NM, 1, 6))      /*  판독예정의 */
			,  c.PTAD_CLBA_YMD
			,  to_char(a.INTR_PRRN_DT, 'yyyymmddhh24mi') READTIME
			,  to_char(l.MDCR_DT, 'yyyymmddhh24mi') MEDDATE                     /*  진료일자             */
			, ''  HOPEDRTYP
			,  fn_sw_spcsugacls_s(c.PTNO, c.ORDR_YMD, c.ORDR_SNO)
			,  c.CHDR_ID
			,  decode(a.FILM_NO, null, decode(b.CHLD_DVSN_CD, 'Y', decode(sign((sysdate-g.BTDT)/365-18), -1, 'PE'
											, decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
											, decode(b.MCDP_ASCT_YN, 'Y', nvl(srn.INTR_SITE_CD, b.INTR_SITE_CD), b.INTR_SITE_CD))
											, a.FILM_NO)
			,  decode(j.EXMN_DTLS_CTRL_CD, null, 'N', 'Y')
			,  c.DYTM_WARD_USE_WNTD_YN
			,  b.DTLS_EXCF_CD
			,  nvl(a.ASAP_YN, '')
			,  nvl(fn_sw_get_stresult(a.PTNO), '')        /* BL312002 검사 수치 조회*/
			,  c.EXOR_UNSL_CTN                         /*  [C13010000775] 2013-02-15 MRI검사실 연규진 */
			, ( select  ABRV_DPRT_CD
				  from HZDEPTMMT
				 where DPRT_CD = c.MCDP_CD
				 group by ABRV_DPRT_CD ) MCDP_CM                                      /*  진료과               */
			, k.USER_NM
			, c.MDRP_NO
			, c.ORCL_CD
			,  c.NNMT_EXMN_YN                            as NNMT_EXMN_YN         /*  비대면 환자 여부     */
			,  to_char(c.NNMT_EXMN_NTFC_YMD, 'YYYYMMDD') as NNMT_EXMN_NTFC_YMD   /*  비대면검사통보일자   */
			,  (select case
						 when nvl(mdf.EXCL_YMD, sysdate+1) <= trunc(sysdate) then 'D'
						 when mdf.EXCL_YMD is null or nvl(mdf.EXCL_YMD, to_date('19000101', 'YYYYMMDD')) > trunc(sysdate) then 'F/T'
					   end
				 from  APRCRPTNT apr
					 ,  MDFASTRPT mdf
				where  apr.MDRP_NO = a.MDRP_NO
				  and  apr.FATR_CD is not null
				  and  mdf.PTNO = apr.PTNO
				  and  mdf.FATR_PTNT_SNO = apr.FATR_PTNT_SNO
				)                                           as FATR_CD
			,  decode(nvl(c.EXMN_WNTD_YMD_DVSN_CD,'X')
				 , '1', 'Y'
				 , null
			   )                                           as EXMN_WNTD_YMD_DVSN_CD    /*  당일검사 FLAG */
			,  a.IMLN_CLSF_CD
			,  ( select ABRV_DPRT_CD
				   from HZDEPTMMT
				   where DPRT_CD = c.MCCN_CD
				   group
					  by ABRV_DPRT_CD ) MCCN_NM                                   /*  진료과센터명                 */
			,  a.EXMN_ANDV_CD
			,  a.ABRV_DPRT_CD
			,  a.CHLD_CALM_YN
			,  (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = a.PTNO)
			,  decode(fn_sw_roomcode_s( a.PTNO, a.ORDR_YMD, to_char(a.ORDR_SNO))
							, 'BS2B', ''
							, 'BS2D', 'BS2D'  /*  외래심초음파 검사실 */
							, nvl(fn_sw_schsubtyp_s(a.PTNO, a.ORDR_YMD, a.ORDR_SNO), decode(a.EXCF_CD, 'SO', '', '****'))) /*  계산예약타입                       */
		                    , decode(c.ODKI_DETL_CD,'B','Y','') as ODKI_DETL_CD /*입원전검사 유무*/ 
		   , a.PRVL_RPTN_YN						PRVL_RPTN_YN	
		    ,b.PTNT_EXMN_NM  as PTNT_EXMN_NM
		from
			   SWWORKMMT a                                                      /*  검사 WORK 관리 (계속) */
			,  MDEXMORDT c
			,  SWORDRCMT b
			,  SZROOMCMT d
			,  SZCTRLMMT e
			,  CCUSRDPHT f
			,  APPTPTNTT g
			,  AIMFMDFET i
			,  SZCTRLMMT j
			,  SRNOCFMCT srn
			,  CCUSRDPHT k
			,  APRCRPTNT l
		where  c.PTNO    = #{ptno}                                           /*  환자번호             */
		  and  a.EXMN_STTS_CD >= 'C'                                          /*  진행STATUS(진료지원) */
		  and  #{apntYn} = 'Y'
		  and  b.APNT_NEED_EN = 'Y'
		  and  b.WARD_APNT_PSBL_YN ='Y' /*병동검사예약가능여부*/
		  and  c.MCDP_CD = nvl(#{mcdpCd}, c.MCDP_CD)      /*  진료과               */
		  and  c.ORDR_YMD >= to_date(nvl(#{strtYmd} , '19900101'), 'YYYYMMDD')
		  and  c.ORDR_YMD <= to_date(nvl(#{fnshYmd} , '29991231'), 'YYYYMMDD')
		  and  c.ORDR_SNO = nvl(#{afiOrdrSnoStr}, a.ORDR_SNO)     /*  처방순번             */
		  and  c.ORDR_CD = b.ORDR_CD                                           /*  검사코드             */
		  and  (
				 ( #{dtlsExcfCd} is null)
				 or
				 ( b.DTLS_EXCF_CD = #{dtlsExcfCd} )
			   )
		  and  a.PTNO(+)    = c.PTNO                                              /*  환자번호             */
		  and  a.ORDR_YMD(+)  = c.ORDR_YMD                                        /*  처방일자             */
		  and  a.ORDR_SNO(+) = c.ORDR_SNO                                         /*  처방순번             */
		  and  nvl(c.DC_DVSN_CD, 'N') = 'N'
		  and  nvl(c.RCST_CD, '@') <> 'R'                                    /*  환불처방 제외 */
		   and c.CODV_CD = 'I'                                            /*  입원만 */
		  and  (  #{afiOrdrSnoStr} is not null
				  or
				  not exists (select 'Y'
							 from SZCTRLMMT
							where EXMN_CTRL_CD = 'SR035'
							  and EXMN_DTLS_CTRL_CD = c.ORDR_CD)
			   )
		  and  d.EXRM_CD(+) = a.EXRM_CD                                      /*  검사실코드           */
		  and  d.EXCF_CD(+) = a.EXCF_CD                                       /*  검사분류             */
		  and  e.EXMN_CTRL_CD     (+) = 'SWA_180'                   /*  검사항목별 특이사항 */
		  and  e.EXMN_DTLS_CTRL_CD(+) = a.EXMN_CD
		  and  e.APLY_PART_CD     (+) = a.EXCF_CD
		  and  e.LAST_UPDR_ID = f.USER_ID(+)
		  and  c.HSLC_DVSN_CD = NVL(#{hslcDvsnCd},c.HSLC_DVSN_CD)
		  and  g.PTNO = c.PTNO
		  and  i.MDFE_CD(+) = c.ORDR_CD
		  and  i.APST_YMD(+) <= c.ORDR_YMD
		  and  i.APFN_YMD(+) >= c.ORDR_YMD
		  and  j.EXMN_CTRL_CD(+) = 'SR210'
		  and  j.EXMN_DTLS_CTRL_CD(+) = c.ORDR_CD
		  and  srn.MCDP_CD(+) = c.MCDP_CD                      /*  진료과               */
		  and  srn.ORDR_CD(+) = c.ORDR_CD                      /*  처방코드             */
		  and  c.CODV_CD = nvl(srn.CODV_CD(+), c.CODV_CD)
		  and  a.AMPR_ID = k.USER_ID(+)
		  and  c.MDRP_NO = l.MDRP_NO
		  and  (
				  c.ORDR_YMD < to_date('20160702', 'yyyymmdd')                          /*  처방 유효기간 다윈 오픈전 처방은 예외처리(통합예약) */
				  or
				  nvl(#{valdHhDvsnCd}, 'Y') = 'N'
				  or
				  trunc(sysdate) <= nvl(c.ORDR_VALD_PERD_EXPT_YMD, c.ORDR_YMD + 365*2)
			   )
		order
		   by  22 desc
			,  9  desc /*  처방일자 */
			,  17      /*  처방순번 */
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll5-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="admsOtdvNm" column="ADMS_OTDV_NM"/>
		<result property="oddrNm" column="ODDR_NM"/>
		<result property="careRptnYn" column="CARE_RPTN_YN"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll5 ([환자번호-처방일자기준] 예약 접수 대상자 전체 조회) 
        Description :                                           [환자번호-처방일자기준] 예약 접수 대상자 전체 조회
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll5-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll5"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll5-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll5 */
		<![CDATA[
		select PTNO
		     , PTNT_NM
		     , MCDP_NM
		     , ADMS_OTDV_NM
		     , ODDR_NM
		     , case when sum(CARE_RPTN_YN_CNT) > 0 then 'Y'
		            else ''
		       end  as CARE_RPTN_YN
		     , UTPS
		  from (select /*+ leading(m) index(m (ORDR_YMD)) */ /* 처방일자기준 처방상태 */
		               m.PTNO                                /* 환자번호 */
		             , (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /*환자명*/
		             , (select ABRV_DPRT_CD
		                  from HZDEPTMMT
		                 where DPRT_CD = m.MCDP_CD
		                 group by ABRV_DPRT_CD)  as MCDP_NM  /* 진료과 */
		             , decode(m.CODV_CD,'I',case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD ) || '/' || l.CARE_PTRM_NO
		                                         when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		                                         else '' 
		                                    end
		                               ,'O','외래'||(case when (m.MCDP_CD != m.OROC_DPRT_CD) then '('||(select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD )||')' else '' end)
		                               ,'E','응급'
		                               ,'G','일검'
		                               ,'U','종검') as ADMS_OTDV_NM  /* 입원외래구분명 */
		             , (select USER_NM from CCUSRDPHT c where m.ODDR_ID = c.USER_ID) as ODDR_NM /* 처방의 */
		             , 0 as CARE_RPTN_YN_CNT
		             , (select substr(RGST_RESN_CD,1,1)
				          from MDUTPSMMT x
				         where x.MDRP_NO = l.MDRP_NO 
				           and x.RGST_YN = 'Y'
				           AND ROWNUM   <= 1
				           and x.RGST_DT = (select max(RGST_DT)
				                             from MDUTPSMMT y
				                            where y.MDRP_NO = x.MDRP_NO
				                              and y.RGST_YN = 'Y')) AS UTPS
		          from MDEXMORDT m
		             , SWORDRCMT b
		             , APRCRPTNT l
		             , APRCADBLT ad
		         where m.EXCF_CD = #{excfCd}
		           and (instr(#{ptdvCtn},m.CODV_CD) > 0)
		           and m.ORDR_YMD between to_date(#{strtYmd},'YYYYMMDD') and to_date(#{fnshYmd},'YYYYMMDD')
		           and (#{exrmCd} is null or (#{exrmCd} is not null and b.OTPT_EXRM_CD = #{exrmCd}))
		           and b.DTLS_EXCF_CD = nvl(#{dtlsExcfCd},b.DTLS_EXCF_CD)
		           and m.EXOR_PRSS_CD is null
		           and m.ORDR_CD = b.ORDR_CD
		           and nvl(m.ORFR_CD,'N') not in ('D','P') /* 과내검사 및 임시처방 제외)  */
		           and ((#{dcDvsnCd} is null and nvl(m.DC_DVSN_CD,'N') = 'N') or (#{dcDvsnCd} = 'Y'))
		           and m.PTAD_MDRP_NO = l.MDRP_NO
		           and m.PTAD_MDRP_NO = ad.MDRP_NO(+)
		       )
		 group by PTNO, PTNT_NM, MCDP_NM, ADMS_OTDV_NM, ODDR_NM, utps
		 order by PTNO
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll6-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="admsOtdvNm" column="ADMS_OTDV_NM"/>
		<result property="oddrNm" column="ODDR_NM"/>
		<result property="careRptnYn" column="CARE_RPTN_YN"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll6 ([환자번호-희망일자기준] 예약 접수 대상자 전체 조회) 
        Description :                                           [환자번호-희망일자기준] 예약 접수 대상자 전체 조회
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll6-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll6"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll6-result" useCache="true" flushCache="false">
		<![CDATA[
		select /* SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll6 */
		       PTNO
		     , PTNT_NM
		     , MCDP_NM
		     , ADMS_OTDV_NM
		     , ODDR_NM
		     , case when sum(CARE_RPTN_YN_CNT) > 0 then 'Y'
		            else ''
		       end  as CARE_RPTN_YN
		     , UTPS
		  from (select /*+ leading(m) index(m (WNTD_DT)) */ /* 희망일자기준 */
		               m.PTNO /*환자번호*/
		             , (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /* 환자명 */
		             , (select ABRV_DPRT_CD
		                  from HZDEPTMMT
		                 where DPRT_CD = m.MCDP_CD
		                 group by ABRV_DPRT_CD)  as MCDP_NM  /* 진료과 */
		             , decode(m.CODV_CD,'I',case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then (select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD)  || '/' || l.CARE_PTRM_NO
		                                         when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		                                         else '' 
		                                    end                                    
		                               ,'O','외래'||(case when (m.MCDP_CD != m.OROC_DPRT_CD) then '('||(select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD )||')' else '' end)
		                               ,'E','응급'
		                               ,'G','일검'
		                               ,'U','종검') as  ADMS_OTDV_NM  /* 입원외래구분명 */
		             , (select USER_NM from CCUSRDPHT c where m.ODDR_ID = c.USER_ID) as ODDR_NM /* 처방의 */
		             , 0  as CARE_RPTN_YN_CNT
		             , (select substr(RGST_RESN_CD,1,1)
				         from MDUTPSMMT x
				        where x.MDRP_NO = l.MDRP_NO 
				          and x.RGST_YN = 'Y'
				          AND ROWNUM   <= 1
				          and x.RGST_DT = (select max(RGST_DT)
				                             from MDUTPSMMT y
				                            where y.MDRP_NO = x.MDRP_NO
				                              and y.RGST_YN = 'Y')) AS UTPS
		          from MDEXMORDT m
		             , SWORDRCMT b
		             , APRCRPTNT l
		             , APRCADBLT ad
		         where m.EXCF_CD = #{excfCd}
		           and ((#{dcDvsnCd} is null and nvl(m.DC_DVSN_CD,'N') = 'N') or (#{dcDvsnCd} = 'Y'))
		           and (instr(#{ptdvCtn},m.CODV_CD) > 0)
		           and m.WNTD_DT between to_date(#{strtYmd},'YYYYMMDD')
		                             and to_date(#{fnshYmd},'YYYYMMDD') + 0.99999
		           and (#{exrmCd} is null or (#{exrmCd} is not null and b.OTPT_EXRM_CD = #{exrmCd}))
		           and b.DTLS_EXCF_CD = nvl(#{dtlsExcfCd},b.DTLS_EXCF_CD)
		           and m.EXOR_PRSS_CD is null
		           and nvl(m.ORFR_CD,'N') not in ('D','P')   /* 과내검사 및 임시처방 제외)  */
		           and m.ORDR_CD = b.ORDR_CD
		           and m.PTAD_MDRP_NO = l.MDRP_NO
		           and m.PTAD_MDRP_NO = ad.MDRP_NO(+)
		       )
		 group by PTNO, PTNT_NM, MCDP_NM, ADMS_OTDV_NM, ODDR_NM, UTPS
		 order by PTNO
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll7-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="admsOtdvNm" column="ADMS_OTDV_NM"/>
		<result property="oddrNm" column="ODDR_NM"/>
		<result property="careRptnYn" column="CARE_RPTN_YN"/>
		<result property="egfrbExrsVl" column="EGFRB_EXRS_VL"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll7 ([환자번호-예약일자기준] 예약 접수 대상자 전체 조회) 
        Description :                                           [환자번호-예약일자기준] 예약 접수 대상자 전체 조회
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll7-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll7"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll7-result" useCache="true" flushCache="false">
		<![CDATA[
		select /*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll7 */
		       PTNO
		     , PTNT_NM
		     , MCDP_NM
		     , ADMS_OTDV_NM
		     , ODDR_NM
		     , case when sum(CARE_RPTN_YN_CNT) > 0 then 'Y'
		            else ''
		       end  as CARE_RPTN_YN
		     , EGFRB_EXRS_VL
		     , UTPS
		  from (select /*+ LEADING (W) INDEX (W SWWORKMMT_I01 ) */ /* 예약일자기준 예약상태 */
		               m.PTNO /*환자번호*/
		             , (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /*환자명*/
		             , (select ABRV_DPRT_CD
		                  from HZDEPTMMT
		                 where DPRT_CD = m.MCDP_CD
		                 group by ABRV_DPRT_CD)  as MCDP_NM  /*진료과*/
		             , decode(m.CODV_CD,'I',case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD )  || '/' || l.CARE_PTRM_NO
		                                         when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		                                         else '' end
		                               ,'O','외래'||(case when (m.MCDP_CD != m.OROC_DPRT_CD) then '('||(select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD )||')' else '' end)
		                               ,'E','응급'
		                               ,'G','일검'
		                               ,'U','종검')  as ADMS_OTDV_NM  /* 입원외래구분명 */
		             , (select USER_NM from CCUSRDPHT c where m.ODDR_ID = c.USER_ID) as ODDR_NM /* 처방의 */
		             , 0  as CARE_RPTN_YN_CNT
		             , case when #{excfCd} = 'SR' then (select nvl(to_char(EXRS_NCVL_VL),'N')
		                                                  from SZRESULMT
		                                                 where PTNO = m.PTNO
		                                                   and EXMN_CD in (select EXMN_DTLS_CTRL_CD
		                                                                     from SZCTRLMMT
		                                                                    where EXMN_CTRL_CD = 'SRB_101'
		                                                                      and EXMN_DTLS_CTRL_NM = 'C')
		                                                   and EXMN_PRSS_CD = 'G'
		                                                   and RPRT_DT = (select /* INDEX(SZRESULMT, SZRESULMT_I05) */ --- 기존 힌트 삭제
		                                                                         /*+ NL_SJ */ -- 신규 힌트 추가
		                                                                         max(RPRT_DT)
		                                                                    from SZRESULMT
		                                                                   where PTNO = m.PTNO
		                                                                     and EXMN_CD in (select /*+ NL_SJ */
		                                                                                            EXMN_DTLS_CTRL_CD
		                                                                                       from SZCTRLMMT
		                                                                                      where EXMN_CTRL_CD = 'SRB_101'
		                                                                                        and EXMN_DTLS_CTRL_NM = 'C')
		                                                                     and EXMN_PRSS_CD = 'G'
		                                                                     and RPRT_DT >= ADD_MONTHS(trunc(sysdate),-1) )
		                                                   and rownum = 1)
		                    else ''
		               end  as EGFRB_EXRS_VL
		      , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		          from MDEXMORDT m
		             , SWWORKMMT w
		             , SWORDRCMT b
		             , SZROOMCMT d
		             , APRCRPTNT l
		             , APRCADBLT ad
		         where m.EXCF_CD = #{excfCd}
		           and ((#{dcDvsnCd} is null and  nvl(m.DC_DVSN_CD,'N') = 'N') or (#{dcDvsnCd} = 'Y'))
		           and (instr(#{ptdvCtn}, m.CODV_CD) > 0)
		           and ((#{exrmCd} is null)
		                or
		                (#{exrmCd} is not null and nvl(w.EXRM_CD, nvl((select ty.EXRM_CD
		                                                                 from SWSCHTYPT ty
		                                                                    , szroomcmt ro
		                                                                where ty.SCHD_TYP_CD = w.SCHD_TYP_CD
		                                                                  and ty.SCHD_DTLS_TYP_CD = w.SCHD_DTLS_TYP_CD
		                                                                  and ty.EXCF_CD = #{excfCd}
		                                                                  and ty.SCHD_DTLS_TYP_CD_USE_YN = 'Y'
		                                                                  and ty.EXCF_CD = ro.EXCF_CD
		                                                                  and ty.EXRM_CD = ro.EXRM_CD),b.OTPT_EXRM_CD)) = #{exrmCd}))
		           and w.APNT_DT between to_date(#{strtYmd},'YYYYMMDD')
		                             and to_date(#{fnshYmd},'YYYYMMDD') + 0.99999
		           and (#{prvlRptnYn} is null or w.PRVL_RPTN_YN = #{prvlRptnYn})
		           and m.EXOR_PRSS_CD = 'A'
		           and b. DTLS_EXCF_CD = nvl(#{dtlsExcfCd},b.DTLS_EXCF_CD)
		           and m.PTNO = w.PTNO
		           and m.ORDR_YMD = w.ORDR_YMD
		           and m.ORDR_SNO = w.ORDR_SNO
		           and m.ORDR_CD = b.ORDR_CD
		           and w.EXRM_CD = d.EXRM_CD(+)                /*  검사실코드           */
		           and w.EXCF_CD  = d.EXCF_CD(+)               /*  검사분류             */
		           and m.PTAD_MDRP_NO = l.MDRP_NO
		           and m.PTAD_MDRP_NO = ad.MDRP_NO(+)
		           and nvl(m.ORFR_CD,'N') not in ('D','P')     /* 과내검사 및 임시처방 제외)  */
		       )
		 group by PTNO, PTNT_NM, MCDP_NM, ADMS_OTDV_NM, ODDR_NM, EGFRB_EXRS_VL, UTPS
		 order by PTNO
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll8-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="admsOtdvNm" column="ADMS_OTDV_NM"/>
		<result property="oddrNm" column="ODDR_NM"/>
		<result property="careRptnYn" column="CARE_RPTN_YN"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll8 ([환자번호-접수일자기준] 예약 접수 대상자 전체 조회) 
        Description :                                           [환자번호-접수일자기준] 예약 접수 대상자 전체 조회
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll8-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll8"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll8-result" useCache="true" flushCache="false">
		<![CDATA[
		select /*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll8 */
		       PTNO
		     , PTNT_NM
		     , MCDP_NM
		     , ADMS_OTDV_NM
		     , ODDR_NM
		     , case when sum(CARE_RPTN_YN_CNT) > 0 then 'Y'
		            else ''
		       end  as CARE_RPTN_YN
		     , UTPS
		  from (select /*+ LEADING (W) INDEX (W SWWORKMMT_I03 ) */
		               m.PTNO /*환자번호*/
		             , (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /*환자명*/
		             , (select ABRV_DPRT_CD
		                  from HZDEPTMMT
		                 where DPRT_CD = m.MCDP_CD
		                 group by ABRV_DPRT_CD)  as MCDP_NM  /*진료과*/
		             , decode(m.CODV_CD,'I',case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then ( select  ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD )  || '/' || l.CARE_PTRM_NO
		                                         when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		                                         else ''
		                                    end
		                               ,'O','외래'||(case when (m.MCDP_CD != m.OROC_DPRT_CD) then '('||(select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD )||')' else '' end)
		                               ,'E','응급'
		                               ,'G','일검'
		                               ,'U','종검')  as ADMS_OTDV_NM  /* 입원외래구분명 */
		             , (select USER_NM from CCUSRDPHT c where m.ODDR_ID = c.USER_ID) as ODDR_NM /* 처방의 */
		             , 0  as CARE_RPTN_YN_CNT
		      , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		          from MDEXMORDT m
		             , SWWORKMMT w
		             , SWORDRCMT b
		             , SZROOMCMT d
		             , APRCRPTNT l
		             , APRCADBLT ad
		         where m.EXCF_CD = #{excfCd}
		           and ((#{dcDvsnCd} is null and nvl(m.DC_DVSN_CD,'N') = 'N') or (#{dcDvsnCd} = 'Y'))
		           and (instr(#{ptdvCtn},m.CODV_CD) > 0)
		           and (#{exrmCd} is null
		                or
		                (#{exrmCd} is not null and w.EXRM_CD = #{exrmCd}))
		           and w.RPTN_DT between to_date( #{strtYmd},'YYYYMMDD')
		                             and to_date(#{fnshYmd},'YYYYMMDD') + 0.99999
		           and m.EXOR_PRSS_CD = 'C'
		           and b. DTLS_EXCF_CD = nvl(#{dtlsExcfCd},b.DTLS_EXCF_CD)
		           and m.PTNO = w.PTNO
		           and m.ORDR_YMD = w.ORDR_YMD
		           and m.ORDR_SNO = w.ORDR_SNO
		           and m.ORDR_CD = b.ORDR_CD
		           and w.EXRM_CD = d.EXRM_CD(+)                /*  검사실코드           */
		           and w.EXCF_CD = d.EXCF_CD(+)                /*  검사분류             */
		           and m.PTAD_MDRP_NO = l.MDRP_NO
		           and m.PTAD_MDRP_NO = ad.MDRP_NO(+)
		           and nvl(m.ORFR_CD,'N') not in ('D','P')     /* 과내검사 및 임시처방 제외)  */
		       )
		 group by PTNO, PTNT_NM, MCDP_NM, ADMS_OTDV_NM, ODDR_NM, UTPS
		 order by PTNO
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll9-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="admsOtdvNm" column="ADMS_OTDV_NM"/>
		<result property="oddrNm" column="ODDR_NM"/>
		<result property="careRptnYn" column="CARE_RPTN_YN"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll9 ([환자번호-실시일자기준] 예약 접수 대상자 전체 조회) 
        Description :                                           [환자번호-실시일자기준] 예약 접수 대상자 전체 조회
                                            
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll9-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll9"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll9-result" useCache="true" flushCache="false">
		<![CDATA[
		/* 실시일자 */
		select /*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll9 */
		       PTNO
		     , PTNT_NM
		     , MCDP_NM
		     , ADMS_OTDV_NM
		     , ODDR_NM
		     , case when sum(CARE_RPTN_YN_CNT) > 0 then 'Y'
		            else ''
		       end  as CARE_RPTN_YN
		     , UTPS
		  from (select /*+ leading(w) index(w (ENFR_DT)) use_nl(m l b dr1 dr2 d) */
		               m.PTNO /*환자번호*/
		             , (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /*환자명*/
		             , (select ABRV_DPRT_CD
		                  from HZDEPTMMT
		                 where DPRT_CD = m.MCDP_CD
		                 group by ABRV_DPRT_CD) as MCDP_NM  /*진료과*/
		             , decode(m.CODV_CD,'I',case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD )  || '/' || l.CARE_PTRM_NO
		                                         when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		                                         else '' 
		                                    end
		                               ,'O','외래'||(case when (m.MCDP_CD != m.OROC_DPRT_CD) then '('||(select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD )||')' else '' end)
		                               ,'E','응급'
		                               ,'G','일검'
		                               ,'U','종검')  as ADMS_OTDV_NM  /* 입원외래구분명 */
		             , (select USER_NM from CCUSRDPHT c where m.ODDR_ID = c.USER_ID) as ODDR_NM /* 처방의 */
		             , 0 as CARE_RPTN_YN_CNT
		      , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		          from MDEXMORDT m
		             , SWWORKMMT w
		             , SWORDRCMT b
		             , SZROOMCMT d
		             , APRCRPTNT l
		             , APRCADBLT ad
		         where m.EXCF_CD = #{excfCd}
		           and ((#{dcDvsnCd} is null and nvl(m.DC_DVSN_CD, 'N') = 'N') or (#{dcDvsnCd} = 'Y'))
		           and (instr(#{ptdvCtn},m.CODV_CD) > 0)
		           and (#{exrmCd} is null
		                or
		                (#{exrmCd} is not null and w.EXRM_CD = #{exrmCd}) )
		           and w.ENFR_DT between to_date(#{strtYmd},'YYYYMMDD')
		                             and to_date(#{fnshYmd},'YYYYMMDD') + 0.99999
		           and m.EXOR_PRSS_CD in ('D','E','F','G')
		           and b.DTLS_EXCF_CD = nvl(#{dtlsExcfCd},b.DTLS_EXCF_CD)
		           and m.PTNO = w.PTNO
		           and m.ORDR_YMD = w.ORDR_YMD
		           and m.ORDR_SNO = w.ORDR_SNO
		           and m.ORDR_CD = b.ORDR_CD
		           and w.EXRM_CD = d.EXRM_CD(+)                /*  검사실코드           */
		           and w.EXCF_CD  = d.EXCF_CD(+)               /*  검사분류             */
		           and m.PTAD_MDRP_NO = l.MDRP_NO
		           and m.PTAD_MDRP_NO = ad.MDRP_NO(+)
		           and nvl(m.ORFR_CD, 'N') not in ('D','P')    /* 과내검사 및 임시처방 제외)  */
		       )
		 group by PTNO, PTNT_NM, MCDP_NM, ADMS_OTDV_NM, ODDR_NM, UTPS
		 order by PTNO
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll10-result" type="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="admsOtdvNm" column="ADMS_OTDV_NM"/>
		<result property="oddrNm" column="ODDR_NM"/>
		<result property="careRptnYn" column="CARE_RPTN_YN"/>
		<result property="egfrbExrsVl" column="EGFRB_EXRS_VL"/>
		<result property="apntDt" column="APNT_DT"/>
		<result property="utps" column="UTPS"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll10 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO
		resultMap : com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll10-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll10"  parameterType="com.sds.healthcare.ehr.sup.sr.srp.vo.SrpExmnApntTrgtDVO"  resultMap="com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll10-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sr-srp-dao-SrpExmnApntTrgtDAO-listExmnApntRptnAll10 */
		<![CDATA[
		select PTNO
		     , PTNT_NM
		     , MCDP_NM
		     , ADMS_OTDV_NM
		     , ODDR_NM
		     , case when sum(CARE_RPTN_YN_CNT) > 0 then 'Y'
		            else ''
		       end  as CARE_RPTN_YN
		     , EGFRB_EXRS_VL
		     , APNT_DT
		     , UTPS
		  from (select /*+ LEADING (W) INDEX (W SWWORKMMT_I01 )  */ /* 예약일자기준 예약상태 */
		               m.PTNO /*환자번호*/
		             , (select F_A.PTNT_NM from APPTPTNTT F_A where F_A.PTNO = m.PTNO) as PTNT_NM /*환자명*/
		             , to_char(m.APNT_DT, 'yyyymmddhh24mi') as APNT_DT   /*예약일시*/
		             , (select ABRV_DPRT_CD
		                  from HZDEPTMMT
		                 where DPRT_CD = m.MCDP_CD
		                 group by ABRV_DPRT_CD) as MCDP_NM  /*진료과*/
		             , decode(m.CODV_CD,'I',case when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) = to_date('29991231','yyyymmdd') then (select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = l.care_ward_cd group by ABRV_DPRT_CD ) || '/' || l.CARE_PTRM_NO
		                                         when nvl(l.DSCH_DT,to_date('29991231','yyyymmdd')) <> to_date('29991231','yyyymmdd') then '퇴원'
		                                         else '' 
		                                    end
		                               ,'O','외래'||(case when (m.MCDP_CD != m.OROC_DPRT_CD) then '('||(select ABRV_DPRT_CD from HZDEPTMMT where DPRT_CD = m.OROC_DPRT_CD group by ABRV_DPRT_CD )||')' else '' end)
		                               ,'E','응급'
		                               ,'G','일검'
		                               ,'U','종검') as  ADMS_OTDV_NM  /* 입원외래구분명 */
		             , (select USER_NM from CCUSRDPHT c where m.ODDR_ID = c.USER_ID)  as ODDR_NM  /* 처방의 */
		             , 0 as CARE_RPTN_YN_CNT
		             , case when #{excfCd} = 'SR' then (select nvl(to_char(EXRS_NCVL_VL),'N') as EGFRB_EXRS_VL
		                                                  from SZRESULMT
		                                                 where PTNO = m.PTNO
		                                                   and EXMN_CD in (select EXMN_DTLS_CTRL_CD
		                                                                     from SZCTRLMMT
		                                                                    where EXMN_CTRL_CD = 'SRB_101'
		                                                                      and EXMN_DTLS_CTRL_NM = 'C')
		                                                                      and EXMN_PRSS_CD = 'G'
		                                                   and RPRT_DT = (select /* INDEX(SZRESULMT, SZRESULMT_I05) */ --- 기존 힌트 삭제
		                                                                         /*+ NL_SJ */ -- 신규 힌트 추가
		                                                                         max(RPRT_DT)
		                                                                    from SZRESULMT
		                                                                   where PTNO = m.PTNO
		                                                                     and EXMN_CD in (select /*+ NL_SJ */
		                                                                                            EXMN_DTLS_CTRL_CD
		                                                                                       from SZCTRLMMT
		                                                                                      where EXMN_CTRL_CD = 'SRB_101'
		                                                                                        and EXMN_DTLS_CTRL_NM = 'C')
		                                                                     and EXMN_PRSS_CD = 'G'
		                                                                     and RPRT_DT >= ADD_MONTHS(trunc(sysdate),-1) ) 
		                                                   and rownum = 1) 
		                    else ''
		               end  as EGFRB_EXRS_VL
		      , (select substr(RGST_RESN_CD,1,1)
				   from MDUTPSMMT x
				  where x.MDRP_NO = l.MDRP_NO 
				    and x.RGST_YN = 'Y'
				    AND ROWNUM   <= 1
				    and x.RGST_DT = (select max(RGST_DT)
				                       from MDUTPSMMT y
				                      where y.MDRP_NO = x.MDRP_NO
				                        and y.RGST_YN = 'Y')) AS UTPS
		          from MDEXMORDT m
		             , SWWORKMMT w
		             , SWORDRCMT b
		             , SZROOMCMT d
		             , APRCRPTNT l
		             , APRCADBLT ad
		         where m.EXCF_CD = #{excfCd}
		           and ((#{dcDvsnCd} is null and nvl(m.DC_DVSN_CD, 'N') = 'N') or (#{dcDvsnCd} = 'Y'))
		           and (instr(#{ptdvCtn},m.CODV_CD) > 0)
		           and (#{exrmCd} is null
		                or
		                (#{exrmCd} is not null and nvl(w.EXRM_CD, nvl((select ty.EXRM_CD
		                                                                 from SWSCHTYPT ty
		                                                                    , szroomcmt ro
		                                                                where ty.SCHD_TYP_CD = w.SCHD_TYP_CD
		                                                                  and ty.SCHD_DTLS_TYP_CD = w.SCHD_DTLS_TYP_CD
		                                                                  and ty.EXCF_CD = #{excfCd}
		                                                                  and ty.SCHD_DTLS_TYP_CD_USE_YN = 'Y'
		                                                                  and ty.EXCF_CD = ro.EXCF_CD
		                                                                  and ty.EXRM_CD = ro.EXRM_CD), b.OTPT_EXRM_CD)) = #{exrmCd}))
		           and w.APNT_DT between to_date(#{strtYmd},'YYYYMMDD')
		                             and to_date(#{fnshYmd},'YYYYMMDD') + 0.99999
		           and (#{prvlRptnYn} is null or w.PRVL_RPTN_YN = #{prvlRptnYn})
		           and m.EXOR_PRSS_CD = 'A'
		           and b. DTLS_EXCF_CD = nvl(#{dtlsExcfCd},b.DTLS_EXCF_CD)
		           and m.PTNO = w.PTNO
		           and m.ORDR_YMD = w.ORDR_YMD
		           and m.ORDR_SNO = w.ORDR_SNO
		           and m.ORDR_CD = b.ORDR_CD
		           and w.EXRM_CD = d.EXRM_CD(+)                /*  검사실코드           */
		           and w.EXCF_CD  = d.EXCF_CD(+)               /*  검사분류             */
		           and m.PTAD_MDRP_NO = l.MDRP_NO
		           and m.PTAD_MDRP_NO = ad.MDRP_NO(+)
		           and nvl(m.ORFR_CD,'N') not in ('D','P')     /* 과내검사 및 임시처방 제외)  */
		       )
		 group by PTNO, PTNT_NM, MCDP_NM, ADMS_OTDV_NM, ODDR_NM, EGFRB_EXRS_VL, APNT_DT, UTPS
		 order by APNT_DT, PTNO
		]]>
	</select>



</mapper>