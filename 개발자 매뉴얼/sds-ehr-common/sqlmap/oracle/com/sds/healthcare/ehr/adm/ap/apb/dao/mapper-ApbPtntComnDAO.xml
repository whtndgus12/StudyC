<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_ApbPtntComnDAO_sql.xml 
    Description : -->
<mapper namespace="ApbPtntComnDAO">


	<resultMap id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDummy-result" type="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO">
	
		<result property="wodvCd" column="WODV_CD"/>
		<result property="prsgFlagNm" column="PRSG_FLAG_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDummy () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
		resultMap : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDummy-result
    -->
	<select id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDummy"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  resultMap="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDummy-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDummy */
		select '' as WODV_CD
		        , '' as PRSG_FLAG_NM
		from dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOnePtntBsif-result" type="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="ptntAlisNm" column="PTNT_ALIS_NM"/>
		<result property="ptntEnsnLsnm" column="PTNT_ENSN_LSNM"/>
		<result property="ptntEnsnNm" column="PTNT_ENSN_NM"/>
		<result property="frrn" column="FRRN"/>
		<result property="brrn" column="BRRN"/>
		<result property="bsovAftrPtno" column="BSOV_AFTR_PTNO"/>
		<result property="ageVl" column="AGE_VL"/>
		<result property="bsrn" column="BSRN"/>
		<result property="btdt" column="BTDT"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="ntnlCd" column="NTNL_CD"/>
		<result property="psptNo" column="PSPT_NO"/>
		<result property="ptntInfwPathCd" column="PTNT_INFW_PATH_CD"/>
		<result property="ptntInfwPathNm" column="PTNT_INFW_PATH_NM"/>
		<result property="inccPtntYn" column="INCC_PTNT_YN"/>
		<result property="rqprTlnoCtn" column="RQPR_TLNO_CTN"/>
		<result property="rqprNm" column="RQPR_NM"/>
		<result property="rqstInprId" column="RQST_INPR_ID"/>
		<result property="rqstInprNm" column="RQST_INPR_NM"/>
		<result property="rqstInptDt" column="RQST_INPT_DT"/>
		<result property="dethYmd" column="DETH_YMD"/>
		<result property="dethYmdRgsrId" column="DETH_YMD_RGSR_ID"/>
		<result property="prtsRsrn" column="PRTS_RSRN"/>
		<result property="prtsNm" column="PRTS_NM"/>
		<result property="inifAgrmYn" column="INIF_AGRM_YN"/>
		<result property="snstInfmAgrmYn" column="SNST_INFM_AGRM_YN"/>
		<result property="uniqIdntInfmAgrmYn" column="UNIQ_IDNT_INFM_AGRM_YN"/>
		<result property="inifAgrmRgstSystNm" column="INIF_AGRM_RGST_SYST_NM"/>
		<result property="inifAgrmSgntYn" column="INIF_AGRM_SGNT_YN"/>
		<result property="scryYn" column="SCRY_YN"/>
		<result property="insrQlfcExclYn" column="INSR_QLFC_EXCL_YN"/>
		<result property="emailId" column="EMAIL_ID"/>
		<result property="emailDmanNm" column="EMAIL_DMAN_NM"/>
		<result property="cashRcptUseNo" column="CASH_RCPT_USE_NO"/>
		<result property="ovrsRsdtYn" column="OVRS_RSDT_YN"/>
		<result property="rmrkCtn" column="RMRK_CTN"/>
		<result property="lastUpdrNm" column="LAST_UPDR_NM"/>
		<result property="lastUpdrId" column="LAST_UPDR_ID"/>
		<result property="lastUpdtDt" column="LAST_UPDT_DT"/>
		<result property="ssn" column="SSN"/>
		<result property="frgnRgstNo" column="FRGN_RGST_NO"/>
		<result property="frgnIdntCd" column="FRGN_IDNT_CD"/>
		<result property="vipYn" column="VIP_YN"/>
		<result property="vipCtn" column="VIP_CTN"/>
		<result property="frstRgstSrvrPrgmId" column="FRST_RGST_SRVR_PRGM_ID"/>
		<result property="rsrnDvsnCd" column="RSRN_DVSN_CD"/>
		<result property="natnAmdtZoneCd" column="NATN_AMDT_ZONE_CD"/>
		<result property="smsrSndgLnggCd" column="SMSR_SNDG_LNGG_CD"/>
		<result property="realBtdt" column="REAL_BTDT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOnePtntBsif () 
        Description :                                           apd_ptptntt_s01$S01_환자기본정보조회 apd_ptptntt_s03$S01_환자기본정보조회
                                            
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
		resultMap : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOnePtntBsif-result
    -->
	<select id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOnePtntBsif"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  resultMap="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOnePtntBsif-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOnePtntBsif */
		       a.PTNO as PTNO 
		    ,  a.PTNT_NM as PTNT_NM
		    ,  a.PTNT_ALIS_NM as PTNT_ALIS_NM
		    ,  a.PTNT_ENSN_LSNM as PTNT_ENSN_LSNM
		    ,  a.PTNT_ENSN_NM as PTNT_ENSN_NM
		    ,  a.FRRN as FRRN
		    ,  a.BRRN as BRRN
		    ,  a.BSOV_AFTR_PTNO as BSOV_AFTR_PTNO
		        ,  fn_ap_age_s(a.PTNO, sysdate) as AGE_VL
		    ,  a.BSRN as BSRN
		    ,  to_char(a.BTDT, 'yyyymmddhh24miss') as BTDT
		    ,  a.GEND_CD as GEND_CD
		    ,  a.NTNL_CD as NTNL_CD
		    ,  a.PSPT_NO as PSPT_NO
		    ,  a.PTNT_INFW_PATH_CD as PTNT_INFW_PATH_CD
		    ,  (   select  PTNT_CTRL_NM
		             from  APCTRLMMT
		            where  PTNT_CTRL_CD       = 'AP412'
		              and  PTNT_DTLS_CTRL_CD  =   a.PTNT_INFW_PATH_CD
		       ) as PTNT_INFW_PATH_NM 
		    ,  a.INCC_PTNT_YN as INCC_PTNT_YN
		    ,  a.RQPR_TLNO_CTN as RQPR_TLNO_CTN
		    ,  a.RQPR_NM as RQPR_NM
		    ,  a.RQST_INPR_ID as RQST_INPR_ID
		    ,  (select b.USER_NM
		        from CCUSRDPHT b
		       where b.USER_ID = a.RQST_INPR_ID) as RQST_INPR_NM
		    ,  to_char(a.RQST_INPT_DT, 'yyyymmddhh24miss') as RQST_INPT_DT
		    ,  to_char(a.DETH_YMD, 'yyyymmddhh24miss') as DETH_YMD
		    ,  a.DETH_YMD_RGSR_ID as DETH_YMD_RGSR_ID
		    ,  a.PRTS_RSRN as PRTS_RSRN
		    ,  a.PRTS_NM as PRTS_NM
		    ,  a.INIF_AGRM_YN
		    ,  a.SNST_INFM_AGRM_YN
		    ,  a.UNIQ_IDNT_INFM_AGRM_YN
		    ,  a.INIF_AGRM_RGST_SYST_NM as INIF_AGRM_RGST_SYST_NM
		    ,  a.INIF_AGRM_SGNT_YN
		    ,  a.SCRY_YN
		    ,  a.INSR_QLFC_EXCL_YN
		    ,  a.EMAIL_ID as EMAIL_ID
		    ,  a.EMAIL_DMAN_NM as EMAIL_DMAN_NM
		    ,  a.CASH_RCPT_USE_NO as CASH_RCPT_USE_NO
		    ,  a.OVRS_RSDT_YN as OVRS_RSDT_YN
		    ,  a.RMRK_CTN as RMRK_CTN
		    ,  (select b.USER_NM
		         from CCUSRDPHT b
		        where b.USER_ID = a.LAST_UPDR_ID) as LAST_UPDR_NM
		    ,  a.LAST_UPDR_ID as LAST_UPDR_ID          
		        ,  to_char(a.LAST_UPDT_DT,'yyyymmddhh24miss') as LAST_UPDT_DT
		    ,  a.SSN as SSN
		    ,  a.FRGN_RGST_NO as FRGN_RGST_NO
		    ,  a.FRGN_IDNT_CD as FRGN_IDNT_CD
		    ,  a.VIP_YN as VIP_YN
		    ,  a.VIP_CTN as VIP_CTN
		    ,  a.FRST_RGST_SRVR_PRGM_ID as FRST_RGST_SRVR_PRGM_ID
		    ,  a.RSRN_DVSN_CD
		    ,  a.NATN_AMDT_ZONE_CD
		    ,  a.SMSR_SNDG_LNGG_CD
		    ,  to_char(a.REAL_BTDT, 'yyyymmddhh24miss') as REAL_BTDT
		   from  APPTPTNTT a
		  where  ptno = #{ptno}
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updatePtntInfm (환자정보 수정) 
        Description :                                           환자정보 수정
                                            
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
    -->	
	<update id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updatePtntInfm"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updatePtntInfm */
		UPDATE  /* ApbPtntComnDAO-updatePtntInfm_환자기본정보 수정 */
		        APPTPTNTT
		   SET  LAST_UPDR_ID            =   #{gvUserId}
		     ,  LAST_UPDT_IP            =   #{gvUserIp}
		     ,  LAST_UPDT_DT            =   sysdate
		     ,  LAST_UPDT_CLNT_PRGM_ID  =   #{gvClntPrgmId}
		     ,  LAST_UPDT_SRVR_PRGM_ID  =   #{gvSrvrPrgmId}
		 <if test="dethYmd != null">
		     ,  DETH_YMD                =   to_date(#{dethYmd}, 'yyyymmddhh24miss')
		 </if>
		 <if test="dethYmdRgsrId != null">
		     ,  DETH_YMD_RGSR_ID        =   #{dethYmdRgsrId}
		 </if>
		 <if test="rmrkCtn != null">
		     ,  RMRK_CTN                =   #{rmrkCtn}
		 </if>
		 WHERE  PTNO                    =   #{ptno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updatePtntBsif (환자기본정보변경) 
        Description :                                           apd_ptptntt_u02$U01_환자기본정보변경
                                            
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
    -->	
	<update id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updatePtntBsif"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updatePtntBsif */
			   APPTPTNTT
		  set  PTNT_NM                = #{ptntNm}
			,  PTNT_ENSN_NM           = #{ptntEnsnNm}
			,  PTNT_ENSN_LSNM         = #{ptntEnsnLsnm}
			,  BTDT                   = to_date(#{btdt}, 'yyyymmdd')
			,  PRTS_NM                = #{prtsNm}
			,  PRTS_RSRN              = decode(instr(nvl(#{prtsRsrn},' '),'*'), 0, #{prtsRsrn}, PRTS_RSRN)
			,  GEND_CD                = #{gendCd}
			,  OVRS_RSDT_YN           = #{ovrsRsdtYn}
			,  PTNT_INFW_PATH_CD      = #{ptntInfwPathCd}
			,  BSRN                   = #{bsrn}
			,  INSR_QLFC_EXCL_YN      = #{insrQlfcExclYn}
			,  CASH_RCPT_USE_NO       = #{cashRcptUseNo}
			,  BSOV_AFTR_PTNO         = #{bsovAftrPtno}
			,  DETH_YMD               = to_date(#{dethYmd}, 'yyyymmddhh24miss')
			,  RMRK_CTN               = #{rmrkCtn}
		    ,  REAL_BTDT              = to_date(#{realBtdt}, 'yyyymmdd')
			/*  서버 프로그램 전환시 자동 추가된 항목 */
			,  LAST_UPDR_ID = #{gvUserId}
			,  LAST_UPDT_IP = #{gvUserIp}
			,  LAST_UPDT_DT = sysdate
			,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
			,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
			, FRRN = nvl(#{frrn}, FRRN)
		    , BRRN = decode(instr(#{brrn},'*'), 0, #{brrn}, BRRN)
		    , PSPT_NO = decode(instr(nvl(#{psptNo},' '),'*'), 0, #{psptNo}     , PSPT_NO)
		    , SSN          = #{ssn}
		    , FRGN_IDNT_CD = #{frgnIdntCd}
		    , FRGN_RGST_NO = decode(instr(nvl(#{frgnRgstNo},' '),'*'), 0, #{frgnRgstNo}, FRGN_RGST_NO) 
		    , NTNL_CD = decode(#{ntnlCd}, '#', NTNL_CD, #{ntnlCd})/* 추가 */
		    , EMAIL_ID = decode(instr(nvl(#{emailId},' '),'*'), 0, #{emailId}, EMAIL_ID)
		    , EMAIL_DMAN_NM = #{emailDmanNm}
		    , VIP_YN = #{vipYn}
		    , VIP_CTN = #{vipCtn}
		    , RSRN_DVSN_CD = #{rsrnDvsnCd}
		    , NATN_AMDT_ZONE_CD = #{natnAmdtZoneCd}
		    , SMSR_SNDG_LNGG_CD = #{smsrSndgLnggCd}
		    , INIF_AGRM_YN      = #{inifAgrmYn}
		    , INIF_AGRM_SGNT_YN      = #{inifAgrmSgntYn}
		where  PTNO = #{ptno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updateEmailInfm (이메일정보 수정) 
        Description :                                           xpd_csmstrt_u02$I01_이메일정보 수정
                                            
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
    -->	
	<update id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updateEmailInfm"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updateEmailInfm */
			   APPTPTNTT
		  set  EMAIL_ID           =  decode(instr(nvl(#{emailId},' '),'*'), 0, #{emailId}, EMAIL_ID)
			,  EMAIL_DMAN_NM      =  #{emailDmanNm}
			,  LAST_UPDR_ID       =  #{gvUserId}
			,  LAST_UPDT_IP       =  #{gvUserIp}
			,  LAST_UPDT_DT       =  sysdate
			,  LAST_UPDT_CLNT_PRGM_ID  =  #{gvClntPrgmId}
			,  LAST_UPDT_SRVR_PRGM_ID  =  #{gvSrvrPrgmId}
		where  PTNO            =  #{ptno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updateHlscCstmPrt (건진 고객일부정보 수정) 
        Description :                                           xpd_csmstrt_u03$I01_건진 고객일부정보 수정
                                            
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
    -->	
	<update id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updateHlscCstmPrt"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updateHlscCstmPrt */
			   APPTPTNTT
		  set  PTNT_NM            =  nvl(#{ptntNm}, PTNT_NM)
			,  FRRN               =  nvl(#{frrn}, FRRN)
			,  BRRN               =  decode(instr(#{brrn},'*'), 0, #{brrn}, BRRN)
			,  PTNT_ENSN_LSNM     =  #{ptntEnsnLsnm}
			,  PTNT_ENSN_NM       =  #{ptntEnsnNm}
			,  BTDT               =  to_date(#{btdt},'yyyymmdd')
		    ,  REAL_BTDT          =  to_date(#{realBtdt},'yyyymmdd')
			,  GEND_CD            =  nvl(#{gendCd}, GEND_CD)
			,  EMAIL_ID           =  decode(instr(nvl(#{emailId},' '),'*'), 0, #{emailId}, EMAIL_ID)
			,  EMAIL_DMAN_NM      =  #{emailDmanNm}
			,  RMRK_CTN           =  #{rmrkCtn}
			,  LAST_UPDR_ID       =  #{gvUserId}
			,  LAST_UPDT_IP       =  #{gvUserIp}
			,  LAST_UPDT_DT       =  sysdate
			,  LAST_UPDT_CLNT_PRGM_ID  =  #{gvClntPrgmId}
			,  LAST_UPDT_SRVR_PRGM_ID  =  #{gvSrvrPrgmId}
		where  PTNO            =  #{ptno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-insertPtnt (신환등록) 
        Description :                                           apd_ptptntt_i01$I01_신환등록
                                            
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
    -->	
	<insert id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-insertPtnt"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  >
		insert  /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-insertPtnt */
		        into  APPTPTNTT
		        (
		               PTNO
		            ,  PTNT_NM
		            ,  PTNT_ALIS_NM
		            ,  PTNT_ENSN_LSNM
		            ,  PTNT_ENSN_NM
		            ,  BSOV_AFTR_PTNO
		            ,  BSRN
		            ,  BTDT
		            ,  GEND_CD
		            ,  PTNT_INFW_PATH_CD
		            ,  INCC_PTNT_YN
		            ,  RQPR_NM
		            ,  RQPR_TLNO_CTN
		            ,  RQST_INPR_ID
		            ,  RQST_INPT_DT
		            ,  DETH_YMD
		            ,  DETH_YMD_RGSR_ID
		            ,  PRTS_RSRN
		            ,  PRTS_NM
		            ,  INIF_AGRM_YN
		            ,  SNST_INFM_AGRM_YN
		            ,  UNIQ_IDNT_INFM_AGRM_YN
		            ,  INIF_AGRM_RGST_SYST_NM
		            ,  INIF_AGRM_SGNT_YN
		            ,  SCRY_YN
		            ,  INSR_QLFC_EXCL_YN
		            ,  CASH_RCPT_USE_NO
		            ,  OVRS_RSDT_YN
		            ,  RMRK_CTN
		            ,  FRRN
		            ,  BRRN
		            ,  PSPT_NO
		            ,  DRVE_LCNS_NO
		            ,  SSN
		            ,  FRGN_IDNT_CD
		            ,  FRGN_RGST_NO
		            ,  NTNL_CD
		            ,  EMAIL_ID
		            ,  EMAIL_DMAN_NM
		            ,  VIP_YN
		            ,  VIP_CTN
		            ,  RSRN_DVSN_CD
		            ,  NATN_AMDT_ZONE_CD       
		            ,  SMSR_SNDG_LNGG_CD    
		            ,  REAL_BTDT  
		            ,  FRST_RGSR_ID
		            ,  FRST_RGST_IP
		            ,  FRST_RGST_DT
		            ,  FRST_RGST_CLNT_PRGM_ID
		            ,  FRST_RGST_SRVR_PRGM_ID
		            ,  LAST_UPDR_ID
		            ,  LAST_UPDT_IP
		            ,  LAST_UPDT_DT
		            ,  LAST_UPDT_CLNT_PRGM_ID
		            ,  LAST_UPDT_SRVR_PRGM_ID
		            )
		        values
		            (
		               #{ptno}
		            ,  #{ptntNm}
		            ,  #{ptntAlisNm}
		            ,  #{ptntEnsnLsnm}
		            ,  #{ptntEnsnNm}
		            ,  #{bsovAftrPtno}
		            ,  #{bsrn}
		            ,  to_date(#{btdt}, 'yyyymmddhh24miss')
		            ,  #{gendCd}
		            ,  #{ptntInfwPathCd}
		            ,  #{inccPtntYn}
		            ,  #{rqprNm}
		            ,  #{rqprTlnoCtn}
		            ,  #{rqstInprId}
		            ,  to_date(#{rqstInptDt}, 'yyyymmddhh24miss')
		            ,  #{dethYmd}
		            ,  #{dethYmdRgsrId}
		            ,  #{prtsRsrn}
		            ,  #{prtsNm}
		            ,  #{inifAgrmYn}
		            ,  #{snstInfmAgrmYn}
		            ,  #{uniqIdntInfmAgrmYn}
		            ,  #{inifAgrmRgstSystNm}
		            ,  #{inifAgrmSgntYn}
		            ,  #{scryYn}
		            ,  #{insrQlfcExclYn}
		            ,  #{cashRcptUseNo}
		            ,  #{ovrsRsdtYn}
		            ,  #{rmrkCtn}
		            ,  #{frrn}
		            ,  #{brrn}
		            ,  #{psptNo}
		            ,  #{drveLcnsNo}
		            ,  #{ssm}
		            ,  #{frgnIdntCd}
		            ,  #{frgnRgstNo}
		            ,  #{ntnlCd}
		            ,  #{emailId}
		            ,  #{emailDmanNm}
		            ,  #{vipYn}
		            ,  #{vipCtn}
		            ,  #{rsrnDvsnCd}
		            ,  #{natnAmdtZoneCd}         
		            ,  #{smsrSndgLnggCd}  
		            ,  to_date(#{realBtdt}, 'yyyymmddhh24miss') 
		            ,  #{gvUserId}
		            ,  #{gvUserIp}
		            ,  sysdate
		            ,  #{gvClntPrgmId}
		            ,  #{gvSrvrPrgmId}
		            ,  #{gvUserId}
		            ,  #{gvUserIp}
		            ,  sysdate
		            ,  #{gvClntPrgmId}
		            ,  #{gvSrvrPrgmId}
		        )
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updateHlscCstmPrtInfm (건진고객 일부정보 수정) 
        Description :                                           apd_ptptntt_u18$I01_건진고객 일부정보 수정
                                            
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
    -->	
	<update id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updateHlscCstmPrtInfm"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updateHlscCstmPrtInfm */
			   APPTPTNTT
		  set  PTNT_NM                = #{ptntNm}
			,  PTNT_ENSN_NM           = #{ptntEnsnNm}
			,  PTNT_ENSN_LSNM         = #{ptntEnsnLsnm}
			,  BTDT                   = to_date(#{btdt}, 'yyyymmdd')
		    ,  REAL_BTDT                   = to_date(#{realBtdt}, 'yyyymmdd')
			,  GEND_CD                = #{gendCd}
		    ,  EMAIL_ID = #{emailId}
		    ,  EMAIL_DMAN_NM = #{emailDmanNm}
			/*  서버 프로그램 전환시 자동 추가된 항목 */
			,  LAST_UPDR_ID = #{gvUserId}
			,  LAST_UPDT_IP = #{gvUserIp}
			,  LAST_UPDT_DT = sysdate
			,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
			,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		where  PTNO = #{ptno}
	</update>


	<resultMap id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneAgeVl-result" type="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO">
	
		<result property="ageVl" column="AGE_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneAgeVl (환자나이조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
		resultMap : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneAgeVl-result
    -->
	<select id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneAgeVl"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  resultMap="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneAgeVl-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneAgeVl */
		      	fn_ap_age_s(#{ptno},trunc(sysdate)) as AGE_VL
		  from  
		        dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDethYmd-result" type="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO">
	
		<result property="dethYmd" column="DETH_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDethYmd (환자사망일자조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
		resultMap : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDethYmd-result
    -->
	<select id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDethYmd"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  resultMap="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDethYmd-result" useCache="true" flushCache="false">
		select /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneDethYmd */
				  to_char(FN_AP_DETHYMD(#{ptno}), 'yyyymmdd') as DETH_YMD
		  from 
		          dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-listPtntByRsrn-result" type="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="frrn" column="FRRN"/>
		<result property="brrn" column="BRRN"/>
		<result property="clno" column="CLNO"/>
		<result property="zpadNm" column="ZPAD_NM"/>
		<result property="deadNm" column="DEAD_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-listPtntByRsrn (주민번호로 환자조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
		resultMap : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-listPtntByRsrn-result
    -->
	<select id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-listPtntByRsrn"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  resultMap="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-listPtntByRsrn-result" useCache="true" flushCache="false">
		   select /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-listPtntByRsrn */
		      A.PTNO as PTNO
		    , A.PTNT_NM as PTNT_NM
		    , A.FRRN as FRRN
		    , A.BRRN as BRRN
		    , fn_ap_wrap_telno(b.PTNT_TLNO, null) as CLNO  /*  APB_002 P 휴대폰 */
		    , c.ZPAD_NM
		    , c.DEAD_NM   
		   from APPTPTNTT A
		      , APPTCNPNT B
		      , APPTADRST C
		  where  a.FRRN = #{frrn}
		    and  a.BRRN like #{brrn}||'%'
		    and  b.PTNO(+) = A.PTNO
		    and  b.CNPN_DVSN_CD(+) = 'BP'
		    and  b.CNPN_SNO(+) = 1
		    and  c.PTNO(+) = A.PTNO
		    and  c.ADRS_USGE_CD(+) = 'A'
		    and  c.ADRS_SNO(+) = 1
		    and  a.PTNO not like 'R%'
	</select>




	<resultMap id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneRandomPtnt-result" type="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="ptntAlisNm" column="PTNT_ALIS_NM"/>
		<result property="ptntEnsnLsnm" column="PTNT_ENSN_LSNM"/>
		<result property="ptntEnsnNm" column="PTNT_ENSN_NM"/>
		<result property="frrn" column="FRRN"/>
		<result property="brrn" column="BRRN"/>
		<result property="bsovAftrPtno" column="BSOV_AFTR_PTNO"/>
		<result property="ageVl" column="AGE_VL"/>
		<result property="bsrn" column="BSRN"/>
		<result property="btdt" column="BTDT"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="ntnlCd" column="NTNL_CD"/>
		<result property="psptNo" column="PSPT_NO"/>
		<result property="ptntInfwPathCd" column="PTNT_INFW_PATH_CD"/>
		<result property="ptntInfwPathNm" column="PTNT_INFW_PATH_NM"/>
		<result property="inccPtntYn" column="INCC_PTNT_YN"/>
		<result property="rqprTlnoCtn" column="RQPR_TLNO_CTN"/>
		<result property="rqprNm" column="RQPR_NM"/>
		<result property="rqstInprId" column="RQST_INPR_ID"/>
		<result property="rqstInprNm" column="RQST_INPR_NM"/>
		<result property="rqstInptDt" column="RQST_INPT_DT"/>
		<result property="dethYmd" column="DETH_YMD"/>
		<result property="dethYmdRgsrId" column="DETH_YMD_RGSR_ID"/>
		<result property="prtsRsrn" column="PRTS_RSRN"/>
		<result property="prtsNm" column="PRTS_NM"/>
		<result property="inifAgrmYn" column="INIF_AGRM_YN"/>
		<result property="snstInfmAgrmYn" column="SNST_INFM_AGRM_YN"/>
		<result property="uniqIdntInfmAgrmYn" column="UNIQ_IDNT_INFM_AGRM_YN"/>
		<result property="inifAgrmRgstSystNm" column="INIF_AGRM_RGST_SYST_NM"/>
		<result property="inifAgrmSgntYn" column="INIF_AGRM_SGNT_YN"/>
		<result property="scryYn" column="SCRY_YN"/>
		<result property="insrQlfcExclYn" column="INSR_QLFC_EXCL_YN"/>
		<result property="emailId" column="EMAIL_ID"/>
		<result property="emailDmanNm" column="EMAIL_DMAN_NM"/>
		<result property="cashRcptUseNo" column="CASH_RCPT_USE_NO"/>
		<result property="ovrsRsdtYn" column="OVRS_RSDT_YN"/>
		<result property="rmrkCtn" column="RMRK_CTN"/>
		<result property="lastUpdrNm" column="LAST_UPDR_NM"/>
		<result property="lastUpdrId" column="LAST_UPDR_ID"/>
		<result property="lastUpdtDt" column="LAST_UPDT_DT"/>
		<result property="ssn" column="SSN"/>
		<result property="frgnRgstNo" column="FRGN_RGST_NO"/>
		<result property="frgnIdntCd" column="FRGN_IDNT_CD"/>
		<result property="vipYn" column="VIP_YN"/>
		<result property="vipCtn" column="VIP_CTN"/>
		<result property="realBtdt" column="REAL_BTDT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneRandomPtnt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
		resultMap : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneRandomPtnt-result
    -->
	<select id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneRandomPtnt"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  resultMap="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneRandomPtnt-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-selectOneRandomPtnt */
				   a.PTNO as PTNO 
				,  a.PTNT_NM as PTNT_NM
				,  a.PTNT_ALIS_NM as PTNT_ALIS_NM
				,  a.PTNT_ENSN_LSNM as PTNT_ENSN_LSNM
				,  a.PTNT_ENSN_NM as PTNT_ENSN_NM
				,  a.FRRN as FRRN
				,  a.BRRN as BRRN
				,  a.BSOV_AFTR_PTNO as BSOV_AFTR_PTNO
		        ,  fn_ap_age_s(a.PTNO, sysdate) as AGE_VL
				,  a.BSRN as BSRN
				,  to_char(a.BTDT, 'yyyymmddhh24miss') as BTDT
				,  a.GEND_CD as GEND_CD
				,  a.NTNL_CD as NTNL_CD
				,  a.PSPT_NO as PSPT_NO
				,  a.PTNT_INFW_PATH_CD as PTNT_INFW_PATH_CD
		        ,  (   select  PTNT_CTRL_NM
		                 from  APCTRLMMT
		                where  PTNT_CTRL_CD       = 'AP412'
		                  and  PTNT_DTLS_CTRL_CD  =   a.PTNT_INFW_PATH_CD
		           ) as PTNT_INFW_PATH_NM 
				,  a.INCC_PTNT_YN as INCC_PTNT_YN
				,  a.RQPR_TLNO_CTN as RQPR_TLNO_CTN
				,  a.RQPR_NM as RQPR_NM
				,  a.RQST_INPR_ID as RQST_INPR_ID
				,  (select b.USER_NM
					  from CCUSRDPHT b
					 where b.USER_ID = a.RQST_INPR_ID) as RQST_INPR_NM
				,  to_char(a.RQST_INPT_DT, 'yyyymmddhh24miss') as RQST_INPT_DT
				,  to_char(a.DETH_YMD, 'yyyymmddhh24miss') as DETH_YMD
				,  a.DETH_YMD_RGSR_ID as DETH_YMD_RGSR_ID
				,  a.PRTS_RSRN as PRTS_RSRN
				,  a.PRTS_NM as PRTS_NM
				,  a.INIF_AGRM_YN
				,  a.SNST_INFM_AGRM_YN
				,  a.UNIQ_IDNT_INFM_AGRM_YN
				,  a.INIF_AGRM_RGST_SYST_NM as INIF_AGRM_RGST_SYST_NM
				,  a.INIF_AGRM_SGNT_YN
				,  a.SCRY_YN
				,  a.INSR_QLFC_EXCL_YN
				,  a.EMAIL_ID as EMAIL_ID
				,  a.EMAIL_DMAN_NM as EMAIL_DMAN_NM
				,  a.CASH_RCPT_USE_NO as CASH_RCPT_USE_NO
				,  a.OVRS_RSDT_YN as OVRS_RSDT_YN
				,  a.RMRK_CTN as RMRK_CTN
				,  (select b.USER_NM
						 from CCUSRDPHT b
						where b.USER_ID = a.LAST_UPDR_ID) as LAST_UPDR_NM
				,  a.LAST_UPDR_ID as LAST_UPDR_ID		       
		        ,  to_char(a.LAST_UPDT_DT,'yyyymmddhh24miss') as LAST_UPDT_DT
				,  a.SSN as SSN
				,  a.FRGN_RGST_NO as FRGN_RGST_NO
				,  a.FRGN_IDNT_CD as FRGN_IDNT_CD
		        ,  a.VIP_YN as VIP_YN
		        ,  a.VIP_CTN as VIP_CTN
		        ,  to_char(a.REAL_BTDT, 'yyyymmddhh24miss') as REAL_BTDT
			 from  APPTPTNTT a
			where  rownum = 1
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updatePtntBsifMdreCtn (환자기본정보변경사유 등록) 
        Description :                                           환자기본이력 - 환자기본정보변경사유 등록
                                            
		parameterType : com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO
    -->	
	<update id="com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updatePtntBsifMdreCtn"  parameterType="com.sds.healthcare.ehr.adm.ap.apb.vo.ApbPtntComnDVO"  >
		update /*SQL_ID: com-sds-healthcare-ehr-adm-ap-apb-dao-ApbPtntComnDAO-updatePtntBsifMdreCtn */
		       APPTPTNHT
		   set PTNT_BSIF_MDRE_CTN = #{ptntBsifMdreCtn}
			,  LAST_UPDR_ID = #{gvUserId}
			,  LAST_UPDT_IP = #{gvUserIp}
			,  LAST_UPDT_DT = sysdate
			,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
			,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}   
		 where (MDFC_DT, PTNO) = (select MDFC_DT, PTNO
		                            from (                             
		                                  select MDFC_DT, PTNO
		                                    from APPTPTNHT 
		                                   where PTNO = #{ptno}
		                                     and MDFC_DT between sysdate - .1 and sysdate  /* 성능 개선을 위해 조건 추가함. 환자기본정보 변경 후 바로 호출될것이기에..*/
		                                   order by MDFC_DT desc                      
		                                 )
		                           where rownum = 1
		                           )
	</update>

</mapper>