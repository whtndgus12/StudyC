<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_CcoTbprmmtTstermtDAO_sql.xml 
    Description : -->
<mapper namespace="CcoTbprmmtTstermtDAO">


	<resultMap id="com-sds-healthcare-ehr-com-cc-cco-dao-CcoTbprmmtTstermtDAO-listTstermt01-result" type="com.sds.healthcare.ehr.com.cc.cco.vo.CcoTbprmmtTstermtDVO">
	
		<result property="afiSrchNm" column="AFI_SRCH_NM"/>
		<result property="afiLvelVl" column="AFI_LVEL_VL"/>
		<result property="prgmId" column="PRGM_ID"/>
		<result property="prgmNm" column="PRGM_NM"/>
		<result property="fnctId" column="FNCT_ID"/>
		<result property="afiRturVl" column="AFI_RTUR_VL"/>
		<result property="fnctNm" column="FNCT_NM"/>
		<result property="fnctDetlCtn" column="FNCT_DETL_CTN"/>
		<result property="detlCdNm" column="DETL_CD_NM"/>
		<result property="testStepCd" column="TEST_STEP_CD"/>
		<result property="detlCdNm1" column="DETL_CD_NM_1"/>
		<result property="testAsgnId" column="TEST_ASGN_ID"/>
		<result property="testId" column="TEST_ID"/>
		<result property="fultId" column="FULT_ID"/>
		<result property="detlCdNm2" column="DETL_CD_NM_2"/>
		<result property="devpAsgnId" column="DEVP_ASGN_ID"/>
		<result property="userNm" column="USER_NM"/>
		<result property="clsnYnCd" column="CLSN_YN_CD"/>
		<result property="testPsblTrgtYn" column="TEST_PSBL_TRGT_YN"/>
		<result property="detlCdNm3" column="DETL_CD_NM_3"/>
		<result property="fultCrntSttsCd" column="FULT_CRNT_STTS_CD"/>
		<result property="afiRturVl1" column="AFI_RTUR_VL_1"/>
		<result property="afiRturVl2" column="AFI_RTUR_VL_2"/>
		<result property="atchResnCtn" column="ATCH_RESN_CTN"/>
		<result property="rmrkCtn" column="RMRK_CTN"/>
		<result property="fultPrsgSttsCd" column="FULT_PRSG_STTS_CD"/>
		<result property="detlCdNm5" column="DETL_CD_NM_5"/>
		<result property="fultTypeCd" column="FULT_TYPE_CD"/>
		<result property="fultDscrCtn" column="FULT_DSCR_CTN"/>
		<result property="mngpId" column="MNGP_ID"/>
		<result property="userNm1" column="USER_NM_1"/>
		<result property="planStrtYmd" column="PLAN_STRT_YMD"/>
		<result property="planFnshYmd" column="PLAN_FNSH_YMD"/>
		<result property="acrlStrtYmd" column="ACRL_STRT_YMD"/>
		<result property="acrlFnshYmd" column="ACRL_FNSH_YMD"/>
		<result property="atchId" column="ATCH_ID"/>
		<result property="rgsrId" column="RGSR_ID"/>
		<result property="userNm2" column="USER_NM_2"/>
		<result property="rgstYmd" column="RGST_YMD"/>
		<result property="acwrCnfrFinsDd" column="ACWR_CNFR_FINS_DD"/>
		<result property="mngrRevwFinsDt" column="MNGR_REVW_FINS_DT"/>
		<result property="rjctYmd" column="RJCT_YMD"/>
		<result property="reMngnRqstDt" column="RE_MNGN_RQST_DT"/>
		<result property="mdfcHxCtn" column="MDFC_HX_CTN"/>
		<result property="fultMngnNtm" column="FULT_MNGN_NTM"/>
		<result property="wgCd" column="WG_CD"/>
		<result property="detlCdNm4" column="DETL_CD_NM_4"/>
		<result property="detlCdNm6" column="DETL_CD_NM_6"/>
		<result property="detlCdNm7" column="DETL_CD_NM_7"/>
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
		<result property="intgTestRfrcYn" column="INTG_TEST_RFRC_YN"/>
		<result property="testDt" column="TEST_DT"/>
		<result property="testRsltCd" column="TEST_RSLT_CD"/>
		<result property="prncYn" column="PRNC_YN"/>
		<result property="reRevwRqstYmd" column="RE_REVW_RQST_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-com-cc-cco-dao-CcoTbprmmtTstermtDAO-listTstermt01 (결함목록 조회) 
        Description :                                           cod_tstermt_l01 결함목록 조회
                                            
		parameterType : com.sds.healthcare.ehr.com.cc.cco.vo.CcoTbprmmtTstermtDVO
		resultMap : com-sds-healthcare-ehr-com-cc-cco-dao-CcoTbprmmtTstermtDAO-listTstermt01-result
    -->
	<select id="com-sds-healthcare-ehr-com-cc-cco-dao-CcoTbprmmtTstermtDAO-listTstermt01"  parameterType="com.sds.healthcare.ehr.com.cc.cco.vo.CcoTbprmmtTstermtDVO"  resultMap="com-sds-healthcare-ehr-com-cc-cco-dao-CcoTbprmmtTstermtDAO-listTstermt01-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-com-cc-cco-dao-CcoTbprmmtTstermtDAO-listTstermt01 */
		<![CDATA[
		    select  /*+ cod_tstermt_l01$S01_[비대상]결함목록 조회 */ 
		              ta.AFI_SRCH_NM
		            , ta.AFI_LVEL_VL
		            , ta.PRGM_ID
		            , ta.PRGM_NM
		            , ta.FNCT_ID
		            , ta.AFI_RTUR_VL
		            , ta.FNCT_NM
		            , ta.FNCT_DETL_CTN
		            , ta.DETL_CD_NM
		            , ta.TEST_STEP_CD
		            , ta.DETL_CD_NM_1
		            , ta.TEST_ASGN_ID
		            , ta.TEST_ID
		            , ta.FULT_ID
		            , ta.DETL_CD_NM_2
		            , ta.DEVP_ASGN_ID
		            , ta.USER_NM
		            , ta.CLSN_YN_CD
		            , ta.TEST_PSBL_TRGT_YN
		            , ta.DETL_CD_NM_3
		            , ta.FULT_CRNT_STTS_CD
		            , ta.AFI_RTUR_VL_1
		            , ta.AFI_RTUR_VL_2
		            , ta.ATCH_RESN_CTN
		            , ta.RMRK_CTN
		            , ta.FULT_PRSG_STTS_CD
		            , ta.DETL_CD_NM_5
		            , ta.FULT_TYPE_CD
		            , ta.FULT_DSCR_CTN
		            , ta.MNGP_ID
		            , ta.USER_NM_1
		            , ta.PLAN_STRT_YMD
		            , ta.PLAN_FNSH_YMD
		            , ta.ACRL_STRT_YMD
		            , ta.ACRL_FNSH_YMD
		            , ta.ATCH_ID
		            , ta.RGSR_ID
		            , ta.USER_NM_2
		            , ta.RGST_YMD
		            , ta.ACWR_CNFR_FINS_DD
		            , ta.MNGR_REVW_FINS_DT
		            , ta.RJCT_YMD
		            , ta.RE_MNGN_RQST_DT
		            , ta.MDFC_HX_CTN
		            , ta.FULT_MNGN_NTM
		            , ta.WG_CD
		            , ta.DETL_CD_NM_4
		            , ta.DETL_CD_NM_6
		            , ta.DETL_CD_NM_7
		            , ta.FRST_RGST_DT
		            , ta.INTG_TEST_RFRC_YN
		            , ta.TEST_DT
		            , ta.TEST_RSLT_CD
		            , nvl(ta.PRNC_YN, 'N') as PRNC_YN
		            , ta.RE_REVW_RQST_YMD
		    from     (  select    a.PRGM_ID || a.TEST_STEP_CD || a.TEST_ASGN_ID || a.TEST_ID || c.FULT_ID as AFI_SRCH_NM
		                        , '0' as AFI_LVEL_VL
		                        , a.PRGM_ID
		                        , f.PRGM_NM
		                        , d.FNCT_ID
		                        , a.PRGM_ID || '_' || d.FNCT_ID as AFI_RTUR_VL
		                        , d.FNCT_NM
		                        , d.FNCT_DETL_CTN
		                        , g.DETL_CD_NM
		                        , a.TEST_STEP_CD
		                        , b.DETL_CD_NM as DETL_CD_NM_1
		                        , a.TEST_ASGN_ID
		                        , a.TEST_ID
		                        , c.FULT_ID
		                        , e.DETL_CD_NM as DETL_CD_NM_2
		                        , d.DEVP_ASGN_ID
		                        , h.USER_NM
		                        , nvl(i.CLSN_YN_CD, '01') as CLSN_YN_CD
		                        , nvl(j.TEST_PSBL_TRGT_YN, '1') as TEST_PSBL_TRGT_YN
		                        , k.DETL_CD_NM as DETL_CD_NM_3
		                        , c.FULT_CRNT_STTS_CD
		                        , case when a.TEST_RSLT_CD = 'T1' then '성공'
		                               when a.TEST_RSLT_CD = 'T2' then decode(c.FULT_CRNT_STTS_CD, 'A1', decode(c.FULT_PRSG_STTS_CD, '6', '개발팀 확인중', '실패')
		                                                                                         , 'A9', '협의필요', '개발팀 확인중')
		                               when a.TEST_RSLT_CD = 'T3' then '비대상'
		                          else ''
		                          end as AFI_RTUR_VL_1 --"최종판정"
		                        , case when EXISTS( select  FILE_ID
		                                            from    COSCFNADT
		                                            where   PRGM_ID = c.PRGM_ID
		                                              and   ATCH_ID = c.ATCH_ID
		                                              and   ATCH_DVSN_CD = 'A4'
		                                          )
		                               then 'Y'
		                               else 'N'
		                          end as AFI_RTUR_VL_2  --"결함여부"
		                        , ( select  ATCH_RESN_CTN
		                            from    COSCFNAMT
		                            where   PRGM_ID      = c.PRGM_ID
		                              and   ATCH_ID      = c.ATCH_ID
		                              and   ATCH_DVSN_CD = 'A4'
		                          ) as ATCH_RESN_CTN     --"결함설명"
		                        , a.RMRK_CTN as RMRK_CTN --"공유내용"
		                        , c.FULT_PRSG_STTS_CD
		                        , nvl(q.DETL_CD_NM, '결함여부판단중') as DETL_CD_NM_5
		                        , c.FULT_TYPE_CD
		                        , c.FULT_DSCR_CTN
		                        , c.MNGP_ID
		                        , m.USER_NM as USER_NM_1
		                        , to_char(c.PLAN_STRT_YMD, 'YYYYMMDD') as PLAN_STRT_YMD
		                        , to_char(c.PLAN_FNSH_YMD, 'YYYYMMDD') as PLAN_FNSH_YMD
		                        , to_char(c.ACRL_STRT_YMD, 'YYYYMMDD') as ACRL_STRT_YMD
		                        , to_char(c.ACRL_FNSH_YMD, 'YYYYMMDD') as ACRL_FNSH_YMD
		                        , c.ATCH_ID
		                        , c.TEST_ASGN_ID as RGSR_ID
		                        , n.USER_NM as USER_NM_2
		                        , to_char(c.RGST_YMD, 'YYYYMMDD') as RGST_YMD
		                        , to_char(c.ACWR_CNFR_FINS_DD, 'YYYYMMDD') as ACWR_CNFR_FINS_DD
		                        , to_char(c.MNGR_REVW_FINS_DT, 'YYYYMMDD') as MNGR_REVW_FINS_DT
		                        , to_char(c.RJCT_YMD, 'YYYYMMDD') as RJCT_YMD
		                        , to_char(c.RE_MNGN_RQST_DT, 'YYYYMMDD') as RE_MNGN_RQST_DT
		                        , c.MDFC_HX_CTN
		                        , c.FULT_MNGN_NTM
		                        , f.WG_CD
		                        , p.DETL_CD_NM as DETL_CD_NM_4
		                        , decode(nvl(i.CLSN_YN_CD, '01'), '02', 'Y', '') as DETL_CD_NM_6
		                        , decode(nvl(j.TEST_PSBL_TRGT_YN, '1'), '2', 'Y', '') as DETL_CD_NM_7
		                        , to_char(c.FRST_RGST_DT, 'YYYYMMDD') as FRST_RGST_DT
		                        , a.INTG_TEST_RFRC_YN
		                        , to_char(a.TEST_DT, 'YYYYMMDD') as TEST_DT
		                        , a.TEST_RSLT_CD
		                        , f.PRNC_YN
		                        , to_char(c.RE_REVW_RQST_YMD, 'YYYYMMDD') as RE_REVW_RQST_YMD
		                 from     COTSTERMT a   -- 단위 테스트 관리
		                        , COMTESTMT j
		                        , COMTESTDT i
		                        , COTSTERDT c   -- TO-BE 프로그램 단위테스트 결함관리정보
		                        , COTBPRMMT f
		                        , COTBPRMDT d
		                        , CCCMCDDMT b
		                        , CCCMCDDMT e
		                        , CCCMCDDMT g
		                        , CCUSRDPHT h
		                        , CCCMCDDMT k
		                        , CCUSRDPHT m
		                        , CCUSRDPHT n
		                        , CCCMCDDMT p
		                        , CCCMCDDMT q
		                 where    nvl(a.DLTN_YN, 'N') <> 'Y'
		                   and    not ((nvl(a.TEST_RSLT_CD, 'T0') = 'T1') and (nvl(c.FULT_PRSG_STTS_CD, '0') = '7' ))
		                   and    not ((nvl(a.TEST_RSLT_CD, 'T0') = 'T3') and (nvl(c.FULT_PRSG_STTS_CD, '0') = '7' ))
		                   and    a.PRGM_ID        = j.PRGM_ID
		                   and    a.TEST_STEP_CD   = j.TEST_STEP_CD
		                   and    nvl(j.DLTN_YN, 'N') <> 'Y'
		                   and    a.PRGM_ID        = i.PRGM_ID
		                   and    a.TEST_STEP_CD   = i.TEST_STEP_CD
		                   and    a.TEST_ASGN_ID   = i.TEST_ASGN_ID
		                   and    nvl(i.DLTN_YN, 'N') <> 'Y'
		                   and    a.PRGM_ID        = c.PRGM_ID
		                   and    a.TEST_STEP_CD   = c.TEST_STEP_CD
		                   and    a.TEST_ASGN_ID   = c.TEST_ASGN_ID
		                   and    a.TEST_ID        = c.TEST_ID
		                   and    nvl(c.DLTN_YN, 'N') <> 'Y'
		                   and    a.PRGM_ID        = f.PRGM_ID
		                   and    nvl(f.DLTN_YN, 'N') <> 'Y'
		                   and    a.PRGM_ID        = d.PRGM_ID(+)
		                   and    a.FNCT_ID        = d.FNCT_ID(+)
		                   and    b.COMN_GRP_CD(+) = 'COR_009'
		                   and    a.TEST_STEP_CD   = b.COMN_DTLS_CD(+)
		                   and    e.COMN_GRP_CD(+) = 'COR_025'
		                   and    d.PRJT_TISS_CD   = e.COMN_DTLS_CD(+)
		                   and    g.COMN_GRP_CD(+) = 'COR_002'
		                   and    d.PROR_BASE_CD   = g.COMN_DTLS_CD(+)
		                   and    d.DEVP_ASGN_ID   = h.USER_ID(+)
		                   and    k.COMN_GRP_CD(+) = 'COR_008'
		                   and    a.TEST_RSLT_CD   = k.COMN_DTLS_CD(+)
		                   and    c.MNGP_ID        = m.USER_ID(+)
		                   and    c.TEST_ASGN_ID   = n.USER_ID(+)
		                   and    p.COMN_GRP_CD(+) = 'COR_014'
		                   and    f.WG_CD          = p.COMN_DTLS_CD(+)
		                   and    q.COMN_GRP_CD(+) = 'COR_030'
		                   and    c.FULT_PRSG_STTS_CD = q.COMN_DTLS_CD(+)
		                   and    ((nvl( #{chrcCdVl3} ,'*') = '*') or ( #{chrcCdVl3}  like '%' || c.TEST_STEP_CD || '%'))
		                   and    ((nvl( #{chrcCdVl} ,'*') = '*') or ( #{chrcCdVl}  like '%' || f.PRJT_TISS_CD || '%'))
		                   and    ((nvl( #{mngpId} ,'*') = '*') or (c.MNGP_ID =  #{mngpId} ))
		                   and    ((nvl( #{testAsgnId} ,'*') = '*') or (c.TEST_ASGN_ID =  #{testAsgnId} ))
		                   and    ((nvl( #{devpAsgnId} ,'*') = '*') or (d.DEVP_ASGN_ID =  #{devpAsgnId} ))
		                   and    ((nvl( #{chrcCdVl1} ,'*') = '*') or ( #{chrcCdVl1}  like '%' || nvl(c.FULT_PRSG_STTS_CD, '0') || '%'))
		                   and    ((nvl( #{afiSrchDvsnVl} , '*') = '*') or
		                           ((nvl( #{afiSrchDvsnVl} , '*') = 'S') and (nvl(f.PRNC_YN, 'N') = 'S')) or
		                           ((nvl( #{afiSrchDvsnVl} , '*') = 'M') and (nvl(f.PRNC_YN, 'N') in ('S', 'M'))) or
		                           ((nvl( #{afiSrchDvsnVl} , '*') = 'F') and (nvl(f.PROR_BASE_CD, 'N') = 'L1'))
		                          )
		             ) ta
		    order by ta.FULT_PRSG_STTS_CD
		]]>
	</select>



</mapper>