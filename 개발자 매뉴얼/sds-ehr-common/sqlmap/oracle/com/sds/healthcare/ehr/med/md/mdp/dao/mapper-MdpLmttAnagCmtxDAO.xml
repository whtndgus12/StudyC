<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_MdpLmttAnagCmtxDAO_sql.xml 
    Description :                                      제한항균제 협진관리DAO
                  -->
<mapper namespace="MdpLmttAnagCmtxDAO">




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-insertLmttAnagCmtx (제한항균제 협진 입력) 
        Description :                                           제한항균제 협진 입력
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-insertLmttAnagCmtx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-insertLmttAnagCmtx */
		insert  /* 제한항균제 협진의뢰 */
		  into  MDANTBRIT
		        (
		        PTNO /* 환자번호 */
		     ,  ORDR_YMD /* 처방일자 */
		     ,  ORDR_SNO /* 처방순번 */
		     ,  MDRP_NO /* 진료접수번호 */
		     ,  CMTX_WNTD_YMD /* 협진희망일자 */
		     ,  ANAG_ORDR_CD  /* 항균제처방코드 */
		     ,  REFR_RESN_CD
		     ,  USE_OBJC_CD
		     ,  ORGL_DISS_DX_NM
		     ,  INFC_DX_CD /* 감염진단코드 */
		     ,  INFC_DX_NM /* 감염진단명 */
		     ,  CSBC_CD1
		     ,  CSBC_ETC_CTN1
		     ,  CSBC_LTST_CLTR_YMD1
		     ,  CSBC_CD2
		     ,  CSBC_ETC_CTN2
		     ,  CSBC_LTST_CLTR_YMD2
		     ,  CNFR_DVSN_CD /* 확인구분코드 */
		     ,  LMTT_ANAG_VALD_YMD /* 제한항균제유효일자 */
			 , UDDS_CTN /*기저질환내용 */
			 , INDS_CTN /*감염증내용 */
			 , CSBC_NM_CNFR_YN /*원인균명확인여부 */
			 , CSBC_NM /*원인균명 */
			 , ORRE_CTN /*처방사유내용 */
			 , CSBC_SPTN_SPCM_NM /*원인균분리검체명 */
			 , ORRE_YN1 /*처방사유여부1 */
			 , ORRE_YN2 /*처방사유여부2 */
			 , ORRE_YN3 /*처방사유여부3 */
			 , ORRE_YN31 /*처방사유여부31 */
			 , ORRE_YN32 /*처방사유여부32 */
			 , ORRE_YN33 /*처방사유여부33 */
			 , ORRE_YN34 /*처방사유여부34 */
			 , ORRE_YN35 /*처방사유여부35 */
			 , ORRE_YN36 /*처방사유여부36 */
			 , ORRE36_CTN /*처방사유36내용 */
			 , ORRE_YN4 /*처방사유여부4 */
			 , ORRE_YN5 /*처방사유여부5 */
			 , ORRE_YN6 /*처방사유여부6 */
			 , OPRT_RLTD_PTSS_YN1                   /* 수술관련환자상태여부1   */
			 , OPRT_RLTD_PTSS_YN2                   /* 수술관련환자상태여부2   */
			 , OPRT_RLTD_PTSS_YN3                   /* 수술관련환자상태여부3   */
			 , OPBE_INFC_RESN_CD1                   /* 수술이전감염사유코드1   */
			 , OPBE_INFC_RESN_YN2                   /* 수술이전감염사유여부2   */
			 , ADMS_IPRG_ENFR_OPRT_YN1              /* 입원중시행수술여부1   */
			 , ADMS_IPRG_ENFR_OPRT_YN2              /* 입원중시행수술여부2   */
			 , ANTB_ALRG_YN1                        /* 항생제알러지여부1   */
			 , TRNF_YN1                             /* 수혈여부1   */
			 , OPAF_INFC_RESN_CD1                   /* 수술이후감염사유코드1   */
			 , OPAF_INFC_RESN_YN2                   /* 수술이후감염사유여부2   */
			 , OPAF_INFC_RESN_YN3                   /* 수술이후감염사유여부3   */
			 , OPAF_INFC_RESN_CD4                   /* 수술이후감염사유코드4   */
			 , OPAF_INFC_RESN_YN5                   /* 수술이후감염사유여부5   */
			 , OPRT_PRVN_REFR_YN /*수술예방의뢰여부 */
			 , VCMCN_YN /*반코마이신여부 */
			 , OPRT_YMD /*수술일자 */
			 , ORDR_DT /*처방일시 */
		     , FRST_RGSR_ID
		     , FRST_RGST_IP
		     , FRST_RGST_DT
		     , FRST_RGST_CLNT_PRGM_ID
		     , FRST_RGST_SRVR_PRGM_ID
		     , LAST_UPDR_ID
		     , LAST_UPDT_IP
		     , LAST_UPDT_DT
		     , LAST_UPDT_CLNT_PRGM_ID
		     , LAST_UPDT_SRVR_PRGM_ID
		        )
		values  (
		        #{ptno}
		     ,  to_date(#{ordrYmd}, 'YYYYMMDD')
		     ,  #{ordrSno}
		     ,  #{mdrpNo}
		     ,  to_date(#{cmtxWntdYmd}, 'YYYYMMDD')
		     ,  #{anagOrdrCd}
		     ,  #{refrResnCd}
		     ,  #{useObjcCd}
		     ,  #{orglDissDxNm}
		     ,  #{infcDxCd}
		     ,  #{infcDxNm}
		     ,  #{csbcCd1}
		     ,  #{csbcEtcCtn1}
		     ,  to_date(#{csbcLtstCltrYmd1}, 'YYYYMMDD')
		     ,  #{csbcCd2}
		     ,  #{csbcEtcCtn2}
		     ,  to_date(#{csbcLtstCltrYmd2}, 'YYYYMMDD')
		     ,  #{cnfrDvsnCd}
		     ,  to_date(#{lmttAnagValdYmd}, 'YYYYMMDD')
			 , #{uddsCtn} /*기저질환내용 */
			 , #{indsCtn} /*감염증내용 */
			 , #{csbcNmCnfrYn} /*원인균명확인여부 */
			 , #{csbcNm} /*원인균명 */
			 , #{orreCtn} /*처방사유내용 */
			 , #{csbcSptnSpcmNm} /*원인균분리검체명 */
			 , #{orreYn1} /* 처방사유여부1 */
			 , #{orreYn2} /* 처방사유여부2 */
			 , #{orreYn3} /* 처방사유여부3 */
			 , #{orreYn31} /* 처방사유여부31 */
			 , #{orreYn32} /* 처방사유여부32 */
			 , #{orreYn33} /* 처방사유여부33 */
			 , #{orreYn34} /*처방사유여부34 */
			 , #{orreYn35} /*처방사유여부35 */
			 , #{orreYn36} /*처방사유여부36 */
			 , #{orre36Ctn} /*처방사유36내용 */
			 , #{orreYn4} /* 처방사유여부4 */
			 , #{orreYn5} /* 처방사유여부5 */
			 , #{orreYn6} /* 처방사유여부6 */
		     , #{oprtRltdPtssYn1} /* 수술관련환자상태여부1   */	
		     , #{oprtRltdPtssYn2} /* 수술관련환자상태여부2   */	
		     , #{oprtRltdPtssYn3} /* 수술관련환자상태여부3   */	
		     , #{opbeInfcResnCd1} /* 수술이전감염사유코드1   */	
		     , #{opbeInfcResnYn2} /* 수술이전감염사유여부2   */
		     , #{admsIprgEnfrOprtYn1} /* 입원중시행수술여부1   */	
		     , #{admsIprgEnfrOprtYn2} /* 입원중시행수술여부2   */	
		     , #{antbAlrgYn1} /* 항생제알러지여부1   */	 
		     , #{trnfYn1}	 /* 수혈여부1   */
		     , #{opafInfcResnCd1} /* 수술이후감염사유코드1   */	
		     , #{opafInfcResnYn2} /* 수술이후감염사유여부2   */	
		     , #{opafInfcResnYn3} /* 수술이후감염사유여부3   */	
		     , #{opafInfcResnCd4} /* 수술이후감염사유코드4   */	
		     , #{opafInfcResnYn5} /* 수술이후감염사유여부5   */
			 , #{oprtPrvnRefrYn} /* 수술예방의뢰여부 */
			 , #{vcmcnYn} /* 반코마이신여부 */
			 , to_date(#{oprtYmd},'yyyymmdd') /* 수술일자 */
			 , sysdate /*처방일시 */	
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		        )
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-updateLmttAnagCmtx (제한항균제 협진 수정) 
        Description :                                           제한항균제 협진 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-updateLmttAnagCmtx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-updateLmttAnagCmtx */
		update  /* 제한항균제 협진의뢰 삭제 */
		        MDANTBRIT a
		   set  LAST_UPDR_ID            =   #{gvUserId}
		     ,  LAST_UPDT_IP            =   #{gvUserIp}
		     ,  LAST_UPDT_DT            =   sysdate
		     ,  LAST_UPDT_CLNT_PRGM_ID  =   #{gvClntPrgmId}
		     ,  LAST_UPDT_SRVR_PRGM_ID  =   #{gvSrvrPrgmId}
		 <if test="refrResnCd != null">
		     ,  REFR_RESN_CD            =   #{refrResnCd}
		 </if>
		 <if test="useObjcCd != null">
		     ,  USE_OBJC_CD             =   #{useObjcCd}
		 </if>
		 <if test="orglDissDxNm != null">
		     ,  ORGL_DISS_DX_NM         =   #{orglDissDxNm}
		 </if>
		 <if test="csbcCd1 != null">
		     ,  CSBC_CD1                =   #{csbcCd1}
		 </if>
		 <if test="csbcEtcCtn1 != null">
		     ,  CSBC_ETC_CTN1           =   #{csbcEtcCtn1}
		 </if>
		 <if test="csbcLtstCltrYmd1 != null">
		     ,  CSBC_LTST_CLTR_YMD1     =   to_date(#{csbcLtstCltrYmd1}, 'YYYYMMDD')
		 </if>
		 <if test="csbcCd2 != null">
		     ,  CSBC_CD2                =   #{csbcCd2}
		 </if>
		 <if test="csbcEtcCtn2 != null">
		     ,  CSBC_ETC_CTN2           =   #{csbcEtcCtn2}
		 </if>
		 <if test="cnfrDvsnCd != null">
		     ,  CNFR_DVSN_CD            =   #{cnfrDvsnCd}                               -- 확인구분코드
		 </if>
		 <if test="lmttAnagValdYmd != null">
		     ,  LMTT_ANAG_VALD_YMD      =   to_date(#{lmttAnagValdYmd}, 'YYYYMMDD')     -- 제한항균제유효일자
		 </if>
		 <if test="cnfrDvsnCd == null">
		     , INFC_DX_NM = #{infcDxNm} /* 감염진단명 */
			 , UDDS_CTN = #{uddsCtn} /*기저질환내용 */
			 , INDS_CTN = #{indsCtn} /*감염증내용 */
			 , CSBC_NM_CNFR_YN = #{csbcNmCnfrYn} /*원인균명확인여부 */
			 , CSBC_NM = #{csbcNm} /*원인균명 */
			 , ORRE_CTN = #{orreCtn} /*처방사유내용 */
			 , CSBC_SPTN_SPCM_NM = #{csbcSptnSpcmNm} /*원인균분리검체명 */
			 , ORRE_YN1 = #{orreYn1} /*처방사유여부1 */
			 , ORRE_YN2 = #{orreYn2}  /*처방사유여부2 */
			 , ORRE_YN3 = #{orreYn3}  /*처방사유여부3 */
			 , ORRE_YN31 = #{orreYn31} /*처방사유여부31 */
			 , ORRE_YN32 = #{orreYn32} /*처방사유여부32 */
			 , ORRE_YN33 = #{orreYn33} /*처방사유여부33 */
			 , ORRE_YN34 = #{orreYn34} /*처방사유여부34 */
			 , ORRE_YN35 = #{orreYn35} /*처방사유여부35 */
			 , ORRE_YN36 = #{orreYn36} /*처방사유여부36 */
			 , ORRE36_CTN = #{orre36Ctn} /*처방사유36내용 */
			 , ORRE_YN4 = #{orreYn4} /*처방사유여부4 */
			 , ORRE_YN5 = #{orreYn5} /*처방사유여부5 */
			 , ORRE_YN6 = #{orreYn6} /*처방사유여부6 */
			 , OPRT_RLTD_PTSS_YN1 = #{oprtRltdPtssYn1} /* 수술관련환자상태여부1   */
			 , OPRT_RLTD_PTSS_YN2 = #{oprtRltdPtssYn2} /* 수술관련환자상태여부2   */
			 , OPRT_RLTD_PTSS_YN3 = #{oprtRltdPtssYn3} /* 수술관련환자상태여부3   */
			 , OPBE_INFC_RESN_CD1 = #{opbeInfcResnCd1} /* 수술이전감염사유코드1   */
			 , OPBE_INFC_RESN_YN2 = #{opbeInfcResnYn2} /* 수술이전감염사유여부2   */
			 , ADMS_IPRG_ENFR_OPRT_YN1 = #{admsIprgEnfrOprtYn1} /* 입원중시행수술여부1   */
			 , ADMS_IPRG_ENFR_OPRT_YN2 = #{admsIprgEnfrOprtYn2} /* 입원중시행수술여부2   */
			 , ANTB_ALRG_YN1 = #{antbAlrgYn1} /* 항생제알러지여부1   */
			 , TRNF_YN1 = #{trnfYn1} /* 수혈여부1   */
			 , OPAF_INFC_RESN_CD1 = #{opafInfcResnCd1} /* 수술이후감염사유코드1   */
			 , OPAF_INFC_RESN_YN2 = #{opafInfcResnYn2} /* 수술이후감염사유여부2   */
			 , OPAF_INFC_RESN_YN3 = #{opafInfcResnYn3} /* 수술이후감염사유여부3   */
			 , OPAF_INFC_RESN_CD4 = #{opafInfcResnCd4} /* 수술이후감염사유코드4   */
			 , OPAF_INFC_RESN_YN5 = #{opafInfcResnYn5} /* 수술이후감염사유여부5   */
			 , ORDR_DT = sysdate /*처방일시 */
		 </if>
		 <if test="cnfrDvsnCd != null">
				, APVR_INDS_CTN = #{apvrIndsCtn}        /*승인자감염증내용 */
				, APVR_CSBC_NM_CNFR_YN = #{apvrCsbcNmCnfrYn} /*승인자원인균명확인여부 */
				, APVR_CSBC_NM         = #{apvrCsbcNm}         /*승인자원인균명 */
				, APVR_CSBC_SPTN_SPCM_NM = #{apvrCsbcSptnSpcmNm} /*승인자원인균분리검체명 */
				, APVR_ORRE_YN1 = #{apvrOrreYn1} /*승인자처방사유여부1 */
				, APVR_ORRE_YN2 = #{apvrOrreYn2} /*승인자처방사유여부2 */
				, APVR_ORRE_YN3 = #{apvrOrreYn3} /*승인자처방사유여부3 */
				, APVR_ORRE_YN31 = #{apvrOrreYn31} /*승인자처방사유여부31 */
				, APVR_ORRE_YN32 = #{apvrOrreYn32} /*승인자처방사유여부32 */
				, APVR_ORRE_YN33 = #{apvrOrreYn33} /*승인자처방사유여부33 */
				, APVR_ORRE_YN34 = #{apvrOrreYn34} /*승인자처방사유여부34 */
				, APVR_ORRE_YN35 = #{apvrOrreYn35} /*승인자처방사유여부35 */
				, APVR_ORRE_YN36 = #{apvrOrreYn36} /*승인자처방사유여부36 */
				, APVR_ORRE36_CTN = #{apvrOrre36Ctn} /*승인자처방사유36내용 */
				, APVR_ORRE_YN4 = #{apvrOrreYn4} /*승인자처방사유여부4 */
				, APVR_ORRE_YN5 = #{apvrOrreYn6} /*승인자처방사유여부5 */
				, APVR_ORRE_YN6 = #{apvrOrreYn6} /*승인자처방사유여부6 */
				, APRV_DSLW_RESN_YN1 = case when #{cnfrDvsnCd} = 'Y' then null
		                                                     when #{cnfrDvsnCd} = 'N' then #{aprvDslwResnYn1} 
		                                                     else APRV_DSLW_RESN_YN1 end /*승인불가사유여부1 */
				, APRV_DSLW_RESN_YN2 = case when #{cnfrDvsnCd} = 'Y' then null
		                                                     when #{cnfrDvsnCd} = 'N' then  #{aprvDslwResnYn2} 
		                                                     else APRV_DSLW_RESN_YN2 end /*승인불가사유여부2 */
				, APRV_DSLW_RESN_YN3 = case when #{cnfrDvsnCd} = 'Y' then null
		                                                     when #{cnfrDvsnCd} = 'N' then  #{aprvDslwResnYn3} 
		                                                     else APRV_DSLW_RESN_YN3 end /*승인불가사유여부3 */
				, APRV_DSLW_RESN_YN4 = case when #{cnfrDvsnCd} = 'Y' then null
		                                                     when #{cnfrDvsnCd} = 'N' then  #{aprvDslwResnYn4} 
		                                                     else APRV_DSLW_RESN_YN4 end /*승인불가사유여부4 */
				, APRV_DSLW_RESN_YN5 = case when #{cnfrDvsnCd} = 'Y' then null
		                                                     when #{cnfrDvsnCd} = 'N' then  #{aprvDslwResnYn5} 
		                                                     else APRV_DSLW_RESN_YN5 end /*승인불가사유여부5 */
				, APRV_DSLW_RESN_YN6 = case when #{cnfrDvsnCd} = 'Y' then null
		                                                     when #{cnfrDvsnCd} = 'N' then #{aprvDslwResnYn6} 
		                                                     else APRV_DSLW_RESN_YN6 end /*승인불가사유여부6 */
				, APRV_DSLW_RESN_YN7 = case when #{cnfrDvsnCd} = 'Y' then null
		                                                     when #{cnfrDvsnCd} = 'N' then #{aprvDslwResnYn7} 
		                                                     else APRV_DSLW_RESN_YN7 end /*승인불가사유여부7 */
				, APRV_ORRE_CTN = #{aprvOrreCtn} /* 승인처방사유내용  */
		        , APRV_OPRT_RLTD_PTSS_YN1		 = #{aprvOprtRltdPtssYn1}	   /* 승인수술관련환자상태여부1  */	
		        , APRV_OPRT_RLTD_PTSS_YN2		 = #{aprvOprtRltdPtssYn2}	   /* 승인수술관련환자상태여부2	*/	   
		        , APRV_OPRT_RLTD_PTSS_YN3		 = #{aprvOprtRltdPtssYn3}	   /* 승인수술관련환자상태여부3	*/	
		        , APRV_OPBE_INFC_RESN_CD1		 = #{aprvOpbeInfcResnCd1}	   /* 승인수술이전감염사유코드1	*/	
		        , APRV_OPBE_INFC_RESN_YN2		 = #{aprvOpbeInfcResnYn2}	   /* 승인수술이전감염사유여부2	*/	
		        , APRV_ADMS_IPRG_ENFR_OPRT_YN1	 = #{aprvAdmsIprgEnfrOprtYn1}   /* 승인입원중시행수술여부1		*/
		        , APRV_ADMS_IPRG_ENFR_OPRT_YN2	 = #{aprvAdmsIprgEnfrOprtYn2}   /* 승인입원중시행수술여부2		*/
		        , APRV_ANTB_ALRG_YN1			 = #{aprvAntbAlrgYn1}	       /* 승인항생제알러지여부1		*/
		        , APRV_TRNF_YN1	                 = #{aprvTrnfYn1}	           /* 승인수혈여부1		   */
		        , APRV_OPAF_INFC_RESN_CD1		 = #{aprvOpafInfcResnCd1}	   /* 승인수술이후감염사유코드1	*/	
		        , APRV_OPAF_INFC_RESN_YN2		 = #{aprvOpafInfcResnYn2}	   /* 승인수술이후감염사유여부2	*/	
		        , APRV_OPAF_INFC_RESN_YN3		 = #{aprvOpafInfcResnYn3}	   /* 승인수술이후감염사유여부3	*/	
		        , APRV_OPAF_INFC_RESN_CD4		 = #{aprvOpafInfcResnCd4}	   /* 승인수술이후감염사유코드4	*/	
		        , APRV_OPAF_INFC_RESN_YN5		 = #{aprvOpafInfcResnYn5}	   /* 승인수술이후감염사유여부5	*/
				, ENCR_ANTB_CTN = #{encrAntbCtn} /*권장항생제내용 */
				, USE_PERD_CTN = #{usePerdCtn} /*사용기간내용 */
				, DRVT_VLM_CTN = #{drvtVlmCtn} /*유도용량내용 */
				, KEEP_VLM_CTN = #{keepVlmCtn} /*유지용량내용 */
				, DRVT_VLM_APLY_YN = #{drvtVlmAplyYn} /* 유도용량적용여부 */
				, KEEP_VLM_APLY_YN = #{keepVlmAplyYn} /* 유지용량적용여부 */
				, APVR_ADVC_SBJC_CTN = #{apvrAdvcSbjcCtn} /*승인자권고사항내용 */	
				, APRV_MEA_TRGT_YN = #{aprvMeaRrgtYn} /*승인미대상여부 */
				, DFNT_YMD = to_date(#{fntYmd},'yyyymmdd') /*확정일자 */
				, DFNT_DR_ID = #{dfntDrId} /*확정의사id */
				, UNCF_ENFR_YMD = to_date(#{uncfEnfrYmd},'yyyymmdd') /*미확인시행일자 */
				, APRV_DSLW_CTN = #{aprvDslwCtn} /*승인불가내용 */
		 </if>
		 where  a.PTNO      =   #{ptno}
		   and  a.ORDR_YMD  =   to_date(#{ordrYmd}, 'YYYYMMDD')
		   and  a.ORDR_SNO  =   #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-deleteLmttAnagCmtx (제한항균제 협진 삭제) 
        Description :                                           제한항균제 협진 삭제
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
    -->	
	<delete id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-deleteLmttAnagCmtx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-deleteLmttAnagCmtx */
		delete  /* 제한항균제 협진의뢰 삭제 */
		  from  MDANTBRIT a
		 where  a.PTNO      =   #{ptno}
		   and  a.ORDR_YMD  =   to_date(#{ordrYmd}, 'YYYYMMDD')
		   and  a.ORDR_SNO  =   #{ordrSno}
	</delete>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameLmttAnagCmtx-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="cnfrDvsnCd" column="CNFR_DVSN_CD"/>
		<result property="lmttAnagValdYmd" column="LMTT_ANAG_VALD_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameLmttAnagCmtx (동일 제한항균제 협진의뢰내역 조회) 
        Description :                                           동일 제한항균제 협진의뢰내역 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameLmttAnagCmtx-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameLmttAnagCmtx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameLmttAnagCmtx-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameLmttAnagCmtx */
		select  /* 동일 제한항균제 협진의뢰내역 */
		        to_char(a.ORDR_YMD, 'YYYYMMDD')             as ORDR_YMD             -- 처방일자
		     ,  a.CNFR_DVSN_CD                              as CNFR_DVSN_CD         -- 확인구분코드(승인여부) - Y,N,Null
		     ,  to_char(a.LMTT_ANAG_VALD_YMD, 'YYYYMMDD')   as LMTT_ANAG_VALD_YMD   -- 제한항균제유효일자
		  from  MDANTBRIT a
		     ,  MDORDRCMT b
		 where  a.MDRP_NO       =   #{mdrpNo}
		   and  b.ORDR_CD       =   a.ANAG_ORDR_CD
		   and  (   b.ORDR_CD   =   #{anagOrdrCd}
		            or
		            b.ANTB_RPRS_INGR_CD =   (   select  ANTB_RPRS_INGR_CD 
		                                          from  MDORDRCMT 
		                                         where  ORDR_CD = #{anagOrdrCd}
		                                    )
		        )
		union all
		select  /* 항균제 추천 */
		        to_char(APST_YMD, 'YYYYMMDD')       -- 적용시작일자
		     ,  'A'                                 -- 승인여부 : A 신청은 해야 하지만 신청하면 자동으로 승인
		     ,  to_char(APFN_YMD, 'YYYYMMDD')       -- 적용종료일자(유효일자)
		  from  MDANTBRCT       /* 항균제추천 */
		 where  MDRP_NO     =   #{mdrpNo}
		   and  ORDR_CD     =   #{anagOrdrCd}
		   and  trunc(sysdate) between APST_YMD and APFN_YMD
		 order
		    by  ORDR_YMD desc
		     ,  CNFR_DVSN_CD desc
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneLmttAnagCmtxDetl-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="cmtxWntdYmd" column="CMTX_WNTD_YMD"/>
		<result property="anagOrdrCd" column="ANAG_ORDR_CD"/>
		<result property="refrResnCd" column="REFR_RESN_CD"/>
		<result property="refrResnNm" column="REFR_RESN_NM"/>
		<result property="useObjcCd" column="USE_OBJC_CD"/>
		<result property="useObjcNm" column="USE_OBJC_NM"/>
		<result property="orglDissDxNm" column="ORGL_DISS_DX_NM"/>
		<result property="infcDxNm" column="INFC_DX_NM"/>
		<result property="csbcCd1" column="CSBC_CD1"/>
		<result property="csbcNm1" column="CSBC_NM1"/>
		<result property="csbcEtcCtn1" column="CSBC_ETC_CTN1"/>
		<result property="csbcLtstCltrYmd1" column="CSBC_LTST_CLTR_YMD1"/>
		<result property="csbcCd2" column="CSBC_CD2"/>
		<result property="csbcNm2" column="CSBC_NM2"/>
		<result property="csbcEtcCtn2" column="CSBC_ETC_CTN2"/>
		<result property="csbcLtstCltrYmd2" column="CSBC_LTST_CLTR_YMD2"/>
		<result property="cnfrDvsnCd" column="CNFR_DVSN_CD"/>
		<result property="lmttAnagValdYmd" column="LMTT_ANAG_VALD_YMD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="infcDxCd" column="INFC_DX_CD"/>
		<result property="uddsCtn" column="UDDS_CTN"/>
		<result property="indsCtn" column="INDS_CTN"/>
		<result property="csbcNmCnfrYn" column="CSBC_NM_CNFR_YN"/>
		<result property="csbcNm" column="CSBC_NM"/>
		<result property="orreCtn" column="ORRE_CTN"/>
		<result property="csbcSptnSpcmNm" column="CSBC_SPTN_SPCM_NM"/>
		<result property="orreYn1" column="ORRE_YN1"/>
		<result property="orreYn2" column="ORRE_YN2"/>
		<result property="orreYn3" column="ORRE_YN3"/>
		<result property="orreYn31" column="ORRE_YN31"/>
		<result property="orreYn32" column="ORRE_YN32"/>
		<result property="orreYn33" column="ORRE_YN33"/>
		<result property="orreYn34" column="ORRE_YN34"/>
		<result property="orreYn35" column="ORRE_YN35"/>
		<result property="orreYn36" column="ORRE_YN36"/>
		<result property="orre36Ctn" column="ORRE36_CTN"/>
		<result property="orreYn4" column="ORRE_YN4"/>
		<result property="orreYn5" column="ORRE_YN5"/>
		<result property="orreYn6" column="ORRE_YN6"/>
		<result property="oprtPrvnRefrYn" column="OPRT_PRVN_REFR_YN"/>
		<result property="oprtRltdPtssYn1" column="OPRT_RLTD_PTSS_YN1"/>
		<result property="oprtRltdPtssYn2" column="OPRT_RLTD_PTSS_YN2"/>
		<result property="oprtRltdPtssYn3" column="OPRT_RLTD_PTSS_YN3"/>
		<result property="opbeInfcResnCd1" column="OPBE_INFC_RESN_CD1"/>
		<result property="opbeInfcResnYn2" column="OPBE_INFC_RESN_YN2"/>
		<result property="admsIprgEnfrOprtYn1" column="ADMS_IPRG_ENFR_OPRT_YN1"/>
		<result property="admsIprgEnfrOprtYn2" column="ADMS_IPRG_ENFR_OPRT_YN2"/>
		<result property="antbAlrgYn1" column="ANTB_ALRG_YN1"/>
		<result property="trnfYn1" column="TRNF_YN1"/>
		<result property="opafInfcResnCd1" column="OPAF_INFC_RESN_CD1"/>
		<result property="opafInfcResnYn2" column="OPAF_INFC_RESN_YN2"/>
		<result property="opafInfcResnYn3" column="OPAF_INFC_RESN_YN3"/>
		<result property="opafInfcResnCd4" column="OPAF_INFC_RESN_CD4"/>
		<result property="opafInfcResnYn5" column="OPAF_INFC_RESN_YN5"/>
		<result property="apvrAdvcSbjcCtn" column="APVR_ADVC_SBJC_CTN"/>
		<result property="vcmcnYn" column="VCMCN_YN"/>
		<result property="aprvMeaTrgtYn" column="APRV_MEA_TRGT_YN"/>
		<result property="cnfrDvsnCd" column="CNFR_DVSN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneLmttAnagCmtxDetl (제한항균제 협진의뢰 상세조회) 
        Description :                                           제한항균제 협진의뢰 상세조회 (PK)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneLmttAnagCmtxDetl-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneLmttAnagCmtxDetl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneLmttAnagCmtxDetl-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneLmttAnagCmtxDetl */
		select  /* 제한항균제 협진의뢰 상세조회 */
		        a.PTNO                                      as PTNO
		     ,  to_char(a.ORDR_YMD, 'YYYYMMDD')             as ORDR_YMD
		     ,  a.ORDR_SNO                                  as ORDR_SNO
		     ,  a.MDRP_NO                                   as MDRP_NO
		     ,  to_char(a.CMTX_WNTD_YMD, 'YYYYMMDD')        as CMTX_WNTD_YMD
		     ,  a.ANAG_ORDR_CD                              as ANAG_ORDR_CD
		     ,  a.REFR_RESN_CD                              as REFR_RESN_CD             -- 의뢰사유코드
		     ,  (   select  DETL_CD_NM
		              from  CCCMCDDMT
		             where  COMN_GRP_CD     =   'MDM_011'
		               and  COMN_DTLS_CD    =   a.REFR_RESN_CD
		        )                                           as REFR_RESN_NM
		     ,  a.USE_OBJC_CD                               as USE_OBJC_CD              -- 사용목적코드
		     ,  (   select  DETL_CD_NM
		              from  CCCMCDDMT
		             where  COMN_GRP_CD     =   'MDM_007'
		               and  COMN_DTLS_CD    =   a.USE_OBJC_CD
		        )                                           as USE_OBJC_NM
		     ,  a.ORGL_DISS_DX_NM                           as ORGL_DISS_DX_NM
		     ,  a.INFC_DX_NM                                as INFC_DX_NM
		     ,  a.CSBC_CD1                                  as CSBC_CD1                 -- 원인균코드1
		     ,  (   select  DETL_CD_NM
		              from  CCCMCDDMT
		             where  COMN_GRP_CD     =   'MDM_010'
		               and  COMN_DTLS_CD    =   a.CSBC_CD1
		        )                                           as CSBC_NM1
		     ,  a.CSBC_ETC_CTN1                             as CSBC_ETC_CTN1
		     ,  to_char(a.CSBC_LTST_CLTR_YMD1, 'YYYYMMDD')  as CSBC_LTST_CLTR_YMD1
		     ,  a.CSBC_CD2                                  as CSBC_CD2                 -- 원인균코드1
		     ,  (   select  DETL_CD_NM
		              from  CCCMCDDMT
		             where  COMN_GRP_CD     =   'MDM_010'
		               and  COMN_DTLS_CD    =   a.CSBC_CD2
		        )                                           as CSBC_NM2
		     ,  a.CSBC_ETC_CTN2                             as CSBC_ETC_CTN2
		     ,  to_char(a.CSBC_LTST_CLTR_YMD2, 'YYYYMMDD')  as CSBC_LTST_CLTR_YMD2
		     ,  a.CNFR_DVSN_CD                              as CNFR_DVSN_CD
		     ,  to_char(a.LMTT_ANAG_VALD_YMD, 'YYYYMMDD')   as LMTT_ANAG_VALD_YMD
					 /* 고려대 반영분 항목조회 추가 */
				     , b.ORDR_NM /* 처방명(항균제명) */
					 , a.INFC_DX_CD /*진단코드 */
					 , a.UDDS_CTN /*기저질환내용 */
					 , a.INDS_CTN /*감염증내용 */
					 , a.CSBC_NM_CNFR_YN /*원인균명확인여부 */
					 , a.CSBC_NM /*원인균명 */
					 , a.ORRE_CTN /*처방사유내용 */
					 , a.CSBC_SPTN_SPCM_NM /*원인균분리검체명 */
					 , a.ORRE_YN1 /*처방사유여부1 */
					 , a.ORRE_YN2 /*처방사유여부2 */
					 , a.ORRE_YN3 /*처방사유여부3 */
					 , a.ORRE_YN31 /*처방사유여부31 */
					 , a.ORRE_YN32 /*처방사유여부32 */
					 , a.ORRE_YN33 /*처방사유여부33 */
					 , a.ORRE_YN34 /*처방사유여부34 */
					 , a.ORRE_YN35 /*처방사유여부35 */
					 , a.ORRE_YN36 /*처방사유여부36 */
					 , a.ORRE36_CTN /*처방사유36내용 */
					 , a.ORRE_YN4 /*처방사유여부4 */
					 , a.ORRE_YN5 /*처방사유여부5 */
					 , a.ORRE_YN6 /*처방사유여부6 */
					 , a.OPRT_PRVN_REFR_YN /*수술예방의뢰여부 */
		                , a.OPRT_RLTD_PTSS_YN1                   /* 수술관련환자상태여부1   */
		                , a.OPRT_RLTD_PTSS_YN2                   /* 수술관련환자상태여부2   */
		                , a.OPRT_RLTD_PTSS_YN3                   /* 수술관련환자상태여부3   */
		                , a.OPBE_INFC_RESN_CD1                   /* 수술이전감염사유코드1   */
		                , a.OPBE_INFC_RESN_YN2                   /* 수술이전감염사유여부2   */
		                , a.ADMS_IPRG_ENFR_OPRT_YN1              /* 입원중시행수술여부1   */
		                , a.ADMS_IPRG_ENFR_OPRT_YN2              /* 입원중시행수술여부2   */
		                , a.ANTB_ALRG_YN1                        /* 항생제알러지여부1   */
		                , a.TRNF_YN1                             /* 수혈여부1   */
		                , a.OPAF_INFC_RESN_CD1                   /* 수술이후감염사유코드1   */
		                , a.OPAF_INFC_RESN_YN2                   /* 수술이후감염사유여부2   */
		                , a.OPAF_INFC_RESN_YN3                   /* 수술이후감염사유여부3   */
		                , a.OPAF_INFC_RESN_CD4                   /* 수술이후감염사유코드4   */
		                , a.OPAF_INFC_RESN_YN5                   /* 수술이후감염사유여부5   */
				     , a.APVR_ADVC_SBJC_CTN /*승인자권고사항내용 */
				     , a.VCMCN_YN /*반코마이신여부 */
				     , a.APRV_MEA_TRGT_YN /*승인미대상여부 */
					 , a.CNFR_DVSN_CD /* 확인구분코드 */
		  from  MDANTBRIT a
				,  MDORDRCMT b -- 처방코드기본
		 where  a.PTNO      =   #{ptno}
		   and  a.ORDR_YMD  =   to_date(#{ordrYmd}, 'YYYYMMDD')
		   and  a.ORDR_SNO  =   #{ordrSno}
		   and  b.ORDR_CD   = a.ANAG_ORDR_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneDummy-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="wodvCd" column="WODV_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneDummy (selectOneDummy) 
        Description :                                           selectOneDummy
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneDummy-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneDummy"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneDummy-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneDummy */
		select  'I'         as WODV_CD
		  from  dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listLmttAnagAprvRefr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="btdt" column="BTDT"/>
		<result property="ageCtn" column="AGE_CTN"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="anagOrdrCd" column="ANAG_ORDR_CD"/>
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="gndrId" column="GNDR_ID"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="oddrNm" column="ODDR_NM"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="oprtPrvnRefrYn" column="OPRT_PRVN_REFR_YN"/>
		<result property="lmttAnagValdYmd" column="LMTT_ANAG_VALD_YMD"/>
		<result property="uddsCtn" column="UDDS_CTN"/>
		<result property="indsCtn" column="INDS_CTN"/>
		<result property="csbcNmCnfrYn" column="CSBC_NM_CNFR_YN"/>
		<result property="csbcNm" column="CSBC_NM"/>
		<result property="orreCtn" column="ORRE_CTN"/>
		<result property="dfntYmd" column="DFNT_YMD"/>
		<result property="dfntDrId" column="DFNT_DR_ID"/>
		<result property="uncfEnfrYmd" column="UNCF_ENFR_YMD"/>
		<result property="aprvDslwCtn" column="APRV_DSLW_CTN"/>
		<result property="cnfrDvsnCd" column="CNFR_DVSN_CD"/>
		<result property="oddrNm" column="ODDR_NM"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="kornDprtNm" column="KORN_DPRT_NM"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="abrvWardCd" column="ABRV_WARD_CD"/>
		<result property="ptrmNo" column="PTRM_NO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listLmttAnagAprvRefr (제한항균제 승인의뢰내역 조회) 
        Description :                                           제한항균제 승인의뢰내역을 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listLmttAnagAprvRefr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listLmttAnagAprvRefr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listLmttAnagAprvRefr-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listLmttAnagAprvRefr */
				select a.PTNO                                                as PTNO -- 환자번호
						   , c.PTNT_NM                                        as PTNT_NM /* 환자명  */ 		   
						   ,  c.GEND_CD                                           as GEND_CD   /* 성별코드 */
						   ,  to_char(c.BTDT, 'yyyymmdd')             as BTDT                     /* 생년월일  */	 
						   , FN_MD_GETAGE('2', c.BTDT, sysdate)             as AGE_CTN         /* 나이  */ 
				           , to_char(a.ORDR_YMD,'yyyymmdd') as ORDR_YMD -- 처방일자
				           , a.ORDR_SNO                                        as ORDR_SNO  --  의뢰일련번호
				           , a.ANAG_ORDR_CD                                         as ANAG_ORDR_CD                 -- 처방코드
				           , to_char(e.MDCR_YMD,'yyyymmdd') as MDCR_YMD -- 진료일자
				           , e. MCDP_CD                                       as MCDP_CD -- 진료과코드
				           , e.GNDR_ID                                         as GNDR_ID -- 주치의사ID
				           , a.FRST_RGSR_ID                                as ODDR_ID -- 처방의사ID
		                   , (select USER_NM from CCUSRDPHT where USER_ID = a.FRST_RGSR_ID) as ODDR_NM              /* 처방의명*/
				           , e.CODV_CD                                        as CODV_CD -- 내원구분코드
				           , nvl(a.OPRT_PRVN_REFR_YN,'N') as OPRT_PRVN_REFR_YN /* 수술예방의뢰여부  */
		                   , to_char(a.LMTT_ANAG_VALD_YMD,'yyyymmdd') as LMTT_ANAG_VALD_YMD -- 종료일자
				           , a.UDDS_CTN                                      as UDDS_CTN -- 기저질환내용
				           , a.INDS_CTN                                       as INDS_CTN -- 감염증내용
				           , a.CSBC_NM_CNFR_YN                      as CSBC_NM_CNFR_YN --원인균명 확인여부
				           , a.CSBC_NM                                       as CSBC_NM -- 원인균명
				           , a.ORRE_CTN                                      as ORRE_CTN -- 처방사유내용
				           , to_char(a.DFNT_YMD,'yyyymmdd') as DFNT_YMD -- 확정일자
				           , a.DFNT_DR_ID                                   as  DFNT_DR_ID -- 확정의사ID 
				           , to_char(a.UNCF_ENFR_YMD,'yyyymmdd') as UNCF_ENFR_YMD
				           , a.APRV_DSLW_CTN                           as APRV_DSLW_CTN -- 승인불가내용
				           , a.CNFR_DVSN_CD                                         as CNFR_DVSN_CD -- 승인여부
						   ,  (   select  f_a.USER_NM
						            from  CCUSRDPHT f_a
						          where  f_a.USER_ID = a.FRST_RGSR_ID)    as ODDR_NM                  /* 처방의사명 */
						   , b.ORDR_NM                                      as ORDR_NM /* 처방명 */
						   , d.ABRV_DPRT_CD                             as ABRV_DPRT_CD /* 약어부서코드  */
				           , d.KORN_DPRT_NM                            as KORN_DPRT_NM /* 한글부서명 */ 
						   , e.WARD_CD                                       as WARD_CD /* 병동코드 */
				           ,  (   select  f_a.ABRV_DPRT_CD
				                    from  HZDEPTMMT f_a
				                   where  f_a.DPRT_CD = e.WARD_CD
				              )                                              as ABRV_WARD_CD             /* 약어병동코드 */
						   , e.PTRM_NO                                       as PTRM_NO /* 병실번호 */	
				           , a.MDRP_NO                                      as MDRP_NO  /* 진료접수번호 */ 
				   from MDANTBRIT a   -- 제한항균제승인의뢰
				           , MDORDRCMT b --  처방코드기본
				           , APPTPTNTT c      -- 환자
				           , HZDEPTMMT d  -- 조직Master
				           , APRCRPTNT e -- 진료접수
		                   , HZDEPTMMT f -- 조직Master I/F(MDM연계)
				where a.ORDR_YMD between to_date(#{fromInqrYmd},'yyyymmdd') and to_date(#{toInqrYmd},'yyyymmdd') 
				<if test='ptno != null'>
				     and a.PTNO = #{ptno}
				</if>
				<if test='anagOrdrCd != null'>
				     and a.ANAG_ORDR_CD = #{anagOrdrCd}
				</if>
				     and (case when #{cnfrDvsnCd} is null then 'Y' 
				                       when #{cnfrDvsnCd} = 'Y' and a.CNFR_DVSN_CD = 'Y' then 'Y'
				                       when #{cnfrDvsnCd} = 'N' and a.CNFR_DVSN_CD = 'N' then 'Y' 
				                       when #{cnfrDvsnCd} = 'X' and a.CNFR_DVSN_CD is null then 'Y'end)  = 'Y'
				 <if test='vcmcnYn != null and vcmcnYn != "X"'>
				   and  nvl(a.VCMCN_YN,'X') = nvl(#{vcmcnYn},'X')
				 </if>
				<if test='oprtPrvnRefrYn != null and oprtPrvnRefrYn != ""'>
				     and nvl(a.OPRT_PRVN_REFR_YN,'N') = #{oprtPrvnRefrYn}
				</if>
				     and b.ORDR_CD  = a.ANAG_ORDR_CD
				     and c.PTNO         = a.PTNO
				     and e.MDRP_NO = a.MDRP_NO
				<if test='wardCd != null'>
				     and e.WARD_CD = #{wardCd}
				</if>
				     and d.DPRT_CD     = e.MCDP_CD
				     and f.DPRT_CD  (+)= e.WARD_CD
				  order by
				             a.ORDR_YMD desc
				           , a.ORDR_SNO desc
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listPtntAnagAprvRqstList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="gndrId" column="GNDR_ID"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="oddrNm" column="ODDR_NM"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="ptrmNo" column="PTRM_NO"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="btdt" column="BTDT"/>
		<result property="ageCtn" column="AGE_CTN"/>
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="anagOrdrCd" column="ANAG_ORDR_CD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="infcDxCd" column="INFC_DX_CD"/>
		<result property="infcDxNm" column="INFC_DX_NM"/>
		<result property="lmttAnagValdYmd" column="LMTT_ANAG_VALD_YMD"/>
		<result property="uddsCtn" column="UDDS_CTN"/>
		<result property="indsCtn" column="INDS_CTN"/>
		<result property="csbcNmCnfrYn" column="CSBC_NM_CNFR_YN"/>
		<result property="csbcNm" column="CSBC_NM"/>
		<result property="orreCtn" column="ORRE_CTN"/>
		<result property="csbcSptnSpcmNm" column="CSBC_SPTN_SPCM_NM"/>
		<result property="orreYn1" column="ORRE_YN1"/>
		<result property="orreYn2" column="ORRE_YN2"/>
		<result property="orreYn3" column="ORRE_YN3"/>
		<result property="orreYn31" column="ORRE_YN31"/>
		<result property="orreYn32" column="ORRE_YN32"/>
		<result property="orreYn33" column="ORRE_YN33"/>
		<result property="orreYn34" column="ORRE_YN34"/>
		<result property="orreYn35" column="ORRE_YN35"/>
		<result property="orreYn36" column="ORRE_YN36"/>
		<result property="orre36Ctn" column="ORRE36_CTN"/>
		<result property="orreYn4" column="ORRE_YN4"/>
		<result property="orreYn5" column="ORRE_YN5"/>
		<result property="orreYn6" column="ORRE_YN6"/>
		<result property="oprtPrvnRefrYn" column="OPRT_PRVN_REFR_YN"/>
		<result property="apvrIndsCtn" column="APVR_INDS_CTN"/>
		<result property="apvrCsbcNmCnfrYn" column="APVR_CSBC_NM_CNFR_YN"/>
		<result property="apvrCsbcNm" column="APVR_CSBC_NM"/>
		<result property="apvrCsbcSptnSpcmNm" column="APVR_CSBC_SPTN_SPCM_NM"/>
		<result property="apvrOrreYn1" column="APVR_ORRE_YN1"/>
		<result property="apvrOrreYn2" column="APVR_ORRE_YN2"/>
		<result property="apvrOrreYn3" column="APVR_ORRE_YN3"/>
		<result property="apvrOrreYn31" column="APVR_ORRE_YN31"/>
		<result property="apvrOrreYn32" column="APVR_ORRE_YN32"/>
		<result property="apvrOrreYn33" column="APVR_ORRE_YN33"/>
		<result property="apvrOrreYn34" column="APVR_ORRE_YN34"/>
		<result property="apvrOrreYn35" column="APVR_ORRE_YN35"/>
		<result property="apvrOrreYn36" column="APVR_ORRE_YN36"/>
		<result property="apvrOrre36Ctn" column="APVR_ORRE36_CTN"/>
		<result property="apvrOrreYn4" column="APVR_ORRE_YN4"/>
		<result property="apvrOrreYn5" column="APVR_ORRE_YN5"/>
		<result property="apvrOrreYn6" column="APVR_ORRE_YN6"/>
		<result property="aprvDslwResnYn1" column="APRV_DSLW_RESN_YN1"/>
		<result property="aprvDslwResnYn2" column="APRV_DSLW_RESN_YN2"/>
		<result property="aprvDslwResnYn3" column="APRV_DSLW_RESN_YN3"/>
		<result property="aprvDslwResnYn4" column="APRV_DSLW_RESN_YN4"/>
		<result property="aprvDslwResnYn5" column="APRV_DSLW_RESN_YN5"/>
		<result property="aprvDslwResnYn6" column="APRV_DSLW_RESN_YN6"/>
		<result property="aprvDslwResnYn7" column="APRV_DSLW_RESN_YN7"/>
		<result property="aprvOrreCtn" column="APRV_ORRE_CTN"/>
		<result property="oprtRltdPtssYn1" column="OPRT_RLTD_PTSS_YN1"/>
		<result property="oprtRltdPtssYn2" column="OPRT_RLTD_PTSS_YN2"/>
		<result property="oprtRltdPtssYn3" column="OPRT_RLTD_PTSS_YN3"/>
		<result property="opbeInfcResnCd1" column="OPBE_INFC_RESN_CD1"/>
		<result property="opbeInfcResnYn2" column="OPBE_INFC_RESN_YN2"/>
		<result property="admsIprgEnfrOprtYn1" column="ADMS_IPRG_ENFR_OPRT_YN1"/>
		<result property="admsIprgEnfrOprtYn2" column="ADMS_IPRG_ENFR_OPRT_YN2"/>
		<result property="antbAlrgYn1" column="ANTB_ALRG_YN1"/>
		<result property="trnfYn1" column="TRNF_YN1"/>
		<result property="opafInfcResnCd1" column="OPAF_INFC_RESN_CD1"/>
		<result property="opafInfcResnYn2" column="OPAF_INFC_RESN_YN2"/>
		<result property="opafInfcResnYn3" column="OPAF_INFC_RESN_YN3"/>
		<result property="opafInfcResnCd4" column="OPAF_INFC_RESN_CD4"/>
		<result property="opafInfcResnYn5" column="OPAF_INFC_RESN_YN5"/>
		<result property="aprvOprtRltdPtssYn1" column="APRV_OPRT_RLTD_PTSS_YN1"/>
		<result property="aprvOprtRltdPtssYn2" column="APRV_OPRT_RLTD_PTSS_YN2"/>
		<result property="aprvOprtRltdPtssYn3" column="APRV_OPRT_RLTD_PTSS_YN3"/>
		<result property="aprvOpbeInfcResnCd1" column="APRV_OPBE_INFC_RESN_CD1"/>
		<result property="aprvOpbeInfcResnYn2" column="APRV_OPBE_INFC_RESN_YN2"/>
		<result property="aprvAdmsIprgEnfrOprtYn1" column="APRV_ADMS_IPRG_ENFR_OPRT_YN1"/>
		<result property="aprvAdmsIprgEnfrOprtYn2" column="APRV_ADMS_IPRG_ENFR_OPRT_YN2"/>
		<result property="aprvAntbAlrgYn1" column="APRV_ANTB_ALRG_YN1"/>
		<result property="aprvTrnfYn1" column="APRV_TRNF_YN1"/>
		<result property="aprvOpafInfcResnCd1" column="APRV_OPAF_INFC_RESN_CD1"/>
		<result property="aprvOpafInfcResnYn2" column="APRV_OPAF_INFC_RESN_YN2"/>
		<result property="aprvOpafInfcResnYn3" column="APRV_OPAF_INFC_RESN_YN3"/>
		<result property="aprvOpafInfcResnCd4" column="APRV_OPAF_INFC_RESN_CD4"/>
		<result property="aprvOpafInfcResnYn5" column="APRV_OPAF_INFC_RESN_YN5"/>
		<result property="encrAntbCtn" column="ENCR_ANTB_CTN"/>
		<result property="usePerdCtn" column="USE_PERD_CTN"/>
		<result property="drvtVlmCtn" column="DRVT_VLM_CTN"/>
		<result property="keepVlmCtn" column="KEEP_VLM_CTN"/>
		<result property="drvtVlmAplyYn" column="DRVT_VLM_APLY_YN"/>
		<result property="keepVlmAplyYn" column="KEEP_VLM_APLY_YN"/>
		<result property="apvrAdvcSbjcCtn" column="APVR_ADVC_SBJC_CTN"/>
		<result property="vcmcnYn" column="VCMCN_YN"/>
		<result property="aprvMeaTrgtYn" column="APRV_MEA_TRGT_YN"/>
		<result property="oprtYmd" column="OPRT_YMD"/>
		<result property="ordrDt" column="ORDR_DT"/>
		<result property="dfntYmd" column="DFNT_YMD"/>
		<result property="dfntDrId" column="DFNT_DR_ID"/>
		<result property="uncfEnfrYmd" column="UNCF_ENFR_YMD"/>
		<result property="aprvDslwCtn" column="APRV_DSLW_CTN"/>
		<result property="cnfrDvsnCd" column="CNFR_DVSN_CD"/>
		<result property="inqrDvsnCd" column="INQR_DVSN_CD"/>
		<result property="anagAtmtAprvYn" column="ANAG_ATMT_APRV_YN"/>
		<result property="clno1" column="CLNO_1"/>
		<result property="bswrKeyVl" column="BSWR_KEY_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listPtntAnagAprvRqstList (승인의뢰내역 상세정보 조회) 
        Description :                                           승인의뢰내역 상세정보를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listPtntAnagAprvRqstList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listPtntAnagAprvRqstList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listPtntAnagAprvRqstList-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listPtntAnagAprvRqstList */
				select 
				         to_char(e.MDCR_YMD,'yyyymmdd') as MDCR_YMD  /* 진료일자/입원일자  */           
					    , e.MCDP_CD                      /* 진료과/진료부서 */             
					    , e.GNDR_ID                       /* 주치의사 */                    
					    , a.FRST_RGSR_ID as ODDR_ID   /* 처방의사 */                    
					    , e.CODV_CD                     /* 환자구분 */  
					    , a.MDRP_NO 
					    , f.USER_NM as ODDR_NM                     /* 처방의명 */
					    , b.ORDR_NM                      /* 처방명(항균제명) */
					    , c.PTNT_NM                      /* 환자명   */
					    , d.KORN_DPRT_NM as  MCDP_NM   /* 진료과명 */
					    , e.WARD_CD /* 병동코드번호 */
					    , e.PTRM_NO /* 병실코드번호 */
						, c.GEND_CD      /* 성별 */
						, to_char(c.BTDT, 'yyyymmdd')                          as BTDT                /* 생년월일 */
						, FN_MD_GETAGE('2', c.BTDT, sysdate)             as AGE_CTN         /* 나이 */	    	
				        , a.PTNO /*환자번호 */
				        , to_char(a.ORDR_YMD,'yyyymmdd') as  ORDR_YMD /*처방일자 */
				        , a.ANAG_ORDR_CD /*처방코드 */
				        , a.ORDR_SNO /*처방일련번호 */
				        , a.MDRP_NO /*진료접수번호 */
				        , a.INFC_DX_CD /*진단코드 */
				        , a.INFC_DX_NM /*진단명 */
				        , to_char(a.LMTT_ANAG_VALD_YMD,'yyyymmdd') as LMTT_ANAG_VALD_YMD /*종료일자 */
				        , a.UDDS_CTN /*기저질환내용 */
				        , a.INDS_CTN /*감염증내용 */
				        , a.CSBC_NM_CNFR_YN /*원인균명확인여부 */
				        , a.CSBC_NM /*원인균명 */
				        , a.ORRE_CTN /*처방사유내용 */
				        , a.CSBC_SPTN_SPCM_NM /*원인균분리검체명 */
				        , a.ORRE_YN1 /*처방사유여부1 */
				        , a.ORRE_YN2 /*처방사유여부2 */
				        , a.ORRE_YN3 /*처방사유여부3 */
				        , a.ORRE_YN31 /*처방사유여부31 */
				        , a.ORRE_YN32 /*처방사유여부32 */
				        , a.ORRE_YN33 /*처방사유여부33 */
				        , a.ORRE_YN34 /*처방사유여부34 */
				        , a.ORRE_YN35 /*처방사유여부35 */
				        , a.ORRE_YN36 /*처방사유여부36 */
				        , a.ORRE36_CTN /*처방사유36내용 */
				        , a.ORRE_YN4 /*처방사유여부4 */
				        , a.ORRE_YN5 /*처방사유여부5 */
				        , a.ORRE_YN6 /*처방사유여부6 */
				        , a.OPRT_PRVN_REFR_YN /*수술예방의뢰여부 */
				        , a.APVR_INDS_CTN /*승인자감염증내용 */
				        , a.APVR_CSBC_NM_CNFR_YN /*승인자원인균명확인여부 */
				        , a.APVR_CSBC_NM /*승인자원인균명 */
				        , a.APVR_CSBC_SPTN_SPCM_NM /*승인자원인균분리검체명 */
				        , a.APVR_ORRE_YN1 /*승인자처방사유여부1 */
				        , a.APVR_ORRE_YN2 /*승인자처방사유여부2 */
				        , a.APVR_ORRE_YN3 /*승인자처방사유여부3 */
				        , a.APVR_ORRE_YN31 /*승인자처방사유여부31 */
				        , a.APVR_ORRE_YN32 /*승인자처방사유여부32 */
				        , a.APVR_ORRE_YN33 /*승인자처방사유여부33 */
				        , a.APVR_ORRE_YN34 /*승인자처방사유여부34 */
				        , a.APVR_ORRE_YN35 /*승인자처방사유여부35 */
				        , a.APVR_ORRE_YN36 /*승인자처방사유여부36 */
				        , a.APVR_ORRE36_CTN /*승인자처방사유36내용 */
				        , a.APVR_ORRE_YN4 /*승인자처방사유여부4 */
				        , a.APVR_ORRE_YN5 /*승인자처방사유여부5 */
				        , a.APVR_ORRE_YN6 /*승인자처방사유여부6 */
				        , a.APRV_DSLW_RESN_YN1 /*승인불가사유여부1 */
				        , a.APRV_DSLW_RESN_YN2 /*승인불가사유여부2 */
				        , a.APRV_DSLW_RESN_YN3 /*승인불가사유여부3 */
				        , a.APRV_DSLW_RESN_YN4 /*승인불가사유여부4 */
				        , a.APRV_DSLW_RESN_YN5 /*승인불가사유여부5 */
				        , a.APRV_DSLW_RESN_YN6 /*승인불가사유여부6 */
				        , a.APRV_DSLW_RESN_YN7 /*승인불가사유여부7 */
				        , a.APRV_ORRE_CTN /* 승인처방사유내용  */
		                , a.OPRT_RLTD_PTSS_YN1                   /* 수술관련환자상태여부1   */
		                , a.OPRT_RLTD_PTSS_YN2                   /* 수술관련환자상태여부2   */
		                , a.OPRT_RLTD_PTSS_YN3                   /* 수술관련환자상태여부3   */
		                , a.OPBE_INFC_RESN_CD1                   /* 수술이전감염사유코드1   */
		                , a.OPBE_INFC_RESN_YN2                   /* 수술이전감염사유여부2   */
		                , a.ADMS_IPRG_ENFR_OPRT_YN1              /* 입원중시행수술여부1   */
		                , a.ADMS_IPRG_ENFR_OPRT_YN2              /* 입원중시행수술여부2   */
		                , a.ANTB_ALRG_YN1                        /* 항생제알러지여부1   */
		                , a.TRNF_YN1                             /* 수혈여부1   */
		                , a.OPAF_INFC_RESN_CD1                   /* 수술이후감염사유코드1   */
		                , a.OPAF_INFC_RESN_YN2                   /* 수술이후감염사유여부2   */
		                , a.OPAF_INFC_RESN_YN3                   /* 수술이후감염사유여부3   */
		                , a.OPAF_INFC_RESN_CD4                   /* 수술이후감염사유코드4   */
		                , a.OPAF_INFC_RESN_YN5                   /* 수술이후감염사유여부5   */
		        , a.APRV_OPRT_RLTD_PTSS_YN1 /* 승인수술관련환자상태여부1  */	
		        , a.APRV_OPRT_RLTD_PTSS_YN2 /* 승인수술관련환자상태여부2	*/	   
		        , a.APRV_OPRT_RLTD_PTSS_YN3 /* 승인수술관련환자상태여부3	*/	
		        , a.APRV_OPBE_INFC_RESN_CD1  /* 승인수술이전감염사유코드1	*/	
		        , a.APRV_OPBE_INFC_RESN_YN2  /* 승인수술이전감염사유여부2	*/	
		        , a.APRV_ADMS_IPRG_ENFR_OPRT_YN1 /* 승인입원중시행수술여부1		*/
		        , a.APRV_ADMS_IPRG_ENFR_OPRT_YN2 /* 승인입원중시행수술여부2		*/
		        , a.APRV_ANTB_ALRG_YN1 /* 승인항생제알러지여부1		*/
		        , a.APRV_TRNF_YN1  /* 승인수혈여부1		   */
		        , a.APRV_OPAF_INFC_RESN_CD1  /* 승인수술이후감염사유코드1	*/	
		        , a.APRV_OPAF_INFC_RESN_YN2  /* 승인수술이후감염사유여부2	*/	
		        , a.APRV_OPAF_INFC_RESN_YN3  /* 승인수술이후감염사유여부3	*/	
		        , a.APRV_OPAF_INFC_RESN_CD4  /* 승인수술이후감염사유코드4	*/	
		        , a.APRV_OPAF_INFC_RESN_YN5  /* 승인수술이후감염사유여부5	*/	
				        , a.ENCR_ANTB_CTN /*권장항생제내용 */
				        , a.USE_PERD_CTN /*사용기간내용 */
				        , a.DRVT_VLM_CTN /*유도용량내용 */
				        , a.KEEP_VLM_CTN /*유지용량내용 */
				        , a.DRVT_VLM_APLY_YN /* 유도용량적용여부 */
				        , a.KEEP_VLM_APLY_YN /* 유지용량적용여부 */
				        , a.APVR_ADVC_SBJC_CTN /*승인자권고사항내용 */
				        , a.VCMCN_YN /*반코마이신여부 */
				        , a.APRV_MEA_TRGT_YN /*승인미대상여부 */
				        , to_char(a.OPRT_YMD,'yyyymmdd') as OPRT_YMD /*수술일자 */
				        , to_char(a.ORDR_DT,'yyyymmddhh24miss') as ORDR_DT /*처방일시 */
				        , to_char(a.DFNT_YMD,'yyyymmdd') as DFNT_YMD /*확정일자 */
				        , a.DFNT_DR_ID /*확정의사ID */
				        , to_char(a.UNCF_ENFR_YMD,'yyyymmdd') as UNCF_ENFR_YMD /*미확인시행일자 */
				        , a.APRV_DSLW_CTN /*승인불가내용 */
				        , a.CNFR_DVSN_CD /*승인여부 */
				        , #{inqrDvsnCd} as INQR_DVSN_CD
				        , '' as ANAG_ATMT_APRV_YN /* 항균제자동승인여부 */
		                ,  (   select  b.CLNO
		                        from  CCUSERAMT b
		                      where  b.LGIN_ID = a.FRST_RGSR_ID
		                   ) as CLNO_1 /* 처방의 휴대전화번호 */
		                , to_char(a.ORDR_YMD,'YYYYMMDD') || lpad(a.ORDR_SNO, 10, '0')    as BSWR_KEY_VL
				  from      
				       	 MDANTBRIT a -- 제한항균제협진의뢰
					    , MDORDRCMT b -- 처방코드기본
					    , APPTPTNTT c -- 환자
					    , HZDEPTMMT d -- 조직Master I/F(MDM연계)
					    , APRCRPTNT e -- 진료접수
					    , CCUSRDPHT f -- 사용자ID
				where 1=1
				<if test='inqrDvsnCd == "1"'>
				     and a.PTNO = #{ptno}
				</if>
				<if test='inqrDvsnCd == "2"'>
				     and a.DFNT_YMD = to_date('29991231','yyyymmdd')
				</if>  
				<if test='inqrDvsnCd == "3"'>
				     and a.DFNT_YMD = to_date(#{dfntYmd},'yyyymmdd')
				</if>  
					 and	b.ORDR_CD  = a.ANAG_ORDR_CD
					 and	c.PTNO  = a.PTNO
					 and  e.MDRP_NO = a.MDRP_NO
					 and  e.WARD_CD != '0'	 	       
				     and	d.DPRT_CD   = e.MCDP_CD
					 and  f.USER_ID = a.FRST_RGSR_ID
				  order by 
					       a.ORDR_YMD desc
					     ,  a.ORDR_SNO desc
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameOrdrCdLmttAnagCmtx-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="inqrDvsnCd" column="INQR_DVSN_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="lmttAnagValdYmd" column="LMTT_ANAG_VALD_YMD"/>
		<result property="csbcNm" column="CSBC_NM"/>
		<result property="csbcSptnSpcmNm" column="CSBC_SPTN_SPCM_NM"/>
		<result property="oprtPrvnRefrYn" column="OPRT_PRVN_REFR_YN"/>
		<result property="cnfrDvsnCd" column="CNFR_DVSN_CD"/>
		<result property="oprtYmd" column="OPRT_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameOrdrCdLmttAnagCmtx (동일 제한항균제(처방코드) 협진의뢰내역 조회 (kumc 버전)) 
        Description :                                           동일 제한항균제(처방코드) 협진의뢰내역 조회 (kumc 버전)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameOrdrCdLmttAnagCmtx-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameOrdrCdLmttAnagCmtx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameOrdrCdLmttAnagCmtx-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameOrdrCdLmttAnagCmtx */
		select '1'                                      as INQR_DVSN_CD       /*조회구분코드(처방코드) */
		     , to_char(a.ORDR_YMD,'yyyymmdd')           as ORDR_YMD           /* 처방일자 */
		     , a.ORDR_SNO                               as ORDR_SNO           /* 처방일련번호 */
		     , to_char(a.LMTT_ANAG_VALD_YMD,'yyyymmdd') as LMTT_ANAG_VALD_YMD /* 제한항균제유효일자 */
		     , a.CSBC_NM                                as CSBC_NM            /* 원인균명  */
		     , a.CSBC_SPTN_SPCM_NM                      as CSBC_SPTN_SPCM_NM  /* 원인균분리검체명 */
		     , a.OPRT_PRVN_REFR_YN                      as OPRT_PRVN_REFR_YN  /* 수술예방의뢰여부 */
		     , a.CNFR_DVSN_CD                           as CNFR_DVSN_CD       /* 확인구분코드 */	 
		     , to_char(a.OPRT_YMD,'yyyymmdd')           as  OPRT_YMD          /* 수술일자 */   
		  from MDANTBRIT a
		 where a.PTNO          = #{ptno}
		   and a.MDRP_NO       = #{mdrpNo}
		   and a.ANAG_ORDR_CD  = #{anagOrdrCd}
		union all
		select  /* 항균제 추천 */
		       '1'                             /* 조회구분코드(처방코드) */
		     , to_char(APST_YMD, 'YYYYMMDD')   /* 적용시작일자 */
		     , null                            /* 처방일련번호 */
		     , to_char(APFN_YMD, 'YYYYMMDD')   /* 적용종료일자(제한항균제유효일자) */
		     , null                            /* 원인균명  */
		     , null                            /* 원인균분리검체명 */
		     , null                            /* 수술예방의뢰여부 */
		     ,  'A'                            /* 승인여부 : A 신청은 해야 하지만 신청하면 자동으로 승인 */
		     , null                            /* 수술일자 */
		  from  MDANTBRCT /* 항균제추천 */
		 where  MDRP_NO     =   #{mdrpNo}
		   and  ORDR_CD     =   #{anagOrdrCd}
		   and  trunc(sysdate) between APST_YMD and APFN_YMD
		  order by
		        ORDR_YMD desc
		      , CNFR_DVSN_CD desc
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameIngrLmttAnagCmtx-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="inqrDvsnCd" column="INQR_DVSN_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="lmttAnagValdYmd" column="LMTT_ANAG_VALD_YMD"/>
		<result property="csbcNm" column="CSBC_NM"/>
		<result property="csbcSptnSpcmNm" column="CSBC_SPTN_SPCM_NM"/>
		<result property="oprtPrvnRefrYn" column="OPRT_PRVN_REFR_YN"/>
		<result property="cnfrDvsnCd" column="CNFR_DVSN_CD"/>
		<result property="oprtYmd" column="OPRT_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameIngrLmttAnagCmtx (동일 제한항균제(성분) 협진의뢰내역 조회) 
        Description :                                           동일 제한항균제(성분) 협진의뢰내역 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameIngrLmttAnagCmtx-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameIngrLmttAnagCmtx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameIngrLmttAnagCmtx-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listSameIngrLmttAnagCmtx */
		select '2'                                                         as INQR_DVSN_CD                /*조회구분코드(성분코드) */
		     , to_char(c.ORDR_YMD,'yyyymmdd') as ORDR_YMD                       /* 처방일자 */
		     , c.ORDR_SNO                                      as ORDR_SNO                        /* 처방일련번호 */
		     , to_char(c.LMTT_ANAG_VALD_YMD,'yyyymmdd')        as LMTT_ANAG_VALD_YMD /* 제한항균제유효일자 */   
		     , c.CSBC_NM                                         as CSBC_NM                           /* 원인균명  */
		     , c.CSBC_SPTN_SPCM_NM                   as CSBC_SPTN_SPCM_NM    /* 원인균분리검체명 */
		     , c.OPRT_PRVN_REFR_YN                     as OPRT_PRVN_REFR_YN      /* 수술예방의뢰여부 */	           
		     , c.CNFR_DVSN_CD                               as CNFR_DVSN_CD                /* 확인구분코드 */	 
		     , to_char(c.OPRT_YMD,'yyyymmdd') as  OPRT_YMD /* 수술일자 */   
		  from
			   SDDDGCDMT a /* 약품코드 */
		     , SDDDGCDMT b /* 약품코드 */
		     , MDANTBRIT c   /* 제한항균제협진의뢰 */
		 where
			   a.MDPR_CD       = #{anagOrdrCd}
		   and b.INGR_ID       = a.INGR_ID
		   and c.ANAG_ORDR_CD  = b.MDPR_CD
		   and c.PTNO          = #{ptno}
		   and c.MDRP_NO       = #{mdrpNo}		   
		   and c.CNFR_DVSN_CD  = 'N'		   
		 union all
		select  /* 항균제 추천 */
		       '2'                             /* 조회구분코드(처방코드) */
		     , to_char(APST_YMD, 'YYYYMMDD')   /* 적용시작일자 */
		     , null                            /* 처방일련번호 */
		     , to_char(APFN_YMD, 'YYYYMMDD')   /* 적용종료일자(제한항균제유효일자) */
		     , null                            /* 원인균명  */
		     , null                            /* 원인균분리검체명 */
		     , null                            /* 수술예방의뢰여부 */
		     ,  'A'                            /* 승인여부 : A 신청은 해야 하지만 신청하면 자동으로 승인 */
		     , null                            /* 수술일자 */
		  from  MDANTBRCT /* 항균제추천 */
		 where  MDRP_NO     =   #{mdrpNo}
		   and  ORDR_CD     =   #{anagOrdrCd}
		   and  trunc(sysdate) between APST_YMD and APFN_YMD
		  order by
		        ORDR_YMD desc
		      , CNFR_DVSN_CD desc
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneAdtnOprtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="adtnOprtYn" column="ADTN_OPRT_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneAdtnOprtYn (제한항생제 재승인을 위한 추가수술여부 확인) 
        Description :                                           제한항생제 재승인을 위한 추가수술여부 확인
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneAdtnOprtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneAdtnOprtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneAdtnOprtYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-selectOneAdtnOprtYn */
		 select decode(count(x.ORDR_CD),0,'N','Y')  as ADTN_OPRT_YN
		   from   	          
		          (
		 select a.ORDR_CD
		   from MDTRTORDT a
		where  a.PTNO         = #{ptno}
		     and  a.MDRP_NO = #{mdrpNo}   
		     and a.OPRT_YMD = to_date(#{oprtYmd1},'yyyymmdd')
		     and nvl(a.DC_DVSN_CD, 'N') = 'N'
		 group by 
		             a.ORDR_CD
		minus	   
		 select a.ORDR_CD
		   from MDTRTORDT a
		where  a.PTNO         = #{ptno}
		     and  a.MDRP_NO = #{mdrpNo}   
		     and a.OPRT_YMD = to_date(#{oprtYmd2},'yyyymmdd')
		     and nvl(a.DC_DVSN_CD, 'N') = 'N'
		 group by 
		             a.ORDR_CD
		          ) x   
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listIndsCdList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="mdcrDtlsCtrlCd" column="MDCR_DTLS_CTRL_CD"/>
		<result property="mdcrDtlsCtrlNm" column="MDCR_DTLS_CTRL_NM"/>
		<result property="mdcrCtrlChrcVl1" column="MDCR_CTRL_CHRC_VL1"/>
		<result property="mdcrCtrlChrcVl2" column="MDCR_CTRL_CHRC_VL2"/>
		<result property="mdcrCtrlChrcVl3" column="MDCR_CTRL_CHRC_VL3"/>
		<result property="mdcrCtrlChrcVl4" column="MDCR_CTRL_CHRC_VL4"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listIndsCdList (감염증코드 List 조회 (승인의뢰시)) 
        Description :                                           감염증코드 List 조회 (승인의뢰시)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listIndsCdList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listIndsCdList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listIndsCdList-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listIndsCdList */
		select MDCR_DTLS_CTRL_CD
				, MDCR_DTLS_CTRL_NM
				, MDCR_CTRL_CHRC_VL1 
				, MDCR_CTRL_CHRC_VL2  
				, MDCR_CTRL_CHRC_VL3  
			    , case when MDCR_CTRL_CHRC_VL1 is null then 1 else 2 end as MDCR_CTRL_CHRC_VL4 
		  from MZCTRLMMT a
		where a.MDCR_CTRL_CD = 'MDP_901_015'			
		 order by 
		          MDCR_CTRL_CHRC_VL4
		        , MDCR_DTLS_CTRL_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listOpfeHx-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="oprtYmd" column="OPRT_YMD"/>
		<result property="oprtSno" column="OPRT_SNO"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="mdcrDt" column="MDCR_DT"/>
		<result property="rckiCd" column="RCKI_CD"/>
		<result property="formNo" column="FORM_NO"/>
		<result property="opafOprtNm1" column="OPAF_OPRT_NM_1"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="codvCd" column="CODV_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listOpfeHx (수술료 이력 조회) 
        Description :                                           수술료 이력 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listOpfeHx-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listOpfeHx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listOpfeHx-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listOpfeHx */
		 select a.PTNO                                as PTNO
		      , a.ORDR_CD                             as ORDR_CD
		      , g.ORDR_NM                             as ORDR_NM
		      , to_char(a.OPRT_YMD,'yyyymmdd')        as OPRT_YMD
		      , a.OPRT_SNO                            as OPRT_SNO
		      , a.MCDP_CD                             as  MCDP_CD
		      , to_char(f.MDCR_DT,'yyyymmddhh24miss') as MDCR_DT
		      , c.RCKI_CD                             as RCKI_CD
		      , d.FORM_NO                             as FORM_NO
		      , e.OPAF_OPRT_NM_1                      as OPAF_OPRT_NM_1
		      , a.MDRP_NO                             as MDRP_NO
		      , a.CODV_CD                             as CODV_CD
		   from  
		              MDTRTORDT a  /* 처방료처방 */
		           ,  AIMFMDFET b  /*수가코드*/
		           ,  MEDOCMBST c /* 진료기록 */
		           , MEDOCMDTT d /* 진료기록상세 */
		           ,  MDOPSCCBV  e /* 수술기록View */
		           , APRCRPTNT f /* 진료접수 */
		           , MDORDRCMT g /* 처방코드 */
		where  a.MDRP_NO                   = #{mdrpNo}
		     and  a.ORCL_CD                = 'OP1'                /* 처방분류코드(AI048)*/
		     and  nvl(a.DC_DVSN_CD, 'N')  != 'X'                      /* DC구분코드         */
		     and  nvl(a.RTRN_STTS_CD, 'N') = 'N'                     /* 반납상태코드       */
		     and  b.MDFE_CD                         = a.ORDR_CD      /* 수가코드=처방코드  */
		     and  (b.MDAC_CLSF_CD     = '09'    /* 수가누적분류코드   */
		              or
		              OPRT_MDFE_CD_YN = 'Y') /* 수술수가코드여부 */                
		     and  a.ORDR_YMD between b.APST_YMD and b.APFN_YMD
		     and c.PTNO                    = a.PTNO                    /*  환자번호 */
		     and c.RCRD_DT                 = a.OPRT_YMD           /*  수술일자(수술기록인경우 수술일자를 기록일자로 저장) */
		     and c.BHVR_SNO                = a.OPRT_SNO           /*  행위일련번호(ASIS 수술순번) */
			 and c.RCKI_CD                 = FN_CC_GET_CNST_VL('MED_002', 'S_OPRT_RCRD')    /*  수술기록 */
			 and c.RCRD_SAVE_DVSN_CD       = '1'
			 and c.RCRD_LAST_YN            = 'Y'    
		     and d.RCRD_NO                 = c.RCRD_NO
		     and d.RCRD_DETL_SNO           = (select max(RCRD_DETL_SNO)
			                                    from MEDOCMDTT x
			                                   where x.RCRD_NO = d.RCRD_NO
			                                     and nvl(x.DLTN_YN,'N')  = 'N')	 
			 and e.PTNO                    = a.PTNO
			 and e.OPRT_YMD                = a.OPRT_YMD
			 and e.OPRT_SNO                = a.OPRT_SNO
			 and f.MDRP_NO                 = a.MDRP_NO
			 and g.ORDR_CD                 = a.ORDR_CD
		   order by a.ORDR_YMD desc
		       , a.ORDR_SNO desc
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAprvRefrOrdrHx-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNmCtn" column="ORDR_NM_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAprvRefrOrdrHx (항균제 처방이력 조회) 
        Description :                                           항균제 처방이력 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAprvRefrOrdrHx-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAprvRefrOrdrHx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAprvRefrOrdrHx-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAprvRefrOrdrHx */
		<![CDATA[
		select to_char(a.ORDR_YMD,'yyyymmdd') as ORDR_YMD
		     , a.ORDR_CD                      as ORDR_CD
		     , (case when a.DRAP_DVSN_CD = 1 and a.PCKN_UNAD_QTY < 1 then '0'||a.PCKN_UNAD_QTY
			        when a.DRAP_DVSN_CD = 1 and a.PCKN_UNAD_QTY >= 1 then to_char(a.PCKN_UNAD_QTY)
			        when a.DRAP_DVSN_CD = 2 and a.ICUN_ADMN_VLM < 1 then '0'||a.ICUN_ADMN_VLM
			        when a.DRAP_DVSN_CD = 2 and a.ICUN_ADMN_VLM >= 1 then to_char(a.ICUN_ADMN_VLM)
			        else
			          case when decode(a.SLCT_UNIT_DVSN_CD, '1', a.PCKN_UNAD_QTY, a.ICUN_ADMN_VLM) < 1 then '0'
				           else '' end 
		            end)||decode(a.DRAP_DVSN_CD,1,a.PCUN_CD,2,a.ICUN_CD,decode(a.SLCT_UNIT_DVSN_CD, '1', a.PCUN_CD, a.ICUN_CD))||
		                  '-'||a.NTM||'회'||a.DDCN||'일' as ORDR_NM_CTN
		  from MDMEDORDT a /* 약처방 */
		     , MDORDRCMT b /* 처방코드기본 */
		 where a.PTNO    = #{ptno}
		   and a.ORDR_CD = #{ordrCd}
		   and a.ORDR_YMD between to_date(#{fromInqrYmd},'yyyymmdd') and to_date(#{toInqrYmd},'yyyymmdd')
		   and decode(a.CODV_CD,'E','A',a.CARE_STTS_CD) = 'A'
		   and b.ORDR_CD = a.ORDR_CD
		 order by 
		       a.ORDR_YMD desc
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAdmBfOrdrHxList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="ordrNmCtn" column="ORDR_NM_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAdmBfOrdrHxList (입원전 7일 항균제 사용내역 조회) 
        Description :                                           입원전 7일 항균제 사용내역 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAdmBfOrdrHxList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAdmBfOrdrHxList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpLmttAnagCmtxDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAdmBfOrdrHxList-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpLmttAnagCmtxDAO-listAnagAdmBfOrdrHxList */
		<![CDATA[
		select to_char(a.ORDR_YMD,'yyyymmdd') as ORDR_YMD
		     , a.ORDR_CD                      as ORDR_CD
		     , (case when a.DRAP_DVSN_CD = 1 and a.PCKN_UNAD_QTY < 1 then '0'||a.PCKN_UNAD_QTY
			        when a.DRAP_DVSN_CD = 1 and a.PCKN_UNAD_QTY >= 1 then to_char(a.PCKN_UNAD_QTY)
			        when a.DRAP_DVSN_CD = 2 and a.ICUN_ADMN_VLM < 1 then '0'||a.ICUN_ADMN_VLM
			        when a.DRAP_DVSN_CD = 2 and a.ICUN_ADMN_VLM >= 1 then to_char(a.ICUN_ADMN_VLM)
			        else
			          case when decode(a.SLCT_UNIT_DVSN_CD, '1', a.PCKN_UNAD_QTY, a.ICUN_ADMN_VLM) < 1 then '0'
				           else '' end 
		            end)||decode(a.DRAP_DVSN_CD,1,a.PCUN_CD,2,a.ICUN_CD,decode(a.SLCT_UNIT_DVSN_CD, '1', a.PCUN_CD, a.ICUN_CD))||
		                  '-'||a.NTM||'회'||a.DDCN||'일' as ORDR_NM_CTN
		  from MDMEDORDT a /* 약처방 */
		     , MDORDRCMT b /* 처방코드기본 */
		 where a.PTNO    = #{ptno}
		   and a.ORDR_CD = #{ordrCd}
		   and a.ORDR_YMD between to_date(#{fromInqrYmd},'yyyymmdd')-7 and to_date(#{fromInqrYmd},'yyyymmdd')-1
		   and nvl(a.DC_DVSN_CD,'N') = 'N'
		   and nvl(a.ORFR_CD, 'N')  != 'P'
		   and b.ORDR_CD = a.ORDR_CD
		 order by 
		       a.ORDR_YMD desc
		]]>
	</select>



</mapper>