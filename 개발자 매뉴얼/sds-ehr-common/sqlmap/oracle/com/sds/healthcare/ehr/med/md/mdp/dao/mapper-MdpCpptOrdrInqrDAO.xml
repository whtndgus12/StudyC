<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_MdpCpptOrdrInqrDAO_sql.xml 
    Description :                                      CP환자처방조회DAO
                  -->
<mapper namespace="MdpCpptOrdrInqrDAO">


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpCpptOrdrInqrDAO-listCpptStepClbyOrdr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpCpptOrdrInqrDVO">
	
		<result property="orocCd" column="OROC_CD"/>
		<result property="cpStepNo" column="CP_STEP_NO"/>
		<result property="ordrCrtnLnknNo" column="ORDR_CRTN_LNKN_NO"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="gridRowSqnc" column="GRID_ROW_SQNC"/>
		<result property="saveDvsnCd" column="SAVE_DVSN_CD"/>
		<result property="scinCd" column="SCIN_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="bsisOrdrNm" column="BSIS_ORDR_NM"/>
		<result property="ordrCltyCd1" column="ORDR_CLTY_CD1"/>
		<result property="orfrCd" column="ORFR_CD"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="slctUnitDvsnCd" column="SLCT_UNIT_DVSN_CD"/>
		<result property="pcknUnadQty" column="PCKN_UNAD_QTY"/>
		<result property="pcunCd" column="PCUN_CD"/>
		<result property="icunAdmnVlm" column="ICUN_ADMN_VLM"/>
		<result property="icunCd1" column="ICUN_CD1"/>
		<result property="osetDetlNtm" column="OSET_DETL_NTM"/>
		<result property="ddcn" column="DDCN"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="drugDlvyDprtCd" column="DRUG_DLVY_DPRT_CD"/>
		<result property="drbnNo" column="DRBN_NO"/>
		<result property="sngnBndlYn" column="SNGN_BNDL_YN"/>
		<result property="mixKindCd" column="MIX_KIND_CD"/>
		<result property="astsYn" column="ASTS_YN"/>
		<result property="ordrIpdvCd" column="ORDR_IPDV_CD"/>
		<result property="osetDetlUnslCtn" column="OSET_DETL_UNSL_CTN"/>
		<result property="ptptCd" column="PTPT_CD"/>
		<result property="spcmCd1" column="SPCM_CD1"/>
		<result property="spcmCd2" column="SPCM_CD2"/>
		<result property="prtbYn" column="PRTB_YN"/>
		<result property="upltRwttVl" column="UPLT_RWTT_VL"/>
		<result property="uprgRwttVl" column="UPRG_RWTT_VL"/>
		<result property="lwlfRwttVl" column="LWLF_RWTT_VL"/>
		<result property="lwrgRwttVl" column="LWRG_RWTT_VL"/>
		<result property="mdsiCd" column="MDSI_CD"/>
		<result property="mdsiNm" column="MDSI_NM"/>
		<result property="mdteLctnCd" column="MDTE_LCTN_CD"/>
		<result property="afiMdteLctnNm" column="AFI_MDTE_LCTN_NM"/>
		<result property="mdteFrqnCd" column="MDTE_FRQN_CD"/>
		<result property="afiMdteFrqnNm" column="AFI_MDTE_FRQN_NM"/>
		<result property="ondyMdteNtm" column="ONDY_MDTE_NTM"/>
		<result property="afiOndyMdteNtmStr" column="AFI_ONDY_MDTE_NTM_STR"/>
		<result property="mdteDdcn" column="MDTE_DDCN"/>
		<result property="acdgMixDvsnCd" column="ACDG_MIX_DVSN_CD"/>
		<result property="ccr90Vlm" column="CCR90_VLM"/>
		<result property="ccr5090Vlm" column="CCR5090_VLM"/>
		<result property="ccr1050Vlm" column="CCR1050_VLM"/>
		<result property="ccr10Vlm" column="CCR10_VLM"/>
		<result property="bdwgPerOrdrVlm" column="BDWG_PER_ORDR_VLM"/>
		<result property="lmttPerdDdcn" column="LMTT_PERD_DDCN"/>
		<result property="dys1LmttVlm" column="DYS1_LMTT_VLM"/>
		<result property="bdwgPerOrdrVlunCd" column="BDWG_PER_ORDR_VLUN_CD"/>
		<result property="lmttVlunCd" column="LMTT_VLUN_CD"/>
		<result property="lmttPerdWrnnKindCd" column="LMTT_PERD_WRNN_KIND_CD"/>
		<result property="lmttVlmWrnnKindCd" column="LMTT_VLM_WRNN_KIND_CD"/>
		<result property="ntm1" column="NTM1"/>
		<result property="drdrCd1" column="DRDR_CD1"/>
		<result property="unslCtn1" column="UNSL_CTN1"/>
		<result property="ordrVlm1" column="ORDR_VLM1"/>
		<result property="ntm2" column="NTM2"/>
		<result property="drdrCd2" column="DRDR_CD2"/>
		<result property="unslCtn2" column="UNSL_CTN2"/>
		<result property="ordrVlm2" column="ORDR_VLM2"/>
		<result property="ntm3" column="NTM3"/>
		<result property="drdrCd3" column="DRDR_CD3"/>
		<result property="unslCtn3" column="UNSL_CTN3"/>
		<result property="ordrVlm3" column="ORDR_VLM3"/>
		<result property="ntm4" column="NTM4"/>
		<result property="drdrCd4" column="DRDR_CD4"/>
		<result property="unslCtn4" column="UNSL_CTN4"/>
		<result property="ordrVlm4" column="ORDR_VLM4"/>
		<result property="acdgAddtCtn" column="ACDG_ADDT_CTN"/>
		<result property="ordrPlacClsfCd" column="ORDR_PLAC_CLSF_CD"/>
		<result property="anagSetNo" column="ANAG_SET_NO"/>
		<result property="anagSetSno" column="ANAG_SET_SNO"/>
		<result property="encrAnagSno" column="ENCR_ANAG_SNO"/>
		<result property="hgrnOsetSno" column="HGRN_OSET_SNO"/>
		<result property="anagEtorYn" column="ANAG_ETOR_YN"/>
		<result property="anagEtorResnCd" column="ANAG_ETOR_RESN_CD"/>
		<result property="anagEtorResnCtn" column="ANAG_ETOR_RESN_CTN"/>
		<result property="osetSno1" column="OSET_SNO1"/>
		<result property="osetSno2" column="OSET_SNO2"/>
		<result property="osetSno3" column="OSET_SNO3"/>
		<result property="osetSno4" column="OSET_SNO4"/>
		<result property="osetSno5" column="OSET_SNO5"/>
		<result property="anclCd1" column="ANCL_CD1"/>
		<result property="anclCd2" column="ANCL_CD2"/>
		<result property="anclCd3" column="ANCL_CD3"/>
		<result property="anclCd4" column="ANCL_CD4"/>
		<result property="anclCd5" column="ANCL_CD5"/>
		<result property="prgnYn" column="PRGN_YN"/>
		<result property="rcrdYn" column="RCRD_YN"/>
		<result property="asttDlgtYn" column="ASTT_DLGT_YN"/>
		<result property="rcrdOptnDvsnCd" column="RCRD_OPTN_DVSN_CD"/>
		<result property="actnNtm" column="ACTN_NTM"/>
		<result property="mdatTrgtYn" column="MDAT_TRGT_YN"/>
		<result property="abmTrgtYn" column="ABM_TRGT_YN"/>
		<result property="frnsCtrlDvsnCd1" column="FRNS_CTRL_DVSN_CD1"/>
		<result property="fludTotlQty" column="FLUD_TOTL_QTY"/>
		<result property="fludOverVl" column="FLUD_OVER_VL"/>
		<result property="fludCcHrVl" column="FLUD_CC_HR_VL"/>
		<result property="fludQHrVl" column="FLUD_Q_HR_VL"/>
		<result property="implOrdrPblcLmttNtm" column="IMPL_ORDR_PBLC_LMTT_NTM"/>
		<result property="chmpYn" column="CHMP_YN"/>
		<result property="setOrdrDetlCtn" column="SET_ORDR_DETL_CTN"/>
		<result property="baseVlmClclTypeCd" column="BASE_VLM_CLCL_TYPE_CD"/>
		<result property="acdgAdmnMi" column="ACDG_ADMN_MI"/>
		<result property="acdgClclVl" column="ACDG_CLCL_VL"/>
		<result property="antcEdctDvsnCd" column="ANTC_EDCT_DVSN_CD"/>
		<result property="antcOrdvVl" column="ANTC_ORDV_VL"/>
		<result property="antcInjtAdmnMthdCtn" column="ANTC_INJT_ADMN_MTHD_CTN"/>
		<result property="ijtbMthdCd" column="IJTB_MTHD_CD"/>
		<result property="frnsDprtCd" column="FRNS_DPRT_CD"/>
		<result property="mdtnVlunCd" column="MDTN_VLUN_CD"/>
		<result property="mdtnPrkgVlm" column="MDTN_PRKG_VLM"/>
		<result property="tprnOrdrYn" column="TPRN_ORDR_YN"/>
		<result property="bsisOrdrPackOrdrCd" column="BSIS_ORDR_PACK_ORDR_CD"/>
		<result property="afiBsisOrdrCdNm" column="AFI_BSIS_ORDR_CD_NM"/>
		<result property="lwrnOrdrSno" column="LWRN_ORDR_SNO"/>
		<result property="cnntOrdrBndlNo" column="CNNT_ORDR_BNDL_NO"/>
		<result property="bsisOrdrVrsnVl" column="BSIS_ORDR_VRSN_VL"/>
		<result property="afiBsisOrdrVrsnUpdtYn" column="AFI_BSIS_ORDR_VRSN_UPDT_YN"/>
		<result property="prepOrdrYn" column="PREP_ORDR_YN"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="afiOrdrCltyNm" column="AFI_ORDR_CLTY_NM"/>
		<result property="rpmdId" column="RPMD_ID"/>
		<result property="rpmdNm" column="RPMD_NM"/>
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="invnPcunCd" column="INVN_PCUN_CD"/>
		<result property="icunCd" column="ICUN_CD"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="slipCd" column="SLIP_CD"/>
		<result property="ststDvsnCd" column="STST_DVSN_CD"/>
		<result property="antbYn" column="ANTB_YN"/>
		<result property="pcunInlsQty" column="PCUN_INLS_QTY"/>
		<result property="ordrPsblDvsnCd" column="ORDR_PSBL_DVSN_CD"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="tdmCdDvsnCd" column="TDM_CD_DVSN_CD"/>
		<result property="mdcrBeexYn" column="MDCR_BEEX_YN"/>
		<result property="fludOrdrYn" column="FLUD_ORDR_YN"/>
		<result property="drapDvsnCd" column="DRAP_DVSN_CD"/>
		<result property="acmpYn" column="ACMP_YN"/>
		<result property="tims1TotlQtyYn" column="TIMS1_TOTL_QTY_YN"/>
		<result property="dgfrCd" column="DGFR_CD"/>
		<result property="kitMdprDdcn" column="KIT_MDPR_DDCN"/>
		<result property="mdprClsfCd" column="MDPR_CLSF_CD"/>
		<result property="frnsCtrlDvsnCd" column="FRNS_CTRL_DVSN_CD"/>
		<result property="ihohDvsnCd" column="IHOH_DVSN_CD"/>
		<result property="sdpfExreCd" column="SDPF_EXRE_CD"/>
		<result property="sbsnMdprCtn" column="SBSN_MDPR_CTN"/>
		<result property="sbsnMdprAbslDslwYn" column="SBSN_MDPR_ABSL_DSLW_YN"/>
		<result property="mdfeItdvCd" column="MDFE_ITDV_CD"/>
		<result property="insrIpdvCd" column="INSR_IPDV_CD"/>
		<result property="prtcIpdvCd" column="PRTC_IPDV_CD"/>
		<result property="incsIpdvCd" column="INCS_IPDV_CD"/>
		<result property="tainIpdvCd" column="TAIN_IPDV_CD"/>
		<result property="excfCd" column="EXCF_CD"/>
		<result property="acgrCd" column="ACGR_CD"/>
		<result property="indtKindVl" column="INDT_KIND_VL"/>
		<result property="acdgAddtCtn1" column="ACDG_ADDT_CTN1"/>
		<result property="sbsnOrdrCd" column="SBSN_ORDR_CD"/>
		<result property="ordrNm1" column="ORDR_NM_1"/>
		<result property="chldIcunCd" column="CHLD_ICUN_CD"/>
		<result property="chldPcunIcqyVl" column="CHLD_PCUN_ICQY_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpCpptOrdrInqrDAO-listCpptStepClbyOrdr (CP환자 단계별처방 조회) 
        Description :                                           CP환자 단계별처방 조회 mdd_cppatdt_l01
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpCpptOrdrInqrDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpCpptOrdrInqrDAO-listCpptStepClbyOrdr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpCpptOrdrInqrDAO-listCpptStepClbyOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpCpptOrdrInqrDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpCpptOrdrInqrDAO-listCpptStepClbyOrdr-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpCpptOrdrInqrDAO-listCpptStepClbyOrdr */
		        OROC_CD                      /* 처방발생원코드 */
		     ,  CP_STEP_NO                   /* CP단계번호 */
		     ,  ORDR_CRTN_LNKN_NO            /* 처방생성연결번호 */
		     ,  ORDR_SNO
		     /* 처방 SET 영역 */
		     ,  0                            as GRID_ROW_SQNC
		     ,  SAVE_DVSN_CD                 /* 처방입력구분 */
		     ,  SCIN_CD                      -- 상병코드
		     ,  ORDR_CD                      -- 처방코드
		     /*------------------------------------------------------------------------------------*/
		     /* ★중요★  : 이하 컬럼은 아래 DAM 과 모두 동일해야 함                                 */
		     /* mdd_osetdtt_l01 / mdd_osetdht_l01/ mdd_cppatdt_l01 / med_acmdplt_l02               */
		     /* -  처방 모듈에 세팅 시 사용하는 컬럼 임                                            */
		     /*------------------------------------------------------------------------------------*/
		     ,  BSIS_ORDR_NM                 -- 처방명(기본처방)
		     ,  ORDR_CLTY_CD1                -- 처방분류유형
		     ,  ORFR_CD                      -- 처방형태코드
		     ,  ODKI_CD                      -- 처방종류
		     ,  ODKI_DETL_CD                 -- 처방종류상세코드
		     ,  SLCT_UNIT_DVSN_CD            -- 선택단위구분코드'1'포장,'2'함량
		     ,  PCKN_UNAD_QTY                -- 포장단위투여량
		     ,  PCUN_CD                      -- 포장단위코드
		     ,  ICUN_ADMN_VLM                -- 함량단위투여용량
		     ,  ICUN_CD1                     -- 함량단위코드
		     ,  OSET_DETL_NTM                -- 처방SET상세횟수
		     ,  DDCN                         -- 일수
		     ,  DRUS_CD                      -- 용법코드
		     ,  (select  DRUG_DLVY_DPRT_CD 
		           from  SDDMETCDT sa
		          where  DRUS_CD = a.DRUS_CD) as DRUG_DLVY_DPRT_CD  /* 약전달부서코드 */
		     ,  DRBN_NO                      -- 약묶음번호
		     ,  SNGN_BNDL_YN                 -- 단독묶음번호
		     ,  MIX_KIND_CD                  -- MIX종류
		     ,  ASTS_YN                      -- AST여부
		     ,  ORDR_IPDV_CD                 -- 처방급여구분코드
		     ,  OSET_DETL_UNSL_CTN           -- 상세특이사항
		     ,  PTPT_CD                      -- 환자가야할장소
		     ,  SPCM_CD1                     -- 수혈인경우에는 수혈종류M. 그외는 검체코드1
		     ,  SPCM_CD2                     -- 검체코드2
		     ,  PRTB_YN                      -- PORTABLE 여부
		     ,  UPLT_RWTT_VL                 -- 치열(상좌)
		     ,  UPRG_RWTT_VL                 -- 치열(상우)
		     ,  LWLF_RWTT_VL                 -- 치열(하좌)
		     ,  LWRG_RWTT_VL                 -- 치열(하우)
		     ,  MDSI_CD                      -- 치료부위
		     ,  MDSI_NM  					 -- (재활) 치료부위명
		     ,  MDTE_LCTN_CD                 -- 치료위치
		     ,  AFI_MDTE_LCTN_NM  		     -- (재활) 치료부위명
		     ,  MDTE_FRQN_CD                 -- 치료빈도
		     ,  AFI_MDTE_FRQN_NM  		     -- (재활) 치료빈도명
		     ,  ONDY_MDTE_NTM                -- 치료횟수(1일)
		     ,  AFI_ONDY_MDTE_NTM_STR 	     -- (재활) 치료횟수(1일)명
		     ,  MDTE_DDCN                    -- 치료일수
		     ,  ACDG_MIX_DVSN_CD             -- 항암제혼합구분코드
		     ,  CCR90_VLM                    -- Ccr 90 mL/min 초과
		     ,  CCR5090_VLM                  -- Ccr50~90 mL/min
		     ,  CCR1050_VLM                  -- Ccr10~50 mL/min
		     ,  CCR10_VLM                    -- Ccr 10 mL/min 미만
		     ,  BDWG_PER_ORDR_VLM            -- 체중당(kg)처방용량
		     ,  LMTT_PERD_DDCN               -- 제한기간(일수)
		     ,  DYS1_LMTT_VLM                -- 제한용량(1일)
		     ,  BDWG_PER_ORDR_VLUN_CD        -- 체중당(kg)처방용량 단위
		     ,  LMTT_VLUN_CD                 -- 제한욜량단위코드
		     ,  LMTT_PERD_WRNN_KIND_CD       -- 제한기간경고종류
		     ,  LMTT_VLM_WRNN_KIND_CD        -- 제한용량경고종류
		     ,  NTM1                         -- 횟수1
		     ,  DRDR_CD1                     -- 용법코드1
		     ,  UNSL_CTN1                    -- 특이내용1
		     ,  ORDR_VLM1                    -- 처방용량1
		     ,  NTM2                         -- 횟수2
		     ,  DRDR_CD2                     -- 용법코드2
		     ,  UNSL_CTN2                    -- 특이내용2
		     ,  ORDR_VLM2                    -- 처방용량2
		     ,  NTM3                         -- 횟수3
		     ,  DRDR_CD3                     -- 용법코드3
		     ,  UNSL_CTN3                    -- 특이내용3
		     ,  ORDR_VLM3                    -- 처방용량3
		     ,  NTM4                         -- 횟수4
		     ,  DRDR_CD4                     -- 용법코드4
		     ,  UNSL_CTN4                    -- 특이내용4
		     ,  ORDR_VLM4                    -- 처방용량4
		     ,  ACDG_ADDT_CTN                -- 항암제투여일내용
		     ,  ORDR_PLAC_CLSF_CD            -- 처방장소분류코드
		     ,  ANAG_SET_NO                  -- 항균제-SET순번
		     ,  ANAG_SET_SNO                 -- 항균제SET일련번호
		     ,  ENCR_ANAG_SNO                -- 권장항균제일련번호
		     ,  HGRN_OSET_SNO                -- 상위set일련번호
		     ,  ANAG_ETOR_YN                 -- 항균제-기타처방여부
		     ,  ANAG_ETOR_RESN_CD            -- 항균제-기타처방사유코드
		     ,  ANAG_ETOR_RESN_CTN           -- 항균제기타처방사유내용
		     ,  OSET_SNO1                    -- 항균제-경로1
		     ,  OSET_SNO2                    -- 항균제-경로2
		     ,  OSET_SNO3                    -- 항균제-경로3
		     ,  OSET_SNO4                    -- 항균제-경로4
		     ,  OSET_SNO5                    -- 항균제-경로5
		     ,  ANCL_CD1                     -- 항균제분류1 = 성분1
		     ,  ANCL_CD2                     -- 항균제분류2 = 미생물코드
		     ,  ANCL_CD3                     -- 항균제분류3 = 기타처방여부
		     ,  ANCL_CD4                     -- 항균제분류4 = 미생물항생제코드
		     ,  ANCL_CD5                     -- 항균제분류5 = AG용법구분(A) / 투석구분(H)
		     ,  PRGN_YN                      -- 항균제-임신여부
		     ,  RCRD_YN                      -- 기록여부
		     ,  ASTT_DLGT_YN                 -- 보조원위임여부
		     ,  RCRD_OPTN_DVSN_CD            -- 기록옵션구분코드
		     ,  ACTN_NTM                     -- 액팅횟수
		     ,  MDAT_TRGT_YN                 -- 의평대상여부
		     ,  ABM_TRGT_YN                  -- ABM대상여부
		     ,  FRNS_CTRL_DVSN_CD1           -- 불출제어 정보
		     ,  FLUD_TOTL_QTY                -- Fluid 총량
		     ,  FLUD_OVER_VL                 -- Fluid Over
		     ,  FLUD_CC_HR_VL                -- Fluid With cc/hr
		     ,  FLUD_Q_HR_VL                 -- Fluid Q
		     ,  IMPL_ORDR_PBLC_LMTT_NTM      -- 실시처방발생제한횟수
		     ,  CHMP_YN                      -- Chemo Op여부(외래사용여부)
		     ,  SET_ORDR_DETL_CTN            -- set처방상세내용
		     ,  BASE_VLM_CLCL_TYPE_CD        -- 기준용량계산유형코드 Fix, Kg, BSA, AUC
		     ,  ACDG_ADMN_MI                 -- 항암제 투여 시간 (분 단위)
		     ,  ACDG_CLCL_VL                 -- 항암제 계산값
		     ,  ANTC_EDCT_DVSN_CD            -- 항암교육 구분(1:신환,2:변경)
		     ,  ANTC_ORDV_VL                 -- 항암처방 구분(A:공통, I:입원, O:외래)
		     ,  ANTC_INJT_ADMN_MTHD_CTN      -- 항암주사방법(01:말초혈관,02:중심정맥,03:Chemo-port)
		     ,  IJTB_MTHD_CD                 -- 주사관방법코드
		     ,  FRNS_DPRT_CD                 -- 불출부서코드
		     ,  MDTN_VLUN_CD                 -- 투여용량단위코드
		     ,  MDTN_PRKG_VLM                -- 투여kg당용량
		     ,  TPRN_ORDR_YN                 -- Tapering처방여부
		     ,  BSIS_ORDR_PACK_ORDR_CD       /* 기본처방Pack처방코드 */
		     ,  AFI_BSIS_ORDR_CD_NM          /* AFI기본처방코드명 */
		     ,  LWRN_ORDR_SNO                /* 하위처방일련번호 */
		     ,  CNNT_ORDR_BNDL_NO            /* 동시처방묶음번호 */
		     ,  BSIS_ORDR_VRSN_VL            /* 기본처방버전값 */
		     ,  AFI_BSIS_ORDR_VRSN_UPDT_YN   /* 기본처방 버젼 update 여부 */
		     ,  PREP_ORDR_YN				 /* PREP처방여부 */
		     ,  CLRS_PRJC_CD                 /* 임상연구과제코드 */
		     ,  AFI_ORDR_CLTY_NM             -- 처방분류유형명
		     ,  RPMD_ID                      -- 대표약품ID
		     ,  RPMD_NM                      -- 대표약품명
		     ,  ORDR_CLTY_CD                 -- 처방분류유형코드M.
		     ,  INVN_PCUN_CD                 -- 재고포장단위코드.M
		     ,  ICUN_CD                      -- 함량단위코드M.
		     ,  ORDR_NM                      -- 처방명.M
		     ,  SLIP_CD                      -- Slip코드.M
		     ,  STST_DVSN_CD                 -- 통계구분('7'=제한항균제,'5'=수액)M
		     ,  ANTB_YN                      -- 항생제여부M.
		     ,  PCUN_INLS_QTY                -- 포장단위량M
		     ,  ORDR_PSBL_DVSN_CD            -- 처방가능구분M.
		     ,  ORCL_CD                      -- 처방분류M.
		     ,  TDM_CD_DVSN_CD               -- TDM코드구분M.
		     ,  MDCR_BEEX_YN                 -- 진료이전검사여부M.
		     ,  FLUD_ORDR_YN                 -- 수액처방여부M
		     ,  DRAP_DVSN_CD                 -- 약적용구분코드M
		     ,  ACMP_YN                      -- 동반여부M
		     ,  TIMS1_TOTL_QTY_YN            -- 1회총량여부여부M
		     ,  DGFR_CD                      -- 제형코드M
		     ,  KIT_MDPR_DDCN                -- 키트약품일수M
		     ,  MDPR_CLSF_CD                 -- 약품분류코드M
		     ,  FRNS_CTRL_DVSN_CD            -- 불출제어구분코드M
		     ,  IHOH_DVSN_CD                 -- 원내원외구분코드M.
		     ,  SDPF_EXRE_CD                 -- 원내사유코드M.
		     ,  SBSN_MDPR_CTN                -- 대체약품내용M.
		     ,  SBSN_MDPR_ABSL_DSLW_YN       -- 대체약품절대불가M.
		     ,  MDFE_ITDV_CD                 -- 입력구분(수가M.)
		     ,  INSR_IPDV_CD                 -- 급여구분코드 수가M.
		     ,  PRTC_IPDV_CD                 -- 보호급여구분 수가M.
		     ,  INCS_IPDV_CD                 -- 산재급여코드 수가M.
		     ,  TAIN_IPDV_CD                 -- 자보급여코드 수가M.
		     ,  EXCF_CD                      -- 검사분류 처방M.
		     --------------------------------------------------------------------------------------
		     -- 추가 컬럼
		     --------------------------------------------------------------------------------------
		     ,  ACGR_CD                      /* 항암제그룹코드M. */
		     ,  INDT_KIND_VL                 /* 적응증종류값M. */
		     ,  ''                              as ACDG_ADDT_CTN1               /* 항암제투여일내용 */
		     ,  SBSN_ORDR_CD                    as SBSN_ORDR_CD                 /* 대체처방코드 */
		     ,  ORDR_NM_1                       as ORDR_NM_1                    /* 대체처방명 */
		     ,  CHLD_ICUN_CD                    as CHLD_ICUN_CD
		     ,  CHLD_PCUN_ICQY_VL               as CHLD_PCUN_ICQY_VL
		  from
		  (  select
		          /*--------------------------------------------------------------------------------------*/
		          /* 화면에서 제어하는 것을 변경 함 (병동 : 수술료 / DSC : 처방 조회 시점에서 체크        */
		          /*--------------------------------------------------------------------------------------*/
		          /* case when y.CP_USE_PRVC_CD = 'I' then 'W'
		          /*      when y.CP_USE_PRVC_CD = 'D' then case when z.MERG_CP_STEP_DD_ORNO = 1 then 'F' -- 준비실(DSC) */
		          /*                                            when z.MERG_CP_STEP_DD_ORNO = 2 then 'G' -- 수술실(DSC) */
		          /*                                            when z.MERG_CP_STEP_DD_ORNO = 3 then 'H' -- 회복실(DSC) */
		          /*                                            when z.MERG_CP_STEP_DD_ORNO = 4 then 'I' -- 안정실(DSC) */
		          /*                                                                            else ''                 */
		          /*                                       end   */
		          /*                                  else ''    */
		          /* end                             as OROC_CD  */                  /* 처방발생원코드 */ 
		          /*--------------------------------------------------------------------------------------*/
		             ''                              as OROC_CD                      /* 처방발생원코드 */
		          ,  z.MERG_CP_STEP_DD_ORNO          as CP_STEP_NO                   /* CP단계번호 For DSC 전체조회 */
		          /*--------------------------------------------------------------------------------------*/
		          ,  a.ORDR_CRTN_LNKN_NO             as ORDR_CRTN_LNKN_NO            /* 처방생성연결번호 */
		          ,  a.ORDR_SNO                      as ORDR_SNO
		          /* 처방 SET 영역 */
		          , 'I'                              as SAVE_DVSN_CD
		          ,  a.SCIN_CD                       as SCIN_CD                      -- 상병코드
		          ,  a.CP_ORDR_CD                    as ORDR_CD                      -- 처방코드
		          ,  a.ORDR_NM                       as BSIS_ORDR_NM                 -- 처방명(기본처방)
		          ,  b.ORDR_CLTY_CD                  as ORDR_CLTY_CD1                -- 처방분류유형
		          ,  a.ORFR_CD                       as ORFR_CD                      -- 처방형태코드
		          ,  a.ODKI_CD                       as ODKI_CD                      -- 처방종류
		          ,  a.ODKI_DETL_CD                  as ODKI_DETL_CD                 -- 처방종류상세코드
		          ,  a.SLCT_UNIT_DVSN_CD             as SLCT_UNIT_DVSN_CD            -- 선택단위구분코드'1'포장,'2'함량
		          ,  a.PCKN_UNAD_QTY                 as PCKN_UNAD_QTY                -- 포장단위투여량
		          ,  a.PCUN_CD                       as PCUN_CD                      -- 포장단위코드
		          ,  a.ICUN_ADMN_VLM                 as ICUN_ADMN_VLM                -- 함량단위투여용량
		          ,  a.ICUN_CD                       as ICUN_CD1                     -- 함량단위코드
		          ,  a.OSET_DETL_NTM                 as OSET_DETL_NTM                -- 처방SET상세횟수
		          ,  a.DDCN                          as DDCN                         -- 일수
		          ,  a.DRUS_CD                       as DRUS_CD                      -- 용법코드
		          ,  a.DRBN_NO                       as DRBN_NO                      -- 약묶음번호
		          ,  a.SNGN_BNDL_YN                  as SNGN_BNDL_YN                 -- 단독묶음번호
		          ,  a.MIX_KIND_CD                   as MIX_KIND_CD                  -- MIX종류
		          ,  a.ASTS_YN                       as ASTS_YN                      -- AST여부
		          ,  a.ORDR_IPDV_CD                  as ORDR_IPDV_CD                 -- 처방급여구분코드
		          ,  a.OSET_DETL_UNSL_CTN            as OSET_DETL_UNSL_CTN           -- 상세특이사항
		          ,  decode(substr(b.ORDR_CLTY_CD,1,1), 'C', b.PTPT_CD, a.PTPT_CD)   as PTPT_CD  -- 환자가야할장소
		          ,  decode(b.ORDR_CLTY_CD,'E1', b.TDM_CD_DVSN_CD, a.SPCM_CD1)       as SPCM_CD1 -- 수혈인경우에는 수혈종류M. 그외는 검체코드1
		          ,  a.SPCM_CD2                      as SPCM_CD2                     -- 검체코드2
		          ,  a.PRTB_YN                       as PRTB_YN                      -- PORTABLE 여부
		          ,  a.UPLT_RWTT_VL                  as UPLT_RWTT_VL                 -- 치열(상좌)
		          ,  a.UPRG_RWTT_VL                  as UPRG_RWTT_VL                 -- 치열(상우)
		          ,  a.LWLF_RWTT_VL                  as LWLF_RWTT_VL                 -- 치열(하좌)
		          ,  a.LWRG_RWTT_VL                  as LWRG_RWTT_VL                 -- 치열(하우)
		          ,  a.MDSI_CD                       as MDSI_CD                      -- 치료부위
		          ,  ( select DETL_CD_NM from CCCMCDDMT where COMN_GRP_CD = 'SH004' and COMN_DTLS_CD = a.MDSI_CD) 		as MDSI_NM  				-- (재활) 치료부위명
		          ,  a.MDTE_LCTN_CD                  as MDTE_LCTN_CD                 -- 치료위치
		          ,  ( select DETL_CD_NM from CCCMCDDMT where COMN_GRP_CD = 'MM191' and COMN_DTLS_CD = a.MDTE_LCTN_CD) 	as AFI_MDTE_LCTN_NM  		-- (재활) 치료부위명
		          ,  a.MDTE_FRQN_CD                  as MDTE_FRQN_CD                 -- 치료빈도
		          ,  ( select DETL_CD_NM from CCCMCDDMT where COMN_GRP_CD = 'SH005' and COMN_DTLS_CD = a.MDTE_FRQN_CD) 	as AFI_MDTE_FRQN_NM  		-- (재활) 치료빈도명
		          ,  a.ONDY_MDTE_NTM                 as ONDY_MDTE_NTM                -- 치료횟수(1일)
		          ,  ( select DETL_CD_NM from CCCMCDDMT where COMN_GRP_CD = 'SH006' and COMN_DTLS_CD = a.ONDY_MDTE_NTM) 	as AFI_ONDY_MDTE_NTM_STR 	-- (재활) 치료횟수(1일)명
		          ,  a.MDTE_DDCN                     as MDTE_DDCN                    -- 치료일수
		          ,  a.ACDG_MIX_DVSN_CD              as ACDG_MIX_DVSN_CD             -- 항암제혼합구분코드
		          ,  a.CCR90_VLM                     as CCR90_VLM                    -- Ccr 90 mL/min 이상
		          ,  a.CCR5090_VLM                   as CCR5090_VLM                  -- Ccr50~90 mL/min
		          ,  a.CCR1050_VLM                   as CCR1050_VLM                  -- Ccr10~50 mL/min
		          ,  a.CCR10_VLM                     as CCR10_VLM                    -- Ccr 10 mL/min 미만
		          ,  a.BDWG_PER_ORDR_VLM             as BDWG_PER_ORDR_VLM            -- 체중당(kg)처방용량
		          ,  a.LMTT_PERD_DDCN                as LMTT_PERD_DDCN               -- 제한기간(일수)
		          ,  a.DYS1_LMTT_VLM                 as DYS1_LMTT_VLM                -- 제한용량(1일)
		          ,  a.BDWG_PER_ORDR_VLUN_CD         as BDWG_PER_ORDR_VLUN_CD        -- 체중당(kg)처방용량 단위
		          ,  a.LMTT_VLUN_CD                  as LMTT_VLUN_CD                 -- 제한욜량단위코드
		          ,  a.LMTT_PERD_WRNN_KIND_CD        as LMTT_PERD_WRNN_KIND_CD       -- 제한기간경고종류
		          ,  a.LMTT_VLM_WRNN_KIND_CD         as LMTT_VLM_WRNN_KIND_CD        -- 제한용량경고종류
		          ,  a.NTM1                          as NTM1                         -- 횟수1
		          ,  a.DRDR_CD1                      as DRDR_CD1                     -- 용법코드1
		          ,  a.UNSL_CTN1                     as UNSL_CTN1                    -- 특이내용1
		          ,  a.ORDR_VLM1                     as ORDR_VLM1                    -- 처방용량1
		          ,  a.NTM2                          as NTM2                         -- 횟수2
		          ,  a.DRDR_CD2                      as DRDR_CD2                     -- 용법코드2
		          ,  a.UNSL_CTN2                     as UNSL_CTN2                    -- 특이내용2
		          ,  a.ORDR_VLM2                     as ORDR_VLM2                    -- 처방용량2
		          ,  a.NTM3                          as NTM3                         -- 횟수3
		          ,  a.DRDR_CD3                      as DRDR_CD3                     -- 용법코드3
		          ,  a.UNSL_CTN3                     as UNSL_CTN3                    -- 특이내용3
		          ,  a.ORDR_VLM3                     as ORDR_VLM3                    -- 처방용량3
		          ,  a.NTM4                          as NTM4                         -- 횟수4
		          ,  a.DRDR_CD4                      as DRDR_CD4                     -- 용법코드4
		          ,  a.UNSL_CTN4                     as UNSL_CTN4                    -- 특이내용4
		          ,  a.ORDR_VLM4                     as ORDR_VLM4                    -- 처방용량4
		          ,  a.ACDG_ADDT_CTN                 as ACDG_ADDT_CTN                -- 항암제투여일내용
		          ,  a.ORDR_PLAC_CLSF_CD             as ORDR_PLAC_CLSF_CD            -- 처방장소분류코드
		          ,  a.ANAG_SET_NO                   as ANAG_SET_NO                  -- 항균제-SET순번
		          ,  a.ANAG_SET_SNO                  as ANAG_SET_SNO                 -- 항균제SET일련번호
		          ,  a.ENCR_ANAG_SNO                 as ENCR_ANAG_SNO                -- 권장항균제일련번호
		          ,  a.HGRN_OSET_SNO                 as HGRN_OSET_SNO                -- 상위set일련번호
		          ,  a.ANAG_ETOR_YN                  as ANAG_ETOR_YN                 -- 항균제-기타처방여부
		          ,  a.ANAG_ETOR_RESN_CD             as ANAG_ETOR_RESN_CD            -- 항균제-기타처방사유코드
		          ,  a.ANAG_ETOR_RESN_CTN            as ANAG_ETOR_RESN_CTN           -- 항균제기타처방사유내용
		          ,  a.OSET_SNO1                     as OSET_SNO1                    -- 항균제-경로1
		          ,  a.OSET_SNO2                     as OSET_SNO2                    -- 항균제-경로2
		          ,  a.OSET_SNO3                     as OSET_SNO3                    -- 항균제-경로3
		          ,  a.OSET_SNO4                     as OSET_SNO4                    -- 항균제-경로4
		          ,  a.OSET_SNO5                     as OSET_SNO5                    -- 항균제-경로5
		          ,  a.ANCL_CD1                      as ANCL_CD1                     -- 항균제분류1 = 성분1
		          ,  a.ANCL_CD2                      as ANCL_CD2                     -- 항균제분류2 = 미생물코드
		          ,  a.ANCL_CD3                      as ANCL_CD3                     -- 항균제분류3 = 기타처방여부
		          ,  a.ANCL_CD4                      as ANCL_CD4                     -- 항균제분류4 = 미생물항생제코드
		          ,  a.ANCL_CD5                      as ANCL_CD5                     -- 항균제분류5 = AG용법구분(A) / 투석구분(H)
		          ,  a.PRGN_YN                       as PRGN_YN                      -- 항균제-임신여부
		          ,  a.RCRD_YN                       as RCRD_YN                      -- 기록여부
		          ,  a.ASTT_DLGT_YN                  as ASTT_DLGT_YN                 -- 보조원위임여부
		          ,  a.RCRD_OPTN_DVSN_CD             as RCRD_OPTN_DVSN_CD            -- 기록옵션구분코드
		          ,  a.ACTN_NTM                      as ACTN_NTM                     -- 액팅횟수
		          ,  a.MDAT_TRGT_YN                  as MDAT_TRGT_YN                 -- 의평대상여부
		          ,  a.ABM_TRGT_YN                   as ABM_TRGT_YN                  -- ABM대상여부
		          ,  a.FRNS_CTRL_DVSN_CD             as FRNS_CTRL_DVSN_CD1           -- 불출제어 정보
		          ,  a.FLUD_TOTL_QTY                 as FLUD_TOTL_QTY                -- Fluid 총량
		          ,  a.FLUD_OVER_VL                  as FLUD_OVER_VL                 -- Fluid Over
		          ,  a.FLUD_CC_HR_VL                 as FLUD_CC_HR_VL                -- Fluid With cc/hr
		          ,  a.FLUD_Q_HR_VL                  as FLUD_Q_HR_VL                 -- Fluid Q
		          ,  a.IMPL_ORDR_PBLC_LMTT_NTM       as IMPL_ORDR_PBLC_LMTT_NTM      -- 실시처방발생제한횟수
		          ,  a.CHMP_YN                       as CHMP_YN                      -- Chemo Op여부(외래사용여부)
		          ,  a.SET_ORDR_DETL_CTN             as SET_ORDR_DETL_CTN            -- set처방상세내용
		          ,  a.BASE_VLM_CLCL_TYPE_CD         as BASE_VLM_CLCL_TYPE_CD        -- 기준용량계산유형코드 Fix, Kg, BSA, AUC
		          ,  a.ACDG_ADMN_MI                  as ACDG_ADMN_MI                 -- 항암제 투여 시간 (분 단위)
		          ,  a.ACDG_CLCL_VL                  as ACDG_CLCL_VL                 -- 항암제 계산값
		          ,  a.ANTC_EDCT_DVSN_CD             as ANTC_EDCT_DVSN_CD            -- 항암교육 구분(1:신환,2:변경)
		          ,  a.ANTC_ORDV_VL                  as ANTC_ORDV_VL                 -- 항암처방 구분(A:공통, I:입원, O:외래)
		          ,  a.ANTC_INJT_ADMN_MTHD_CTN       as ANTC_INJT_ADMN_MTHD_CTN      -- 항암주사방법(01:말초혈관,02:중심정맥,03:Chemo-port)
		          ,  a.IJTB_MTHD_CD                  as IJTB_MTHD_CD                 -- 주사관방법코드
		          ,  a.FRNS_DPRT_CD                  as FRNS_DPRT_CD                 -- 불출부서코드
		          ,  a.MDTN_VLUN_CD                  as MDTN_VLUN_CD                 -- 투여용량단위코드
		          ,  a.MDTN_PRKG_VLM                 as MDTN_PRKG_VLM                -- 투여kg당용량
		          ,  a.TPRN_ORDR_YN                  as TPRN_ORDR_YN                 -- Tapering처방여부
		          ,  a.BSIS_ORDR_PACK_ORDR_CD        as BSIS_ORDR_PACK_ORDR_CD       /* 기본처방Pack처방코드 */
		<![CDATA[
		          -- ,  case when a.CNNT_ORDR_BNDL_NO > 0 then case when a.BSIS_ORDR_PACK_ORDR_CD is null then a.ORDR_NM      /* PACK 처방코드가 없으면 처방명으로 - 기본처방 */
		          --                                                                                      else ( select       /* PACK 처방코드가 있으면 PACK 처방코드 검색 */
		          --                                                                                                    DETL_IDCT_CTN
		          --                                                                                               from
		          --                                                                                                    MDDBOPKBT
		          --                                                                                              where
		          --                                                                                                    ORDR_CD       = a.BSIS_ORDR_PACK_ORDR_CD
		          --                                                                                                and LWRN_ORDR_SNO = a.LWRN_ORDR_SNO
		          --                                                                                                and rownum = 1 )
		          --                                           end
		          --                                      else b.ORDR_NM
		          --    end                             as AFI_BSIS_ORDR_CD_NM          /* AFI기본처방코드명 */
		          ,  case when a.CNNT_ORDR_BNDL_NO > 0 then a.ORDR_NM                    /* PACK 처방 */
		                                               else b.ORDR_NM                    /* PACK 처방이 아니면 처방마스터의 기본처방 명 */
		             end                                 as AFI_BSIS_ORDR_CD_NM          /* AFI기본처방코드명 */
		]]>
		          ,  a.LWRN_ORDR_SNO                     as LWRN_ORDR_SNO                /* 하위처방일련번호 */
		          ,  a.CNNT_ORDR_BNDL_NO                 as CNNT_ORDR_BNDL_NO            /* 동시처방묶음번호 */
		          ,  b.BSIS_ORDR_VRSN_VL                 as BSIS_ORDR_VRSN_VL            /* 기본처방버전값 */
		<![CDATA[
		          ,  case when ( substr(b.ORDR_CLTY_CD, 1, 1) = 'A'         ) and
		                       ( a.BSIS_ORDR_VRSN_VL is not null            ) and
		                       ( b.BSIS_ORDR_VRSN_VL is not null            ) and
		                       ( a.BSIS_ORDR_VRSN_VL <> b.BSIS_ORDR_VRSN_VL )      then 'Y'
		                                                                           else ''
		             end                             as AFI_BSIS_ORDR_VRSN_UPDT_YN /* 기본처방 버젼 update 여부 */
		]]>
		          ,  a.PREP_ORDR_YN
		          ,  a.CLRS_PRJC_CD
		          , ( select DETL_CD_NM from CCCMCDDMT where COMN_GRP_CD = 'MM182' and COMN_DTLS_CD = b.ORDR_CLTY_CD and rownum = 1 ) as AFI_ORDR_CLTY_NM -- 처방분류유형명
		          ,  case when b.ORDR_CLTY_CD like 'B%' then ( select a1.RPMD_ID
		                                                         from SDMDISCRT a1
		                                                        where a1.MDPR_CD = a.CP_ORDR_CD
		                                                          and rownum = 1
		                                                     )
		                                                else null end    as RPMD_ID    -- 대표약품ID
		          ,  case when b.ORDR_CLTY_CD like 'B%' then ( select a2.RPMD_NM
		                                                         from SDMDISCRT a1
		                                                            , SDRPMDIDT a2
		                                                        where a1.MDPR_CD = a.CP_ORDR_CD
		                                                          and a2.RPMD_ID = a1.RPMD_ID
		                                                          and rownum = 1
		                                                     )
		                                                else null end    as RPMD_NM  -- 대표약품명
		          ,  a.ORDR_CLTY_CD                  as ORDR_CLTY_CD                 -- 처방분류유형코드M.
		          ,  b.INVN_PCUN_CD                  as INVN_PCUN_CD                 -- 재고포장단위코드.M
		          ,  b.ICUN_CD                       as ICUN_CD                      -- 함량단위코드M.
		          ,  b.ORDR_NM                       as ORDR_NM                      -- 처방명.M
		          ,  b.SLIP_CD                       as SLIP_CD                      -- Slip코드.M
		          ,  b.STST_DVSN_CD                  as STST_DVSN_CD                 -- 통계구분('7'=제한항균제,'5'=수액)M
		          ,  b.ANTB_YN                       as ANTB_YN                      -- 항생제여부M.
		          ,  b.PCUN_INLS_QTY                 as PCUN_INLS_QTY                -- 포장단위량M
		          ,  b.ORDR_PSBL_DVSN_CD             as ORDR_PSBL_DVSN_CD            -- 처방가능구분M.
		          ,  b.ORCL_CD                       as ORCL_CD                      -- 처방분류M.
		          ,  b.TDM_CD_DVSN_CD                as TDM_CD_DVSN_CD               -- TDM코드구분M.
		          ,  b.MDCR_BEEX_YN                  as MDCR_BEEX_YN                 -- 진료이전검사여부M.
		          ,  b.FLUD_ORDR_YN                  as FLUD_ORDR_YN                 -- 수액처방여부M
		          ,  b.DRAP_DVSN_CD                  as DRAP_DVSN_CD                 -- 약적용구분코드M
		          ,  b.ACMP_YN                       as ACMP_YN                      -- 동반여부M
		          ,  b.TIMS1_TOTL_QTY_YN             as TIMS1_TOTL_QTY_YN            -- 1회총량여부여부M
		          ,  b.DGFR_CD                       as DGFR_CD                      -- 제형코드M
		          ,  b.KIT_MDPR_DDCN                 as KIT_MDPR_DDCN                -- 키트약품일수M
		          ,  b.MDPR_CLSF_CD                  as MDPR_CLSF_CD                 -- 약품분류코드M
		          ,  (select a1.FRNS_CTRL_DVSN_CD
		                from SDJORDRCT a1
		               where a1.MDPR_CD = a.CP_ORDR_CD
		                 and a1.APST_YMD between trunc(sysdate) and trunc(sysdate)) as FRNS_CTRL_DVSN_CD     -- 불출제어구분코드M
		          ,  b.IHOH_DVSN_CD                  as IHOH_DVSN_CD                 -- 원내원외구분코드M.
		          ,  b.SDPF_EXRE_CD                  as SDPF_EXRE_CD                 -- 원내사유코드M.
		          ------------------------------------------------------------------------
		          -- b.ORDR_CLTY_CD = 'B1' 경구약
		          -- a.MIX_KIND_CD  = '2'  MIX종류      MM301 : 1 MIX /2 기타MIX(가루약/혼합조제) /3 알약으로
		          -- b.PWDR_DSLW_YN = 'Y'  산제불가여부
		          ------------------------------------------------------------------------
		          ,  case when b.ORDR_CLTY_CD like 'B%' then (select a1.SBSN_MDPR_CD
		                                                        from SDDREPLCT a1 /* 대체약품 */
		                                                          ,  MDORDRCMT b1 /* 처방마스터 */
		                                                       where a1.MDPR_CD           = a.CP_ORDR_CD
		                                                         and a1.SBSN_DVSN_CD      = '2'         /* 대체구분코드 : SDA_010 1 산제대체 / 2 일반대체 */
		                                                         and a1.SBSN_MDPR_CD      = b1.ORDR_CD
		                                                         and b1.ORDR_PSBL_DVSN_CD = 'Y'         /* 대체약품 처방사용가능  */
		                                                         and rownum = 1)
		                                                 else ''
		             end                             as SBSN_MDPR_CTN                   /* 대체약품내용M. */
		          ,  ''                              as SBSN_MDPR_ABSL_DSLW_YN       -- 대체약품절대불가M.  b.SBSN_MDPR_ABSL_DSLW_YN 사용 안함
		          ,  c.MDFE_ITDV_CD                  as MDFE_ITDV_CD                 -- 입력구분(수가M.)
		          ,  c.INSR_IPDV_CD                  as INSR_IPDV_CD                 -- 급여구분코드 수가M.
		          ,  c.PRTC_IPDV_CD                  as PRTC_IPDV_CD                 -- 보호급여구분 수가M.
		          ,  c.INCS_IPDV_CD                  as INCS_IPDV_CD                 -- 산재급여코드 수가M.
		          ,  c.TAIN_IPDV_CD                  as TAIN_IPDV_CD                 -- 자보급여코드 수가M.
		          ,  b.EXCF_CD                       as EXCF_CD                      -- 검사분류 M.
		          --------------------------------------------------------------------------------------
		          -- 추가 컬럼
		          --------------------------------------------------------------------------------------
		          ,  b.ACGR_CD                       as ACGR_CD                      /* 항암제그룹코드M. */
		          ,  b.INDT_KIND_VL                  as INDT_KIND_VL                 /* 적응증종류값M. */
		<![CDATA[
		          ,  case when b.ORDR_PSBL_DVSN_CD <> 'Y' then b.SBSN_ORDR_CD
		                                                  else ''
		             end                              as SBSN_ORDR_CD                /* 대체처방코드 */
		          -- 현재는 기본만 있지만 추후 검사, 처치도 올 수 있음 : 처방화면 대체처방에 현재는 기본만 해주나, 검사, 처치도들어오면 보완 필요해 보임
		          ,  case when b.ORDR_PSBL_DVSN_CD <> 'Y' then (select i.ORDR_NM
		                                                          from MDORDRCMT i
		                                                         where i.ORDR_CD = b.SBSN_ORDR_CD)
		                                                  else ''
		             end                              as  ORDR_NM_1                  /* 대체처방명 */
		]]>
		          ,  b.CHLD_ICUN_CD                  as CHLD_ICUN_CD
		          ,  b.CHLD_PCUN_ICQY_VL             as CHLD_PCUN_ICQY_VL 
		       from
		             MDCPPAMET z
		          ,  MDCPPATBT y
		          ,  MDCPPATDT a
		          ,  MDORDRCMT b
		          ,  AIMFMDFET c
		      where
		             z.PTNO                 = #{ptno}
		        and  z.STRT_YMD             = to_date(#{strtYmd}, 'yyyymmdd')
		        and  z.CP_RGST_SNO          = #{cpRgstSno}
		        and  z.CP_CD                = #{cpCd}
		        -- and  z.MERG_CP_STEP_DD_ORNO = {cpStepNo}
		        and  z.MERG_CP_STEP_DD_ORNO = case when nvl(#{cpStepNo}, 0) = 0 then z.MERG_CP_STEP_DD_ORNO
		                                          else cast(#{cpStepNo} as number)
		                                      end
		        and  y.PTNO                 = z.PTNO
		        and  y.STRT_YMD             = z.STRT_YMD
		        and  y.CP_RGST_SNO          = z.CP_RGST_SNO
		        and  y.CP_CD                = z.CP_CD
		        and  a.PTNO        = z.PTNO
		        and  a.STRT_YMD    = z.STRT_YMD
		        and  a.CP_RGST_SNO = z.CP_RGST_SNO
		        and  a.CP_CD       = z.CP_CD
		        and  a.CP_STEP_NO  = z.CP_STEP_NO
		        -- and  nvl(a.ORDR_PLAC_CLSF_CD,'Z') = nvl(:ordr_plac_clsf_cd, nvl(a.ORDR_PLAC_CLSF_CD,'Z'))
		        -- and  a.DAY_DVSN_CD = 'C'
		        and  a.CP_DVSN_CD in ('A1','A2','A3','B1','B2','B3','B9','C1','C2','C3','D1','D2','D3','D4','E1','F1','G1','H1','X1') /* 처방만 조회 */
		        and  a.ORDR_APLY_YMD is null        /* 적용된것은 제외 */
		        and  a.DLTN_DT is null              /* 삭제된것은 제외 */
		<![CDATA[
		        and  a.ORDR_SNO < 900               /*CP SET인 경우만 900 제한 */
		]]>
		        and  nvl(a.ODKI_CD, 'G') = case when y.CP_USE_PRVC_CD in ('I', 'D') then case when #{odkiCd} = 'I' then 'G' /* ICU 환자는 재원처방 odki_cd = 'I' 퇴원처방 odki_cd = 'D' */
		                                                                                                                             else #{odkiCd}
		                                                                                 end
		                                                                            else nvl(a.ODKI_CD, 'G')
		                                   end
		        and  b.ORDR_CD    (+)= a.CP_ORDR_CD /* ODH 수정 : (+) 추가 */
		        and  c.MDFE_CD    (+)= a.CP_ORDR_CD /* ODH 수정 : (+) 추가 */
		<![CDATA[
		        and  c.APST_YMD   (+)<= trunc(sysdate)
		        and  c.APFN_YMD   (+)>= trunc(sysdate)
		]]>
		        and  not exists (select 'Y' from SUDIECDCT a1 where a1.DIET_CD = a.CP_ORDR_CD)
		      union all
		     select
		          ------------------------------------------------------------------------------------------
		          -- 화면에서 제어하는 것을 변경 함 (병동 : 수술료 / DSC : 처방 조회 시점에서 체크
		          ------------------------------------------------------------------------------------------
		          -- case when y.CP_USE_PRVC_CD = 'I' then 'W'
		          --      when y.CP_USE_PRVC_CD = 'D' then case when z.MERG_CP_STEP_DD_ORNO = 1 then 'F' -- 준비실(DSC)
		          --                                            when z.MERG_CP_STEP_DD_ORNO = 2 then 'G' -- 수술실(DSC)
		          --                                            when z.MERG_CP_STEP_DD_ORNO = 3 then 'H' -- 회복실(DSC)
		          --                                            when z.MERG_CP_STEP_DD_ORNO = 4 then 'I' -- 안정실(DSC)
		          --                                                                            else ''
		          --                                       end
		          --                                  else ''
		          -- end                             as OROC_CD                      /* 처방발생원코드 */
		          ------------------------------------------------------------------------------------------
		             ''                              as OROC_CD                      /* 처방발생원코드 */
		          ,  z.MERG_CP_STEP_DD_ORNO          as CP_STEP_NO                   /* CP단계번호 */
		          ------------------------------------------------------------------------------------------
		          ,  a.ORDR_CRTN_LNKN_NO             as ORDR_CRTN_LNKN_NO            /* 처방생성연결번호 */
		          ,  a.ORDR_SNO                      as ORDR_SNO
		          /* 처방 SET 영역 */
		          , 'I'                              as SAVE_DVSN_CD
		          ,  a.SCIN_CD                       as SCIN_CD                      -- 상병코드
		          ,  a.CP_ORDR_CD                    as ORDR_CD                      -- 처방코드
		          ,  a.ORDR_NM                       as BSIS_ORDR_NM                 -- 처방명(기본처방)
		          ,  a.ORDR_CLTY_CD                  as ORDR_CLTY_CD1                -- 처방분류유형
		          ,  a.ORFR_CD                       as ORFR_CD                      -- 처방형태코드
		          ,  a.ODKI_CD                       as ODKI_CD                      -- 처방종류
		          ,  a.ODKI_DETL_CD                  as ODKI_DETL_CD                 -- 처방종류상세코드
		          ,  a.SLCT_UNIT_DVSN_CD             as SLCT_UNIT_DVSN_CD            -- 선택단위구분코드'1'포장,'2'함량
		          ,  a.PCKN_UNAD_QTY                 as PCKN_UNAD_QTY                -- 포장단위투여량
		          ,  a.PCUN_CD                       as PCUN_CD                      -- 포장단위코드
		          ,  a.ICUN_ADMN_VLM                 as ICUN_ADMN_VLM                -- 함량단위투여용량
		          ,  a.ICUN_CD                       as ICUN_CD1                     -- 함량단위코드
		          ,  a.OSET_DETL_NTM                 as OSET_DETL_NTM                -- 처방SET상세횟수
		          ,  a.DDCN                          as DDCN                         -- 일수
		          ,  a.DRUS_CD                       as DRUS_CD                      -- 용법코드
		          ,  a.DRBN_NO                       as DRBN_NO                      -- 약묶음번호
		          ,  a.SNGN_BNDL_YN                  as SNGN_BNDL_YN                 -- 단독묶음번호
		          ,  a.MIX_KIND_CD                   as MIX_KIND_CD                  -- MIX종류
		          ,  a.ASTS_YN                       as ASTS_YN                      -- AST여부
		          ,  a.ORDR_IPDV_CD                  as ORDR_IPDV_CD                 -- 처방급여구분코드
		          ,  a.OSET_DETL_UNSL_CTN            as OSET_DETL_UNSL_CTN           -- 상세특이사항
		          ,  a.PTPT_CD                       as PTPT_CD                      -- 환자가야할장소
		          ,  a.SPCM_CD1                      as SPCM_CD1                     -- 수혈인경우에는 수혈종류M. 그외는 검체코드1
		          ,  a.SPCM_CD2                      as SPCM_CD2                     -- 검체코드2
		          ,  a.PRTB_YN                       as PRTB_YN                      -- PORTABLE 여부
		          ,  a.UPLT_RWTT_VL                  as UPLT_RWTT_VL                 -- 치열(상좌)
		          ,  a.UPRG_RWTT_VL                  as UPRG_RWTT_VL                 -- 치열(상우)
		          ,  a.LWLF_RWTT_VL                  as LWLF_RWTT_VL                 -- 치열(하좌)
		          ,  a.LWRG_RWTT_VL                  as LWRG_RWTT_VL                 -- 치열(하우)
		          ,  a.MDSI_CD                       as MDSI_CD                      -- 치료부위
		          ,  ( select DETL_CD_NM from CCCMCDDMT where COMN_GRP_CD = 'SH004' and COMN_DTLS_CD = a.MDSI_CD) 		as MDSI_NM  				-- (재활) 치료부위명
		          ,  a.MDTE_LCTN_CD                  as MDTE_LCTN_CD                 -- 치료위치
		          ,  ( select DETL_CD_NM from CCCMCDDMT where COMN_GRP_CD = 'MM191' and COMN_DTLS_CD = a.MDTE_LCTN_CD) 	as AFI_MDTE_LCTN_NM  		-- (재활) 치료부위명
		          ,  a.MDTE_FRQN_CD                  as MDTE_FRQN_CD                 -- 치료빈도
		          ,  ( select DETL_CD_NM from CCCMCDDMT where COMN_GRP_CD = 'SH005' and COMN_DTLS_CD = a.MDTE_FRQN_CD) 	as AFI_MDTE_FRQN_NM  		-- (재활) 치료빈도명
		          ,  a.ONDY_MDTE_NTM                 as ONDY_MDTE_NTM                -- 치료횟수(1일)
		          ,  ( select DETL_CD_NM from CCCMCDDMT where COMN_GRP_CD = 'SH006' and COMN_DTLS_CD = a.ONDY_MDTE_NTM) 	as AFI_ONDY_MDTE_NTM_STR 	-- (재활) 치료횟수(1일)명
		          ,  a.MDTE_DDCN                     as MDTE_DDCN                    -- 치료일수
		          ,  a.ACDG_MIX_DVSN_CD              as ACDG_MIX_DVSN_CD             -- 항암제혼합구분코드
		          ,  a.CCR90_VLM                     as CCR90_VLM                    -- Ccr 90 mL/min 초과
		          ,  a.CCR5090_VLM                   as CCR5090_VLM                  -- Ccr50~90 mL/min
		          ,  a.CCR1050_VLM                   as CCR1050_VLM                  -- Ccr10~50 mL/min
		          ,  a.CCR10_VLM                     as CCR10_VLM                    -- Ccr 10 mL/min 미만
		          ,  a.BDWG_PER_ORDR_VLM             as BDWG_PER_ORDR_VLM            -- 체중당(kg)처방용량
		          ,  a.LMTT_PERD_DDCN                as LMTT_PERD_DDCN               -- 제한기간(일수)
		          ,  a.DYS1_LMTT_VLM                 as DYS1_LMTT_VLM                -- 제한용량(1일)
		          ,  a.BDWG_PER_ORDR_VLUN_CD         as BDWG_PER_ORDR_VLUN_CD        -- 체중당(kg)처방용량 단위
		          ,  a.LMTT_VLUN_CD                  as LMTT_VLUN_CD                 -- 제한욜량단위코드
		          ,  a.LMTT_PERD_WRNN_KIND_CD        as LMTT_PERD_WRNN_KIND_CD       -- 제한기간경고종류
		          ,  a.LMTT_VLM_WRNN_KIND_CD         as LMTT_VLM_WRNN_KIND_CD        -- 제한용량경고종류
		          ,  a.NTM1                          as NTM1                         -- 횟수1
		          ,  a.DRDR_CD1                      as DRDR_CD1                     -- 용법코드1
		          ,  a.UNSL_CTN1                     as UNSL_CTN1                    -- 특이내용1
		          ,  a.ORDR_VLM1                     as ORDR_VLM1                    -- 처방용량1
		          ,  a.NTM2                          as NTM2                         -- 횟수2
		          ,  a.DRDR_CD2                      as DRDR_CD2                     -- 용법코드2
		          ,  a.UNSL_CTN2                     as UNSL_CTN2                    -- 특이내용2
		          ,  a.ORDR_VLM2                     as ORDR_VLM2                    -- 처방용량2
		          ,  a.NTM3                          as NTM3                         -- 횟수3
		          ,  a.DRDR_CD3                      as DRDR_CD3                     -- 용법코드3
		          ,  a.UNSL_CTN3                     as UNSL_CTN3                    -- 특이내용3
		          ,  a.ORDR_VLM3                     as ORDR_VLM3                    -- 처방용량3
		          ,  a.NTM4                          as NTM4                         -- 횟수4
		          ,  a.DRDR_CD4                      as DRDR_CD4                     -- 용법코드4
		          ,  a.UNSL_CTN4                     as UNSL_CTN4                    -- 특이내용4
		          ,  a.ORDR_VLM4                     as ORDR_VLM4                    -- 처방용량4
		          ,  a.ACDG_ADDT_CTN                 as ACDG_ADDT_CTN                -- 항암제투여일내용
		          ,  a.ORDR_PLAC_CLSF_CD             as ORDR_PLAC_CLSF_CD            -- 처방장소분류코드
		          ,  a.ANAG_SET_NO                   as ANAG_SET_NO                  -- 항균제-SET순번
		          ,  a.ANAG_SET_SNO                  as ANAG_SET_SNO                 -- 항균제SET일련번호
		          ,  a.ENCR_ANAG_SNO                 as ENCR_ANAG_SNO                -- 권장항균제일련번호
		          ,  a.HGRN_OSET_SNO                 as HGRN_OSET_SNO                -- 상위set일련번호
		          ,  a.ANAG_ETOR_YN                  as ANAG_ETOR_YN                 -- 항균제-기타처방여부
		          ,  a.ANAG_ETOR_RESN_CD             as ANAG_ETOR_RESN_CD            -- 항균제-기타처방사유코드
		          ,  a.ANAG_ETOR_RESN_CTN            as ANAG_ETOR_RESN_CTN           -- 항균제기타처방사유내용
		          ,  a.OSET_SNO1                     as OSET_SNO1                    -- 항균제-경로1
		          ,  a.OSET_SNO2                     as OSET_SNO2                    -- 항균제-경로2
		          ,  a.OSET_SNO3                     as OSET_SNO3                    -- 항균제-경로3
		          ,  a.OSET_SNO4                     as OSET_SNO4                    -- 항균제-경로4
		          ,  a.OSET_SNO5                     as OSET_SNO5                    -- 항균제-경로5
		          ,  a.ANCL_CD1                      as ANCL_CD1                     -- 항균제분류1 = 성분1
		          ,  a.ANCL_CD2                      as ANCL_CD2                     -- 항균제분류2 = 미생물코드
		          ,  a.ANCL_CD3                      as ANCL_CD3                     -- 항균제분류3 = 기타처방여부
		          ,  a.ANCL_CD4                      as ANCL_CD4                     -- 항균제분류4 = 미생물항생제코드
		          ,  a.ANCL_CD5                      as ANCL_CD5                     -- 항균제분류5 = AG용법구분(A) / 투석구분(H)
		          ,  a.PRGN_YN                       as PRGN_YN                      -- 항균제-임신여부
		          ,  a.RCRD_YN                       as RCRD_YN                      -- 기록여부
		          ,  a.ASTT_DLGT_YN                  as ASTT_DLGT_YN                 -- 보조원위임여부
		          ,  a.RCRD_OPTN_DVSN_CD             as RCRD_OPTN_DVSN_CD            -- 기록옵션구분코드
		          ,  a.ACTN_NTM                      as ACTN_NTM                     -- 액팅횟수
		          ,  a.MDAT_TRGT_YN                  as MDAT_TRGT_YN                 -- 의평대상여부
		          ,  a.ABM_TRGT_YN                   as ABM_TRGT_YN                  -- ABM대상여부
		          ,  a.FRNS_CTRL_DVSN_CD             as FRNS_CTRL_DVSN_CD1           -- 불출제어 정보
		          ,  a.FLUD_TOTL_QTY                 as FLUD_TOTL_QTY                -- Fluid 총량
		          ,  a.FLUD_OVER_VL                  as FLUD_OVER_VL                 -- Fluid Over
		          ,  a.FLUD_CC_HR_VL                 as FLUD_CC_HR_VL                -- Fluid With cc/hr
		          ,  a.FLUD_Q_HR_VL                  as FLUD_Q_HR_VL                 -- Fluid Q
		          ,  a.IMPL_ORDR_PBLC_LMTT_NTM       as IMPL_ORDR_PBLC_LMTT_NTM      -- 실시처방발생제한횟수
		          ,  a.CHMP_YN                       as CHMP_YN                      -- Chemo Op여부(외래사용여부)
		          ,  a.SET_ORDR_DETL_CTN             as SET_ORDR_DETL_CTN            -- set처방상세내용
		          ,  a.BASE_VLM_CLCL_TYPE_CD         as BASE_VLM_CLCL_TYPE_CD        -- 기준용량계산유형코드 Fix, Kg, BSA, AUC
		          ,  a.ACDG_ADMN_MI                  as ACDG_ADMN_MI                 -- 항암제 투여 시간 (분 단위)
		          ,  a.ACDG_CLCL_VL                  as ACDG_CLCL_VL                 -- 항암제 계산값
		          ,  a.ANTC_EDCT_DVSN_CD             as ANTC_EDCT_DVSN_CD            -- 항암교육 구분(1:신환,2:변경)
		          ,  a.ANTC_ORDV_VL                  as ANTC_ORDV_VL                 -- 항암처방 구분(A:공통, I:입원, O:외래)
		          ,  a.ANTC_INJT_ADMN_MTHD_CTN       as ANTC_INJT_ADMN_MTHD_CTN      -- 항암주사방법(01:말초혈관,02:중심정맥,03:Chemo-port)
		          ,  a.IJTB_MTHD_CD                  as IJTB_MTHD_CD                 -- 주사관방법코드
		          ,  a.FRNS_DPRT_CD                  as FRNS_DPRT_CD                 -- 불출부서코드
		          ,  a.MDTN_VLUN_CD                  as MDTN_VLUN_CD                 -- 투여용량단위코드
		          ,  a.MDTN_PRKG_VLM                 as MDTN_PRKG_VLM                -- 투여kg당용량
		          ,  a.TPRN_ORDR_YN                  as TPRN_ORDR_YN                 -- Tapering처방여부
		          ,  ''                              as BSIS_ORDR_PACK_ORDR_CD       /* 기본처방Pack처방코드 */
		          ,  ''                              as AFI_BSIS_ORDR_CD_NM          /* AFI기본처방코드명 */
		          ,  a.LWRN_ORDR_SNO                 as LWRN_ORDR_SNO                /* 하위처방일련번호 */
		          ,  a.CNNT_ORDR_BNDL_NO             as CNNT_ORDR_BNDL_NO            /* 동시처방묶음번호 */
		          ,  ''                              as BSIS_ORDR_VRSN_VL            /* 기본처방버전값 */
		          ,  ''                              as AFI_BSIS_ORDR_VRSN_UPDT_YN   /* 기본처방 버젼 update 여부 */
		          ,  a.PREP_ORDR_YN                  as PREP_ORDR_YN
		          ,  a.CLRS_PRJC_CD
		          --------------------------------------------------------------
		          -- 식사처방 관련 추가
		          --------------------------------------------------------------
		          -- , ( select DETL_CD_NM from CCCMCDDMT where COMN_GRP_CD = 'MM182' and COMN_DTLS_CD = a.ORDR_CLTY_CD and rownum = 1 ) as AFI_ORDR_CLTY_NM -- 처방분류유형명
		          , '식이처방'                        as AFI_ORDR_CLTY_NM       -- 처방분류유형명
		          ,  ''                              as RPMD_ID                      -- 대표약품ID
		          ,  ''                              as RPMD_NM                      -- 대표약품명
		          ,  a.ORDR_CLTY_CD                  as ORDR_CLTY_CD                 -- 처방분류유형코드M.
		          ,  ''                              as INVN_PCUN_CD                 -- 재고포장단위코드.M
		          ,  ''                              as ICUN_CD                      -- 함량단위코드M.
		          ,  b.DIET_NM                       as ORDR_NM                      -- 처방명.M
		          --------------------------------------------------------------
		          -- 식사처방 관련 추가
		          --------------------------------------------------------------
		          ,  nvl(b.ORDR_SCRN_LRCL_CD, 'DT')  as SLIP_CD                      -- Slip코드.M
		          --------------------------------------------------------------
		          ,  ''                              as STST_DVSN_CD                 -- 통계구분('7'=제한항균제,'5'=수액)M
		          ,  ''                              as ANTB_YN                      -- 항생제여부M.
		          ,  0                               as PCUN_INLS_QTY                -- 포장단위량M
		<![CDATA[
		          --    ,  (select a1.ORDR_PSBL_YN
		          --          from AIMFMDFET a1
		          --         where a1.MDFE_CD  = a.CP_ORDR_CD
		          --           and a1.APST_YMD = (select max(a2.APST_YMD)
		          --                                from AIMFMDFET a2
		          --                               where a2.MDFE_CD   = a.CP_ORDR_CD
		          --                                 and a2.APST_YMD <= trunc(sysdate)
		          --                                 and a2.APFN_YMD >= trunc(sysdate))
		          --           and a1.APFN_YMD >= trunc(sysdate))
		]]>
		          ,  b.ORDR_PSBL_YN                  as ORDR_PSBL_DVSN_CD            -- 처방가능구분M
		          ,  'COD'                           as ORCL_CD                      -- 처방분류M.
		          ,  ''                              as TDM_CD_DVSN_CD               -- TDM코드구분M.
		          ,  ''                              as MDCR_BEEX_YN                 -- 진료이전검사여부M.
		          ,  ''                              as FLUD_ORDR_YN                 -- 수액처방여부M
		          ,  ''                              as DRAP_DVSN_CD                 -- 약적용구분코드M
		          ,  ''                              as ACMP_YN                      -- 동반여부M
		          ,  ''                              as TIMS1_TOTL_QTY_YN            -- 1회총량여부여부M
		          ,  ''                              as DGFR_CD                      -- 제형코드M
		          ,  0                               as KIT_MDPR_DDCN                -- 키트약품일수M
		          ,  ''                              as MDPR_CLSF_CD                 -- 약품분류코드M
		          ,  ''                              as FRNS_CTRL_DVSN_CD            -- 불출제어구분코드M
		          ,  ''                              as IHOH_DVSN_CD                 -- 원내원외구분코드M.
		          ,  ''                              as SDPF_EXRE_CD                 -- 원내사유코드M.
		          ,  ''                              as SBSN_MDPR_CTN                -- 대체약품내용M.
		          ,  ''                              as SBSN_MDPR_ABSL_DSLW_YN       -- 대체약품절대불가M.  b.SBSN_MDPR_ABSL_DSLW_YN 사용 안함
		<![CDATA[
		          ,  (select a1.MDFE_ITDV_CD
		                from AIMFMDFET a1
		               where a1.MDFE_CD      = a.CP_ORDR_CD
		                 and a1.APST_YMD     = (select max(a2.APST_YMD)
		                                          from AIMFMDFET a2
		                                         where a2.MDFE_CD = a.CP_ORDR_CD
		                                           and a2.APST_YMD <= trunc(sysdate)
		                                           and a2.APFN_YMD >= trunc(sysdate))
		                 and a1.APFN_YMD >= trunc(sysdate))
		]]>
		                                             as MDFE_ITDV_CD                 -- 입력구분(수가M.)
		          ,  '1'                             as INSR_IPDV_CD                 -- 급여구분코드 수가M.
		          ,  ''                              as PRTC_IPDV_CD                 -- 보호급여구분 수가M.
		          ,  ''                              as INCS_IPDV_CD                 -- 산재급여코드 수가M.
		          ,  ''                              as TAIN_IPDV_CD                 -- 자보급여코드 수가M.
		          ,  ''                              as EXCF_CD                      -- 검사분류 M.
		          --------------------------------------------------------------------------------------
		          -- 추가 컬럼
		          --------------------------------------------------------------------------------------
		          ,  ''                              as ACGR_CD                      /* 항암제그룹코드M. */
		          ,  ''                              as INDT_KIND_VL                 /* 적응증종류값M. */
		          ,  ''                              as SBSN_ORDR_CD                 /* 대체처방코드 */
		          ,  ''                              as ORDR_NM_1                    /* 대체처방명 */
		          ,  ''                              as CHLD_ICUN_CD
		          ,  0                               as CHLD_PCUN_ICQY_VL
		       from
		             MDCPPAMET z
		          ,  MDCPPATBT y
		          ,  MDCPPATDT a
		          ,  SUDIECDCT b     /* 식사코드 */
		      where
		             z.PTNO                 = #{ptno}
		        and  z.STRT_YMD             = to_date(#{strtYmd}, 'yyyymmdd')
		        and  z.CP_RGST_SNO          = #{cpRgstSno}
		        and  z.CP_CD                = #{cpCd}
		        -- and  z.MERG_CP_STEP_DD_ORNO = {cpStepNo}
		        and  z.MERG_CP_STEP_DD_ORNO = case when nvl(#{cpStepNo}, 0) = 0 then z.MERG_CP_STEP_DD_ORNO
		                                          else cast(#{cpStepNo} as number)
		                                      end
		        and  y.PTNO                 = z.PTNO
		        and  y.STRT_YMD             = z.STRT_YMD
		        and  y.CP_RGST_SNO          = z.CP_RGST_SNO
		        and  y.CP_CD                = z.CP_CD
		        and  a.PTNO        = z.PTNO
		        and  a.STRT_YMD    = z.STRT_YMD
		        and  a.CP_RGST_SNO = z.CP_RGST_SNO
		        and  a.CP_CD       = z.CP_CD
		        and  a.CP_STEP_NO  = z.CP_STEP_NO
		        -- and  nvl(a.ORDR_PLAC_CLSF_CD,'Z') = nvl(:ordr_plac_clsf_cd, nvl(a.ORDR_PLAC_CLSF_CD,'Z'))
		        -- and  a.DAY_DVSN_CD = 'C'
		        and  a.CP_DVSN_CD in ('A1','A2','A3','B1','B2','B3','B9','C1','C2','C3','D1','D2','D3','D4','E1','F1','G1','H1','X1') /* 처방만 조회 */
		        and  a.ORDR_APLY_YMD is null        /* 적용된것은 제외 */
		        and  a.DLTN_DT is null              /* 삭제된것은 제외 */
		<![CDATA[
		        and  a.ORDR_SNO < 900               /*CP SET인 경우만 900 제한 */
		]]>
		        and  nvl(a.ODKI_CD, 'G') = case when y.CP_USE_PRVC_CD in ('I', 'D') then case when #{odkiCd} = 'I' then 'G' /* ICU 환자는 재원처방 odki_cd = 'I' 퇴원처방 odki_cd = 'D' */
		                                                                                                                             else #{odkiCd}
		                                                                                 end
		                                                                            else nvl(a.ODKI_CD, 'G')
		                                   end
		        and  b.DIET_CD       = a.CP_ORDR_CD
		      ) a
		 order
		    by CP_STEP_NO
		     , NVL(ODKI_DETL_CD, 'A')  
		     , CASE WHEN ODKI_DETL_CD = 'Z' THEN LPAD(ORDR_SNO, 8, '0')
		            ELSE (case when substr(ORDR_CLTY_CD, 1, 1) = 'A' then case when substr(SLIP_CD, 1, 2) != 'DT' then '1'
		                                                                                                              else '2'
		                                                                  end
		                                                             else '3'
		        			end) || ORDR_CLTY_CD || decode(ORFR_CD, 'P', 2, 1) || LPAD(ORDR_SNO, 8, '0') END;
			
			 --기존 ORDER BY절은 SPECIAL처방들도 함께 정렬이 되어버림. SPECIAL처방은 SPECIAL처방 만들어진 순서로 조회되도록 해야함
		     --CP_STEP_NO
		     --------------------------------------------------------------
		     -- 식사처방 관련 추가
		     --------------------------------------------------------------
		     --,  case when substr(ORDR_CLTY_CD, 1, 1) = 'A' then case when substr(SLIP_CD, 1, 2) != 'DT' then 1
		     --                                                                                           else 2
		     --                                                    end
		     --                                              else 3
		     --   end
		     --------------------------------------------------------------
		     --,  ORDR_CLTY_CD
		     --,  decode(ORFR_CD, 'P', 2, 1)
		     --,  ORDR_SNO
	</select>



</mapper>