<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_ScmClbrCntrInrlLnkdMngmDAO_sql.xml 
    Description : -->
<mapper namespace="ScmClbrCntrInrlLnkdMngmDAO">




    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateClbrCntrMdrpNoUpdt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateClbrCntrMdrpNoUpdt"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  >
		<![CDATA[
		update  /*+ SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateClbrCntrMdrpNoUpdt */
		            SCRPATRFT
		      set
		            MDRP_NO           = #{mdrpNo}
		           , REFR_MDCR_YMD = (select to_date(to_char(MDCR_YMD, 'yyyymmdd'),'yyyymmdd')
		                                            from APRCRPTNT
		                                          where MDRP_NO = #{mdrpNo}
		                                             and rownum = 1) /* 의뢰진료일자*/
		           , LAST_UPDR_ID = #{gvUserId}
		           , LAST_UPDT_IP = #{gvUserIp}
		           , LAST_UPDT_DT = current_timestamp
		           , LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		           , LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		   where  PTNO       = #{ptno}
		      and  REFR_SNO = #{refrSno}
		]]>
	</update>


	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrPtntInfmInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="userId" column="USER_ID"/>
		<result property="userNm" column="USER_NM"/>
		<result property="mdcrDprtCd" column="MDCR_DPRT_CD"/>
		<result property="afiMdcrDprtNm" column="AFI_MDCR_DPRT_NM"/>
		<result property="kornDprtNm1" column="KORN_DPRT_NM_1"/>
		<result property="mdcrClasCd" column="MDCR_CLAS_CD"/>
		<result property="apstYmd" column="APST_YMD"/>
		<result property="apfnYmd" column="APFN_YMD"/>
		<result property="inftDprtCd" column="INFT_DPRT_CD"/>
		<result property="afiInftDprtNm" column="AFI_INFT_DPRT_NM"/>
		<result property="mnsbYn" column="MNSB_YN"/>
		<result property="ocdtCd" column="OCDT_CD"/>
		<result property="ocfmCd" column="OCFM_CD"/>
		<result property="btdt" column="BTDT"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="clno" column="CLNO"/>
		<result property="extsTlno" column="EXTS_TLNO"/>
		<result property="pdaNo" column="PDA_NO"/>
		<result property="pdaNo2" column="PDA_NO_2"/>
		<result property="emailId" column="EMAIL_ID"/>
		<result property="userLcnsNo" column="USER_LCNS_NO"/>
		<result property="userSpczDrlcNo" column="USER_SPCZ_DRLC_NO"/>
		<result property="userSttsCd" column="USER_STTS_CD"/>
		<result property="lastCnctDt" column="LAST_CNCT_DT"/>
		<result property="rmrkCtn" column="RMRK_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrPtntInfmInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrPtntInfmInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrPtntInfmInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrPtntInfmInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrPtntInfmInqr */   /*+ scd_useramt_s02$S01_사용자정보 조회 */
				   a.USER_ID as USER_ID                                                                      /*  사용자                 */
				,  a.USER_NM as USER_NM                                                                      /*  사용자명               */
				,  a.MDCR_DPRT_CD as MDCR_DPRT_CD                                                                 /*  진료부서코드           */
				,  ( select F_A.KORN_DPRT_NM from HZDEPTMMT F_A where F_A.DPRT_CD = a.MDCR_DPRT_CD group by F_A.KORN_DPRT_NM ) as AFI_MDCR_DPRT_NM /*  진료부서명           */
				,  substrb(b.KORN_DPRT_NM, 1, 50) as KORN_DPRT_NM_1                               /*  인사 부서 명           */
				,  a.MDCR_CLAS_CD as MDCR_CLAS_CD                                                                 /*  진료Class코드          */
				,  to_char(a.APST_YMD,'YYYYMMDD') as APST_YMD                                     /*  적용시작일자           */
				,  to_char(a.APFN_YMD,'YYYYMMDD') as APFN_YMD                                     /*  적용종료일자           */
				,  a.INFT_DPRT_CD as INFT_DPRT_CD                                                                 /*  안내부서코드           */
				,  ( select F_A.KORN_DPRT_NM from HZDEPTMMT F_A where F_A.DPRT_CD = a.INFT_DPRT_CD  group by F_A.KORN_DPRT_NM ) as AFI_INFT_DPRT_NM  /*  안내부서명           */
				,  a.MNSB_YN as MNSB_YN                                                                      /*  주부여부               */
				,  c.OCDT_CD as OCDT_CD                                                                      /*  직무코드               */
				,  c.OCFM_CD as OCFM_CD                                                                      /*  직종                   */
				,  c.BTDT as BTDT                                                                         /*  생년월일               */
				,  c.GEND_CD as GEND_CD                                                                      /*  성별코드               */
				,  c.CLNO as CLNO                                                                         /*  휴대전화번호           */
				,  c.EXTS_TLNO as EXTS_TLNO                                                                    /*  내선전화번호           */
				,  c.PDA_NO as PDA_NO                                                                       /*  PDA번호                */
				,  case when substr(c.PDA_NO, 1, 2) = '8-' then c.PDA_NO
														   else '8-' || c.PDA_NO
				   end as PDA_NO_2                                                                /*  PDA번호                */
				,  c.EMAIL_ID as EMAIL_ID                                                                     /*  이메일ID               */
				,  c.USER_LCNS_NO as USER_LCNS_NO                                                                 /*  사용자면허번호         */
				,  c.USER_SPCZ_DRLC_NO as USER_SPCZ_DRLC_NO                                                            /*  사용자전문의사면허번호 */
				,  c.USER_STTS_CD as USER_STTS_CD                                                                 /*  사용자상태(CS001)      */
				,  c.LAST_CNCT_DT as LAST_CNCT_DT                                                                 /*  최종접속일시           */
				,  c.RMRK_CTN as RMRK_CTN                                                                     /*  비고내용               */
			 from  CCUSRDPHT a                           /*  사용자진료조직관계이력  */
				,  HZDEPTMMT b                           /*  조직Master I/F       */
				,  CCUSERAMT c                           /*  OCS사용자              */
			where  a.USER_ID      = #{userId}
			  and  a.MDCR_DPRT_CD = b.DPRT_CD(+)                         /*  진료부서코드            */
			  /* and  b.HRAF_DPRT_YN = 'Y'                                  /*  인사부서여부            */
			  and  a.LGIN_ID      = c.LGIN_ID
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRplyInfmInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="dvsnCd" column="DVSN_CD"/>
		<result property="yn" column="YN"/>
		<result property="clbrDvsnCd" column="CLBR_DVSN_CD"/>
		<result property="afiClbrDvsnNm" column="AFI_CLBR_DVSN_NM"/>
		<result property="hsptNm" column="HSPT_NM"/>
		<result property="drNm" column="DR_NM"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ptno" column="PTNO"/>
		<result property="refrSno" column="REFR_SNO"/>
		<result property="rplyDt" column="RPLY_DT"/>
		<result property="rplyMthdCd" column="RPLY_MTHD_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRplyInfmInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRplyInfmInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRplyInfmInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRplyInfmInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRplyInfmInqr */   /*+ scd_scrrepl_s12$S01_환자툴바 SPC용 버튼 회신정보 조회 */
				 'R' as DVSN_CD                 /*  구분코드 - B:되의뢰환자군, R:회신작성필요, F:당일의뢰존재 */
			   , 'Y' as YN                      /*  긴급여부 */
			   , h.CLBR_DVSN_CD as CLBR_DVSN_CD                 /*  협력구분코드*/
			   , '회신필요' as AFI_CLBR_DVSN_NM  /*  버튼명 */
			   , h.HSPT_NM as HSPT_NM                      /*  SPC병원명*/
			   , d.DR_NM as DR_NM                        /*  SPC의사명*/
			   , r.MDRP_NO as MDRP_NO                      /*  진료접수번호 */
			   , p.PTNO as PTNO                         /*  환자번호-회신서기본키 */
			   , p.REFR_SNO as REFR_SNO                     /*  의뢰일련번호-회신서기본키 */
			   , to_char(p.RPLY_DT,'yyyyMMddHH24Miss')   as RPLY_DT                 /*  회신일시-회신서기본키 */
			   , p.RPLY_MTHD_CD as RPLY_MTHD_CD                 /*  회신방법코드-회신서기본키 */
		   from
				 (select p.PTNO
					   , p.REFR_SNO
					   , p.RPLY_DT
					   , p.RPLY_MTHD_CD
					from SCRREPLYT p  /*  진료회신 */
					   , SCRPATRFT s  /*  SPC환자의뢰 */
					   , APRCRPTNT r  /*  진료접수 */
				   where s.PTNO       = p.PTNO
					 and s.REFR_SNO   = p.REFR_SNO
					 and r.MDRP_NO    = s.MDRP_NO
					 and p.PTNO       = (select t.PTNO
										   from APRCRPTNT t
										  where t.MDRP_NO = #{mdrpNo})
					 and p.RPLY_DR_ID = #{gvUserId}
					 and p.NNMK_DLTN_YMD is null
					 and (   p.RPLY_DSGN_YMD is null
						  or p.RPLY_DSGN_YMD >= trunc(sysdate))
					 and p.SPC_RPLY_STTS_CD in ('N','S')
					 and decode(r.CNCL_DT, to_date('29991231','yyyyMMdd'), null, r.CNCL_DT) is null
				  order by p.RPLY_DT desc) p
			   , SCRPATRFT s  /*  SPC환자의뢰 */
			   , SCOHOSPMT h  /*  SMC파트너병원 */
			   , SCODOCTRT d  /*  SPC의사 */
			   , APRCRPTNT r  /*  진료접수 */
		   where
				 s.PTNO           = p.PTNO
			 and s.REFR_SNO       = p.REFR_SNO
			 and r.MDRP_NO        = s.MDRP_NO
			 and h.SPC_HSPT_CD(+) = s.SPC_HSPT_CD
			 and d.SPC_DR_CD(+)   = s.SPC_DR_CD
			 and rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRerfInfmInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="dvsnCd" column="DVSN_CD"/>
		<result property="yn" column="YN"/>
		<result property="clbrDvsnCd" column="CLBR_DVSN_CD"/>
		<result property="afiClbrDvsnNm" column="AFI_CLBR_DVSN_NM"/>
		<result property="hsptNm" column="HSPT_NM"/>
		<result property="drNm" column="DR_NM"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ptno" column="PTNO"/>
		<result property="refrSno" column="REFR_SNO"/>
		<result property="rplyDt" column="RPLY_DT"/>
		<result property="rplyMthdCd" column="RPLY_MTHD_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRerfInfmInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRerfInfmInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRerfInfmInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRerfInfmInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRerfInfmInqr */   /*+ scd_scbpatr_s11$S01_SPC용 버튼 되의뢰정보 조회 */
				 'B' as DVSN_CD                /*  구분코드 - B:되의뢰환자군, R:회신작성필요, F:당일의뢰존재 */
			   , 'Y' as YN                     /*  긴급여부 */
			   , null as CLBR_DVSN_CD          /*  해당없음 */
			   , '되의뢰' as AFI_CLBR_DVSN_NM  /*  버튼명 */
			   , c.RPG_NM as HSPT_NM           /*  되의뢰환자군명 */
			   , null as DR_NM                 /*  해당없음 */
			   , b.MDRP_NO as MDRP_NO                     /*  진료접수번호 */
			   , r.PTNO as PTNO                        /*  환자번호 */
			   , b.RPG_SNO as REFR_SNO         /*  되의뢰환자군일련번호 */
			   , null as RPLY_DT               /*  해당없음 */
			   , null as RPLY_MTHD_CD          /*  해당없음 */
		   from
				 SCBPTGALT b  /*  되의뢰환자군알림이력 */
			   , SCBPTGMGT c  /*  되의뢰환자군관리 */
			   , APRCRPTNT r  /*  진료접수 */
		   where
				 b.MDRP_NO          = #{mdrpNo}
			 and c.RPG_SNO          = b.RPG_SNO
			 and b.RPG_STTS_DVSN_CD = 'A'  /*  상태구분코드-'A':알림, 'B':되의뢰요청, 'C':대상제외 */
			 and r.MDRP_NO          = b.MDRP_NO
			 and c.ANCT_YN          = 'Y'  /*  알림여부가 Y인 경우만 되의뢰로 처리 */
			 and c.USE_YN           = 'Y'  /*  사용여부가 Y인 경우만 되의뢰로 처리 */
			 and rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnDvsnInfmInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="dvsnNm" column="DVSN_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnDvsnInfmInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnDvsnInfmInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnDvsnInfmInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnDvsnInfmInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnDvsnInfmInqr */   /*+ scd_scrpatr_s08$S01_환자툴바 SPC용 버튼 구분값 조회 */
				 case /*  1순위 - 되의뢰환자군 여부 */
					  when exists (select 1
									 from SCBPTGALT b  /*  되의뢰환자군알림이력 */
										, APRCRPTNT r
									where b.MDRP_NO = #{mdrpNo}
									  and r.MDRP_NO = b.MDRP_NO
									  and r.MDDR_ID = #{gvUserId}
									  and b.RPG_STTS_DVSN_CD = 'A'  /*  상태구분코드-'A':알림, 'B':되의뢰요청, 'C':대상제외 */
									  and rownum = 1)                           then 'B'
					  /*  2순위 - Active 회신요청 존재여부 */
					  when exists (select 1
									 from SCRREPLYT p
										, SCRPATRFT s
										, APRCRPTNT r
									where s.PTNO       = p.PTNO
									  and s.REFR_SNO   = p.REFR_SNO
									  and r.MDRP_NO    = s.MDRP_NO
									  and p.PTNO       = (select t.PTNO
															from APRCRPTNT t
														   where t.MDRP_NO = #{mdrpNo})
									  and p.RPLY_DR_ID = #{gvUserId}
									  and p.NNMK_DLTN_YMD is null
									  and (   p.RPLY_DSGN_YMD is null
										   or p.RPLY_DSGN_YMD >= trunc(sysdate))
									  and p.SPC_RPLY_STTS_CD in ('N','S')
									  and decode(r.CNCL_DT, to_date('29991231','yyyyMMdd'), null, r.CNCL_DT) is null
									  and rownum = 1)                           then 'R'
					  /*  3순위 - 당일 의뢰 존재여부 */
					  when exists (select 1
									 from SCRPATRFT s
										, APRCRPTNT r
									where r.MDRP_NO       = s.MDRP_NO
									  and s.PTNO          = (select t.PTNO
															   from APRCRPTNT t
															  where t.MDRP_NO = #{mdrpNo})
									  and r.MDDR_ID       = #{gvUserId}
									  and s.REFR_MDCR_YMD = trunc(sysdate)
									  and s.REFR_PATH_CD in ('A','B','E')  /*  의뢰경로: A:외래, B:응급, E:의뢰서 */
									  and s.FINS_YN       = 'Y'
									  and decode(r.CNCL_DT, to_date('29991231','yyyyMMdd'), null, r.CNCL_DT) is null
									  and rownum = 1)                           then 'F'
					  /*  4순위 - 해당없음 */
					  else ''
				 end as DVSN_NM
		   from dual
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRefrInfmInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="dvsnCd" column="DVSN_CD"/>
		<result property="yn" column="YN"/>
		<result property="clbrDvsnCd" column="CLBR_DVSN_CD"/>
		<result property="afiClbrDvsnNm" column="AFI_CLBR_DVSN_NM"/>
		<result property="hsptNm" column="HSPT_NM"/>
		<result property="drNm" column="DR_NM"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ptno" column="PTNO"/>
		<result property="refrSno" column="REFR_SNO"/>
		<result property="rplyDt" column="RPLY_DT"/>
		<result property="rplyMthdCd" column="RPLY_MTHD_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRefrInfmInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRefrInfmInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRefrInfmInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRefrInfmInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnRefrInfmInqr */   /*+ scd_scrpatr_s09$S01_환자툴바 SPC용 버튼 의뢰정보 조회 */
				 'F' as DVSN_CD                 /*  구분코드 - B:되의뢰환자군, R:회신작성필요, F:당일의뢰존재 */
			   , 'Y' as YN                      /*  긴급여부 */
			   , h.CLBR_DVSN_CD as CLBR_DVSN_CD                 /*  협력구분코드*/
			   , '의뢰환자' as AFI_CLBR_DVSN_NM  /*  버튼명 */
			   , h.HSPT_NM as HSPT_NM                      /*  SPC병원명*/
			   , d.DR_NM as DR_NM                        /*  SPC의사명*/
			   , r.MDRP_NO as MDRP_NO                      /*  진료접수번호 */
			   , s.PTNO as PTNO                         /*  환자번호-의뢰서기본키 */
			   , s.REFR_SNO as REFR_SNO                     /*  의뢰일련번호-의뢰서기본키 */
			   , '' as RPLY_DT                  /*  회신일시-사용안함 */
			   , '' as RPLY_MTHD_CD             /*  회신방법코드-사용안함 */
		   from
				 (select s.PTNO
					   , s.REFR_SNO
					   , s.SPC_HSPT_CD
					   , s.SPC_DR_CD
					   , s.MDRP_NO
					from SCRPATRFT s  /*  SPC환자의뢰 */
					   , APRCRPTNT r  /*  진료접수 */
				   where r.MDRP_NO       = s.MDRP_NO
					 and s.PTNO          = (select t.PTNO
											  from APRCRPTNT t
											 where t.MDRP_NO = #{mdrpNo})
					 and r.MDDR_ID       = #{gvUserId}
					 and s.REFR_MDCR_YMD = trunc(sysdate)
					 and s.REFR_PATH_CD in ('A','B','E')  /*  의뢰경로: A:외래, B:응급, E:의뢰서 */
					 and s.FINS_YN       = 'Y'
					 and decode(r.CNCL_DT, to_date('29991231','yyyyMMdd'), null, r.CNCL_DT) is null
				  order by s.REFR_YMD desc) s
			   , SCOHOSPMT h  /*  SMC파트너병원 */
			   , SCODOCTRT d  /*  SPC의사 */
			   , APRCRPTNT r  /*  진료접수 */
		   where
				 r.MDRP_NO        = s.MDRP_NO
			 and h.SPC_HSPT_CD(+) = s.SPC_HSPT_CD
			 and d.SPC_DR_CD(+)   = s.SPC_DR_CD
			 and rownum = 1
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnEtcRefrInfmInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="dvsnCd" column="DVSN_CD"/>
		<result property="yn" column="YN"/>
		<result property="clbrDvsnCd" column="CLBR_DVSN_CD"/>
		<result property="afiClbrDvsnNm" column="AFI_CLBR_DVSN_NM"/>
		<result property="hsptNm" column="HSPT_NM"/>
		<result property="drNm" column="DR_NM"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ptno" column="PTNO"/>
		<result property="refrSno" column="REFR_SNO"/>
		<result property="rplyDt" column="RPLY_DT"/>
		<result property="rplyMthdCd" column="RPLY_MTHD_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnEtcRefrInfmInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnEtcRefrInfmInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnEtcRefrInfmInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnEtcRefrInfmInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrBttnEtcRefrInfmInqr */   /*+ scd_scrpatr_s10$S01_환자툴바 SPC용 버튼 의뢰정보 조회 */
				 '' as DVSN_CD               /*  구분코드 - B:되의뢰환자군, R:회신작성필요, F:당일의뢰존재 */
			   , case when (trunc(sysdate) - trunc(s.MDCR_YMD)) <= 365 then 'Y'
																	   else 'N'
					  end as YN              /*  긴급여부 */
			   , h.CLBR_DVSN_CD as CLBR_DVSN_CD              /*  협력구분코드*/
			   , 'Refer' as AFI_CLBR_DVSN_NM /*  버튼명 - 1.협력병원, 나머진 비협력병원 */
			   , h.HSPT_NM as HSPT_NM                   /*  SPC병원명*/
			   , d.DR_NM as DR_NM                     /*  SPC의사명*/
			   , r.MDRP_NO as MDRP_NO                   /*  진료접수번호 */
			   , s.PTNO as PTNO                      /*  환자번호-의뢰서기본키 */
			   , s.REFR_SNO as REFR_SNO                  /*  의뢰일련번호-의뢰서기본키 */
			   , '' as RPLY_DT               /*  회신일시-사용안함 */
			   , '' as RPLY_MTHD_CD          /*  회신방법코드-사용안함 */
		   from
				 (select s.PTNO
					   , s.REFR_SNO
					   , s.SPC_HSPT_CD
					   , s.SPC_DR_CD
					   , s.MDRP_NO
					   , r.MDCR_YMD
					from SCRPATRFT s  /*  SPC환자의뢰 */
					   , APRCRPTNT r  /*  진료접수 */
				   where r.MDRP_NO       = s.MDRP_NO
					 and s.PTNO          = (select t.PTNO
											  from APRCRPTNT t
											 where t.MDRP_NO = #{mdrpNo})
					 and s.REFR_PATH_CD in ('A','B','C','E')  /*  의뢰경로: A:외래, B:응급, C:검사, E:의뢰서 */
					 and s.FINS_YN       = 'Y'
					 and decode(r.CNCL_DT, to_date('29991231','yyyyMMdd'), null, r.CNCL_DT) is null
				  order by r.MDCR_YMD desc) s
			   , SCOHOSPMT h  /*  SMC파트너병원 */
			   , SCODOCTRT d  /*  SPC의사 */
			   , APRCRPTNT r  /*  진료접수 */
		   where
				 r.MDRP_NO        = s.MDRP_NO
			 and h.SPC_HSPT_CD(+) = s.SPC_HSPT_CD
			 and d.SPC_DR_CD(+)   = s.SPC_DR_CD
			 and rownum = 1
			]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-insertClbrCntrAtmtRefrRgst (협력센터 자동의뢰 등록) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-insertClbrCntrAtmtRefrRgst"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  >
		<![CDATA[
		insert  /*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-insertClbrCntrAtmtRefrRgst */
					 into SCRPATRFT
						(
							PTNO                       /*  환자번호               */
						 ,  REFR_SNO                   /*  의뢰일련번호            */
						 ,  REFR_YMD                   /*  의뢰일자               */
		                 ,  MDRP_NO                    /*  접수번호               */
		                 ,  MDCR_DLVY_SYS_DVSN_CD      /*  진료전달체계구분코드       */
		                 ,  MDCR_RFDC_VALD_YMD         /*  진료의뢰서 유효일자       */
		                 ,  DRLC_NO	                   /*  의사면허번호            */
		                 ,  SPC_HSPT_CD                /*  SPC병원코드            */
		                 ,  REHS_NM	                   /*  의뢰병원명              */
		                 ,  SPC_DR_CD                  /*  SPC의사코드            */
		                 ,  RFDR_NM	                   /*  의뢰의사명             */
						 ,  REFR_PATH_CD               /*  의뢰경로               */
		                 ,  REFR_PATH_DETL_CD          /*  의뢰경로상세            */                 
		                 ,  REFR_RERF_SNO              /*  의뢰회송번호*/
		                 ,  DCMN_UNIQ_NO               /*  문서고유번호*/
		                 ,  SAVE_LCTN_UNIQ_NO          /*  저장소위치고유번호*/
		                 ,  CLBR_CNTR_BSNS_DVSN_CD     /*  협력센터사업구분코드*/
		                 ,  REFR_RERF_INQR_NO          /*  의뢰회송조회번호*/
		                 ,  FINS_YN                    /*  완료여부     */ 
		                 ,  RPLY_RQST_YN               /*  회신요청여부*/  
		                 ,  IPA_SNO                    /*  정보공개동의일련번호*/ 
		                 ,  OTRS_HSPT_YN               /*  타병원재원여부*/
						 ,  FRST_RGSR_ID
						 ,  FRST_RGST_IP
						 ,  FRST_RGST_DT
						 ,  FRST_RGST_CLNT_PRGM_ID
						 ,  FRST_RGST_SRVR_PRGM_ID
						 ,  LAST_UPDR_ID
						 ,  LAST_UPDT_IP
						 ,  LAST_UPDT_DT
						 ,  LAST_UPDT_CLNT_PRGM_ID
						 ,  LAST_UPDT_SRVR_PRGM_ID
						)
				   values
						(
			   			 #{ptno}                       /*  환자번호               */
						 ,  nvl(  (select max(a1.REFR_SNO) + 1
			   						from SCRPATRFT a1
			   					   where a1.PTNO = #{ptno})
			   				   , 1)                                       /*  의뢰일련번호           */
						 ,  to_date(#{refrYmd},'YYYYMMDD') /*  의뢰일자               */				 
		                 ,  #{mdrpNo}                      /*  접수번호*/
		                 ,  #{mdcrDlvySysDvsnCd}           /*  진료전달체계구분코드*/
		                 ,  to_date(#{mdcrRfdcValdYmd},'YYYYMMDD')         /*  진료의뢰서 유효일자*/
		                 ,  #{drlcNo}	                   /*  의사면허번호*/
		                 ,  #{spcHsptCd}                   /*  SPC병원코드*/
		                 ,  #{rehsNm}	                   /*  의뢰병원명*/
		                 ,  #{spcDrCd}                     /*  SPC의사코드*/
		                 ,  #{rfdrNm}	                   /*  의뢰의사명*/	
		                 ,  #{refrPathCd}               /*  의뢰경로               */
		                 ,  #{refrPathDetlCd}          /*  의뢰경로상세            */                
		                 ,  #{refrRerfSno}              /*  의뢰회송번호*/
		                 ,  #{dcmnUniqNo}               /*  문서고유번호*/
		                 ,  #{saveLctnUniqNo}          /*  저장소위치고유번호*/
		                 ,  #{clbrCntrBsnsDvsnCd}     /*  협력센터사업구분코드*/
		                 ,  #{refrRerfInqrNo}          /*  의뢰회송조회번호*/
		                 ,  'Y'                        /*  완료여부*/
		                 ,  'Y'                        /*  회신요청여부*/
		                 ,  #{ipaSno}                  /*  정보공개동의일련번호*/
		                 ,  #{otrsHsptYn}              /*  타병원재원여부*/
						 ,  #{gvUserId}
			   		     ,  #{gvUserIp}
			   		     ,  sysdate
			   		     ,  #{gvClntPrgmId}
			   		     ,  #{gvSrvrPrgmId}
			   		     ,  #{gvUserId}
			   		     ,  #{gvUserIp}
			   		     ,  sysdate
			   		     ,  #{gvClntPrgmId}
			   		     ,  #{gvSrvrPrgmId}
						)
		 ]]>
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateClbrCntrAtmtRefrUpdt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateClbrCntrAtmtRefrUpdt"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateClbrCntrAtmtRefrUpdt */
		<![CDATA[
				   update  /*+ scd_scrpatr_u01$I01_환자의뢰정보 수정 */
						   SCRPATRFT
					  set
						   REFR_YMD                   =  to_date(#{refrYmd}, 'YYYYMMDD')               /*  의뢰일자               */			
		                ,  MDRP_NO                    =  #{mdrpNo}                                     /*  접수번호               */
		                ,  MDCR_DLVY_SYS_DVSN_CD      =  #{mdcrDlvySysDvsnCd}                          /*  진료전달체계구분코드       */
		                ,  MDCR_RFDC_VALD_YMD         =  to_date(#{mdcrRfdcValdYmd},'YYYYMMDD')        /*  진료의뢰서 유효일자       */
		                ,  DRLC_NO	                  =  #{drlcNo}	                                   /*  의사면허번호            */
		                ,  SPC_HSPT_CD                =  #{spcHsptCd}                                  /*  SPC병원코드            */
		                ,  REHS_NM	                  =  #{rehsNm}	                                   /*  의뢰병원명              */
		                ,  SPC_DR_CD                  =  #{spcDrCd}                                    /*  SPC의사코드            */
		                ,  RFDR_NM	                  =  #{rfdrNm}	                                   /*  의뢰의사명             */		
		                ,  REFR_RERF_SNO              =  #{refrRerfSno}                                /*  의뢰회송번호*/                       
		                ,  DCMN_UNIQ_NO               =  #{dcmnUniqNo}                                 /*  문서고유번호*/      
		                ,  SAVE_LCTN_UNIQ_NO          =  #{saveLctnUniqNo}                             /*  저장소위치고유번호*/ 
		                ,  CLBR_CNTR_BSNS_DVSN_CD     =  #{clbrCntrBsnsDvsnCd}                         /*  협력센터사업구분코드*/
		                ,  REFR_RERF_INQR_NO          =  #{refrRerfInqrNo}                             /*  의뢰회송조회번호*/   
		                ,  OTRS_HSPT_YN               =  #{otrsHsptYn}                                 /*  타병원재원여부*/
						,  LAST_UPDR_ID = #{gvUserId}
						,  LAST_UPDT_IP = #{gvUserIp}
						,  LAST_UPDT_DT = sysdate
						,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
						,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
					where  PTNO     = #{ptno}            /*  환자번호               */
					  and  REFR_SNO = #{refrSno}
		]]>
	</update>


	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrImfmInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="refryn" column="REFRYN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrImfmInqr (협력센터 의뢰 정보 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrImfmInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrImfmInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrImfmInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		select /*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrImfmInqr */
		        1  refrYn
		from SCRPATRFT
		where  PTNO     = #{ptno}            /*  환자번호               */
		  and  MDRP_NO = #{mdrpNo}
		]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-deleteClbrCntrSpcRefrDltn (협력센터 SPC 의뢰삭제) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
    -->	
	<delete id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-deleteClbrCntrSpcRefrDltn"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-deleteClbrCntrSpcRefrDltn */
		<![CDATA[
		delete
		from SCRPATRFT
		where MDRP_NO = #{mdrpNo}
		]]>
	</delete>


	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrPtntInfmInqr -result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="dvsnNm" column="DVSN_NM"/>
		<result property="refrRerfSno" column="REFR_RERF_SNO"/>
		<result property="refrRerfRlySno" column="REFR_RERF_RLY_SNO"/>
		<result property="spcHsptCd" column="SPC_HSPT_CD"/>
		<result property="hsptNm" column="HSPT_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrPtntInfmInqr  () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrPtntInfmInqr -result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrPtntInfmInqr "  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrPtntInfmInqr -result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrRefrPtntInfmInqr  */
		<![CDATA[
				SELECT a.PTNO
				     , a.DVSN_NM
				     , a.REFR_RERF_SNO
		             , a.REFR_RERF_RLY_SNO
				     , b.SPC_HSPT_CD
				     , nvl(b.HSPT_NM, a.TRNM_RCIS_NM) AS HSPT_NM
				FROM SCOHOSPMT b 
				   , (SELECT PTNO
				   		   , decode(REFR_DVSN_CD, '1', '진료정보교류', '의뢰회송') AS DVSN_NM
				   		   , REFR_RERF_SNO
		                   , REFR_RERF_RLY_SNO
				   		   , TRNM_RCIS_NO
				   		   , TRNM_RCIS_NM
				   		FROM SCZRERFMT
				   	   WHERE RLY_PTAL_MDCR_DVSN_CD = 'Y'   /* Y = 접수*/ 
				        -- AND MDRP_NO = 0
				 		AND PTNO = #{ptno}
				       ORDER BY REFR_RERF_SNO DESC) a
				WHERE a.TRNM_RCIS_NO = b.RCIS_NO(+)
				AND rownum = 1
				]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrApaSeqnInqr -result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="ipaSno" column="IPA_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrApaSeqnInqr  () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrApaSeqnInqr -result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrApaSeqnInqr "  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrApaSeqnInqr -result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrApaSeqnInqr  */
		<![CDATA[
				   SELECT  
						   nvl(max(IPA_SNO) + 1, 1) as IPA_SNO
				             from  SCINFAGRT
					]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-insertClbrCntrRefrAgrmInfmSave () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-insertClbrCntrRefrAgrmInfmSave"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-insertClbrCntrRefrAgrmInfmSave */
		insert  
				      into  SCINFAGRT
				         (
				                IPA_SNO                      /* 정보공개동의일련번호            */
				             ,  IPA_CNFR_YMD                 /* 정보공개동의확인일자            */
				             ,  PTNO                         /* 환자번호                        */
				             ,  IPA_FORM_KIND_CD             /* 정보공개동의서식종류코드        */
				             ,  IPA_TYPE_CD                  /* 정보공개동의유형코드            */
				             ,  IPA_YEAR_CNT                 /* 정보공개동의년수                */
				             ,  IPA_STRT_YMD                 /* 정보공개동의시작일자            */
				             ,  IPA_FNSH_YMD                 /* 정보공개동의종료일자            */
				             ,  NWBR_IPA_YN                  /* 신생아정보공개동의여부          */
							 ,  FRST_RGSR_ID
							 ,  FRST_RGST_IP
							 ,  FRST_RGST_DT
							 ,  FRST_RGST_CLNT_PRGM_ID
							 ,  FRST_RGST_SRVR_PRGM_ID
							 ,  LAST_UPDR_ID
							 ,  LAST_UPDT_IP
							 ,  LAST_UPDT_DT
							 ,  LAST_UPDT_CLNT_PRGM_ID
							 ,  LAST_UPDT_SRVR_PRGM_ID
				       )
				    values
				         (
				        		#{ipaSno}                       
				             ,  trunc(sysdate)
				             ,  #{ptno}                          
				             ,  '01'              
				             ,  '1'
				             ,  99
				             ,  trunc(sysdate) 
				             ,  to_date('29991231','YYYYMMDD')  
				             ,  'N'                
							 ,   #{gvUserId}
							 ,  #{gvUserIp}
							 ,  sysdate
							 ,  #{gvClntPrgmId}
							 ,  #{gvSrvrPrgmId}
							 ,  #{gvUserId}
							 ,  #{gvUserIp}
							 ,  sysdate
							 ,  #{gvClntPrgmId}
							 ,  #{gvSrvrPrgmId}
				)
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateClbrCntrRefrMdrpUpdt () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateClbrCntrRefrMdrpUpdt"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateClbrCntrRefrMdrpUpdt */
		UPDATE SCZRERFMT
				SET MDRP_NO = #{mdrpNo}
				WHERE PTNO = #{ptno}
				AND REFR_RERF_SNO = #{refrRerfSno}
	</update>


	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneDummy-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="argmYn" column="ARGM_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneDummy () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneDummy-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneDummy"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneDummy-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneDummy */
		select 
		     '' as ARGM_YN 
		from dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneElcrAgdcSgntYnInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="isncYn" column="ISNC_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneElcrAgdcSgntYnInqr (전자동의서 서명여부 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneElcrAgdcSgntYnInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneElcrAgdcSgntYnInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneElcrAgdcSgntYnInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		   select /*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneElcrAgdcSgntYnInqr */
		           case when count(a.PTNO) > 0
		                     and count(b.CRTT_ISNC_SNO) = 0
		                     and count(c.PTNO) = 0 then 'Y' else '' 
		            end as ISNC_YN
		     from APVCISNCT a , 
		          APVCESIMT b , 
		          MROPTCHRV c , 
		          MROPTFOMT d
		    where a.CRTT_ISNC_SNO = b.CRTT_ISNC_SNO(+)  
		      and a.PTNO = c.PTNO(+)
		      and a.PTNO = #{ptno}
		      and a.CRTT_CRTF_DT between to_Date(#{crttCrtfDt}, 'YYYYMMDD') and trunc(sysdate)
		      and a.CRTT_ID in ('C04','C16')
		      and a.CRTT_STTS_CD = '02'  -- 삭제상태가 아닌경우
		      and c.FORM_NO = d.ELCR_AGDC_FORM_NO(+)
		      and d.ELCR_AGDC_FORM_CD in ('MOPR_RCT_01','MOPR_RCT_03','MOPR_RCT_06','MOPR_RCT_08')
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneCrttElcrCrtfYnInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="isncYn" column="ISNC_YN"/>
		<result property="crttId" column="CRTT_ID"/>
		<result property="crttNm" column="CRTT_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneCrttElcrCrtfYnInqr (제증명 전자인증여부조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneCrttElcrCrtfYnInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneCrttElcrCrtfYnInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneCrttElcrCrtfYnInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		    select /*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneCrttElcrCrtfYnInqr */
		          a.ISNC_YN,
		          a.CRTT_ID,
		          listagg(a.CRTT_NM,',') within group(order by a.crtt_ID) as CRTT_NM
		    from 
		    (
		        select  a.ISNC_YN,
		                a.CRTT_ID,
		                (select CRTT_NM 
		                   from APVCCRTTT 
		                  where CRTT_ID = a.CRTT_ID 
		                    and rownum = 1) as CRTT_NM
		        From 
		        (
		            select  case when a.CRTT_ID = 'C04' and count(a.PTNO) > 0 then 'Y'
		                         when a.CRTT_ID <> 'C04' and count(a.PTNO) > 0 then 'Y'
		                         else ''
		                     end as ISNC_YN,
		                    a.CRTT_ID 
		              from APVCISNCT a 
		            where a.CRTT_ID in ('C04','C16','C44')
		              and a.ELSG_YN = 'Y'        -- 서명여부(의사)
		              and a.CRTT_STTS_CD ='10'
		              and substr(rtrim(a.CRTT_ISNC_NO), 6, 1) is null
		              and a.PTNO = #{ptno}
		              and a.CRTT_WRTG_DT between to_date(#{crttCrtfDt},'YYYYMMDD')  and trunc(sysdate) +0.9999
		              group by CRTT_ID
		              order by CRTT_ID              
		            ) a
		        ) a  
		    group by   a.ISNC_YN,
		               a.CRTT_ID
		]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-insertMdlnkptbt (정보공개동의 동의서 등록) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-insertMdlnkptbt"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-insertMdlnkptbt */
		INSERT INTO MDLNKPTBT 
		(
		   PTNO		 
		 , LNKD_SYST_CD		 
		 , LNKD_AGRM_CD		 
		 , LNKD_AGRM_DT		 
		 , LNKD_AGRM_CNCL_DT		 
		 , FRST_RGSR_ID		 
		 , FRST_RGST_IP		 
		 , FRST_RGST_DT		 
		 , FRST_RGST_CLNT_PRGM_ID		 
		 , FRST_RGST_SRVR_PRGM_ID		 
		 , LAST_UPDR_ID		 
		 , LAST_UPDT_IP		 
		 , LAST_UPDT_DT		 
		 , LAST_UPDT_CLNT_PRGM_ID		 
		 , LAST_UPDT_SRVR_PRGM_ID		 
		)
		VALUES
		(
		   #{ptno}
		 , #{lnkdSystCd}
		 , #{lnkdAgrmCd}
		 , to_date(#{lnkdAgrmDt},'YYYYMMDDHH24MISS')
		 , to_date(#{lnkdAgrmCnclDt},'YYYYMMDDHH24MISS')
		 , #{gvUserId}
		 , #{gvUserIp}
		 , sysdate
		 , #{gvClntPrgmId}
		 , #{gvSrvrPrgmId}
		 , #{gvUserId}
		 , #{gvUserIp}
		 , sysdate
		 , #{gvClntPrgmId}
		 , #{gvSrvrPrgmId}
		)
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateMdlnkptbt (진료정보교류 동의서 수정) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateMdlnkptbt"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-updateMdlnkptbt */
		UPDATE MDLNKPTBT
		   SET LNKD_AGRM_CD = nvl(#{lnkdAgrmCd}, LNKD_AGRM_CD)  		 
			 , LNKD_AGRM_DT = nvl(to_date(#{lnkdAgrmDt},'YYYYMMDD'), LNKD_AGRM_DT) 
			 , LNKD_AGRM_CNCL_DT = nvl(to_date(#{lnkdAgrmCnclDt},'YYYYMMDD'), LNKD_AGRM_CNCL_DT)
			 , LAST_UPDR_ID = #{gvUserId}
			 , LAST_UPDT_IP = #{gvUserIp}
			 , LAST_UPDT_DT = sysdate 
			 , LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
			 , LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		 WHERE PTNO = #{ptno}
		   AND LNKD_SYST_CD = #{lnkdSystCd}
	</update>


	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOnePtntInfmAgrmYnInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="inifAgrmSgntYn" column="INIF_AGRM_SGNT_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOnePtntInfmAgrmYnInqr (환자 정보공개동의여부 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOnePtntInfmAgrmYnInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOnePtntInfmAgrmYnInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOnePtntInfmAgrmYnInqr-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOnePtntInfmAgrmYnInqr */
		<![CDATA[
		    select 1 as INIF_AGRM_SGNT_YN 
		    from APPTPTNTT
		    where PTNO = #{ptno}
		      and INIF_AGRM_SGNT_YN = 'Y'
		  ]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneMdlnkptbt-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="lnkdSystCd" column="LNKD_SYST_CD"/>
		<result property="lnkdAgrmCd" column="LNKD_AGRM_CD"/>
		<result property="lnkdAgrmDt" column="LNKD_AGRM_DT"/>
		<result property="lnkdAgrmCnclDt" column="LNKD_AGRM_CNCL_DT"/>
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
		<result property="lastUpdtDt" column="LAST_UPDT_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneMdlnkptbt (진료정보교류 동의 조회) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneMdlnkptbt-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneMdlnkptbt"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneMdlnkptbt-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneMdlnkptbt */
		SELECT PTNO as PTNO		 
			 , LNKD_SYST_CD as LNKD_SYST_CD		 
			 , LNKD_AGRM_CD as LNKD_AGRM_CD		 
			 , to_char(LNKD_AGRM_DT, 'YYYYMMDD') as LNKD_AGRM_DT
			 , to_char(LNKD_AGRM_CNCL_DT, 'YYYYMMDD') as LNKD_AGRM_CNCL_DT		 
			 , to_char(FRST_RGST_DT,'YYYYMMDD') as FRST_RGST_DT		 
			 , to_char(LAST_UPDT_DT,'YYYYMMDD') as LAST_UPDT_DT
		  FROM MDLNKPTBT
		 WHERE PTNO = #{ptno}
		   AND LNKD_SYST_CD = #{lnkdSystCd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrOtrsHsptYnInqr-result" type="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO">
	
		<result property="otrsHsptYn" column="OTRS_HSPT_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrOtrsHsptYnInqr () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO
		resultMap : com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrOtrsHsptYnInqr-result
    -->
	<select id="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrOtrsHsptYnInqr"  parameterType="com.sds.healthcare.ehr.sup.sc.scm.vo.ScmClbrCntrInrlLnkdMngmDVO"  resultMap="com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrOtrsHsptYnInqr-result" useCache="true" flushCache="false">
		<![CDATA[
		select /*SQL_ID: com-sds-healthcare-ehr-sup-sc-scm-dao-ScmClbrCntrInrlLnkdMngmDAO-selectOneClbrCntrOtrsHsptYnInqr */
		       'Y' as OTRS_HSPT_YN
		  from APQLQLFCT b, SCOHOSPMT c
		 where b.PTNO = #{ptno}
		   and c.SPC_HSPT_CD  = #{spcHsptCd}
		   and trunc(sysdate) between b.ISTY_STRT_YMD and b.ISTY_FNSH_YMD   
		   and b.STHS_RCPR_INSY_ID  is not null
		   and c.RCIS_NO = b.STHS_RCPR_INSY_ID
		   and rownum = 1
		]]>   
	</select>



</mapper>