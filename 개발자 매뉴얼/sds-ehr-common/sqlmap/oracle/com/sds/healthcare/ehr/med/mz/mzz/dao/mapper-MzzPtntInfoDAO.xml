<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_MzzPtntInfoDAO_sql.xml 
    Description :                                      MCOM환자정보조회DAO
                  -->
<mapper namespace="MzzPtntInfoDAO">


	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByPtno0001-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="bsovAftrPtno" column="BSOV_AFTR_PTNO"/>
		<result property="btdt" column="BTDT"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="afiClno" column="AFI_CLNO"/>
		<result property="housZpadNm" column="HOUS_ZPAD_NM"/>
		<result property="addSexAge" column="ADD_SEX_AGE"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByPtno0001 () 
        Description :                                           진료환자 조회_환자번호 mzd_ptptntt_l05, mzd_ptptntt_l01
                                            
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByPtno0001-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByPtno0001"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByPtno0001-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByPtno0001 */
		select  /*+ mzd_ptptntt_l05$S01_진료환자 조회_DAM */
		        ptp.PTNO                                       PTNO                     /* 환자번호(합본된 환자번호 있으면 합본번호) */
		     ,  ptp.PTNT_NM                                                             /* 환자명                   */
		     ,  ptp.BSOV_AFTR_PTNO                                                      /* 합본이후환자번호         */
		     ,  to_char(ptp.BTDT, 'YYYYMMDD')                  BTDT                     /* 생년월일                 */
		     ,  ptp.GEND_CD                                                             /* 성별코드                 */
		     ,  ( select  case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                       when length(PTNT_TLNO) = 10 then case
		                                                          when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                            then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                            else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                        end
		                       when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                       when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                       when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                   else PTNT_TLNO
		                  end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		            from  APPTCNPNV ptc
		           where  ptc.PTNO         = ptp.PTNO
		             and  ptc.CNPN_DVSN_CD = 'BP'
		             and  ptc.CNPN_SNO     = 1        )        as AFI_CLNO              /* 휴대전화번호      */
		     ,  ( select  ada.ZPAD_NM
		            from  APPTADRSV ada
		           where  ada.PTNO         = ptp.PTNO
		             and  ada.ADRS_USGE_CD = 'A'
		             and  ada.ADRS_SNO     = 1        )        as HOUS_ZPAD_NM          /* 집우편번호주소명  */
		     ,  cast('' as VARCHAR(100)) as ADD_SEX_AGE     /* 성별/나이 추가 컬럼(화면사용) */
		  from
		        APPTPTNTT ptp
		 where  1=1
		 <choose>
		     <when test="ptno != null and ptno.length() == 8">
		   and  ptp.PTNO = #{ptno}
		     </when>
		     <otherwise>
		   and  ptp.PTNO like #{ptno} || '%'
		     </otherwise>
		 </choose>
		   and  FN_MD_VIPAUTHYN(ptp.PTNO, #{userId}, #{userIp}) = 'Y'  /* 특정 환자번호 대상자를 조회할 수 있는지 여부를 확인한다. */
		 order
		    by  ptp.PTNT_NM, ptp.BTDT
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByNm0001-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="bsovAftrPtno" column="BSOV_AFTR_PTNO"/>
		<result property="btdt" column="BTDT"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="afiClno" column="AFI_CLNO"/>
		<result property="housZpadNm" column="HOUS_ZPAD_NM"/>
		<result property="addSexAge" column="ADD_SEX_AGE"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByNm0001 () 
        Description :                                           진료환자 조회_진료명 mzd_ptptntt_l02 mzd_ptptntt_l04
                                            
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByNm0001-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByNm0001"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByNm0001-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfoByNm0001 */
		select  /*+ mzd_ptptntt_l02$S01_진료환자 조회_DAM */
		        ptp.PTNO                                       PTNO                     /* 환자번호(합본된 환자번호 있으면 합본번호) */
		     ,  ptp.PTNT_NM                                                             /* 환자명                   */
		     ,  ptp.BSOV_AFTR_PTNO                                                      /* 합본이후환자번호         */
		     ,  to_char(ptp.BTDT, 'YYYYMMDD')                  BTDT                     /* 생년월일                 */
		     ,  ptp.GEND_CD                                                             /* 성별코드                 */
		     ,  ( select  case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                       when length(PTNT_TLNO) = 10 then case
		                                                          when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                            then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                            else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                        end
		                       when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                       when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                       when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                   else PTNT_TLNO
		                  end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		            from  APPTCNPNV ptc
		           where  ptc.PTNO         = ptp.PTNO
		             and  ptc.CNPN_DVSN_CD = 'BP'
		             and  ptc.CNPN_SNO     = 1        )        as AFI_CLNO              /* 휴대전화번호      */
		     ,  ( select  ada.ZPAD_NM
		            from  APPTADRSV ada
		           where  ada.PTNO         = ptp.PTNO
		             and  ada.ADRS_USGE_CD = 'A'
		             and  ada.ADRS_SNO     = 1        )        as HOUS_ZPAD_NM          /* 집우편번호주소명  */
		     ,  cast('' as VARCHAR(100)) as ADD_SEX_AGE     /* 성별/나이 추가 컬럼(화면사용) */
		  from
		        APPTPTNTT ptp
		 where  1 = 1
		   and  #{inqrWayCd} = #{inqrWayCd}
		 <choose>
		     <when test="inqrWayCd == 'LIKE'">
		   and  ptp.PTNT_NM like #{ptntNm} || '%'
		     </when>
		     <otherwise>
		   and  ptp.PTNT_NM = #{ptntNm}
		     </otherwise>
		 </choose>
		   and  FN_MD_VIPAUTHYN(ptp.PTNO, #{userId}, #{userIp}) = 'Y'  /* 특정 환자번호 대상자를 조회할 수 있는지 여부를 확인한다. */
		 order
		    by  ptp.PTNT_NM, ptp.BTDT
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntInfo0001-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="ptntAlisNm" column="PTNT_ALIS_NM"/>
		<result property="ptntEnsnLsnm" column="PTNT_ENSN_LSNM"/>
		<result property="ptntEnsnNm" column="PTNT_ENSN_NM"/>
		<result property="frrn" column="FRRN"/>
		<result property="brrn" column="BRRN"/>
		<result property="bsovAftrPtno" column="BSOV_AFTR_PTNO"/>
		<result property="bsrn" column="BSRN"/>
		<result property="btdt" column="BTDT"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="ageVl" column="AGE_VL"/>
		<result property="ntnlCd" column="NTNL_CD"/>
		<result property="psptNo" column="PSPT_NO"/>
		<result property="ptntInfwPathCd" column="PTNT_INFW_PATH_CD"/>
		<result property="inccPtntYn" column="INCC_PTNT_YN"/>
		<result property="rqprTlnoCtn" column="RQPR_TLNO_CTN"/>
		<result property="rqprNm" column="RQPR_NM"/>
		<result property="rqstInprId" column="RQST_INPR_ID"/>
		<result property="rqstInptDt" column="RQST_INPT_DT"/>
		<result property="dethYmd" column="DETH_YMD"/>
		<result property="dethHh" column="DETH_HH"/>
		<result property="dethYmdRgsrId" column="DETH_YMD_RGSR_ID"/>
		<result property="prtsRsrn" column="PRTS_RSRN"/>
		<result property="prtsNm" column="PRTS_NM"/>
		<result property="inifAgrmYn" column="INIF_AGRM_YN"/>
		<result property="snstInfmAgrmYn" column="SNST_INFM_AGRM_YN"/>
		<result property="uniqIdntInfmAgrmYn" column="UNIQ_IDNT_INFM_AGRM_YN"/>
		<result property="inifAgrmRgstSystNm" column="INIF_AGRM_RGST_SYST_NM"/>
		<result property="inifAgrmSgntYn" column="INIF_AGRM_SGNT_YN"/>
		<result property="scryYn" column="SCRY_YN"/>
		<result property="insrQlfcExclYn" column="INSR_QLFC_EXCL_YN"/>
		<result property="emailId" column="EMAIL_ID"/>
		<result property="emailDmanNm" column="EMAIL_DMAN_NM"/>
		<result property="cashRcptUseNo" column="CASH_RCPT_USE_NO"/>
		<result property="ovrsRsdtYn" column="OVRS_RSDT_YN"/>
		<result property="rmrkCtn" column="RMRK_CTN"/>
		<result property="afiHousTlno" column="AFI_HOUS_TLNO"/>
		<result property="afiClno" column="AFI_CLNO"/>
		<result property="afiOcplTlno" column="AFI_OCPL_TLNO"/>
		<result property="afiEtcTlno" column="AFI_ETC_TLNO"/>
		<result property="housZpcd" column="HOUS_ZPCD"/>
		<result property="housZpadNm" column="HOUS_ZPAD_NM"/>
		<result property="housDeadNm" column="HOUS_DEAD_NM"/>
		<result property="ocplZpcd" column="OCPL_ZPCD"/>
		<result property="ocplZpadNm" column="OCPL_ZPAD_NM"/>
		<result property="ocplDeadNm" column="OCPL_DEAD_NM"/>
		<result property="aboBltyCd" column="ABO_BLTY_CD"/>
		<result property="rhBltyCd" column="RH_BLTY_CD"/>
		<result property="hghtVl" column="HGHT_VL"/>
		<result property="bdwgVl" column="BDWG_VL"/>
		<result property="ltstOprtYmd" column="LTST_OPRT_YMD"/>
		<result property="ltstOprtSno" column="LTST_OPRT_SNO"/>
		<result property="ltstMdcrYmd" column="LTST_MDCR_YMD"/>
		<result property="btypVrinPcbkNoCtn" column="BTYP_VRIN_PCBK_NO_CTN"/>
		<result property="dndpPtno" column="DNDP_PTNO"/>
		<result property="dsblYn" column="DSBL_YN"/>
		<result property="mdppBdwgVl" column="MDPP_BDWG_VL"/>
		<result property="emrPtntEnsnNm" column="EMR_PTNT_ENSN_NM"/>
		<result property="mnpsYn" column="MNPS_YN"/>
		<result property="opcaYn" column="OPCA_YN"/>
		<result property="lastDschYmd" column="LAST_DSCH_YMD"/>
		<result property="afiCatnColoNm" column="AFI_CATN_COLO_NM"/>
		<result property="afiCancExptCtn" column="AFI_CANC_EXPT_CTN"/>
		<result property="afiRareExptCtn" column="AFI_RARE_EXPT_CTN"/>
		<result property="frgnIdntCd" column="FRGN_IDNT_CD"/>
		<result property="frgnRgstNo" column="FRGN_RGST_NO"/>
		<result property="ssn" column="SSN"/>
		<result property="vipYn" column="VIP_YN"/>
		<result property="vipCtn" column="VIP_CTN"/>
		<result property="ptntExprVltnYn" column="PTNT_EXPR_VLTN_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntInfo0001 () 
        Description :                                           진료환자 단건 조회 mzd_ptptntt_s01
                                            
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntInfo0001-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntInfo0001"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntInfo0001-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntInfo0001 */
		select  /*+ mzd_ptptntt_s01$S01_진료환자 단건 조회_DAM */
		        ptp.PTNO                                                                /* 환자번호                 */
		     ,  ptp.PTNT_NM                                                             /* 환자명                   */
		     ,  ptp.PTNT_ALIS_NM                                                        /* 환자별칭명               */
		     ,  ptp.PTNT_ENSN_LSNM                                                      /* 환자영문성               */
		     ,  ptp.PTNT_ENSN_NM                                                        /* 환자영문명               */
		     ,  ptp.FRRN                                                                /* 앞주민등록번호           */
		     ,  ptp.BRRN                                                                /* 뒤주민등록번호           */
		     ,  ptp.BSOV_AFTR_PTNO                                                      /* 합본이후환자번호         */
		     ,  ptp.BSRN                                                                /* 사업자등록번호           */
		     ,  to_char(ptp.BTDT, 'YYYYMMDD')                 as BTDT                   /* 생년월일                 */
		     ,  ptp.GEND_CD                                                             /* 성별코드                 */
		     ,  case
		          when (ptp.FRRN is not null)
		               and (SUBSTR(ptp.FRRN, 3,2) between '01' and '12')
		               and (SUBSTR(ptp.FRRN, 5,2) between '01' and '31')
		            then trunc( months_between(trunc(sysdate), to_date(case when substr(ptp.BRRN, 1, 1) in ('1', '2') then '19'
		                                                                    when substr(ptp.BRRN, 1, 1) in ('3', '4') then '20'
		                                                                    else decode( sign(to_number(ptp.FRRN)-to_number(to_char(trunc(sysdate), 'yymmdd'))), 1, '19', '20')
		                                                               end || FRRN, 'yyyymmdd')
		                                      ) / 12
		                      )
		          when ptp.BTDT is not null
		            then trunc(months_between(trunc(sysdate), ptp.BTDT)/ 12)
		          else null
		        end   as AGE_VL                 /* 나이(연령값)  성능이슈 펑션 제거  fn_ap_age_s(ptp.PTNO,trunc(sysdate))     */
		     ,  ptp.NTNL_CD                                                             /* 국적코드                 */
		     ,  ptp.PSPT_NO                                                             /* 여권번호                 */
		     ,  ptp.PTNT_INFW_PATH_CD                                                   /* 환자유입경로코드         */
		     ,  ptp.INCC_PTNT_YN                                                        /* 국제진료소환자여부       */
		     ,  ptp.RQPR_TLNO_CTN                                                       /* 요청자전화번호내용       */
		     ,  ptp.RQPR_NM                                                             /* 요청자명                 */
		     ,  ptp.RQST_INPR_ID                                                        /* 요청입력자ID             */
		     ,  to_char(ptp.RQST_INPT_DT, 'YYYYMMDDHH24MISS') as RQST_INPT_DT           /* 요청입력일시             */
		     ,  to_char(ptp.DETH_YMD, 'YYYYMMDD')               as DETH_YMD             /* 사망일자                 */
		     ,  to_char(ptp.DETH_YMD, 'hh24mi')               as DETH_HH                /* 사망시간                 */
		     ,  ptp.DETH_YMD_RGSR_ID                                                    /* 사망일자등록자ID         */
		     ,  ptp.PRTS_RSRN                                                           /* 부모주민등록번호         */
		     ,  ptp.PRTS_NM                                                             /* 부모명                   */
		     ,  ptp.INIF_AGRM_YN                                                        /* 개인정보동의여부         */
		     ,  ptp.SNST_INFM_AGRM_YN                                                   /* 민감정보동의여부         */
		     ,  ptp.UNIQ_IDNT_INFM_AGRM_YN                                              /* 고유식별정보동의여부     */
		     ,  ptp.INIF_AGRM_RGST_SYST_NM                                              /* 개인정보동의등록시스템명 */
		     ,  ptp.INIF_AGRM_SGNT_YN                                                   /* 개인정보동의서명여부     */
		     ,  ptp.SCRY_YN                                                             /* 보안여부                 */
		     ,  ptp.INSR_QLFC_EXCL_YN                                                   /* 보험자격제외여부         */
		     ,  ptp.EMAIL_ID                                                            /* 이메일ID                 */
		     ,  ptp.EMAIL_DMAN_NM                                                       /* 이메일입력도메인명       */
		     ,  ptp.CASH_RCPT_USE_NO                                                    /* 현금영수증사용번호       */
		     ,  ptp.OVRS_RSDT_YN                                                        /* 해외거주자여부           */
		     ,  ptp.RMRK_CTN                                                            /* 비고내용                 */
		     , (select case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                    when length(PTNT_TLNO) = 10 then case
		                                                       when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                         then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                         else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                     end
		                    when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                    when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                    when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                else PTNT_TLNO
		               end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		          from APPTCNPNV ptc
		         where ptc.PTNO         = ptp.PTNO
		           and ptc.CNPN_DVSN_CD = 'BH'
		           and ptc.CNPN_SNO     = 1     )             as AFI_HOUS_TLNO          /* 집전화번호              */
		     , (select case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                    when length(PTNT_TLNO) = 10 then case
		                                                       when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                         then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                         else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                     end
		                    when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                    when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                    when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                else PTNT_TLNO
		               end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		          from APPTCNPNV ptc
		         where ptc.PTNO         = ptp.PTNO
		           and ptc.CNPN_DVSN_CD = 'BP'
		           and ptc.CNPN_SNO     = 1     )             as AFI_CLNO               /* 휴대전화번호            */
		     , (select case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                    when length(PTNT_TLNO) = 10 then case
		                                                       when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                         then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                         else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                     end
		                    when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                    when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                    when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                else PTNT_TLNO
		               end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		          from APPTCNPNV ptc
		         where ptc.PTNO         = ptp.PTNO
		           and ptc.CNPN_DVSN_CD = 'BO'
		           and ptc.CNPN_SNO     = 1     )             as AFI_OCPL_TLNO          /*  직장전화번호           */
		     , (select case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                    when length(PTNT_TLNO) = 10 then case
		                                                       when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                         then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                         else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                     end
		                    when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                    when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                    when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                else PTNT_TLNO
		               end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		          from APPTCNPNV ptc
		         where ptc.PTNO         = ptp.PTNO
		           and ptc.CNPN_DVSN_CD = 'EA'
		           and ptc.CNPN_SNO     = 1     )             as AFI_ETC_TLNO           /* 기타전화번호             */
		     ,  ada.ZPCD                                      as HOUS_ZPCD              /* 집우편번호               */
		     ,  ada.ZPAD_NM                                   as HOUS_ZPAD_NM           /* 집우편번호주소명         */
		     ,  ada.DEAD_NM                                   as HOUS_DEAD_NM           /* 집상세주소명             */
		     ,  ado.ZPCD                                      as OCPL_ZPCD              /* 직장우편번호             */
		     ,  ado.ZPAD_NM                                   as OCPL_ZPAD_NM           /* 직장우편번호주소명       */
		     ,  ado.DEAD_NM                                   as OCPL_DEAD_NM           /* 직장상세주소명           */
		     ,  pta.ABO_BLTY_CD                                                         /* ABO혈액형코드            */
		     ,  pta.RH_BLTY_CD                                                          /* RH혈액형코드             */
		     ,  pta.HGHT_VL                                                             /* 신장값                   */
		     ,  pta.BDWG_VL                                                             /* 체중값                   */
		     ,  to_char(pta.LTST_OPRT_YMD, 'YYYYMMDD')        as LTST_OPRT_YMD          /* 최근수술일자             */
		     ,  pta.LTST_OPRT_SNO                                                       /* 최근수술일련번호         */
		     ,  to_char(pta.LTST_MDCR_YMD, 'YYYYMMDD')        as LTST_MDCR_YMD          /* 최근진료일자             */
		     ,  pta.BTYP_VRIN_PCBK_NO_CTN                                               /* B형수직감염수첩번호내용  */
		     ,  pta.DNDP_PTNO                                                           /* 치과환자번호             */
		     ,  pta.DSBL_YN                                                             /* 장애여부                 */
		     ,  pta.MDPP_BDWG_VL                                                        /* 투약용체중값             */
		     ,  pta.EMR_PTNT_ENSN_NM                                                    /* EMR환자영문명            */
		     ,  pta.MNPS_YN                                                             /* 폐경여부                 */
		     ,  fn_ac_get_opca_rgst_yn(ptp.PTNO, sysdate) as OPCA_YN             /* 오픈카드여부             */
		     ,  (select  /*+ INDEX_DESC(rcr APRCRPTNT_I12) */
		                 to_char(rcr.DSCH_DT, 'YYYYMMDD')
		           from  APRCRPTNT rcr
		          where  rcr.PTNO     = ptp.PTNO
		            and  rcr.CODV_CD  = 'I'
		            and  rcr.DSCH_DT is not null
		            and  rcr.DSCH_DT != to_date('29991231','YYYYMMDD')
		            and  rcr.CNCL_DT is null
		            and  rownum = 1
		        )                                                                                            as LAST_DSCH_YMD     /* 최종퇴원일자    */
		     ,  (select FN_QD_CAUTION_COLOR_VL(ptp.PTNO) from dual)                                   as AFI_CATN_COLO_NM  /* AFI주의색명     */
		     ,  (select FN_AC_CHECK_APQLQLDLT(nvl(ptp.BSOV_AFTR_PTNO, ptp.PTNO),'','','M') from dual) as AFI_CANC_EXPT_CTN /* AFI암만료내용   */
		     ,  (select FN_AC_CHECK_APQLQLDLT(nvl(ptp.BSOV_AFTR_PTNO, ptp.PTNO),'','','N') from dual) as AFI_RARE_EXPT_CTN /* AFI희귀만료내용 */
		     ,  ptp.FRGN_IDNT_CD               /* 외국인식별코드 */
		     ,  ptp.FRGN_RGST_NO               /* 외국인등록번호 */
		     ,  ptp.SSN                        /* SSN */
		     ,  ptp.VIP_YN                     /* VIP여부 */
		     ,  ptp.VIP_CTN                    /* VIP내용 */
			 ,  SEHRFUN.FN_MD_GET_PTNT_EXPR_YN(ptp.PTNO) as PTNT_EXPR_VLTN_YN /* 환자경험. 20210510 추가 */
		  from
		        APPTPTNTT ptp
		     ,  APPTADIFT pta   /*환자부가정보 */
		     ,  APPTADRSV ada   /*집주소*/
		     ,  APPTADRSV ado   /*직장주소*/
		 where  1=1
		   and  ptp.PTNO            = #{ptno}
		   and  pta.PTNO         (+)= ptp.PTNO
		   and  ada.PTNO         (+)= ptp.PTNO
		   and  ada.ADRS_USGE_CD (+)= 'A'
		   and  ada.ADRS_SNO     (+)= 1
		   and  ado.PTNO         (+)= ptp.PTNO
		   and  ado.ADRS_USGE_CD (+)= 'O'
		   and  ado.ADRS_SNO     (+)= 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtnoByRsrhId0001-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="ptno" column="PTNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtnoByRsrhId0001 () 
        Description :                                           연구대상 목록 조회 mzd_rsrprjt_l01
                                            
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtnoByRsrhId0001-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtnoByRsrhId0001"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtnoByRsrhId0001-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtnoByRsrhId0001 */
		select
		         /*+ 연구과제_연구자 조회 */
		         decode(FN_RP_AUTH_CLRS_PT(#{ptno},#{rsrhId}), 'Y', #{ptno}, '') as PTNO
		 from dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0001-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="mdrpNo" column="MDRP_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0001 () 
        Description :                                           수술진료접수번호조회(외래) mdd_aprcrpt_s30
                                            
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0001-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0001"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0001-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0001 */
		<![CDATA[
		select  /*+ mdd_aprcrpt_s30$S01_수술내역 matching 외래 접수번호 조회 */
		        a.MDRP_NO
		  from
		        APRCRPTNT a
		 where
		        a.PTNO      =   #{ptno}
		   and  a.MDCR_YMD  =   to_date(#{oprtYmd}, 'YYYYMMDD')
		   and  a.MCDP_CD   =   #{ordpCd}
		   and  a.CODV_CD   =   'O'
		   and  nvl(a.MCFE_RCPC_CD, 'N') <> 'R'
		  -- and  a.MDCR_ANDV_CD <> '8' --20180915 taebum 2차 무료접수는 제외 조건 추가
		   and  a.CNCL_DT is null
		   and  rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0002-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="mdrpNo" column="MDRP_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0002 () 
        Description :                                           수술진료접수번호조회(응급) mdd_aprcrpt_s31
                                            
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0002-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0002"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0002-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0002 */
		<![CDATA[
		select  /*+ mdd_aprcrpt_s31$S01_수술내역matching되는 응급 접수번호 조회 */
		        MDRP_NO
		  from  (
		        select  1 as PROR_NO       /*입원 먼저 : as-is SearchIPatInfo('P', OpDate)  */
		             ,  a.MDRP_NO
		          from  APRCRPTNT a
		         where  a.PTNO      =  #{ptno}
		           and  a.CODV_CD   =   'I'
		           and  (  (a.DSCH_DT  = to_date('29991231', 'YYYYMMDD'))
		                or (a.DSCH_DT   between trunc(sysdate) and sysdate + 1)                /* 퇴원 안했거나 오늘 퇴원한 환자 */
		                )
		           and  trunc(a.ERRM_ARVL_DT)  <=  to_date(#{oprtYmd}, 'YYYYMMDD')   /* 경유입원 시 입원일자가 넘어가는 경우 */
		           and  a.DSCH_DT   >   to_date(#{oprtYmd}, 'YYYYMMDD')
		           and  a.CNCL_DT is null
		           and  a.ERRM_ARVL_DT is not null
		           and  rownum = 1
		         union all
		        select  2  as PROR_NO   /* 살아 있는 응급 중 가장 최신 : as-is SearchEPatInfo */
		             ,  a.MDRP_NO
		          from  MNEERRPAT a
		             ,  APRCRPTNT b
		         where  1=1
		           and  a.PTNO      =  #{ptno}
		           and  a.COHS_DT   =  ( select max(sub.COHS_DT)
		                                   from MNEERRPAT sub
		                                  where sub.PTNO    = a.PTNO
		                                    and sub.STHS_YN = 'Y'
		                               )
		           and  a.STHS_YN = 'Y'
		           and  nvl(a.ERMR_RSLT_CD, '0') <> '4'
		           and  b.MDRP_NO   =  a.MDRP_NO
		           and  b.PTNO      =  a.PTNO
		           and  b.MDCR_DT   =  a.COHS_DT
		           and  b.CODV_CD   =  'E'
		           and  b.CNCL_DT  is null
		           and  rownum = 1
		        )
		 where  rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0003-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="mdrpNo" column="MDRP_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0003 () 
        Description :                                           수술진료접수번호조회(입원) mdd_aprcrpt_s32
                                            
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0003-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0003"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0003-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0003 */
		<![CDATA[
		select  /*+ mdd_aprcrpt_s32$S01_수술내역matching되는 입원 접수번호 조회 */
		        a.MDRP_NO
		  from
		        APRCRPTNT a
		 where
		        a.PTNO      =   #{ptno}
		   and  a.CODV_CD   =   'I'
		   and  a.MDCR_YMD  <=  to_date(#{oprtYmd}, 'YYYYMMDD') + .99999
		   and  a.DSCH_DT   >=   to_date(#{oprtYmd}, 'YYYYMMDD')
		   and  a.CNCL_DT is null
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0004-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="mdrpNo" column="MDRP_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0004 () 
        Description :                                           수술진료접수번호조회(DSC) mdd_aprcrpt_s33
                                            
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0004-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0004"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0004-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOneMdrpNoByOprt0004 */
		select  /*+ mdd_aprcrpt_s33$S01_수술내역matching되는 DSC 접수번호 조회 */
		        case
		          when (b.DSCH_DT between trunc(sysdate) and sysdate + 1) then b.MDRP_NO    /* 오늘 퇴원까지는  그냥 dsc */
		          when b.ERRM_ARVL_DT is not null      /* 응급실 경유일시가 있는 경우 진료접수관계테이블을 통해 입원의 진료접수번호를 찾는다.  */
		            then (select  i.MDRP_NO                        /* 입원의 진료접수번호*/
		                    from  APRCRLTNT i               /* 진료접수관계 */
		                       ,  APRCRPTNT r
		                   where  i.MDRP_RLTN_MDRP_NO = b.MDRP_NO  /* 응급의 진료접수번호*/
		                     and  i.MDRP_RLTN_DVSN_CD = '02'
		                     and  r.MDRP_NO  = i.MDRP_NO
		                     and  r.CODV_CD  = 'I'
		                     -- and  r.DSCH_DT  = to_date('29991231', 'YYYYMMDD')  /* DSC경유입원 환자는 과거입원도 올림 */
		                     and  r.CNCL_DT is null)
		          else b.MDRP_NO
		        end as MDRP_NO
		  from  APRCRPTNT b
		 where  1=1
		   and  b.PTNO      =  #{ptno}
		   and  b.MDCR_YMD  =   to_date(#{oprtYmd}, 'YYYYMMDD')
		   and  b.CODV_CD   =  'D'
		   and  b.CNCL_DT  is null
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntByPtno0001-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="ptntAlisNm" column="PTNT_ALIS_NM"/>
		<result property="ptntEnsnLsnm" column="PTNT_ENSN_LSNM"/>
		<result property="ptntEnsnNm" column="PTNT_ENSN_NM"/>
		<result property="frrn" column="FRRN"/>
		<result property="brrn" column="BRRN"/>
		<result property="bsovAftrPtno" column="BSOV_AFTR_PTNO"/>
		<result property="bsrn" column="BSRN"/>
		<result property="btdt" column="BTDT"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="ageVl" column="AGE_VL"/>
		<result property="ntnlCd" column="NTNL_CD"/>
		<result property="psptNo" column="PSPT_NO"/>
		<result property="ptntInfwPathCd" column="PTNT_INFW_PATH_CD"/>
		<result property="inccPtntYn" column="INCC_PTNT_YN"/>
		<result property="rqprTlnoCtn" column="RQPR_TLNO_CTN"/>
		<result property="rqprNm" column="RQPR_NM"/>
		<result property="rqstInprId" column="RQST_INPR_ID"/>
		<result property="rqstInptDt" column="RQST_INPT_DT"/>
		<result property="dethYmd" column="DETH_YMD"/>
		<result property="dethYmdRgsrId" column="DETH_YMD_RGSR_ID"/>
		<result property="prtsRsrn" column="PRTS_RSRN"/>
		<result property="prtsNm" column="PRTS_NM"/>
		<result property="inifAgrmYn" column="INIF_AGRM_YN"/>
		<result property="snstInfmAgrmYn" column="SNST_INFM_AGRM_YN"/>
		<result property="uniqIdntInfmAgrmYn" column="UNIQ_IDNT_INFM_AGRM_YN"/>
		<result property="inifAgrmRgstSystNm" column="INIF_AGRM_RGST_SYST_NM"/>
		<result property="inifAgrmSgntYn" column="INIF_AGRM_SGNT_YN"/>
		<result property="scryYn" column="SCRY_YN"/>
		<result property="insrQlfcExclYn" column="INSR_QLFC_EXCL_YN"/>
		<result property="emailId" column="EMAIL_ID"/>
		<result property="emailDmanNm" column="EMAIL_DMAN_NM"/>
		<result property="cashRcptUseNo" column="CASH_RCPT_USE_NO"/>
		<result property="ovrsRsdtYn" column="OVRS_RSDT_YN"/>
		<result property="rmrkCtn" column="RMRK_CTN"/>
		<result property="afiHousTlno" column="AFI_HOUS_TLNO"/>
		<result property="afiClno" column="AFI_CLNO"/>
		<result property="afiOcplTlno" column="AFI_OCPL_TLNO"/>
		<result property="afiEtcTlno" column="AFI_ETC_TLNO"/>
		<result property="housZpcd" column="HOUS_ZPCD"/>
		<result property="housZpadNm" column="HOUS_ZPAD_NM"/>
		<result property="housDeadNm" column="HOUS_DEAD_NM"/>
		<result property="ocplZpcd" column="OCPL_ZPCD"/>
		<result property="ocplZpadNm" column="OCPL_ZPAD_NM"/>
		<result property="ocplDeadNm" column="OCPL_DEAD_NM"/>
		<result property="aboBltyCd" column="ABO_BLTY_CD"/>
		<result property="rhBltyCd" column="RH_BLTY_CD"/>
		<result property="hghtVl" column="HGHT_VL"/>
		<result property="bdwgVl" column="BDWG_VL"/>
		<result property="ltstOprtYmd" column="LTST_OPRT_YMD"/>
		<result property="ltstOprtSno" column="LTST_OPRT_SNO"/>
		<result property="ltstMdcrYmd" column="LTST_MDCR_YMD"/>
		<result property="btypVrinPcbkNoCtn" column="BTYP_VRIN_PCBK_NO_CTN"/>
		<result property="dndpPtno" column="DNDP_PTNO"/>
		<result property="dsblYn" column="DSBL_YN"/>
		<result property="mdppBdwgVl" column="MDPP_BDWG_VL"/>
		<result property="emrPtntEnsnNm" column="EMR_PTNT_ENSN_NM"/>
		<result property="mnpsYn" column="MNPS_YN"/>
		<result property="opcaYn" column="OPCA_YN"/>
		<result property="lastDschYmd" column="LAST_DSCH_YMD"/>
		<result property="afiCatnColoNm" column="AFI_CATN_COLO_NM"/>
		<result property="afiCancExptCtn" column="AFI_CANC_EXPT_CTN"/>
		<result property="afiRareExptCtn" column="AFI_RARE_EXPT_CTN"/>
		<result property="frgnIdntCd" column="FRGN_IDNT_CD"/>
		<result property="frgnRgstNo" column="FRGN_RGST_NO"/>
		<result property="ssn" column="SSN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntByPtno0001 () 
        Description :                                           환저정보조회 mzd_ptptntt_s01
                                            
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntByPtno0001-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntByPtno0001"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntByPtno0001-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-selectOnePtntByPtno0001 */
		select  /*+ mzd_ptptntt_s01$S01_진료환자 단건 조회_DAM */
		        ptp.PTNO                                                                /* 환자번호                 */
		     ,  ptp.PTNT_NM                                                             /* 환자명                   */
		     ,  ptp.PTNT_ALIS_NM                                                        /* 환자별칭명               */
		     ,  ptp.PTNT_ENSN_LSNM                                                      /* 환자영문성               */
		     ,  ptp.PTNT_ENSN_NM                                                        /* 환자영문명               */
		     ,  ptp.FRRN                                                                /* 앞주민등록번호           */
		     ,  ptp.BRRN                                                                /* 뒤주민등록번호           */
		     ,  ptp.BSOV_AFTR_PTNO                                                      /* 합본이후환자번호         */
		     ,  ptp.BSRN                                                                /* 사업자등록번호           */
		     ,  to_char(ptp.BTDT, 'YYYYMMDD')                 as BTDT                   /* 생년월일                 */
		     ,  ptp.GEND_CD                                                             /* 성별코드                 */
		     ,  case
		          when (ptp.FRRN is not null)
		               and (SUBSTR(ptp.FRRN, 3,2) between '01' and '12')
		               and (SUBSTR(ptp.FRRN, 5,2) between '01' and '31')
		            then trunc( months_between(trunc(sysdate), to_date(case when substr(ptp.BRRN, 1, 1) in ('1', '2') then '19'
		                                                                    when substr(ptp.BRRN, 1, 1) in ('3', '4') then '20'
		                                                                    else decode( sign(to_number(ptp.FRRN)-to_number(to_char(trunc(sysdate), 'yymmdd'))), 1, '19', '20')
		                                                               end || FRRN, 'yyyymmdd')
		                                      ) / 12
		                      )
		          when ptp.BTDT is not null
		            then trunc(months_between(trunc(sysdate), ptp.BTDT)/ 12)
		          else null
		        end   as AGE_VL                 /* 나이(연령값)  성능이슈 펑션 제거  fn_ap_age_s(ptp.PTNO,trunc(sysdate))     */
		     ,  ptp.NTNL_CD                                                             /* 국적코드                 */
		     ,  ptp.PSPT_NO                                                             /* 여권번호                 */
		     ,  ptp.PTNT_INFW_PATH_CD                                                   /* 환자유입경로코드         */
		     ,  ptp.INCC_PTNT_YN                                                        /* 국제진료소환자여부       */
		     ,  ptp.RQPR_TLNO_CTN                                                       /* 요청자전화번호내용       */
		     ,  ptp.RQPR_NM                                                             /* 요청자명                 */
		     ,  ptp.RQST_INPR_ID                                                        /* 요청입력자ID             */
		     ,  to_char(ptp.RQST_INPT_DT, 'YYYYMMDDHH24MISS') as RQST_INPT_DT           /* 요청입력일시             */
		     ,  to_char(ptp.DETH_YMD, 'YYYYMMDD') as DETH_YMD                           /* 사망일자                 */
		     ,  ptp.DETH_YMD_RGSR_ID                                                    /* 사망일자등록자ID         */
		     ,  ptp.PRTS_RSRN                                                           /* 부모주민등록번호         */
		     ,  ptp.PRTS_NM                                                             /* 부모명                   */
		     ,  ptp.INIF_AGRM_YN                                                        /* 개인정보동의여부         */
		     ,  ptp.SNST_INFM_AGRM_YN                                                   /* 민감정보동의여부         */
		     ,  ptp.UNIQ_IDNT_INFM_AGRM_YN                                              /* 고유식별정보동의여부     */
		     ,  ptp.INIF_AGRM_RGST_SYST_NM                                              /* 개인정보동의등록시스템명 */
		     ,  ptp.INIF_AGRM_SGNT_YN                                                   /* 개인정보동의서명여부     */
		     ,  ptp.SCRY_YN                                                             /* 보안여부                 */
		     ,  ptp.INSR_QLFC_EXCL_YN                                                   /* 보험자격제외여부         */
		     ,  ptp.EMAIL_ID                                                            /* 이메일ID                 */
		     ,  ptp.EMAIL_DMAN_NM                                                       /* 이메일입력도메인명       */
		     ,  ptp.CASH_RCPT_USE_NO                                                    /* 현금영수증사용번호       */
		     ,  ptp.OVRS_RSDT_YN                                                        /* 해외거주자여부           */
		     ,  ptp.RMRK_CTN                                                            /* 비고내용                 */
		     , (select case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                    when length(PTNT_TLNO) = 10 then case
		                                                       when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                         then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                         else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                     end
		                    when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                    when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                    when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                else PTNT_TLNO
		               end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		          from APPTCNPNV ptc
		         where ptc.PTNO         = ptp.PTNO
		           and ptc.CNPN_DVSN_CD = 'BH'
		           and ptc.CNPN_SNO     = 1     )             as AFI_HOUS_TLNO          /* 집전화번호              */
		     , (select case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                    when length(PTNT_TLNO) = 10 then case
		                                                       when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                         then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                         else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                     end
		                    when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                    when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                    when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                else PTNT_TLNO
		               end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		          from APPTCNPNV ptc
		         where ptc.PTNO         = ptp.PTNO
		           and ptc.CNPN_DVSN_CD = 'BP'
		           and ptc.CNPN_SNO     = 1     )             as AFI_CLNO               /* 휴대전화번호            */
		     , (select case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                    when length(PTNT_TLNO) = 10 then case
		                                                       when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                         then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                         else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                     end
		                    when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                    when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                    when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                else PTNT_TLNO
		               end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		          from APPTCNPNV ptc
		         where ptc.PTNO         = ptp.PTNO
		           and ptc.CNPN_DVSN_CD = 'BO'
		           and ptc.CNPN_SNO     = 1     )             as AFI_OCPL_TLNO          /*  직장전화번호           */
		     , (select case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                    when length(PTNT_TLNO) = 10 then case
		                                                       when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                         then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                         else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                     end
		                    when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                    when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                    when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                else PTNT_TLNO
		               end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		          from APPTCNPNV ptc
		         where ptc.PTNO         = ptp.PTNO
		           and ptc.CNPN_DVSN_CD = 'EA'
		           and ptc.CNPN_SNO     = 1     )             as AFI_ETC_TLNO           /* 기타전화번호             */
		     ,  ada.ZPCD                                      as HOUS_ZPCD              /* 집우편번호               */
		     ,  ada.ZPAD_NM                                   as HOUS_ZPAD_NM           /* 집우편번호주소명         */
		     ,  ada.DEAD_NM                                   as HOUS_DEAD_NM           /* 집상세주소명             */
		     ,  ado.ZPCD                                      as OCPL_ZPCD              /* 직장우편번호             */
		     ,  ado.ZPAD_NM                                   as OCPL_ZPAD_NM           /* 직장우편번호주소명       */
		     ,  ado.DEAD_NM                                   as OCPL_DEAD_NM           /* 직장상세주소명           */
		     ,  pta.ABO_BLTY_CD                                                         /* ABO혈액형코드            */
		     ,  pta.RH_BLTY_CD                                                          /* RH혈액형코드             */
		     ,  pta.HGHT_VL                                                             /* 신장값                   */
		     ,  pta.BDWG_VL                                                             /* 체중값                   */
		     ,  to_char(pta.LTST_OPRT_YMD, 'YYYYMMDD')        as LTST_OPRT_YMD          /* 최근수술일자             */
		     ,  pta.LTST_OPRT_SNO                                                       /* 최근수술일련번호         */
		     ,  to_char(pta.LTST_MDCR_YMD, 'YYYYMMDD')        as LTST_MDCR_YMD          /* 최근진료일자             */
		     ,  pta.BTYP_VRIN_PCBK_NO_CTN                                               /* B형수직감염수첩번호내용  */
		     ,  pta.DNDP_PTNO                                                           /* 치과환자번호             */
		     ,  pta.DSBL_YN                                                             /* 장애여부                 */
		     ,  pta.MDPP_BDWG_VL                                                        /* 투약용체중값             */
		     ,  pta.EMR_PTNT_ENSN_NM                                                    /* EMR환자영문명            */
		     ,  pta.MNPS_YN                                                             /* 폐경여부                 */
		     ,  fn_ac_get_opca_rgst_yn(ptp.PTNO, sysdate) as OPCA_YN             /* 오픈카드여부             */
		     ,  (select  /*+ INDEX_DESC(rcr APRCRPTNT_I12) */
		                 to_char(rcr.DSCH_DT, 'YYYYMMDD')
		           from  APRCRPTNT rcr
		          where  rcr.PTNO     = ptp.PTNO
		            and  rcr.CODV_CD  = 'I'
		            and  rcr.DSCH_DT is not null
		            and  rcr.DSCH_DT != to_date('29991231','YYYYMMDD')
		            and  rcr.CNCL_DT is null
		            and  rownum = 1
		        )                                                                                            as LAST_DSCH_YMD     /* 최종퇴원일자    */
		     ,  (select FN_QD_CAUTION_COLOR_VL(ptp.PTNO) from dual)                                   as AFI_CATN_COLO_NM  /* AFI주의색명     */
		     ,  (select FN_AC_CHECK_APQLQLDLT(nvl(ptp.BSOV_AFTR_PTNO, ptp.PTNO),'','','M') from dual) as AFI_CANC_EXPT_CTN /* AFI암만료내용   */
		     ,  (select FN_AC_CHECK_APQLQLDLT(nvl(ptp.BSOV_AFTR_PTNO, ptp.PTNO),'','','N') from dual) as AFI_RARE_EXPT_CTN /* AFI희귀만료내용 */
		     ,  ptp.FRGN_IDNT_CD               /* 외국인식별코드 */
		     ,  ptp.FRGN_RGST_NO               /* 외국인등록번호 */
		     ,  ptp.SSN                        /* SSN */
		  from
		        APPTPTNTV ptp
		     ,  APPTADIFT pta   /*환자부가정보 */
		     ,  APPTADRSV ada   /*집주소*/
		     ,  APPTADRSV ado   /*직장주소*/
		 where  1=1
		   and  ptp.PTNO            = #{ptno}
		   and  pta.PTNO         (+)= ptp.PTNO
		   and  ada.PTNO         (+)= ptp.PTNO
		   and  ada.ADRS_USGE_CD (+)= 'A'
		   and  ada.ADRS_SNO     (+)= 1
		   and  ado.PTNO         (+)= ptp.PTNO
		   and  ado.ADRS_USGE_CD (+)= 'O'
		   and  ado.ADRS_SNO     (+)= 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfcScksInph-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="dvsnCd" column="DVSN_CD"/>
		<result property="infdCd" column="INFD_CD"/>
		<result property="infdCdNm" column="INFD_CD_NM"/>
		<result property="inftMentCtn" column="INFT_MENT_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfcScksInph (환자별 감염병 안내문구) 
        Description :                                           환자별 감염병 안내문구
                                            
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfcScksInph-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfcScksInph"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfcScksInph-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfcScksInph */
		        'C'  DVSN_CD
		     ,  c.infd_cd
		     ,  c.infd_cd_nm
		     ,  c.ALRM_TRGT_CTN  INFT_MENT_CTN
		  from  QDSINFMDT m
		     ,  QDAINFDCT c
		 where  1=1
		   and  m.PTNO = #{ptno}
		   and  (m.INFD_CD = #{infdCd} or #{infdCd} is null)
		   and  m.CUTN_RELE_YMD = to_date('29991231','yyyymmdd')
		   and  m.INFD_CD = c.INFD_CD
		   and  c.CUTN_INFD_YN = 'Y' /* 코션감염병만 */
		   and  c.ALRM_TRGT_PPUP_YN = 'Y'
		   and  trim(c.ALRM_TRGT_CTN) is not null
		   and  (#{evntTypCd} = 'C' or #{evntTypCd} is null)
		 union
		   all
		select  distinct
		        'I'  DVSN_CD
		     ,  exho.INFD_CD
		     ,  c.INFD_CD_NM
		     ,  decode(gt.EXSR_GRP_LAST_MNGN_RSLT_CD , '01' , c.STHS_ISLT_CTN, '02' , c.STHS_ACTNS_SRVL_CTN)  INFT_MENT_CTN
		  from  QDSEXSRMT exsr
		     ,  QDSEXHOMT exho
		     ,  QDAINFDCT c
		     ,  APRCRPTNT rcr
		     ,  QDSEXSRGT gt
		 where  1=1
		   and  exsr.EXOPR_ID = exho.EXOPR_ID
		   and  exho.EXOPR_ID = gt.EXOPR_ID
		   and  exsr.EXSR_GRP_ID = gt.EXSR_GRP_ID
		   and  exho.INFD_CD = c.INFD_CD
		   and  exsr.ptno = #{ptno}
		   and  (exho.INFD_CD = #{infdCd} or #{infdCd} is null)
		<![CDATA[
		   and  exsr.SRVL_STRT_YMD <= trunc(sysdate)
		   and  exsr.SRVL_FNSH_YMD >= trunc(sysdate)
		   and  rcr.PTNO = exsr.PTNO
		   and  rcr.CNCL_DT is null
		   and  (rcr.CODV_CD = 'I' and  rcr.MDCR_YMD <= trunc(sysdate)
		                           and  (rcr.DSCH_DT = to_date('299912310000','yyyymmddhh24mi') or trunc(sysdate) <= rcr.DSCH_DT)
		        )
		   and  exsr.RPRT_YN = 'Y'
		   and  exsr.EXSR_RPTN_YN = 'Y'
		   and  nvl(exsr.MNGM_EXCL_YN,'N') <> 'Y'
		   and  nvl(exsr.PRSG_FINS_YN,'N') <> 'Y'
		   and  c.CUTN_INFD_YN = 'Y' /* 코션감염병만 */
		   and  c.SRVL_TRGT_PPUP_YN = 'Y'
		   and  gt.EXSR_GRP_LAST_MNGN_RSLT_CD in ('01','02')  /* 격리나 능동감시만   */
		   and  ((gt.EXSR_GRP_LAST_MNGN_RSLT_CD = '01' and nvl(c.STHS_ISLT_CTN      ,'*') <> '*') or
		         (gt.EXSR_GRP_LAST_MNGN_RSLT_CD = '02' and nvl(c.STHS_ACTNS_SRVL_CTN,'*') <> '*'))
		   and  (#{evntTypCd} = 'I' or #{evntTypCd} is null)
		]]>
		 union
		   all
		select  distinct
		        'O'  DVSN_CD
		     ,  exho.INFD_CD
		     ,  c.INFD_CD_NM
		     ,  decode(gt.EXSR_GRP_LAST_MNGN_RSLT_CD , '01' , c.DSCH_ISLT_CTN, '02' , c.DSCH_ACTNS_SRVL_CTN)  INFT_MENT_CTN
		  from  QDSEXSRMT exsr
		     ,  QDSEXHOMT exho
		     ,  QDAINFDCT c
		     ,  QDSEXSRGT gt
		 where  1=1
		   and  exsr.EXOPR_ID = exho.EXOPR_ID
		   and  exho.EXOPR_ID = gt.EXOPR_ID
		   and  EXSR.EXSR_GRP_ID = gt.EXSR_GRP_ID
		   and  exho.INFD_CD = c.INFD_CD
		   and  exsr.PTNO = #{ptno}
		   and  (exho.INFD_CD = #{infdCd} or #{infdCd} is null)
		<![CDATA[
		   and  exsr.SRVL_STRT_YMD <= trunc(sysdate)
		   and  exsr.SRVL_FNSH_YMD >= trunc(sysdate)
		   and  exsr.RPRT_YN = 'Y'
		   and  exsr.EXSR_RPTN_YN = 'Y'
		   and  nvl(exsr.MNGM_EXCL_YN,'N') <> 'Y'
		   and  nvl(exsr.PRSG_FINS_YN,'N') <> 'Y'
		   and  c.CUTN_INFD_YN = 'Y' /* 코션감염병만 */
		   and  c.SRVL_TRGT_PPUP_YN = 'Y'
		   and  gt.EXSR_GRP_LAST_MNGN_RSLT_CD in ('01','02')  /* 격리나 능동감시만   */
		   and  ((gt.EXSR_GRP_LAST_MNGN_RSLT_CD = '01' and nvl(c.DSCH_ISLT_CTN      ,'*') <> '*') or
		         (gt.EXSR_GRP_LAST_MNGN_RSLT_CD = '02' and nvl(c.DSCH_ACTNS_SRVL_CTN,'*') <> '*'))
		   and  not exists ( select '1'
		                       from  APRCRPTNT rcr
		                      where  1=1
		                        and  rcr.PTNO = #{ptno}
		                        and  rcr.CNCL_DT is null
		                        and  (rcr.CODV_CD = 'I' and  rcr.MDCR_YMD <= trunc(sysdate)
		                                                and  (rcr.DSCH_DT = to_date('299912310000','yyyymmddhh24mi') or trunc(sysdate) <= rcr.DSCH_DT)
		                             )
		                   )
		   and  (#{evntTypCd} = 'O' or #{evntTypCd} is null)
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfo0001-result" type="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="bsovAftrPtno" column="BSOV_AFTR_PTNO"/>
		<result property="btdt" column="BTDT"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="afiClno" column="AFI_CLNO"/>
		<result property="housZpadNm" column="HOUS_ZPAD_NM"/>
		<result property="addSexAge" column="ADD_SEX_AGE"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfo0001 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO
		resultMap : com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfo0001-result
    -->
	<select id="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfo0001"  parameterType="com.sds.healthcare.ehr.med.mz.mzz.vo.MzzPtntInfoDVO"  resultMap="com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfo0001-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-mz-mzz-dao-MzzPtntInfoDAO-listPtntInfo0001 */
		select /*+ FULL(ptp) */ 
		        ptp.PTNO                                       PTNO                     /* 환자번호(합본된 환자번호 있으면 합본번호) */
		     ,  ptp.PTNT_NM                                                             /* 환자명                   */
		     ,  ptp.BSOV_AFTR_PTNO                                                      /* 합본이후환자번호         */
		     ,  to_char(ptp.BTDT, 'YYYYMMDD')                  BTDT                     /* 생년월일                 */
		     ,  ptp.GEND_CD                                                             /* 성별코드                 */
		     ,  ( select  case when length(PTNT_TLNO) = 11 then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)||'-'||substr(PTNT_TLNO, 8, 4)
		                       when length(PTNT_TLNO) = 10 then case
		                                                          when SUBSTR( PTNT_TLNO, 1, 2) = '02'
		                                                            then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 4)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                            else substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 3)||'-'||substr(PTNT_TLNO, 7, 4)
		                                                        end
		                       when length(PTNT_TLNO) = 9  then substr(PTNT_TLNO, 1, 2)||'-'||substr(PTNT_TLNO, 3, 3)||'-'||substr(PTNT_TLNO, 6, 4)
		                       when length(PTNT_TLNO) = 8  then substr(PTNT_TLNO, 1, 4)||'-'||substr(PTNT_TLNO, 4, 4)
		                       when length(PTNT_TLNO) = 7  then substr(PTNT_TLNO, 1, 3)||'-'||substr(PTNT_TLNO, 4, 4)
		                                                   else PTNT_TLNO
		                  end as F_PTNT_TLNO    /* 성능이슈 펑션 제거 fn_ap_wrap_telno */
		            from  APPTCNPNV ptc
		           where  ptc.PTNO         = ptp.PTNO
		             and  ptc.CNPN_DVSN_CD = 'BP'
		             and  ptc.CNPN_SNO     = 1        )        as AFI_CLNO              /* 휴대전화번호      */
		     ,  ( select  ada.ZPAD_NM
		            from  APPTADRSV ada
		           where  ada.PTNO         = ptp.PTNO
		             and  ada.ADRS_USGE_CD = 'A'
		             and  ada.ADRS_SNO     = 1        )        as HOUS_ZPAD_NM          /* 집우편번호주소명  */
		     ,  cast('' as VARCHAR(100)) as ADD_SEX_AGE     /* 성별/나이 추가 컬럼(화면사용) */
		  from
		        APPTPTNTT ptp
		 where  1 = 1
		   and  NVL(#{inqrDvsnCd}, 'X') = NVL(#{inqrDvsnCd}, 'X')
		 <if test='ptno != null and ptno != ""'>
		   and  ptp.PTNO      =   #{ptno}
		 </if>
		 <if test='ptntNm != null and ptntNm != ""'>
		   <choose>
		     <when test='inqrWayCd == "LIKE"'>
		        and  ptp.PTNT_NM  like #{ptntNm} || '%'
		     </when>
		     <otherwise>
		        and  ptp.PTNT_NM   =   #{ptntNm}
		     </otherwise>
		   </choose>
		 </if>
		 <if test='frrn != null and frrn != ""'>
		   and  ptp.frrn  like   #{frrn} || '%'
		 </if>
		 <if test='brrn != null and brrn != ""'>
		   and  ptp.BRRN like #{brrn} || '%'
		 </if>
		   and  FN_MD_VIPAUTHYN(ptp.PTNO, #{userId}, #{userIp}) = 'Y'  /* 특정 환자번호 대상자를 조회할 수 있는지 여부를 확인한다. */
	</select>



</mapper>