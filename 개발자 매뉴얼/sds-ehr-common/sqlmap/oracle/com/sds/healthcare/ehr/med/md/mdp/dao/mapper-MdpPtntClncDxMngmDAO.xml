<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_MdpPtntClncDxMngmDAO_sql.xml 
    Description :                                      환자임상진단관리 (환자 임상진단 관련 조회, 입력, 수정, 삭제 처리)
                  -->
<mapper namespace="MdpPtntClncDxMngmDAO">




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertPtntClncDx (환자 임상진단 입력) 
        Description :                                           환자 임상진단 입력
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertPtntClncDx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertPtntClncDx */
		insert  /*+ MdpPtntClncDxMngmDAO-insertPtntClncDx_환자임상진단내역 등록 */
		  into  MDPACLNCT
		        (
		        MDRP_NO                    /*  진료접수번호 */
		     ,  PTNT_CLNC_DX_SNO           /*  환자임상진단일련번호 */
		     ,  PTNO                       /*  환자번호 */
		     ,  MCDP_CD                    /*  진료과코드 */
		     ,  CODV_CD                    /*  내원구분코드 */
		     ,  CHDR_ID                    /*  지정의사ID */
		     ,  GNDR_ID                    /*  주치의사ID */
		     ,  CLNC_DX_CD                 /*  임상진단코드 */
		     ,  CLNC_DX_NM                 /*  임상진단명 */
		     ,  CLNC_DX_MEMO_CTN           /*  임상진단메모내용 */
		     ,  MAIN_CLNC_DX_YN            /*  주임상진단여부 */
		     ,  DFNT_SCIN_YN               /*  확정상병여부 */
		     ,  PTNT_SCIN_UNSL_CTN         /*  환자상병특이내용 */
		     ,  UPLT_RWTT_VL               /*  상좌치열값 */
		     ,  UPRG_RWTT_VL               /*  상우치열값 */
		     ,  LWLF_RWTT_VL               /*  하좌치열값 */
		     ,  LWRG_RWTT_VL               /*  하우치열값 */
		     ,  DX_SITE_CD                 /*  진단부위코드 */
		     ,  ADMS_DX_YN                 /*  입원진단여부 */
		     ,  RUL_OUT_YN                 /*  RULE_Out여부 */
		     ,  ABC_MCCN_CD                /*  ABC진료센터코드 */
		     ,  SRRQ_CMNT_CTN              /*  SR커멘트내용 */
		     ,  ACUT_DISS_YN              /* 급성질환여부 */
		     ,  FRST_RGSR_ID               /*  최초등록자ID */
		     ,  FRST_RGST_IP               /*  최초등록IP */
		     ,  FRST_RGST_DT               /*  최초등록일시 */
		     ,  FRST_RGST_CLNT_PRGM_ID          /*  최초등록SMC클라이언트프로그램ID */
		     ,  FRST_RGST_SRVR_PRGM_ID          /*  최초등록SMC서버프로그램ID */
		     ,  LAST_UPDR_ID               /*  최종수정자ID */
		     ,  LAST_UPDT_IP               /*  최종수정IP */
		     ,  LAST_UPDT_DT               /*  최종수정일시 */
		     ,  LAST_UPDT_CLNT_PRGM_ID          /*  최종수정SMC클라이언트프로그램ID */
		     ,  LAST_UPDT_SRVR_PRGM_ID          /*  최종수정SMC서버프로그램ID */
		        )
		values  (
		        #{mdrpNo}
		     ,  #{ptntClncDxSno}
		     ,  #{ptno}
		     ,  #{mcdpCd}
		     ,  #{codvCd}
		     ,  #{chdrId}
		     ,  #{gndrId}
		     ,  #{clncDxCd}
		     ,  #{clncDxNm}
		     ,  #{clncDxMemoCtn}
		     ,  nvl(#{mainClncDxYn}, 'N')
		     ,  nvl(#{dfntScinYn}, 'N')
		     ,  #{ptntScinUnslCtn}
		     ,  #{upltRwttVl}
		     ,  #{uprgRwttVl}
		     ,  #{lwlfRwttVl}
		     ,  #{lwrgRwttVl}
		     ,  #{dxSiteCd}
		     ,  nvl(#{admsDxYn}, 'N')
		     ,  nvl(#{rulOutYn}, 'N')
		     ,  #{abcMccnCd}
		     ,  #{srrqCmntCtn}
		     ,  #{acutDissYn}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		        )
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertPtntScin (환자 상병 입력) 
        Description :                                           환자 상병 입력
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertPtntScin"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertPtntScin */
		insert  /*+ MdpPtntClncDxMngmDAO-insertPtntScin_환자상병 등록 */
		  into  MDPADIAGT
		        (
		        MDRP_NO                         /* 진료접수번호 */
		     ,  PTNT_CLNC_DX_SNO                /* 환자임상진단일련번호 */
		     ,  PTNT_SCIN_SNO                   /* 환자상병일련번호 */
		     ,  PTNO                            /* 환자번호 */
		     ,  MCDP_CD                         /* 진료과코드 */
		     ,  SCIN_CD                         /* 상병코드 */
		     ,  CODV_CD                         /* 내원구분코드 */
		     ,  CHDR_ID                         /* 지정의사ID */
		     ,  GNDR_ID                         /* 주치의사ID */
		     ,  SCIN_NM                         /* 상병명 */
		     ,  MAIN_SCIN_YN                    /* 주상병여부 */
		     ,  CMDS_YN                         /* 전염병여부 */
		     ,  BRIN_SFTB_RANG_CTN              /* 화상체표범위내용 */
		     ,  STHS_SCIN_DVSN_CD               /* 재원상병구분코드 */
		     ,  PTAD_IPDV_CD                    /* 원무급여구분코드 */
		     ,  FRST_RGSR_ID                    /* 최초등록자ID */
		     ,  FRST_RGST_IP                    /* 최초등록IP */
		     ,  FRST_RGST_DT                    /* 최초등록일시 */
		     ,  FRST_RGST_CLNT_PRGM_ID          /* 최초등록SMC클라이언트프로그램ID */
		     ,  FRST_RGST_SRVR_PRGM_ID          /* 최초등록SMC서버프로그램ID */
		     ,  LAST_UPDR_ID                    /* 최종수정자ID */
		     ,  LAST_UPDT_IP                    /* 최종수정IP */
		     ,  LAST_UPDT_DT                    /* 최종수정일시 */
		     ,  LAST_UPDT_CLNT_PRGM_ID          /* 최종수정SMC클라이언트프로그램ID */
		     ,  LAST_UPDT_SRVR_PRGM_ID          /* 최종수정SMC서버프로그램ID */
			 ,  PTNT_SCIN_RGST_YMD				/* 환자상병등록일자 */
		        )
		values  (
		        #{mdrpNo}
		     ,  #{ptntClncDxSno}
		     ,  #{ptntScinSno}
		     ,  #{ptno}
		     ,  #{mcdpCd}
		     ,  #{scinCd}
		     ,  #{codvCd}
		     ,  #{chdrId}
		     ,  #{gndrId}
		     ,  #{scinNm}
		     ,  #{mainScinYn}
		     ,  #{cmdsYn}
		     ,  #{brinSftbRangCtn}
		     ,  #{sthsScinDvsnCd}
		     ,  #{ptadIpdvCd}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
			 ,  trunc(sysdate)
		        )
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertPtntScinHx (환자상병이력정보 저장) 
        Description :                                           환자상병이력정보 저장
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertPtntScinHx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		insert /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertPtntScinHx */
		       into MDPADIAHT
		select 
		       a.MDRP_NO                     as MDRP_NO                     /* 진료접수번호   */
		     , a.PTNT_CLNC_DX_SNO            as PTNT_CLNC_DX_SNO            /* 환자임상진단일련번호   */
		     , a.PTNT_SCIN_SNO               as PTNT_SCIN_SNO               /* 환자상병일련번호   */
		     , (select nvl(max(s1.MDFC_HX_SNO), 0) + 1 from MDPADIAHT s1 where s1.MDRP_NO = a.MDRP_NO) as MDFC_HX_SNO  /* 변경이력일련번호 */
		     ,  sysdate
		     ,  to_date('29991231', 'yyyymmdd') /* 적용종료일시 */     
		     , a.PTNO                        as PTNO                        /* 환자번호   */
		     , a.MCDP_CD                     as MCDP_CD                     /* 진료과코드   */
		     , a.SCIN_CD                     as SCIN_CD                     /* 상병코드   */
		     , a.CODV_CD                     as CODV_CD                     /* 내원구분코드   */
		     , a.CHDR_ID                     as CHDR_ID                     /* 지정의사ID   */
		     , a.GNDR_ID                     as GNDR_ID                     /* 주치의사ID   */
		     , a.SCIN_NM                     as SCIN_NM                     /* 상병명   */
		     , a.MAIN_SCIN_YN                as MAIN_SCIN_YN                /* 주상병여부   */
		     , a.CMDS_YN                     as CMDS_YN                     /* 전염병여부   */
		     , a.BRIN_SFTB_RANG_CTN          as BRIN_SFTB_RANG_CTN          /* 화상체표범위내용   */
		     , a.STHS_SCIN_DVSN_CD           as STHS_SCIN_DVSN_CD           /* 재원상병구분코드   */
		     , a.PTAD_IPDV_CD                as PTAD_IPDV_CD                /* 원무급여구분코드   */
		     , a.FRST_RGSR_ID                as FRST_RGSR_ID                
		     , a.FRST_RGST_IP                as FRST_RGST_IP                
		     , a.FRST_RGST_DT               as FRST_RGST_DT                
		     , a.FRST_RGST_CLNT_PRGM_ID      as FRST_RGST_CLNT_PRGM_ID      
		     , a.FRST_RGST_SRVR_PRGM_ID      as FRST_RGST_SRVR_PRGM_ID      
		     , a.LAST_UPDR_ID                as LAST_UPDR_ID                
		     , a.LAST_UPDT_IP                as LAST_UPDT_IP                
		     , a.LAST_UPDT_DT               as LAST_UPDT_DT                
		     , a.LAST_UPDT_CLNT_PRGM_ID      as LAST_UPDT_CLNT_PRGM_ID      
		     , a.LAST_UPDT_SRVR_PRGM_ID      as LAST_UPDT_SRVR_PRGM_ID      
		  from MDPADIAGT a  /* 환자상병내역 */
		 where a.MDRP_NO = #{mdrpNo}
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertTmprPtntClncDx ((임시)환자임상진단 저장) 
        Description :                                           (임시)환자임상진단 저장
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertTmprPtntClncDx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-insertTmprPtntClncDx */
		<![CDATA[
		insert  /*+ MdpPtntClncDxMngmDAO-insertTmprPtntClncDx_환자임상진단내역임시 등록 */
		  into  MDPACLNTT
		        (
		        MDRP_NO                    /*  진료접수번호 */
		     ,  PTNT_CLNC_DX_SNO           /*  환자임상진단일련번호 */
		     ,  PTNO                       /*  환자번호 */
		     ,  MCDP_CD                    /*  진료과코드 */
		     ,  CODV_CD                    /*  내원구분코드 */
		     ,  CHDR_ID                    /*  지정의사ID */
		     ,  GNDR_ID                    /*  주치의사ID */
		     ,  CLNC_DX_CD                 /*  임상진단코드 */
		     ,  CLNC_DX_NM                 /*  임상진단명 */
		     ,  CLNC_DX_MEMO_CTN           /*  임상진단메모내용 */
		     ,  MAIN_CLNC_DX_YN            /*  주임상진단여부 */
		     ,  DFNT_SCIN_YN               /*  확정상병여부 */
		     ,  PTNT_SCIN_UNSL_CTN         /*  환자상병특이내용 */
		     ,  UPLT_RWTT_VL               /*  상좌치열값 */
		     ,  UPRG_RWTT_VL               /*  상우치열값 */
		     ,  LWLF_RWTT_VL               /*  하좌치열값 */
		     ,  LWRG_RWTT_VL               /*  하우치열값 */
		     ,  DX_SITE_CD                 /*  진단부위코드 */
		     ,  ADMS_DX_YN                 /*  입원진단여부 */
		     ,  RUL_OUT_YN                 /*  RULE_Out여부 */
		     ,  ABC_MCCN_CD                /*  ABC진료센터코드 */
		     ,  SRRQ_CMNT_CTN              /*  SR커멘트내용 */
		     ,  FRST_RGSR_ID               /*  최초등록자ID */
		     ,  FRST_RGST_IP               /*  최초등록IP */
		     ,  FRST_RGST_DT               /*  최초등록일시 */
		     ,  FRST_RGST_CLNT_PRGM_ID          /*  최초등록SMC클라이언트프로그램ID */
		     ,  FRST_RGST_SRVR_PRGM_ID          /*  최초등록SMC서버프로그램ID */
		     ,  LAST_UPDR_ID               /*  최종수정자ID */
		     ,  LAST_UPDT_IP               /*  최종수정IP */
		     ,  LAST_UPDT_DT               /*  최종수정일시 */
		     ,  LAST_UPDT_CLNT_PRGM_ID          /*  최종수정SMC클라이언트프로그램ID */
		     ,  LAST_UPDT_SRVR_PRGM_ID          /*  최종수정SMC서버프로그램ID */
		        )
		values  (
		        #{mdrpNo}
		     ,  (   select  nvl(max(PTNT_CLNC_DX_SNO),0) + 1
		              from  MDPACLNTT
		             where  MDRP_NO = #{mdrpNo}
		        )
		     ,  #{ptno}
		     ,  #{mcdpCd}
		     ,  #{codvCd}
		     ,  #{chdrId}
		     ,  #{gndrId}
		     ,  #{clncDxCd}
		     ,  #{clncDxNm}
		     ,  #{clncDxMemoCtn}
		     ,  nvl(#{mainClncDxYn}, 'N')
		     ,  nvl(#{dfntScinYn}, 'N')
		     ,  #{ptntScinUnslCtn}
		     ,  #{upltRwttVl}
		     ,  #{uprgRwttVl}
		     ,  #{lwlfRwttVl}
		     ,  #{lwrgRwttVl}
		     ,  #{dxSiteCd}
		     ,  nvl(#{admsDxYn}, 'N')
		     ,  nvl(#{rulOutYn}, 'N')
		     ,  #{abcMccnCd}
		     ,  #{srrqCmntCtn}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		        )
		]]>
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updatePtntClncDx (환자 임상진단 수정) 
        Description :                                           환자 임상진단 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updatePtntClncDx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updatePtntClncDx */
		update  /*+ MdpPtntClncDxMngmDAO-updatePtntClncDx_환자임상진단내역 수정 */
		        MDPACLNCT
		   set  CLNC_DX_CD              =   #{clncDxCd}                 /* 임상진단코드 */
		     ,  CLNC_DX_NM              =   #{clncDxNm}                 /* 임상진단명 */
		     ,  CLNC_DX_MEMO_CTN        =   #{clncDxMemoCtn}            /* 임상진단메모내용 */
		     ,  MAIN_CLNC_DX_YN         =   #{mainClncDxYn}             /* 주임상진단여부 */
		     ,  DFNT_SCIN_YN            =   #{dfntScinYn}               /* 확정상병여부 */
		     ,  PTNT_SCIN_UNSL_CTN      =   #{ptntScinUnslCtn}          /* 환자상병특이내용 */
		     ,  UPLT_RWTT_VL            =   #{upltRwttVl}               /* 상좌치열값 */
		     ,  UPRG_RWTT_VL            =   #{uprgRwttVl}               /* 상우치열값 */
		     ,  LWLF_RWTT_VL            =   #{lwlfRwttVl}               /* 하좌치열값 */
		     ,  LWRG_RWTT_VL            =   #{lwrgRwttVl}               /* 하우치열값 */
		     ,  DX_SITE_CD              =   #{dxSiteCd}                 /* 진단부위코드 */
		     ,  ADMS_DX_YN              =   #{admsDxYn}                 /* 입원진단여부 */
		     ,  RUL_OUT_YN              =   #{rulOutYn}                 /* RULE_Out여부 */
		     ,  ACUT_DISS_YN           = #{acutDissYn}                /* 급성질환여부 */
		     ,  ABC_MCCN_CD             =   #{abcMccnCd}                /* ABC진료센터코드 */
		     ,  LAST_UPDR_ID            =   #{gvUserId}                 /* 최종수정자ID */
		     ,  LAST_UPDT_IP            =   #{gvUserIp}                 /* 최종수정IP */
		     ,  LAST_UPDT_DT            =   sysdate                     /* 최종수정일시 */
		     ,  LAST_UPDT_CLNT_PRGM_ID  =   #{gvClntPrgmId}             /* 최종수정SMC클라이언트프로그램ID */
		     ,  LAST_UPDT_SRVR_PRGM_ID  =   #{gvSrvrPrgmId}             /* 최종수정SMC서버프로그램ID */
		 where  MDRP_NO                 =   #{mdrpNo}                   /* 진료접수번호 */
		   and  PTNT_CLNC_DX_SNO        =   #{ptntClncDxSno}            /* 환자임상진단일련번호 */
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updatePtntScin (환자상병정보 수정) 
        Description :                                           환자상병정보 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updatePtntScin"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updatePtntScin */
		update  /*+ MdpPtntClncDxMngmDAO-updatePtntScin_환자상병내역 수정 */
		        MDPADIAGT
		 <trim prefix='set' prefixOverrides=','>
		   <if test='scinCd != null and scinCd != ""'>
		     ,  SCIN_CD                 =   #{scinCd}                                       /* 상병코드 */
		   </if>
		   <if test='scinNm != null and scinNm != ""'>
		     ,  SCIN_NM                 =   nvl(#{scinNm}, SCIN_NM)                         /* 상병명 */
		   </if>
		   <if test='mainScinYn != null and mainScinYn != ""'>
		     ,  MAIN_SCIN_YN            =   #{mainScinYn}                                   /* 주상병여부 */
		   </if>
		   <if test='sthsScinDvsnCd != null'>
		     ,  STHS_SCIN_DVSN_CD       =   #{sthsScinDvsnCd}
		   </if>
		   <if test='cmdsYn != null'>
		     ,  CMDS_YN                 =   nvl(#{cmdsYn}, CMDS_YN)                         /* 전염병여부 */
		   </if>
		   <if test='brinSftbRangCtn != null'>
		     ,  BRIN_SFTB_RANG_CTN      =   nvl(#{brinSftbRangCtn}, BRIN_SFTB_RANG_CTN)     /* 화상체표범위내용 */
		   </if>
		   <if test='ptadIpdvCd != null'>
		     ,  PTAD_IPDV_CD            =   nvl(#{ptadIpdvCd}, PTAD_IPDV_CD)                /* 원무급여구분코드 */
		   </if>
		     ,  LAST_UPDR_ID            =   #{gvUserId}
		     ,  LAST_UPDT_IP            =   #{gvUserIp}
		     ,  LAST_UPDT_DT            =   sysdate
		     ,  LAST_UPDT_CLNT_PRGM_ID  =   #{gvClntPrgmId}
		     ,  LAST_UPDT_SRVR_PRGM_ID  =   #{gvSrvrPrgmId}
		 </trim>
		 where  MDRP_NO                 =   #{mdrpNo}
		   and  PTNT_CLNC_DX_SNO        =   #{ptntClncDxSno}
		   and  PTNT_SCIN_SNO           =   #{ptntScinSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updatePtntScinHx (환자상병 이력정보 수정) 
        Description :                                           환자상병 이력정보 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updatePtntScinHx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		update /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updatePtntScinHx */
		      MDPADIAHT set
		    APFN_DT = sysdate
		 where MDRP_NO = #{mdrpNo}
		   and APFN_DT = to_date('29991231', 'yyyymmdd') 
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updateTmprPtntClncDx ((임시)환자임상진단 수정) 
        Description :                                           (임시)환자임상진단 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updateTmprPtntClncDx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updateTmprPtntClncDx */
		<![CDATA[
		update  /*+ MdpPtntClncDxMngmDAO-updateTmprPtntClncDx_환자임상진단내역임시 수정 */
		        MDPACLNTT
		   set  MCDP_CD                 =   #{mcdpCd}               /* 진료과코드 */
		     ,  CODV_CD                 =   #{codvCd}               /* 내원구분코드 */
		     ,  CHDR_ID                 =   #{chdrId}               /* 지정의사ID */
		     ,  GNDR_ID                 =   #{gndrId}               /* 주치의사ID */
		     ,  CLNC_DX_CD              =   #{clncDxCd}             /* 임상진단코드 */
		     ,  CLNC_DX_NM              =   #{clncDxNm}             /* 임상진단명 */
		     ,  CLNC_DX_MEMO_CTN        =   #{clncDxMemoCtn}        /* 임상진단메모내용 */
		     ,  MAIN_CLNC_DX_YN         =   #{mainClncDxYn}         /* 주임상진단여부 */
		     ,  DFNT_SCIN_YN            =   #{dfntScinYn}           /* 확정상병여부 */
		     ,  PTNT_SCIN_UNSL_CTN      =   #{ptntScinUnslCtn}      /* 환자상병특이내용 */
		     ,  UPLT_RWTT_VL            =   #{upltRwttVl}           /* 상좌치열값 */
		     ,  UPRG_RWTT_VL            =   #{uprgRwttVl}           /* 상우치열값 */
		     ,  LWLF_RWTT_VL            =   #{lwlfRwttVl}           /* 하좌치열값 */
		     ,  LWRG_RWTT_VL            =   #{lwrgRwttVl}           /* 하우치열값 */
		     ,  DX_SITE_CD              =   #{dxSiteCd}             /* 진단부위코드 */
		     ,  ADMS_DX_YN              =   #{admsDxYn}             /* 입원진단여부 */
		     ,  RUL_OUT_YN              =   #{rulOutYn}             /* RULE_Out여부 */
		     ,  ABC_MCCN_CD             =   #{abcMccnCd}            /* ABC진료센터코드 */
		     ,  LAST_UPDR_ID            =   #{gvUserId}
		     ,  LAST_UPDT_IP            =   #{gvUserIp}
		     ,  LAST_UPDT_DT            =   sysdate
		     ,  LAST_UPDT_CLNT_PRGM_ID  =   #{gvClntPrgmId}
		     ,  LAST_UPDT_SRVR_PRGM_ID  =   #{gvSrvrPrgmId}
		 where  MDRP_NO                 =   #{mdrpNo}               /* 진료접수번호 */
		   and  PTNT_CLNC_DX_SNO        =   #{ptntClncDxSno}        /* 환자임상진단일련번호 */
		]]>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-deletePtntClncDx (환자 임상진단 삭제) 
        Description :                                           환자 임상진단 삭제
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<delete id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-deletePtntClncDx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-deletePtntClncDx */
		delete  /*+ MdpPtntClncDxMngmDAO-deletePtntClncDx_환자임상진단내역 삭제 */
		        MDPACLNCT
		 where  MDRP_NO             =   #{mdrpNo}               /* 진료접수번호 */
		 <if test="ptntClncDxSno != null">
		   and  PTNT_CLNC_DX_SNO    =   #{ptntClncDxSno}        /* 환자임상진단일련번호 */
		 </if>
	</delete>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-deletePtntScin (환자 상병 삭제) 
        Description :                                           환자 상병 삭제
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<delete id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-deletePtntScin"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-deletePtntScin */
		delete  /*+ MdpPtntClncDxMngmDAO-deletePtntScin_환자상병내역 삭제 */
		        MDPADIAGT
		 where  MDRP_NO             =   #{mdrpNo}           /* 진료접수번호 */
		 <if test="ptntClncDxSno != null">
		   and  PTNT_CLNC_DX_SNO    =   #{ptntClncDxSno}    /* 환자임상진단일련번호 */
		 </if>
	</delete>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-deleteTmprPtntClncDx ((임시)환자임상진단 삭제) 
        Description :                                           (임시)환자임상진단 삭제
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<delete id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-deleteTmprPtntClncDx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-deleteTmprPtntClncDx */
		delete  /*+ MdpPtntClncDxMngmDAO-deleteTmprPtntClncDx_환자임상진단내역임시 삭제 */
		        MDPACLNTT
		 where  MDRP_NO             =   #{mdrpNo}               /* 진료접수번호 */
		 <if test="ptntClncDxSno != null and ptntClncDxSno &gt; 0">
		   and  PTNT_CLNC_DX_SNO    =   #{ptntClncDxSno}        /* 환자임상진단일련번호 */
		 </if>
	</delete>


	<resultMap id="com-sds-healistIfmnDetlCtrlVllthcare-ehr-med-md-mdp-dao-MdpPtntClistIfmnDetlCtrlVllncDxMngmDAO-listIfmnDetlCtrlVll-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ifmnDetlCtrlVl" column="IFMN_DETL_CTRL_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healistIfmnDetlCtrlVllthcare-ehr-med-md-mdp-dao-MdpPtntClistIfmnDetlCtrlVllncDxMngmDAO-listIfmnDetlCtrlVll () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healistIfmnDetlCtrlVllthcare-ehr-med-md-mdp-dao-MdpPtntClistIfmnDetlCtrlVllncDxMngmDAO-listIfmnDetlCtrlVll-result
    -->
	<select id="com-sds-healistIfmnDetlCtrlVllthcare-ehr-med-md-mdp-dao-MdpPtntClistIfmnDetlCtrlVllncDxMngmDAO-listIfmnDetlCtrlVll"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healistIfmnDetlCtrlVllthcare-ehr-med-md-mdp-dao-MdpPtntClistIfmnDetlCtrlVllncDxMngmDAO-listIfmnDetlCtrlVll-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healistIfmnDetlCtrlVllthcare-ehr-med-md-mdp-dao-MdpPtntClistIfmnDetlCtrlVllncDxMngmDAO-listIfmnDetlCtrlVll */
		select 	b.ptno,
				 	c.IFMN_DETL_CTRL_VL	
		from	
			   	MDPACLNCT a
			  ,	MDPADIAGT b
			  ,	QDCTRLMMT c
		where	a.MDRP_NO			=	#{mdrpNo}
		and		b.MDRP_NO			=	a.MDRP_NO
		and		b.PTNT_CLNC_DX_SNO	=	a.PTNT_CLNC_DX_SNO		
		and		b.SCIN_CD			=	c.IFMN_DETL_CTRL_VL
		and		c.IFMN_CTRL_CD		=	'FOOD_SCIN_CD' 
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="mdcrDt" column="MDCR_DT"/>
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="abrvMcdpCd" column="ABRV_MCDP_CD"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="ptntClncDxSno" column="PTNT_CLNC_DX_SNO"/>
		<result property="ptntScinSno" column="PTNT_SCIN_SNO"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="codvNm" column="CODV_NM"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="gndrId" column="GNDR_ID"/>
		<result property="gndrNm" column="GNDR_NM"/>
		<result property="trmnId" column="TRMN_ID"/>
		<result property="clncDxCd" column="CLNC_DX_CD"/>
		<result property="clncDxNm" column="CLNC_DX_NM"/>
		<result property="clncDxMemoCtn" column="CLNC_DX_MEMO_CTN"/>
		<result property="ptntScinUnslCtn" column="PTNT_SCIN_UNSL_CTN"/>
		<result property="dxSiteCd" column="DX_SITE_CD"/>
		<result property="mainClncDxYn" column="MAIN_CLNC_DX_YN"/>
		<result property="dfntScinYn" column="DFNT_SCIN_YN"/>
		<result property="upltRwttVl" column="UPLT_RWTT_VL"/>
		<result property="uprgRwttVl" column="UPRG_RWTT_VL"/>
		<result property="lwlfRwttVl" column="LWLF_RWTT_VL"/>
		<result property="lwrgRwttVl" column="LWRG_RWTT_VL"/>
		<result property="admsDxYn" column="ADMS_DX_YN"/>
		<result property="rulOutYn" column="RUL_OUT_YN"/>
		<result property="scinCd" column="SCIN_CD"/>
		<result property="scinNm" column="SCIN_NM"/>
		<result property="mainScinYn" column="MAIN_SCIN_YN"/>
		<result property="cmdsYn" column="CMDS_YN"/>
		<result property="rgstYmd" column="RGST_YMD"/>
		<result property="sthsScinDvsnCd" column="STHS_SCIN_DVSN_CD"/>
		<result property="abcMccnCd" column="ABC_MCCN_CD"/>
		<result property="abcMccnNm" column="ABC_MCCN_NM"/>
		<result property="ptadIpdvCd" column="PTAD_IPDV_CD"/>
		<result property="sdpfExcpCd" column="SDPF_EXCP_CD"/>
		<result property="scinEnsnNm" column="SCIN_ENSN_NM"/>
		<result property="scinKornNm" column="SCIN_KORN_NM"/>
		<result property="ascsCd" column="ASCS_CD"/>
		<result property="acutCrbrDissYn" column="ACUT_CRBR_DISS_YN"/>
		<result property="acutDissYn" column="ACUT_DISS_YN"/>
		<result property="slilScinYn" column="SLIL_SCIN_YN"/>
		<result property="rcmnScinYn" column="RCMN_SCIN_YN"/>
		<result property="mainScinDslwYn" column="MAIN_SCIN_DSLW_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain (환자 임상진단 조회 (메인)) 
        Description :                                           환자 임상진단을 조회한다. (상병등록, 진료툴바 등 사용)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain */
		<![CDATA[
		select  /*+ MdpPtntClncDxMngmDAO-listPtntClncDxMain_환자상병내역 조회 */
		        a.PTNO                                      as PTNO                 /* 환자번호 */
		     ,  a.MDRP_NO                                   as MDRP_NO              /* 진료접수번호 */
		     ,  to_char(c.MDCR_DT, 'yyyymmddhh24miss')      as MDCR_DT              /* 진료일시 */
		     ,  to_char(c.MDCR_YMD, 'yyyymmdd')             as MDCR_YMD             /* 진료일시 */
		     ,  a.MCDP_CD                                   as MCDP_CD              /* 진료과코드 */
		     ,  (   select  ABRV_DPRT_CD
		              from  HZDEPTMMT
		             where  DPRT_CD = a.MCDP_CD
		        )                                           as ABRV_MCDP_CD         /* 약어진료과코드 */
		     ,  (   select  KORN_DPRT_NM
		              from  HZDEPTMMT
		             where  DPRT_CD = a.MCDP_CD
		        )                                           as MCDP_NM              /* 진료과명*/
		     ,  a.PTNT_CLNC_DX_SNO                          as PTNT_CLNC_DX_SNO     /* 환자임상진단일련번호 */
		     ,  b.PTNT_SCIN_SNO                             as PTNT_SCIN_SNO        /* 환자상병일련번호 */
		     ,  a.CODV_CD                                   as CODV_CD              /* 내원구분 */
		     ,  (   select  DETL_CD_NM
		              from  CCCMCDDMT
		             where  COMN_GRP_CD  = 'MM262'
		               and  COMN_DTLS_CD = a.CODV_CD
		        )                                           as CODV_NM              /* 내원구분명 */
		     ,  a.CHDR_ID                                   as CHDR_ID              /* 지정의사ID */
		     ,  (   select  USER_NM 
		              from  CCUSRDPHT 
		             where  USER_ID = a.CHDR_ID
		        )                                           as CHDR_NM              /* 지정의사명 */
		     ,  a.GNDR_ID                                   as GNDR_ID              /* 주치의사ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID = a.GNDR_ID
		        )                                           as GNDR_NM              /* 주치의사명 */
		     ,  a.CLNC_DX_CD                                as TRMN_ID              /* 용어ID */
		     ,  a.CLNC_DX_CD                                as CLNC_DX_CD           /* 임상진단코드 */
		     ,  decode(nvl(a.ACUT_DISS_YN, 'N'), 'Y', '(급성)', '') || a.CLNC_DX_NM                                as CLNC_DX_NM           /* 임상진단명 */
		     ,  a.CLNC_DX_MEMO_CTN                          as CLNC_DX_MEMO_CTN     /* 임상진단메모내용 */
		     ,  a.PTNT_SCIN_UNSL_CTN                        as PTNT_SCIN_UNSL_CTN   /* 환자상병특이내용 */
		     ,  a.DX_SITE_CD                                as DX_SITE_CD           /* 진단부위 */
		     ,  a.MAIN_CLNC_DX_YN                           as MAIN_CLNC_DX_YN      /* 주임상진단여부 */
		     ,  a.DFNT_SCIN_YN                              as DFNT_SCIN_YN         /* 확정상병여부 */
		     ,  a.UPLT_RWTT_VL                              as UPLT_RWTT_VL         /* 상좌치열값 */
		     ,  a.UPRG_RWTT_VL                              as UPRG_RWTT_VL         /* 상우치열값 */
		     ,  a.LWLF_RWTT_VL                              as LWLF_RWTT_VL         /* 하좌치열값 */
		     ,  a.LWRG_RWTT_VL                              as LWRG_RWTT_VL         /* 하우치열값 */
		     ,  a.ADMS_DX_YN                                as ADMS_DX_YN           /* 입원진단여부 */
		     ,  a.RUL_OUT_YN                                as RUL_OUT_YN           /* RULE_Out여부 */
		     ,  b.SCIN_CD                                   as SCIN_CD              /* 상병코드 */
		     ,  b.SCIN_NM                                   as SCIN_NM              /* 상병명 */
		     ,  b.MAIN_SCIN_YN                              as MAIN_SCIN_YN         /* 주상병여부 */
		     ,  b.CMDS_YN                                   as CMDS_YN              /* 전염병여부 */
		     ,  case 
		            when a.CODV_CD in ('I','E') then to_char(a.FRST_RGST_DT, 'yyyymmdd')
		            else to_char(c.MDCR_DT, 'yyyymmdd')
		            end                                     as RGST_YMD             /* 등록일 */
		     ,  nvl(b.STHS_SCIN_DVSN_CD, 'Y')               as STHS_SCIN_DVSN_CD    /* 재원상병구분코드 */
		     ,  case
		            when a.MAIN_CLNC_DX_YN = 'Y' then a.ABC_MCCN_CD
		            else nvl(a.ABC_MCCN_CD, 'N/A')
		            end                                     as ABC_MCCN_CD          /* ABC진료센터코드 */
		     ,  (   select  KORN_DPRT_NM
		              from  HZDEPTMMT
		             where  DPRT_CD = a.ABC_MCCN_CD
		        )                                           as ABC_MCCN_NM          /* ABC진료센터명 */
		     ,  b.PTAD_IPDV_CD                              as PTAD_IPDV_CD         /* 원무급여구분코드 */
		     ,  d.SDPF_EXCP_CD                              as SDPF_EXCP_CD         /* 의약분업예외코드 */
		     ,  d.SCIN_ENSN_NM                              as SCIN_ENSN_NM         /* 상병영문명 */
		     ,  d.SCIN_KORN_NM                              as SCIN_KORN_NM         /* 상병한글명 */
		     ,  (   select  min(case when SPCS_DVSN_CD = '01' then 'A' ELSE 'B' end)
		              from  AIIMASABT
		             where  STRT_SCIN_CD    <=  b.SCIN_CD
		               and  FNSH_SCIN_CD    >   b.SCIN_CD
		               and  trunc(b.FRST_RGST_DT) between APST_YMD and APFN_YMD
		               and  SPCS_DVSN_CD in ('01', '03', '07', '08', '09', '10')
		        )                                           as ASCS_CD              /* 산정특례 ('A' 암환자, 'B' 희귀난치질환) */
		     ,  (   select  max(ACUT_CRBR_DISS_YN)
		              from  AIIMASABT
		             where  STRT_SCIN_CD    <=  b.SCIN_CD
		               and  FNSH_SCIN_CD    >   b.SCIN_CD
		               and  trunc(b.FRST_RGST_DT) between APST_YMD and APFN_YMD
		               and  ISTY_ASST_CD not in ('OA', 'SA', 'T1', 'T2', 'T3', 'T4', 'T8', 'TE', 'TI', 'ZZ')
		        )                                           as ACUT_CRBR_DISS_YN        /* 급성뇌혈관질환대상여부 */
		     ,  a.ACUT_DISS_YN  /* 급성질환여부 */ 
		     , (select decode(count(ASCS_APLY_BASE_CD),0,'N','Y')
		         from AIIMASABT x /* 산정특례적용기준코드 */
		       where b.SCIN_CD >= x.STRT_SCIN_CD
		          and b.SCIN_CD  < x.FNSH_SCIN_CD
		          and x.SPSD_ID in ('V252','V352')
		          and c.MDCR_YMD between nvl(x.APST_YMD, to_date('19950101', 'yyyymmdd')) and nvl(x.APFN_YMD, to_date('29991231', 'yyyymmdd'))) as SLIL_SCIN_YN /* 경증상병여부 */
		     , (select max(case when nvl(x.RGST_RFSL_YN,'N') = 'N' and y.CLNC_DX_CD is not null then 'Y'
		                    else 'N' end)
			      from MRRCSCINT x /* 의무기록 추천상병 */
			         , MRRCSCIDT y /* 의무기록 추천상병 상세 */
			     where x.MDRP_NO    = #{mdrpNo}
		           and x.MCDP_CD    = a.MCDP_CD
			       and y.MDRP_NO    = x.MDRP_NO
		           and y.MCDP_CD    = x.MCDP_CD
			       and y.CLNC_DX_CD = a.CLNC_DX_CD) as RCMN_SCIN_YN /* 추천상병여부 */
		     ,  d.MAIN_SCIN_DSLW_YN   as MAIN_SCIN_DSLW_YN  /* 주상병불가여부 */
		  from  MDPACLNCT a     /* 환자임상진단내역 */
		     ,  MDPADIAGT b     /* 환자상병내역 */
		     ,  APRCRPTNT c     /* 진료접수내역 */
		     ,  MRBSSCINT d     /* 상병코드 */
		 where  b.MDRP_NO           =   a.MDRP_NO
		   and  b.PTNT_CLNC_DX_SNO  =   a.PTNT_CLNC_DX_SNO
		   and  c.MDRP_NO           =   a.MDRP_NO
		   and  d.SCIN_CD           =   b.SCIN_CD
		   and  trunc(b.FRST_RGST_DT) between d.APLY_YMD and nvl(d.FNSH_YMD, sysdate)
		]]>
		 <if test='ptno != null and ptno != ""'>
		   and  c.PTNO              =   #{ptno}
		 </if>
		 <if test='mdrpNo != null and mdrpNo != 0'>
		   and  c.MDRP_NO           =   #{mdrpNo}
		 </if>
		 <if test='strtYmd != null and strtYmd != ""'>
		   and  c.MDCR_YMD between to_date(#{strtYmd}, 'yyyymmdd') and to_date(#{fnshYmd}, 'yyyymmdd')
		 </if>
		 <if test='mcdpCd != null and mcdpCd != ""'>
		   and  c.MCDP_CD           =   #{mcdpCd}
		 </if>
		 <if test='clncDxCd != null and clncDxCd != ""'>
		   and  a.CLNC_DX_CD        =   #{clncDxCd}
		 </if> 
		 <if test='mainClncDxYn != null and mainClncDxYn != ""'>
		   and  a.MAIN_CLNC_DX_YN   =   #{mainClncDxYn}
		 </if>
		 <if test='mainScinYn != null and mainScinYn != ""'>
		   and  b.MAIN_SCIN_YN   =   #{mainScinYn}
		 </if>
		 <if test='clncDxOnlyYn != null and clncDxOnlyYn == "Y"'>
		   <!-- #{clncDxOnlyYn} 임상진단 내역만 조회하는 경우 -->
		   and  b.PTNT_SCIN_SNO     =   1
		 </if>
		 order 
		    by  c.MDCR_DT desc
		     ,  decode(a.MAIN_CLNC_DX_YN, 'Y', 'A', decode(a.DFNT_SCIN_YN, null, 'C', 'B'))
		     ,  a.FRST_RGST_DT desc
		     ,  a.PTNT_CLNC_DX_SNO
		     ,  b.PTNT_SCIN_SNO
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listTmprPtntClncDx-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="mdcrDt" column="MDCR_DT"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="abrvMcdpCd" column="ABRV_MCDP_CD"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="ptntClncDxSno" column="PTNT_CLNC_DX_SNO"/>
		<result property="ptntScinSno" column="PTNT_SCIN_SNO"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="codvNm" column="CODV_NM"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="gndrId" column="GNDR_ID"/>
		<result property="gndrNm" column="GNDR_NM"/>
		<result property="clncDxCd" column="CLNC_DX_CD"/>
		<result property="clncDxNm" column="CLNC_DX_NM"/>
		<result property="clncDxMemoCtn" column="CLNC_DX_MEMO_CTN"/>
		<result property="ptntScinUnslCtn" column="PTNT_SCIN_UNSL_CTN"/>
		<result property="dxSiteCd" column="DX_SITE_CD"/>
		<result property="mainClncDxYn" column="MAIN_CLNC_DX_YN"/>
		<result property="dfntScinYn" column="DFNT_SCIN_YN"/>
		<result property="upltRwttVl" column="UPLT_RWTT_VL"/>
		<result property="uprgRwttVl" column="UPRG_RWTT_VL"/>
		<result property="lwlfRwttVl" column="LWLF_RWTT_VL"/>
		<result property="lwrgRwttVl" column="LWRG_RWTT_VL"/>
		<result property="admsDxYn" column="ADMS_DX_YN"/>
		<result property="rulOutYn" column="RUL_OUT_YN"/>
		<result property="scinCd" column="SCIN_CD"/>
		<result property="scinNm" column="SCIN_NM"/>
		<result property="mainScinYn" column="MAIN_SCIN_YN"/>
		<result property="rgstYmd" column="RGST_YMD"/>
		<result property="sdpfExcpCd" column="SDPF_EXCP_CD"/>
		<result property="ascsCd" column="ASCS_CD"/>
		<result property="mddvCd" column="MDDV_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listTmprPtntClncDx ((임시)환자임상진단 조회) 
        Description :                                           (임시)환자임상진단 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listTmprPtntClncDx-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listTmprPtntClncDx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listTmprPtntClncDx-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listTmprPtntClncDx */
		<![CDATA[
		select  /*+ MdpPtntClncDxMngmDAO-listTmprPtntClncDx_환자임상진단내역임시 조회 */
		        a.PTNO                                  as PTNO                     /* 환자번호 */
		     ,  a.MDRP_NO                               as MDRP_NO                  /* 진료접수번호 */
		     ,  to_char(c.MDCR_DT, 'yyyymmddhh24miss')  as MDCR_DT                  /* 진료일시 */
		     ,  a.MCDP_CD                               as MCDP_CD                  /* 진료과코드 */
		     ,  (
		        select  ABRV_DPRT_CD
		          from  HZDEPTMMT
		         where  DPRT_CD = a.MCDP_CD
		        )                                       as ABRV_MCDP_CD             /* 약어진료과코드 */
		     ,  (
		        select  KORN_DPRT_NM
		          from  HZDEPTMMT
		         where  DPRT_CD = a.MCDP_CD
		        )                                       as MCDP_NM                  /* 진료과명*/
		     ,  a.PTNT_CLNC_DX_SNO                      as PTNT_CLNC_DX_SNO         /* 환자임상진단일련번호 */
		     ,  b.SORT_SQNC                             as PTNT_SCIN_SNO            /* 환자상병일련번호 */
		     ,  a.CODV_CD                               as CODV_CD                  /* 내원구분 */
		     ,  (
		        select  DETL_CD_NM
		          from  CCCMCDDMT
		         where  COMN_GRP_CD  = 'MM262'
		           and  COMN_DTLS_CD = a.CODV_CD
		        )                                       as CODV_NM                  /* 내원구분명 */
		     ,  a.CHDR_ID                               as CHDR_ID                  /* 지정의사ID */
		     ,  (
		        select  USER_NM
		          from  CCUSRDPHT
		         where  USER_ID = a.CHDR_ID
		        )                                       as CHDR_NM                  /* 지정의사명 */
		     ,  a.GNDR_ID                               as GNDR_ID                  /* 주치의사ID */
		     ,  (
		        select  USER_NM
		          from  CCUSRDPHT
		         where  USER_ID = a.GNDR_ID
		        )                                       as GNDR_NM                  /* 주치의사명 */
		     ,  a.CLNC_DX_CD                            as CLNC_DX_CD               /* 임상진단코드 */
		     ,  a.CLNC_DX_NM                            as CLNC_DX_NM               /* 임상진단명 */
		     ,  a.CLNC_DX_MEMO_CTN                      as CLNC_DX_MEMO_CTN         /* 임상진단메모내용 */
		     ,  a.PTNT_SCIN_UNSL_CTN                    as PTNT_SCIN_UNSL_CTN       /* 환자상병특이내용 */
		     ,  a.DX_SITE_CD                            as DX_SITE_CD               /* 진단부위 */
		     ,  a.MAIN_CLNC_DX_YN                       as MAIN_CLNC_DX_YN          /* 주임상진단여부 */
		     ,  a.DFNT_SCIN_YN                          as DFNT_SCIN_YN             /* 확정상병여부 */
		     ,  a.UPLT_RWTT_VL                          as UPLT_RWTT_VL             /* 상좌치열값 */
		     ,  a.UPRG_RWTT_VL                          as UPRG_RWTT_VL             /* 상우치열값 */
		     ,  a.LWLF_RWTT_VL                          as LWLF_RWTT_VL             /* 하좌치열값 */
		     ,  a.LWRG_RWTT_VL                          as LWRG_RWTT_VL             /* 하우치열값 */
		     ,  a.ADMS_DX_YN                            as ADMS_DX_YN               /* 입원진단여부 */
		     ,  a.RUL_OUT_YN                            as RUL_OUT_YN               /* RULE_Out여부 */
		     ,  b.SCIN_CD                               as SCIN_CD                  /* 상병코드 */
		     ,  b.SCIN_ENSN_NM                          as SCIN_NM                  /* 상병명 */
		     ,  case
		            when a.MAIN_CLNC_DX_YN = 'Y' and b.SORT_SQNC = 1 then 'Y'
		            else 'N'
		        end                                     as MAIN_SCIN_YN             /* 주상병여부 */
		     ,  case
		            when a.CODV_CD = 'I' then to_char(a.FRST_RGST_DT, 'yyyymmdd')
		            else to_char(c.MDCR_DT, 'yyyymmdd')
		        end                                     as RGST_YMD                 /* 등록일 */
		     ,  (
		        select  SDPF_EXCP_CD
		          from  MRBSSCINT
		         where  SCIN_CD = b.SCIN_CD
		           and  c.MDCR_YMD between APLY_YMD and nvl(FNSH_YMD, sysdate + 100)
		        )                                       as SDPF_EXCP_CD             /* 의약분업예외코드 */
		     ,  (
		        select  min(case when ISTY_ASST_CD in ('A4', 'A7', 'A8') then 'A' ELSE 'B' end)
		          from  AIIMASABT
		         where  STRT_SCIN_CD    <=  b.SCIN_CD
		           and  FNSH_SCIN_CD    >   b.SCIN_CD
		           and  trunc(c.MDCR_YMD) between APST_YMD and APFN_YMD
		           and  ISTY_ASST_CD not in ('OA', 'SA', 'T1', 'T2', 'T3', 'T4', 'T8', 'TE', 'TI', 'ZZ')
		        )                                       as ASCS_CD                  /* 산정특례 ('A' 암환자, 'B' 희귀난치질환) */
		     ,  ''                                      as MDDV_CD                  /* 변경구분코드 */
		  from  MDPACLNTT a     /* 환자임상진단내역임시 */
		     ,  (   
		        select  a.TRMN_ID           /* 용어ID */
		             ,  a.TRMN_NM           /* 용어명 */
		             ,  b.SCIN_CD           /* 상병코드 */
		             ,  c.SCIN_ENSN_NM      /* 상병영문명 */
		             ,  b.SORT_SQNC         /* 정렬순서 */
		          from  METRDCTMT a     /* 용어사전 */
		             ,  MRBSCLSCT b     /* 임상코드상병 */
		             ,  MRBSSCINT c     /* 상병코드 */
		         where  to_date(#{mdcrDt}, 'yyyymmddhh24miss') between a.APLY_YMD 
		                                                           and nvl(a.FNSH_YMD, sysdate + 100) + 0.99999
		           and  a.MDCR_USE_YN           =   'Y'
		           and  to_date(#{mdcrDt}, 'yyyymmddhh24miss') between b.TRMN_MPNG_STRT_YMD 
		                                                           and nvl(b.TRMN_MPNG_FNSH_YMD, sysdate + 100) + 0.99999
		           and  b.TRMN_ID               =   a.TRMN_ID
		           and  to_date(#{mdcrDt}, 'yyyymmddhh24miss') between c.APLY_YMD 
		                                                           and nvl(c.FNSH_YMD, sysdate + 100) + 0.99999
		           and  c.MDCR_USE_YN           =   'Y'
		           and  c.SCIN_CD               =   b.SCIN_CD
		           and  c.SCIN_CD_VRSN_STRT_YMD =   b.SCIN_CD_VRSN_STRT_YMD
		        ) b     /*  임상진단 */
		     ,  APRCRPTNT c     /* 진료접수 */
		 where  a.MDRP_NO   =   #{mdrpNo}
		   and  b.TRMN_ID   =   a.CLNC_DX_CD
		   and  c.MDRP_NO   =   a.MDRP_NO
		 order
		    by  decode(a.MAIN_CLNC_DX_YN, 'Y', 'A', decode(a.DFNT_SCIN_YN, null, 'C', 'B'))
		     ,  a.FRST_RGST_DT desc
		     ,  a.CLNC_DX_CD
		     ,  b.SORT_SQNC
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain01-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="mdcrDt" column="MDCR_DT"/>
		<result property="mdcrYmd" column="MDCR_YMD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="abrvMcdpCd" column="ABRV_MCDP_CD"/>
		<result property="mcdpNm" column="MCDP_NM"/>
		<result property="ptntClncDxSno" column="PTNT_CLNC_DX_SNO"/>
		<result property="ptntScinSno" column="PTNT_SCIN_SNO"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="codvNm" column="CODV_NM"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="gndrId" column="GNDR_ID"/>
		<result property="gndrNm" column="GNDR_NM"/>
		<result property="trmnId" column="TRMN_ID"/>
		<result property="clncDxCd" column="CLNC_DX_CD"/>
		<result property="clncDxNm" column="CLNC_DX_NM"/>
		<result property="clncDxMemoCtn" column="CLNC_DX_MEMO_CTN"/>
		<result property="ptntScinUnslCtn" column="PTNT_SCIN_UNSL_CTN"/>
		<result property="dxSiteCd" column="DX_SITE_CD"/>
		<result property="mainClncDxYn" column="MAIN_CLNC_DX_YN"/>
		<result property="dfntScinYn" column="DFNT_SCIN_YN"/>
		<result property="upltRwttVl" column="UPLT_RWTT_VL"/>
		<result property="uprgRwttVl" column="UPRG_RWTT_VL"/>
		<result property="lwlfRwttVl" column="LWLF_RWTT_VL"/>
		<result property="lwrgRwttVl" column="LWRG_RWTT_VL"/>
		<result property="admsDxYn" column="ADMS_DX_YN"/>
		<result property="rulOutYn" column="RUL_OUT_YN"/>
		<result property="scinCd" column="SCIN_CD"/>
		<result property="scinNm" column="SCIN_NM"/>
		<result property="mainScinYn" column="MAIN_SCIN_YN"/>
		<result property="cmdsYn" column="CMDS_YN"/>
		<result property="rgstYmd" column="RGST_YMD"/>
		<result property="sthsScinDvsnCd" column="STHS_SCIN_DVSN_CD"/>
		<result property="abcMccnCd" column="ABC_MCCN_CD"/>
		<result property="abcMccnNm" column="ABC_MCCN_NM"/>
		<result property="ptadIpdvCd" column="PTAD_IPDV_CD"/>
		<result property="sdpfExcpCd" column="SDPF_EXCP_CD"/>
		<result property="scinEnsnNm" column="SCIN_ENSN_NM"/>
		<result property="scinKornNm" column="SCIN_KORN_NM"/>
		<result property="ascsCd" column="ASCS_CD"/>
		<result property="acutCrbrDissYn" column="ACUT_CRBR_DISS_YN"/>
		<result property="acutDissYn" column="ACUT_DISS_YN"/>
		<result property="slilScinYn" column="SLIL_SCIN_YN"/>
		<result property="rcmnScinYn" column="RCMN_SCIN_YN"/>
		<result property="mainScinDslwYn" column="MAIN_SCIN_DSLW_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain01 (환자 임상진단 조회 (지정의  최초등록자인 경우)) 
        Description :                                           환자 임상진단 조회 (지정의  최초등록자)  퇴원요약지 지정의 진단 자동연동용
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain01-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain01"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain01-result" useCache="true" flushCache="false">
		<![CDATA[
		select /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClncDxMain01 */ 
		       /*+ MdpPtntClncDxMngmDAO-listPtntClncDxMain_환자상병내역 조회 (지정의=최초등록자) */
		        a.PTNO                                      as PTNO                 /* 환자번호 */
		     ,  a.MDRP_NO                                   as MDRP_NO              /* 진료접수번호 */
		     ,  to_char(c.MDCR_DT, 'yyyymmddhh24miss')      as MDCR_DT              /* 진료일시 */
		     ,  to_char(c.MDCR_YMD, 'yyyymmdd')             as MDCR_YMD             /* 진료일시 */
		     ,  a.MCDP_CD                                   as MCDP_CD              /* 진료과코드 */
		     ,  (   select  ABRV_DPRT_CD
		              from  HZDEPTMMT
		             where  DPRT_CD = a.MCDP_CD
		        )                                           as ABRV_MCDP_CD         /* 약어진료과코드 */
		     ,  (   select  KORN_DPRT_NM
		              from  HZDEPTMMT
		             where  DPRT_CD = a.MCDP_CD
		        )                                           as MCDP_NM              /* 진료과명*/
		     ,  a.PTNT_CLNC_DX_SNO                          as PTNT_CLNC_DX_SNO     /* 환자임상진단일련번호 */
		     ,  b.PTNT_SCIN_SNO                             as PTNT_SCIN_SNO        /* 환자상병일련번호 */
		     ,  a.CODV_CD                                   as CODV_CD              /* 내원구분 */
		     ,  (   select  DETL_CD_NM
		              from  CCCMCDDMT
		             where  COMN_GRP_CD  = 'MM262'
		               and  COMN_DTLS_CD = a.CODV_CD
		        )                                           as CODV_NM              /* 내원구분명 */
		     ,  a.CHDR_ID                                   as CHDR_ID              /* 지정의사ID */
		     ,  (   select  USER_NM 
		              from  CCUSRDPHT 
		             where  USER_ID = a.CHDR_ID
		        )                                           as CHDR_NM              /* 지정의사명 */
		     ,  a.GNDR_ID                                   as GNDR_ID              /* 주치의사ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID = a.GNDR_ID
		        )                                           as GNDR_NM              /* 주치의사명 */
		     ,  a.CLNC_DX_CD                                as TRMN_ID              /* 용어ID */
		     ,  a.CLNC_DX_CD                                as CLNC_DX_CD           /* 임상진단코드 */
		     ,  decode(nvl(a.ACUT_DISS_YN, 'N'), 'Y', '(급성)', '') || a.CLNC_DX_NM                                as CLNC_DX_NM           /* 임상진단명 */
		     ,  a.CLNC_DX_MEMO_CTN                          as CLNC_DX_MEMO_CTN     /* 임상진단메모내용 */
		     ,  a.PTNT_SCIN_UNSL_CTN                        as PTNT_SCIN_UNSL_CTN   /* 환자상병특이내용 */
		     ,  a.DX_SITE_CD                                as DX_SITE_CD           /* 진단부위 */
		     ,  a.MAIN_CLNC_DX_YN                           as MAIN_CLNC_DX_YN      /* 주임상진단여부 */
		     ,  a.DFNT_SCIN_YN                              as DFNT_SCIN_YN         /* 확정상병여부 */
		     ,  a.UPLT_RWTT_VL                              as UPLT_RWTT_VL         /* 상좌치열값 */
		     ,  a.UPRG_RWTT_VL                              as UPRG_RWTT_VL         /* 상우치열값 */
		     ,  a.LWLF_RWTT_VL                              as LWLF_RWTT_VL         /* 하좌치열값 */
		     ,  a.LWRG_RWTT_VL                              as LWRG_RWTT_VL         /* 하우치열값 */
		     ,  a.ADMS_DX_YN                                as ADMS_DX_YN           /* 입원진단여부 */
		     ,  a.RUL_OUT_YN                                as RUL_OUT_YN           /* RULE_Out여부 */
		     ,  b.SCIN_CD                                   as SCIN_CD              /* 상병코드 */
		     ,  b.SCIN_NM                                   as SCIN_NM              /* 상병명 */
		     ,  b.MAIN_SCIN_YN                              as MAIN_SCIN_YN         /* 주상병여부 */
		     ,  b.CMDS_YN                                   as CMDS_YN              /* 전염병여부 */
		     ,  case 
		            when a.CODV_CD in ('I','E') then to_char(a.FRST_RGST_DT, 'yyyymmdd')
		            else to_char(c.MDCR_DT, 'yyyymmdd')
		            end                                     as RGST_YMD             /* 등록일 */
		     ,  nvl(b.STHS_SCIN_DVSN_CD, 'Y')               as STHS_SCIN_DVSN_CD    /* 재원상병구분코드 */
		     ,  case
		            when a.MAIN_CLNC_DX_YN = 'Y' then a.ABC_MCCN_CD
		            else nvl(a.ABC_MCCN_CD, 'N/A')
		            end                                     as ABC_MCCN_CD          /* ABC진료센터코드 */
		     ,  (   select  KORN_DPRT_NM
		              from  HZDEPTMMT
		             where  DPRT_CD = a.ABC_MCCN_CD
		        )                                           as ABC_MCCN_NM          /* ABC진료센터명 */
		     ,  b.PTAD_IPDV_CD                              as PTAD_IPDV_CD         /* 원무급여구분코드 */
		     ,  d.SDPF_EXCP_CD                              as SDPF_EXCP_CD         /* 의약분업예외코드 */
		     ,  d.SCIN_ENSN_NM                              as SCIN_ENSN_NM         /* 상병영문명 */
		     ,  d.SCIN_KORN_NM                              as SCIN_KORN_NM         /* 상병한글명 */
		     ,  (   select  min(case when SPCS_DVSN_CD = '01' then 'A' ELSE 'B' end)
		              from  AIIMASABT
		             where  STRT_SCIN_CD    <=  b.SCIN_CD
		               and  FNSH_SCIN_CD    >   b.SCIN_CD
		               and  trunc(b.FRST_RGST_DT) between APST_YMD and APFN_YMD
		               and  SPCS_DVSN_CD in ('01', '03', '07', '08', '09', '10')
		        )                                           as ASCS_CD              /* 산정특례 ('A' 암환자, 'B' 희귀난치질환) */
		     ,  (   select  max(ACUT_CRBR_DISS_YN)
		              from  AIIMASABT
		             where  STRT_SCIN_CD    <=  b.SCIN_CD
		               and  FNSH_SCIN_CD    >   b.SCIN_CD
		               and  trunc(b.FRST_RGST_DT) between APST_YMD and APFN_YMD
		               and  ISTY_ASST_CD not in ('OA', 'SA', 'T1', 'T2', 'T3', 'T4', 'T8', 'TE', 'TI', 'ZZ')
		        )                                           as ACUT_CRBR_DISS_YN        /* 급성뇌혈관질환대상여부 */
		     ,  a.ACUT_DISS_YN  /* 급성질환여부 */ 
		     , (select decode(count(ASCS_APLY_BASE_CD),0,'N','Y')
		         from AIIMASABT x /* 산정특례적용기준코드 */
		       where b.SCIN_CD >= x.STRT_SCIN_CD
		          and b.SCIN_CD  < x.FNSH_SCIN_CD
		          and x.SPSD_ID in ('V252','V352')
		          and c.MDCR_YMD between nvl(x.APST_YMD, to_date('19950101', 'yyyymmdd')) and nvl(x.APFN_YMD, to_date('29991231', 'yyyymmdd'))) as SLIL_SCIN_YN /* 경증상병여부 */
		     , (select max(case when nvl(x.RGST_RFSL_YN,'N') = 'N' and y.CLNC_DX_CD is not null then 'Y'
		                    else 'N' end)
			      from MRRCSCINT x /* 의무기록 추천상병 */
			         , MRRCSCIDT y /* 의무기록 추천상병 상세 */
			     where x.MDRP_NO    = #{mdrpNo}
		           and x.MCDP_CD    = a.MCDP_CD
			       and y.MDRP_NO    = x.MDRP_NO
		           and y.MCDP_CD    = x.MCDP_CD
			       and y.CLNC_DX_CD = a.CLNC_DX_CD) as RCMN_SCIN_YN /* 추천상병여부 */
		     ,  d.MAIN_SCIN_DSLW_YN   as MAIN_SCIN_DSLW_YN  /* 주상병불가여부 */
		  from  MDPACLNCT a     /* 환자임상진단내역 */
		     ,  MDPADIAGT b     /* 환자상병내역 */
		     ,  APRCRPTNT c     /* 진료접수내역 */
		     ,  MRBSSCINT d     /* 상병코드 */
		 where  b.MDRP_NO           =   a.MDRP_NO
		   and  b.PTNT_CLNC_DX_SNO  =   a.PTNT_CLNC_DX_SNO
		   and  c.MDRP_NO           =   a.MDRP_NO
		   and  d.SCIN_CD           =   b.SCIN_CD
		   and  trunc(b.FRST_RGST_DT) between d.APLY_YMD and nvl(d.FNSH_YMD, sysdate)
		   and a.FRST_RGSR_ID = a.CHDR_ID     /* 최초등록자  지정의 */
		]]>
		 <if test='ptno != null and ptno != ""'>
		   and  c.PTNO              =   #{ptno}
		 </if>
		 <if test='mdrpNo != null and mdrpNo != 0'>
		   and  c.MDRP_NO           =   #{mdrpNo}
		 </if>
		 <if test='strtYmd != null and strtYmd != ""'>
		   and  c.MDCR_YMD between to_date(#{strtYmd}, 'yyyymmdd') and to_date(#{fnshYmd}, 'yyyymmdd')
		 </if>
		 <if test='mcdpCd != null and mcdpCd != ""'>
		   and  c.MCDP_CD           =   #{mcdpCd}
		 </if>
		 <if test='clncDxCd != null and clncDxCd != ""'>
		   and  a.CLNC_DX_CD        =   #{clncDxCd}
		 </if> 
		 <if test='mainClncDxYn != null and mainClncDxYn != ""'>
		   and  a.MAIN_CLNC_DX_YN   =   #{mainClncDxYn}
		 </if>
		 <if test='mainScinYn != null and mainScinYn != ""'>
		   and  b.MAIN_SCIN_YN   =   #{mainScinYn}
		 </if>
		 <if test='clncDxOnlyYn != null and clncDxOnlyYn == "Y"'>
		   <!-- #{clncDxOnlyYn} 임상진단 내역만 조회하는 경우 -->
		   and  b.PTNT_SCIN_SNO     =   1
		 </if>
		 order 
		    by  c.MDCR_DT desc
		     ,  decode(a.MAIN_CLNC_DX_YN, 'Y', 'A', decode(a.DFNT_SCIN_YN, null, 'C', 'B'))
		     ,  a.FRST_RGST_DT desc
		     ,  a.PTNT_CLNC_DX_SNO
		     ,  b.PTNT_SCIN_SNO
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listStcmDldcWrtgTrgtScin-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="scinCd" column="SCIN_CD"/>
		<result property="stcmClsfGropCd" column="STCM_CLSF_GROP_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listStcmDldcWrtgTrgtScin (법정전염병신고서 작성대상상병 조회) 
        Description :                                           법정전염병신고서 작성대상상병 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listStcmDldcWrtgTrgtScin-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listStcmDldcWrtgTrgtScin"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listStcmDldcWrtgTrgtScin-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listStcmDldcWrtgTrgtScin */
		select  b.SCIN_CD
		     ,  c.STCM_CLSF_GROP_CD     /* 법정전염병분류군코드 */
		  from  MDPACLNCT a
		     ,  MDPADIAGT b 
		     ,  MRBSSCINT c
		 where  a.MDRP_NO           =   #{mdrpNo}
		   and  b.MDRP_NO           =   a.MDRP_NO
		   and  b.PTNT_CLNC_DX_SNO  =   a.PTNT_CLNC_DX_SNO
		   and  c.SCIN_CD           =   b.SCIN_CD
		   and  nvl(to_date(#{baseYmd}, 'YYYYMMDD'), trunc(sysdate)) between c.APLY_YMD and c.FNSH_YMD
		   and  (c.STCM_CLSF_GROP_CD is not null) 
		   and  c.CDCP_INFC_SCKS_CD <> 'NC0015' /* HIV(AIDS의 경우 신고서 작성하지 않도록 변경) */
		   and  not exists  (   select  1
		                          from  MDINFCRPT   /* 법정감염병신고 */
		                         where  PTNO    =   b.PTNO
		                           and  MCDP_CD =   b.MCDP_CD
		                           and  SCIN_CD like substr(b.SCIN_CD, 1, 3) || '%'
		                           and  SCIN_CD not in ( 'Z20.8' ) 
		                     union all
		                        select  1
		                          from  MDINFCRPT   /* 법정감염병신고 */
		                         where  PTNO    =   b.PTNO
		                           and  MCDP_CD =   b.MCDP_CD
		                           and  MDRP_NO =   b.MDRP_NO
		                           and  SCIN_CD like substr(b.SCIN_CD, 1, 3) || '%'
		                           and  SCIN_CD = 'Z20.8'
		                    )
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listSdpfExcpTrgtScin-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="scinCd" column="SCIN_CD"/>
		<result property="sdpfExcpCd" column="SDPF_EXCP_CD"/>
		<result property="sdpfExcpNm" column="SDPF_EXCP_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listSdpfExcpTrgtScin (의약분업 예외대상 상병 조회) 
        Description :                                           의약분업 예외대상 상병 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listSdpfExcpTrgtScin-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listSdpfExcpTrgtScin"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listSdpfExcpTrgtScin-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listSdpfExcpTrgtScin */
		select  /*+ MdpPtntClncDxMngmDAO-listSdpfExcpTrgtScin_의약분업 예외대상 상병 조회 */
		        c.SCIN_CD
		     ,  c.SDPF_EXCP_CD
		     ,  (   select  DETL_CD_NM
					  from  CCCMCDDMT
					 where  COMN_GRP_CD     =   'SD029'
					   and  COMN_DTLS_CD    =   c.SDPF_EXCP_CD
		        )   as SDPF_EXCP_NM             /* 원내처방사유코드(SD029) */     
		  from  MDPACLNCT a
		     ,  MDPADIAGT b
		     ,  MRBSSCINT c
		 where  a.MDRP_NO           =   #{mdrpNo}
		   and  b.MDRP_NO           =   a.MDRP_NO
		   and  b.PTNT_CLNC_DX_SNO  =   a.PTNT_CLNC_DX_SNO
		   and  c.SCIN_CD           =   b.SCIN_CD
		   and  nvl(to_date(#{baseYmd}, 'YYYYMMDD'), trunc(sysdate)) between c.APLY_YMD and nvl(c.FNSH_YMD, sysdate)
		   and  c.SDPF_EXCP_CD is not null
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClbyScinCd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="btdt" column="BTDT"/>
		<result property="ageCtn" column="AGE_CTN"/>
		<result property="careWardCd" column="CARE_WARD_CD"/>
		<result property="abrvCareWardCd" column="ABRV_CARE_WARD_CD"/>
		<result property="carePtrmNo" column="CARE_PTRM_NO"/>
		<result property="chdrNm" column="CHDR_NM"/>
		<result property="mdcrDt" column="MDCR_DT"/>
		<result property="mainScinYn" column="MAIN_SCIN_YN"/>
		<result property="clncDxCd" column="CLNC_DX_CD"/>
		<result property="clncDxNm" column="CLNC_DX_NM"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClbyScinCd (상병별 환자조회) 
        Description :                                           상병별 환자조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClbyScinCd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClbyScinCd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClbyScinCd-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listPtntClbyScinCd */
		select  /*+ mdd_padiagt_l16$S01_상병별 환자조회 */
		        a.PTNO                                      as PTNO             /* 환자번호 */
		     ,  a.MCDP_CD                                   as MCDP_CD          /* 진료과 */
		     ,  (   select  ABRV_DPRT_CD
		             from   HZDEPTMMT
		             where  DPRT_CD = a.MCDP_CD
		        )                                           as ABRV_DPRT_CD
		     ,  b.PTNT_NM                                   as PTNT_NM          /* 환자명 */
		     ,  b.GEND_CD                                   as GEND_CD          /* 성별 */
		     ,  to_char(b.BTDT, 'yyyymmdd')                 as BTDT             /* 생년월일 */
		     ,  b.GEND_CD || '/' || fn_md_getage('2', b.BTDT, sysdate) as AGE_CTN
		     ,  case
		            when a.CODV_CD = 'I' then c.CARE_WARD_CD                              
		            end                                     as CARE_WARD_CD     /* 병동번호(현위치) */
		     ,  case
		            when a.CODV_CD = 'I' then   (   select  ABRV_DPRT_CD
		                                              from  HZDEPTMMT
		                                             where  DPRT_CD = c.CARE_WARD_CD
		                                        )                                           
		            end                                     as ABRV_CARE_WARD_CD
		     ,  case
		            when a.CODV_CD = 'I' then c.CARE_PTRM_NO                              
		            end                                     as CARE_PTRM_NO     /* 병실번호(현위치) */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID = a.CHDR_ID
		        )                                           as CHDR_NM          /* 주치의사 */
		     ,  to_char(c.MDCR_DT, 'yyyymmddhh24miss')      as MDCR_DT          /* 진료일자 */
		     ,  nvl(a.MAIN_SCIN_YN, 'N')                    as MAIN_SCIN_YN     /* 주상병여부 */
		     ,  a.SCIN_CD                                   as CLNC_DX_CD
		     ,  fn_md_diagname_s2(a.SCIN_CD, 'E', sysdate)  as CLNC_DX_NM
		  from  MDPADIAGT a         /* 환자상병내역 */
		     ,  APPTPTNTT b         /* 환자기본정보 */
		     ,  APRCRPTNT c         /* 진료접수 */
		 where  #{scinCd} is not null
		   and  a.SCIN_CD like #{scinCd}||'%'
		   and  a.CODV_CD   =   #{codvCd}
		   and  c.MDCR_YMD between to_date(#{strtYmd}, 'YYYYMMDD') and to_date(#{fnshYmd}, 'YYYYMMDD')
		 <if test='mcdpCd != null and mcdpCd != ""'>
		   and  a.MCDP_CD   =   #{mcdpCd}
		 </if>
		 <if test='chdrId != null and chdrId != ""'>
		   and  instr((select EMNO_LIST_VL from CCEMNOHLV where USER_ID = #{chdrId}), a.CHDR_ID) <![CDATA[ > ]]> 0
		 </if>
		   and  b.PTNO      =   a.PTNO
		   and  c.MDRP_NO   =   a.MDRP_NO
		union all
		select  a.PTNO                                      as PTNO             /* 환자번호 */
		     ,  a.MCDP_CD                                   as MCDP_CD          /* 진료과 */
		     ,  (   select  ABRV_DPRT_CD
		             from   HZDEPTMMT
		             where  DPRT_CD = a.MCDP_CD
		        )                                           as ABRV_DPRT_CD
		     ,  b.PTNT_NM                                   as PTNT_NM          /* 환자명 */
		     ,  b.GEND_CD                                   as GEND_CD          /* 성별 */
		     ,  to_char(b.BTDT, 'yyyymmdd')                 as BTDT             /* 생년월일 */
		     ,  b.GEND_CD || '/' || fn_md_getage('2', b.BTDT, sysdate) as AGE_CTN
		     ,  case
		            when a.CODV_CD = 'I' then c.CARE_WARD_CD                              
		            end                                     as CARE_WARD_CD     /* 병동번호(현위치) */
		     ,  case
		            when a.CODV_CD = 'I' then   (   select  ABRV_DPRT_CD
		                                              from  HZDEPTMMT
		                                             where  DPRT_CD = c.CARE_WARD_CD
		                                        )                                           
		            end                                     as ABRV_CARE_WARD_CD
		     ,  case
		            when a.CODV_CD = 'I' then c.CARE_PTRM_NO                              
		            end                                     as CARE_PTRM_NO     /* 병실번호(현위치) */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID = a.CHDR_ID
		        )                                           as CHDR_NM          /* 주치의사 */
		     ,  to_char(c.MDCR_DT, 'yyyymmddhh24miss')      as MDCR_DT          /* 진료일자 */
		     ,  nvl(a.MAIN_CLNC_DX_YN, 'N')                 as MAIN_SCIN_YN     /* 주상병여부 */
		     ,  a.CLNC_DX_CD                                as CLNC_DX_CD
		     ,  a.CLNC_DX_NM                                as CLNC_DX_NM
		  from  MDPACLNCT a         /* 환자임상진단내역 */
		     ,  APPTPTNTT b         /* 환자기본정보 */
		     ,  APRCRPTNT c         /* 진료접수 */
		 where  #{clncDxCd} is not null
		   and  a.CLNC_DX_CD like #{clncDxCd}||'%'
		   and  a.CODV_CD   =   #{codvCd}
		   and  c.MDCR_YMD between to_date(#{strtYmd}, 'YYYYMMDD') and to_date(#{fnshYmd}, 'YYYYMMDD')
		 <if test='mcdpCd != null and mcdpCd != ""'>
		   and  a.MCDP_CD   =   #{mcdpCd}
		 </if>
		 <if test='chdrId != null and chdrId != ""'>
		   and  instr((select EMNO_LIST_VL from CCEMNOHLV where USER_ID = #{chdrId}), a.CHDR_ID) <![CDATA[ > ]]> 0
		 </if>
		   and  b.PTNO      =   a.PTNO
		   and  c.MDRP_NO   =   a.MDRP_NO
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listScinForDelt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ptntClncDxSno" column="PTNT_CLNC_DX_SNO"/>
		<result property="ptntScinSno" column="PTNT_SCIN_SNO"/>
		<result property="ptno" column="PTNO"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="scinCd" column="SCIN_CD"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listScinForDelt (상병삭제 전 필요정보 조회) 
        Description :                                           상병삭제 전 필요정보 조회(트리거용)
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listScinForDelt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listScinForDelt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listScinForDelt-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listScinForDelt */
		        MDRP_NO
		     ,  PTNT_CLNC_DX_SNO
		     ,  PTNT_SCIN_SNO
		     ,  PTNO
		     ,  MCDP_CD
		     ,  SCIN_CD
		     ,  CODV_CD
		     ,  to_char(FRST_RGST_DT, 'YYYYMMDDHH24MISS') as FRST_RGST_DT
		  from  MDPADIAGT
		 where  MDRP_NO = #{mdrpNo}
		   and  PTNT_CLNC_DX_SNO = #{ptntClncDxSno}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntClncDxSno-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="ptntClncDxSno" column="PTNT_CLNC_DX_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntClncDxSno (임상진단번호 신규 채번) 
        Description :                                           임상진단번호 신규 채번
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntClncDxSno-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntClncDxSno"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntClncDxSno-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntClncDxSno */
		select  /*+ MdpPtntClncDxMngmDAO-selectOneNewPtntClncDxSno_환자 임상진단순번 신규채번 */
		        nvl(max(PTNT_CLNC_DX_SNO), 0) + 1       as PTNT_CLNC_DX_SNO
		  from  MDPACLNCT
		 where  MDRP_NO = #{mdrpNo}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMainScinCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="inqrCct" column="INQR_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMainScinCct (주진단 건수 조회) 
        Description :                                           주진단 건수 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMainScinCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMainScinCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMainScinCct-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMainScinCct */
		<![CDATA[
		select  /*+ MdpPtntClncDxMngmDAO-selectOneMainScinCct_주상병 건수 조회 */
		        count('x')  as INQR_CCT
		  from  MDPADIAGT       /* 환자상병내역 */
		 where  MDRP_NO         =   #{mdrpNo}
		   and  MAIN_SCIN_YN    =   'Y'
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOnePpvlTrgtScinCct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="inqrCct" column="INQR_CCT"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOnePpvlTrgtScinCct (적정성평가 대상상병 건수조회) 
        Description :                                           적정성평가 대상상병 건수조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOnePpvlTrgtScinCct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOnePpvlTrgtScinCct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOnePpvlTrgtScinCct-result" useCache="true" flushCache="false">
		select  /*+ MdpPtntClncDxMngmDAO-selectOnePpvlTrgtScinCct_적정성평가 대상상병 건수조회 */
		        count(1)        as INQR_CCT
		  from  MDPADIAGT a
		     ,  APRCRPTNT b
		 where  a.PTNO      =   #{ptno}
		   and  b.MDRP_NO   =   a.MDRP_NO
		 <choose>
		   <when test='ppvlAplyCd = "LC"'>
		   -- 폐암 적정성
		   and  b.MDCR_YMD  <![CDATA[ >= ]]> trunc(sysdate) - (365 * 2)
		   and  a.SCIN_CD in    (   select  MDCR_DTLS_CTRL_CD
		                              from  MZCTRLMMT
		                             where  MDCR_CTRL_CD    =   'MM944'
		                               and  trunc(sysdate) between nvl(APST_YMD, sysdate - 1) and nvl(APFN_YMD, sysdate + 1)
		                        )
		   </when>
		   <when test='ppvlAplyCd = "CC"'>
		   -- 대장암 적정성
		   and  b.MDCR_YMD  <![CDATA[ >= ]]> trunc(sysdate) - (365 * 1)
		   and  (   (a.SCIN_CD like 'C18%') or
		            (a.SCIN_CD like 'C19%') or
		            (a.SCIN_CD like 'C20%')
		        )
		   </when>
		   <when test='ppvlAplyCd = "SC"'>
		   -- 위암 적정성
		   and  b.MDCR_YMD  <![CDATA[ >= ]]> trunc(sysdate) - (365 * 1)
		   and  (   (a.SCIN_CD like 'C16%') or
		            (a.SCIN_CD like 'D37.1%')
		        )
		   </when>
		   <otherwise>
		   and  1 = 2
		   </otherwise>
		 </choose>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneLastMdrpNo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="chdrId" column="CHDR_ID"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneLastMdrpNo (상병기준 최종 접수번호 조회) 
        Description :                                           상병기준 최종 접수번호 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneLastMdrpNo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneLastMdrpNo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneLastMdrpNo-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneLastMdrpNo */
		select  x.MDRP_NO
		     ,  x.CHDR_ID
		  from  (
		            select  a.MDRP_NO           as MDRP_NO
		                 ,  a.CHDR_ID           as CHDR_ID 
		                 ,  case
		                        when a.CODV_CD = 'O' and a.CHDR_ID = #{chdrId} then 0
		                        else 1
		                        end             as SORT_SQNC            /* 주치의ID가 입력된 경우 해당 해당 진료의 상병을 우선함 */
		              from  MDPACLNCT a
		                 ,  APRCRPTNT b
		             where  a.PTNO      =   #{ptno}
		             <if test='mcdpCd != null and mcdpCd != ""'>
		               and  a.MCDP_CD   =   #{mcdpCd}
		             </if>
		             <if test='codvCd != null and codvCd != ""'>
		               and  a.CODV_CD   =   #{codvCd}
		             </if>
		             <if test='tojrScinExclYn != null and tojrScinExclYn == "Y"'>
		               and  a.CLNC_DX_CD != 'D9999999'
		             </if>
		               and  b.MDRP_NO   =   a.MDRP_NO
		<![CDATA[
		               and  b.MDCR_YMD  <  sysdate    /* 최종수진일이 미래일자가 되는 것 방지 2022.01.10 kChang */  
		]]> 
		               and  b.CNCL_DT is null
		             order
		                by  SORT_SQNC
		                 ,  b.MDCR_DT desc
		        ) x
		 where  rownum = 1
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntScinSno-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="ptntScinSno" column="PTNT_SCIN_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntScinSno (신규환자상병일련번호 조회) 
        Description :                                           신규환자상병일련번호 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntScinSno-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntScinSno"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntScinSno-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneNewPtntScinSno */
		        nvl(max(PTNT_SCIN_SNO),0) + 1 as PTNT_SCIN_SNO
		  from  MDPADIAGT
		 where  MDRP_NO          = #{mdrpNo}
		   and  PTNT_CLNC_DX_SNO = #{ptntClncDxSno}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneDummy-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="wodvCd" column="WODV_CD"/>
		<result property="gr52MesgSkipYn" column="GR52_MESG_SKIP_YN"/>
		<result property="mdcrGr52Yn" column="MDCR_GR52_YN"/>
		<result property="odmnDntrKeepAdexFrchNtm" column="ODMN_DNTR_KEEP_ADEX_FRCH_NTM"/>
		<result property="ppvlAplyCd" column="PPVL_APLY_CD"/>
		<result property="dtrtScinUpdtYn" column="DTRT_SCIN_UPDT_YN"/>
		<result property="vatTrgtYn" column="VAT_TRGT_YN"/>
		<result property="vatTrgtCdBefr" column="VAT_TRGT_CD_BEFR"/>
		<result property="vatTrgtCdMdfc" column="VAT_TRGT_CD_MDFC"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="clncDxOnlyYn" column="CLNC_DX_ONLY_YN"/>
		<result property="tojrScinDltnYn" column="TOJR_SCIN_DLTN_YN"/>
		<result property="tojrScinExclYn" column="TOJR_SCIN_EXCL_YN"/>
		<result property="mdcrYn" column="MDCR_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneDummy (selectOneDummy) 
        Description :                                           selectOneDummy
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneDummy-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneDummy"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneDummy-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneDummy */
		select  'I'         as WODV_CD
		     ,  'S'         as GR52_MESG_SKIP_YN                -- 진료비 차등적용 52개 질환 메세지 SKIP 여부
		     ,  'Y'         as MDCR_GR52_YN                     -- 진료비 차등적용 52개 질환 여부
		     ,  10          as ODMN_DNTR_KEEP_ADEX_FRCH_NTM     -- 노인틀니유지관리비무상횟수
		     ,  'AB'        as PPVL_APLY_CD                     -- 적정성 평가대상 코드
		     ,  'Y'         as DTRT_SCIN_UPDT_YN                -- 전과전실 상병 수정여부
		     ,  'Y'         as VAT_TRGT_YN                      -- 부가세대상여부
		     ,  'Y'         as VAT_TRGT_CD_BEFR                 -- 부가세대상코드 (이전)
		     ,  'Y'         as VAT_TRGT_CD_MDFC                 -- 부가세대상코드 (변경)
		     ,  '29991231'  as ORDR_YMD                         -- 처방일자
		     ,  'Y'         as CLNC_DX_ONLY_YN                  -- 임상진단ONLY여부
		     ,  ''          as TOJR_SCIN_DLTN_YN                -- 이관상병삭제여부
		     ,  ''          as TOJR_SCIN_EXCL_YN                -- 이관상병제외여부 
		     ,  ''          as MDCR_YN                          -- 진료완료여부
		  from  dual
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updateAdmsExtnClamYn (입원연장청구서 작성여부 수정) 
        Description :                                           입원연장청구서 작성여부 수정
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updateAdmsExtnClamYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updateAdmsExtnClamYn */
		update APRCADBLT
		   set ADMS_EXTN_CLAM_YN= #{admsExtnClamYn}
			 , LAST_UPDR_ID       = #{gvUserId}          /*  최종수정자ID                  */
			 , LAST_UPDT_IP       = #{gvUserIp}          /*  최종수정IP                    */
			 , LAST_UPDT_DT       = sysdate              /*  최종수정일시                     */
			 , LAST_UPDT_CLNT_PRGM_ID  = #{gvClntPrgmId}                               /*  최종수정SMC클라이언트프로그램ID */
			 , LAST_UPDT_SRVR_PRGM_ID  = #{gvSrvrPrgmId}                               /*  최종수정SMC서버프로그램ID     */
		 where MDRP_NO = #{mdrpNo}
	</update>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreTrgtScinYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="orreYn" column="ORRE_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreTrgtScinYn (일반식 예외사유입력대상 상병여부) 
        Description :                                           일반식 예외사유입력대상 상병여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreTrgtScinYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreTrgtScinYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreTrgtScinYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreTrgtScinYn */
		select decode(count(*),0,'N','Y') as ORRE_YN 
		  from MDPADIAGT a -- 환자상병내역
		     , MZCTRLMMT b -- 진료제어정보
		 where MDRP_NO        = #{mdrpNo}
		   and b.MDCR_CTRL_CD = 'MDP_952'
		   and a.SCIN_CD      = b.MDCR_DTLS_CTRL_CD
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreInptTrgtYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="orreYn" column="ORRE_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreInptTrgtYn (일반식 예외사유 입력대상 여부 조회) 
        Description :                                           일반식 예외사유 입력대상 여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreInptTrgtYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreInptTrgtYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreInptTrgtYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneGndiExreInptTrgtYn */
		select  decode(count(a.ptno),0,'Y','N') ORRE_YN
		  from  MDBASORDT a /* 기본처방 */
		     ,  SUORDRDTT b /* 일반식식사처방 */
		 where  a.PTNO = b.PTNO
		   and  a.ORDR_YMD = b.ORDR_YMD
		   and  a.ORDR_SNO = b.ORDR_SNO
		   and  a.DC_DVSN_CD = 'N'
		   and  a.MDRP_NO = #{mdrpNo}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneBsisOrdrYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="orreYn" column="ORRE_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneBsisOrdrYn (기본처방여부 조회) 
        Description :                                           기본처방여부 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneBsisOrdrYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneBsisOrdrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneBsisOrdrYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneBsisOrdrYn */
		select decode(count(*),0,'N','Y') as ORRE_YN
		  from SUDIECDCT
		 where TEDI_YN = 'N'
		   and TBFD_YN = 'N'
		   and PRML_YN = 'N'
		   and WSDI_YN = 'N'
		   and NPO_YN = 'N' 
		   and PRPD_DIET_YN = 'N'
		   and DIET_CD not in ('W41B00', 'W42B00', 'W43000')
		   and DIET_CD = #{dietCd}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listDltnTrgtTojrScin-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ptntClncDxSno" column="PTNT_CLNC_DX_SNO"/>
		<result property="clncDxCd" column="CLNC_DX_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listDltnTrgtTojrScin (삭제대상 이행진단List 조회) 
        Description :                                           삭제대상 이행진단List 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listDltnTrgtTojrScin-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listDltnTrgtTojrScin"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listDltnTrgtTojrScin-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-listDltnTrgtTojrScin */
		select MDRP_NO
		     , PTNT_CLNC_DX_SNO 
		     , CLNC_DX_CD
		  from MDPACLNCT /* 환자임상진단내역 */
		 where MDRP_NO = #{mdrpNo}
		   and CLNC_DX_CD = 'D9999999'
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updateRealMddrId (일반의 접수내역, 실진료의 정보 갱신) 
        Description :                                           일반의 접수내역, 실진료의 정보 갱신
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updateRealMddrId"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  >
		<![CDATA[ 
		update /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-updateRealMddrId */
		       APRCRPTNT x
		   set REAL_MDDR_ID = #{chdrId}
		 where PTNO         = #{ptno}
		   and MDRP_NO      = #{mdrpNo}
		   and MDCR_YMD     = to_date(#{mdcrYmd},'yyyymmdd')
		   and not exists (
		                    select 'Y'
		                      from CCUSRDPHT b /* NEXMED-EHR 사용자 역할정보 */
		                         , CCUSERAMT c /* NEXMED-EHR 사용자 */
		                     where b.USER_ID = x.MDDR_ID
		                       and c.LGIN_ID = b.LGIN_ID 
		                       and c.OCFM_CD ='HAA'
		                       and c.USER_LCNS_NO is not null
		                       and rownum = 1)
		   and exists (
		               select 'Y'
		                 from CCUSRDPHT b /* NEXMED-EHR 사용자 역할정보 */
		                    , CCUSERAMT c /* NEXMED-EHR 사용자 */
		                where b.USER_ID = #{chdrId}
		                  and c.LGIN_ID = b.LGIN_ID
		                  and c.OCFM_CD ='HAA'
		                  and c.USER_LCNS_NO is not null
		                  and rownum = 1)
		]]> 
	</update>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneOrdrExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="ordrExstYn" column="ORDR_EXST_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneOrdrExstYn (해당 환자의 수진에 D/C되지 않은 외래 처방이 존재하는지 여부를 체크한다.) 
        Description :                                           해당 환자의 수진에 D/C되지 않은 외래 처방이 존재하는지 여부를 체크한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneOrdrExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneOrdrExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneOrdrExstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneOrdrExstYn */
		select case when count(PTNO) > 0 
		            then 'Y' 
		            else 'N' 
		        end as ORDR_EXST_YN
		  from (select PTNO
		          from MDBASORDT /* 기본처방 */
		         where PTNO = #{ptno}
		           and MDRP_NO = #{mdrpNo}
		           and CODV_CD = 'O'
		           and DC_DVSN_CD in ('N', 'Y')
		           and rownum = 1
		         union all   
		        select PTNO
		          from MDMEDORDT /* 약처방 */
		         where PTNO = #{ptno}
		           and MDRP_NO = #{mdrpNo}
		           and CODV_CD = 'O'
		           and DC_DVSN_CD in ('N', 'Y')
		           and rownum = 1
		         union all
		        select PTNO
		          from MDEXMORDT /* 검사처방 */
		         where PTNO = #{ptno}
		           and MDRP_NO = #{mdrpNo}
		           and CODV_CD = 'O'
		           and DC_DVSN_CD in ('N', 'Y')
		           and rownum = 1
		         union all
		        select PTNO
		          from MDTRTORDT /* 처방료처방 */
		         where PTNO = #{ptno}
		           and MDRP_NO = #{mdrpNo}
		           and CODV_CD = 'O'
		           and DC_DVSN_CD in ('N', 'Y')
		           and rownum = 1
		         union all
		        select PTNO
		          from MDBLDORDT /* 수혈처방 */
		         where PTNO = #{ptno}
		           and MDRP_NO = #{mdrpNo}
		           and CODV_CD = 'O'
		           and DC_DVSN_CD in ('N', 'Y')
		           and rownum = 1
		         union all
		        select PTNO
		          from MDREHORDT /* 재활처방 */
		         where PTNO = #{ptno}
		           and MDRP_NO = #{mdrpNo}
		           and CODV_CD = 'O'
		           and DC_DVSN_CD in ('N', 'Y')
		           and rownum = 1
		      )
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneScinExstYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="scinYn" column="SCIN_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneScinExstYn (환자 수진의 상병 존재 여부를 조회한다.) 
        Description :                                           환자 수진의 상병 존재 여부를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneScinExstYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneScinExstYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneScinExstYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneScinExstYn */
		select decode(count(1), 1, 'Y', 'N') as SCIN_YN
		  from MDPADIAGT
		 where MDRP_NO = #{mdrpNo}
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMdcrFinsYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO">
	
		<result property="mdcrFinsYn" column="MDCR_FINS_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMdcrFinsYn (진료완료 여부가 업데이트 되었는지를 확인한다.) 
        Description :                                           진료완료 여부가 업데이트 되었는지를 확인한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMdcrFinsYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMdcrFinsYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpPtntClncDxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMdcrFinsYn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntClncDxMngmDAO-selectOneMdcrFinsYn */
		select nvl(MDCR_YN, 'N') as MDCR_FINS_YN
		  from APRCRPTNT
		 where MDRP_NO = #{mdrpNo}
	</select>



</mapper>