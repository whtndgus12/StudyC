<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_MdpOrdrDrugMngmDAO_sql.xml 
    Description : -->
<mapper namespace="MdpOrdrDrugMngmDAO">


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneOrdrDrugMngmDual-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="antcMdteStrtYmd" column="ANTC_MDTE_STRT_YMD"/>
		<result property="afiAnagAprvRefrNeedYn" column="AFI_ANAG_APRV_REFR_NEED_YN"/>
		<result property="afiKclDrusLmttTrgtYn" column="AFI_KCL_DRUS_LMTT_TRGT_YN"/>
		<result property="frstIpdvCd" column="FRST_IPDV_CD"/>
		<result property="phrkExmnCd" column="PHRK_EXMN_CD"/>
		<result property="antcOrnoRmrkCtn" column="ANTC_ORNO_RMRK_CTN"/>
		<result property="admsInptNotcLmttDdcn" column="ADMS_INPT_NOTC_LMTT_DDCN"/>
		<result property="afiCrtfOrdvVl" column="AFI_CRTF_ORDV_VL"/>
		<result property="afiRulIdVl" column="AFI_RUL_ID_VL"/>
		<result property="afiRulRspnVl" column="AFI_RUL_RSPN_VL"/>
		<result property="afiRdctInfmCnfrYn" column="AFI_RDCT_INFM_CNFR_YN"/>
		<result property="afiTmprOrdrSno" column="AFI_TMPR_ORDR_SNO"/>
		<result property="orlmVlm" column="ORLM_VLM"/>
		<result property="afiOrglOrdrDcDvsnCd" column="AFI_ORGL_ORDR_DC_DVSN_CD"/>
		<result property="mdprIdntRefrYmd" column="MDPR_IDNT_REFR_YMD"/>
		<result property="mdprIdntOrdrSno" column="MDPR_IDNT_ORDR_SNO"/>
		<result property="acgrCd" column="ACGR_CD"/>
		<result property="injcPrrnYmd1" column="INJC_PRRN_YMD_1"/>
		<result property="inptVl" column="INPT_VL"/>
		<result property="injtSterCmmdYn" column="INJT_STER_CMMD_YN"/>
		<result property="durvPwdrDslwYn" column="DURV_PWDR_DSLW_YN"/>
		<result property="civVlm" column="CIV_VLM"/>
		<result property="civTrgtYn" column="CIV_TRGT_YN"/>
		<result property="rpmdId" column="RPMD_ID"/>
		<result property="ingrId" column="INGR_ID"/>
		<result property="hgrsMdprYn" column="HGRS_MDPR_YN"/>
		<result property="hgrsMdprResnCd" column="HGRS_MDPR_RESN_CD"/>
		<result property="hgccMdprYn" column="HGCC_MDPR_YN"/>
		<result property="hgccMdprResnCd" column="HGCC_MDPR_RESN_CD"/>
		<result property="chldPcunIcqyVl" column="CHLD_PCUN_ICQY_VL"/>
		<result property="chldIcunCd" column="CHLD_ICUN_CD"/>
		<result property="totlQtyClclYn" column="TOTL_QTY_CLCL_YN"/>
		<result property="icqyCnvsVl" column="ICQY_CNVS_VL"/>
		<result property="cqy" column="CQY"/>
		<result property="useBgnnYmd" column="USE_BGNN_YMD"/>
		<result property="diusYmd" column="DIUS_YMD"/>
		<result property="pwdijYn" column="PWDIJ_YN"/>
		<result property="aplcDprtCd" column="APLC_DPRT_CD"/>
		<result property="cyclOrdrYn" column="CYCL_ORDR_YN"/>
		<result property="cyclOrdrDdcn" column="CYCL_ORDR_DDCN"/>
		<result property="tkmdCatnLablCd" column="TKMD_CATN_LABL_CD"/>
		<result property="rcmnDrusUseYn" column="RCMN_DRUS_USE_YN"/>
		<result property="vlmInptLmttCd" column="VLM_INPT_LMTT_CD"/>
		<result property="mdprClsfDetlCd" column="MDPR_CLSF_DETL_CD"/>
		<result property="rareMdprYn" column="RARE_MDPR_YN"/>
		<result property="acdgRprsPdctNm" column="ACDG_RPRS_PDCT_NM"/>
		<result property="orreExstYn" column="ORRE_EXST_YN"/>
		<result property="dcRqstYn" column="DC_RQST_YN"/>
		<result property="afiBsisSdpfExreCd" column="AFI_BSIS_SDPF_EXRE_CD"/>
		<result property="ordrInrfClotYn" column="ORDR_INRF_CLOT_YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneOrdrDrugMngmDual (DVO Parameter를 유지하기 위한 DUAL SELECT) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneOrdrDrugMngmDual-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneOrdrDrugMngmDual"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneOrdrDrugMngmDual-result" useCache="true" flushCache="false">
		SELECT  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneOrdrDrugMngmDual */
		       '' as ANTC_MDTE_STRT_YMD
		     , '' as AFI_ANAG_APRV_REFR_NEED_YN
		     , '' as AFI_KCL_DRUS_LMTT_TRGT_YN
		     , '' as FRST_IPDV_CD
		     , '' as PHRK_EXMN_CD
		     , '' as ANTC_ORNO_RMRK_CTN
		     , 0 as ADMS_INPT_NOTC_LMTT_DDCN
		     , '' as AFI_CRTF_ORDV_VL
		     , '' as AFI_RUL_ID_VL
		     , '' as AFI_RUL_RSPN_VL
		     , '' as AFI_RDCT_INFM_CNFR_YN
		     , 0 as AFI_TMPR_ORDR_SNO
		     , 0 as ORLM_VLM
		     , '' as AFI_ORGL_ORDR_DC_DVSN_CD
		     , '' as MDPR_IDNT_REFR_YMD
		     , 0 as MDPR_IDNT_ORDR_SNO
		     , '' as ACGR_CD
		     , '' as INJC_PRRN_YMD_1
		     , '' as INPT_VL
			 ,'' as INJT_STER_CMMD_YN			/* 주사제무균조제여부			*/
			 ,'' as DURV_PWDR_DSLW_YN			/* DUR산제불가여부			*/
			 ,'' as CIV_VLM					/* CIV용량				*/
			 ,'' as CIV_TRGT_YN				/* CIV대상여부				*/
			 ,'' as RPMD_ID					/* 대표약품ID				*/
			 ,'' as INGR_ID					/* 성분ID					*/
			 ,'' as HGRS_MDPR_YN				/* 고위험약품여부				*/
			 ,'' as HGRS_MDPR_RESN_CD			/* 고위험약품사유코드(SDB_009)	*/
			 ,'' as HGCC_MDPR_YN				/* 고주의약품여부				*/
			 ,'' as HGCC_MDPR_RESN_CD			/* 고주의약품사유코드(SDB_007)	*/
			 ,'' as CHLD_PCUN_ICQY_VL			/* 소아포장단위함량값			*/
			 ,'' as CHLD_ICUN_CD				/* 소아함량단위코드			*/
			 ,'' as TOTL_QTY_CLCL_YN			/* 계산여부				*/
			 ,'' as ICQY_CNVS_VL				/* 함량환산값				*/
			 ,'' as CQY						/* 수량					*/
			 ,'' as USE_BGNN_YMD				/* 사용개시일자				*/
			 ,'' as DIUS_YMD					/* 불용일자				*/
			 ,'' as PWDIJ_YN					/* 분말주사제여부(powder)		*/
			 ,'' as APLC_DPRT_CD				/* 신청부서코드				*/
			 ,'' as CYCL_ORDR_YN				/* 주기처방여부				*/
			 ,'' as CYCL_ORDR_DDCN				/* 주기처방일수(SDA_034)		*/
			 ,'' as TKMD_CATN_LABL_CD			/* 복약주의라벨코드(SDA_009)	*/
			 ,'' as RCMN_DRUS_USE_YN			/* 추천용법만사용여부			*/
			 ,'' as VLM_INPT_LMTT_CD			/* 용량입력제한코드			*/
			 ,'' as MDPR_CLSF_DETL_CD			/* 약품분류상세코드			*/
			 ,'' as RARE_MDPR_YN				/* 희귀약품여부				*/
			 ,'' as ACDG_RPRS_PDCT_NM			/* 항암제대표상품명			*/  
		     ,'' as ORRE_EXST_YN	/* 처방사유존재여부 */
		     ,'' as DC_RQST_YN     /* DC요청여부 */
		     ,'' as AFI_BSIS_SDPF_EXRE_CD /* 기본의약분업예외사유코드 */
		     ,'' as ORDR_INRF_CLOT_YN
		from dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrSno-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="ordrSno" column="ORDR_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrSno (약주사처방 Sequence 조회) 
        Description :                                           약주사처방 처방일련번호에 사용되는 sequence를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrSno-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrSno"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrSno-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrSno */
		          MDMEDORDTQ.nextval as ORDR_SNO
		 from  dual
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstDrugBefOrdrYmd-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstDrugBefOrdrYmd (최근 약 전처방 일자 조회) 
        Description :                                           최근 약 전처방 일자를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstDrugBefOrdrYmd-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstDrugBefOrdrYmd"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstDrugBefOrdrYmd-result" useCache="true" flushCache="false">
		<![CDATA[	 
				   SELECT  /*+ index_desc(a MDMEDORDT_I20) SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstDrugBefOrdrYmd_최근_약주사_전처방_일자조회 */
						   to_char(ORDR_YMD, 'yyyymmdd') as ORDR_YMD
					 from 
						   (
						   select a.PTNO
								, a.ORDR_YMD 
								, a.MDRP_NO
		                        , a.ORDR_CD
								, a.OROC_DPRT_CD
								, a.MCDP_CD
		                        , a.CHDR_ID
								, a.CODV_CD
								, a.ODKI_CD
								, a.ORCL_CD
								, a.DC_DVSN_CD
								, a.PAST_CYCL_INFM_CTN
								, a.CYCL_ORDR_STRT_YMD
								, a.ORDR_CRTN_DVSN_CD
								, a.INPT_USER_DVSN_CD
							 from (
								   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntOrdrInqrDAO-selectOnePtntLtstDrugBefOrdrYmd */  /*+ INDEX_DESC(A, MDMEDORDT_I20) */
										  a.PTNO
										, a.ORDR_YMD
										, a.MDRP_NO
		                                , a.ORDR_CD
										, a.OROC_DPRT_CD
										, a.MCDP_CD
		                                , a.CHDR_ID
										, a.CODV_CD
										, a.ODKI_CD
										, a.ORCL_CD
										, a.DC_DVSN_CD
										, a.PAST_CYCL_INFM_CTN
										, a.CYCL_ORDR_STRT_YMD
										, a.ORDR_CRTN_DVSN_CD
										, a.INPT_USER_DVSN_CD
									 from MDMEDORDT a
									where #{mdrpNo} = 0
									order by ORDR_YMD desc
								  ) a
							union all
						   select a.PTNO
								, a.ORDR_YMD
								, a.MDRP_NO
		                        , a.ORDR_CD
								, a.OROC_DPRT_CD
								, a.MCDP_CD
		                        , a.CHDR_ID
								, a.CODV_CD
								, a.ODKI_CD
								, a.ORCL_CD
								, a.DC_DVSN_CD
								, a.PAST_CYCL_INFM_CTN
								, a.CYCL_ORDR_STRT_YMD
								, a.ORDR_CRTN_DVSN_CD
								, a.INPT_USER_DVSN_CD
							 from (
								   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpPtntOrdrInqrDAO-selectOnePtntLtstDrugBefOrdrYmd */  /*+ INDEX_DESC(A, MDMEDORDT_I02) */
										  a.PTNO
										, a.ORDR_YMD
										, a.MDRP_NO
		                                , a.ORDR_CD
										, a.OROC_DPRT_CD
										, a.MCDP_CD
		                                , a.CHDR_ID
										, a.CODV_CD
										, a.ODKI_CD
										, a.ORCL_CD
										, a.DC_DVSN_CD
										, a.PAST_CYCL_INFM_CTN
										, a.CYCL_ORDR_STRT_YMD
										, a.ORDR_CRTN_DVSN_CD
										, a.INPT_USER_DVSN_CD
									 from MDMEDORDT a
									where #{mdrpNo} > 0
									  and  MDRP_NO = #{mdrpNo}
									order by ORDR_YMD desc
								  ) a
						   ) a
					where  a.PTNO        = #{ptno}
					  and  a.ORDR_YMD    <= to_date(#{ordrYmd}, 'yyyymmdd')
		             ]]>
		 		     <if test='mdrpNo != 0'>
		             and  a.MDRP_NO = #{mdrpNo}
		  		     </if>    	   
			 		 <if test='orocDprtCd != null and orocDprtCd != ""'>
		             and  a.OROC_DPRT_CD = #{orocDprtCd}
			  		 </if>    
		             <if test='chdrId != null and chdrId != ""'>
		             and  a.CHDR_ID = #{chdrId}
		             </if>
		             <if test='mcdpCd != null and mcdpCd != ""'>
		             and  a.MCDP_CD = #{mcdpCd}
		             </if>
			         <![CDATA[	 
					  and  nvl(a.CODV_CD, '*') like #{codvCd}||'%'
					  and  nvl(a.ODKI_CD, '*') like #{odkiCd}||'%'
					  and  ((a.ORCL_CD is null)
							 or ((a.ORCL_CD is not null) and (a.ORCL_CD <> 'NTR')))       /*  간호처치 교육처방 제외(처방코드마스터에 없는것) */
					  and  a.DC_DVSN_CD  = 'N'
					  and  nvl( a.ORDR_CRTN_DVSN_CD, 'X' ) not in ( '08' , '10' , '11', '93' ) /*  PRN실시처방 , 응급실1차실시처방 , 1회추가실시처방 , 의사투약1회추가*/
					  and  nvl( INPT_USER_DVSN_CD, 'X' ) != 'V'
		              and  not exists (select  1
		                                 from  MDMEDORDT Sa
		                                where  Sa.MDRP_NO = a.MDRP_NO
		                                  and  Sa.ODKI_CD = a.ODKI_CD
		                                  and  Sa.ORDR_CD = a.ORDR_CD
		                                  and  Sa.DC_DVSN_CD = 'N'
		                                  and  ((Sa.CYCL_ORDV_CD = '1' and Sa.CYCL_ORDR_DYWK_CTN <> 'NNNNNNN') or
		                                        (Sa.CYCL_ORDV_CD = '2' and Sa.CYCL_ORDR_DDCN > 0) 
		                                       )
		                                  and  Sa.CYCL_ORDR_STRT_YMD <= to_date(#{ordrYmd}, 'yyyymmdd')
		                                  and  Sa.CYCL_ORDR_FNSH_YMD >= to_date(#{ordrYmd}, 'yyyymmdd'))    /* 약처방 자동복사시 현재 주기처방으로 유효한 처방코드는 복사되지 않도록 한다. */
					  and  rownum < 2
					]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstGnotSlotDrugBefOrdr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstGnotSlotDrugBefOrdr (최근 외출외박 약 전처방 일자 조회) 
        Description :                                           최근 외출외박 약 전처방 일자를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstGnotSlotDrugBefOrdr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstGnotSlotDrugBefOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstGnotSlotDrugBefOrdr-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOnePtntLtstGnotSlotDrugBefOrdr_외출외박환자_최근_처방일자_조회 */
				   to_char(max(a.ORDR_YMD), 'yyyymmdd') as ORDR_YMD
			 from  MDMEDORDT a
			where  a.PTNO      = #{ptno}
			  and  a.ORDR_YMD  >=  ( select  trunc(max(o.GNOT_PRRN_DT)) /* 외출예정일시 */
									  from  MDPAGNOTT o  /* 환자외출외박 */
									 where  o.PTNO    = a.PTNO
									   and  o.MDRP_NO = a.MDRP_NO
									   and  o.REAL_GNOT_DT is not null
									   and  o.REAL_RVRS_DT is null )
			  and  a.MDRP_NO = #{mdrpNo}
			  and  a.ODKI_CD = 'S'  /*  외출외박 */
			  and  a.CODV_CD = 'I'
			  and  a.MCDP_CD = #{mcdpCd}
			  and  a.DC_DVSN_CD  = 'N'
			  and  nvl( ORDR_CRTN_DVSN_CD, 'X' ) not in ( '08' , '10' , '11' ,'93') /*  PRN실시처방 , 응급실1차실시처방 , 1회추가실시처방 , 의사1회추가처방 */
			   /*  부서코드가 "IMZ"인경우 모든내과 "IM"을 모두 가져옴 */
			   and  (  (
					   #{mcdpCd} = '200932'
					   and
					   nvl(a.MCDP_CD, '*') in ('111100', '111200', '111300', '111400', '111500', '111600', '111700', '111800', '111900', '200932')
					   )
					   or
					   (
					   #{mcdpCd} is null
					   )
					   or
					   (
					   #{mcdpCd} is not null
					   and
					   nvl(a.MCDP_CD, '*') = #{mcdpCd}
					   )
					)
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugImplOrdrPblcLYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="afiImplOrdrPblcPsblVl" column="AFI_IMPL_ORDR_PBLC_PSBL_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugImplOrdrPblcLYn (약 실시처방 발행 제한 횟수 조회) 
        Description :                                           약 실시처방 발행 제한 횟수를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugImplOrdrPblcLYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugImplOrdrPblcLYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugImplOrdrPblcLYn-result" useCache="true" flushCache="false">
		 select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugImplOrdrPblcLYn */
		          case when ( IMPL_ORDR_PBLC_LMTT_NTM - nvl(IMPL_ORDR_PBLC_NTM,0) - #{ntm} ) &gt;= 0 then 'Y' else 'N'end as AFI_IMPL_ORDR_PBLC_PSBL_VL
		  from  MDMEDORDT
		where  PTNO = #{ptno}
		   and  ORDR_YMD = to_date ( #{orglOrdrYmd}, 'YYYYMMDD' )
		   and  ORDR_SNO = #{orglOrdrSno}
		   and  ORFR_CD  = case when #{ordrCrtnDvsnCd} = '08' then 'P'
										   when #{ordrCrtnDvsnCd} = '10' then 'F'
										   else ORFR_CD END
		   and  DC_DVSN_CD = 'N'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneWardPtntFrnsCtrlYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneWardPtntFrnsCtrlYn (병동환자 불출제어 여부 조회) 
        Description :                                           처방내림시 병동환자 불출제어 대상 처방인경우 처방전날, 당일 해당처방이 발행됐는지 조회하여 이미 있으면 N(불출이
                                                                필요없음)으로 Return 한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneWardPtntFrnsCtrlYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneWardPtntFrnsCtrlYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneWardPtntFrnsCtrlYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneWardPtntFrnsCtrlYn */
		select case when count (PTNO) <> 0 then 'N' else 'Y'end as YN /*  값이 있으면 N ( 불출이 필요없음 ) 으로 처리 */
		  from MDMEDORDT a
		 where a.PTNO = #{ptno}
		   and a.MDRP_NO = #{mdrpNo}
		   and nvl(a.DC_DVSN_CD,'N') = 'N'
		   and nvl(a.ORFR_CD,'X')   not in ( 'P', 'S') /* 지참약은 제외하도록 추가 2020.03.07 obh */
		   and a.ODKI_CD            != 'D'  /*  퇴원 처방 무시 */
		   and a.TMPR_ORDR_YN        = 'N'  /*  임시처방여부 N */
		   and a.ORDR_CD = #{ordrCd}
		   and a.CODV_CD = #{codvCd}
		   and a.FRNS_DPRT_CD not in (select MDCR_DTLS_CTRL_CD
		                                from MZCTRLMMT
		                               where MDCR_CTRL_CD = 'MDP_107'
		                                 and trunc(sysdate) between APST_YMD and APFN_YMD)
		   and rownum = 1
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrFrnsCtrlInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="totlVlm" column="TOTL_VLM"/>
		<result property="frnsCqy" column="FRNS_CQY"/>
		<result property="afiFrnsCtrlExcsQty" column="AFI_FRNS_CTRL_EXCS_QTY"/>
		<result property="afiFrnsCtrlTims1ExcsQty" column="AFI_FRNS_CTRL_TIMS1_EXCS_QTY"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrFrnsCtrlInfm (처방 PI 불출제어 정보 조회) 
        Description :                                           불출제어 대상 약처방내림시 불출제어 정보를 조회하여 유효성을 체크한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrFrnsCtrlInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrFrnsCtrlInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrFrnsCtrlInfm-result" useCache="true" flushCache="false">
		<![CDATA[
		 select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDrugOrdrFrnsCtrlInfm */
		           FN_SD_GETTOTQTY_S( round(#{pcknUnadQty},5),
		                                 #{ntm},
		                                 #{ddcn},
		                                 decode(nvl(c.OTPT_PHRM_INJT_YN,'N'),'Y','3',c.DRAP_DVSN_CD),
		                                 a.TOTL_QTY_CLCL_CD,
		                                 #{frnsCtrlDvsnCd} ) TOTL_VLM                                         /*  총량 */
		        ,  b.RELS_MNMM_QTY * ceil( FN_SD_GETTOTIVQTY_S( round(#{pcknUnadQty},5),
		                                               #{ntm},
		                                               #{ddcn},
		                                               decode(nvl(c.OTPT_PHRM_INJT_YN,'N'),'Y','3',c.DRAP_DVSN_CD),
		                                               a.TOTL_QTY_CLCL_CD,
		                                               #{frnsCtrlDvsnCd} ) / b.RELS_MNMM_QTY ) as "FRNS_CQY"  /*  불출량 */
		       ,  sign ( FN_SD_GETTOTIVQTY_S ( round(#{pcknUnadQty},5),
		                                    #{ntm},
		                                    #{ddcn},
		                                    decode(nvl(c.OTPT_PHRM_INJT_YN,'N'),'Y','3',c.DRAP_DVSN_CD),
		                                    a.TOTL_QTY_CLCL_CD,
		                                    #{frnsCtrlDvsnCd} ) - b.RELS_MNMM_QTY ) as AFI_FRNS_CTRL_EXCS_QTY /*  불출제어초과량 */
		       ,  sign ( b.RELS_MNMM_QTY - round(#{pcknUnadQty},5) ) as AFI_FRNS_CTRL_TIMS1_EXCS_QTY             /*  불출제어1회초과량 */
		 from  MDORDRCMT a
		       ,  SDJORDRCT b
		       ,  SDDDGCDMT c
		where  a.ORDR_CD = #{ordrCd}
		   and  a.ORDR_CD = b.MDPR_CD
		   and  a.ORDR_CD = c.MDPR_CD
		   and  to_date( #{ordrYmd}, 'yyyymmdd') >= b.APST_YMD
		   and  to_date( #{ordrYmd}, 'yyyymmdd') <= b.APFN_YMD
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneAcdgOrnoInfmEn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneAcdgOrnoInfmEn (처방일 기준 처방별 항암제차수 정보 유무 조회) 
        Description :                                           처방내림시 처방항암차수 정보가 있는 경우 처방일 기준 처방별 항암제차수 정보 유무 정보를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneAcdgOrnoInfmEn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneAcdgOrnoInfmEn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneAcdgOrnoInfmEn-result" useCache="true" flushCache="false">
		 select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneAcdgOrnoInfmEn */
		           case  when count ( PTNO ) &gt; 0 then 'Y' else 'N'end as YN
		  from  MDCHEMOCT
		where
		           PTNO = #{ptno}
		   and  ORDR_YMD = to_date( #{ordrYmd}, 'yyyymmdd' )
		   and  ORDR_CD = #{ordrCd}
		   and  DRAP_MDCF_CD = 'DG1'
		   and  ORDR_SNO = 0
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntDrugOrdrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="saveDvsnCd" column="SAVE_DVSN_CD"/>
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="gndrId" column="GNDR_ID"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="ptadCodvCd" column="PTAD_CODV_CD"/>
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="orfrCd" column="ORFR_CD"/>
		<result property="hslcDvsnCd" column="HSLC_DVSN_CD"/>
		<result property="mccnCd" column="MCCN_CD"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="orocDprtCd" column="OROC_DPRT_CD"/>
		<result property="frnsDprtCd" column="FRNS_DPRT_CD"/>
		<result property="slipCd" column="SLIP_CD"/>
		<result property="careSttsCd" column="CARE_STTS_CD"/>
		<result property="rtrnSttsCd" column="RTRN_STTS_CD"/>
		<result property="rtrnRqstDt" column="RTRN_RQST_DT"/>
		<result property="rtrnRqprId" column="RTRN_RQPR_ID"/>
		<result property="ordrHoldDvsnCd" column="ORDR_HOLD_DVSN_CD"/>
		<result property="ordrHoldRgstDt" column="ORDR_HOLD_RGST_DT"/>
		<result property="ordrHoldRgsrId" column="ORDR_HOLD_RGSR_ID"/>
		<result property="sympMnfsDegrCd" column="SYMP_MNFS_DEGR_CD"/>
		<result property="dgstAbnrRctnOrreCtn" column="DGST_ABNR_RCTN_ORRE_CTN"/>
		<result property="adtnOrdvCd" column="ADTN_ORDV_CD"/>
		<result property="rgorFndrId" column="RGOR_FNDR_ID"/>
		<result property="rgorFinsDt" column="RGOR_FINS_DT"/>
		<result property="orcnNursId" column="ORCN_NURS_ID"/>
		<result property="orcnDt" column="ORCN_DT"/>
		<result property="tmprOrdrYn" column="TMPR_ORDR_YN"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
		<result property="dcOddrId" column="DC_ODDR_ID"/>
		<result property="dcOrdrDt" column="DC_ORDR_DT"/>
		<result property="dcCnnuId" column="DC_CNNU_ID"/>
		<result property="dcCnfrDt" column="DC_CNFR_DT"/>
		<result property="sortSqnc" column="SORT_SQNC"/>
		<result property="drugOrdrUnslCtn" column="DRUG_ORDR_UNSL_CTN"/>
		<result property="inptUserDvsnCd" column="INPT_USER_DVSN_CD"/>
		<result property="crtfDvsnCd" column="CRTF_DVSN_CD"/>
		<result property="athnId" column="ATHN_ID"/>
		<result property="crtfIp" column="CRTF_IP"/>
		<result property="crtfDt" column="CRTF_DT"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="clrsPrjcDrId" column="CLRS_PRJC_DR_ID"/>
		<result property="subjIdntNo" column="SUBJ_IDNT_NO"/>
		<result property="subjIntiVl" column="SUBJ_INTI_VL"/>
		<result property="subjVistNm" column="SUBJ_VIST_NM"/>
		<result property="subjAdmnVl" column="SUBJ_ADMN_VL"/>
		<result property="clncExamMdprCtn" column="CLNC_EXAM_MDPR_CTN"/>
		<result property="oprtYmd" column="OPRT_YMD"/>
		<result property="oprtSno" column="OPRT_SNO"/>
		<result property="itrnBsdvCd" column="ITRN_BSDV_CD"/>
		<result property="srrqCmntCtn" column="SRRQ_CMNT_CTN"/>
		<result property="ordrIpdvCd" column="ORDR_IPDV_CD"/>
		<result property="ptadIpdvCd" column="PTAD_IPDV_CD"/>
		<result property="istyCd" column="ISTY_CD"/>
		<result property="istyAsstCd" column="ISTY_ASST_CD"/>
		<result property="cnplCd" column="CNPL_CD"/>
		<result property="ptadClamYmd" column="PTAD_CLAM_YMD"/>
		<result property="ptadClbaYmd" column="PTAD_CLBA_YMD"/>
		<result property="rcstCd" column="RCST_CD"/>
		<result property="rpntId" column="RPNT_ID"/>
		<result property="rcpcDt" column="RCPC_DT"/>
		<result property="viaAdmsRcstCd" column="VIA_ADMS_RCST_CD"/>
		<result property="opsrId" column="OPSR_ID"/>
		<result property="cpdrId" column="CPDR_ID"/>
		<result property="ptadPtgoCd" column="PTAD_PTGO_CD"/>
		<result property="implYmd" column="IMPL_YMD"/>
		<result property="abcEnfrYmd" column="ABC_ENFR_YMD"/>
		<result property="abcMcdpCd" column="ABC_MCDP_CD"/>
		<result property="abcEfdpCd" column="ABC_EFDP_CD"/>
		<result property="abcOddrId" column="ABC_ODDR_ID"/>
		<result property="vatTrgtYn" column="VAT_TRGT_YN"/>
		<result property="icuVsDsplYn" column="ICU_VS_DSPL_YN"/>
		<result property="durvYn" column="DURV_YN"/>
		<result property="durvOrtaNm" column="DURV_ORTA_NM"/>
		<result property="durvResnCtn" column="DURV_RESN_CTN"/>
		<result property="durvOrdrYmd" column="DURV_ORDR_YMD"/>
		<result property="durvOrdrCd" column="DURV_ORDR_CD"/>
		<result property="ediDplcResnCd" column="EDI_DPLC_RESN_CD"/>
		<result property="ediDplcResnCtn" column="EDI_DPLC_RESN_CTN"/>
		<result property="prtxRltnResnVl" column="PRTX_RLTN_RESN_VL"/>
		<result property="prtxRltnResnCtn" column="PRTX_RLTN_RESN_CTN"/>
		<result property="durvRtrnDdcn" column="DURV_RTRN_DDCN"/>
		<result property="mdprClsfCd" column="MDPR_CLSF_CD"/>
		<result property="drapDvsnCd" column="DRAP_DVSN_CD"/>
		<result property="mdtnNoDvsnCd" column="MDTN_NO_DVSN_CD"/>
		<result property="mdtnLcdvCd" column="MDTN_LCDV_CD"/>
		<result property="mdtnNo" column="MDTN_NO"/>
		<result property="ihohDvsnCd" column="IHOH_DVSN_CD"/>
		<result property="sdpfExreCd" column="SDPF_EXRE_CD"/>
		<result property="slctUnitDvsnCd" column="SLCT_UNIT_DVSN_CD"/>
		<result property="pcknUnadQty" column="PCKN_UNAD_QTY"/>
		<result property="pcunCd" column="PCUN_CD"/>
		<result property="icunAdmnVlm" column="ICUN_ADMN_VLM"/>
		<result property="icunCd" column="ICUN_CD"/>
		<result property="ntm" column="NTM"/>
		<result property="ddcn" column="DDCN"/>
		<result property="totlVlm" column="TOTL_VLM"/>
		<result property="mdtnVlunCd" column="MDTN_VLUN_CD"/>
		<result property="mdtnPrkgVlm" column="MDTN_PRKG_VLM"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="injcPrrnYmd" column="INJC_PRRN_YMD"/>
		<result property="mdtnStrtYmd" column="MDTN_STRT_YMD"/>
		<result property="mdtnFnshYmd" column="MDTN_FNSH_YMD"/>
		<result property="cnntOrdrBndlNo" column="CNNT_ORDR_BNDL_NO"/>
		<result property="drbnNo" column="DRBN_NO"/>
		<result property="sngnBndlYn" column="SNGN_BNDL_YN"/>
		<result property="mixKindCd" column="MIX_KIND_CD"/>
		<result property="astsYn" column="ASTS_YN"/>
		<result property="prvnInjcOrno" column="PRVN_INJC_ORNO"/>
		<result property="drugOrdrPrssCd" column="DRUG_ORDR_PRSS_CD"/>
		<result property="nrdrPrtxPrinNtm" column="NRDR_PRTX_PRIN_NTM"/>
		<result property="nrdrRtrnPrtxPrinNtm" column="NRDR_RTRN_PRTX_PRIN_NTM"/>
		<result property="phdpPrinYn" column="PHDP_PRIN_YN"/>
		<result property="sbsnUpdtCmmdYn" column="SBSN_UPDT_CMMD_YN"/>
		<result property="antcInjcAhedCmmdYn" column="ANTC_INJC_AHED_CMMD_YN"/>
		<result property="acdgMixDvsnCd" column="ACDG_MIX_DVSN_CD"/>
		<result property="actnNtm" column="ACTN_NTM"/>
		<result property="dsdrSdefCtn" column="DSDR_SDEF_CTN"/>
		<result property="dsdrSpabCtn" column="DSDR_SPAB_CTN"/>
		<result property="drrtDvsnCd" column="DRRT_DVSN_CD"/>
		<result property="drugRtreCd" column="DRUG_RTRE_CD"/>
		<result property="drrtCnnuId" column="DRRT_CNNU_ID"/>
		<result property="phrmRtrnQty" column="PHRM_RTRN_QTY"/>
		<result property="paclAftrDrrtQty" column="PACL_AFTR_DRRT_QTY"/>
		<result property="rtrnExreCtn" column="RTRN_EXRE_CTN"/>
		<result property="exreRtrnQty" column="EXRE_RTRN_QTY"/>
		<result property="exreRtprId" column="EXRE_RTPR_ID"/>
		<result property="exreRtrnDt" column="EXRE_RTRN_DT"/>
		<result property="antbGuidGrpVl" column="ANTB_GUID_GRP_VL"/>
		<result property="anclCd1" column="ANCL_CD_1"/>
		<result property="anclCd2" column="ANCL_CD_2"/>
		<result property="anclCd3" column="ANCL_CD_3"/>
		<result property="anclCd4" column="ANCL_CD_4"/>
		<result property="anclCd5" column="ANCL_CD_5"/>
		<result property="anagPathNm" column="ANAG_PATH_NM"/>
		<result property="phrmImplYmd" column="PHRM_IMPL_YMD"/>
		<result property="ordrValdStrtYmd" column="ORDR_VALD_STRT_YMD"/>
		<result property="ordrValdFnshYmd" column="ORDR_VALD_FNSH_YMD"/>
		<result property="implOrdrPblcNtm" column="IMPL_ORDR_PBLC_NTM"/>
		<result property="implOrdrPblcLmttNtm" column="IMPL_ORDR_PBLC_LMTT_NTM"/>
		<result property="orglOrdrYmd" column="ORGL_ORDR_YMD"/>
		<result property="orglOrdrSno" column="ORGL_ORDR_SNO"/>
		<result property="mdtnLablPrinNtm" column="MDTN_LABL_PRIN_NTM"/>
		<result property="mdfeAplyYmd" column="MDFE_APLY_YMD"/>
		<result property="hgcnKeepResnCd" column="HGCN_KEEP_RESN_CD"/>
		<result property="hgcnKeepEtreCtn" column="HGCN_KEEP_ETRE_CTN"/>
		<result property="ageTaboOrreCtn" column="AGE_TABO_ORRE_CTN"/>
		<result property="pgwmTaboOrreCtn" column="PGWM_TABO_ORRE_CTN"/>
		<result property="insrYr3InouDvsnCd" column="INSR_YR3_INOU_DVSN_CD"/>
		<result property="frnsYn" column="FRNS_YN"/>
		<result property="frnsVlm" column="FRNS_VLM"/>
		<result property="frnsCtrlDvsnCd" column="FRNS_CTRL_DVSN_CD"/>
		<result property="frnsRqprId" column="FRNS_RQPR_ID"/>
		<result property="frnsRqprTypeCd" column="FRNS_RQPR_TYPE_CD"/>
		<result property="frnsRqprIp" column="FRNS_RQPR_IP"/>
		<result property="frnsRqstDt" column="FRNS_RQST_DT"/>
		<result property="frnsRtrnCqy" column="FRNS_RTRN_CQY"/>
		<result property="erFrnsYn" column="ER_FRNS_YN"/>
		<result property="cyclOrdvCd" column="CYCL_ORDV_CD"/>
		<result property="cyclOrdrDywkCtn" column="CYCL_ORDR_DYWK_CTN"/>
		<result property="cyclOrdrDdcn" column="CYCL_ORDR_DDCN"/>
		<result property="cyclOrdrStrtYmd" column="CYCL_ORDR_STRT_YMD"/>
		<result property="cyclOrdrFnshYmd" column="CYCL_ORDR_FNSH_YMD"/>
		<result property="fludTotlQty" column="FLUD_TOTL_QTY"/>
		<result property="fludOverVl" column="FLUD_OVER_VL"/>
		<result property="fludCcHrVl" column="FLUD_CC_HR_VL"/>
		<result property="fludQHrVl" column="FLUD_Q_HR_VL"/>
		<result property="eqpmRgstDvsnCd" column="EQPM_RGST_DVSN_CD"/>
		<result property="rgstDvsnInptDt" column="RGST_DVSN_INPT_DT"/>
		<result property="pastCyclInfmCtn" column="PAST_CYCL_INFM_CTN"/>
		<result property="hyprPpvlResnCd" column="HYPR_PPVL_RESN_CD"/>
		<result property="hyprPpvlEtcNm" column="HYPR_PPVL_ETC_NM"/>
		<result property="pblcDvsnCd" column="PBLC_DVSN_CD"/>
		<result property="lqmdUseResnCd" column="LQMD_USE_RESN_CD"/>
		<result property="lqmdUseReetCtn" column="LQMD_USE_REET_CTN"/>
		<result property="psdgDrugLntrOrreCtn" column="PSDG_DRUG_LNTR_ORRE_CTN"/>
		<result property="psdgDrugIncsOrreCtn" column="PSDG_DRUG_INCS_ORRE_CTN"/>
		<result property="dspcNursAdjsNo" column="DSPC_NURS_ADJS_NO"/>
		<result property="chldPvicRegnYn" column="CHLD_PVIC_REGN_YN"/>
		<result property="antcOrnoNo" column="ANTC_ORNO_NO"/>
		<result property="acdgAdmnMi" column="ACDG_ADMN_MI"/>
		<result property="antcShetNo" column="ANTC_SHET_NO"/>
		<result property="rgmnCd" column="RGMN_CD"/>
		<result property="cmmdPrsrYn" column="CMMD_PRSR_YN"/>
		<result property="tprnOrdrYn" column="TPRN_ORDR_YN"/>
		<result property="cnmdRdexTrgtYn" column="CNMD_RDEX_TRGT_YN"/>
		<result property="oslfAdmnDrugYn" column="OSLF_ADMN_DRUG_YN"/>
		<result property="inhsFrstAdmnDgstYn" column="INHS_FRST_ADMN_DGST_YN"/>
		<result property="imlnOrdrYn" column="IMLN_ORDR_YN"/>
		<result property="mdprNonAplyYn" column="MDPR_NON_APLY_YN"/>
		<result property="sterCmmdImplYn" column="STER_CMMD_IMPL_YN"/>
		<result property="ordrCrtnDvsnCd" column="ORDR_CRTN_DVSN_CD"/>
		<result property="ordrCrtnLnknNo" column="ORDR_CRTN_LNKN_NO"/>
		<result property="sporBndlNm" column="SPOR_BNDL_NM"/>
		<result property="sporBndlNo" column="SPOR_BNDL_NO"/>
		<result property="pmdtInscYn" column="PMDT_INSC_YN"/>
		<result property="mixDfntDvsnCd" column="MIX_DFNT_DVSN_CD"/>
		<result property="mixDfntDt" column="MIX_DFNT_DT"/>
		<result property="frstRgsrId" column="FRST_RGSR_ID"/>
		<result property="frstRgstIp" column="FRST_RGST_IP"/>
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
		<result property="lastUpdrId" column="LAST_UPDR_ID"/>
		<result property="lastUpdtIp" column="LAST_UPDT_IP"/>
		<result property="lastUpdtDt" column="LAST_UPDT_DT"/>
		<result property="acmpYn" column="ACMP_YN"/>
		<result property="dgfrCd" column="DGFR_CD"/>
		<result property="fludOrdrYn" column="FLUD_ORDR_YN"/>
		<result property="kitMdprDdcn" column="KIT_MDPR_DDCN"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="ordrPsblDvsnCd" column="ORDR_PSBL_DVSN_CD"/>
		<result property="pcunInlsQty" column="PCUN_INLS_QTY"/>
		<result property="bsisIcunCd" column="BSIS_ICUN_CD"/>
		<result property="chldPcunIcqyVl" column="CHLD_PCUN_ICQY_VL"/>
		<result property="chldIcunCd" column="CHLD_ICUN_CD"/>
		<result property="tims1TotlQtyYn" column="TIMS1_TOTL_QTY_YN"/>
		<result property="insrIpdvCd" column="INSR_IPDV_CD"/>
		<result property="prtcIpdvCd" column="PRTC_IPDV_CD"/>
		<result property="incsIpdvCd" column="INCS_IPDV_CD"/>
		<result property="tainIpdvCd" column="TAIN_IPDV_CD"/>
		<result property="mdfeItdvCd" column="MDFE_ITDV_CD"/>
		<result property="mdprUicmTaboCd" column="MDPR_UICM_TABO_CD"/>
		<result property="insrEdiCd" column="INSR_EDI_CD"/>
		<result property="mdprIngrCd" column="MDPR_INGR_CD"/>
		<result property="cancPrgrStepVl" column="CANC_PRGR_STEP_VL"/>
		<result property="antcOrno" column="ANTC_ORNO"/>
		<result property="megrCd" column="MEGR_CD"/>
		<result property="antbYn" column="ANTB_YN"/>
		<result property="pwdrDslwYn" column="PWDR_DSLW_YN"/>
		<result property="dys1CeckQty" column="DYS1_CECK_QTY"/>
		<result property="sameDgfrMnmmInlsQty" column="SAME_DGFR_MNMM_INLS_QTY"/>
		<result property="sameDgfrMxmmInlsQty" column="SAME_DGFR_MXMM_INLS_QTY"/>
		<result property="ststDvsnCd" column="STST_DVSN_CD"/>
		<result property="clncExamDrugYn" column="CLNC_EXAM_DRUG_YN"/>
		<result property="mdprOrlmAgeDdcn" column="MDPR_ORLM_AGE_DDCN"/>
		<result property="prtnDlflYn" column="PRTN_DLFL_YN"/>
		<result property="ingrMnmmCd" column="INGR_MNMM_CD"/>
		<result property="afiPgwmTaboIngrNm" column="AFI_PGWM_TABO_INGR_NM"/>
		<result property="afiFdaClsfCtn" column="AFI_FDA_CLSF_CTN"/>
		<result property="afiKfdaClsfCtn" column="AFI_KFDA_CLSF_CTN"/>
		<result property="afiKfdaPrmsNnpyDgmtYn" column="AFI_KFDA_PRMS_NNPY_DGMT_YN"/>
		<result property="afiAntbClsfNm" column="AFI_ANTB_CLSF_NM"/>
		<result property="tkngInvlDdcn" column="TKNG_INVL_DDCN"/>
		<result property="afiOrdrPrtInsrCtn" column="AFI_ORDR_PRT_INSR_CTN"/>
		<result property="afiIhohPsblDvsnCd" column="AFI_IHOH_PSBL_DVSN_CD"/>
		<result property="antcThrpMngmDvsnCd" column="ANTC_THRP_MNGM_DVSN_CD"/>
		<result property="otptPhrmInjtYn" column="OTPT_PHRM_INJT_YN"/>
		<result property="rpmdId" column="RPMD_ID"/>
		<result property="ingrId" column="INGR_ID"/>
		<result property="totlQtyClclYn" column="TOTL_QTY_CLCL_YN"/>
		<result property="icqyCnvsVl" column="ICQY_CNVS_VL"/>
		<result property="cqy" column="CQY"/>
		<result property="useBgnnYmd" column="USE_BGNN_YMD"/>
		<result property="diusYmd" column="DIUS_YMD"/>
		<result property="pwdijYn" column="PWDIJ_YN"/>
		<result property="tkmdCatnLablCd" column="TKMD_CATN_LABL_CD"/>
		<result property="rcmnDrusUseYn" column="RCMN_DRUS_USE_YN"/>
		<result property="vlmInptLmttCd" column="VLM_INPT_LMTT_CD"/>
		<result property="mdprClsfDetlCd" column="MDPR_CLSF_DETL_CD"/>
		<result property="acdgRprsPdctNm" column="ACDG_RPRS_PDCT_NM"/>
		<result property="drugDlvyDprtCd" column="DRUG_DLVY_DPRT_CD"/>
		<result property="mixRprsPdctCd" column="MIX_RPRS_PDCT_CD"/>
		<result property="erMcteAddvCd" column="ER_MCTE_ADDV_CD"/>
		<result property="ddLmttQty" column="DD_LMTT_QTY"/>
		<result property="ddLmttQtyInptDslwYn" column="DD_LMTT_QTY_INPT_DSLW_YN"/>
		<result property="ingrDetlCtn" column="INGR_DETL_CTN"/>
		<result property="insrAcknBaseCeckYn" column="INSR_ACKN_BASE_CECK_YN"/>
		<result property="subTypeCd" column="SUB_TYPE_CD"/>
		<result property="scrgInpyOnbrRt" column="SCRG_INPY_ONBR_RT"/>
		<result property="rtrnRqstYn" column="RTRN_RQST_YN"/>
		<result property="prnPsblYn" column="PRN_PSBL_YN"/>
		<result property="cnsnRltdYn" column="CNSN_RLTD_YN"/>
		<result property="cnsnRltdMcdpCd" column="CNSN_RLTD_MCDP_CD"/>
		<result property="prepOrdrYn" column="PREP_ORDR_YN"/>
		<result property="mdppBdwgVl" column="MDPP_BDWG_VL"/>
		<result property="mdppBdwgPrvcCd" column="MDPP_BDWG_PRVC_CD"/>
		<result property="inslDvsnCd" column="INSL_DVSN_CD"/>
		<result property="ingrNm" column="INGR_NM"/>
		<result property="injtMixCmmdDvsnCd" column="INJT_MIX_CMMD_DVSN_CD"/>
		<result property="dgmtRgstTypeCd" column="DGMT_RGST_TYPE_CD"/>
		<result property="hiraDrugMainIngrCd" column="HIRA_DRUG_MAIN_INGR_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntDrugOrdrList (환자의 약주사 처방 정보 조회) 
        Description :                                           환자의 약주사 처방 정보를 조회한다..
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntDrugOrdrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntDrugOrdrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntDrugOrdrList-result" useCache="true" flushCache="false">
			<![CDATA[
			   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntDrugOrdrList_약주사 처방 조회 */
					  'S'              as SAVE_DVSN_CD
					,  a.PTNO as PTNO                           /* 환자번호*/
					,  to_char(a.ORDR_YMD,'YYYYMMDD') as ORDR_YMD   /* 처방일자*/
					,  a.ORDR_SNO as ORDR_SNO                       /* 처방일련번호*/
					,  a.MDRP_NO as MDRP_NO                        /* 진료접수번호*/
					,  a.PTAD_MDRP_NO as PTAD_MDRP_NO                   /* 원무진료접수번호*/
					,  a.ORDR_CD as ORDR_CD                        /* 처방코드*/
					,  a.MCDP_CD as MCDP_CD                        /* 진료과코드*/
					,  a.ODDR_ID as ODDR_ID                        /* 처방의사ID*/
					,  a.CHDR_ID as CHDR_ID                        /* 지정의사ID*/
					,  a.GNDR_ID as GNDR_ID                        /* 주치의사ID*/
					,  a.CODV_CD as CODV_CD                        /* 내원구분코드*/
					,  a.PTAD_CODV_CD as PTAD_CODV_CD                   /* 원무내원구분코드*/
					,  a.ORDR_CLTY_CD as ORDR_CLTY_CD                   /* 처방분류유형코드*/
					,  a.ORCL_CD as ORCL_CD                        /* 처방분류코드*/
					,  a.ODKI_CD as ODKI_CD                        /* 처방종류코드*/
					,  a.ODKI_DETL_CD as ODKI_DETL_CD                   /* 처방종류상세코드*/
					,  a.ORFR_CD as ORFR_CD                        /* 처방형태코드*/
					,  a.HSLC_DVSN_CD as HSLC_DVSN_CD                   /* 위치구분코드*/
					,  a.MCCN_CD as MCCN_CD                        /* 진료센터코드*/
					,  a.WARD_CD as WARD_CD                        /* 병동코드*/
					,  a.OROC_DPRT_CD as OROC_DPRT_CD                        /* 처방발생원코드*/
					,  a.FRNS_DPRT_CD  as FRNS_DPRT_CD                 /* 불출부서코드*/
					,  a.SLIP_CD as SLIP_CD                        /* SLIP코드*/
					,  a.CARE_STTS_CD as CARE_STTS_CD                   /* 간호상태코드*/
					,  a.RTRN_STTS_CD as RTRN_STTS_CD                   /* 반납상태코드*/
					,  to_char (a.RTRN_RQST_DT, 'YYYYMMDDhh24miss') as RTRN_RQST_DT /* 반납요청일시*/
					,  a.RTRN_RQPR_ID as RTRN_RQPR_ID                   /* 반납요청자ID*/
					,  a.ORDR_HOLD_DVSN_CD as ORDR_HOLD_DVSN_CD              /* 처방Hold구분코드*/
					,  a.ORDR_HOLD_RGST_DT as ORDR_HOLD_RGST_DT              /* 처방Hold등록일시*/
					,  a.ORDR_HOLD_RGSR_ID as ORDR_HOLD_RGSR_ID              /* 처방Hold등록자ID*/
					,  a.SYMP_MNFS_DEGR_CD as SYMP_MNFS_DEGR_CD              /* 증상발현정도코드*/
					,  a.DGST_ABNR_RCTN_ORRE_CTN as DGST_ABNR_RCTN_ORRE_CTN        /* 약물이상반응처방사유내용*/
					,  a.ADTN_ORDV_CD as ADTN_ORDV_CD                   /* 추가처방구분코드*/
					,  a.RGOR_FNDR_ID as RGOR_FNDR_ID                   /* 정규처방완료의사ID*/
					,  to_char (a.RGOR_FINS_DT, 'YYYYMMDDhh24miss') as RGOR_FINS_DT /* 정규처방완료일시*/
					,  a.ORCN_NURS_ID as ORCN_NURS_ID                   /* 처방확인간호사ID*/
					,  to_char (a.ORCN_DT, 'YYYYMMDDhh24miss') as ORCN_DT      /* 처방확인일시*/
					,  a.TMPR_ORDR_YN as TMPR_ORDR_YN                   /* 임시처방여부*/
					,  a.DC_DVSN_CD as DC_DVSN_CD                     /* DC구분코드*/
					,  a.DC_ODDR_ID as DC_ODDR_ID                     /* DC처방의사ID*/
					,  to_char (a.DC_ORDR_DT, 'YYYYMMDDhh24miss') as DC_ORDR_DT   /* DC처방일시*/
					,  a.DC_CNNU_ID as DC_CNNU_ID                     /* DC확인간호사ID*/
					,  to_char (a.DC_CNFR_DT, 'YYYYMMDDhh24miss') as DC_CNFR_DT  /* DC확인일시*/
					,  decode(a.ORDR_CRTN_DVSN_CD,'08',9900,'09',9901,'10',9902,'11',9903, a.SORT_SQNC) as SORT_SQNC /* 정렬순서*/
					,  a.DRUG_ORDR_UNSL_CTN as DRUG_ORDR_UNSL_CTN             /* 약처방특이내용*/
					,  a.INPT_USER_DVSN_CD as INPT_USER_DVSN_CD              /* 입력사용자구분코드*/
					,  a.CRTF_DVSN_CD as CRTF_DVSN_CD                   /* 인증대상여부*/
					,  a.ATHN_ID as ATHN_ID                        /* 인증자ID*/
					,  a.CRTF_IP as CRTF_IP                        /* 인증IP*/
					,  to_char (a.CRTF_DT, 'YYYYMMDDhh24miss') as CRTF_DT      /* 인증일시*/
					,  a.CLRS_PRJC_CD as CLRS_PRJC_CD                   /* 임상연구과제코드*/
					,  a.CLRS_PRJC_DR_ID as CLRS_PRJC_DR_ID                /* 임상연구과제의사ID*/
					,  a.SUBJ_IDNT_NO as SUBJ_IDNT_NO                   /* 피험자식별번호*/
					,  a.SUBJ_INTI_VL as SUBJ_INTI_VL                   /* 피험자이니셜값*/
					,  a.SUBJ_VIST_NM as SUBJ_VIST_NM                   /* 피험자방문명*/
					,  a.SUBJ_ADMN_VL as SUBJ_ADMN_VL                   /* 피험자투여값*/
					,  a.CLNC_EXAM_MDPR_CTN as CLNC_EXAM_MDPR_CTN             /* 임상시험약품내용*/
					,  to_char(a.OPRT_YMD,'YYYYMMDD') as OPRT_YMD   /* 수술일자*/
					,  a.OPRT_SNO as OPRT_SNO                       /* 수술일련번호*/
					,  a.ITRN_BSDV_CD as ITRN_BSDV_CD                   /* 인턴업무구분코드*/
					,  a.SRRQ_CMNT_CTN as SRRQ_CMNT_CTN                  /* SR커멘트내용*/
					,  a.ORDR_IPDV_CD as ORDR_IPDV_CD                   /* 처방급여구분코드*/
					,  a.PTAD_IPDV_CD as PTAD_IPDV_CD                   /* 원무급여구분코드*/
					,  a.ISTY_CD as ISTY_CD                        /* 보험유형코드*/
					,  a.ISTY_ASST_CD as ISTY_ASST_CD                   /* 보험유형보조코드*/
					,  a.CNPL_CD as CNPL_CD                        /* 계약처코드*/
					,  to_char(a.PTAD_CLAM_YMD,'YYYYMMDD') as PTAD_CLAM_YMD   /* 원무청구일자*/
					,  to_char(a.PTAD_CLBA_YMD,'YYYYMMDDhh24miss') as PTAD_CLBA_YMD   /* 원무계산기준일자*/
					,  a.RCST_CD as RCST_CD                        /* 수납상태코드*/
					,  a.RPNT_ID as RPNT_ID                        /* 수납자ID*/
					,  to_char (a.RCPC_DT, 'YYYYMMDDhh24miss') as RCPC_DT      /* 수납일시*/
					,  a.VIA_ADMS_RCST_CD as VIA_ADMS_RCST_CD               /* 경유입원수납상태코드*/
					,  a.OPSR_ID as OPSR_ID                        /* 집도의사ID*/
					,  a.CPDR_ID    as CPDR_ID                    /* 협진의사ID*/
					/* ,  a.PHRM_PTGO_CD                   /* 약국가야할장소코드*/
					,  a.PTAD_PTGO_CD as PTAD_PTGO_CD                   /* 원무가야할장소코드*/
					,  to_char(a.IMPL_YMD,'YYYYMMDD') as IMPL_YMD        /* 실시일자*/
					,  to_char(a.ABC_ENFR_YMD,'YYYYMMDD') as ABC_ENFR_YMD    /* ABC시행일자*/
					,  a.ABC_MCDP_CD as ABC_MCDP_CD                    /* ABC진료과코드*/
					,  a.ABC_EFDP_CD as ABC_EFDP_CD                    /* ABC시행부서코드*/
					,  a.ABC_ODDR_ID as ABC_ODDR_ID                    /* ABC처방의사ID*/
					,  a.VAT_TRGT_YN as VAT_TRGT_YN                    /* 부가세대상여부*/
					,  a.ICU_VS_DSPL_YN as ICU_VS_DSPL_YN                 /* ICU_VitalSign표시여부*/
					,  a.DURV_YN as DURV_YN                        /* DUR여부*/
					,  a.DURV_ORTA_NM as DURV_ORTA_NM                   /* DUR처방테이블명*/
					,  a.DURV_RESN_CTN as DURV_RESN_CTN                  /* DUR사유내용*/
					,  to_char(a.DURV_ORDR_YMD,'YYYYMMDD') as DURV_ORDR_YMD   /* DUR처방일자*/
					,  a.DURV_ORDR_CD as DURV_ORDR_CD                   /* DUR처방코드*/
					,  a.EDI_DPLC_RESN_CD as EDI_DPLC_RESN_CD               /* EDI중복사유코드*/
					,  a.EDI_DPLC_RESN_CTN as EDI_DPLC_RESN_CTN              /* EDI중복사유내용*/
					,  a.PRTX_RLTN_RESN_VL as PRTX_RLTN_RESN_VL              /* 처방전간사유코드*/
					,  a.PRTX_RLTN_RESN_CTN as PRTX_RLTN_RESN_CTN             /* 처방전간사유내용*/
					,  a.DURV_RTRN_DDCN as DURV_RTRN_DDCN                 /* DUR반납일수*/
					,  a.MDPR_CLSF_CD as MDPR_CLSF_CD                   /* 약품분류코드*/
					,  a.DRAP_DVSN_CD as DRAP_DVSN_CD                   /* 약적용구분코드*/
					,  a.MDTN_NO_DVSN_CD as MDTN_NO_DVSN_CD                /* 투약번호구분코드*/
					,  a.MDTN_LCDV_CD as MDTN_LCDV_CD                   /* 투약위치구분코드*/
					,  a.MDTN_NO as MDTN_NO                        /* 투약번호*/
					,  a.IHOH_DVSN_CD as IHOH_DVSN_CD                   /* 원내원외구분코드*/
					,  a.SDPF_EXRE_CD as SDPF_EXRE_CD                   /* 의약분업예외사유코드*/
					,  a.SLCT_UNIT_DVSN_CD as SLCT_UNIT_DVSN_CD              /* 선택단위구분코드*/
					,  a.PCKN_UNAD_QTY as PCKN_UNAD_QTY                  /* 포장단위투여량*/
					,  a.PCUN_CD as PCUN_CD                        /* 포장단위코드*/
					,  a.ICUN_ADMN_VLM as ICUN_ADMN_VLM                  /* 함량단위투여용량*/
					,  a.ICUN_CD as ICUN_CD                        /* 함량단위코드*/
					,  a.NTM as NTM                            /* 횟수*/
					,  a.DDCN as DDCN                           /* 일수*/
					,  a.TOTL_VLM as TOTL_VLM                       /* 총용량*/
					,  a.MDTN_VLUN_CD as MDTN_VLUN_CD                   /* 투약용량단위코드*/
					,  a.MDTN_PRKG_VLM as MDTN_PRKG_VLM                  /* 투약Kg당용량*/
					,  a.DRUS_CD as DRUS_CD                        /* 용법코드*/
					,  to_char(a.INJC_PRRN_YMD,'YYYYMMDD') as INJC_PRRN_YMD    /* 주사예정일자*/
					,  to_char(a.MDTN_STRT_YMD,'YYYYMMDD') as MDTN_STRT_YMD    /* 투약시작일자*/
					,  to_char(a.MDTN_FNSH_YMD,'YYYYMMDD') as MDTN_FNSH_YMD    /* 투약종료일자*/
					,  a.CNNT_ORDR_BNDL_NO as CNNT_ORDR_BNDL_NO              /* 동시처방묶음번호*/
					,  a.DRBN_NO as DRBN_NO                        /* 약묶음번호*/
					,  a.SNGN_BNDL_YN as SNGN_BNDL_YN                   /* 단독묶음여부*/
					,  a.MIX_KIND_CD as MIX_KIND_CD                    /* 혼합종류코드*/
					,  a.ASTS_YN as ASTS_YN                        /* AST여부*/
					,  a.PRVN_INJC_ORNO as PRVN_INJC_ORNO                 /* 예방주사차수*/
					,  a.DRUG_ORDR_PRSS_CD as DRUG_ORDR_PRSS_CD              /* 약처방진행상태코드*/
					,  a.NRDR_PRTX_PRIN_NTM as NRDR_PRTX_PRIN_NTM             /* 마약처방전출력횟수*/
					,  a.NRDR_RTRN_PRTX_PRIN_NTM as NRDR_RTRN_PRTX_PRIN_NTM        /* 마약반납처방전출력횟수*/
					,  a.PHDP_PRIN_YN as PHDP_PRIN_YN                   /* 약제부출력여부*/
					,  a.SBSN_UPDT_CMMD_YN as SBSN_UPDT_CMMD_YN              /* 대체수정조제여부*/
					,  a.ANTC_INJC_AHED_CMMD_YN as ANTC_INJC_AHED_CMMD_YN         /* 항암주사선조제여부*/
					,  a.ACDG_MIX_DVSN_CD as ACDG_MIX_DVSN_CD               /* 항암제혼합구분코드*/
					,  a.ACTN_NTM as ACTN_NTM                       /* 액팅횟수*/
					,  a.DSDR_SDEF_CTN as DSDR_SDEF_CTN                  /* 퇴원약부작용내용*/
					,  a.DSDR_SPAB_CTN as DSDR_SPAB_CTN                  /* 퇴원약특기내용*/
					,  a.DRRT_DVSN_CD as DRRT_DVSN_CD                   /* 약반납구분코드*/
					,  a.DRUG_RTRE_CD as DRUG_RTRE_CD                   /* 약반납사유코드*/
					,  a.DRRT_CNNU_ID as DRRT_CNNU_ID                   /* 약반납확인간호사ID*/
					,  a.PHRM_RTRN_QTY as PHRM_RTRN_QTY                  /* 약국반납량*/
					,  a.PACL_AFTR_DRRT_QTY as PACL_AFTR_DRRT_QTY             /* 원무계산이후약반납량*/
					,  a.RTRN_EXRE_CTN as RTRN_EXRE_CTN                  /* 반납예외사유내용*/
					,  a.EXRE_RTRN_QTY as EXRE_RTRN_QTY                  /* 예외사유반납량*/
					,  a.EXRE_RTPR_ID as EXRE_RTPR_ID                   /* 예외사유반납자ID*/
					,  to_char (a.EXRE_RTRN_DT, 'YYYYMMDDhh24miss') as EXRE_RTRN_DT   /* 예외사유반납일시*/
					,  a.ANTB_GUID_GRP_VL as ANTB_GUID_GRP_VL               /* 항생제가이드그룹값*/
					,  a.ANCL_CD1 as ANCL_CD_1                       /* 항균제분류코드1*/
					,  a.ANCL_CD2 as ANCL_CD_2                       /* 항균제분류코드2*/
					,  a.ANCL_CD3 as ANCL_CD_3                       /* 항균제분류코드3*/
					,  a.ANCL_CD4 as ANCL_CD_4                       /* 항균제분류코드4*/
					,  a.ANCL_CD5 as ANCL_CD_5                       /* 항균제분류코드5*/
					,  a.ANAG_PATH_NM as ANAG_PATH_NM                   /* 항균제경로명*/
					,  to_char(a.PHRM_IMPL_YMD,'YYYYMMDD') as PHRM_IMPL_YMD      /* 약국실시일자*/
					,  to_char(a.ORDR_VALD_STRT_YMD,'YYYYMMDD') as ORDR_VALD_STRT_YMD /* 처방유효시작일자*/
					,  to_char(a.ORDR_VALD_FNSH_YMD,'YYYYMMDD') as ORDR_VALD_FNSH_YMD /* 처방유효종료일자*/
					,  a.IMPL_ORDR_PBLC_NTM as IMPL_ORDR_PBLC_NTM             /* 실시처방발행횟수*/
					,  a.IMPL_ORDR_PBLC_LMTT_NTM as IMPL_ORDR_PBLC_LMTT_NTM        /* 실시처방발행제한횟수*/
					,  to_char(a.ORGL_ORDR_YMD,'YYYYMMDD') as ORGL_ORDR_YMD   /* 원처방일자*/
					,  a.ORGL_ORDR_SNO as ORGL_ORDR_SNO                  /* 원처방일련번호*/
					,  a.MDTN_LABL_PRIN_NTM as MDTN_LABL_PRIN_NTM             /* 투약라벨출력횟수*/
					,  to_char(a.MDFE_APLY_YMD,'YYYYMMDD') as MDFE_APLY_YMD      /* 수가적용일자*/
					,  a.HGCN_KEEP_RESN_CD as HGCN_KEEP_RESN_CD              /* 고함량유지사유코드*/
					,  a.HGCN_KEEP_ETRE_CTN as HGCN_KEEP_ETRE_CTN             /* 고함량유지기타사유내용*/
					,  a.AGE_TABO_ORRE_CTN as AGE_TABO_ORRE_CTN              /* 연령금기처방사유내용*/
					,  a.PGWM_TABO_ORRE_CTN as PGWM_TABO_ORRE_CTN              /* 임부금기처방사유내용*/
					,  a.INSR_YR3_INOU_DVSN_CD as INSR_YR3_INOU_DVSN_CD          /* 보험3년내외구분코드*/
					,  a.FRNS_YN as FRNS_YN                        /* 불출여부*/
					,  a.FRNS_VLM as FRNS_VLM                       /* 불출용량*/
					,  a.FRNS_CTRL_DVSN_CD as FRNS_CTRL_DVSN_CD              /* 불출제어구분코드*/
					,  a.FRNS_RQPR_ID as FRNS_RQPR_ID                   /* 불출요청자ID*/
					,  a.FRNS_RQPR_TYPE_CD as FRNS_RQPR_TYPE_CD              /* 불출요청자유형코드*/
					,  a.FRNS_RQPR_IP as FRNS_RQPR_IP                   /* 불출요청자IP*/
					,  to_char (a.FRNS_RQST_DT, 'YYYYMMDDhh24miss') as FRNS_RQST_DT   /* 불출요청일시*/
					,  a.FRNS_RTRN_CQY as FRNS_RTRN_CQY                  /* 불출반납수량*/
					,  a.ER_FRNS_YN as ER_FRNS_YN                     /* 응급불출여부*/
					,  a.CYCL_ORDV_CD as CYCL_ORDV_CD                   /* 주기처방구분코드*/
					,  a.CYCL_ORDR_DYWK_CTN as CYCL_ORDR_DYWK_CTN             /* 주기처방요일내용*/
					,  a.CYCL_ORDR_DDCN as CYCL_ORDR_DDCN                 /* 주기처방일수*/
					,  to_char(a.CYCL_ORDR_STRT_YMD,'YYYYMMDD') as CYCL_ORDR_STRT_YMD /* 주기처방시작일자*/
					,  to_char(a.CYCL_ORDR_FNSH_YMD,'YYYYMMDD') as CYCL_ORDR_FNSH_YMD /* 주기처방종료일자*/
					,  a.FLUD_TOTL_QTY as FLUD_TOTL_QTY                  /* 수액총량*/
					,  a.FLUD_OVER_VL as FLUD_OVER_VL                   /* 수액Over값*/
					,  a.FLUD_CC_HR_VL as FLUD_CC_HR_VL                  /* 수액CC_HR값*/
					,  a.FLUD_Q_HR_VL as FLUD_Q_HR_VL                   /* 수액Q_HR값*/
					,  a.EQPM_RGST_DVSN_CD as EQPM_RGST_DVSN_CD              /* 장비등록구분코드*/
					,  to_char (a.RGST_DVSN_INPT_DT, 'YYYYMMDDhh24miss') as RGST_DVSN_INPT_DT /* 등록구분입력일시*/
					,  a.PAST_CYCL_INFM_CTN as PAST_CYCL_INFM_CTN             /* 과거주기정보내용*/
					,  a.HYPR_PPVL_RESN_CD as HYPR_PPVL_RESN_CD              /* 고혈압적정성평가사유코드*/
					,  a.HYPR_PPVL_ETC_NM as HYPR_PPVL_ETC_NM               /* 고혈압적정성평가기타명*/
					,  a.PBLC_DVSN_CD as PBLC_DVSN_CD                   /* 발행구분코드*/
					,  a.LQMD_USE_RESN_CD as LQMD_USE_RESN_CD               /* 액제사용사유코드*/
					,  a.LQMD_USE_REET_CTN as LQMD_USE_REET_CTN              /* 액제사용사유기타내용*/
					,  a.PSDG_DRUG_LNTR_ORRE_CTN as PSDG_DRUG_LNTR_ORRE_CTN        /* 향정약장기처방사유내용*/
		            ,  a.PSDG_DRUG_INCS_ORRE_CTN as PSDG_DRUG_INCS_ORRE_CTN        /* 향정약산재처방사유내용 */
					,  a.DSPC_NURS_ADJS_NO as DSPC_NURS_ADJS_NO              /* 퇴원계획지간호사조정번호*/
					,  a.CHLD_PVIC_REGN_YN as CHLD_PVIC_REGN_YN              /* 소아예방접종지역여부*/
					,  a.ANTC_ORNO_NO as ANTC_ORNO_NO                   /* 항암차수번호*/
					,  a.ACDG_ADMN_MI as ACDG_ADMN_MI                   /* 항암제투여시간분*/
					,  a.ANTC_SHET_NO as ANTC_SHET_NO                   /* 항암시트번호*/
					,  a.RGMN_CD as RGMN_CD                        /* 레지먼코드*/
					,  a.CMMD_PRSR_YN as CMMD_PRSR_YN                   /* 조제택배여부*/
					,  a.TPRN_ORDR_YN as TPRN_ORDR_YN                   /* Tapering처방여부*/
					,  a.CNMD_RDEX_TRGT_YN as CNMD_RDEX_TRGT_YN              /* 조영제감면대상여부*/
					,  a.OSLF_ADMN_DRUG_YN as OSLF_ADMN_DRUG_YN              /* 자가투여약여부*/
					,  a.INHS_FRST_ADMN_DGST_YN as INHS_FRST_ADMN_DGST_YN         /* 원내최초투여약물여부*/
					,  a.IMLN_ORDR_YN as IMLN_ORDR_YN                   /* 임플란트처방여부*/
					,  a.MDPR_NON_APLY_YN as MDPR_NON_APLY_YN               /* 약품비적용여부*/
					,  a.STER_CMMD_IMPL_YN as STER_CMMD_IMPL_YN              /* 무균조제실시여부*/
					,  a.ORDR_CRTN_DVSN_CD as ORDR_CRTN_DVSN_CD              /* 처방생성구분코드*/
					,  a.ORDR_CRTN_LNKN_NO as ORDR_CRTN_LNKN_NO              /* 처방생성연결번호*/
		            ,  a.SPOR_BNDL_NM as SPOR_BNDL_NM                               /* 스페셜처방묶음명 */
		            ,  a.SPOR_BNDL_NO  as SPOR_BNDL_NO                              /* 스페셜처방묶음번호*/            
		            ,  a.PMDT_INSC_YN as PMDT_INSC_YN /* premedication검수여부 */
		            ,  a.MIX_DFNT_DVSN_CD as MIX_DFNT_DVSN_CD /* 항암제확정구분코드 */
		            ,  to_char(a.MIX_DFNT_DT, 'yyyymmddhh24miss') as MIX_DFNT_DT /* 항암제확정일시 */
					,  a.FRST_RGSR_ID as FRST_RGSR_ID                   /* 최초등록자ID*/
					,  a.FRST_RGST_IP as FRST_RGST_IP                   /* 최초등록IP*/
					,  to_char (a.FRST_RGST_DT, 'YYYYMMDDhh24miss') as FRST_RGST_DT    /* 최초등록일시*/
					,  a.LAST_UPDR_ID as LAST_UPDR_ID                   /* 최종수정자ID*/
					,  a.LAST_UPDT_IP as LAST_UPDT_IP                   /* 최종수정IP*/
					,  to_char (a.LAST_UPDT_DT, 'YYYYMMDDhh24miss') as LAST_UPDT_DT    /* 최종수정일시*/
					,  b.ACMP_YN as ACMP_YN                        /*  임상시험약여부 */
					,  b.DGFR_CD as DGFR_CD                        /*  제형코드 */
					,  b.FLUD_ORDR_YN as FLUD_ORDR_YN                   /*  수액처방여부 */
					,  b.KIT_MDPR_DDCN as KIT_MDPR_DDCN                  /*  KIT약품일수 */
					,  b.ORDR_NM as ORDR_NM                        /*  처방명 */
					,  b.ORDR_PSBL_DVSN_CD as ORDR_PSBL_DVSN_CD              /*  처방가능구분 */
					,  b.PCUN_INLS_QTY as PCUN_INLS_QTY                  /*  포장단위포함량 ( 용량, 수량 변경시 기준 함량으로 사용 ) */
		            ,  b.ICUN_CD as BSIS_ICUN_CD
		            ,  b.CHLD_PCUN_ICQY_VL			/* 소아포장단위함량값			*/
					,  b.CHLD_ICUN_CD				/* 소아함량단위코드			*/
					,  b.TIMS1_TOTL_QTY_YN as TIMS1_TOTL_QTY_YN              /*  총량계산 */
					,  c.INSR_IPDV_CD as INSR_IPDV_CD                   /*  보험급여구분(AI041)          */
					,  c.PRTC_IPDV_CD as PRTC_IPDV_CD                   /*  보호급여구분(AI041)          */
					,  c.INCS_IPDV_CD as INCS_IPDV_CD                   /*  산재급여구분(AI041)          */
					,  c.TAIN_IPDV_CD as TAIN_IPDV_CD                   /*  자보급여구분(AI041)          */
					,  c.MDFE_ITDV_CD as MDFE_ITDV_CD                   /*  수가입력구분(AI046):처치,재료필수입력구분 */
					,  c.MDPR_UICM_TABO_CD as MDPR_UICM_TABO_CD              /*  약품병용금기코드                */
		            ,  c.INSR_EDI_CD as INSR_EDI_CD /* 보험EDI코드 */
					,  d.HIRA_MAIN_INGR_CD as MDPR_INGR_CD              /*  약품성분코드                      */
					,  e.CANC_PRGR_STEP_VL as CANC_PRGR_STEP_VL              /*  암진행단계값 */
					,  e.ANTC_ORNO as ANTC_ORNO                      /*  항암차수     */
					,  b.MEGR_CD as MEGR_CD                          /*  약효군코드                        */
					,  b.ANTB_YN as ANTB_YN                          /*  항생제여부                        */
					,  b.PWDR_DSLW_YN as PWDR_DSLW_YN                     /*  산제불가여부                      */
					,  b.DYS1_CECK_QTY as DYS1_CECK_QTY                    /*  1일체크량                         */
					,  b.SAME_DGFR_MNMM_INLS_QTY as SAME_DGFR_MNMM_INLS_QTY          /*  동일제형최소포함량                */
					,  b.SAME_DGFR_MXMM_INLS_QTY as SAME_DGFR_MXMM_INLS_QTY          /*  동일제형최대포함량                */
					,  b.STST_DVSN_CD as STST_DVSN_CD                     /*  통계구분코드                      */
					,  b.CLNC_EXAM_DRUG_YN as CLNC_EXAM_DRUG_YN                /*  임상시험약여부                    */
					,  b.MDPR_ORLM_AGE_DDCN as MDPR_ORLM_AGE_DDCN               /*  약품처방제한연령일수              */
					,  b.PRTN_DLFL_YN as PRTN_DLFL_YN                     /*  복막투석액여부                    */
					,  b.INGR_MNMM_CD as INGR_MNMM_CD                     /*  성분최소코드                      */
					,  fn_sd_getdrugcmpname_s(a.ORDR_CD) as AFI_PGWM_TABO_INGR_NM        /*  임부금기- 성분명                  */
					,  fn_sd_getfdacategory_s(a.ORDR_CD) as AFI_FDA_CLSF_CTN             /*  임부금기- FDA CATEGORY         */
					,  fn_sd_getkfdacategory_s(a.ORDR_CD) as AFI_KFDA_CLSF_CTN           /*  임부금기- KFDA CATEGORY        */
					,  case when ( select  count ( MDFE_CD )
									 from  AIETPENRT
									 where  MDFE_CD = a.ORDR_CD
									   and  ((MCDP_CD = '******') or (MCDP_CD = a.MCDP_CD))
									   and  ((MDDR_ID = '******') or (MDDR_ID = #{gvUserId}))
									   and  CNCL_DT is null
									   and  a.ORDR_YMD between APST_YMD and APFN_YMD and rownum < 2 ) > 0
							then 'Y' else 'N' end as AFI_KFDA_PRMS_NNPY_DGMT_YN            /*  식약청허가초과비급여사용승인약제(처방가능범위)) */
					,  (
						   select  MDCR_CTRL_CHRC_VL1 || MDCR_CTRL_CHRC_VL2 || MDCR_CTRL_CHRC_VL3 || MDCR_CTRL_CHRC_VL4
							 from  MZCTRLMMT        /*  진료제어코드 */
							where  MDCR_CTRL_CD = 'MM965'
							  and  MDCR_DTLS_CTRL_CD = a.ORDR_CD
							  and  rownum = 1
					   )  as AFI_ANTB_CLSF_NM       /*  예방적항생제구분정보 */
					,  f.TKNG_INVL_DDCN as TKNG_INVL_DDCN              /*  복용간격일수 */
					,  (
						  select  CTRL_DSCR_CTN
							from  MZCTRLMMT
						   where  MDCR_CTRL_CD = 'MM847'
							 and  MDCR_DTLS_CTRL_CD = a.ORDR_CD
					   ) as AFI_ORDR_PRT_INSR_CTN /*  일부보험 */
					,  b.IHOH_DVSN_CD  as AFI_IHOH_PSBL_DVSN_CD
					,  b.ANTC_THRP_MNGM_DVSN_CD as ANTC_THRP_MNGM_DVSN_CD            /*  항암요법관리구분코드 */
					,  d.OTPT_PHRM_INJT_YN as OTPT_PHRM_INJT_YN
		            ,  d.RPMD_ID					/* 대표약품ID				*/
					,  d.INGR_ID					/* 성분ID					*/
					,  d.TOTL_QTY_CLCL_YN			/* 계산여부				*/
					,  d.ICQY_CNVS_VL				/* 함량환산값				*/
					,  d.CQY						/* 수량					*/
					,  to_char(d.USE_BGNN_YMD, 'yyyymmdd') as USE_BGNN_YMD				/* 사용개시일자				*/
					,  to_char(d.DIUS_YMD, 'yyyymmdd') as DIUS_YMD					/* 불용일자				*/
		            ,  d.PWDIJ_YN					/* 분말주사제여부(powder)		*/
					,  d.TKMD_CATN_LABL_CD			/* 복약주의라벨코드(SDA_009)	*/
					,  d.RCMN_DRUS_USE_YN			/* 추천용법만사용여부			*/
					,  d.VLM_INPT_LMTT_CD			/* 용량입력제한코드			*/
					,  d.MDPR_CLSF_DETL_CD			/* 약품분류상세코드			*/
					,  d.ACDG_RPRS_PDCT_NM			/* 항암제대표상품명			*/
		            ,  (select  DRUG_DLVY_DPRT_CD 
		                  from  SDDMETCDT 
		                 where  DRUS_CD = a.DRUS_CD) as DRUG_DLVY_DPRT_CD  /* 약전달부서코드 */
		            ,  d.MIX_RPRS_PDCT_CD		        /*	Mix용대표상품코드 */
		            ,  c.ER_MCTE_ADDV_CD		  /* 응급의료가산구분코드 */
		            ,  f. DD_LMTT_QTY                 /* 1일제한량 */
		            ,  f.DD_LMTT_QTY_INPT_DSLW_YN   /* 1일제한량입력불가여부 */
		            ,  (select  listAgg(INGR_DETL_ID, '^') within group(order by INGR_DETL_ID) as INGR_DETL_CTN
		                  from  SDRPMDDET
		                 where  RPMD_ID = d.RPMD_ID) as INGR_DETL_CTN
		            ,  b.INSR_ACKN_BASE_CECK_YN as INSR_ACKN_BASE_CECK_YN /* 보험인정기준체크여부 */
		            ,  a.SUB_TYPE_CD as SUB_TYPE_CD /* 부유형코드 */
		            ,  a.SCRG_INPY_ONBR_RT as SCRG_INPY_ONBR_RT /* 선별급여본인부담율 */
		            ,  (select 'Y'
		                  from MDDCREQMT
		                where PTNO = a.PTNO
		                    and ORDR_YMD = a.ORDR_YMD
		                    and ORDR_SNO = a.ORDR_SNO
		                    and MDRP_NO = a.MDRP_NO
		                    and nvl(DC_YN, 'N') = 'N') as RTRN_RQST_YN
		            ,  case when ( select  count ( MDCR_DTLS_CTRL_CD )
									from  MZCTRLMMT
								   where  MDCR_CTRL_CD = 'MM969'
									 and  MDCR_DTLS_CTRL_CD = a.ORDR_CD
					    			 and  a.ORDR_YMD  between APST_YMD and APFN_YMD)  > 0
						    then 'Y' else 'N' end as PRN_PSBL_YN   /* PRN가능여부 */
		            ,  a.CNSN_RLTD_YN  /* 컨설트관련여부 */
		            ,  a.CNSN_RLTD_MCDP_CD /* 컨설트관련진료과코드 */
		            ,  a.PREP_ORDR_YN as PREP_ORDR_YN /* PREP처방여부 */
		            ,  a.MDPP_BDWG_VL as MDPP_BDWG_VL /* 투약용체중값 */
		            ,  a.MDPP_BDWG_PRVC_CD as MDPP_BDWG_PRVC_CD /* 투약용체중출처코드 */
		            ,  d.INSL_DVSN_CD as INSL_DVSN_CD /* 인슐린구분코드 */
		            ,  b.INGR_NM      as INGR_NM /* 성분명 */
		            ,  b.INJT_MIX_CMMD_DVSN_CD as INJT_MIX_CMMD_DVSN_CD	/* 주사제혼합조제구분코드  */
		            ,  b.DGMT_RGST_TYPE_CD as DGMT_RGST_TYPE_CD
					,  g.HIRA_DRUG_MAIN_INGR_CD AS HIRA_DRUG_MAIN_INGR_CD /*심평원약주성분코드*/
				 from
					   MDMEDORDT a
					,  MDORDRCMT b
					,  AIMFMDFET c
					,  SDDDGCDMT d
					,  ( select  PTNO , ORDR_YMD , ORDR_SNO, max(CANC_PRGR_STEP_VL) CANC_PRGR_STEP_VL ,max(ANTC_ORNO) ANTC_ORNO
						   from  MDCHEMOCT
						  where  PTNO = #{ptno}
							and  ORDR_YMD = to_date ( #{ordrYmd}, 'YYYYMMDD' )
							and  CNCL_DT is null
						  group  by
								 PTNO , ORDR_YMD , ORDR_SNO ) e
					,  SDAAUDIFT f
		            ,  APRCRPTNT rcr
					,  AIMFEDICT g
				where
					   a.PTNO = #{ptno}
				  and  a.ORDR_YMD = to_date ( #{ordrYmd}, 'YYYYMMDD' )
				  and  a.CODV_CD  = #{codvCd}
			]]>		  
				 <if test='orocDprtCd != null and orocDprtCd != ""'>
		             and  a.OROC_DPRT_CD = #{orocDprtCd}
				 </if>  
				 <if test='odkiCd != null and odkiCd != ""'>
		             and  a.ODKI_CD = #{odkiCd}              
				 </if>  
		         <if test='codvCd == "O"'>
		             and rcr.CNCL_DT is null
		         </if>  		         
		         <if test='codvCd == "O" and chdrId != null and chdrId != ""'>
		             and a.CHDR_ID = #{chdrId}
		         </if>
		         <choose>
		           <when test='dcDvsnCd == "T"'>
		             and a.DC_DVSN_CD = #{dcDvsnCd}
		           </when>
		           <otherwise>
			         and  a.DC_DVSN_CD not in ( 'X' , 'F' , 'E', 'T') /*  취소, 실처방 전환, 임시처방 취소, 외래당일입원가처방은 조회 제외 */
		             /*  DC_DVSN_CD 가 'N' 이거나 NULL 인 경우 전체조회 */
		    	     /*  DC_DVSN_CD 임시처방인 경우는 DC_DVSN_CD 'Y' 것도 같이 조회 */
		             and  'TRUE' = case when #{dcDvsnCd} = 'N' or #{dcDvsnCd} is null then 'TRUE'
		                                else case when a.DC_DVSN_CD = #{dcDvsnCd} then 'TRUE'
		                                          when a.DC_DVSN_CD = 'Y' then 'TRUE'
		                                      end
		                            end
		           </otherwise>
		         </choose>		   	
			<![CDATA[				           		   	
				  /*  Client logic 이동 외래일때 같은 진료과만 처리 */
				  and  'TRUE' = case when a.CODV_CD = 'O'
									 then case when a.MCDP_CD like #{mcdpCd} ||'%' /* 단독 처방 조회 기능이 있어서 like 로 처리*/
											   then 'TRUE'
											   else 'FALSE' end
										  else 'TRUE'
										  end
				  and  'TRUE' = case when a.CODV_CD <> 'O'
										  then case when a.MDRP_NO = #{mdrpNo}
														 then 'TRUE'
														 else 'FALSE'
														 end
									 else 'TRUE'
									 end
				  /*  단독 처방 조회 */
				  and   'TRUE' = case when #{ordrSno} > 0
										   then case when a.ORDR_SNO = #{ordrSno}
													 then 'TRUE'
													 else 'FALSE'
													 end
									  else 'TRUE'
									  end
				  and  a.ORDR_CD  = b.ORDR_CD(+)
				  and  a.ORDR_CD  = c.MDFE_CD(+)
				  and  to_date ( #{ordrYmd} , 'YYYYMMDD' ) between c.APST_YMD(+) and c.APFN_YMD (+)
				  and  d.MDPR_CD(+) = c.MDFE_CD
				  and  d.ORDR_PSBL_DVSN_CD(+) = 'Y'
				  and  a.PTNO     = e.PTNO(+)
				  and  a.ORDR_YMD = e.ORDR_YMD(+)
				  and  a.ORDR_SNO = e.ORDR_SNO(+)
				  /* and  nvl ( ORDR_CRTN_DVSN_CD, '00' ) not in ('08','09','10','11') /*  PRN실시처방, 응급실1차실시처방, 1회추가실시처방 제외 */
				  and  a.ORDR_CD = f.MDPR_CD(+)
		          and  a.MDRP_NO = rcr.MDRP_NO
				  and  c.EDID_CD = g.EDID_CD(+)
		          and  c.INSR_EDI_CD = g.EDI_CD(+)
				  and  to_date ( #{ordrYmd} , 'YYYYMMDD' ) between g.APST_YMD(+) and g.APFN_YMD(+)
				order
				   by  decode(a.ORDR_CRTN_DVSN_CD,'08','ZZZ','09','ZZZ','10','ZZZ','11','ZZZ','1')
		              ,  decode(a.ODKI_DETL_CD, 'Z', a.SPOR_BNDL_NO, 0)
		              ,  a.FRST_RGST_DT
		              ,  a.SORT_SQNC
		              ,  a.ORDR_SNO
			]]>	
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntCyclOrdrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="orfrCd" column="ORFR_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="slipCd" column="SLIP_CD"/>
		<result property="drugOrdrUnslCtn" column="DRUG_ORDR_UNSL_CTN"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="ihohDvsnCd" column="IHOH_DVSN_CD"/>
		<result property="sdpfExreCd" column="SDPF_EXRE_CD"/>
		<result property="slctUnitDvsnCd" column="SLCT_UNIT_DVSN_CD"/>
		<result property="pcknUnadQty" column="PCKN_UNAD_QTY"/>
		<result property="pcunCd" column="PCUN_CD"/>
		<result property="icunAdmnVlm" column="ICUN_ADMN_VLM"/>
		<result property="icunCd" column="ICUN_CD"/>
		<result property="ntm" column="NTM"/>
		<result property="ddcn" column="DDCN"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="frnsDprtCd" column="FRNS_DPRT_CD"/>
		<result property="drbnNo" column="DRBN_NO"/>
		<result property="sngnBndlYn" column="SNGN_BNDL_YN"/>
		<result property="mixKindCd" column="MIX_KIND_CD"/>
		<result property="astsYn" column="ASTS_YN"/>
		<result property="antcInjcAhedCmmdYn" column="ANTC_INJC_AHED_CMMD_YN"/>
		<result property="acdgMixDvsnCd" column="ACDG_MIX_DVSN_CD"/>
		<result property="antbGuidGrpVl" column="ANTB_GUID_GRP_VL"/>
		<result property="ordrPsblDvsnCd" column="ORDR_PSBL_DVSN_CD"/>
		<result property="fludQHrVl" column="FLUD_Q_HR_VL"/>
		<result property="fludCcHrVl" column="FLUD_CC_HR_VL"/>
		<result property="fludTotlQty" column="FLUD_TOTL_QTY"/>
		<result property="fludOverVl" column="FLUD_OVER_VL"/>
		<result property="implOrdrPblcLmttNtm" column="IMPL_ORDR_PBLC_LMTT_NTM"/>
		<result property="frnsCtrlDvsnCd" column="FRNS_CTRL_DVSN_CD"/>
		<result property="infmCtn" column="INFM_CTN"/>
		<result property="afiFrstRgsrNm" column="AFI_FRST_RGSR_NM"/>
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
		<result property="cyclOrdrFnshYmd" column="CYCL_ORDR_FNSH_YMD"/>
		<result property="cyclOrdrStrtYmd" column="CYCL_ORDR_STRT_YMD"/>
		<result property="cyclOrdvCd" column="CYCL_ORDV_CD"/>
		<result property="cyclOrdrDywkCtn" column="CYCL_ORDR_DYWK_CTN"/>
		<result property="cyclOrdrDdcn" column="CYCL_ORDR_DDCN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntCyclOrdrList (주기처방 조회) 
        Description :                                           입원환자인 경우 당일 이후 처방일 세팅시 주기처방을 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntCyclOrdrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntCyclOrdrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntCyclOrdrList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntCyclOrdrList_주기처방 조회 */
				   to_char(a.ORDR_YMD, 'yyyymmdd') as ORDR_YMD         /* (공통) 처방일자*/
				,  to_char(a.ORDR_SNO) as ORDR_SNO                     /* (공통) 처방순번*/
				,  a.ORCL_CD as ORCL_CD                                /* (공통) 처방분류*/
				,  a.ORDR_CLTY_CD as ORDR_CLTY_CD                      /* (공통) 처방구별*/
				,  a.ORFR_CD as ORFR_CD                                /* (공통) 처방형태*/
				,  a.ORDR_CD as ORDR_CD                                /* (공통) 처방코드*/
				,  a.SLIP_CD as SLIP_CD                                /* (공통) SLIP코드*/
				,  a.DRUG_ORDR_UNSL_CTN as DRUG_ORDR_UNSL_CTN          /* (공통) 특기사항*/
				,  b.ORDR_NM as ORDR_NM                                /* (전체) 처방명 */
				,  a.IHOH_DVSN_CD as IHOH_DVSN_CD                      /* (약) 원내/원외구분 */
				,  a.SDPF_EXRE_CD as SDPF_EXRE_CD                      /* (약) 의약분업예외사유코드(원내처방사유) */
				,  a.SLCT_UNIT_DVSN_CD as SLCT_UNIT_DVSN_CD            /* (약) 선택단위구분*/
				,  a.PCKN_UNAD_QTY as PCKN_UNAD_QTY                    /* (약) 투여량(포장단위) */
				,  a.PCUN_CD as PCUN_CD                                /* (약) 단위(포장단위) */
				,  to_char(a.ICUN_ADMN_VLM) as ICUN_ADMN_VLM           /* (약) 투여량(함량단위) */
				,  a.ICUN_CD as ICUN_CD                                /* (약) 단위(함량단위) */
				,  to_char(a.NTM) as NTM                               /* (약) 횟수*/
				,  to_char(a.DDCN) as DDCN                             /* (약) 일수*/
				,  a.DRUS_CD as DRUS_CD                                /* (약) 용법코드*/
				,  a.FRNS_DPRT_CD as FRNS_DPRT_CD                      /* (약) 가야할 곳(약국)*/
				,  to_char(a.DRBN_NO) as DRBN_NO                       /* (약) 묶음번호*/
				,  a.SNGN_BNDL_YN as SNGN_BNDL_YN                      /* (약) 단독묶음여부*/
				,  a.MIX_KIND_CD as MIX_KIND_CD                        /* (약) MIX종류 */
				,  a.ASTS_YN as ASTS_YN                                /* (약) AST(After Skin Test) 여부 */
				,  a.ANTC_INJC_AHED_CMMD_YN as ANTC_INJC_AHED_CMMD_YN  /* (약) 항암주사 선조제여부 */
				,  a.ACDG_MIX_DVSN_CD as ACDG_MIX_DVSN_CD              /* (약) 항암제 Mix수액여부*/
				,  a.ANTB_GUID_GRP_VL as ANTB_GUID_GRP_VL              /* (약) 항균제GUIDE그룹 */
				,  b.ORDR_PSBL_DVSN_CD as ORDR_PSBL_DVSN_CD            /* (처방마스터) 처방가능여부*/
				,  a.FLUD_Q_HR_VL as FLUD_Q_HR_VL                      /*  Fluid Q */
				,  a.FLUD_CC_HR_VL as FLUD_CC_HR_VL                    /*  Fluid With cc/hr */
				,  to_char(a.FLUD_TOTL_QTY) as FLUD_TOTL_QTY           /*  Fluid 총량 */
				,  a.FLUD_OVER_VL as FLUD_OVER_VL                      /*  Fluid Over */
				,  to_char(a.IMPL_ORDR_PBLC_LMTT_NTM) as IMPL_ORDR_PBLC_LMTT_NTM      /*  실시처방발행제한횟수 */
				,  a.FRNS_CTRL_DVSN_CD as FRNS_CTRL_DVSN_CD                           /*  불출제어정보 KC */
				,  decode(SLCT_UNIT_DVSN_CD,
						  '1', lpad(to_char(a.PCKN_UNAD_QTY), 4, ' ') || rpad(a.PCUN_CD, 4, ' '),
						  '2', decode(substr(to_char(a.ICUN_ADMN_VLM), 1, 1),
									  '.', lpad('0'||to_char(a.ICUN_ADMN_VLM), 4, ' '),
									  lpad(to_char(a.ICUN_ADMN_VLM), 4, ' ')||' '||rpad(a.ICUN_CD, 4, ' ')))
							   ||' '||rpad(to_char(a.NTM), 2, ' ')||'회'||' '||rpad(a.DRUS_CD, 3, ' ')  as INFM_CTN
				,  d.USER_NM  as AFI_FRST_RGSR_NM
				,  to_char(a.FRST_RGST_DT, 'yyyymmdd') as FRST_RGST_DT
				,  to_char(a.CYCL_ORDR_FNSH_YMD  , 'yyyymmdd') as CYCL_ORDR_FNSH_YMD /*  주기처방종료일자  2010.01.19 YKC */
				,  to_char(a.CYCL_ORDR_STRT_YMD, 'yyyymmdd') as CYCL_ORDR_STRT_YMD   /*  주기처방시작일자  2010.01.19 YKC */
				,  a.CYCL_ORDV_CD as CYCL_ORDV_CD                                    /*  주기처방구분 1 : 요일별, 2 : 주기별*/
				,  a.CYCL_ORDR_DYWK_CTN as CYCL_ORDR_DYWK_CTN                        /*  주기처방-요일별*/
				,  a.CYCL_ORDR_DDCN as CYCL_ORDR_DDCN                                /*  주기처방-일자별*/
			 from
				(
				   SELECT  /*+ index(a MMMEDORT_PK) */
						   a.PTNO
						,  a.ORDR_YMD
						,  a.ORDR_SNO
						,  a.ODKI_CD
						,  a.MCDP_CD
					 from  MDMEDORDT a
					where  PTNO = #{ptno}
					  and  ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd')-32 and to_date(#{ordrYmd}, 'yyyymmdd')
					  and  DC_DVSN_CD = 'N'
					  and  CYCL_ORDV_CD = '1'
					  and  to_date(#{ordrYmd}, 'yyyymmdd') != CYCL_ORDR_STRT_YMD
					  and  to_date(#{ordrYmd}, 'yyyymmdd') between CYCL_ORDR_STRT_YMD
						   and CYCL_ORDR_FNSH_YMD
					  and  substr(CYCL_ORDR_DYWK_CTN, to_number(to_char(to_date(#{ordrYmd}, 'yyyymmdd'), 'd')), 1) = 'Y'
					  and  ODKI_CD = #{odkiCd}
					  and  not exists (
						   select  'Y'
							 from  CCCMCDDMT
							where  COMN_GRP_CD = 'MM894'
							  and  COMN_DTLS_CD = #{mcdpCd}
							  and  rownum < 2
					       )				
					  and  not exists (
						   SELECT  /*+ index(MMEXCEPT MMEXCEPT_IDX1) */
														  'Y'
							 from  MDEXCEPIT
							where  INQR_EXCL_DVSN_CD     = 'A'
							  and  PTNO    = a.PTNO
							  and  ORDR_YMD  = to_date(#{ordrYmd}, 'yyyymmdd')
							  and  ORDR_SNO = a.ORDR_SNO
							  and  OPTN_CTN1  = to_char(a.ORDR_YMD, 'yyyymmdd')
							  and  rownum < 2
					       )
					union  all
					SELECT  /*+ index(a MMMEDORT_PK) */
							a.PTNO
						 ,  a.ORDR_YMD
						 ,  a.ORDR_SNO
						 ,  a.ODKI_CD
						 ,  a.MCDP_CD
					 from  MDMEDORDT a
						 ,  (
							select  rownum NO1
							  from  CCCMCDDMT
							 where  rownum < 101
							) b
					where  PTNO = #{ptno}
					  and  ORDR_YMD between to_date(#{ordrYmd}, 'yyyymmdd')-32 and to_date(#{ordrYmd}, 'yyyymmdd')
					  and  DC_DVSN_CD = 'N'
					  and  ODKI_CD = #{odkiCd}
					  and  CYCL_ORDV_CD = '2'
					  and  to_date(#{ordrYmd}, 'yyyymmdd') != CYCL_ORDR_STRT_YMD
					  and  to_date(#{ordrYmd}, 'yyyymmdd') =  ( CYCL_ORDR_STRT_YMD + (CYCL_ORDR_DDCN * (b.NO1-1)))
					  and  to_date(#{ordrYmd}, 'yyyymmdd') <= CYCL_ORDR_FNSH_YMD
					  and  not exists (
						   select  'Y'
							 from  CCCMCDDMT
							where  COMN_GRP_CD = 'MM894'
							  and  COMN_DTLS_CD = #{mcdpCd}
							  and  rownum < 2
					)
					  and  not exists (
						   SELECT  /*+ index(MMEXCEPT MMEXCEPT_IDX1) */
								   'Y'
							 from  MDEXCEPIT
							where  INQR_EXCL_DVSN_CD  = 'A'
							  and  PTNO    = a.PTNO
							  and  ORDR_YMD  = to_date(#{ordrYmd}, 'yyyymmdd')
							  and  ORDR_SNO = a.ORDR_SNO
							  and  OPTN_CTN1  = to_char(a.ORDR_YMD, 'yyyymmdd')
							  and  rownum < 2)
					) c,
				   MDMEDORDT a,
				   MDORDRCMT b,
				   CCUSRDPHT d
			where  a.PTNO         = c.PTNO
			  and  a.ORDR_YMD     = c.ORDR_YMD
			  and  a.ORDR_SNO     = c.ORDR_SNO
			  and  a.DC_DVSN_CD   = 'N'       /*  취소된처방 제외 + DC된 처방제외*/
			  and  b.ORDR_CD      = a.ORDR_CD
			  and  a.FRST_RGSR_ID = d.USER_ID(+)
			  and  not exists (
				   select  1
					 from  MDMEDORDT c
					where  c.PTNO      = a.PTNO
					  and  c.ORDR_YMD  = a.ORDR_YMD
					  and  c.ORDR_SNO  = a.ORDR_SNO
					  and  c.DC_DVSN_CD = 'N'
					  and  c.ADTN_ORDV_CD = 'Y'
					  and  c.NTM = 1
					  and  c.INPT_USER_DVSN_CD = '2' )
			  and  NVL ( a.INPT_USER_DVSN_CD, 'X' ) != 'V'
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntTkngDrugOrdrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="mddrNm" column="MDDR_NM"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="mdcrDt" column="MDCR_DT"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="pcknUnadQty" column="PCKN_UNAD_QTY"/>
		<result property="pcunCd" column="PCUN_CD"/>
		<result property="ntm" column="NTM"/>
		<result property="ddcn" column="DDCN"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="mdprClsfCd" column="MDPR_CLSF_CD"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="tims1AdmnQty" column="TIMS1_ADMN_QTY"/>
		<result property="icunAdmnVlm" column="ICUN_ADMN_VLM"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="ordrPsblDvsnCd" column="ORDR_PSBL_DVSN_CD"/>
		<result property="saveDvsnCd" column="SAVE_DVSN_CD"/>
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="slipCd" column="SLIP_CD"/>
		<result property="fludTotlQty" column="FLUD_TOTL_QTY"/>
		<result property="fludCcHrVl" column="FLUD_CC_HR_VL"/>
		<result property="fludQHrVl" column="FLUD_Q_HR_VL"/>
		<result property="fludOverVl" column="FLUD_OVER_VL"/>
		<result property="drugOrdrUnslCtn" column="DRUG_ORDR_UNSL_CTN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntTkngDrugOrdrList () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntTkngDrugOrdrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntTkngDrugOrdrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntTkngDrugOrdrList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntTkngDrugOrdrList_복용중인 약 조회 */
				   c.ABRV_DPRT_CD as ABRV_DPRT_CD                                         /*  진료과         */
				,  a.ODDR_ID as ODDR_ID                                                   /*  진료의         */
				,  (select USER_NM from CCUSRDPHT where USER_ID = a.ODDR_ID) as MDDR_NM
				,  to_char(a.ORDR_YMD, 'yyyymmdd') as ORDR_YMD                            /*  처방일자       */
				,  to_char(p.MDCR_DT, 'yyyymmddhh24miss') as MDCR_DT                      /*  진료일         */
				,  b.ORDR_NM as ORDR_NM                                                   /*  처방명         */
				,  a.PCKN_UNAD_QTY as PCKN_UNAD_QTY                                       /*  포장단위투여량 */
				,  a.PCUN_CD as PCUN_CD                                                   /*  포장단위코드   */
				,  a.NTM as NTM                                                           /*  횟수           */
				,  a.DDCN - (trunc(sysdate)- a.ORDR_YMD) as DDCN                          /*  남은 일수      */
				,  a.ORDR_CD as ORDR_CD
				,  case when b.MDPR_CLSF_CD = '3' then 'Y' end as MDPR_CLSF_CD
				,  a.ODKI_CD as ODKI_CD                                                   /*  퇴원처방 표시  */
				,  '' as TIMS1_ADMN_QTY
				,  '' as ICUN_ADMN_VLM
				,  a.DRUS_CD as DRUS_CD                                                   /*  용법코드       */
				,  b.ORDR_PSBL_DVSN_CD as ORDR_PSBL_DVSN_CD
				,  'I' as SAVE_DVSN_CD     /*  저장구분 임시 */
				,  b.ORDR_CLTY_CD as ORDR_CLTY_CD
				,  b.SLIP_CD as SLIP_CD
				,  a.FLUD_TOTL_QTY as FLUD_TOTL_QTY                                       /*  Fluid 총량      */
				,  a.FLUD_CC_HR_VL as FLUD_CC_HR_VL                                       /*  수액CC_HR값     */
				,  a.FLUD_Q_HR_VL as FLUD_Q_HR_VL                                         /*  수액Q_HR값      */
				,  a.FLUD_OVER_VL as FLUD_OVER_VL                                         /*  수액Over값      */
				,  a.DRUG_ORDR_UNSL_CTN as DRUG_ORDR_UNSL_CTN                             /*  특기사항        */
			 from  MDMEDORDT a
				,  MDORDRCMT b
				,  HZDEPTMMT c
				,  APRCRPTNT p 
			where  a.PTNO    = #{ptno}
			  and  a.ORDR_YMD <= trunc(sysdate)
			  and  a.ORDR_YMD >= ( sysdate - 180 )
			  and  ((a.CODV_CD = 'O') or (a.ODKI_CD = 'D'))
			  and  a.ORDR_YMD + decode( DDCN, 0, 1, DDCN ) -1 >= trunc(sysdate)           /*  남은약이 있는 경우 */
			  and  a.DC_DVSN_CD = 'N'                                                     /*  DC, 취소 처방 제외 */
			  and  nvl(a.PHRM_RTRN_QTY, 0) <= 0                                           /*  약국 반납약이 0 이하 */
			  and  a.TMPR_ORDR_YN = 'N'                                                   /*  임시처방 제외 */
			  and  a.ORDR_CD = b.ORDR_CD (+)
			  and  a.MCDP_CD = c.DPRT_CD
			  and  p.MDRP_NO = a.MDRP_NO
		   order by a.ORDR_YMD, c.ABRV_DPRT_CD, a.ODDR_ID
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntMdprIdntRefrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="mddrNm" column="MDDR_NM"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="slipCd" column="SLIP_CD"/>
		<result property="mdprSmryMemoCtn" column="MDPR_SMRY_MEMO_CTN"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="ihohDvsnCd" column="IHOH_DVSN_CD"/>
		<result property="sdpfExreCd" column="SDPF_EXRE_CD"/>
		<result property="slctUnitDvsnCd" column="SLCT_UNIT_DVSN_CD"/>
		<result property="tims1AdmnQty" column="TIMS1_ADMN_QTY"/>
		<result property="pcunCd" column="PCUN_CD"/>
		<result property="icunAdmnVlm" column="ICUN_ADMN_VLM"/>
		<result property="icunCd" column="ICUN_CD"/>
		<result property="ntm" column="NTM"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="astsYn" column="ASTS_YN"/>
		<result property="ordrPsblDvsnCd" column="ORDR_PSBL_DVSN_CD"/>
		<result property="rplyYmd" column="RPLY_YMD"/>
		<result property="saveDvsnCd" column="SAVE_DVSN_CD"/>
		<result property="sbsnYn" column="SBSN_YN"/>
		<result property="casbCtn" column="CASB_CTN"/>
		<result property="dgmtRgstTypeCd" column="DGMT_RGST_TYPE_CD"/>
		<result property="ingrId" column="INGR_ID"/>
		<result property="rpmdId" column="RPMD_ID"/>
		<result property="sbsnYn2" column="SBSN_YN2"/>
		<result property="sbsnMdprCd" column="SBSN_MDPR_CD"/>
		<result property="sbsnOrdrNm" column="SBSN_ORDR_NM"/>
		<result property="sbsnOrdrPsblDvsnCd" column="SBSN_ORDR_PSBL_DVSN_CD"/>
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdprIdntDetlSno" column="MDPR_IDNT_DETL_SNO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntMdprIdntRefrList (약품식별의뢰 조회) 
        Description :                                           약품식별의뢰 건 중 결과회신이 된 약품식별의뢰목록을 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntMdprIdntRefrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntMdprIdntRefrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntMdprIdntRefrList-result" useCache="true" flushCache="false">
		<![CDATA[
		/*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntMdprIdntRefrList_약품 식별 조회 */				   
		SELECT e.ABRV_DPRT_CD as ABRV_DPRT_CD                               /*  진료과         */
			 , a.ODDR_ID as ODDR_ID                                         /*  진료의         */
			 , (select USER_NM from CCUSRDPHT where USER_ID = a.ODDR_ID) as MDDR_NM
			 , to_char(a.ORDR_YMD, 'yyyymmdd') as ORDR_YMD                  /*  처방일자 */
			 , to_char(a.ORDR_SNO) as ORDR_SNO                              /*  처방순번 */
			 , c.ORCL_CD as ORCL_CD                                         /*  처방분류 */
			 , c.ORDR_CLTY_CD as ORDR_CLTY_CD                               /*  처방구별 */
			 , nvl(b.INHS_MDPR_CD, b.SBSN_MDPR_CD) as ORDR_CD               /*  원내약품코드 기본, 없을 시 대체약품코드 - 처방코드 */
			 , c.SLIP_CD as SLIP_CD                                         /*  SLIP코드 */
			 , decode(b.INHS_MDPR_CD||b.SBSN_MDPR_CD, '', b.MDPR_SMRY_MEMO_CTN) as MDPR_SMRY_MEMO_CTN /*  약품요약 메모내용 */
			 , decode(b.INHS_MDPR_CD||b.SBSN_MDPR_CD, '', c.ORDR_NM||'-'||b.MDPR_SMRY_MEMO_CTN, c.ORDR_NM) as ORDR_NM /*  처방명 */
			 , decode(c.IHOH_DVSN_CD, '2', 'I', '3', 'O', '') as IHOH_DVSN_CD /*  원내원외구분코드 */
			 , c.SDPF_EXRE_CD as SDPF_EXRE_CD                               /*  의약분업예외사유코드 */
			 , '1' as SLCT_UNIT_DVSN_CD                                     /*  선택단위 구분 */
			 , b.TIMS1_ADMN_QTY as TIMS1_ADMN_QTY                           /*  1회투여량 */
			 , b.PCUN_CD as PCUN_CD                                         /*  포장단위코드 */
			 , to_char(to_number(b.TIMS1_ADMN_QTY)*to_number(c.PCUN_INLS_QTY)) as ICUN_ADMN_VLM /*  함량단위투여용량 */
			 , c.ICUN_CD as ICUN_CD                                         /*  함량단위코드 */
			 , to_char(b.NTM) as NTM                                        /*  횟수 */
			 , b.DRUS_CD as DRUS_CD                                         /*  용법코드 */
			 , '' as ASTS_YN                                                /*  AST(After Skin Test) 여부 */
			 , c.ORDR_PSBL_DVSN_CD as ORDR_PSBL_DVSN_CD                     /*  처방가능여부 */
			 , a.RPLY_YMD as RPLY_YMD
			 , 'I' as SAVE_DVSN_CD                                          /*  저장구분 임시 */
			 , decode(nvl(b.INHS_MDPR_CD, 'Y'), 'Y', 'Y', 'N') as SBSN_YN   /*  대체여부 */
			 , FN_MD_GET_DRUG_RISK_INFM (nvl(b.INHS_MDPR_CD, b.SBSN_MDPR_CD), to_char(a.ORDR_YMD, 'yyyymmdd'), '2') as CASB_CTN /* 주의사항내용 */
			 , (select DGMT_RGST_TYPE_CD from SDDDGCDMT where MDPR_CD = nvl(b.INHS_MDPR_CD, b.SBSN_MDPR_CD) and rownum = 1) as DGMT_RGST_TYPE_CD /* 약제등록유형코드 */
		     , b.INGR_ID /* 성분ID */
		     , b.RPMD_ID /* 대표약품ID */
		     , decode(SBSN_MDPR_CD,NULL,'N','Y') SBSN_YN2     /*대체코드 존재여부 */
		     , SBSN_MDPR_CD   /* 대체코드 */
		     , f.ORDR_NM as SBSN_ORDR_NM
		     , f.ORDR_PSBL_DVSN_CD as SBSN_ORDR_PSBL_DVSN_CD
		     , b.PTNO
		     , b.ORDR_YMD
		     , b.ORDR_SNO
		     , b.MDPR_IDNT_DETL_SNO
		  from MDCONSRCT a
			 , SDOCONSDT b
			 , MDORDRCMT c
			 , HZDEPTMMT e
		     , MDORDRCMT f
		 where a.PTNO = #{ptno}
		   and (
				 ( (nvl(#{inptVl}, 'N') = 'N') /*  처방현황 */
					and
					( a.RPLY_YMD >= decode(#{mdcrDt},'',to_date(#{ordrYmd},'yyyymmdd')-2-nvl(#{inpeDdcn},0),to_date(substr(#{mdcrDt},0,8),'yyyymmdd')-nvl(#{inpeDdcn},0)) )
				 )
				 or
				 (
				   (nvl(#{inptVl}, 'N') = 'Y') /*  약품식별처방전달(약국 - SDI201F2) */
				   and
				   (a.MDRP_NO = #{mdrpNo})
				 )
			    )
		   and a.CMTX_DVSN_CD = '7'       /*  협진구분코드(MM266) : 7 => 약품식별 */
		   and a.CMTX_STTS_CD = '4'       /*  협진상태(MM320)     : 4 => 최종회신 */
		   and a.PTNO         = b.PTNO
		   and a.ORDR_YMD     = b.ORDR_YMD
		   and a.ORDR_SNO     = b.ORDR_SNO
		   and c.ORDR_CD(+)   = nvl(b.INHS_MDPR_CD, b.SBSN_MDPR_CD) /* 원내약품코드 기본, 없을 시 대체약품코드 */
		   and a.MCDP_CD      = e.DPRT_CD
		   and f.ORDR_CD(+)   = b.SBSN_MDPR_CD
		 order by e.ABRV_DPRT_CD
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntAnagDittOrdrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="orfrCd" column="ORFR_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="slipCd" column="SLIP_CD"/>
		<result property="drugOrdrUnslCtn" column="DRUG_ORDR_UNSL_CTN"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="ihohDvsnCd" column="IHOH_DVSN_CD"/>
		<result property="sdpfExreCd" column="SDPF_EXRE_CD"/>
		<result property="slctUnitDvsnCd" column="SLCT_UNIT_DVSN_CD"/>
		<result property="pcknUnadQty" column="PCKN_UNAD_QTY"/>
		<result property="pcunCd" column="PCUN_CD"/>
		<result property="icunAdmnVlm" column="ICUN_ADMN_VLM"/>
		<result property="icunCd" column="ICUN_CD"/>
		<result property="ntm" column="NTM"/>
		<result property="ddcn" column="DDCN"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="frnsDprtCd" column="FRNS_DPRT_CD"/>
		<result property="drbnNo" column="DRBN_NO"/>
		<result property="sngnBndlYn" column="SNGN_BNDL_YN"/>
		<result property="mixKindCd" column="MIX_KIND_CD"/>
		<result property="astsYn" column="ASTS_YN"/>
		<result property="antcInjcAhedCmmdYn" column="ANTC_INJC_AHED_CMMD_YN"/>
		<result property="acdgMixDvsnCd" column="ACDG_MIX_DVSN_CD"/>
		<result property="antbGuidGrpVl" column="ANTB_GUID_GRP_VL"/>
		<result property="ordrPsblDvsnCd" column="ORDR_PSBL_DVSN_CD"/>
		<result property="implOrdrPblcLmttNtm" column="IMPL_ORDR_PBLC_LMTT_NTM"/>
		<result property="frnsCtrlDvsnCd" column="FRNS_CTRL_DVSN_CD"/>
		<result property="infmCtn" column="INFM_CTN"/>
		<result property="frstRgsrId" column="FRST_RGSR_ID"/>
		<result property="frstRgstDt" column="FRST_RGST_DT"/>
		<result property="dittOrdrAlwnDdcn" column="DITT_ORDR_ALWN_DDCN"/>
		<result property="fludQHrVl" column="FLUD_Q_HR_VL"/>
		<result property="fludCcHrVl" column="FLUD_CC_HR_VL"/>
		<result property="fludTotlQty" column="FLUD_TOTL_QTY"/>
		<result property="fludOverVl" column="FLUD_OVER_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntAnagDittOrdrList (항균제 DITTO 처방 조회) 
        Description :                                           대상 처방일로부터 1개월 이내의 항균제 처방 목록을 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntAnagDittOrdrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntAnagDittOrdrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntAnagDittOrdrList-result" useCache="true" flushCache="false">
		<![CDATA[
		   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntAnagDittOrdrList_항균제 DITTO 처방 조회 */
				   to_char(a.ORDR_YMD, 'yyyymmdd') as ORDR_YMD            /*  (공통) 처방일자    */
				,  a.ORDR_SNO as ORDR_SNO                                 /*  (공통) 처방순번    */
				,  a.ORCL_CD as ORCL_CD                                  /*  (공통) 처방분류    */
				,  a.ORDR_CLTY_CD as ORDR_CLTY_CD                             /*  (공통) 처방구별    */
				,  a.ORFR_CD as ORFR_CD                                  /*  (공통) 처방형태    */
				,  a.ORDR_CD as ORDR_CD                                  /*  (공통) 처방코드    */
				,  a.SLIP_CD as SLIP_CD                                  /*  (공통) SLIP코드    */
				,  a.DRUG_ORDR_UNSL_CTN as DRUG_ORDR_UNSL_CTN                       /*  (공통) 특기사항    */
				,  d.ORDR_NM as ORDR_NM                                  /*  (전체) 처방명      */
				,  a.IHOH_DVSN_CD as IHOH_DVSN_CD                             /*  (약) 원내/원외구분 */
				,  a.SDPF_EXRE_CD as SDPF_EXRE_CD                             /*  (약) 의약분업예외사유코드(원내처방사유) */
				,  a.SLCT_UNIT_DVSN_CD as SLCT_UNIT_DVSN_CD                        /*  (약) 선택단위구분  */
				,  to_char(a.PCKN_UNAD_QTY) as PCKN_UNAD_QTY                   /*  (약) 투여량(포장단위) */
				,  a.PCUN_CD as PCUN_CD                                  /*  (약) 단위(포장단위)   */
				,  to_char(a.ICUN_ADMN_VLM) as ICUN_ADMN_VLM                   /*  (약) 투여량(함량단위) */
				,  a.ICUN_CD as ICUN_CD                                  /*  (약) 단위(함량단위)   */
				,  to_char(a.NTM) as NTM                             /*  (약) 횟수          */
				,  to_char(a.DDCN) as DDCN                            /*  (약) 일수          */
				,  a.DRUS_CD as DRUS_CD                                  /*  (약) 용법코드      */
				,  a.FRNS_DPRT_CD as FRNS_DPRT_CD                             /*  (약) 가야할 곳(약국) => 불출 부서 코드 */
				,  to_char(a.DRBN_NO) as DRBN_NO                         /*  (약) 묶음번호      */
				,  a.SNGN_BNDL_YN as SNGN_BNDL_YN                             /*  (약) 단독묶음여부  */
				,  a.MIX_KIND_CD as MIX_KIND_CD                              /*  (약) MIX종류       */
				,  a.ASTS_YN as ASTS_YN                                  /*  (약) AST(After Skin Test) 여부 */
				,  a.ANTC_INJC_AHED_CMMD_YN as ANTC_INJC_AHED_CMMD_YN                   /*  (약) 항암주사 선조제여부 */
				,  a.ACDG_MIX_DVSN_CD as ACDG_MIX_DVSN_CD                         /*  (약) 항암제 Mix수액여부  */
				,  a.ANTB_GUID_GRP_VL as ANTB_GUID_GRP_VL                         /*  (약) 항균제GUIDE그룹     */
				,  d.ORDR_PSBL_DVSN_CD as ORDR_PSBL_DVSN_CD                       /*  (처방마스터) 처방가능여부 */
				/*  ,  a.Ordtyp2_ASIS */                       /*  (약처방) 자가약여부  S : Self Order : O */
				,  to_char(a.IMPL_ORDR_PBLC_LMTT_NTM) as IMPL_ORDR_PBLC_LMTT_NTM         /*  Prn 제한횟수 PRN_LMTT_NTM  */
				,  a.FRNS_CTRL_DVSN_CD as FRNS_CTRL_DVSN_CD                        /*  불출제어정보 */
				,  decode(SLCT_UNIT_DVSN_CD, '1', lpad(to_char(a.PCKN_UNAD_QTY), 4, ' ') || rpad(a.PCUN_CD, 4, ' '),
											 '2', decode(substr(to_char(a.ICUN_ADMN_VLM), 1, 1),
											 '.', lpad('0'||to_char(a.ICUN_ADMN_VLM), 4, ' '),
											 lpad(to_char(a.ICUN_ADMN_VLM), 4, ' ')||' '||rpad(a.ICUN_CD, 4, ' ')))
						 ||' '||rpad(to_char(a.NTM), 2, ' ')||'회'||' '||rpad(a.DRUS_CD, 3, ' ') as INFM_CTN
				,  a.FRST_RGSR_ID as FRST_RGSR_ID
				,  to_char(a.FRST_RGST_DT, 'yyyymmdd') as FRST_RGST_DT
				,  c.DITT_ORDR_ALWN_DDCN as DITT_ORDR_ALWN_DDCN                      /*  DITTO 기간 */
				,  a.FLUD_Q_HR_VL as FLUD_Q_HR_VL                             /*  Fluid Q    */
				,  a.FLUD_CC_HR_VL as FLUD_CC_HR_VL                            /*  Fluid With cc/hr */
				,  to_char(a.FLUD_TOTL_QTY) as FLUD_TOTL_QTY                   /*  Fluid 총량 */
				,  a.FLUD_OVER_VL as FLUD_OVER_VL                             /*  Fluid Over */
			 from
				   MDMEDORDT a      /*  약처방 */
				,  MDANTBPAT b      /*  항생제처방환자 */
				,  MDOSETBST c      /*  처방SET기본 */
				,  MDORDRCMT d      /*  처방코드기본 */
			where
				   a.PTNO  = #{ptno}
			  and  trunc(a.ORDR_YMD) >= trunc(to_date(#{ordrYmd}, 'yyyymmdd')) - 32 -->
			  and  trunc(a.ORDR_YMD) <= trunc(to_date(#{ordrYmd}, 'yyyymmdd'))
			  and  a.MDRP_NO = #{mdrpNo}
			  and  a.ANTB_GUID_GRP_VL not like 'ANT%'
			  and  a.CODV_CD = #{codvCd}
			  and  nvl(a.DC_DVSN_CD, 'N') = 'N'
			  and  nvl(a.ORDR_CRTN_DVSN_CD, '00') <> '08'  /*  PRN실시처방 제외 */
			  and  nvl(a.INPT_USER_DVSN_CD, 'X') != 'V'    /*  간호입력처방 제외 */
			  and  trunc(to_date(#{ordrYmd}, 'yyyymmdd')) != a.ORDR_YMD
			  and  trunc(to_date(#{ordrYmd}, 'yyyymmdd')) between a.ORDR_YMD and a.ORDR_YMD + nvl ( c.DITT_ORDR_ALWN_DDCN, 0 ) - 1
			  and  b.PTNO     = a.PTNO
			  and  b.ORDR_YMD = a.ORDR_YMD
			  and  trim(to_char(b.ANTB_ORDR_APLY_NTM)) = a.ANTB_GUID_GRP_VL
			  and  b.DITT_YN      = 'N'
			  and  c.OSET_CD      = b.OSET_CD
			  and  c.OSET_SNO     = b.OSET_SNO
			  and  c.OSET_DVSN_CD = b.OSET_DVSN_CD
			  and  d.ORDR_CD      = a.ORDR_CD
			  and  not exists
				   (
				   select  'Y'
					 from  MZCTRLMMT
					where  MDCR_CTRL_CD = 'MM894'
					  and  MDCR_DTLS_CTRL_CD = #{mcdpCd}
					  and  rownum < 2
				   )
			  and  not exists
				   (
				   select 'Y'
					 from  MDEXCEPIT
					where  INQR_EXCL_DVSN_CD     = 'B' /*  항균제DITTO관련 */
					  and  PTNO      = a.PTNO
					  and  trunc(ORDR_YMD)  = trunc(to_date(#{ordrYmd}, 'yyyymmdd'))
					  and  OPTN_CTN1 = to_char(a.ORDR_YMD, 'yyyymmdd')
					  and  ORDR_SNO  = a.ORDR_SNO
					  and  rownum < 2
				   )
			  and  not exists
				   (
				   select  1
					 from  MDMEDORDT z
					where  z.PTNO      = a.PTNO
					  and  z.ORDR_YMD  = a.ORDR_YMD
					  and  z.ORDR_SNO  = a.ORDR_SNO
					  and  nvl(z.DC_DVSN_CD, 'N') = 'N'
					  and  z.ADTN_ORDV_CD = 'Y'
					  and  z.NTM = 1
					  and  z.INPT_USER_DVSN_CD = '2'
				   )  /*  간호 1회추가 처방은 제외 */
			order
			   by  /*  decode(a.ORFR_CD, 'P', decode(a.ORDTYP2_ASIS, 'S', 2, 3), 1) */
				   decode(a.ODKI_CD, 'G', 1, 'R', 2, 'O', 3, 4)
				,  decode(a.DRAP_DVSN_CD, '9', decode(a.DRBN_NO, null, a.DRAP_DVSN_CD, '1'), a.DRAP_DVSN_CD)
				,  a.ORFR_CD
				,  a.DRBN_NO
				,  a.ORDR_SNO
			]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntLtstDrugBefOrdrList-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="saveDvsnCd" column="SAVE_DVSN_CD"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="mdcrDt" column="MDCR_DT"/>
		<result property="orocDprtCd" column="OROC_DPRT_CD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="orfrCd" column="ORFR_CD"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="slipCd" column="SLIP_CD"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="adtnOrdvCd" column="ADTN_ORDV_CD"/>
		<result property="ordrCrtnDvsnCd" column="ORDR_CRTN_DVSN_CD"/>
		<result property="sortSqnc" column="SORT_SQNC"/>
		<result property="ordrUnslCtn" column="ORDR_UNSL_CTN"/>
		<result property="careSttsCd" column="CARE_STTS_CD"/>
		<result property="rgorFinsDt" column="RGOR_FINS_DT"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
		<result property="dcOddrId" column="DC_ODDR_ID"/>
		<result property="dcOrdrDt" column="DC_ORDR_DT"/>
		<result property="ordrIpdvCd" column="ORDR_IPDV_CD"/>
		<result property="ptadIpdvCd" column="PTAD_IPDV_CD"/>
		<result property="rcstCd" column="RCST_CD"/>
		<result property="inptUserDvsnCd" column="INPT_USER_DVSN_CD"/>
		<result property="lastUpdtDt" column="LAST_UPDT_DT"/>
		<result property="ordrNm" column="ORDR_NM"/>
		<result property="actnNtm" column="ACTN_NTM"/>
		<result property="implOrdrPblcNtm" column="IMPL_ORDR_PBLC_NTM"/>
		<result property="mdprClsfCd" column="MDPR_CLSF_CD"/>
		<result property="drapDvsnCd" column="DRAP_DVSN_CD"/>
		<result property="ihohDvsnCd" column="IHOH_DVSN_CD"/>
		<result property="sdpfExreCd" column="SDPF_EXRE_CD"/>
		<result property="slctUnitDvsnCd" column="SLCT_UNIT_DVSN_CD"/>
		<result property="pcknUnadQty" column="PCKN_UNAD_QTY"/>
		<result property="pcunCd" column="PCUN_CD"/>
		<result property="icunAdmnVlm" column="ICUN_ADMN_VLM"/>
		<result property="icunCd" column="ICUN_CD"/>
		<result property="ntm" column="NTM"/>
		<result property="ddcn" column="DDCN"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="injcPrrnYmd" column="INJC_PRRN_YMD"/>
		<result property="frnsDprtCd" column="FRNS_DPRT_CD"/>
		<result property="drbnNo" column="DRBN_NO"/>
		<result property="sngnBndlYn" column="SNGN_BNDL_YN"/>
		<result property="mixKindCd" column="MIX_KIND_CD"/>
		<result property="astsYn" column="ASTS_YN"/>
		<result property="prvnInjcOrno" column="PRVN_INJC_ORNO"/>
		<result property="durvResnCtn" column="DURV_RESN_CTN"/>
		<result property="nrdrPrtxPrinNtm" column="NRDR_PRTX_PRIN_NTM"/>
		<result property="phdpPrinYn" column="PHDP_PRIN_YN"/>
		<result property="sbsnUpdtCmmdYn" column="SBSN_UPDT_CMMD_YN"/>
		<result property="antcInjcAhedCmmdYn" column="ANTC_INJC_AHED_CMMD_YN"/>
		<result property="acdgMixDvsnCd" column="ACDG_MIX_DVSN_CD"/>
		<result property="paclAftrDrrtQty" column="PACL_AFTR_DRRT_QTY"/>
		<result property="antbGuidGrpVl" column="ANTB_GUID_GRP_VL"/>
		<result property="anclCd1" column="ANCL_CD_1"/>
		<result property="anclCd2" column="ANCL_CD_2"/>
		<result property="anclCd3" column="ANCL_CD_3"/>
		<result property="anclCd4" column="ANCL_CD_4"/>
		<result property="anclCd5" column="ANCL_CD_5"/>
		<result property="anagPathNm" column="ANAG_PATH_NM"/>
		<result property="athnId" column="ATHN_ID"/>
		<result property="crtfDt" column="CRTF_DT"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="clrsPrjcDrId" column="CLRS_PRJC_DR_ID"/>
		<result property="insrYr3InouDvsnCd" column="INSR_YR3_INOU_DVSN_CD"/>
		<result property="frnsCtrlDvsnCd" column="FRNS_CTRL_DVSN_CD"/>
		<result property="totlVlm" column="TOTL_VLM"/>
		<result property="frnsVlm" column="FRNS_VLM"/>
		<result property="cyclOrdvCd" column="CYCL_ORDV_CD"/>
		<result property="cyclOrdrDywkCtn" column="CYCL_ORDR_DYWK_CTN"/>
		<result property="cyclOrdrDdcn" column="CYCL_ORDR_DDCN"/>
		<result property="cyclOrdrStrtYmd" column="CYCL_ORDR_STRT_YMD"/>
		<result property="cyclOrdrFnshYmd" column="CYCL_ORDR_FNSH_YMD"/>
		<result property="fludQHrVl" column="FLUD_Q_HR_VL"/>
		<result property="fludCcHrVl" column="FLUD_CC_HR_VL"/>
		<result property="fludTotlQty" column="FLUD_TOTL_QTY"/>
		<result property="fludOverVl" column="FLUD_OVER_VL"/>
		<result property="implOrdrPblcLmttNtm" column="IMPL_ORDR_PBLC_LMTT_NTM"/>
		<result property="vatTrgtYn" column="VAT_TRGT_YN"/>
		<result property="prtxRltnResnCtn" column="PRTX_RLTN_RESN_CTN"/>
		<result property="fludOrdrYn" column="FLUD_ORDR_YN"/>
		<result property="tims1TotlQtyYn" column="TIMS1_TOTL_QTY_YN"/>
		<result property="dgfrCd" column="DGFR_CD"/>
		<result property="kitMdprDdcn" column="KIT_MDPR_DDCN"/>
		<result property="pcunInlsQty" column="PCUN_INLS_QTY"/>
		<result property="saveDvsnCd" column="SAVE_DVSN_CD"/>
		<result property="cnntOrdrBndlNo" column="CNNT_ORDR_BNDL_NO"/>
		<result property="tmprOrdrYn" column="TMPR_ORDR_YN"/>
		<result property="ordrPsblDvsnCd" column="ORDR_PSBL_DVSN_CD"/>
		<result property="subjIdntNo" column="SUBJ_IDNT_NO"/>
		<result property="subjIntiVl" column="SUBJ_INTI_VL"/>
		<result property="subjVistNm" column="SUBJ_VIST_NM"/>
		<result property="subjAdmnVl" column="SUBJ_ADMN_VL"/>
		<result property="clncExamMdprCtn" column="CLNC_EXAM_MDPR_CTN"/>
		<result property="ordrCltyCd1" column="ORDR_CLTY_CD_1"/>
		<result property="ptptCd" column="PTPT_CD"/>
		<result property="bsisIcunCd" column="BSIS_ICUN_CD"/>
		<result property="chldIcunCd" column="CHLD_ICUN_CD"/>
		<result property="chldPcunIcqyVl" column="CHLD_PCUN_ICQY_VL"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntLtstDrugBefOrdrList (최근 약 전처방 일자 조회) 
        Description :                                           최근 약 전처방 일자를 조회한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntLtstDrugBefOrdrList-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntLtstDrugBefOrdrList"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntLtstDrugBefOrdrList-result" useCache="true" flushCache="false">
		<![CDATA[
				   SELECT  /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listPtntLtstDrugBefOrdrList_최근_약주사_전처방조회 */
		                  'I' as SAVE_DVSN_CD  
						,  to_char(a.ORDR_YMD, 'YYYYMMDD') as ORDR_YMD     /* (공통) 처방일자                           */
						,  a.ORDR_SNO as ORDR_SNO     /* (공통) 처방순번                           */
						,  a.CODV_CD as CODV_CD                                       /* (공통) 환자구분                           */
						,  to_char(p.MDCR_DT, 'yyyymmddhh24miss') as MDCR_DT /* (공통) 진료/입원/수술(DSC)/응급실도착일시 */
						,  a.OROC_DPRT_CD as OROC_DPRT_CD                                       /* (공통) 처방발생원                         */
						,  a.MCDP_CD as MCDP_CD                       /* (공통) 진료과                             */
						,  a.ORCL_CD as ORCL_CD                                       /* (공통) 처방분류                           */
						,  a.ODKI_CD as ODKI_CD                                       /* (공통) 처방종류                           */
						,  a.ORDR_CLTY_CD as ORDR_CLTY_CD                                  /* (공통) 처방구별                           */
						,  a.ORFR_CD as ORFR_CD                                       /* (공통) 처방형태                           */
						,  a.ORDR_CD as ORDR_CD                                       /* (공통) 처방코드                           */
						,  a.SLIP_CD as SLIP_CD                                       /* (공통) SLIP코드                           */
						,  a.ODDR_ID as ODDR_ID                                       /* (공통) 처방의사                           */
						,  a.ADTN_ORDV_CD as ADTN_ORDV_CD                                  /* (공통) 추가처방여부                       */
						,  a.ORDR_CRTN_DVSN_CD as ORDR_CRTN_DVSN_CD                             /* (공통) CP적용여부                         */
						,  a.SORT_SQNC as SORT_SQNC    /* (공통) 나열순서                           */
						,  a.DRUG_ORDR_UNSL_CTN as ORDR_UNSL_CTN                                 /* (공통) 특기사항                           */
						,  a.CARE_STTS_CD as CARE_STTS_CD                                  /* (공통) 간호STATUS                     */
						,  a.RGOR_FINS_DT as RGOR_FINS_DT                                  /* (공통) 정규처방완료일시                   */
						,  a.DC_DVSN_CD as DC_DVSN_CD                                    /* (공통) D/C여부                            */
						,  a.DC_ODDR_ID as DC_ODDR_ID                                    /* (공통) D/C처방의사                        */
						,  a.DC_ORDR_DT as DC_ORDR_DT                                    /* (공통) D/C처방일시                        */
						,  a.ORDR_IPDV_CD as ORDR_IPDV_CD                                  /* (공통) 급여구분(처방)                     */
						,  a.PTAD_IPDV_CD as PTAD_IPDV_CD                                  /* (공통) 급여구분(심사)                     */
						,  a.RCST_CD as RCST_CD                                       /* (공통) 수납구분                           */
						,  a.INPT_USER_DVSN_CD as INPT_USER_DVSN_CD                            /* (공통) 입력USER구분(1.의사 2.간호사)      */
						,  to_char(a.LAST_UPDT_DT, 'yyyymmddhh24miss') as LAST_UPDT_DT /* (공통) 수정일시                 */
						,  b.ORDR_NM as ORDR_NM
						,  a.ACTN_NTM as ACTN_NTM                 /* (기본/약/처치/수혈) ACTING실시 횟수       */
						,  a.IMPL_ORDR_PBLC_NTM as IMPL_ORDR_PBLC_NTM                            /* (약/검사) PRN실시횟수                     */
						,  a.MDPR_CLSF_CD as MDPR_CLSF_CD                                  /* (약) 약품분류                             */
						,  a.DRAP_DVSN_CD as DRAP_DVSN_CD                                  /* (약) 약적용구분                           */
						,  a.IHOH_DVSN_CD as IHOH_DVSN_CD                                  /* (약) 원내/원외구분                        */
						,  a.SDPF_EXRE_CD as SDPF_EXRE_CD                                  /* (약) 의약분업예외사유코드(원내처방사유)   */
						,  a.SLCT_UNIT_DVSN_CD as SLCT_UNIT_DVSN_CD                             /* (약) 선택단위구분                         */
						,  a.PCKN_UNAD_QTY as PCKN_UNAD_QTY                /* (약) 투여량(포장단위)                     */
						,  a.PCUN_CD as PCUN_CD                                       /* (약) 단위(포장단위)                       */
						,  a.ICUN_ADMN_VLM as ICUN_ADMN_VLM                /* (약) 투여량(함량단위)                     */
						,  a.ICUN_CD as ICUN_CD                                       /* (약) 단위(함량단위)                       */
						,  a.NTM as NTM                          /* (약) 횟수                                 */
						,  a.DDCN as DDCN                         /* (약) 일수                                 */
						,  a.DRUS_CD as DRUS_CD                                       /* (약) 용법코드                             */
						,  to_char(a.INJC_PRRN_YMD, 'yyyymmdd') as INJC_PRRN_YMD /* (약) 투약개시일자                   */
						,  a.FRNS_DPRT_CD as FRNS_DPRT_CD                                  /* (약) 가야할 곳(약국) a.PHRM_PTGO_CD -> 불출장소 코드로 변경  */
						,  a.DRBN_NO as DRBN_NO             /* (약) 묶음번호                             */
						,  a.SNGN_BNDL_YN as SNGN_BNDL_YN                                  /* (약) 단독묶음여부                         */
						,  a.MIX_KIND_CD as MIX_KIND_CD                                   /* (약) MIX종류                              */
						,  a.ASTS_YN as ASTS_YN                                       /* (약) AST(After Skin Test) 여부            */
						,  a.PRVN_INJC_ORNO as PRVN_INJC_ORNO                                /* (약) 예방주사차수(B형간염수직감염)        */
						,  a.DURV_RESN_CTN as DURV_RESN_CTN                                 /* (약) 약물상호작용 치명적사유              */
						,  a.NRDR_PRTX_PRIN_NTM as NRDR_PRTX_PRIN_NTM /* (약) 마약처방전출력횟수               */
						,  a.PHDP_PRIN_YN as PHDP_PRIN_YN                                  /* (약) 약제부출력여부                       */
						,  a.SBSN_UPDT_CMMD_YN as SBSN_UPDT_CMMD_YN                             /* (약) 대체/수정조제여부                    */
						,  a.ANTC_INJC_AHED_CMMD_YN as ANTC_INJC_AHED_CMMD_YN                        /* (약) 항암주사 선조제여부                  */
						,  a.ACDG_MIX_DVSN_CD as ACDG_MIX_DVSN_CD                              /* (약) 항암제 Mix수액여부                   */
						,  a.PACL_AFTR_DRRT_QTY as PACL_AFTR_DRRT_QTY      /* (약) 반납량(원무계산후)               */
						,  a.ANTB_GUID_GRP_VL as ANTB_GUID_GRP_VL                              /* (약) 항균제GUIDE그룹                      */
						,  a.ANCL_CD1 as ANCL_CD_1                                      /* (약) 항균제분류1                          */
						,  a.ANCL_CD2 as ANCL_CD_2                                      /* (약) 항균제분류2                          */
						,  a.ANCL_CD3 as ANCL_CD_3                                      /* (약) 항균제분류3                          */
						,  a.ANCL_CD4 as ANCL_CD_4                                      /* (약) 항균제분류4                          */
						,  a.ANCL_CD5 as ANCL_CD_5                                      /* (약) 항균제분류5                          */
						,  a.ANAG_PATH_NM     as ANAG_PATH_NM                             /* (약) 항균제경로명                         */
						-- ,  decode(a.ATHN_ID, null, null, a.ATHN_ID||'['||(select USER_NM from CCUSRDPHT where USER_ID = a.ATHN_ID)||']') as ATHN_ID
						,  a.ATHN_ID
						,  to_char(a.CRTF_DT, 'yyyymmddhh24miss') as CRTF_DT  /* (공통) <EMR인증>    인증일시 */
						,  a.CLRS_PRJC_CD    as CLRS_PRJC_CD                                             /* (공통) <임상연구비> Project코드 */
						,  a.CLRS_PRJC_DR_ID as CLRS_PRJC_DR_ID
						,  a.INSR_YR3_INOU_DVSN_CD as INSR_YR3_INOU_DVSN_CD                              /* (약)   보험-3년 내외구분        */
						,  a.FRNS_CTRL_DVSN_CD as FRNS_CTRL_DVSN_CD                                      /*  불출제어정보                   */
						,  a.TOTL_VLM as TOTL_VLM /*  총량                                     */
						,  a.FRNS_VLM as FRNS_VLM /*  불출량                                   */
						,  a.CYCL_ORDV_CD as CYCL_ORDV_CD                                 /*  주기구분                                 */
						,  a.CYCL_ORDR_DYWK_CTN as CYCL_ORDR_DYWK_CTN                           /*  주기요일별                               */
						,  a.CYCL_ORDR_DDCN as CYCL_ORDR_DDCN                               /*  주기일자별                               */
						,  to_char(a.CYCL_ORDR_STRT_YMD, 'yyyymmdd') as CYCL_ORDR_STRT_YMD /*  주기시작일자                         */
						,  to_char(a.CYCL_ORDR_FNSH_YMD, 'yyyymmdd') as CYCL_ORDR_FNSH_YMD /*  주기종료일자                         */
						,  a.FLUD_Q_HR_VL as FLUD_Q_HR_VL                                  /*  Fluid Q                    */
						,  a.FLUD_CC_HR_VL as FLUD_CC_HR_VL                                /*  Fluid With cc/hr           */
						,  a.FLUD_TOTL_QTY as FLUD_TOTL_QTY                                /*  Fluid 총량 */
						,  a.FLUD_OVER_VL as FLUD_OVER_VL                                  /*  Fluid Over                 */
						,  a.IMPL_ORDR_PBLC_LMTT_NTM as IMPL_ORDR_PBLC_LMTT_NTM /*  Prn 제한횟수 */
						,  a.VAT_TRGT_YN   as VAT_TRGT_YN                                /*  VAT여부                      */
						,  a.PRTX_RLTN_RESN_CTN as PRTX_RLTN_RESN_CTN                           /* (약) DUR 기타사유                         */
						,  b.FLUD_ORDR_YN as FLUD_ORDR_YN                                 /*  수액처방여부 */
						,  b.TIMS1_TOTL_QTY_YN as TIMS1_TOTL_QTY_YN                            /*  총량계산 */
						,  b.DGFR_CD as DGFR_CD                                      /*  제형코드 */
						,  0 as KIT_MDPR_DDCN/* b.KIT_MDPR_DDCN                                /*  KIT약품일수 */
						,  b.PCUN_INLS_QTY as PCUN_INLS_QTY                                /*  포장단위포함량 ( 용량, 수량 변경시 기준 함량으로 사용 ) */
						,  'I' as SAVE_DVSN_CD     /*  저장구분 임시 */
						,  a.CNNT_ORDR_BNDL_NO as CNNT_ORDR_BNDL_NO
						,  a.TMPR_ORDR_YN as TMPR_ORDR_YN
						,  b.ORDR_PSBL_DVSN_CD as ORDR_PSBL_DVSN_CD
						,  a.SUBJ_IDNT_NO as SUBJ_IDNT_NO                                                         /* (약) 피험자식별번호 */
						,  a.SUBJ_INTI_VL as SUBJ_INTI_VL                                                         /* (약) 피험자이니셜값 */
						,  a.SUBJ_VIST_NM as SUBJ_VIST_NM                                                         /* (약) 피험자방문명 */
						,  a.SUBJ_ADMN_VL as SUBJ_ADMN_VL                                                         /* (약) 피험자투여값 */
						,  a.CLNC_EXAM_MDPR_CTN as CLNC_EXAM_MDPR_CTN                                             /* (약) 임상시험약품내용 */
		                ,  b.ORDR_CLTY_CD as ORDR_CLTY_CD_1
		                ,  a.PTAD_PTGO_CD as PTPT_CD
		                ,  b.ICUN_CD      as BSIS_ICUN_CD
		                ,  b.CHLD_ICUN_CD as CHLD_ICUN_CD
		                ,  b.CHLD_PCUN_ICQY_VL  as CHLD_PCUN_ICQY_VL 
					 from
						   MDMEDORDT a
						,  MDORDRCMT b
						,  HZDEPTMMT g
						,  APRCRPTNT p /*  진료접수 */
					where  a.PTNO        = #{ptno}
					  and  a.ORDR_YMD    = to_date(#{ordrYmd}, 'yyyymmdd')
		]]>		   
		            <if test='orocDprtCd != null and orocDprtCd != ""'>
		              and  a.OROC_DPRT_CD = #{orocDprtCd}
		            </if>    
		            <if test='mdrpNo != 0'>
		              and  a.MDRP_NO = #{mdrpNo}
		            </if>  
		            <if test='mcdpCd != null and mcdpCd != ""'>
		              and  a.MCDP_CD = #{mcdpCd}
		            </if>
		            <if test='codvCd != null and codvCd !=""'>
					  and  a.CODV_CD = #{codvCd}
		            </if>
		            <if test='odkiCd != null and odkiCd != ""'>
					  and  a.ODKI_CD = #{odkiCd}
		            </if>
		            <if test='chdrId != null and chdrId != ""'>
		              and  a.CHDR_ID = #{chdrId}
		            </if>
		            <if test='odkiCd == "I"'>
		              and  a.DRUS_CD = 'CIV'
		            </if>
		<![CDATA[              
					  and  ((a.ORCL_CD is null)
							 or ((a.ORCL_CD is not null) and (a.ORCL_CD <> 'NTR')))      /*  간호처치 교육처방 제외(처방코드마스터에 없는것) */
					  and  a.DC_DVSN_CD = 'N'                                            /*  DC, 취소된처방 제외 */
					  and  nvl( a.ORDR_CRTN_DVSN_CD, 'X' ) not in ( '08' , '10' , '11', '93' ) /*  PRN실시처방 , 응급실1차실시처방 , 1회추가실시처방, 의사1회추가처방 */
					  and  nvl( INPT_USER_DVSN_CD, 'X' ) != 'V'
					  and  b.ORDR_CD(+) = a.ORDR_CD
					  and  a.MCDP_CD = g.DPRT_CD
					  and  p.MDRP_NO = a.MDRP_NO
		              and  not exists (select  1
		                                 from  MDMEDORDT Sa
		                                where  Sa.MDRP_NO = a.MDRP_NO
		                                  and  Sa.ODKI_CD = a.ODKI_CD
		                                  and  Sa.ORDR_CD = a.ORDR_CD
		                                  and  Sa.PTNO    = a.PTNO
		                                  and  Sa.DC_DVSN_CD = 'N'
		                                  and  ((Sa.CYCL_ORDV_CD = '1' and Sa.CYCL_ORDR_DYWK_CTN <> 'NNNNNNN') or
		                                        (Sa.CYCL_ORDV_CD = '2' and Sa.CYCL_ORDR_DDCN > 0) 
		                                       )
		                                  and  Sa.CYCL_ORDR_STRT_YMD <= to_date(#{baseYmd}, 'yyyymmdd')
		                                  and  Sa.CYCL_ORDR_FNSH_YMD >= to_date(#{baseYmd}, 'yyyymmdd'))    /* 약처방 자동복사시 현재 주기처방으로 유효한 처방코드는 복사되지 않도록 한다. */
				 order  by  a.FRST_RGST_DT
		                      ,  a.SORT_SQNC
		                      ,  a.ORDR_SNO
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listDrugOrdrThdyMxmmBndlNo-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="drbnNo" column="DRBN_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listDrugOrdrThdyMxmmBndlNo (환자번호, 처방일 조회조건 약처방 Max 묶음번호 구하기) 
        Description :                                           환자번호, 처방일 조회조건 약처방 Max 묶음번호를 구한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listDrugOrdrThdyMxmmBndlNo-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listDrugOrdrThdyMxmmBndlNo"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listDrugOrdrThdyMxmmBndlNo-result" useCache="true" flushCache="false">
		 select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listDrugOrdrThdyMxmmBndlNo */
		           nvl(max(DRBN_NO),0) as DRBN_NO  /* 묶음번호Max*/
		  from  MDMEDORDT
		where  PTNO = #{ptno}
		    and  ORDR_YMD = to_date( #{ordrYmd}, 'yyyymmdd' )
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugOrdr (약주사 처방 Update) 
        Description :                                           처방 내림한 약주사 처방을 수정한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		 update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugOrdr */
		             MDMEDORDT
		      set
		             TMPR_ORDR_YN = #{tmprOrdrYn}
		          ,  DRUG_ORDR_UNSL_CTN = #{drugOrdrUnslCtn} 					/*  추가 */
		          ,  MCDP_CD = #{mcdpCd}    									            /*  진료과코드 */
		          ,  WARD_CD = #{wardCd}    									            /*  병동코드 */
		          ,  ORCL_CD  = #{orclCd}   									                /*  처방분류코드 */
		          ,  ODKI_CD  = #{odkiCd}   									                /*  처방종류코드 */
		          ,  ODKI_DETL_CD =#{odkiDetlCd}   							            /*  처방종류상세코드(신규) */
		          ,  ORDR_CLTY_CD = #{ordrCltyCd} 							            /*  처방분류유형코드 */
		          ,  ORFR_CD = case when SUBSTR(ORDR_CD, 0,4) = 'SELF' THEN 'S' 
		                                    when #{orfrCd} is null then 'A' else #{orfrCd} end 						/* 처방형태코드*/
		          ,  SLIP_CD = #{slipCd} 										                /*  SLIP 코드 */
		          ,  GNDR_ID = #{gndrId} 										                /*  주치의사ID */
		          ,  OPSR_ID = #{opsrId} 										                /*  집도의사ID */
		          ,  CPDR_ID = #{cpdrId} 										                /*  협진의사ID */
		          ,  IHOH_DVSN_CD = #{ihohDvsnCd} 							        /*  원내원외구분코드 */
		          ,  SDPF_EXRE_CD = #{sdpfExreCd} 							            /*  의약분업예외사유코드 */
		          ,  SLCT_UNIT_DVSN_CD = #{slctUnitDvsnCd} 				  	        /*  선택단위구분코드 */
		          ,  PCKN_UNAD_QTY = #{pcknUnadQty} 							    /*  포장단위투여량 */
		          ,  PCUN_CD = #{pcunCd} 										            /*  포장단위코드 */
		          ,  ICUN_ADMN_VLM = #{icunAdmnVlm} 							    /*  함량단위투여용량 */
		          ,  NTM = #{ntm} 											                    /*  횟수 */
		          ,  DDCN = #{ddcn} 											                /*  일수 */
		          ,  MDTN_VLUN_CD = #{mdtnVlunCd} 							        /*  투약용량단위코드(신규) */
		          ,  MDTN_PRKG_VLM = #{mdtnPrkgVlm} 							    /*  투약Kg당용량(신규) */
		          ,  DRUS_CD = #{drusCd} 										            /*  용법코드 */
		          ,  INJC_PRRN_YMD = to_date ( #{injcPrrnYmd}, 'YYYYMMDD' )   /*  주사예정일(투약개시일자) */
		          ,  MDTN_STRT_YMD = to_date ( #{mdtnStrtYmd}, 'YYYYMMDD' )   /*  투약시작일자(신규) */
		          ,  MDTN_FNSH_YMD = to_date ( #{mdtnFnshYmd}, 'YYYYMMDD' )   /*  투약종료일자(신규) */
		          ,  PHRM_IMPL_YMD = to_date(#{injcPrrnYmd},'YYYYMMDD') 	/*  약국실시일자 */
		          ,  FRNS_DPRT_CD = #{frnsDprtCd} 							           /*  불출부서코드(신규) */
		          ,  PTAD_PTGO_CD = #{ptadPtgoCd} 							           /*  원무가야할장소코드 */
		          ,  DRBN_NO = decode ( #{drbnNo}, 0 , null, #{drbnNo}  ) 	   /* 약묶음번호*/
		          ,  SNGN_BNDL_YN = #{sngnBndlYn}  							       /*  단독묶음여부 */
		          ,  MIX_KIND_CD = #{mixKindCd}  								       /*  혼합종류코드 */
		          ,  ACDG_MIX_DVSN_CD = #{acdgMixDvsnCd}  					   /*  항암제혼합구분코드 */
		          ,  ASTS_YN = #{astsYn}  									                   /*  AST여부 */
		          ,  PRVN_INJC_ORNO = #{prvnInjcOrno}  						       /*  예방주사차수 */
		          ,  DRUG_ORDR_PRSS_CD = #{drugOrdrPrssCd}					   /*  약처방진행상태코드 */
		          ,  ADTN_ORDV_CD = #{adtnOrdvCd}  							       /*  추가처방구분코드 */
		          ,  ANTC_INJC_AHED_CMMD_YN = #{antcInjcAhedCmmdYn}    /*  항암주사선조제여부 */
		          ,  ORDR_IPDV_CD = #{ordrIpdvCd} 							           /*  처방급여구분코드 */
		          ,  PTAD_IPDV_CD = #{ptadIpdvCd} 							           /*  원무급여구분코드 */
		          ,  PTAD_CLBA_YMD = to_date ( #{ptadClbaYmd}, 'YYYYMMDDhh24miss' ) /*  원무계산기준일자 */
		          ,  RGOR_FNDR_ID = #{rgorFndrId}                                        /*  정규처방완료의사ID */
		          ,  RGOR_FINS_DT = to_date ( #{rgorFinsDt}, 'YYYYMMDDhh24miss' ) /*  정규처방완료일시 */
		          ,  ORCN_NURS_ID = DECODE ( ORCN_NURS_ID, null, null, #{orcnNursId} ) /*  처방확인간호사ID */
		          ,  ORCN_DT = to_date ( #{orcnDt}, 'YYYYMMDDhh24miss' )    /*  처방확인일시 */
		          ,  CLRS_PRJC_CD = #{clrsPrjcCd} 							               /*  임상연구과제코드 */
		          ,  CLRS_PRJC_DR_ID = #{clrsPrjcDrId} 						           /*  임상연구과제의사ID */
		          ,  SUBJ_IDNT_NO = #{subjIdntNo} 							           /*  피험자식별번호(신규) */
		          ,  SUBJ_INTI_VL = #{subjIntiVl} 							                   /*  피험자이니셜값(신규) */
		          ,  SUBJ_VIST_NM = #{subjVistNm} 							           /*  피험자방문명(신규) */
		          ,  SUBJ_ADMN_VL = #{subjAdmnVl} 						 	           /*  피험자투여값(신규) */
		          ,  CLNC_EXAM_MDPR_CTN = #{clncExamMdprCtn} 			   /*  임상시험약품내용(신규) */
		          ,  ATHN_ID = #{athnId}
		          ,  CRTF_IP = #{crtfIp}
		          ,  CRTF_DT = to_date ( #{crtfDt}, 'YYYYMMDDhh24miss' )
		          ,  INSR_YR3_INOU_DVSN_CD = #{insrYr3InouDvsnCd} 			   /*  보험3년내외구분코드 */
		          ,  EDI_DPLC_RESN_CD = #{ediDplcResnCd} 						   /*  EDI중복사유코드 */
		          ,  IMPL_ORDR_PBLC_LMTT_NTM = #{implOrdrPblcLmttNtm}    /*  실시처방발행제한횟수 */
		          ,  FRNS_CTRL_DVSN_CD = #{frnsCtrlDvsnCd}  					   /*  불출제어구분코드 */
		          ,  FRNS_VLM = #{frnsVlm}  									               /*  불출용량 */
		          ,  CYCL_ORDV_CD = #{cyclOrdvCd}  							       /*  주기처방구분코드 */
		          ,  CYCL_ORDR_DYWK_CTN = #{cyclOrdrDywkCtn}  				   /*  주기처방요일내용 */
		          ,  CYCL_ORDR_DDCN = #{cyclOrdrDdcn}  						       /*  주기처방일수 */
		          ,  CYCL_ORDR_STRT_YMD = to_date ( #{cyclOrdrStrtYmd} , 'YYYYMMDD' ) /*  주기처방시작일자 */
		          ,  CYCL_ORDR_FNSH_YMD = to_date ( #{cyclOrdrFnshYmd} , 'YYYYMMDD' ) /*  주기처방종료일자 */
		          ,  FLUD_Q_HR_VL = #{fludQHrVl}  							          /*  수액Q_HR값 */
		          ,  FLUD_CC_HR_VL = #{fludCcHrVl}  							          /*  Fluid With cc/hr */
		          ,  FLUD_TOTL_QTY = #{fludTotlQty}  							          /*  수액총량 */
		          ,  FLUD_OVER_VL = #{fludOverVl}  							          /*  수액Over값 */
		          ,  FRNS_YN = #{frnsYn}                                                    /*  불출여부 */
		          ,  FRNS_RQPR_ID = #{frnsRqprId}                                       /*  불출요청자ID */
		          ,  FRNS_RQPR_IP = #{frnsRqprIp}                                        /*  불출요청자IP */
		          ,  FRNS_RQST_DT = to_date ( #{frnsRqstDt} , 'YYYYMMDDhh24miss' )  /*  불출요청일시 */
		          ,  HYPR_PPVL_RESN_CD = #{hyprPpvlResnCd}                     /*  고혈압적정성평가사유코드 */
		          ,  HYPR_PPVL_ETC_NM  = #{hyprPpvlEtcNm}                       /*  고혈압적정성평가기타명 */
		          ,  VAT_TRGT_YN = #{vatTrgtYn} 								          /*  부가세대상여부 */
		          ,  PRTX_RLTN_RESN_VL = #{prtxRltnResnVl} 					      /*  처방전관계사유값 */
		          ,  PRTX_RLTN_RESN_CTN = #{prtxRltnResnCtn} 					  /*  처방전관계사유내용 */
		          ,  LQMD_USE_RESN_CD = #{lqmdUseResnCd} 					  /*  액제사용사유코드 */
		          ,  LQMD_USE_REET_CTN = #{lqmdUseReetCtn} 					  /*  액제사용사유기타내용 */
		          ,  PSDG_DRUG_LNTR_ORRE_CTN = #{psdgDrugLntrOrreCtn} 	  /*  향정약장기처방사유내용 */
		          ,  PSDG_DRUG_INCS_ORRE_CTN = #{psdgDrugIncsOrreCtn} 	  /*  향정약산재처방사유내용 */
		          ,  ITRN_BSDV_CD = #{itrnBsdvCd} 							          /*  인턴업무구분코드 */
		          ,  CHLD_PVIC_REGN_YN = #{chldPvicRegnYn} 					  /*  소아예방접종지역여부 */
		          ,  TPRN_ORDR_YN = #{tprnOrdrYn} 							          /*  Tapering 처방여부(신규) */
		          ,  CNMD_RDEX_TRGT_YN = #{cnmdRdexTrgtYn} 					  /*  조영제감면대상여부 */
		          ,  OSLF_ADMN_DRUG_YN = #{oslfAdmnDrugYn} 				  /*  자가투여약여부 */
		          ,  INHS_FRST_ADMN_DGST_YN = #{inhsFrstAdmnDgstYn}      /*  원내최초투여약물여부 */
		          ,  PTAD_CODV_CD = #{ptadCodvCd}
		          ,  PTAD_MDRP_NO = #{ptadMdrpNo}
		          ,  IMLN_ORDR_YN = #{imlnOrdrYn}
		          ,  TOTL_VLM = #{totlVlm}
		          ,  SPOR_BNDL_NM = #{sporBndlNm}                                    /* 스페셜처방묶음명 */
		          ,  SPOR_BNDL_NO = #{sporBndlNo}                                    /* 스페셜처방묶음번호*/                            
		          ,  PMDT_INSC_YN = #{pmdtInscYn}									  /* premedication검수여부 */			
		          ,  MIX_DFNT_DVSN_CD = #{mixDfntDvsnCd}                       /* 항암제확정구분코드 */
		          ,  MIX_DFNT_DT = to_date(#{mixDfntDt}, 'yyyymmddhh24miss') /* 항암제확정일시 */
		          ,  SUB_TYPE_CD = #{subTypeCd}
		          ,  SCRG_INPY_ONBR_RT = #{scrgInpyOnbrRt}
		          ,  CNSN_RLTD_YN = #{cnsnRltdYn}
		          ,  CNSN_RLTD_MCDP_CD = #{cnsnRltdMcdpCd}
		          ,  PREP_ORDR_YN = #{prepOrdrYn}
		          ,  MDPP_BDWG_VL = #{mdppBdwgVl}
		          ,  MDPP_BDWG_PRVC_CD = #{mdppBdwgPrvcCd}
		          ,  LAST_UPDR_ID = #{gvUserId}     							          /*  최종수정자ID                    */
		          ,  LAST_UPDT_IP = #{gvUserIp}          						          /*  최종수정IP                      */
		          ,  LAST_UPDT_DT = sysdate              						          /*  최종수정일시                    */
		          ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}    			  /*  최종수정SMC클라이언트프로그램ID */
		          ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}   				  /*  최종수정SMC서버프로그램ID       */
		          ,  ORDR_UPDT_DT = sysdate              						          /*  처방수정일시*/
		          ,  ORDR_UPDR_ID = #{gvUserId}     							          /*  처방수정자ID*/
		 where  PTNO = #{ptno}
		     and  ORDR_YMD = to_date ( #{ordrYmd}, 'YYYYMMDD' ) 		  /*  처방일자 */
			 and  ORDR_SNO = #{ordrSno} 	
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugOrdrDc (약주사 처방 DC 및 취소) 
        Description :                                           처방 내림한 약주사처방을 DC 및 취소 처리한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugOrdrDc"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		 update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugOrdrDc */
		             MDMEDORDT
		       set  DC_DVSN_CD = #{dcDvsnCd}
		           ,  DC_ODDR_ID = #{dcOddrId}
		           ,  DC_ORDR_DT = to_date ( #{dcOrdrDt}, 'YYYYMMDDhh24miss' )
		           ,  DC_RESN_CTN = nvl(#{dcResnCtn}, DC_RESN_CTN)
		           ,  DRUG_ORDR_PRSS_CD = DECODE(#{dcDvsnCd},'X',null,decode(CODV_CD||ODKI_CD||DRUG_ORDR_PRSS_CD,'ED0',NULL,'ED1',NULL,DRUG_ORDR_PRSS_CD))
		           ,  RCST_CD = decode(CODV_CD||ODKI_CD||DRUG_ORDR_PRSS_CD||#{dcDvsnCd}||NVL(RCST_CD,'N'),'ED0YN','R','ED1YN','R',RCST_CD)
		           ,  LAST_UPDR_ID = #{gvUserId}                                                   /* 최종수정자ID */
		           ,  LAST_UPDT_IP = #{gvUserIp}                                                   /* 최종수정IP */
		           ,  LAST_UPDT_DT = to_date ( #{dcOrdrDt}, 'YYYYMMDDhh24miss' )                   /* 최종수정일시 */
		           ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                     /* 최종수정SMC클라이언트프로그램ID */
		           ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                     /* 최종수정SMC서버프로그램ID */
		         <if test='inptVl == "PHRM"'> /* 약국DC-후인증 */
		           ,  CRTF_DVSN_CD = '1'
		         </if>    			   
		   where  PTNO = #{ptno}
		      and  ORDR_YMD = to_date ( #{ordrYmd}, 'YYYYMMDD' ) /* 처방일자 */
		      and  ORDR_SNO = #{ordrSno}
		      <if test='inptVl == "PHRM"'> /* 약국DC-후인증 */
		      and  nvl(DC_DVSN_CD , 'N') = 'N'
		      </if>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugImplOrdrPblcNtm (약주사 원처방 실시 처방 발행 횟수 Update) 
        Description :                                           약주사 실시 처방 발행후 원처방의 실시처방 발행 횟수를 Update 한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugImplOrdrPblcNtm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		 update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugImplOrdrPblcNtm */
		            MDMEDORDT
		       set  IMPL_ORDR_PBLC_NTM = nvl ( IMPL_ORDR_PBLC_NTM, 0 ) + DECODE ( #{ntm}, 0, 1, null, 1, #{ntm}  )
		          ,  LAST_UPDR_ID = #{gvUserId}     		                 /*  최종수정자ID  */
		          ,  LAST_UPDT_IP = #{gvUserIp}          	                 /*  최종수정IP  */
		          ,  LAST_UPDT_DT = sysdate              		             /*  최종수정일시  */
		          ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}    /*  최종수정SMC클라이언트프로그램ID  */
		          ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}    /*  최종수정SMC서버프로그램ID  */
		 where  PTNO = #{ptno}
		    and  ORDR_YMD = to_date ( #{ordrYmd}, 'YYYYMMDD' )
		    and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateCmmdPrsrYn (조제택배여부 수정) 
        Description :                                           처방화면에서 조제택배 버튼을 선택해서 저장할 경우 해당 처방일자 [원내 약처방]의 조제택배여부를 update 한다
                                                                ( 단, 주사약은 제외 )
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateCmmdPrsrYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		 update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateCmmdPrsrYn */
		             MDMEDORDT
		      set  CMMD_PRSR_YN      = #{cmmdPrsrYn}                                            /*  조제택배여부 */
		          ,  LAST_UPDR_ID      = #{gvUserId}
		          ,  LAST_UPDT_IP      = #{gvUserIp}
		          ,  LAST_UPDT_DT      = sysdate
		          ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}
		          ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}
		  where  MDRP_NO      = #{mdrpNo}                                                     /*  진료접수번호 */
		     and  ORDR_YMD     = to_date(#{ordrYmd} ,'yyyymmdd')                               /*  처방일자 */
		     and  ORDR_CLTY_CD NOT LIKE 'B1'
		     and  MDPR_CLSF_CD != '3'
		     and  NVL(RCST_CD,'N') = 'N'
		     and  IHOH_DVSN_CD = 'I'
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertPrnDrugImplOrdr (PRN 약주사 실시처방 등록) 
        Description :                                           PRN 약주사 의사 원처방에 대한 실시처방을 저장한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertPrnDrugImplOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		<![CDATA[
		   insert  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertPrnDrugImplOrdr */
		   into  MDMEDORDT
			  (
					 PTNO                /*  환자번호      */
				  ,  ORDR_YMD            /*  처방일자      */
				  ,  ORDR_SNO            /*  처방순번      */
				  ,  MDRP_NO             /*  진료접수번호  */
				  ,  PTAD_MDRP_NO        /*  원무진료접수번호 */
				  ,  CODV_CD             /*  환자구분      */
				  ,  PTAD_CODV_CD        /*  원무환자구분  */
				  ,  TMPR_ORDR_YN        /*  임시처방여부  */
				  ,  OROC_DPRT_CD        /*  처방발생원    */
				  ,  MCDP_CD             /*  진료과        */
				  ,  WARD_CD             /*  병동          */
				  ,  OPRT_YMD            /*  수술일자      */
				  ,  OPRT_SNO            /*  수술순번      */
				  ,  ORCL_CD             /*  처방분류      */
				  ,  ODKI_CD             /*  처방종류      */
				  ,  ORDR_CLTY_CD        /*  처방구별      */
				  ,  ORFR_CD             /*  처방형태      */
				  ,  ORDR_CD             /*  처방코드      */
				  ,  SLIP_CD             /*  SLIP코드      */
				  ,  CARE_STTS_CD        /*  간호상태코드  */
				  ,  ODDR_ID             /*  처방의사      */
				  ,  CHDR_ID             /*  주치의사      */
				  ,  GNDR_ID             /*  담당의사      */
				  ,  OPSR_ID             /*  집도의사      */
				  ,  CPDR_ID             /*  협진의사      */
				  ,  MDPR_CLSF_CD        /*  약품분류      */
				  ,  DRAP_DVSN_CD        /*  약적용구분    */
				  ,  IHOH_DVSN_CD        /*  원내/원외구분 */
				  ,  SDPF_EXRE_CD        /*  원내처방사유  */
				  ,  SLCT_UNIT_DVSN_CD   /*  선택단위구분(1:포장,2:함량)*/
				  ,  PCKN_UNAD_QTY       /*  투여량(포장)  */
				  ,  PCUN_CD             /*  단위(포장)    */
				  ,  ICUN_ADMN_VLM       /*  투여량(함량)  */
				  ,  ICUN_CD             /*  단위(함량)    */
				  ,  NTM                 /*  횟수          */
				  ,  DDCN                /*  일수          */
				  ,  DRUS_CD             /*  용법코드      */
				  ,  INJC_PRRN_YMD       /*  주사예정일(투약개시일자) */
				  ,  PHRM_IMPL_YMD       /*  약국실시예정일 */
				  ,  FRNS_DPRT_CD        /*  가야할곳(약국):주사장소 */
				  ,  PTAD_PTGO_CD        /*  가야할곳(원무) */
				  ,  DRBN_NO             /*  묶음번호       */
				  ,  SNGN_BNDL_YN        /*  단독묶음여부   */
				  ,  MIX_KIND_CD         /*  MIX종류        */
				  ,  ASTS_YN             /*  AST 여부       */
				  ,  PRVN_INJC_ORNO      /*  예방주사차수(B형간염수직감염) */
				  ,  DRUG_ORDR_PRSS_CD   /*  진행STATUS (입력/수정시:0) */
				  ,  SORT_SQNC           /*  Display 순서   */
				  ,  DRUG_ORDR_UNSL_CTN  /*  특기사항       */
				  ,  DURV_RESN_CTN       /*  약물상호작용 치명적사유 */
				  ,  ADTN_ORDV_CD        /*  추가처방여부   */
				  ,  PHDP_PRIN_YN        /*  약제부출력여부(복막투석환자처방시:'Y') */
				  ,  ANTC_INJC_AHED_CMMD_YN /*  항암주사 선조제여부 */
				  ,  DC_DVSN_CD          /*  D/C여부=>외래+입원처방시:'X'*/
				  ,  DC_ODDR_ID          /*  D/C 처방의 */
				  ,  DC_ORDR_DT          /*  D/C 처방일시 */
				  ,  ORDR_IPDV_CD        /*  급여구분(처방) */
				  ,  PTAD_IPDV_CD        /*  급여구분(심사) */
				  ,  ISTY_CD             /*  */
				  ,  PTAD_CLBA_YMD       /*  원무계산기준일자 */
				  ,  INPT_USER_DVSN_CD   /*  입력USER구분(1.의사,2.간호사) */
				  ,  RGOR_FNDR_ID        /*  정규처방 완료의사 */
				  ,  RGOR_FINS_DT        /*  정규처방 완료시간 */
				  ,  ORCN_NURS_ID        /*  정규처방 확인 간호사 */
				  ,  ORCN_DT             /*  정규처방 확인 시간 */
				  ,  HSLC_DVSN_CD        /*  장소구분          */
				  ,  MCCN_CD             /*  센터구분          */
				  ,  HGCN_KEEP_RESN_CD   /*  고함량유지 사유     */
				  ,  HGCN_KEEP_ETRE_CTN  /*  고함량유지 기타사유 */
				  ,  AGE_TABO_ORRE_CTN   /*  연령금기처방사유내용 */
				  ,  DURV_YN             /*  DUR여부 */
				  ,  DURV_ORTA_NM        /*  DUR처방테이블명 */
				  ,  DURV_ORDR_YMD       /*  DUR처방일자 */
				  ,  DURV_ORDR_CD        /*  DUR처방코드 */
				  ,  ORGL_ORDR_YMD       /*  원처방 일자 PRNORGSEQNO */
				  ,  ORGL_ORDR_SNO       /*  원처방 순번 PRNORGSEQNO */
				  ,  ORDR_CRTN_DVSN_CD   /*  처방생성구분코드 */
				  ,  FRST_RGSR_ID        /*  최초등록자ID */
				  ,  FRST_RGST_IP        /*  최초등록IP */
				  ,  FRST_RGST_DT        /*  최초등록일시 */
				  ,  FRST_RGST_CLNT_PRGM_ID   /*  최초등록SMC클라이언트프로그램ID */
				  ,  FRST_RGST_SRVR_PRGM_ID   /*  최초등록SMC서버프로그램ID */
				  ,  LAST_UPDR_ID        /*  최종수정자ID */
				  ,  LAST_UPDT_IP        /*  최종수정IP */
				  ,  LAST_UPDT_DT        /*  최종수정일시 */
				  ,  LAST_UPDT_CLNT_PRGM_ID   /*  최종수정SMC클라이언트프로그램ID */
				  ,  LAST_UPDT_SRVR_PRGM_ID   /*  최종수정SMC서버프로그램ID */
				  ,  IMPL_ORDR_PBLC_NTM  /*  실시처방발행횟수                   */
				  ,  IMPL_ORDR_PBLC_LMTT_NTM /*  실시처방발행제한횟수           */
				  ,  DURV_RTRN_DDCN      /*  DUR반납일수                        */
				  ,  MDTN_NO             /*  투약번호                           */
				  ,  TOTL_VLM            /*  총용량                             */
				  ,  MDTN_PRKG_VLM       /*  투약Kg당용량                       */
				  ,  CNNT_ORDR_BNDL_NO   /*  동시처방묶음번호                   */
				  ,  NRDR_PRTX_PRIN_NTM  /*  마약처방전출력횟수                 */
				  ,  NRDR_RTRN_PRTX_PRIN_NTM /*  마약반납처방전출력횟수        */
				  ,  ACTN_NTM            /*  액팅횟수                           */
				  ,  PHRM_RTRN_QTY       /*  약국반납량                         */
				  ,  PACL_AFTR_DRRT_QTY  /*  원무계산이후약반납량               */
				  ,  EXRE_RTRN_QTY       /*  예외사유반납량                     */
				  ,  MDTN_LABL_PRIN_NTM  /*  투약라벨출력횟수                   */
				  ,  FRNS_VLM            /*  불출용량                           */
				  ,  FRNS_RTRN_CQY       /*  불출반납수량                       */
				  ,  CYCL_ORDR_DDCN      /*  주기처방일수                       */
				  ,  FLUD_TOTL_QTY       /*  수액총량                           */
				  ,  ACDG_ADMN_MI        /*  항암제투여시간분                   */
				  ,  ORDR_CRTN_LNKN_NO   /*  처방생성연결번호                   */
				  ,  INHS_FRST_ADMN_DGST_YN /*  원내최초투여약물여부            */
				  ,  ORDR_UPDT_DT        /*  처방수정일시                       */
				  ,  ORDR_UPDR_ID        /*  처방수정자ID                    */
				  ,  ODKI_DETL_CD        /*  처방형태상세                       */
		          ,  SUB_TYPE_CD                 /* 부유형코드 */ 
		          ,  SCRG_INPY_ONBR_RT      /* 선별급여본인부담율 */
		          ,  CNSN_RLTD_YN
		          ,  CNSN_RLTD_MCDP_CD
		          ,  SPOR_BNDL_NO
		          ,  SPOR_BNDL_NM
		          ,  CRTF_DVSN_CD
			  )
			  (
				 select
					 a.PTNO                               /*  환자번호      */
				  ,  a.ORDR_YMD                           /*  처방일자      */
				  ,  #{ordrSno}         /*  처방순번      */
				  ,  a.MDRP_NO                            /*  진료접수번호  */
				  ,  a.PTAD_MDRP_NO                       /*  원무진료접수번호 */
				  ,  a.CODV_CD                            /*  환자구분      */
				  ,  a.PTAD_CODV_CD                       /*  원무환자구분  */
				  ,  'N'                                  /*  임시처방여부  */
				  ,  case when #{orocDprtCd} is null then a.OROC_DPRT_CD else #{orocDprtCd} end /*  처방발생원    */
				  ,  nvl(#{mcdpCd}, a.MCDP_CD)   /*  진료과        */
				  ,  nvl(#{wardCd}, a.WARD_CD)    /*  병동         */
				  ,  a.OPRT_YMD                           /*  수술일자      */
				  ,  a.OPRT_SNO                           /*  수술순번      */
				  ,  a.ORCL_CD                            /*  처방분류      */
				  /* ,  decode(a.ODKI_CD, 'I', 'I', 'G')   /*  처방종류 => 일반처방 : 간호 액팅에도 넣어줘야 하기 때문에 mdm_cpoe00p_m00 에서 처리  */
				  ,  #{odkiCd}          /*  처방종류 => 일반처방 : 간호 액팅에도 넣어줘야 하기 때문에 mdm_cpoe00p_m00 에서 처리  */
				  ,  a.ORDR_CLTY_CD                       /*  처방구별      */
				  ,  nvl(#{orfrCd}, 'I')/*  처방형태 =>  'E'에서 수정:2005.9.14 임용섭-항상응급처방내려가는 문제해결  */
				  ,  a.ORDR_CD                            /*  처방코드      */
				  ,  a.SLIP_CD                            /*  SLIP코드      */
				  ,  a.CARE_STTS_CD                       /*  간호상태코드  */
				  ,  a.ODDR_ID                            /*  처방의사      */
				  ,  a.CHDR_ID                            /*  주치의사      */
				  ,  a.GNDR_ID                            /*  담당의사      */
				  ,  a.OPSR_ID                            /*  집도의사      */
				  ,  a.CPDR_ID                            /*  협진의사      */
				  ,  a.MDPR_CLSF_CD                       /*  약품분류      */
				  ,  a.DRAP_DVSN_CD                       /*  약적용구분    */
				  ,  a.IHOH_DVSN_CD                       /*  원내/원외구분 */
				  ,  a.SDPF_EXRE_CD                       /*  원내처방사유  */
				  ,  a.SLCT_UNIT_DVSN_CD                  /*  선택단위구분(1:포장,2:함량) */
				  ,  case when ( (#{pcknUnadQty} = 0) or (#{pcknUnadQty} = null) ) then a.PCKN_UNAD_QTY
						  else #{pcknUnadQty} end /*  투여량(포장) */
				  ,  nvl(#{pcunCd}, a.PCUN_CD) /*  단위(포장) */
				  ,  case when ( (#{icunAdmnVlm} = 0) or (#{icunAdmnVlm} = null) ) then a.ICUN_ADMN_VLM
						  else #{icunAdmnVlm} end /*  투여량(함량) */
				  ,  nvl(#{icunCd}, a.ICUN_CD) /*  단위(함량) */
				  ,  a.NTM                               /*  횟수          */
				  ,  1                                   /*  일수          */
				  ,  a.DRUS_CD                           /*  용법코드      */
				  ,  a.INJC_PRRN_YMD                     /*  주사예정일(투약개시일자) */
				  ,  a.PHRM_IMPL_YMD                     /*  약국실시예정일 */
				  ,  case when a.CODV_CD = 'E' then a.FRNS_DPRT_CD
						  when #{frnsDprtCd} is null then a.FRNS_DPRT_CD
					 else #{frnsDprtCd} end /*  불출부서코드 */
				  ,  a.PTAD_PTGO_CD                      /*  가야할곳(원무) */
				  ,  decode ( #{drbnNo}, 0 , null, #{drbnNo}  ) /*  약묶음번호 */
				  ,  a.SNGN_BNDL_YN                      /*  단독묶음여부   */
				  ,  a.MIX_KIND_CD                       /*  MIX종류        */
				  ,  a.ASTS_YN                           /*  AST 여부       */
				  ,  a.PRVN_INJC_ORNO                    /*  예방주사차수(B형간염수직감염) */
				  ,  '0'                                 /*  진행STATUS (입력/수정시:0) */
				  ,  a.SORT_SQNC                         /*  Display 순서   */
				  ,  nvl(#{drugOrdrUnslCtn}, a.DRUG_ORDR_UNSL_CTN) /*  특기사항 */
				  ,  a.DURV_RESN_CTN                     /*  약물상호작용 치명적사유 */
				  ,  a.ADTN_ORDV_CD                      /*  추가처방여부   */
				  ,  ''                                  /*  약제부출력여부(복막투석환자처방시:'Y') */
				  ,  a.ANTC_INJC_AHED_CMMD_YN            /*  항암주사 선조제여부 */
				  ,  a.DC_DVSN_CD                        /*  D/C여부=>외래+입원처방시:'X'*/
				  ,  a.DC_ODDR_ID                        /*  D/C 처방의 */
				  ,  a.DC_ORDR_DT                        /*  D/C 처방일시 */
				  ,  a.ORDR_IPDV_CD                      /*  급여구분(처방) */
				  ,  a.PTAD_IPDV_CD                      /*  급여구분(심사) */
				  ,  a.ISTY_CD                           /*   */
				  ,  a.PTAD_CLBA_YMD                     /*  원무계산기준일자 */
				  ,  a.INPT_USER_DVSN_CD                 /*  입력USER구분(1.의사,2.간호사) */
				  ,  a.RGOR_FNDR_ID                      /*  정규처방 완료의사 */
				  ,  a.RGOR_FINS_DT                      /*  정규처방 완료시간 */
				  ,  a.ORCN_NURS_ID                      /*  정규처방 확인 간호사 */
				  ,  a.ORCN_DT                           /*  정규처방 확인 시간 */
				  ,  nvl( #{hslcDvsnCd}, HSLC_DVSN_CD ) /*  장소구분 */
				  ,  nvl( #{mccnCd}, MCCN_CD ) /*  센터코드 */
				  ,  a.HGCN_KEEP_RESN_CD                 /*  고함량유지 사유     */
				  ,  a.HGCN_KEEP_ETRE_CTN                /*  고함량유지 기타사유 */
				  ,  a.AGE_TABO_ORRE_CTN                 /*  연령금기처방사유내용 */
				  ,  a.DURV_YN                           /*  DUR여부 */
				  ,  a.DURV_ORTA_NM                      /*  DUR처방테이블명 */
				  ,  a.DURV_ORDR_YMD                     /*  DUR처방일자 */
				  ,  a.DURV_ORDR_CD                      /*  DUR처방코드 */
				  ,  to_date ( #{orglOrdrYmd}, 'yyyymmdd' ) /*  원처방 일자 PRNORGSEQNO */
				  ,  #{orglOrdrSno}         /*  원처방 순번 PRNORGSEQNO */
				  ,  '08'                                 /*  ★★ 처방생성구분코드 PRN실시처방 PRN★★ */
				  ,  #{gvUserId}                          /*  최초등록자ID */
				  ,  #{gvUserIp}                          /*  최초등록IP */
				  ,  sysdate                              /*  최초등록일시 */
				  ,  #{gvClntPrgmId}                      /*  최초등록SMC클라이언트프로그램ID */
				  ,  #{gvSrvrPrgmId}                      /*  최초등록SMC서버프로그램ID */
				  ,  #{gvUserId}                          /*  최종수정자ID */
				  ,  #{gvUserIp}                          /*  최종수정IP */
				  ,  sysdate                              /*  최종수정일시 */
				  ,  #{gvClntPrgmId}                      /*  최종수정SMC클라이언트프로그램ID */
				  ,  #{gvSrvrPrgmId}                      /*  최종수정SMC서버프로그램ID */
				  ,  0                                    /*  실시처방발행횟수                   */
				  ,  0                                    /*  실시처방발행제한횟수               */
				  ,  0                                    /*  DUR반납일수                        */
				  ,  0                                    /*  투약번호                           */
				  ,  0                                    /*  총용량                             */
				  ,  0                                    /*  투약Kg당용량                       */
				  ,  0                                    /*  동시처방묶음번호                   */
				  ,  0                                    /*  마약처방전출력횟수                 */
				  ,  0                                    /*  마약반납처방전출력횟수             */
				  ,  0                                    /*  액팅횟수                           */
				  ,  0                                    /*  약국반납량                         */
				  ,  0                                    /*  원무계산이후약반납량               */
				  ,  0                                    /*  예외사유반납량                     */
				  ,  0                                    /*  투약라벨출력횟수                   */
				  ,  0                                    /*  불출용량                           */
				  ,  0                                    /*  불출반납수량                       */
				  ,  0                                    /*  주기처방일수                       */
				  ,  0                                    /*  수액총량                           */
				  ,  0                                    /*  항암제투여시간분                   */
				  ,  0                                    /*  처방생성연결번호                   */
				  ,  ( select  case when count(PTNO) = 0 then 'Y' end
						 from  MDMEDORDT
						where  PTNO = #{ptno}
						  and  ORDR_CD = a.ORDR_CD
						  and  DC_DVSN_CD in ( 'N' , 'Y' ) /*  실처방만 발행된 처방임 */
						  and  nvl( ORFR_CD, 'X' ) not in  ( 'P', 'F' ) /*  임시처방 ( PRN, 응급실 1차 제외 ) */
						  and  rownum = 1 )
				  ,  sysdate                               	/*  처방수정일시                      */
				  ,  #{gvUserId}                      		/*  처방수정자ID                      */
				  ,  ODKI_DETL_CD        					/*  처방형태상세                      */
		          ,  SUB_TYPE_CD                 /* 부유형코드 */ 
		          ,  SCRG_INPY_ONBR_RT      /* 선별급여본인부담율 */
		          ,  CNSN_RLTD_YN
		          ,  CNSN_RLTD_MCDP_CD
		          ,  SPOR_BNDL_NO
		          ,  SPOR_BNDL_NM
		          ,  '1' /* 후인증 */
			  from  MDMEDORDT a
			 where  a.PTNO     = #{ptno}
			   and  a.ORDR_YMD = to_date( #{orglOrdrYmd}, 'yyyymmdd')
			   and  a.ORDR_SNO = #{orglOrdrSno}
			   and  a.ORFR_CD  = 'P'  						/*  PRN처방만 복제가능하게 함 */
			  )
			]]>
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertTims1AdtnDrugImplOrdr (1회 추가 약주사 실시처방 저장) 
        Description :                                           1회 추가 약주사 실시처방을 저장한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertTims1AdtnDrugImplOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		<![CDATA[
		   insert  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertTims1AdtnDrugImplOrdr */
		   into  MDMEDORDT
				(
					   PTNO                /*  환자번호      */
					,  ORDR_YMD            /*  처방일자      */
					,  ORDR_SNO            /*  처방순번      */
					,  MDRP_NO             /*  진료접수번호  */
					,  PTAD_MDRP_NO        /*  원무진료접수번호 */
					,  CODV_CD             /*  환자구분      */
					,  PTAD_CODV_CD        /*  원무환자구분  */
					,  OROC_DPRT_CD        /*  처방발생원    */
					,  MCDP_CD             /*  진료과        */
					,  WARD_CD             /*  병동          */
					,  OPRT_YMD            /*  수술일자      */
					,  OPRT_SNO            /*  수술순번      */
					,  ORCL_CD             /*  처방분류      */
					,  ODKI_CD             /*  처방종류      */
					,  TMPR_ORDR_YN        /*  임시처방여부  */
					,  ORDR_CLTY_CD        /*  처방구별      */
					,  ORFR_CD             /*  처방형태      */
					,  ORDR_CD             /*  처방코드      */
					,  SLIP_CD             /*  SLIP코드      */
					,  ODDR_ID             /*  처방의사      */
					,  CHDR_ID             /*  주치의사      */
					,  GNDR_ID             /*  담당의사      */
					,  OPSR_ID             /*  집도의사      */
					,  CPDR_ID             /*  협진의사      */
					,  CARE_STTS_CD        /*  간호상태코드  */
					,  MDPR_CLSF_CD        /*  약품분류      */
					,  DRAP_DVSN_CD        /*  약적용구분    */
					,  IHOH_DVSN_CD        /*  원내/원외구분 */
					,  SDPF_EXRE_CD        /*  원내처방사유  */
					,  SLCT_UNIT_DVSN_CD   /*  선택단위구분(1:포장,2:함량)*/
					,  PCKN_UNAD_QTY       /*  투여량(포장)  */
					,  PCUN_CD             /*  단위(포장)    */
					,  ICUN_ADMN_VLM       /*  투여량(함량)  */
					,  ICUN_CD             /*  단위(함량)    */
					,  NTM                 /*  횟수          */
					,  DDCN                /*  일수          */
					,  DRUS_CD             /*  용법코드      */
					,  INJC_PRRN_YMD       /*  주사예정일(투약개시일자) */
					,  PHRM_IMPL_YMD       /*  약국실시예정일 */
					,  FRNS_DPRT_CD        /*  가야할곳(약국):주사장소 */
					,  PTAD_PTGO_CD        /*  가야할곳(원무) */
					,  DRBN_NO             /*  묶음번호       */
					,  SNGN_BNDL_YN        /*  단독묶음여부   */
					,  MIX_KIND_CD         /*  MIX종류        */
					,  ASTS_YN             /*  AST 여부       */
					,  PRVN_INJC_ORNO      /*  예방주사차수(B형간염수직감염) */
					,  DRUG_ORDR_PRSS_CD   /*  진행STATUS (입력/수정시:0) */
					,  SORT_SQNC           /*  Display 순서   */
					,  DRUG_ORDR_UNSL_CTN  /*  특기사항       */
					,  DURV_RESN_CTN       /*  약물상호작용 치명적사유 */
					,  ADTN_ORDV_CD        /*  추가처방여부   */
					,  PHDP_PRIN_YN        /*  약제부출력여부(복막투석환자처방시:'Y') */
					,  ANTC_INJC_AHED_CMMD_YN /*  항암주사 선조제여부 */
					,  DC_DVSN_CD          /*  D/C여부=>외래+입원처방시:'X'*/
					,  ORDR_IPDV_CD        /*  급여구분(처방) */
					,  PTAD_IPDV_CD        /*  급여구분(심사) */
					,  ISTY_CD             /*  보험유형코드 */
					,  ISTY_ASST_CD        /*  보험유형보조코드 */
					,  PTAD_CLBA_YMD       /*  원무계산기준일자 */
					,  INPT_USER_DVSN_CD   /*  입력USER구분(1.의사,2.간호사) */
					,  ORCN_NURS_ID        /*  추가처방 확인간호사 */
					,  ORCN_DT             /*  추가처방 확인시간 */
					,  HSLC_DVSN_CD        /*  장소구분          */
					,  MCCN_CD             /*  센터구분          */
					,  HGCN_KEEP_RESN_CD   /*  고함량유지 사유 */
					,  HGCN_KEEP_ETRE_CTN  /*  고함량유지 기타사유 */
					,  TOTL_VLM            /*  총용량 */
					,  FRNS_VLM            /*  불출용량 */
					,  FRNS_CTRL_DVSN_CD   /*  불출제어구분코드 */
					,  FRNS_YN             /*  불출여부 */
					,  FRNS_RQPR_TYPE_CD   /*  불출요청자유형코드 */
					,  FRNS_RQPR_ID        /*  FRNS_RQPR_ID */
					,  FRNS_RQPR_IP        /*  불출요청자IP */
					,  FRNS_RQST_DT        /*  불출요청일시 */
					,  CYCL_ORDV_CD        /*  주기처방구분코드 */
					,  CYCL_ORDR_STRT_YMD  /*  주기처방시작일자 */
					,  CYCL_ORDR_FNSH_YMD  /*  주기처방종료일자 */
					,  CYCL_ORDR_DYWK_CTN  /*  주기처방요일내용 */
					,  CYCL_ORDR_DDCN      /*  주기처방일수 */
					,  FLUD_TOTL_QTY       /*  수액총량 */
					,  FLUD_OVER_VL        /*  수액Over값 */
					,  FLUD_CC_HR_VL       /*  수액CC_HR값 */
					,  FLUD_Q_HR_VL        /*  수액Q_HR값 */
					,  AGE_TABO_ORRE_CTN   /*  연령금기처방사유내용 */
					,  DURV_YN             /*  DUR여부 */
					,  DURV_ORTA_NM        /*  DUR처방테이블명 */
					,  DURV_ORDR_YMD       /*  DUR처방일자 */
					,  DURV_ORDR_CD        /*  DUR처방코드 */
					,  ORGL_ORDR_YMD       /*  원처방 일자 PRNORGSEQNO */
					,  ORGL_ORDR_SNO       /*  원처방 순번 PRNORGSEQNO */
					,  ORDR_CRTN_DVSN_CD   /*  처방생성구분코드 */
					,  FRST_RGSR_ID        /*  최초등록자ID */
					,  FRST_RGST_IP        /*  최초등록IP */
					,  FRST_RGST_DT        /*  최초등록일시 */
					,  FRST_RGST_CLNT_PRGM_ID   /*  최초등록SMC클라이언트프로그램ID */
					,  FRST_RGST_SRVR_PRGM_ID   /*  최초등록SMC서버프로그램ID */
					,  LAST_UPDR_ID        /*  최종수정자ID */
					,  LAST_UPDT_IP        /*  최종수정IP */
					,  LAST_UPDT_DT        /*  최종수정일시 */
					,  LAST_UPDT_CLNT_PRGM_ID   /*  최종수정SMC클라이언트프로그램ID */
					,  LAST_UPDT_SRVR_PRGM_ID   /*  최종수정SMC서버프로그램ID */
					,  IMPL_ORDR_PBLC_NTM  /*  실시처방발행횟수                   */
					,  IMPL_ORDR_PBLC_LMTT_NTM /*  실시처방발행제한횟수           */
					,  DURV_RTRN_DDCN      /*  DUR반납일수                        */
					,  MDTN_NO             /*  투약번호                           */
					,  MDTN_PRKG_VLM       /*  투약Kg당용량                       */
					,  CNNT_ORDR_BNDL_NO   /*  동시처방묶음번호                   */
					,  NRDR_PRTX_PRIN_NTM  /*  마약처방전출력횟수                 */
					,  NRDR_RTRN_PRTX_PRIN_NTM /*  마약반납처방전출력횟수        */
					,  ACTN_NTM            /*  액팅횟수                           */
					,  PHRM_RTRN_QTY       /*  약국반납량                         */
					,  PACL_AFTR_DRRT_QTY  /*  원무계산이후약반납량               */
					,  EXRE_RTRN_QTY       /*  예외사유반납량                     */
					,  MDTN_LABL_PRIN_NTM  /*  투약라벨출력횟수                   */
					,  FRNS_RTRN_CQY       /*  불출반납수량                       */
					,  ACDG_ADMN_MI        /*  항암제투여시간분                   */
					,  ORDR_CRTN_LNKN_NO   /*  처방생성연결번호                   */
					,  INHS_FRST_ADMN_DGST_YN /*  원내최초투여약물여부            */
					,  ORDR_UPDT_DT        /*  처방수정일시                       */
					,  ORDR_UPDR_ID        /*  처방수정자ID                    */
					,  ODKI_DETL_CD        /*  처방형태상세                       */
		            ,  SUB_TYPE_CD                 /* 부유형코드 */ 
		            ,  SCRG_INPY_ONBR_RT      /* 선별급여본인부담율 */
		            ,  CNSN_RLTD_YN
		            ,  CNSN_RLTD_MCDP_CD
		            ,  SPOR_BNDL_NO
		            ,  SPOR_BNDL_NM
					,  CRTF_DVSN_CD
				)
				(
				   select
					   a.PTNO                                 /*  환자번호 */
					,  a.ORDR_YMD                             /*  처방일자 */
					,  #{ordrSno}           				  /*  처방순번 */
					,  a.MDRP_NO                              /*  진료접수번호  */
					,  a.PTAD_MDRP_NO                         /*  원무진료접수번호 */
					,  a.CODV_CD                              /*  환자구분 */
					,  a.PTAD_CODV_CD                         /*  원무환자구분 */
					,  case when #{orocDprtCd} is null then a.OROC_DPRT_CD else #{orocDprtCd} end /*  처방발생원    */
					,  nvl(#{mcdpCd}, a.MCDP_CD)              /*  진료과 */
					,  nvl(#{wardCd}, a.WARD_CD)              /*  병동 */
					,  a.OPRT_YMD                             /*  수술일자 */
					,  a.OPRT_SNO                             /*  수술순번 */
					,  a.ORCL_CD                              /*  처방분류 */
					/* ,  decode(a.ODKI_CD, 'O', 'O', 'R', 'R', 'I', 'I', 'G') /*  처방종류 => 일반처방*/
					,  #{odkiCd}            /*  처방종류 => 일반처방 : 간호 액팅에도 넣어줘야 하기 때문에 mdm_cpoe00p_m00 에서 처리  */
					,  'N'                                    /*  임시처방여부 */
					,  a.ORDR_CLTY_CD                         /*  처방구별 */
					/* ,  decode ( :mds_medordt_000[0].ordr_crtn_dvsn_cd , '09', 'E', 'I' ) /*  처방형태 => CIV 추가처방:응급, 추가처방:추가(약) */
					/* ,  :mds_medordt_000[0].orfr_cd         /*  20161007 고유나 요청 */
					,  nvl((select MDCR_CTRL_CHRC_VL2
		                      from MZCTRLMMT
		                    where MDCR_CTRL_CD = 'MNZ_124'
		                        and MDCR_DTLS_CTRL_CD = '1'), 'I') 
					,  a.ORDR_CD                              /*  처방코드 */
					,  a.SLIP_CD                              /*  SLIP코드 */
					,  a.ODDR_ID                              /*  처방의사 */
					,  a.CHDR_ID                              /*  주치의사 */
					,  a.GNDR_ID                              /*  담당의사 */
					,  a.OPSR_ID                              /*  집도의사 */
					,  a.CPDR_ID                              /*  협진의사 */
					,  a.CARE_STTS_CD                         /*  간호상태코드  */
					,  a.MDPR_CLSF_CD                         /*  약품분류 */
					,  a.DRAP_DVSN_CD                         /*  약적용구분 */
					,  a.IHOH_DVSN_CD                         /*  원내/원외구분 */
					,  a.SDPF_EXRE_CD                         /*  원내처방사유 */
					,  a.SLCT_UNIT_DVSN_CD                    /*  선택단위구분(1:포장,2:함량)*/
					,  a.PCKN_UNAD_QTY                        /*  투여량(포장) */
					,  a.PCUN_CD                              /*  단위(포장) */
					,  a.ICUN_ADMN_VLM                        /*  투여량(함량) */
					,  a.ICUN_CD                              /*  단위(함량) */
					,  1                                      /*  횟수 */
					,  1                                      /*  일수 */
					,  decode(a.ORDR_CLTY_CD, 'B1', a.DRUS_CD, 'B2', 'UD', 'B3', 'UD', 'B9', 'UD', a.DRUS_CD)  /*  용법코드  */
					,  a.INJC_PRRN_YMD                        /*  주사예정일(투약개시일자) */
					,  a.PHRM_IMPL_YMD                        /*  약국실시예정일 */
					,  case when #{frnsDprtCd} is null then a.FRNS_DPRT_CD else #{frnsDprtCd} end /*  불출부서코드 */
					,  a.PTAD_PTGO_CD                         /*  가야할곳(원무) */
					,  decode ( #{drbnNo}, 0 , null, #{drbnNo}  ) /*  약묶음번호 */
					,  a.SNGN_BNDL_YN                         /*  단독묶음여부 */
					,  a.MIX_KIND_CD                          /*  MIX종류 */
					,  a.ASTS_YN                              /*  AST 여부 */
					,  a.PRVN_INJC_ORNO                       /*  예방주사차수(B형간염수직감염) */
					,  '0'                                    /*  진행STATUS (입력/수정시:0) */
					,  #{sortSqnc}                            /*  Display 순서 */
					,  a.DRUG_ORDR_UNSL_CTN                   /*  특기사항 */
					,  a.DURV_RESN_CTN                        /*  약물상호작용 치명적사유 */
					,  'Y'                                    /*  추가처방여부 */
					,  ''                                     /*  약제부출력여부(복막투석환자처방시:'Y') */
					,  a.ANTC_INJC_AHED_CMMD_YN               /*  항암주사 선조제여부 */
					,  a.DC_DVSN_CD                           /*  D/C여부=>외래+입원처방시:'X'*/
					,  a.ORDR_IPDV_CD                         /*  급여구분(처방) */
					,  a.PTAD_IPDV_CD                         /*  급여구분(심사) */
					,  a.ISTY_CD                              /*  보험유형코드 */
					,  a.ISTY_ASST_CD                         /*  보험유형보조코드 */
					,  a.PTAD_CLBA_YMD                        /*  원무계산기준일자 */
					,  '2'                                    /*  입력USER구분(1.의사,2.간호사) */
					, #{gvUserId}                        	  /*  추가처방 확인간호사 */
					, sysdate                                 /*   추가처방 확인시간 */
					,  nvl( #{hslcDvsnCd}, HSLC_DVSN_CD )     /*  장소구분 */
					,  nvl( #{mccnCd}, MCCN_CD ) 			  /*  센터구분 */
					,  a.HGCN_KEEP_RESN_CD                    /*  고함량유지 사유 */
					,  a.HGCN_KEEP_ETRE_CTN                   /*  고함량유지 기타사유 */
					,  a.TOTL_VLM                             /*  총용량 */
					,  a.FRNS_VLM                             /*  불출용량 */
					,  a.FRNS_CTRL_DVSN_CD                    /*  불출제어구분코드 */
					,  a.FRNS_YN                              /*  불출여부 */
					,  a.FRNS_RQPR_TYPE_CD                    /*  불출요청자유형코드 */
					,  a.FRNS_RQPR_ID                         /*  FRNS_RQPR_ID */
					,  a.FRNS_RQPR_IP                         /*  불출요청자IP */
					,  a.FRNS_RQST_DT                         /*  불출요청일시 */
					,  a.CYCL_ORDV_CD                         /*  주기처방구분코드 */
					,  a.CYCL_ORDR_STRT_YMD                   /*  주기처방시작일자 */
					,  a.CYCL_ORDR_FNSH_YMD                   /*  주기처방종료일자 */
					,  a.CYCL_ORDR_DYWK_CTN                   /*  주기처방요일내용 */
					,  a.CYCL_ORDR_DDCN                       /*  주기처방일수 */
					,  a.FLUD_TOTL_QTY                        /*  수액총량 */
					,  a.FLUD_OVER_VL                         /*  수액Over값 */
					,  a.FLUD_CC_HR_VL                        /*  수액CC_HR값 */
					,  a.FLUD_Q_HR_VL                         /*  수액Q_HR값 */
					,  a.AGE_TABO_ORRE_CTN                    /*  연령금기처방사유내용 */
					,  a.DURV_YN                              /*  DUR여부 */
					,  a.DURV_ORTA_NM                         /*  DUR처방테이블명 */
					,  a.DURV_ORDR_YMD                        /*  DUR처방일자 */
					,  a.DURV_ORDR_CD                         /*  DUR처방코드 */
					,  to_date ( #{orglOrdrYmd}, 'yyyymmdd' ) /*  원처방 일자 PRNORGSEQNO */
					,  #{orglOrdrSno}                         /*  원처방 순번 PRNORGSEQNO */
					,  #{ordrCrtnDvsnCd}                      /*  ★★ 처방생성구분코드 응급실1차실시처방 '11', CIV추가처방 '09' ★★ */
					, #{gvUserId}                             /*  최초등록자ID */
					, #{gvUserIp}                             /*  최초등록IP */
					, sysdate                                 /*  최초등록일시 */
					, #{gvClntPrgmId}                         /*  최초등록SMC클라이언트프로그램ID */
					, #{gvSrvrPrgmId}                         /*  최초등록SMC서버프로그램ID */
					, #{gvUserId}                             /*  최종수정자ID */
					, #{gvUserIp}                             /*  최종수정IP */
					, sysdate                                 /*  최종수정일시 */
					, #{gvClntPrgmId}                         /*  최종수정SMC클라이언트프로그램ID */
					, #{gvSrvrPrgmId}                         /*  최종수정SMC서버프로그램ID */
					,  0                                      /*  실시처방발행횟수                   */
					,  0                                      /*  실시처방발행제한횟수               */
					,  0                                      /*  DUR반납일수                        */
					,  0                                      /*  투약번호                           */
					,  0                                      /*  투약Kg당용량                       */
					,  0                                      /*  동시처방묶음번호                   */
					,  0                                      /*  마약처방전출력횟수                 */
					,  0                                      /*  마약반납처방전출력횟수             */
					,  0                                      /*  액팅횟수                           */
					,  0                                      /*  약국반납량                         */
					,  0                                      /*  원무계산이후약반납량               */
					,  0                                      /*  예외사유반납량                     */
					,  0                                      /*  투약라벨출력횟수                   */
					,  0                                      /*  불출반납수량                       */
					,  0                                      /*  항암제투여시간분                   */
					,  0                                      /*  처방생성연결번호                   */
					,  ( select  case when count(PTNO) = 0 then 'Y' end
						   from  MDMEDORDT
						  where  PTNO = #{ptno}
							and  ORDR_CD = a.ORDR_CD
							and  DC_DVSN_CD in ( 'N' , 'Y' ) /*  실처방만 발행된 처방임 */
							and  nvl( ORFR_CD, 'X' ) not in  ( 'P', 'F' ) /*  임시처방 ( PRN, 응급실 1차 제외 ) */
							and  rownum = 1 )
					,  sysdate                                /*  처방수정일시                       */
					,  #{gvUserId}                       /*  처방수정자ID                    */
					,  decode(a.ODKI_DETL_CD, 'V', '', a.ODKI_DETL_CD)             /*  처방형태상세                       */
		            ,  a.SUB_TYPE_CD                 /* 부유형코드 */ 
		            ,  a.SCRG_INPY_ONBR_RT      /* 선별급여본인부담율 */
		            ,  a.CNSN_RLTD_YN
		            ,  a.CNSN_RLTD_MCDP_CD
		            ,  a.SPOR_BNDL_NO
		            ,  a.SPOR_BNDL_NM
					,  '1'
				 from  MDMEDORDT a
				where  a.PTNO     = #{ptno}
				  and  a.ORDR_YMD = to_date( #{orglOrdrYmd}, 'yyyymmdd')
				  and  a.ORDR_SNO = #{orglOrdrSno}
			)
			]]>
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertDrugOrdr (약주사 처방 저장) 
        Description :                                           환자 치료를 위한 처방 내림 중 약주사 처방을 저장한다. AS-IS: mdd_medordt_i00
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertDrugOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		insert /*+ SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertDrugOrdr */
		   into  MDMEDORDT
		   (
				   PTNO                           /* 환자번호*/
				   ,  ORDR_YMD                    /* 처방일자*/
				   ,  ORDR_SNO                    /* 처방일련번호*/
				   ,  MDRP_NO                     /* 진료접수번호*/
				   ,  PTAD_MDRP_NO                /* 원무진료접수번호*/
				   ,  ORDR_CD                     /* 처방코드*/
				   ,  MCDP_CD                     /* 진료과코드*/
				   ,  ODDR_ID                     /* 처방의사ID*/
				   ,  CHDR_ID                     /* 지정의사ID*/
				   ,  GNDR_ID                     /* 주치의사ID*/
				   ,  CODV_CD                     /* 내원구분코드*/
				   ,  PTAD_CODV_CD                /* 원무내원구분코드*/
				   ,  ORDR_CLTY_CD                /* 처방분류유형코드*/
				   ,  ORCL_CD                     /* 처방분류코드*/
				   ,  ODKI_CD                     /* 처방종류코드*/
				   ,  ODKI_DETL_CD                /* 처방종류상세코드*/
				   ,  ORFR_CD                     /* 처방형태코드*/
				   ,  HSLC_DVSN_CD                /* 위치구분코드*/
				   ,  MCCN_CD                     /* 진료센터코드*/
				   ,  WARD_CD                     /* 병동코드*/
				   ,  OROC_DPRT_CD                /* 처방발생원코드*/
				   ,  FRNS_DPRT_CD                /* 불출부서코드*/
				   ,  SLIP_CD                     /* SLIP코드*/
				   ,  CARE_STTS_CD                /* 간호상태코드*/
				   ,  RTRN_STTS_CD                /* 반납상태코드*/
				   ,  RTRN_RQST_DT                /* 반납요청일시*/
				   ,  RTRN_RQPR_ID                /* 반납요청자ID*/
				   ,  ORDR_HOLD_DVSN_CD           /* 처방Hold구분코드*/
				   ,  ORDR_HOLD_RGST_DT           /* 처방Hold등록일시*/
				   ,  ORDR_HOLD_RGSR_ID           /* 처방Hold등록자ID*/
				   ,  SYMP_MNFS_DEGR_CD           /* 증상발현정도코드*/
				   ,  DGST_ABNR_RCTN_ORRE_CTN     /* 약물이상반응처방사유내용*/
				   ,  ADTN_ORDV_CD                /* 추가처방구분코드*/
				   ,  RGOR_FNDR_ID                /* 정규처방완료의사ID*/
				   ,  RGOR_FINS_DT                /* 정규처방완료일시*/
				   ,  ORCN_NURS_ID                /* 처방확인간호사ID*/
				   ,  ORCN_DT                     /* 처방확인일시*/
				   ,  TMPR_ORDR_YN                /* 임시처방여부*/
				   ,  DC_DVSN_CD                  /* DC구분코드*/
				   ,  DC_ODDR_ID                  /* DC처방의사ID*/
				   ,  DC_ORDR_DT                  /* DC처방일시*/
				   ,  DC_CNNU_ID                  /* DC확인간호사ID*/
				   ,  DC_CNFR_DT                  /* DC확인일시*/
				   ,  SORT_SQNC                   /* 정렬순서*/
				   ,  DRUG_ORDR_UNSL_CTN          /* 약처방특이내용*/
				   ,  INPT_USER_DVSN_CD           /* 입력사용자구분코드*/
				   ,  CRTF_DVSN_CD                /* 인증구분코드*/
				   ,  ATHN_ID                     /* 인증자ID*/
				   ,  CRTF_IP                     /* 인증IP*/
				   ,  CRTF_DT                     /* 인증일시*/
				   ,  CLRS_PRJC_CD                /* 임상연구과제코드*/
				   ,  CLRS_PRJC_DR_ID             /* 임상연구과제의사ID*/
				   ,  SUBJ_IDNT_NO                /* 피험자식별번호*/
				   ,  SUBJ_INTI_VL                /* 피험자이니셜값*/
				   ,  SUBJ_VIST_NM                /* 피험자방문명*/
				   ,  SUBJ_ADMN_VL                /* 피험자투여값*/
				   ,  CLNC_EXAM_MDPR_CTN          /* 임상시험약품내용*/
				   ,  OPRT_YMD                    /* 수술일자*/
				   ,  OPRT_SNO                    /* 수술일련번호*/
				   ,  ITRN_BSDV_CD                /* 인턴업무구분코드*/
				   ,  SRRQ_CMNT_CTN               /* SR커멘트내용*/
				   ,  ORDR_IPDV_CD                /* 처방급여구분코드*/
				   ,  PTAD_IPDV_CD                /* 원무급여구분코드*/
				   ,  ISTY_CD                     /* 보험유형코드*/
				   ,  ISTY_ASST_CD                /* 보험유형보조코드*/
				   ,  CNPL_CD                     /* 계약처코드*/
				   ,  PTAD_CLAM_YMD               /* 원무청구일자*/
				   ,  PTAD_CLBA_YMD               /* 원무계산기준일자*/
				   ,  RCST_CD                     /* 수납상태코드*/
				   ,  RPNT_ID                     /* 수납자ID*/
				   ,  RCPC_DT                     /* 수납일시*/
				   ,  VIA_ADMS_RCST_CD            /* 경유입원수납상태코드*/
				   ,  RDEX_CD                     /* 감면코드*/
				   ,  OPSR_ID                     /* 집도의사ID*/
				   ,  CPDR_ID                     /* 협진의사ID*/
				   ,  PTAD_PTGO_CD                /* 원무가야할장소코드*/
				   ,  ABC_ENFR_YMD                /* ABC시행일자*/
				   ,  ABC_MCDP_CD                 /* ABC진료과코드*/
				   ,  ABC_EFDP_CD                 /* ABC시행부서코드*/
				   ,  ABC_ODDR_ID                 /* ABC처방의사ID*/
				   ,  VAT_TRGT_YN                 /* 부가세대상여부*/
				   ,  ICU_VS_DSPL_YN              /* ICU_VitalSign표시여부*/
				   ,  DURV_YN                     /* DUR여부*/
				   ,  DURV_ORTA_NM                /* DUR처방테이블명*/
				   ,  DURV_RESN_CTN               /* DUR사유내용*/
				   ,  DURV_ORDR_YMD               /* DUR처방일자*/
				   ,  DURV_ORDR_CD                /* DUR처방코드*/
				   ,  EDI_DPLC_RESN_CD            /* EDI중복사유코드*/
				   ,  EDI_DPLC_RESN_CTN           /* EDI중복사유내용*/
				   ,  PRTX_RLTN_RESN_VL           /* 처방전간사유코드*/
				   ,  PRTX_RLTN_RESN_CTN          /* 처방전간사유내용*/
				   ,  DURV_RTRN_DDCN              /* DUR반납일수*/
				   ,  MDPR_CLSF_CD                /* 약품분류코드*/
				   ,  DRAP_DVSN_CD                /* 약적용구분코드*/
				   ,  MDTN_NO_DVSN_CD             /* 투약번호구분코드*/
				   ,  MDTN_LCDV_CD                /* 투약위치구분코드*/
				   ,  MDTN_NO                     /* 투약번호*/
				   ,  IHOH_DVSN_CD                /* 원내원외구분코드*/
				   ,  SDPF_EXRE_CD                /* 의약분업예외사유코드*/
				   ,  SLCT_UNIT_DVSN_CD           /* 선택단위구분코드*/
				   ,  PCKN_UNAD_QTY               /* 포장단위투여량*/
				   ,  PCUN_CD                     /* 포장단위코드*/
				   ,  ICUN_ADMN_VLM               /* 함량단위투여용량*/
				   ,  ICUN_CD                     /* 함량단위코드*/
				   ,  NTM                         /* 횟수*/
				   ,  DDCN                        /* 일수*/
				   ,  TOTL_VLM                    /* 총용량*/
				   ,  MDTN_VLUN_CD                /* 투약용량단위코드*/
				   ,  MDTN_PRKG_VLM               /* 투약Kg당용량*/
				   ,  DRUS_CD                     /* 용법코드*/
				   ,  INJC_PRRN_YMD               /* 주사예정일자*/
				   ,  MDTN_STRT_YMD               /* 투약시작일자*/
				   ,  MDTN_FNSH_YMD               /* 투약종료일자*/
				   ,  CNNT_ORDR_BNDL_NO           /* 동시처방묶음번호*/
				   ,  DRBN_NO                     /* 약묶음번호*/
				   ,  SNGN_BNDL_YN                /* 단독묶음여부*/
				   ,  MIX_KIND_CD                 /* 혼합종류코드*/
				   ,  ASTS_YN                     /* AST여부*/
				   ,  PRVN_INJC_ORNO              /* 예방주사차수*/
				   ,  DRUG_ORDR_PRSS_CD           /* 약처방진행상태코드*/
				   ,  NRDR_PRTX_PRIN_NTM          /* 마약처방전출력횟수*/
				   ,  NRDR_RTRN_PRTX_PRIN_NTM     /* 마약반납처방전출력횟수*/
				   ,  PHDP_PRIN_YN                /* 약제부출력여부*/
				   ,  SBSN_UPDT_CMMD_YN           /* 대체수정조제여부*/
				   ,  ANTC_INJC_AHED_CMMD_YN      /* 항암주사선조제여부*/
				   ,  ACDG_MIX_DVSN_CD            /* 항암제혼합구분코드*/
				   ,  ACTN_NTM                    /* 액팅횟수*/
				   ,  DSDR_SDEF_CTN               /* 퇴원약부작용내용*/
				   ,  DSDR_SPAB_CTN               /* 퇴원약특기내용*/
				   ,  DRRT_DVSN_CD                /* 약반납구분코드*/
				   ,  DRUG_RTRE_CD                /* 약반납사유코드*/
				   ,  DRRT_CNNU_ID                /* 약반납확인간호사ID*/
				   ,  PHRM_RTRN_QTY               /* 약국반납량*/
				   ,  PACL_AFTR_DRRT_QTY          /* 원무계산이후약반납량*/
				   ,  RTRN_EXRE_CTN               /* 반납예외사유내용*/
				   ,  EXRE_RTRN_QTY               /* 예외사유반납량*/
				   ,  EXRE_RTPR_ID                /* 예외사유반납자ID*/
				   ,  EXRE_RTRN_DT                /* 예외사유반납일시*/
				   ,  ANTB_GUID_GRP_VL            /* 항생제가이드그룹값*/
				   ,  ANCL_CD1                    /* 항균제분류코드1*/
				   ,  ANCL_CD2                    /* 항균제분류코드2*/
				   ,  ANCL_CD3                    /* 항균제분류코드3*/
				   ,  ANCL_CD4                    /* 항균제분류코드4*/
				   ,  ANCL_CD5                    /* 항균제분류코드5*/
				   ,  ANAG_PATH_NM                /* 항균제경로명*/
				   ,  PHRM_IMPL_YMD               /* 약국실시일자*/
				   ,  ORDR_VALD_STRT_YMD          /* 처방유효시작일자*/
				   ,  ORDR_VALD_FNSH_YMD          /* 처방유효종료일자*/
				   ,  IMPL_ORDR_PBLC_NTM          /* 실시처방발행횟수*/
				   ,  IMPL_ORDR_PBLC_LMTT_NTM     /* 실시처방발행제한횟수*/
				   ,  ORGL_ORDR_YMD               /* 원처방일자*/
				   ,  ORGL_ORDR_SNO               /* 원처방일련번호*/
				   ,  MDTN_LABL_PRIN_NTM          /* 투약라벨출력횟수*/
				   ,  MDFE_APLY_YMD               /* 수가적용일자*/
				   ,  HGCN_KEEP_RESN_CD           /* 고함량유지사유코드*/
				   ,  HGCN_KEEP_ETRE_CTN          /* 고함량유지기타사유내용*/
				   ,  AGE_TABO_ORRE_CTN           /* 연령금기처방사유내용*/
				   ,  PGWM_TABO_ORRE_CTN          /* 임부금기처방사유내용*/
				   ,  INSR_YR3_INOU_DVSN_CD       /* 보험3년내외구분코드*/
				   ,  FRNS_YN                     /* 불출여부*/
				   ,  FRNS_VLM                    /* 불출용량*/
				   ,  FRNS_CTRL_DVSN_CD           /* 불출제어구분코드*/
				   ,  FRNS_RQPR_ID                /* 불출요청자ID*/
				   ,  FRNS_RQPR_TYPE_CD           /* 불출요청자유형코드*/
				   ,  FRNS_RQPR_IP                /* 불출요청자IP*/
				   ,  FRNS_RQST_DT                /* 불출요청일시*/
				   ,  FRNS_RTRN_CQY               /* 불출반납수량*/
				   ,  ER_FRNS_YN                  /* 응급불출여부*/
				   ,  CYCL_ORDV_CD                /* 주기처방구분코드*/
				   ,  CYCL_ORDR_DYWK_CTN          /* 주기처방요일내용*/
				   ,  CYCL_ORDR_DDCN              /* 주기처방일수*/
				   ,  CYCL_ORDR_STRT_YMD          /* 주기처방시작일자*/
				   ,  CYCL_ORDR_FNSH_YMD          /* 주기처방종료일자*/
				   ,  FLUD_TOTL_QTY               /* 수액총량*/
				   ,  FLUD_OVER_VL                /* 수액Over값*/
				   ,  FLUD_CC_HR_VL               /* 수액CC_HR값*/
				   ,  FLUD_Q_HR_VL                /* 수액Q_HR값*/
				   ,  EQPM_RGST_DVSN_CD           /* 장비등록구분코드*/
				   ,  RGST_DVSN_INPT_DT           /* 등록구분입력일시*/
				   ,  PAST_CYCL_INFM_CTN          /* 과거주기정보내용*/
				   ,  HYPR_PPVL_RESN_CD           /* 고혈압적정성평가사유코드*/
				   ,  HYPR_PPVL_ETC_NM            /* 고혈압적정성평가기타명*/
				   ,  PBLC_DVSN_CD                /* 발행구분코드*/
				   ,  LQMD_USE_RESN_CD            /* 액제사용사유코드*/
				   ,  LQMD_USE_REET_CTN           /* 액제사용사유기타내용*/
				   ,  PSDG_DRUG_LNTR_ORRE_CTN     /* 향정약장기처방사유내용*/
		           ,  PSDG_DRUG_INCS_ORRE_CTN     /* 향정약산재처방사유내용 */
				   ,  DSPC_NURS_ADJS_NO           /* 퇴원계획지간호사조정번호*/
				   ,  CHLD_PVIC_REGN_YN           /* 소아예방접종지역여부*/
				   ,  ANTC_ORNO_NO                /* 항암차수번호*/
				   ,  ACDG_ADMN_MI                /* 항암제투여시간분*/
				   ,  ANTC_SHET_NO                /* 항암시트번호*/
				   ,  RGMN_CD                     /* 레지먼코드*/
				   ,  ORDR_CRTN_DVSN_CD           /* 처방생성구분코드*/
				   ,  ORDR_CRTN_LNKN_NO           /* 처방생성연결번호*/
				   ,  TPRN_ORDR_YN                /* Tapering처방여부*/
				   ,  CNMD_RDEX_TRGT_YN           /* 조영제감면대상여부*/
				   ,  OSLF_ADMN_DRUG_YN           /* 자가투여약여부*/
				   ,  INHS_FRST_ADMN_DGST_YN      /* 원내최초투여약물여부*/
				   ,  IMLN_ORDR_YN                /* 임플란트처방여부*/
				   ,  MDPR_NON_APLY_YN            /* 약품비적용여부*/
				   ,  STER_CMMD_IMPL_YN           /* 무균조제실시여부*/
		           ,  SPOR_BNDL_NM             /* 스페셜처방묶음명 */
		           ,  SPOR_BNDL_NO             /* 스페셜처방묶음번호*/    
		           ,  PMDT_INSC_YN					  /* premedication검수여부 */			
		           ,  MIX_DFNT_DVSN_CD            /* 항암제확정구분코드 */
		           ,  MIX_DFNT_DT                 /* 항암제확정일시 */                 
		           ,  SUB_TYPE_CD                 /* 부유형코드 */ 
		           ,  SCRG_INPY_ONBR_RT           /* 선별급여본인부담율 */
		           ,  CNSN_RLTD_YN                /* 컨설트관련여부 */
		           ,  CNSN_RLTD_MCDP_CD           /* 컨설트관련진료과코드 */
		           ,  PREP_ORDR_YN                /* PREP처방여부 */
		           ,  MDPP_BDWG_VL			      /* 투약용체중값 */
		           ,  MDPP_BDWG_PRVC_CD           /* 투약용체중출처코드 */
				   ,  FRST_RGSR_ID                /* 최초등록자ID*/
				   ,  FRST_RGST_IP                /* 최초등록IP*/
				   ,  FRST_RGST_DT                /* 최초등록일시*/
				   ,  FRST_RGST_CLNT_PRGM_ID      /* 최초등록SMC클라이언트프로그램ID*/
				   ,  FRST_RGST_SRVR_PRGM_ID      /* 최초등록SMC서버프로그램ID*/
				   ,  LAST_UPDR_ID                /* 최종수정자ID*/
				   ,  LAST_UPDT_IP                /* 최종수정IP*/
				   ,  LAST_UPDT_DT                /* 최종수정일시*/
				   ,  LAST_UPDT_CLNT_PRGM_ID      /* 최종수정SMC클라이언트프로그램ID*/
				   ,  LAST_UPDT_SRVR_PRGM_ID      /* 최종수정SMC서버프로그램ID*/
				   ,  ORDR_UPDT_DT                /* 처방수정일시*/
				   ,  ORDR_UPDR_ID                /* 처방수정자ID*/
		   )
		   values (
					   #{ptno}          				 	/* 환자번호*/
					,  to_date ( #{ordrYmd}, 'YYYYMMDD' ) 	/* 처방일자*/
					,  #{ordrSno}      						/* 처방일련번호*/
					,  #{mdrpNo}       						/* 진료접수번호*/
					,  #{ptadMdrpNo}  						/* 원무진료접수번호*/
					,  #{ordrCd}       						/* 처방코드*/
					,  #{mcdpCd}       						/* 진료과코드*/
					,  #{oddrId}       						/* 처방의사ID*/
					,  #{chdrId}       						/* 지정의사ID*/
					,  #{gndrId}       						/* 주치의사ID*/
					,  #{codvCd}       						/* 내원구분코드 [D: DSC, E:응급, G: 건진, H:가정간호, I:입원, O:외래 - ASIS(AP025)]*/
					,  #{ptadCodvCd}  						/* 원무내원구분코드*/
					,  #{ordrCltyCd}  						/* 처방분류유형코드 [주사약, 외용약, 검체검사, 환자검사 인지를 구별하는 코드로 처방 분류(AI048)의 상위개념으로 볼 수 있다. *. 수가 테이블에 있는 정보를 가져옴. ASIS(MM182)]*/
					,  #{orclCd}       						/* 처방분류코드*/
					,  #{odkiCd}       						/* 처방종류코드*/
					,  #{odkiDetlCd}  						/* 처방종류상세코드*/
					,  #{orfrCd}       						/* 처방형태코드*/
					,  #{hslcDvsnCd}  						/* 위치구분코드*/
					,  #{mccnCd}       						/* 진료센터코드*/
					,  #{wardCd}       						/* 병동코드*/
					,  #{orocDprtCd}       						/* 처방발생원코드*/
					,  #{frnsDprtCd}  						/* 불출부서코드*/
					,  #{slipCd}       						/* SLIP코드*/
					,  #{careSttsCd}  						/* 간호상태코드*/
					,  #{rtrnSttsCd}  						/* 반납상태코드*/
					,  to_date (#{rtrnRqstDt}, 'YYYYMMDDhh24miss')  /* 반납요청일시*/
					,  #{rtrnRqprId}  						/* 반납요청자ID*/
					,  #{ordrHoldDvsnCd} 					/* 처방Hold구분코드*/
					,  to_date (#{ordrHoldRgstDt}, 'YYYYMMDDhh24miss') /* 처방Hold등록일시*/
					,  #{ordrHoldRgsrId} 					/* 처방Hold등록자ID*/
					,  #{sympMnfsDegrCd} 					/* 증상발현정도코드*/
					,  #{dgstAbnrRctnOrreCtn} 				/* 약물이상반응처방사유내용*/
					,  #{adtnOrdvCd}  						/* 추가처방구분코드*/
					,  #{rgorFndrId}
					,  to_date ( #{rgorFinsDt}, 'YYYYMMDDhh24miss')
					,  #{orcnNursId}  /* 처방확인간호사ID*/
					,  to_date (#{orcnDt}, 'YYYYMMDDhh24miss') /* 처방확인일시*/
					,  case when #{orfrCd} = 'F' then 'Y'
							when #{orfrCd} = 'P' then 'Y'
							else #{tmprOrdrYn} end      	/* 임시처방여부*/
					,  #{dcDvsnCd}    						/* DC구분코드*/
					,  #{dcOddrId}    						/* DC처방의사ID*/
					,  to_date (#{dcOrdrDt}, 'YYYYMMDDhh24miss') /* DC처방일시*/
					,  #{dcCnnuId}    						/* DC확인간호사ID*/
					,  to_date (#{dcCnfrDt}, 'YYYYMMDDhh24miss') /* DC확인일시*/
					,  #{sortSqnc}     						/* 정렬순서*/
					,  #{drugOrdrUnslCtn} 					/* 약처방특이내용*/
					,  #{inptUserDvsnCd}  					/* 입력사용자구분코드*/
					,  case when #{crtfDvsnCd} is null then '0' else #{crtfDvsnCd} end  /* 인증구분코드*/
					,  #{athnId}         					/* 인증자ID*/
					,  #{crtfIp}         					/* 인증IP*/
					,  to_date ( #{crtfDt}, 'YYYYMMDDhh24miss') /* 인증일시*/
					,  #{clrsPrjcCd}    					/* 임상연구과제코드*/
					,  #{clrsPrjcDrId} 						/* 임상연구과제의사ID*/
					,  #{subjIdntNo}      					/* 피험자식별번호*/
					,  #{subjIntiVl}      					/* 피험자이니셜값*/
					,  #{subjVistNm}     					/* 피험자방문명*/
					,  #{subjAdmnVl}      					/* 피험자투여값*/
					,  #{clncExamMdprCtn} 					/* 임상시험약품내용*/
					,  to_date(#{oprtYmd}, 'YYYYMMDD' ) 	/* 수술일자*/
					,  #{oprtSno}       					/* 수술일련번호*/
					,  #{itrnBsdvCd}   						/* 인턴업무구분코드*/
					,  #{srrqCmntCtn}  						/* SR커멘트내용*/
					,  #{ordrIpdvCd}   						/* 처방급여구분코드*/
					,  #{ptadIpdvCd}   						/* 원무급여구분코드*/
					,  #{istyCd}        					/* 보험유형코드*/
					,  #{istyAsstCd}   						/* 보험유형보조코드*/
					,  #{cnplCd}        					/* 계약처코드*/
					,  to_date(#{ptadClamYmd}, 'YYYYMMDD' ) /* 원무청구일자*/
					,  to_date(#{ptadClbaYmd}, 'YYYYMMDDhh24miss' ) /* 원무계산기준일자*/					
					,  case when #{cnmdRdexTrgtYn} = 'Y' then 'W' else #{rcstCd} end /*  수납상태코드: 조영재감면대상여부 'Y' 인 경우 'W' 처리 */
					,  #{rpntId}        					/* 수납자ID*/
					,  to_date(#{rcpcDt}, 'YYYYMMDDhh24miss' )  /* 수납일시*/
					,  #{viaAdmsRcstCd} 					/* 경유입원수납상태코드*/					
					,  case when #{cnmdRdexTrgtYn} = 'Y' then 'G003' end             /*  감면코드: 조영재감면대상여부 'Y' 인 경우 'G003' 처리 */ 
					,  #{opsrId}            				/* 집도의사ID*/
					,  #{cpdrId}            				/* 협진의사ID*/
					,  #{ptadPtgoCd}       					/* 원무가야할장소코드*/
					,  null                                 /* ABC시행일자*/
					,  null                                 /* ABC진료과코드*/
					,  null                                 /* ABC시행부서코드*/
					,  null                                 /* ABC처방의사ID*/
					,  #{vatTrgtYn}        					/* 부가세대상여부*/
					,  #{icuVsDsplYn}     					/* ICU_VitalSign표시여부*/
					,  #{durvYn}            				/* DUR여부*/
					,  #{durvOrtaNm}       					/* DUR처방테이블명*/
					,  #{durvResnCtn}      					/* DUR사유내용*/
					,  to_date(#{durvOrdrYmd}, 'YYYYMMDD' ) /* DUR처방일자*/
					,  #{durvOrdrCd}       					/* DUR처방코드*/
					,  #{ediDplcResnCd}   					/* EDI중복사유코드*/
					,  #{ediDplcResnCtn}  					/* EDI중복사유내용*/
					,  #{prtxRltnResnVl}  					/* 처방전간사유코드*/
					,  #{prtxRltnResnCtn} 					/* 처방전간사유내용*/
					,  #{durvRtrnDdcn}     					/* DUR반납일수*/
					,  #{mdprClsfCd}       					/* 약품분류코드*/
					,  #{drapDvsnCd}       					/* 약적용구분코드*/
					,  null                                 /* 투약번호구분코드*/
					,  null                                 /* 투약위치구분코드*/
					,  0                                    /* 투약번호*/
					,  #{ihohDvsnCd}       					/* 원내원외구분코드*/
					,  #{sdpfExreCd}       					/* 의약분업예외사유코드*/
					,  case when #{slctUnitDvsnCd} is null then '1' else #{slctUnitDvsnCd} end /* 선택단위구분코드*/
					,  #{pcknUnadQty}      					/* 포장단위투여량*/
					,  #{pcunCd}            				/* 포장단위코드*/
					,  #{icunAdmnVlm}      					/* 함량단위투여용량*/
					,  #{icunCd}            				/* 함량단위코드*/
					,  #{ntm}                				/* 횟수*/
					,  #{ddcn}               				/* 일수*/
					,  #{totlVlm}           				/* 총용량*/
					,  #{mdtnVlunCd}       					/* 투약용량단위코드*/
					,  #{mdtnPrkgVlm}      					/* 투약Kg당용량*/
					,  #{drusCd}            				/* 용법코드*/
					,  to_date(#{injcPrrnYmd}, 'YYYYMMDD' ) /* 주사예정일자*/
					,  to_date(#{mdtnStrtYmd}, 'YYYYMMDD' ) /* 투약시작일자*/
					,  to_date(#{mdtnFnshYmd}, 'YYYYMMDD' ) /* 투약종료일자*/
					,  #{cnntOrdrBndlNo}  					/* 동시처방묶음번호*/
					,  decode ( #{drbnNo}, 0 , null, #{drbnNo}  ) /* 약묶음번호*/
					,  #{sngnBndlYn}       					/* 단독묶음여부*/
					,  #{mixKindCd}        					/* 혼합종류코드*/
					,  #{astsYn}            				/* AST여부*/
					,  #{prvnInjcOrno}     					/* 예방주사차수*/
					,  '0'  /*  약처방진행상태코드*/
					,  #{nrdrPrtxPrinNtm} 					/* 마약처방전출력횟수*/
					,  #{nrdrRtrnPrtxPrinNtm} 				/* 마약반납처방전출력횟수*/
					,  #{phdpPrinYn}       					/* 약제부출력여부*/
					,  #{sbsnUpdtCmmdYn}  					/* 대체수정조제여부*/
					,  #{antcInjcAhedCmmdYn} 				/* 항암주사선조제여부*/
					,  #{acdgMixDvsnCd}   					/* 항암제혼합구분코드*/
					,  #{actnNtm}           				/* 액팅횟수*/
					,  #{dsdrSdefCtn}      					/* 퇴원약부작용내용*/
					,  #{dsdrSpabCtn}      					/* 퇴원약특기내용*/
					,  #{drrtDvsnCd}       					/* 약반납구분코드*/
					,  #{drugRtreCd}       					/* 약반납사유코드*/
					,  #{drrtCnnuId}       					/* 약반납확인간호사ID*/
					,  0                                    /* 약국반납량*/
					,  0                                    /* 원무계산이후약반납량*/
					,  #{rtrnExreCtn}      					/* 반납예외사유내용*/
					,  #{exreRtrnQty}      					/* 예외사유반납량*/
					,  #{exreRtprId}       					/* 예외사유반납자ID*/
					,  to_date(#{exreRtrnDt}, 'YYYYMMDDhh24miss') /* 예외사유반납일시*/
					,  #{antbGuidGrpVl}   					/* 항생제가이드그룹코드*/
					,  #{anclCd1}          					/* 항균제분류코드1*/
					,  #{anclCd2}          					/* 항균제분류코드2*/
					,  #{anclCd3}          					/* 항균제분류코드3*/
					,  #{anclCd4}          					/* 항균제분류코드4*/
					,  #{anclCd5}          					/* 항균제분류코드5*/
					,  #{anagPathNm}       					/* 항균제경로명*/
					,  decode(#{codvCd},'H',to_date(#{ordrYmd}, 'YYYYMMDD'),
															  to_date(#{injcPrrnYmd},'YYYYMMDD')) /*  약국실시일자(가정간호 일괄불출목적으로 개발팀 전체 회의후 추가 2003.03.21 =&gt; 김요성氏 요청) */
					,  to_date( #{ordrValdStrtYmd}, 'YYYYMMDD' ) /* 처방유효시작일자*/
					,  to_date( #{ordrValdFnshYmd}, 'YYYYMMDD' ) /* 처방유효종료일자*/
					,  #{implOrdrPblcNtm} 					/* 실시처방발행횟수*/
					,  #{implOrdrPblcLmttNtm} 				/* 실시처방발행제한횟수*/
					,  to_date( #{orglOrdrYmd}, 'YYYYMMDD' )/* 원처방일자*/
					,  #{orglOrdrSno}      					/* 원처방일련번호*/
					,  #{mdtnLablPrinNtm} 					/* 투약라벨출력횟수*/
					,  to_date( #{mdfeAplyYmd}, 'YYYYMMDD' )/* 수가적용일자*/
					,  #{hgcnKeepResnCd}  					/* 고함량유지사유코드*/
					,  #{hgcnKeepEtreCtn} 					/* 고함량유지기타사유내용*/
					,  #{ageTaboOrreCtn}  					/* 연령금기처방사유내용*/
				    ,  #{pgwmTaboOrreCtn}                   /* 임부금기처방사유내용*/			
					,  #{insrYr3InouDvsnCd} 				/* 보험3년내외구분코드*/
					,  #{frnsYn}            				/* 불출여부*/
					,  #{frnsVlm}           				/* 불출용량*/
					,  #{frnsCtrlDvsnCd}  					/* 불출제어구분코드*/
					,  case when #{frnsYn} = 'Y'
							then #{gvUserId}
							else null
					   end  /* 불출요청자ID*/
					,  case when #{frnsYn} = 'Y'
							then #{inptUserDvsnCd}
							else null
					   end  /*  불출요청자유형코드 */
					,  case when #{frnsYn} = 'Y'
							then #{gvUserIp}
							else null
					   end /* 불출요청자IP*/
					,  case when #{frnsYn} = 'Y'
							then sysdate
							else null
					   end /* 불출요청일시*/
					,  #{frnsRtrnCqy}      					/* 불출반납수량*/
					,  #{erFrnsYn}         					/* 응급불출여부*/
					,  #{cyclOrdvCd}       					/* 주기처방구분코드*/
					,  #{cyclOrdrDywkCtn} 					/* 주기처방요일내용*/
					,  #{cyclOrdrDdcn} 						/* 주기처방일수*/
					,  to_date( #{cyclOrdrStrtYmd}, 'YYYYMMDD' ) /* 주기처방시작일자*/
					,  to_date( #{cyclOrdrFnshYmd}, 'YYYYMMDD' ) /* 주기처방종료일자*/
					,  #{fludTotlQty}      					/* 수액총량*/
					,  #{fludOverVl}       					/* 수액Over값*/
					,  #{fludCcHrVl}      					/* 수액CC_HR값*/
					,  #{fludQHrVl}       					/* 수액Q_HR값*/					     
					,  #{eqpmRgstDvsnCd}       				/* 장비등록구분코드*/
					,  to_date( #{rgstDvsnInptDt}, 'YYYYMMDD' ) /* 등록구분입력일시*/
					,  #{pastCyclInfmCtn}      				/* 과거주기정보내용*/
					,  #{hyprPpvlResnCd}       				/* 고혈압적정성평가사유코드*/
					,  #{hyprPpvlEtcNm}        				/* 고혈압적정성평가기타명*/
					,  #{pblcDvsnCd}            			/* 발행구분코드*/
					,  #{lqmdUseResnCd}        				/* 액제사용사유코드*/
					,  #{lqmdUseReetCtn}       				/* 액제사용사유기타내용*/
					,  #{psdgDrugLntrOrreCtn} 				/* 향정약장기처방사유내용*/
		            ,  #{psdgDrugIncsOrreCtn}                 /* 향정약산재처방사유내용 */
					,  null            						/* 퇴원계획지간호사조정번호 */
					,  #{chldPvicRegnYn}       				/* 소아예방접종지역여부*/
					,  #{antcOrnoNo}            			/* 항암차수번호*/
					,  #{acdgAdmnMi}            			/* 항암제투여시간분*/
					,  #{antcShetNo}            			/* 항암시트번호*/
					,  #{rgmnCd}                 			/* 레지먼코드*/
					,  #{ordrCrtnDvsnCd}       				/* 처방생성구분코드*/
					,  #{ordrCrtnLnknNo}       				/* 처방생성연결번호*/
					,  #{tprnOrdrYn}            			/* Tapering처방여부*/
					,  #{cnmdRdexTrgtYn}       				/* 조영제감면대상여부*/
					,  #{oslfAdmnDrugYn}       				/* 자가투여약여부*/
					,  #{inhsFrstAdmnDgstYn}  				/* 원내최초투여약물여부*/
					,  #{imlnOrdrYn}            			/* 임플란트처방여부*/
					,  #{mdprNonAplyYn}        				/* 약품비적용여부*/
					,  #{sterCmmdImplYn}       				/* 무균조제실시여부*/
		            ,  #{sporBndlNm}                     /* 스페셜처방묶음명 */
		            ,  #{sporBndlNo}                     /* 스페셜처방묶음번호 */                   
		            ,  #{pmdtInscYn}						/* premedication검수여부 */
		            ,  #{mixDfntDvsnCd}				/* 항암제확정구분코드 */
		            ,  to_date(#{mixDfntDt}, 'yyyymmddhh24miss')	/* 항암제확정일시 */
		            ,  #{subTypeCd}                         /* 부유형코드 */    
		            ,  #{scrgInpyOnbrRt}				    /* 선별급여본인부담율 */
		            ,  #{cnsnRltdYn}                        /* 컨설트관련여부 */
		            ,  #{cnsnRltdMcdpCd}                    /* 컨설트관련진료과코드 */
		            ,  #{prepOrdrYn}                        /* PREP처방여부 */
		            ,  #{mdppBdwgVl}	   		            /* 투약용체중값 */
		            ,  #{mdppBdwgPrvcCd}                    /* 투약용체중출처코드 */
					,  #{gvUserId}                          /* 최초등록자ID*/
					,  #{gvUserIp}                          /* 최초등록IP*/
					,  to_date ( #{frstRgstDt}, 'YYYYMMDDhh24miss') /* 최초등록일시*/
					,  #{gvClntPrgmId}                      /* 최초등록SMC클라이언트프로그램ID*/
					,  #{gvSrvrPrgmId}                      /* 최초등록SMC서버프로그램ID*/
					,  #{gvUserId}                          /* 최종수정자ID*/
					,  #{gvUserIp}                          /* 최종수정IP*/
					,  to_date ( #{frstRgstDt}, 'YYYYMMDDhh24miss') /* 최종수정일시*/
					,  #{gvClntPrgmId}                      /* 최종수정SMC클라이언트프로그램ID*/
					,  #{gvSrvrPrgmId}                      /* 최종수정SMC서버프로그램ID*/
					,  to_date ( #{frstRgstDt}, 'YYYYMMDDhh24miss') /* 처방수정일시*/
					,  #{gvUserId}                          /* 처방수정자ID*/
		   )
	</insert>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneMdmedordt-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="gndrId" column="GNDR_ID"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="ptadCodvCd" column="PTAD_CODV_CD"/>
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="orclCd" column="ORCL_CD"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="odkiDetlCd" column="ODKI_DETL_CD"/>
		<result property="orfrCd" column="ORFR_CD"/>
		<result property="hslcDvsnCd" column="HSLC_DVSN_CD"/>
		<result property="mccnCd" column="MCCN_CD"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="orocCdOld" column="OROC_CD_OLD"/>
		<result property="frnsDprtCd" column="FRNS_DPRT_CD"/>
		<result property="slipCd" column="SLIP_CD"/>
		<result property="careSttsCd" column="CARE_STTS_CD"/>
		<result property="rtrnSttsCd" column="RTRN_STTS_CD"/>
		<result property="rtrnRqstDt" column="RTRN_RQST_DT"/>
		<result property="rtrnRqprId" column="RTRN_RQPR_ID"/>
		<result property="ordrHoldDvsnCd" column="ORDR_HOLD_DVSN_CD"/>
		<result property="ordrHoldRgstDt" column="ORDR_HOLD_RGST_DT"/>
		<result property="ordrHoldRgsrId" column="ORDR_HOLD_RGSR_ID"/>
		<result property="sympMnfsDegrCd" column="SYMP_MNFS_DEGR_CD"/>
		<result property="dgstAbnrRctnOrreCtn" column="DGST_ABNR_RCTN_ORRE_CTN"/>
		<result property="adtnOrdvCd" column="ADTN_ORDV_CD"/>
		<result property="rgorFndrId" column="RGOR_FNDR_ID"/>
		<result property="rgorFinsDt" column="RGOR_FINS_DT"/>
		<result property="orcnNursId" column="ORCN_NURS_ID"/>
		<result property="orcnDt" column="ORCN_DT"/>
		<result property="tmprOrdrYn" column="TMPR_ORDR_YN"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
		<result property="dcOddrId" column="DC_ODDR_ID"/>
		<result property="dcOrdrDt" column="DC_ORDR_DT"/>
		<result property="dcCnnuId" column="DC_CNNU_ID"/>
		<result property="dcCnfrDt" column="DC_CNFR_DT"/>
		<result property="sortSqnc" column="SORT_SQNC"/>
		<result property="drugOrdrUnslCtn" column="DRUG_ORDR_UNSL_CTN"/>
		<result property="inptUserDvsnCd" column="INPT_USER_DVSN_CD"/>
		<result property="crtfDvsnCd" column="CRTF_DVSN_CD"/>
		<result property="athnId" column="ATHN_ID"/>
		<result property="crtfIp" column="CRTF_IP"/>
		<result property="crtfDt" column="CRTF_DT"/>
		<result property="clrsPrjcCd" column="CLRS_PRJC_CD"/>
		<result property="clrsPrjcDrId" column="CLRS_PRJC_DR_ID"/>
		<result property="subjIdntNo" column="SUBJ_IDNT_NO"/>
		<result property="subjIntiVl" column="SUBJ_INTI_VL"/>
		<result property="subjVistNm" column="SUBJ_VIST_NM"/>
		<result property="subjAdmnVl" column="SUBJ_ADMN_VL"/>
		<result property="clncExamMdprCtn" column="CLNC_EXAM_MDPR_CTN"/>
		<result property="oprtYmd" column="OPRT_YMD"/>
		<result property="oprtSno" column="OPRT_SNO"/>
		<result property="itrnBsdvCd" column="ITRN_BSDV_CD"/>
		<result property="srrqCmntCtn" column="SRRQ_CMNT_CTN"/>
		<result property="ordrIpdvCd" column="ORDR_IPDV_CD"/>
		<result property="ptadIpdvCd" column="PTAD_IPDV_CD"/>
		<result property="istyCd" column="ISTY_CD"/>
		<result property="istyAsstCd" column="ISTY_ASST_CD"/>
		<result property="cnplCd" column="CNPL_CD"/>
		<result property="ptadClamYmd" column="PTAD_CLAM_YMD"/>
		<result property="ptadClbaYmd" column="PTAD_CLBA_YMD"/>
		<result property="rcstCd" column="RCST_CD"/>
		<result property="rpntId" column="RPNT_ID"/>
		<result property="rcpcDt" column="RCPC_DT"/>
		<result property="viaAdmsRcstCd" column="VIA_ADMS_RCST_CD"/>
		<result property="rdexCd" column="RDEX_CD"/>
		<result property="opsrId" column="OPSR_ID"/>
		<result property="cpdrId" column="CPDR_ID"/>
		<result property="ptadPtgoCd" column="PTAD_PTGO_CD"/>
		<result property="implYmd" column="IMPL_YMD"/>
		<result property="abcEnfrYmd" column="ABC_ENFR_YMD"/>
		<result property="abcMcdpCd" column="ABC_MCDP_CD"/>
		<result property="abcEfdpCd" column="ABC_EFDP_CD"/>
		<result property="abcOddrId" column="ABC_ODDR_ID"/>
		<result property="abcEndrId" column="ABC_ENDR_ID"/>
		<result property="vatTrgtYn" column="VAT_TRGT_YN"/>
		<result property="icuVsDsplYn" column="ICU_VS_DSPL_YN"/>
		<result property="durvYn" column="DURV_YN"/>
		<result property="durvOrtaNm" column="DURV_ORTA_NM"/>
		<result property="durvResnCtn" column="DURV_RESN_CTN"/>
		<result property="durvOrdrYmd" column="DURV_ORDR_YMD"/>
		<result property="durvOrdrCd" column="DURV_ORDR_CD"/>
		<result property="durvRtrnDdcn" column="DURV_RTRN_DDCN"/>
		<result property="ediDplcResnCd" column="EDI_DPLC_RESN_CD"/>
		<result property="ediDplcResnCtn" column="EDI_DPLC_RESN_CTN"/>
		<result property="prtxRltnResnVl" column="PRTX_RLTN_RESN_VL"/>
		<result property="prtxRltnResnCtn" column="PRTX_RLTN_RESN_CTN"/>
		<result property="mdprClsfCd" column="MDPR_CLSF_CD"/>
		<result property="drapDvsnCd" column="DRAP_DVSN_CD"/>
		<result property="mdtnNoDvsnCd" column="MDTN_NO_DVSN_CD"/>
		<result property="mdtnLcdvCd" column="MDTN_LCDV_CD"/>
		<result property="mdtnNo" column="MDTN_NO"/>
		<result property="ihohDvsnCd" column="IHOH_DVSN_CD"/>
		<result property="sdpfExreCd" column="SDPF_EXRE_CD"/>
		<result property="slctUnitDvsnCd" column="SLCT_UNIT_DVSN_CD"/>
		<result property="pcknUnadQty" column="PCKN_UNAD_QTY"/>
		<result property="pcunCd" column="PCUN_CD"/>
		<result property="icunAdmnVlm" column="ICUN_ADMN_VLM"/>
		<result property="icunCd" column="ICUN_CD"/>
		<result property="ntm" column="NTM"/>
		<result property="ddcn" column="DDCN"/>
		<result property="totlVlm" column="TOTL_VLM"/>
		<result property="mdtnVlunCd" column="MDTN_VLUN_CD"/>
		<result property="mdtnPrkgVlm" column="MDTN_PRKG_VLM"/>
		<result property="drusCd" column="DRUS_CD"/>
		<result property="injcPrrnYmd" column="INJC_PRRN_YMD"/>
		<result property="mdtnStrtYmd" column="MDTN_STRT_YMD"/>
		<result property="mdtnFnshYmd" column="MDTN_FNSH_YMD"/>
		<result property="cnntOrdrBndlNo" column="CNNT_ORDR_BNDL_NO"/>
		<result property="drbnNo" column="DRBN_NO"/>
		<result property="sngnBndlYn" column="SNGN_BNDL_YN"/>
		<result property="mixKindCd" column="MIX_KIND_CD"/>
		<result property="astsYn" column="ASTS_YN"/>
		<result property="prvnInjcOrno" column="PRVN_INJC_ORNO"/>
		<result property="drugOrdrPrssCd" column="DRUG_ORDR_PRSS_CD"/>
		<result property="nrdrPrtxPrinNtm" column="NRDR_PRTX_PRIN_NTM"/>
		<result property="nrdrRtrnPrtxPrinNtm" column="NRDR_RTRN_PRTX_PRIN_NTM"/>
		<result property="phdpPrinYn" column="PHDP_PRIN_YN"/>
		<result property="sbsnUpdtCmmdYn" column="SBSN_UPDT_CMMD_YN"/>
		<result property="antcInjcAhedCmmdYn" column="ANTC_INJC_AHED_CMMD_YN"/>
		<result property="acdgMixDvsnCd" column="ACDG_MIX_DVSN_CD"/>
		<result property="actnNtm" column="ACTN_NTM"/>
		<result property="dsdrSdefCtn" column="DSDR_SDEF_CTN"/>
		<result property="dsdrSpabCtn" column="DSDR_SPAB_CTN"/>
		<result property="drrtDvsnCd" column="DRRT_DVSN_CD"/>
		<result property="drugRtreCd" column="DRUG_RTRE_CD"/>
		<result property="drrtCnnuId" column="DRRT_CNNU_ID"/>
		<result property="phrmRtrnQty" column="PHRM_RTRN_QTY"/>
		<result property="paclAftrDrrtQty" column="PACL_AFTR_DRRT_QTY"/>
		<result property="rtrnExreCtn" column="RTRN_EXRE_CTN"/>
		<result property="exreRtrnQty" column="EXRE_RTRN_QTY"/>
		<result property="exreRtprId" column="EXRE_RTPR_ID"/>
		<result property="exreRtrnDt" column="EXRE_RTRN_DT"/>
		<result property="cmmdBefrRtrnDvsnCd" column="CMMD_BEFR_RTRN_DVSN_CD"/>
		<result property="cmmdBefrRtrnDt" column="CMMD_BEFR_RTRN_DT"/>
		<result property="cmmdBefrRtprId" column="CMMD_BEFR_RTPR_ID"/>
		<result property="antbGuidGrpVl" column="ANTB_GUID_GRP_VL"/>
		<result property="anclCd1" column="ANCL_CD1"/>
		<result property="anclCd2" column="ANCL_CD2"/>
		<result property="anclCd3" column="ANCL_CD3"/>
		<result property="anclCd4" column="ANCL_CD4"/>
		<result property="anclCd5" column="ANCL_CD5"/>
		<result property="anagPathNm" column="ANAG_PATH_NM"/>
		<result property="phrmImplYmd" column="PHRM_IMPL_YMD"/>
		<result property="ordrValdStrtYmd" column="ORDR_VALD_STRT_YMD"/>
		<result property="ordrValdFnshYmd" column="ORDR_VALD_FNSH_YMD"/>
		<result property="implOrdrPblcNtm" column="IMPL_ORDR_PBLC_NTM"/>
		<result property="implOrdrPblcLmttNtm" column="IMPL_ORDR_PBLC_LMTT_NTM"/>
		<result property="orglOrdrYmd" column="ORGL_ORDR_YMD"/>
		<result property="orglOrdrSno" column="ORGL_ORDR_SNO"/>
		<result property="mdtnLablPrinNtm" column="MDTN_LABL_PRIN_NTM"/>
		<result property="mdfeAplyYmd" column="MDFE_APLY_YMD"/>
		<result property="hgcnKeepResnCd" column="HGCN_KEEP_RESN_CD"/>
		<result property="hgcnKeepEtreCtn" column="HGCN_KEEP_ETRE_CTN"/>
		<result property="ageTaboOrreCtn" column="AGE_TABO_ORRE_CTN"/>
		<result property="pgwmTaboOrreCtn" column="PGWM_TABO_ORRE_CTN"/>
		<result property="insrYr3InouDvsnCd" column="INSR_YR3_INOU_DVSN_CD"/>
		<result property="frnsYn" column="FRNS_YN"/>
		<result property="frnsVlm" column="FRNS_VLM"/>
		<result property="frnsCtrlDvsnCd" column="FRNS_CTRL_DVSN_CD"/>
		<result property="frnsRqprId" column="FRNS_RQPR_ID"/>
		<result property="frnsRqprTypeCd" column="FRNS_RQPR_TYPE_CD"/>
		<result property="frnsRqprIp" column="FRNS_RQPR_IP"/>
		<result property="frnsRqstDt" column="FRNS_RQST_DT"/>
		<result property="frnsRtrnCqy" column="FRNS_RTRN_CQY"/>
		<result property="erFrnsYn" column="ER_FRNS_YN"/>
		<result property="cyclOrdvCd" column="CYCL_ORDV_CD"/>
		<result property="cyclOrdrDywkCtn" column="CYCL_ORDR_DYWK_CTN"/>
		<result property="cyclOrdrDdcn" column="CYCL_ORDR_DDCN"/>
		<result property="cyclOrdrStrtYmd" column="CYCL_ORDR_STRT_YMD"/>
		<result property="cyclOrdrFnshYmd" column="CYCL_ORDR_FNSH_YMD"/>
		<result property="fludTotlQty" column="FLUD_TOTL_QTY"/>
		<result property="fludOverVl" column="FLUD_OVER_VL"/>
		<result property="fludCcHrVl" column="FLUD_CC_HR_VL"/>
		<result property="fludQHrVl" column="FLUD_Q_HR_VL"/>
		<result property="eqpmRgstDvsnCd" column="EQPM_RGST_DVSN_CD"/>
		<result property="rgstDvsnInptDt" column="RGST_DVSN_INPT_DT"/>
		<result property="pastCyclInfmCtn" column="PAST_CYCL_INFM_CTN"/>
		<result property="hyprPpvlResnCd" column="HYPR_PPVL_RESN_CD"/>
		<result property="hyprPpvlEtcNm" column="HYPR_PPVL_ETC_NM"/>
		<result property="pblcDvsnCd" column="PBLC_DVSN_CD"/>
		<result property="lqmdUseResnCd" column="LQMD_USE_RESN_CD"/>
		<result property="lqmdUseReetCtn" column="LQMD_USE_REET_CTN"/>
		<result property="psdgDrugLntrOrreCtn" column="PSDG_DRUG_LNTR_ORRE_CTN"/>
		<result property="dspcNursAdjsNo" column="DSPC_NURS_ADJS_NO"/>
		<result property="chldPvicRegnYn" column="CHLD_PVIC_REGN_YN"/>
		<result property="antcOrnoNo" column="ANTC_ORNO_NO"/>
		<result property="acdgAdmnMi" column="ACDG_ADMN_MI"/>
		<result property="antcShetNo" column="ANTC_SHET_NO"/>
		<result property="rgmnCd" column="RGMN_CD"/>
		<result property="cmmdPrsrYn" column="CMMD_PRSR_YN"/>
		<result property="cnmdRdexTrgtYn" column="CNMD_RDEX_TRGT_YN"/>
		<result property="oslfAdmnDrugYn" column="OSLF_ADMN_DRUG_YN"/>
		<result property="inhsFrstAdmnDgstYn" column="INHS_FRST_ADMN_DGST_YN"/>
		<result property="imlnOrdrYn" column="IMLN_ORDR_YN"/>
		<result property="mdprNonAplyYn" column="MDPR_NON_APLY_YN"/>
		<result property="sterCmmdImplYn" column="STER_CMMD_IMPL_YN"/>
		<result property="tprnOrdrYn" column="TPRN_ORDR_YN"/>
		<result property="ordrCrtnDvsnCd" column="ORDR_CRTN_DVSN_CD"/>
		<result property="ordrCrtnLnknNo" column="ORDR_CRTN_LNKN_NO"/>
		<result property="ordrUpdtDt" column="ORDR_UPDT_DT"/>
		<result property="ordrUpdrId" column="ORDR_UPDR_ID"/>
		<result property="orocDprtCd" column="OROC_DPRT_CD"/>
		<result property="sporBndlNm" column="SPOR_BNDL_NM"/>
		<result property="sporBndlNo" column="SPOR_BNDL_NO"/>
		<result property="cnclCnfrDt" column="CNCL_CNFR_DT"/>
		<result property="cnclCnnuId" column="CNCL_CNNU_ID"/>
		<result property="pmdtInscYn" column="PMDT_INSC_YN"/>
		<result property="mixDfntDvsnCd" column="MIX_DFNT_DVSN_CD"/>
		<result property="mixDfntDt" column="MIX_DFNT_DT"/>
		<result property="psdgDrugIncsOrreCtn" column="PSDG_DRUG_INCS_ORRE_CTN"/>
		<result property="subTypeCd" column="SUB_TYPE_CD"/>
		<result property="scrgInpyOnbrRt" column="SCRG_INPY_ONBR_RT"/>
		<result property="dcResnCtn" column="DC_RESN_CTN"/>
		<result property="cnsnRltdYn" column="CNSN_RLTD_YN"/>
		<result property="cnsnRltdMcdpCd" column="CNSN_RLTD_MCDP_CD"/>
		<result property="prepOrdrYn" column="PREP_ORDR_YN"/>
		<result property="mdppBdwgVl" column="MDPP_BDWG_VL"/>
		<result property="mdppBdwgPrvcCd" column="MDPP_BDWG_PRVC_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneMdmedordt (MDMEDORDT 처방KEY를 이용한 전체컬럼 조회) 
        Description :                                           MDMEDORDT 처방KEY를 이용한 전체컬럼 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneMdmedordt-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneMdmedordt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneMdmedordt-result" useCache="true" flushCache="false">
		select  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneMdmedordt */
		       PTNO as PTNO                                                   
		     , to_char(ORDR_YMD,'YYYYMMDD') ORDR_YMD
		     , ORDR_SNO as ORDR_SNO
		     , MDRP_NO as MDRP_NO
		     , PTAD_MDRP_NO as PTAD_MDRP_NO
		     , ORDR_CD as ORDR_CD
		     , MCDP_CD as MCDP_CD
		     , ODDR_ID as ODDR_ID
		     , CHDR_ID as CHDR_ID
		     , GNDR_ID as GNDR_ID
		     , CODV_CD as CODV_CD
		     , PTAD_CODV_CD as PTAD_CODV_CD
		     , ORDR_CLTY_CD as ORDR_CLTY_CD
		     , ORCL_CD as ORCL_CD
		     , ODKI_CD as ODKI_CD
		     , ODKI_DETL_CD as ODKI_DETL_CD
		     , ORFR_CD as ORFR_CD
		     , HSLC_DVSN_CD as HSLC_DVSN_CD
		     , MCCN_CD as MCCN_CD
		     , WARD_CD as WARD_CD
		     , OROC_CD_OLD as OROC_CD_OLD
		     , FRNS_DPRT_CD as FRNS_DPRT_CD
		     , SLIP_CD as SLIP_CD
		     , CARE_STTS_CD as CARE_STTS_CD
		     , RTRN_STTS_CD as RTRN_STTS_CD
		     , to_char (RTRN_RQST_DT, 'YYYYMMDDhh24miss') as RTRN_RQST_DT
		     , RTRN_RQPR_ID as RTRN_RQPR_ID
		     , ORDR_HOLD_DVSN_CD as ORDR_HOLD_DVSN_CD
		     , to_char (ORDR_HOLD_RGST_DT, 'YYYYMMDDhh24miss') as ORDR_HOLD_RGST_DT
		     , ORDR_HOLD_RGSR_ID as ORDR_HOLD_RGSR_ID
		     , SYMP_MNFS_DEGR_CD as SYMP_MNFS_DEGR_CD
		     , DGST_ABNR_RCTN_ORRE_CTN as DGST_ABNR_RCTN_ORRE_CTN
		     , ADTN_ORDV_CD as ADTN_ORDV_CD
		     , RGOR_FNDR_ID as RGOR_FNDR_ID
		     , to_char (RGOR_FINS_DT, 'YYYYMMDDhh24miss') as RGOR_FINS_DT
		     , ORCN_NURS_ID as ORCN_NURS_ID
		     , to_char (ORCN_DT, 'YYYYMMDDhh24miss') as ORCN_DT
		     , TMPR_ORDR_YN as TMPR_ORDR_YN
		     , DC_DVSN_CD as DC_DVSN_CD
		     , DC_ODDR_ID as DC_ODDR_ID                 
		     , to_char (DC_ORDR_DT, 'YYYYMMDDhh24miss') as DC_ORDR_DT              
		     , DC_CNNU_ID as DC_CNNU_ID
		     , to_char (DC_CNFR_DT, 'YYYYMMDDhh24miss') as DC_CNFR_DT
		     , SORT_SQNC as SORT_SQNC
		     , DRUG_ORDR_UNSL_CTN as DRUG_ORDR_UNSL_CTN
		     , INPT_USER_DVSN_CD as INPT_USER_DVSN_CD
		     , CRTF_DVSN_CD as CRTF_DVSN_CD
		     , ATHN_ID as ATHN_ID
		     , CRTF_IP as CRTF_IP
		     , to_char (CRTF_DT, 'YYYYMMDDhh24miss') as CRTF_DT
		     , CLRS_PRJC_CD as CLRS_PRJC_CD
		     , CLRS_PRJC_DR_ID as CLRS_PRJC_DR_ID
		     , SUBJ_IDNT_NO as SUBJ_IDNT_NO
		     , SUBJ_INTI_VL as SUBJ_INTI_VL
		     , SUBJ_VIST_NM as SUBJ_VIST_NM
		     , SUBJ_ADMN_VL as SUBJ_ADMN_VL
		     , CLNC_EXAM_MDPR_CTN as CLNC_EXAM_MDPR_CTN
		     , to_char(OPRT_YMD,'YYYYMMDD') as OPRT_YMD   
		     , OPRT_SNO as OPRT_SNO
		     , ITRN_BSDV_CD as ITRN_BSDV_CD
		     , SRRQ_CMNT_CTN as SRRQ_CMNT_CTN
		     , ORDR_IPDV_CD as ORDR_IPDV_CD
		     , PTAD_IPDV_CD as PTAD_IPDV_CD
		     , ISTY_CD as ISTY_CD
		     , ISTY_ASST_CD as ISTY_ASST_CD
		     , CNPL_CD as CNPL_CD
		     , to_char(PTAD_CLAM_YMD,'YYYYMMDD') as PTAD_CLAM_YMD
		     , to_char(PTAD_CLBA_YMD,'YYYYMMDD') as PTAD_CLBA_YMD
		     , RCST_CD as RCST_CD
		     , RPNT_ID as RPNT_ID
		     , to_char (RCPC_DT, 'YYYYMMDDhh24miss') as RCPC_DT
		     , VIA_ADMS_RCST_CD as VIA_ADMS_RCST_CD
		     , RDEX_CD as RDEX_CD
		     , OPSR_ID as OPSR_ID
		     , CPDR_ID as CPDR_ID
		     , PTAD_PTGO_CD as PTAD_PTGO_CD
		     , to_char(IMPL_YMD,'YYYYMMDD') as IMPL_YMD
		     , to_char(ABC_ENFR_YMD,'YYYYMMDD') as ABC_ENFR_YMD
		     , ABC_MCDP_CD as ABC_MCDP_CD
		     , ABC_EFDP_CD as ABC_EFDP_CD
		     , ABC_ODDR_ID as ABC_ODDR_ID
		     , ABC_ENDR_ID as ABC_ENDR_ID
		     , VAT_TRGT_YN as VAT_TRGT_YN
		     , ICU_VS_DSPL_YN as ICU_VS_DSPL_YN
		     , DURV_YN as DURV_YN
		     , DURV_ORTA_NM as DURV_ORTA_NM
		     , DURV_RESN_CTN as DURV_RESN_CTN
		     , to_char(DURV_ORDR_YMD,'YYYYMMDD') as DURV_ORDR_YMD
		     , DURV_ORDR_CD as DURV_ORDR_CD
		     , DURV_RTRN_DDCN as DURV_RTRN_DDCN
		     , EDI_DPLC_RESN_CD as EDI_DPLC_RESN_CD
		     , EDI_DPLC_RESN_CTN as EDI_DPLC_RESN_CTN
		     , PRTX_RLTN_RESN_VL as PRTX_RLTN_RESN_VL
		     , PRTX_RLTN_RESN_CTN as PRTX_RLTN_RESN_CTN
		     , MDPR_CLSF_CD as MDPR_CLSF_CD
		     , DRAP_DVSN_CD as DRAP_DVSN_CD
		     , MDTN_NO_DVSN_CD as MDTN_NO_DVSN_CD
		     , MDTN_LCDV_CD as MDTN_LCDV_CD
		     , MDTN_NO as MDTN_NO
		     , IHOH_DVSN_CD as IHOH_DVSN_CD
		     , SDPF_EXRE_CD as SDPF_EXRE_CD
		     , SLCT_UNIT_DVSN_CD as SLCT_UNIT_DVSN_CD
		     , PCKN_UNAD_QTY as PCKN_UNAD_QTY
		     , PCUN_CD as PCUN_CD
		     , ICUN_ADMN_VLM as ICUN_ADMN_VLM
		     , ICUN_CD as ICUN_CD
		     , NTM as NTM
		     , DDCN as DDCN
		     , TOTL_VLM as TOTL_VLM
		     , MDTN_VLUN_CD as MDTN_VLUN_CD
		     , MDTN_PRKG_VLM as MDTN_PRKG_VLM
		     , DRUS_CD as DRUS_CD
		     , to_char(INJC_PRRN_YMD,'YYYYMMDD') as INJC_PRRN_YMD
		     , to_char(MDTN_STRT_YMD,'YYYYMMDD') as MDTN_STRT_YMD
		     , to_char(MDTN_FNSH_YMD,'YYYYMMDD') as MDTN_FNSH_YMD
		     , CNNT_ORDR_BNDL_NO as CNNT_ORDR_BNDL_NO
		     , DRBN_NO as DRBN_NO
		     , SNGN_BNDL_YN as SNGN_BNDL_YN
		     , MIX_KIND_CD as MIX_KIND_CD
		     , ASTS_YN as ASTS_YN
		     , PRVN_INJC_ORNO as PRVN_INJC_ORNO
		     , DRUG_ORDR_PRSS_CD as DRUG_ORDR_PRSS_CD
		     , NRDR_PRTX_PRIN_NTM as NRDR_PRTX_PRIN_NTM
		     , NRDR_RTRN_PRTX_PRIN_NTM as NRDR_RTRN_PRTX_PRIN_NTM
		     , PHDP_PRIN_YN as PHDP_PRIN_YN
		     , SBSN_UPDT_CMMD_YN as SBSN_UPDT_CMMD_YN
		     , ANTC_INJC_AHED_CMMD_YN as ANTC_INJC_AHED_CMMD_YN
		     , ACDG_MIX_DVSN_CD as ACDG_MIX_DVSN_CD
		     , ACTN_NTM as ACTN_NTM
		     , DSDR_SDEF_CTN as DSDR_SDEF_CTN
		     , DSDR_SPAB_CTN as DSDR_SPAB_CTN
		     , DRRT_DVSN_CD as DRRT_DVSN_CD
		     , DRUG_RTRE_CD as DRUG_RTRE_CD
		     , DRRT_CNNU_ID as DRRT_CNNU_ID
		     , PHRM_RTRN_QTY as PHRM_RTRN_QTY
		     , PACL_AFTR_DRRT_QTY as PACL_AFTR_DRRT_QTY
		     , RTRN_EXRE_CTN as RTRN_EXRE_CTN
		     , EXRE_RTRN_QTY as EXRE_RTRN_QTY
		     , EXRE_RTPR_ID as EXRE_RTPR_ID
		     , to_char (EXRE_RTRN_DT, 'YYYYMMDDhh24miss') as EXRE_RTRN_DT
		     , CMMD_BEFR_RTRN_DVSN_CD as CMMD_BEFR_RTRN_DVSN_CD
		     , to_char (CMMD_BEFR_RTRN_DT, 'YYYYMMDDhh24miss') as CMMD_BEFR_RTRN_DT
		     , CMMD_BEFR_RTPR_ID as CMMD_BEFR_RTPR_ID
		     , ANTB_GUID_GRP_VL as ANTB_GUID_GRP_VL
		     , ANCL_CD1 as ANCL_CD1
		     , ANCL_CD2 as ANCL_CD2
		     , ANCL_CD3 as ANCL_CD3
		     , ANCL_CD4 as ANCL_CD4
		     , ANCL_CD5 as ANCL_CD5
		     , ANAG_PATH_NM as ANAG_PATH_NM
		     , to_char(PHRM_IMPL_YMD,'YYYYMMDD') as PHRM_IMPL_YMD
		     , to_char(ORDR_VALD_STRT_YMD,'YYYYMMDD') as ORDR_VALD_STRT_YMD
		     , to_char(ORDR_VALD_FNSH_YMD,'YYYYMMDD') as ORDR_VALD_FNSH_YMD
		     , IMPL_ORDR_PBLC_NTM as IMPL_ORDR_PBLC_NTM
		     , IMPL_ORDR_PBLC_LMTT_NTM as IMPL_ORDR_PBLC_LMTT_NTM
		     , to_char(ORGL_ORDR_YMD,'YYYYMMDD') as ORGL_ORDR_YMD
		     , ORGL_ORDR_SNO as ORGL_ORDR_SNO
		     , MDTN_LABL_PRIN_NTM as MDTN_LABL_PRIN_NTM
		     , to_char(MDFE_APLY_YMD,'YYYYMMDD') as MDFE_APLY_YMD
		     , HGCN_KEEP_RESN_CD as HGCN_KEEP_RESN_CD
		     , HGCN_KEEP_ETRE_CTN as HGCN_KEEP_ETRE_CTN
		     , AGE_TABO_ORRE_CTN as AGE_TABO_ORRE_CTN
		     , PGWM_TABO_ORRE_CTN as PGWM_TABO_ORRE_CTN
		     , INSR_YR3_INOU_DVSN_CD as INSR_YR3_INOU_DVSN_CD
		     , FRNS_YN as FRNS_YN
		     , FRNS_VLM as FRNS_VLM
		     , FRNS_CTRL_DVSN_CD as FRNS_CTRL_DVSN_CD
		     , FRNS_RQPR_ID as FRNS_RQPR_ID
		     , FRNS_RQPR_TYPE_CD as FRNS_RQPR_TYPE_CD
		     , FRNS_RQPR_IP as FRNS_RQPR_IP
		     , to_char (FRNS_RQST_DT, 'YYYYMMDDhh24miss') as FRNS_RQST_DT
		     , FRNS_RTRN_CQY as FRNS_RTRN_CQY
		     , ER_FRNS_YN as ER_FRNS_YN
		     , CYCL_ORDV_CD as CYCL_ORDV_CD
		     , CYCL_ORDR_DYWK_CTN as CYCL_ORDR_DYWK_CTN
		     , CYCL_ORDR_DDCN as CYCL_ORDR_DDCN
		     , to_char(CYCL_ORDR_STRT_YMD,'YYYYMMDD') as CYCL_ORDR_STRT_YMD
		     , to_char(CYCL_ORDR_FNSH_YMD,'YYYYMMDD') as CYCL_ORDR_FNSH_YMD
		     , FLUD_TOTL_QTY as FLUD_TOTL_QTY
		     , FLUD_OVER_VL as FLUD_OVER_VL
		     , FLUD_CC_HR_VL as FLUD_CC_HR_VL
		     , FLUD_Q_HR_VL as FLUD_Q_HR_VL
		     , EQPM_RGST_DVSN_CD as EQPM_RGST_DVSN_CD
		     , to_char (RGST_DVSN_INPT_DT, 'YYYYMMDDhh24miss') as RGST_DVSN_INPT_DT
		     , PAST_CYCL_INFM_CTN as PAST_CYCL_INFM_CTN
		     , HYPR_PPVL_RESN_CD as HYPR_PPVL_RESN_CD
		     , HYPR_PPVL_ETC_NM as HYPR_PPVL_ETC_NM
		     , PBLC_DVSN_CD as PBLC_DVSN_CD
		     , LQMD_USE_RESN_CD as LQMD_USE_RESN_CD
		     , LQMD_USE_REET_CTN as LQMD_USE_REET_CTN
		     , PSDG_DRUG_LNTR_ORRE_CTN as PSDG_DRUG_LNTR_ORRE_CTN
		     , DSPC_NURS_ADJS_NO as DSPC_NURS_ADJS_NO
		     , CHLD_PVIC_REGN_YN as CHLD_PVIC_REGN_YN
		     , ANTC_ORNO_NO as ANTC_ORNO_NO
		     , ACDG_ADMN_MI as ACDG_ADMN_MI
		     , ANTC_SHET_NO as ANTC_SHET_NO
		     , RGMN_CD as RGMN_CD
		     , CMMD_PRSR_YN as CMMD_PRSR_YN
		     , CNMD_RDEX_TRGT_YN as CNMD_RDEX_TRGT_YN
		     , OSLF_ADMN_DRUG_YN as OSLF_ADMN_DRUG_YN
		     , INHS_FRST_ADMN_DGST_YN as INHS_FRST_ADMN_DGST_YN
		     , IMLN_ORDR_YN as IMLN_ORDR_YN
		     , MDPR_NON_APLY_YN as MDPR_NON_APLY_YN
		     , STER_CMMD_IMPL_YN as STER_CMMD_IMPL_YN
		     , TPRN_ORDR_YN as TPRN_ORDR_YN
		     , ORDR_CRTN_DVSN_CD as ORDR_CRTN_DVSN_CD
		     , ORDR_CRTN_LNKN_NO as ORDR_CRTN_LNKN_NO
		     , to_char (ORDR_UPDT_DT, 'YYYYMMDDhh24miss') as ORDR_UPDT_DT
		     , ORDR_UPDR_ID as ORDR_UPDR_ID
		     , OROC_DPRT_CD as OROC_DPRT_CD
		     ,  SPOR_BNDL_NM             /* 스페셜처방묶음명 */
		     ,  SPOR_BNDL_NO             /* 스페셜처방묶음번호*/                     
		     ,  to_char(CNCL_CNFR_DT, 'yyyymmddhh24miss') as CNCL_CNFR_DT
		     ,  CNCL_CNNU_ID                                            as CNCL_CNNU_ID
		     ,  PMDT_INSC_YN					  /* premedication검수여부 */			
		     ,  MIX_DFNT_DVSN_CD           /* 항암제확정구분코드 */
		     ,  to_char(MIX_DFNT_DT, 'yyyymmddhh24miss') as MIX_DFNT_DT                    /* 항암제확정일시 */           
		     ,  PSDG_DRUG_INCS_ORRE_CTN /* 향정약산재처방사유내용 */
		     ,  SUB_TYPE_CD				/* 부유형코드 */
		     ,  SCRG_INPY_ONBR_RT	    /* 선별급여본인부담율 */
		     ,  DC_RESN_CTN				/* DC사유내용 */
		     ,  CNSN_RLTD_YN			/* 컨설트관련여부 */
		     ,  CNSN_RLTD_MCDP_CD       /* 컨설트관련진료과코드 */
		     ,  PREP_ORDR_YN			/* PREP처방여부 */
		     ,  MDPP_BDWG_VL            /* 투약용체중값 */
		     ,  MDPP_BDWG_PRVC_CD       /* 투약용체중출처코드 */
		  from  MDMEDORDT
		 where  PTNO = #{ptno}
		   and  ORDR_YMD = to_date (#{ordrYmd},'YYYYMMDD')
		   and  ORDR_SNO = #{ordrSno}
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugOrdrDcRqst () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugOrdrDcRqst"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		update  /*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugOrdrDcRqst */  
		             MDDCREQMT
		      set  DC_YN = 'Y' 
		         ,  DC_ODDR_ID = #{dcOddrId}
		         ,  DC_ORDR_DT = to_date ( #{dcOrdrDt}, 'YYYYMMDDhh24miss' )
		         ,  LAST_UPDR_ID = #{gvUserId}                                                   /* 최종수정자ID */
		         ,  LAST_UPDT_IP = #{gvUserIp}                                                   /* 최종수정IP */
		         ,  LAST_UPDT_DT = to_date ( #{dcOrdrDt}, 'YYYYMMDDhh24miss' )                   /* 최종수정일시 */
		         ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                     /* 최종수정SMC클라이언트프로그램ID */
		         ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                     /* 최종수정SMC서버프로그램ID */
		 where  PTNO = #{ptno}
		    and  ORDR_YMD = to_date ( #{ordrYmd}, 'YYYYMMDD' ) /* 처방일자 */
		    and  ORDR_SNO = #{ordrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertOtptDrugDrrt (insert MDDCREQMT) 
        Description :                                           외래약 D/C요청 등록
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertOtptDrugDrrt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertOtptDrugDrrt */
		insert into MDDCREQMT 
		 (
		    PTNO		/* 환자번호 */
		 ,  ORDR_YMD		/* 처방일자 */
		 ,  ORDR_SNO		/* 처방일련번호 */
		 ,  MDRP_NO		/* 진료접수번호 */
		 ,  DC_YN		/* DC여부 */
		 ,  DC_RQST_DT		/* DC요청일시 */
		 ,  DC_RQST_NURS_ID		/*  */
		 ,  DC_ORDR_DT		/*  */
		 ,  DC_ODDR_ID		/*  */
		 ,  FRST_RGSR_ID		/* 최초등록자ID */
		 ,  FRST_RGST_IP		/* 최초등록IP */
		 ,  FRST_RGST_DT		/* 최초등록일시 */
		 ,  FRST_RGST_CLNT_PRGM_ID		/* 최초등록클라이언트프로그램ID */
		 ,  FRST_RGST_SRVR_PRGM_ID		/* 최초등록서버프로그램ID */
		 ,  LAST_UPDR_ID		/* 최종수정자ID */
		 ,  LAST_UPDT_IP		/* 최종수정IP */
		 ,  LAST_UPDT_DT		/* 최종수정일시 */
		 ,  LAST_UPDT_CLNT_PRGM_ID		/* 최종수정클라이언트프로그램ID */
		 ,  LAST_UPDT_SRVR_PRGM_ID		/* 최종수정서버프로그램ID */
		 )
		 values
		 (
		    #{ptno}
		 ,  to_date(#{ordrYmd}, 'yyyymmdd')
		 ,  #{ordrSno}
		 ,  #{mdrpNo}
		 ,  #{dcYn}
		 ,  to_date(#{dcRqstDt}, 'yyyymmddhh24miss')
		 ,  #{dcRqstNursId}
		 ,  to_date(#{dcOrdrDt}, 'yyyymmddhh24miss')
		 ,  #{dcOddrId}
		 ,  #{gvUserId}
		 ,  #{gvUserIp}
		 ,  sysdate
		 ,  #{gvClntPrgmId}
		 ,  #{gvSrvrPrgmId}
		 ,  #{gvUserId}
		 ,  #{gvUserIp}
		 ,  sysdate
		 ,  #{gvClntPrgmId}
		 ,  #{gvSrvrPrgmId}
		 )
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugDCResn (약처방DC사유내용 입력) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugDCResn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateDrugDCResn */
		update MDMEDORDT 
		      set DC_RESN_CTN = #{dcResnCtn}
		        ,  LAST_UPDR_ID = #{gvUserId}                                                   /* 최종수정자ID */
		        ,  LAST_UPDT_IP = #{gvUserIp}                                                   /* 최종수정IP */
		        ,  LAST_UPDT_DT = sysdate                                                       /* 최종수정일시 */
		        ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                     /* 최종수정SMC클라이언트프로그램ID */
		        ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                     /* 최종수정SMC서버프로그램ID */
		 where PTNO = #{ptno}
		    and ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		    and ORDR_SNO  = #{ordrSno}
		    and DC_DVSN_CD in ('Y', 'X') /* DC건만 사유 입력하자 */
	</update>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listValdPtntDrugOrdr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listValdPtntDrugOrdr (유효한 환자약처방 조회) 
        Description :                                           약처방 D/C처리시 전체 약처방에 대해서 D/C하는지 체크하기 위해서 환자의 현재 유효한 약처방을 조회한다.
                                                                'MdpDurTmprOrdrDAO-insertDurTmprOrdr2'을 참조하여 작성함. => DUR체크대상 약처방
                                                                입력
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listValdPtntDrugOrdr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listValdPtntDrugOrdr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listValdPtntDrugOrdr-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listValdPtntDrugOrdr */
		select  a.PTNO
		     ,  to_char(a.ORDR_YMD, 'yyyymmdd') as ORDR_YMD
		     ,  a.ORDR_SNO
		     ,  a.MDRP_NO
		  from  MDMEDORDT a
		 where  a.MDRP_NO = #{mdrpNo}
		   and  a.ORDR_YMD = to_date(#{ordrYmd}, 'YYYYMMDD')
		   and  a.CODV_CD = upper(#{codvCd})
		   and  a.MCDP_CD = #{mcdpCd}
		   and  a.ODKI_CD = #{odkiCd}
		   and  nvl(a.DC_DVSN_CD, 'N') = 'N'
		   and  ceil(a.DDCN - nvl(a.DURV_RTRN_DDCN, 0)) <![CDATA[ > ]]> 0
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugCmmdInfmCrtn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ordrSno" column="ORDR_SNO"/>
		<result property="mdrpNo" column="MDRP_NO"/>
		<result property="ptadMdrpNo" column="PTAD_MDRP_NO"/>
		<result property="ordrCd" column="ORDR_CD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="oddrId" column="ODDR_ID"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="gndrId" column="GNDR_ID"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="ptadCodvCd" column="PTAD_CODV_CD"/>
		<result property="ordrCltyCd" column="ORDR_CLTY_CD"/>
		<result property="odkiCd" column="ODKI_CD"/>
		<result property="orfrCd" column="ORFR_CD"/>
		<result property="wardCd" column="WARD_CD"/>
		<result property="frnsDprtCd" column="FRNS_DPRT_CD"/>
		<result property="slipCd" column="SLIP_CD"/>
		<result property="tmprOrdrYn" column="TMPR_ORDR_YN"/>
		<result property="dcDvsnCd" column="DC_DVSN_CD"/>
		<result property="rcstCd" column="RCST_CD"/>
		<result property="rpntId" column="RPNT_ID"/>
		<result property="rcpcDt" column="RCPC_DT"/>
		<result property="ihohDvsnCd" column="IHOH_DVSN_CD"/>
		<result property="sdpfExreCd" column="SDPF_EXRE_CD"/>
		<result property="injcPrrnYmd" column="INJC_PRRN_YMD"/>
		<result property="drugOrdrPrssCd" column="DRUG_ORDR_PRSS_CD"/>
		<result property="phdpPrinYn" column="PHDP_PRIN_YN"/>
		<result property="orocDprtCd" column="OROC_DPRT_CD"/>
		<result property="subTypeCd" column="SUB_TYPE_CD"/>
		<result property="saveDvsnCd" column="SAVE_DVSN_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugCmmdInfmCrtn (약진도테이블 입력을 위한 외래약 목록 조회) 
        Description :                                           약진도테이블 입력을 위한 외래약 목록 조회
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugCmmdInfmCrtn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugCmmdInfmCrtn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugCmmdInfmCrtn-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugCmmdInfmCrtn */
		select  PTNO
		     ,  to_char(ORDR_YMD, 'yyyymmdd') as ORDR_YMD
		     ,  ORDR_SNO
		     ,  MDRP_NO
		     ,  PTAD_MDRP_NO
		     ,  ORDR_CD
		     ,  MCDP_CD
		     ,  ODDR_ID
		     ,  CHDR_ID
		     ,  GNDR_ID
		     ,  CODV_CD
		     ,  PTAD_CODV_CD
		     ,  ORDR_CLTY_CD
		     ,  ODKI_CD
		     ,  ORFR_CD
		     ,  WARD_CD
		     ,  FRNS_DPRT_CD
		     ,  SLIP_CD
		     ,  TMPR_ORDR_YN
		     ,  DC_DVSN_CD
		     ,  RCST_CD
		     ,  RPNT_ID
		     ,  to_char(RCPC_DT, 'yyyymmddhh24miss') as RCPC_DT
		     ,  IHOH_DVSN_CD
		     ,  SDPF_EXRE_CD
		     ,  to_char(INJC_PRRN_YMD, 'yyyymmdd') as INJC_PRRN_YMD
		     ,  DRUG_ORDR_PRSS_CD
		     ,  PHDP_PRIN_YN
		     ,  OROC_DPRT_CD
		     ,  SUB_TYPE_CD
		     ,  'I' as SAVE_DVSN_CD
		  from  MDMEDORDT
		 where  PTNO = #{ptno}
		   and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		   and  MDRP_NO = #{mdrpNo}
		   and  DC_DVSN_CD in ('N', 'Y', 'X')
		   and  TMPR_ORDR_YN = 'N'
		   and nvl(PHDP_PRIN_YN, 'N') <![CDATA[ <> ]]> 'Y'
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugNonCrtnSttsPrsg-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="ptdvCd" column="PTDV_CD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="orocDprtCd" column="OROC_DPRT_CD"/>
		<result property="subTypeCd" column="SUB_TYPE_CD"/>
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugNonCrtnSttsPrsg () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugNonCrtnSttsPrsg-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugNonCrtnSttsPrsg"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugNonCrtnSttsPrsg-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugNonCrtnSttsPrsg */
		<![CDATA[
				select  a.PTNO
				     ,  to_char(a.ORDR_YMD, 'yyyymmdd') as ORDR_YMD
				     ,  a.CODV_CD as PTDV_CD
				     ,  a.MCDP_CD
				     ,  a.CHDR_ID
				     ,  a.OROC_DPRT_CD
				     ,  a.SUB_TYPE_CD
				     ,  case when a.ORDR_UPDT_DT < nvl(b.ORDR_DT, to_date('20200925', 'yyyymmdd'))
				             then 'Y'
				             else 'N'
				         end as YN
				  from  ( 
				        select  PTNO
				             ,  ORDR_YMD
				             ,  CODV_CD
				             ,  MCDP_CD
				             ,  CHDR_ID
				             ,  OROC_DPRT_CD
				             ,  SUB_TYPE_CD
				             ,  max(ORDR_UPDT_DT) as ORDR_UPDT_DT
				          from  MDMEDORDT a
				         where  PTNO = #{ptno}
				           and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
				           and  CODV_CD = #{codvCd} 
				           and  MCDP_CD = #{mcdpCd}
				           and  CHDR_ID = #{chdrId}
				           and  OROC_DPRT_CD = #{orocDprtCd}
				           and  MDRP_NO = #{mdrpNo}
				           and  nvl(PHDP_PRIN_YN, 'N') <> 'Y'
				           --and  DC_DVSN_CD in ('N', 'Y' ,'X')
		                   and  DC_DVSN_CD = 'N'
				         group  
				            by  PTNO, ORDR_YMD, CODV_CD, MCDP_CD, CHDR_ID, OROC_DPRT_CD, SUB_TYPE_CD
				        ) a
				     ,  (
				        select  PTNO
				             ,  ORDR_YMD 
				             ,  PTDV_CD as CODV_CD
				             ,  MCDP_CD
				             ,  CHDR_ID
				             ,  OROC_DPRT_CD
				             ,  SUB_TYPE_CD
				             ,  max(FRST_RGST_DT) as ORDR_DT
				          from  SDPSTATET b
				         where  PTNO = #{ptno}
				           and  ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
				           and  PTDV_CD = #{codvCd}
				           and  MCDP_CD = #{mcdpCd}
				           and  CHDR_ID = #{chdrId}
				           and  OROC_DPRT_CD = #{orocDprtCd}
				         group 
				            by  PTNO, ORDR_YMD, PTDV_CD, MCDP_CD, CHDR_ID, OROC_DPRT_CD, SUB_TYPE_CD
				        ) b
				 where  a.PTNO = b.PTNO(+)
				   and  a.ORDR_YMD = b.ORDR_YMD(+)
				   and  a.CODV_CD = b.CODV_CD(+)
				   and  a.MCDP_CD = b.MCDP_CD(+)
				   and  a.CHDR_ID = b.CHDR_ID(+)
				   and  a.OROC_DPRT_CD = b.OROC_DPRT_CD(+)
				   and  nvl(a.SUB_TYPE_CD, 'ZZ') = nvl(b.SUB_TYPE_CD(+), 'ZZ')
				]]>
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateTpnOrglOrdrSno (TPN처방의 원처방일련번호를 채번된 ordrSno로 수정한다.) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateTpnOrglOrdrSno"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateTpnOrglOrdrSno */
		update  MDMEDORDT
		   set  ORGL_ORDR_SNO = #{orglOrdrSno}
		     ,  LAST_UPDR_ID = #{gvUserId}     							          /*  최종수정자ID                    */
		     ,  LAST_UPDT_IP = #{gvUserIp}          						          /*  최종수정IP                      */
		     ,  LAST_UPDT_DT = sysdate              						          /*  최종수정일시                    */
		     ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}    			  /*  최종수정SMC클라이언트프로그램ID */
		     ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}   				  /*  최종수정SMC서버프로그램ID       */
		 where  PTNO = #{ptno}
		   and  ORDR_YMD = to_date ( #{ordrYmd}, 'YYYYMMDD' ) 		  /*  처방일자 */
		   and  ORDR_SNO = #{ordrSno} 	
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateAdmsAcdgMixDfnt (입원 항암제MIX 확정처리) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateAdmsAcdgMixDfnt"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateAdmsAcdgMixDfnt */
		update  MDMEDORDT
		   set  MIX_DFNT_DVSN_CD = 'M'
		     ,  MIX_DFNT_DT  = sysdate
		     ,  LAST_UPDR_ID = #{gvUserId}                                                   /* 최종수정자ID */
		     ,  LAST_UPDT_IP = #{gvUserIp}                                                   /* 최종수정IP */
		     ,  LAST_UPDT_DT = sysdate                                                       /* 최종수정일시 */
		     ,  LAST_UPDT_CLNT_PRGM_ID = #{gvClntPrgmId}                                     /* 최종수정SMC클라이언트프로그램ID */
		     ,  LAST_UPDT_SRVR_PRGM_ID = #{gvSrvrPrgmId}                                     /* 최종수정SMC서버프로그램ID */
		 where PTNO = #{ptno}
		   and ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		 <choose>
		  <when test='drbnNo != null and drbnNo != "" and drbnNo &gt; 0'>
		   and DRBN_NO = #{drbnNo}  
		  </when>
		  <otherwise>
		   and ORDR_SNO = #{ordrSno}
		  </otherwise>
		 </choose>
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-deleteTpnOrdrDc () 
        Description :                                           약처방 D/C 때 TPN 조성 처방이 있을 경우 함께 D/C를 처리한다.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<delete id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-deleteTpnOrdrDc"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-deleteTpnOrdrDc */
		delete from MDTPNORDT
		 where PTNO = #{ptno} /*  환자번호 */
		   and ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd') /*  처방일자 */
		   and TPN_ORDR_CD = #{ordrCd} /* 처방코드 */
		]]>
	</delete>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugBefrCmmdInfm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="ptno" column="PTNO"/>
		<result property="ordrYmd" column="ORDR_YMD"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="chdrId" column="CHDR_ID"/>
		<result property="orocDprtCd" column="OROC_DPRT_CD"/>
		<result property="subTypeCd" column="SUB_TYPE_CD"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugBefrCmmdInfm (직전에 생성한 이전 조제진도 정보를 조회한다.) 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugBefrCmmdInfm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugBefrCmmdInfm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugBefrCmmdInfm-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-listOtptDrugBefrCmmdInfm */
		select  PTNO
		     ,  to_char(ORDR_YMD, 'yyyymmdd') as ORDR_YMD
		     ,  PTDV_CD as CODV_CD
		     ,  MCDP_CD
		     ,  CHDR_ID
		     ,  OROC_DPRT_CD
		     ,  SUB_TYPE_CD
		  from  SDPSTATET a
		 where  CMMD_INFM_CRTN_YN = 'Y'
		   and  PTNO = #{ptno}
		   and  ORDR_YMd        = to_date(#{ordrYmd}, 'yyyymmdd')
		   and  PTDV_CD         = #{codvCd}
		   and  MCDP_CD         = #{mcdpCd}
		   and  CHDR_ID         = #{chdrId}
		   and  OROC_DPRT_CD    = nvl(#{orocDprtCd}, OROC_DPRT_CD)
		   and  ORDR_DT         = (select  max(ORDR_DT)
		                             from  SDPSTATET
		                            where  PTNO         = a.PTNO
		                              and  ORDR_YMD     = a.ORDR_YMD
		                              and  PTDV_CD      = a.PTDV_CD
		                              and  MCDP_CD      = a.MCDP_CD
		                              and  CHDR_ID      = a.CHDR_ID
		                              and  OROC_DPRT_CD = a.OROC_DPRT_CD
		                              and  CMMD_INFM_CRTN_YN = 'Y'
		                          )
	</select>






    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insert000 () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insert000"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insert000 */
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertTims1AdtnDrugImplOrdr2 () 
        Description :                                           의사 다음날 정규처방 경구 처음약발행 투약1회추가 처방을 당일로 발행.
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertTims1AdtnDrugImplOrdr2"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-insertTims1AdtnDrugImplOrdr2 */
		<![CDATA[
		   insert  
		   into  MDMEDORDT
				(
					   PTNO                /*  환자번호      */
					,  ORDR_YMD            /*  처방일자      */
					,  ORDR_SNO            /*  처방순번      */
					,  MDRP_NO             /*  진료접수번호  */
					,  PTAD_MDRP_NO        /*  원무진료접수번호 */
					,  CODV_CD             /*  환자구분      */
					,  PTAD_CODV_CD        /*  원무환자구분  */
					,  OROC_DPRT_CD        /*  처방발생원    */
					,  MCDP_CD             /*  진료과        */
					,  WARD_CD             /*  병동          */
					,  OPRT_YMD            /*  수술일자      */
					,  OPRT_SNO            /*  수술순번      */
					,  ORCL_CD             /*  처방분류      */
					,  ODKI_CD             /*  처방종류      */
					,  TMPR_ORDR_YN        /*  임시처방여부  */
					,  ORDR_CLTY_CD        /*  처방구별      */
					,  ORFR_CD             /*  처방형태      */
					,  ORDR_CD             /*  처방코드      */
					,  SLIP_CD             /*  SLIP코드      */
					,  ODDR_ID             /*  처방의사      */
					,  CHDR_ID             /*  주치의사      */
					,  GNDR_ID             /*  담당의사      */
					,  OPSR_ID             /*  집도의사      */
					,  CPDR_ID             /*  협진의사      */
					,  CARE_STTS_CD        /*  간호상태코드  */
					,  MDPR_CLSF_CD        /*  약품분류      */
					,  DRAP_DVSN_CD        /*  약적용구분    */
					,  IHOH_DVSN_CD        /*  원내/원외구분 */
					,  SDPF_EXRE_CD        /*  원내처방사유  */
					,  SLCT_UNIT_DVSN_CD   /*  선택단위구분(1:포장,2:함량)*/
					,  PCKN_UNAD_QTY       /*  투여량(포장)  */
					,  PCUN_CD             /*  단위(포장)    */
					,  ICUN_ADMN_VLM       /*  투여량(함량)  */
					,  ICUN_CD             /*  단위(함량)    */
					,  NTM                 /*  횟수          */
					,  DDCN                /*  일수          */
					,  DRUS_CD             /*  용법코드      */
					,  INJC_PRRN_YMD       /*  주사예정일(투약개시일자) */
					,  PHRM_IMPL_YMD       /*  약국실시예정일 */
					,  FRNS_DPRT_CD        /*  가야할곳(약국):주사장소 */
					,  PTAD_PTGO_CD        /*  가야할곳(원무) */
					,  DRBN_NO             /*  묶음번호       */
					,  SNGN_BNDL_YN        /*  단독묶음여부   */
					,  MIX_KIND_CD         /*  MIX종류        */
					,  ASTS_YN             /*  AST 여부       */
					,  PRVN_INJC_ORNO      /*  예방주사차수(B형간염수직감염) */
					,  DRUG_ORDR_PRSS_CD   /*  진행STATUS (입력/수정시:0) */
					,  SORT_SQNC           /*  Display 순서   */
					,  DRUG_ORDR_UNSL_CTN  /*  특기사항       */
					,  DURV_RESN_CTN       /*  약물상호작용 치명적사유 */
					,  ADTN_ORDV_CD        /*  추가처방여부   */
					,  PHDP_PRIN_YN        /*  약제부출력여부(복막투석환자처방시:'Y') */
					,  ANTC_INJC_AHED_CMMD_YN /*  항암주사 선조제여부 */
					,  DC_DVSN_CD          /*  D/C여부=>외래+입원처방시:'X'*/
					,  ORDR_IPDV_CD        /*  급여구분(처방) */
					,  PTAD_IPDV_CD        /*  급여구분(심사) */
					,  ISTY_CD             /*  보험유형코드 */
					,  ISTY_ASST_CD        /*  보험유형보조코드 */
					,  PTAD_CLBA_YMD       /*  원무계산기준일자 */
					,  INPT_USER_DVSN_CD   /*  입력USER구분(1.의사,2.간호사) */
					,  ORCN_NURS_ID        /*  추가처방 확인간호사 */
					,  ORCN_DT             /*  추가처방 확인시간 */
					,  HSLC_DVSN_CD        /*  장소구분          */
					,  MCCN_CD             /*  센터구분          */
					,  HGCN_KEEP_RESN_CD   /*  고함량유지 사유 */
					,  HGCN_KEEP_ETRE_CTN  /*  고함량유지 기타사유 */
					,  TOTL_VLM            /*  총용량 */
					,  FRNS_VLM            /*  불출용량 */
					,  FRNS_CTRL_DVSN_CD   /*  불출제어구분코드 */
					,  FRNS_YN             /*  불출여부 */
					,  FRNS_RQPR_TYPE_CD   /*  불출요청자유형코드 */
					,  FRNS_RQPR_ID        /*  FRNS_RQPR_ID */
					,  FRNS_RQPR_IP        /*  불출요청자IP */
					,  FRNS_RQST_DT        /*  불출요청일시 */
					,  CYCL_ORDV_CD        /*  주기처방구분코드 */
					,  CYCL_ORDR_STRT_YMD  /*  주기처방시작일자 */
					,  CYCL_ORDR_FNSH_YMD  /*  주기처방종료일자 */
					,  CYCL_ORDR_DYWK_CTN  /*  주기처방요일내용 */
					,  CYCL_ORDR_DDCN      /*  주기처방일수 */
					,  FLUD_TOTL_QTY       /*  수액총량 */
					,  FLUD_OVER_VL        /*  수액Over값 */
					,  FLUD_CC_HR_VL       /*  수액CC_HR값 */
					,  FLUD_Q_HR_VL        /*  수액Q_HR값 */
					,  AGE_TABO_ORRE_CTN   /*  연령금기처방사유내용 */
					,  DURV_YN             /*  DUR여부 */
					,  DURV_ORTA_NM        /*  DUR처방테이블명 */
					,  DURV_ORDR_YMD       /*  DUR처방일자 */
					,  DURV_ORDR_CD        /*  DUR처방코드 */
					,  ORGL_ORDR_YMD       /*  원처방 일자 PRNORGSEQNO */
					,  ORGL_ORDR_SNO       /*  원처방 순번 PRNORGSEQNO */
					,  ORDR_CRTN_DVSN_CD   /*  처방생성구분코드 */
					,  FRST_RGSR_ID        /*  최초등록자ID */
					,  FRST_RGST_IP        /*  최초등록IP */
					,  FRST_RGST_DT        /*  최초등록일시 */
					,  FRST_RGST_CLNT_PRGM_ID   /*  최초등록SMC클라이언트프로그램ID */
					,  FRST_RGST_SRVR_PRGM_ID   /*  최초등록SMC서버프로그램ID */
					,  LAST_UPDR_ID        /*  최종수정자ID */
					,  LAST_UPDT_IP        /*  최종수정IP */
					,  LAST_UPDT_DT        /*  최종수정일시 */
					,  LAST_UPDT_CLNT_PRGM_ID   /*  최종수정SMC클라이언트프로그램ID */
					,  LAST_UPDT_SRVR_PRGM_ID   /*  최종수정SMC서버프로그램ID */
					,  IMPL_ORDR_PBLC_NTM  /*  실시처방발행횟수                   */
					,  IMPL_ORDR_PBLC_LMTT_NTM /*  실시처방발행제한횟수           */
					,  DURV_RTRN_DDCN      /*  DUR반납일수                        */
					,  MDTN_NO             /*  투약번호                           */
					,  MDTN_PRKG_VLM       /*  투약Kg당용량                       */
					,  CNNT_ORDR_BNDL_NO   /*  동시처방묶음번호                   */
					,  NRDR_PRTX_PRIN_NTM  /*  마약처방전출력횟수                 */
					,  NRDR_RTRN_PRTX_PRIN_NTM /*  마약반납처방전출력횟수        */
					,  ACTN_NTM            /*  액팅횟수                           */
					,  PHRM_RTRN_QTY       /*  약국반납량                         */
					,  PACL_AFTR_DRRT_QTY  /*  원무계산이후약반납량               */
					,  EXRE_RTRN_QTY       /*  예외사유반납량                     */
					,  MDTN_LABL_PRIN_NTM  /*  투약라벨출력횟수                   */
					,  FRNS_RTRN_CQY       /*  불출반납수량                       */
					,  ACDG_ADMN_MI        /*  항암제투여시간분                   */
					,  ORDR_CRTN_LNKN_NO   /*  처방생성연결번호                   */
					,  INHS_FRST_ADMN_DGST_YN /*  원내최초투여약물여부            */
					,  ORDR_UPDT_DT        /*  처방수정일시                       */
					,  ORDR_UPDR_ID        /*  처방수정자ID                    */
					,  ODKI_DETL_CD        /*  처방형태상세                       */
		            ,  SUB_TYPE_CD                 /* 부유형코드 */ 
		            ,  SCRG_INPY_ONBR_RT      /* 선별급여본인부담율 */
		            ,  CNSN_RLTD_YN
		            ,  CNSN_RLTD_MCDP_CD
		            ,  SPOR_BNDL_NO
		            ,  SPOR_BNDL_NM
					,  CRTF_DVSN_CD
				)
				(
				   select
					   a.PTNO                                 /*  환자번호 */
					,  trunc(sysdate)                             /*  처방일자 */
					,  #{ordrSno}           				  /*  처방순번 */
					,  a.MDRP_NO                              /*  진료접수번호  */
					,  a.PTAD_MDRP_NO                         /*  원무진료접수번호 */
					,  a.CODV_CD                              /*  환자구분 */
					,  a.PTAD_CODV_CD                         /*  원무환자구분 */
					,  case when #{orocDprtCd} is null then a.OROC_DPRT_CD else #{orocDprtCd} end /*  처방발생원    */
					,  nvl(#{mcdpCd}, a.MCDP_CD)              /*  진료과 */
					,  nvl(#{wardCd}, a.WARD_CD)              /*  병동 */
					,  a.OPRT_YMD                             /*  수술일자 */
					,  a.OPRT_SNO                             /*  수술순번 */
					,  a.ORCL_CD                              /*  처방분류 */
					/* ,  decode(a.ODKI_CD, 'O', 'O', 'R', 'R', 'I', 'I', 'G') /*  처방종류 => 일반처방*/
					,  #{odkiCd}            /*  처방종류 => 일반처방 : 간호 액팅에도 넣어줘야 하기 때문에 mdm_cpoe00p_m00 에서 처리  */
					,  'N'                                    /*  임시처방여부 */
					,  a.ORDR_CLTY_CD                         /*  처방구별 */
					/* ,  decode ( :mds_medordt_000[0].ordr_crtn_dvsn_cd , '09', 'E', 'I' ) /*  처방형태 => CIV 추가처방:응급, 추가처방:추가(약) */
					/* ,  :mds_medordt_000[0].orfr_cd         /*  20161007 고유나 요청 */
					,  nvl((select MDCR_CTRL_CHRC_VL2
		                      from MZCTRLMMT
		                    where MDCR_CTRL_CD = 'MNZ_124'
		                        and MDCR_DTLS_CTRL_CD = '1'), 'I') 
					,  a.ORDR_CD                              /*  처방코드 */
					,  a.SLIP_CD                              /*  SLIP코드 */
					,  a.ODDR_ID                              /*  처방의사 */
					,  a.CHDR_ID                              /*  주치의사 */
					,  a.GNDR_ID                              /*  담당의사 */
					,  a.OPSR_ID                              /*  집도의사 */
					,  a.CPDR_ID                              /*  협진의사 */
					,  a.CARE_STTS_CD                         /*  간호상태코드  */
					,  a.MDPR_CLSF_CD                         /*  약품분류 */
					,  a.DRAP_DVSN_CD                         /*  약적용구분 */
					,  a.IHOH_DVSN_CD                         /*  원내/원외구분 */
					,  a.SDPF_EXRE_CD                         /*  원내처방사유 */
					,  a.SLCT_UNIT_DVSN_CD                    /*  선택단위구분(1:포장,2:함량)*/
					,  a.PCKN_UNAD_QTY                        /*  투여량(포장) */
					,  a.PCUN_CD                              /*  단위(포장) */
					,  a.ICUN_ADMN_VLM                        /*  투여량(함량) */
					,  a.ICUN_CD                              /*  단위(함량) */
					,  1                                      /*  횟수 */
					,  1                                      /*  일수 */
					,  decode(a.ORDR_CLTY_CD, 'B1', a.DRUS_CD, 'B2', 'UD', 'B3', 'UD', 'B9', 'UD', a.DRUS_CD)  /*  용법코드  */
					,  a.INJC_PRRN_YMD                        /*  주사예정일(투약개시일자) */
					,  a.PHRM_IMPL_YMD                        /*  약국실시예정일 */
					,  case when #{frnsDprtCd} is null then a.FRNS_DPRT_CD else #{frnsDprtCd} end /*  불출부서코드 */
					,  a.PTAD_PTGO_CD                         /*  가야할곳(원무) */
					,  decode ( #{drbnNo}, 0 , null, #{drbnNo}  ) /*  약묶음번호 */
					,  #{sngnBndlYn}                          /*  단독묶음여부 */
					,  a.MIX_KIND_CD                          /*  MIX종류 */
					,  a.ASTS_YN                              /*  AST 여부 */
					,  a.PRVN_INJC_ORNO                       /*  예방주사차수(B형간염수직감염) */
					,  '0'                                    /*  진행STATUS (입력/수정시:0) */
					,  #{sortSqnc}                            /*  Display 순서 */
					,  #{drugOrdrUnslCtn}                     /*  특기사항 */
					,  a.DURV_RESN_CTN                        /*  약물상호작용 치명적사유 */
					,  'Y'                                    /*  추가처방여부 */
					,  ''                                     /*  약제부출력여부(복막투석환자처방시:'Y') */
					,  a.ANTC_INJC_AHED_CMMD_YN               /*  항암주사 선조제여부 */
					,  a.DC_DVSN_CD                           /*  D/C여부=>외래+입원처방시:'X'*/
					,  a.ORDR_IPDV_CD                         /*  급여구분(처방) */
					,  a.PTAD_IPDV_CD                         /*  급여구분(심사) */
					,  a.ISTY_CD                              /*  보험유형코드 */
					,  a.ISTY_ASST_CD                         /*  보험유형보조코드 */
					,  a.PTAD_CLBA_YMD                        /*  원무계산기준일자 */
					,  '1'                                    /*  입력USER구분(1.의사,2.간호사) */
					, ''                                 	  /*  추가처방 확인간호사 */
					, null                                    /*   추가처방 확인시간 */
					,  nvl( #{hslcDvsnCd}, HSLC_DVSN_CD )     /*  장소구분 */
					,  nvl( #{mccnCd}, MCCN_CD ) 			  /*  센터구분 */
					,  a.HGCN_KEEP_RESN_CD                    /*  고함량유지 사유 */
					,  a.HGCN_KEEP_ETRE_CTN                   /*  고함량유지 기타사유 */
					,  a.TOTL_VLM                             /*  총용량 */
					,  a.FRNS_VLM                             /*  불출용량 */
					,  a.FRNS_CTRL_DVSN_CD                    /*  불출제어구분코드 */
					,  a.FRNS_YN                              /*  불출여부 */
					,  a.FRNS_RQPR_TYPE_CD                    /*  불출요청자유형코드 */
					,  a.FRNS_RQPR_ID                         /*  FRNS_RQPR_ID */
					,  a.FRNS_RQPR_IP                         /*  불출요청자IP */
					,  a.FRNS_RQST_DT                         /*  불출요청일시 */
					,  a.CYCL_ORDV_CD                         /*  주기처방구분코드 */
					,  a.CYCL_ORDR_STRT_YMD                   /*  주기처방시작일자 */
					,  a.CYCL_ORDR_FNSH_YMD                   /*  주기처방종료일자 */
					,  a.CYCL_ORDR_DYWK_CTN                   /*  주기처방요일내용 */
					,  a.CYCL_ORDR_DDCN                       /*  주기처방일수 */
					,  a.FLUD_TOTL_QTY                        /*  수액총량 */
					,  a.FLUD_OVER_VL                         /*  수액Over값 */
					,  a.FLUD_CC_HR_VL                        /*  수액CC_HR값 */
					,  a.FLUD_Q_HR_VL                         /*  수액Q_HR값 */
					,  a.AGE_TABO_ORRE_CTN                    /*  연령금기처방사유내용 */
					,  a.DURV_YN                              /*  DUR여부 */
					,  a.DURV_ORTA_NM                         /*  DUR처방테이블명 */
					,  a.DURV_ORDR_YMD                        /*  DUR처방일자 */
					,  a.DURV_ORDR_CD                         /*  DUR처방코드 */
					,  to_date ( #{orglOrdrYmd}, 'yyyymmdd' ) /*  원처방 일자 PRNORGSEQNO */
					,  #{orglOrdrSno}                         /*  원처방 순번 PRNORGSEQNO */
					,  #{ordrCrtnDvsnCd}                      /*  ★★ 처방생성구분코드 응급실1차실시처방 '11', CIV추가처방 '09' ★★ */
					, #{gvUserId}                             /*  최초등록자ID */
					, #{gvUserIp}                             /*  최초등록IP */
					, sysdate                                 /*  최초등록일시 */
					, #{gvClntPrgmId}                         /*  최초등록SMC클라이언트프로그램ID */
					, #{gvSrvrPrgmId}                         /*  최초등록SMC서버프로그램ID */
					, #{gvUserId}                             /*  최종수정자ID */
					, #{gvUserIp}                             /*  최종수정IP */
					, sysdate                                 /*  최종수정일시 */
					, #{gvClntPrgmId}                         /*  최종수정SMC클라이언트프로그램ID */
					, #{gvSrvrPrgmId}                         /*  최종수정SMC서버프로그램ID */
					,  0                                      /*  실시처방발행횟수                   */
					,  0                                      /*  실시처방발행제한횟수               */
					,  0                                      /*  DUR반납일수                        */
					,  0                                      /*  투약번호                           */
					,  0                                      /*  투약Kg당용량                       */
					,  0                                      /*  동시처방묶음번호                   */
					,  0                                      /*  마약처방전출력횟수                 */
					,  0                                      /*  마약반납처방전출력횟수             */
					,  0                                      /*  액팅횟수                           */
					,  0                                      /*  약국반납량                         */
					,  0                                      /*  원무계산이후약반납량               */
					,  0                                      /*  예외사유반납량                     */
					,  0                                      /*  투약라벨출력횟수                   */
					,  0                                      /*  불출반납수량                       */
					,  0                                      /*  항암제투여시간분                   */
					,  0                                      /*  처방생성연결번호                   */
					,  ( select  case when count(PTNO) = 0 then 'Y' end
						   from  MDMEDORDT
						  where  PTNO = #{ptno}
							and  ORDR_CD = a.ORDR_CD
							and  DC_DVSN_CD in ( 'N' , 'Y' ) /*  실처방만 발행된 처방임 */
							and  nvl( ORFR_CD, 'X' ) not in  ( 'P', 'F' ) /*  임시처방 ( PRN, 응급실 1차 제외 ) */
							and  rownum = 1 )
					,  sysdate                                /*  처방수정일시                       */
					,  #{gvUserId}                       /*  처방수정자ID                    */
					,  decode(a.ODKI_DETL_CD, 'V', '','Z','', a.ODKI_DETL_CD)             /*  처방형태상세                       */
		            ,  a.SUB_TYPE_CD                 /* 부유형코드 */ 
		            ,  a.SCRG_INPY_ONBR_RT      /* 선별급여본인부담율 */
		            ,  a.CNSN_RLTD_YN
		            ,  a.CNSN_RLTD_MCDP_CD
		            ,  a.SPOR_BNDL_NO
		            ,  a.SPOR_BNDL_NM
					,  '1'
				 from  MDMEDORDT a
				where  a.PTNO     = #{ptno}
				  and  a.ORDR_YMD = to_date( #{orglOrdrYmd}, 'yyyymmdd')
				  and  a.ORDR_SNO = #{orglOrdrSno}
			)
			]]>
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateInjcOrdrCmmdDetlDc () 
        Description :                       
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
    -->	
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateInjcOrdrCmmdDetlDc"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-updateInjcOrdrCmmdDetlDc */
		update SDPORDDET a
		   set CMMD_STTS_CD = '8'
		 where PTNO = #{ptno}
		   and ORDR_YMD = to_date(#{ordrYmd}, 'yyyymmdd')
		   and ORDR_SNO = #{ordrSno}
		   and CMMD_STTS_CD <![CDATA[ <= ]]> '5'
		   and exists (select 1
		                 from MDMEDORDT
		                where PTNO = a.PTNO
		                  and ORDR_YMD = a.ORDR_YMd
		                  and ORDR_SNO = a.ORDR_SNO
		                  and CODV_CD = 'O'
		                  and ORDR_CLTY_CD = 'B1'
		                  and IHOH_DVSN_CD = 'I'
		                  and nvl(OSLF_ADMN_DRUG_YN, 'N') != 'Y'
		                  and DC_DVSN_CD = 'X'
		              )
	</update>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDprtFrnsCtrlYn-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO">
	
		<result property="yn" column="YN"/>
	</resultMap>
	
    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDprtFrnsCtrlYn (불출제어 예외 부서 여부) 
        Description :                                           불출제어 예외 부서 여부
                                            
		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDprtFrnsCtrlYn-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDprtFrnsCtrlYn"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOrdrDrugMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDprtFrnsCtrlYn-result" useCache="true" flushCache="false">
		<![CDATA[
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOrdrDrugMngmDAO-selectOneDprtFrnsCtrlYn */
		select decode(count(1), 0, 'N', 'Y') AS YN
		  from MZCTRLMMT
		 where MDCR_CTRL_CD = 'MDP_107'
		   and MDCR_DTLS_CTRL_CD = #{frnsDprtCd}
		   and rownum = 1
		]]>
	</select>



</mapper>