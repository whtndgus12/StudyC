<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<!--
    SQL File Name : mapper_MdpOtptCmtxMngmDAO_sql.xml
    Description :                                      외래협진관리 DAO
                  -->
<mapper namespace="MdpOtptCmtxMngmDAO">




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-insertOtptCmtxRefr (외래환자진료의뢰 정보 입력)
        Description :                                           외래환자진료의뢰 정보 입력

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
    -->
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-insertOtptCmtxRefr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-insertOtptCmtxRefr */
		insert  /* MdpOtptCmtxMngmDAO-insertOtptCmtxRefr_외래환자진료의뢰 등록 */
		  into  MDOPTMDRT
		        (
		        PTNO                       /* 환자번호 */
		     ,  REFR_YMD                   /* 의뢰일자 */
		     ,  REFR_SNO                   /* 의뢰일련번호 */
		     ,  RFRR_ID                    /* 의뢰자ID */
		     ,  REFR_MCDP_CD               /* 의뢰진료과코드 */
		     ,  RPLY_RQST_YN               /* 회신요청여부 */
		     ,  RQST_DVSN_CD               /* 요청구분코드 */
		     ,  MDCR_REFR_CTN              /* 진료의뢰내용 */
		     ,  REFR_FORM_NO               /* 의뢰서식번호 */
		     ,  REFR_XML_BD                /* 의뢰XML자료 */
		     ,  REFR_DT                    /* 의뢰일시 */
		     ,  CODV_CD                    /* 내원구분코드 */
		     ,  FRST_RGSR_ID
		     ,  FRST_RGST_IP
		     ,  FRST_RGST_DT
		     ,  FRST_RGST_CLNT_PRGM_ID
		     ,  FRST_RGST_SRVR_PRGM_ID
		     ,  LAST_UPDR_ID
		     ,  LAST_UPDT_IP
		     ,  LAST_UPDT_DT
		     ,  LAST_UPDT_CLNT_PRGM_ID
		     ,  LAST_UPDT_SRVR_PRGM_ID
		        )
		values  (
		        #{ptno}
		     ,  to_date(#{refrYmd}, 'yyyymmdd')
		     ,  #{refrSno}
		     ,  #{rfrrId}
		     ,  #{refrMcdpCd}
		     ,  #{rplyRqstYn}
		     ,  #{rqstDvsnCd}
		     ,  #{mdcrRefrCtn}
		     ,  #{refrFormNo}
		     ,  #{refrXmlBdByte}
		     ,  sysdate
		     ,  #{codvCd}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		        )
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-insertOtptCmtxRply (외래환자진료회신 정보 입력)
        Description :                                           외래환자진료회신 정보 입력

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
    -->
	<insert id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-insertOtptCmtxRply"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-insertOtptCmtxRply */
		insert  /* MdpOtptCmtxMngmDAO-insertOtptCmtxRply_외래환자진료회신 등록 */
		  into  MDOPTMRRT
		        (
		        PTNO                        /* 환자번호 */
		     ,  REFR_YMD                    /* 의뢰일자 */
		     ,  REFR_SNO                    /* 의뢰일련번호 */
		     ,  RPLY_SNO                    /* 회신일련번호 */
		     ,  RCVR_ID                     /* 수신자ID */
		     ,  RECV_MCDP_CD                /* 수신진료과코드 */
		     ,  MCCN_CD                     /* 진료센터코드 */
		     ,  PADV_CD                     /* 장소구분코드 */
		     ,  CMTX_STTS_CD                /* 협진상태코드 */
		     ,  CNCL_YN                     /* 취소여부 */
		     ,  PTAD_TRAS_YN                /* 원무전송여부 */
		     ,  APNT_WNTD_DT_CTN            /* 예약희망일시내용 */
		     ,  APNT_MDRP_NO                /* 예약진료접수번호 */
		     ,  FRST_RGSR_ID
		     ,  FRST_RGST_IP
		     ,  FRST_RGST_DT
		     ,  FRST_RGST_CLNT_PRGM_ID
		     ,  FRST_RGST_SRVR_PRGM_ID
		     ,  LAST_UPDR_ID
		     ,  LAST_UPDT_IP
		     ,  LAST_UPDT_DT
		     ,  LAST_UPDT_CLNT_PRGM_ID
		     ,  LAST_UPDT_SRVR_PRGM_ID
		        )
		values  (
		        #{ptno}
		     ,  to_date(#{refrYmd}, 'yyyymmdd')
		     ,  #{refrSno}
		     ,  #{rplySno}
		     ,  #{rcvrId}
		     ,  #{recvMcdpCd}
		     ,  #{mccnCd}
		     ,  #{padvCd}
		     ,  #{cmtxSttsCd}
		     ,  'N'
		     ,  'N'
		     ,  #{apntWntdDtCtn}
		     ,  #{apntMdrpNo}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		     ,  #{gvUserId}
		     ,  #{gvUserIp}
		     ,  sysdate
		     ,  #{gvClntPrgmId}
		     ,  #{gvSrvrPrgmId}
		        )
	</insert>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-updateOtptCmtxRefr (외래환자진료의뢰 정보 수정)
        Description :                                           외래환자진료의뢰 정보 수정

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
    -->
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-updateOtptCmtxRefr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-updateOtptCmtxRefr */
		UPDATE  /* MdpOtptCmtxMngmDAO-updateOtptCmtxRefr_외래환자진료의뢰 정보 수정 */
		        MDOPTMDRT
		   set  LAST_UPDR_ID            =   #{gvUserId}
		     ,  LAST_UPDT_IP            =   #{gvUserIp}
		     ,  LAST_UPDT_DT            =   sysdate
		     ,  LAST_UPDT_CLNT_PRGM_ID  =   #{gvClntPrgmId}
		     ,  LAST_UPDT_SRVR_PRGM_ID  =   #{gvSrvrPrgmId}
		 <if test="rplyRqstYn != null">
		     ,  RPLY_RQST_YN            =   #{rplyRqstYn}               /* 회신요청여부 */
		 </if>
		 <if test="rqstDvsnCd != null">
		     ,  RQST_DVSN_CD            =   #{rqstDvsnCd}               /* 요청구분코드 */
		 </if>
		 <if test="mdcrRefrCtn != null">
		     ,  MDCR_REFR_CTN           =   #{mdcrRefrCtn}              /* 진료의뢰내용 */
		 </if>
		 <if test="refrFormNo != null">
		     ,  REFR_FORM_NO            =   #{refrFormNo}               /* 의뢰서식번호 */
		 </if>
		 <if test="refrXmlBdByte != null">
		     ,  REFR_XML_BD             =   #{refrXmlBdByte}            /* 의뢰XML자료 */
		 </if>
		 where  PTNO                    =   #{ptno}
		   and  REFR_YMD                =   to_date(#{refrYmd}, 'yyyymmdd')
		   and  REFR_SNO                =   #{refrSno}
	</update>




    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-updateOtptCmtxRply (외래환자진료회신 정보 수정)
        Description :                                           외래환자진료회신 정보 수정

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
    -->
	<update id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-updateOtptCmtxRply"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  >
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-updateOtptCmtxRply */
		update  /* 외래환자진료회신 정보 수정 */
		        MDOPTMRRT
		   set  LAST_UPDR_ID            =   #{gvUserId}
		     ,  LAST_UPDT_IP            =   #{gvUserIp}
		     ,  LAST_UPDT_DT            =   sysdate
		     ,  LAST_UPDT_CLNT_PRGM_ID  =   #{gvClntPrgmId}
		     ,  LAST_UPDT_SRVR_PRGM_ID  =   #{gvSrvrPrgmId}

		 <if test="rcvrId != null">
		     ,  RCVR_ID        =   #{rcvrId}                                            /* 수신자ID */
		 </if>
		 <if test="apntWntdDtCtn != null">
		     ,  APNT_WNTD_DT_CTN        =   #{apntWntdDtCtn}                            /* 예약희망일시내용 */
		 </if>
		 <if test="newRefrSno != null and newRefrSno != 0">
		     ,  REFR_SNO                =   #{newRefrSno}
		 </if>
		 <if test="newRplySno != null and newRplySno != 0">
		     ,  RPLY_SNO                =   #{newRplySno}
		 </if>
		 <if test="cmtxSttsCd != null">
		     ,  CMTX_STTS_CD            =   #{cmtxSttsCd}                               /* 협진상태코드 */
		 </if>
		 <if test="cnclYn != null">
		     ,  CNCL_YN                 =   #{cnclYn}                                   /* 취소여부 */
		 </if>
		 <if test="cncrId != null">
		     ,  CNCR_ID                 =   #{cncrId}                                   /* 취소자ID */
		 </if>
		 <if test="cnclDt != null">
		     ,  CNCL_DT                 =   to_date(#{cnclDt}, 'yyyymmddhh24miss')      /* 취소일시 */
		 </if>
		 <if test="cfprId != null">
		     ,  CFPR_ID                 =   #{cfprId}                                   /* 확정자ID */
		 </if>
		 <if test="dfntDt != null">
		     ,  DFNT_DT                 =   to_date(#{dfntDt}, 'yyyymmddhh24miss')      /* 확정일시 */
		 </if>
		 <if test="unslCtn != null">
		     ,  UNSL_CTN                =   #{unslCtn}                                  /* 특이내용 */
		 </if>
		 <if test="rplyDrId != null">
		     ,  RPLY_DR_ID              =   #{rplyDrId}                                 /* 회신의사ID */
		 </if>
		 <if test="rplyYmd != null">
		     ,  RPLY_YMD                =   to_date(#{rplyYmd}, 'yyyymmdd')             /* 회신일자 */
		 </if>
		 <if test="rplyDt != null">
		     ,  RPLY_DT                 =   to_date(#{rplyDt}, 'yyyymmddhh24miss')      /* 회신일시 */
		 </if>
		 <if test="cmtxRplyCtn != null">
		     ,  CMTX_RPLY_CTN           =   #{cmtxRplyCtn}                              /* 회신내용 */
		 </if>
		 <if test="rplyFormNo != null">
		     ,  RPLY_FORM_NO            =   #{rplyFormNo}                               /* 회신서식번호 */
		 </if>
		 <if test="rplyXmlBdByte != null">
		     ,  RPLY_XML_BD             =   #{rplyXmlBdByte}                            /* 회신XML자료 */
		 </if>
		 <if test="apntMdrpNo != null and apntMdrpNo != 0">
		     ,  APNT_MDRP_NO            =   #{apntMdrpNo}                               /* 예약진료접수번호 */
		 </if>
		 <if test="ptadTrasYn != null">
		     ,  PTAD_TRAS_YN            =   #{ptadTrasYn}                               /* 원무전송여부 */
		 </if>
		 <if test="ptadTrasCtn != null">
		     ,  PTAD_TRAS_CTN           =   #{ptadTrasCtn}                              /* 원무전송내용 */
		 </if>
		 <if test="cnfmId != null">
		     ,  CNFM_ID                 =   #{cnfmId}                                   /* (회신)확인자ID */
		 </if>
		 <if test="cnfrDt != null">
		     ,  CNFR_DT                 =   to_date(#{cnfrDt}, 'yyyymmddhh24miss')      /* (회신)확인일시 */
		 </if>
		 where  PTNO                    =   #{ptno}
		   and  REFR_YMD                =   to_date(#{refrYmd}, 'yyyymmdd')
		   and  REFR_SNO                =   #{refrSno}
		   and  RPLY_SNO                =   #{rplySno}
	</update>


	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxDrForMltxSlct-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO">

		<result property="mddrId" column="MDDR_ID"/>
		<result property="mddrNm" column="MDDR_NM"/>
		<result property="mcdpCd" column="MCDP_CD"/>
		<result property="abrvMcdpCd" column="ABRV_MCDP_CD"/>
		<result property="mnhsMdfiCtn" column="MNHS_MDFI_CTN"/>
		<result property="hmpgMdfiCtn" column="HMPG_MDFI_CTN"/>
		<result property="refrYmd" column="REFR_YMD"/>
		<result property="refrCct" column="REFR_CCT"/>
	</resultMap>

    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxDrForMltxSlct (다중선택 협진의 조회)
        Description :                                           다중선택 협진의 조회

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxDrForMltxSlct-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxDrForMltxSlct"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxDrForMltxSlct-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxDrForMltxSlct */
		SELECT  /* MdpOtptCmtxMngmDAO-listCmtxDrForMltxSlct_다중선택 협진의 조회 */
		        r.MDDR_ID                           as MDDR_ID
		     ,  r.MDDR_NM                           as MDDR_NM
		     ,  r.MCDP_CD                           as MCDP_CD
		     ,  r.ABRV_MCDP_CD                      as ABRV_MCDP_CD
		     ,  r.MNHS_MDFI_CTN                     as MNHS_MDFI_CTN
		     ,  r.HMPG_MDFI_CTN                     as HMPG_MDFI_CTN
		     ,  to_char(m.REFR_YMD, 'yyyymmdd')     as REFR_YMD             /* 최근의뢰일자 */
		     ,  m.REFR_CCT                          as REFR_CCT             /* 의뢰건수 */
		  from  (
		            select  distinct
		                    a.MCDP_CD               as MCDP_CD              /* 진료과코드 */
		                 ,  e.ABRV_DPRT_CD          as ABRV_MCDP_CD         /* 약어진료과코드 */
		                 ,  a.MDDR_ID               as MDDR_ID              /* 진료의사ID */
		                 ,  b.USER_NM               as MDDR_NM              /* 진료의사명 */
		                 ,  d.MNHS_MDFI_CTN         as MNHS_MDFI_CTN        /* 본원진료분야내용 */
		                 ,  d.HMPG_MDFI_CTN         as HMPG_MDFI_CTN        -- 홈페이지진료분야내용
		              from  APDSDRDPT a             -- 의사진료과
		                 ,  CCUSRDPHT b
		                 ,  APDSDRCNT c             -- 의사진료센터
		                 ,  APETDRFDT d             -- 진료의진료분야
		                 ,  HZDEPTMMT e             -- 조직마스터
		             where  a.MDCR_YN       =   'Y'
		               and  a.APFN_YMD  <![CDATA[   >=  ]]> trunc(sysdate)
		               and  b.USER_ID       =   a.MDDR_ID
		               and  b.APFN_YMD  <![CDATA[   >=  ]]> trunc(sysdate)
		               and  c.MCDP_CD       =   a.MCDP_CD
		               and  c.MDDR_ID       =   a.MDDR_ID
		               and  c.APFN_YMD  <![CDATA[   >=  ]]> trunc(sysdate)
		               and  d.MCDP_CD   (+) =   a.MCDP_CD
		               and  d.MDDR_ID   (+) =   a.MDDR_ID
		               and  e.DPRT_CD       =   a.MCDP_CD
		               and  trunc(sysdate) between e.APST_YMD and e.APFN_YMD
		        ) r
		     ,  (   /* 다빈도 외래협진 내역 */
		            select  b.RECV_MCDP_CD      as  RECV_MCDP_CD
		                 ,  b.RCVR_ID           as  RCVR_ID
		                 ,  count(1)            as  REFR_CCT
		                 ,  max(a.REFR_YMD)     as  REFR_YMD
		              from  MDOPTMDRT a
		                 ,  MDOPTMRRT b
		             where  a.RFRR_ID   =   #{rfrrId}
		               and  a.REFR_YMD between trunc(sysdate - 365) and trunc(sysdate)
		               and  b.PTNO      =   a.PTNO
		               and  b.REFR_YMD  =   a.REFR_YMD
		               and  b.REFR_SNO  =   a.REFR_SNO
		               and  b.RCVR_ID is not null
		             group
		                by  b.RECV_MCDP_CD
		                 ,  b.RCVR_ID
		        ) m
		 where  m.RECV_MCDP_CD  (+) =   r.MCDP_CD
		   and  m.RCVR_ID       (+) =   r.MDDR_ID
		 <choose>
		    <when test='inqrCndtNm != null and inqrCndtNm == "highFrqn"'>
		    <!-- #{inqrCndtNm} 'highFrqn' 다빈도 외래협진 -->
		   and  m.REFR_CCT  <![CDATA[   >   ]]> 0
		    </when>
		 </choose>
		 <if test='mnhsMdfiCtn != null and mnhsMdfiCtn != ""'>
		   and  r.MNHS_MDFI_CTN like '%' || #{mnhsMdfiCtn} || '%'       -- 본원진료분야내용
		 </if>
		 <if test='mcdpCd != null and mcdpCd != ""'>
		   and  r.MCDP_CD           =   #{mcdpCd}                       -- 진료과
		 </if>
		 <if test='mddrNm != null and mddrNm != ""'>
		   and  r.MDDR_Nm like '%' || #{mddrNm} || '%'                  -- 진료의사명
		 </if>
		 order
		    by
		 <choose>
		   <when test='inqrCndtNm != null and inqrCndtNm == "highFrqn"'>
		        m.REFR_CCT desc
		     ,  m.REFR_YMD desc
		   </when>
		   <otherwise>
		        r.ABRV_MCDP_CD
		     ,  r.MDDR_NM
		   </otherwise>
		 </choose>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxEmrForm-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO">

		<result property="dprtCd" column="DPRT_CD"/>
		<result property="abrvDprtCd" column="ABRV_DPRT_CD"/>
		<result property="foclId" column="FOCL_ID"/>
		<result property="foclNm" column="FOCL_NM"/>
		<result property="formNo" column="FORM_NO"/>
		<result property="emrFormNm" column="EMR_FORM_NM"/>
		<result property="rckiCd" column="RCKI_CD"/>
		<result property="crtfYn" column="CRTF_YN"/>
	</resultMap>

    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxEmrForm (협진 EMR서식목록 조회)
        Description :                                           협진 EMR서식목록 조회

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxEmrForm-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxEmrForm"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxEmrForm-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listCmtxEmrForm */
		select  /* MdpOtptCmtxMngmDAO-listCmtxEmrForm_서식목록 조회 */
		        c.DPRT_CD                   as DPRT_CD          -- 부서코드
		     ,  (   select  ABRV_DPRT_CD
		              from  HZDEPTMMT
		             where  DPRT_CD =   c.DPRT_CD
		        )                           as ABRV_DPRT_CD     -- 약어부서코드
		     ,  b.FOCL_ID                   as FOCL_ID          -- 서식분류ID
		     ,  b.FOCL_NM                   as FOCL_NM          -- 서식분류명
		     ,  a.FORM_NO                   as FORM_NO          -- 서식번호
		     ,  a.EMR_FORM_NM               as EMR_FORM_NM      -- EMR서식명
		     ,  a.RCKI_CD                   as RCKI_CD          -- 기록종류코드
		     ,  a.CRTF_YN                   as CRTF_YN          -- 인증여부
		  from  MEFORMBST a
		     ,  (
		            select  distinct
		                    x.FOCL_ID
		                 ,  x.FOCL_NM
		                 ,  y.FORM_NO
		              from  MEFOCOCLT x     -- 공통서식분류
		                 ,  MEFOCOCNT y     -- 공통서식분류구성
		             where  x.SPRN_DPRT_CD  =   #{sprnDprtCd}
		               and  y.SPRN_DPRT_CD  =   X.SPRN_DPRT_CD
		               and  y.FOCL_ID       =   x.FOCL_ID
		        ) b
		     ,  (
		            select  distinct
		                    FORM_NO
		                 ,  DPRT_CD
		              from  MEFORDEPT       -- 부서별서식
		             where  EMR_DVSN_CD     =   'DEPT'
		               and  SPRN_DPRT_CD    =   #{sprnDprtCd}
		        ) c
		 where  nvl(a.DLTN_YN, 'N') = 'N'
		   and  sysdate between a.STRT_DT and nvl(a.FNSH_YMD, to_date('29991231', 'yyyymmdd'))
		   and  a.SPRN_DPRT_CD  =   #{sprnDprtCd}       -- 주관부서코드 (112190:의무기록실)
		   and  a.RCKI_CD       =   #{rckiCd}           -- 기록종류코드 (090:협진의뢰, 091:협진회신)
		   and  a.USE_UNIT_CD in (#{useUnitCd}, '03')   -- 사용단위코드 (01:입원, 02:외래, 03:공통)
		   and  b.FORM_NO       =   a.FORM_NO
		   and  c.FORM_NO   (+) =   a.FORM_NO
		 <if test='inqrCndtNm != null and inqrCndtNm != ""'>
		   and  (   c.DPRT_CD is null
		            or
		            #{inqrCndtNm} like '%' || c.DPRT_CD || '%'
		        )
		 </if>
		 order
		    by  ABRV_DPRT_CD
		     ,  FOCL_NM
		     ,  EMR_FORM_NM
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listDrBaseCntr-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO">

		<result property="mccnCd" column="MCCN_CD"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="abrvMccnCd" column="ABRV_MCCN_CD"/>
		<result property="hslcDvsnCd" column="HSLC_DVSN_CD"/>
	</resultMap>

    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listDrBaseCntr (의사기준 센터목록 조회)
        Description :                                           의사기준 센터목록 조회

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listDrBaseCntr-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listDrBaseCntr"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listDrBaseCntr-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listDrBaseCntr */
		<![CDATA[
		SELECT  /* MdpOtptCmtxMngmDAO-listDrBaseCntr_의사기준 센터목록 조회 */
		        a.DPRT_CD                                   as MCCN_CD
		     ,  a.KORN_DPRT_NM                              as MCCN_NM
		     ,  a.ABRV_DPRT_CD                              as ABRV_MCCN_CD
		     ,  a.HSLC_DVSN_CD                              as HSLC_DVSN_CD
		  from  HZDEPTMMT a
		 where  a.CNTR_DVSN_YN  =   'Y'
		   and  a.USE_YN        =   'Y'
		   and  a.APST_YMD      <=  sysdate
		   and  a.APFN_YMD      >=  sysdate
		   and  a.DPRT_CD in (
		            select  b.MCCN_CD
		              from  APDSDRCNT b     -- 의사진료센터
		             where  b.MCDP_CD       =   nvl(#{mcdpCd}, b.MCDP_CD)
		               and  b.MDDR_ID       =   nvl(#{mddrId}, b.MDDR_ID)
		               and  b.HSLC_DVSN_CD  =   nvl(#{hslcDvsnCd}, b.HSLC_DVSN_CD)
		               and  b.MCCN_CD not in ('201387', '201406')       /* 본원(201387), 암병원(201406) 제외 */
		               and  b.APST_YMD      <=  sysdate
		               and  b.APFN_YMD      >=  sysdate
		             group
		                by  b.MCCN_CD
		        )
		 order
		    by  a.LCTN_BASE_SORT_SQNC
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listOtptCmtx-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO">

		<result property="ptno" column="PTNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="btdt" column="BTDT"/>
		<result property="refrYmd" column="REFR_YMD"/>
		<result property="refrDt" column="REFR_DT"/>
		<result property="refrSno" column="REFR_SNO"/>
		<result property="refrMcdpCd" column="REFR_MCDP_CD"/>
		<result property="refrAbrvMcdpCd" column="REFR_ABRV_MCDP_CD"/>
		<result property="rfrrId" column="RFRR_ID"/>
		<result property="rfrrNm" column="RFRR_NM"/>
		<result property="rplyRqstYn" column="RPLY_RQST_YN"/>
		<result property="rqstDvsnCd" column="RQST_DVSN_CD"/>
		<result property="refrFormNo" column="REFR_FORM_NO"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="codvNm" column="CODV_NM"/>
		<result property="rplySno" column="RPLY_SNO"/>
		<result property="recvMcdpCd" column="RECV_MCDP_CD"/>
		<result property="recvAbrvMcdpCd" column="RECV_ABRV_MCDP_CD"/>
		<result property="rcvrId" column="RCVR_ID"/>
		<result property="rcvrNm" column="RCVR_NM"/>
		<result property="mccnCd" column="MCCN_CD"/>
		<result property="mccnNm" column="MCCN_NM"/>
		<result property="rplyFormNo" column="RPLY_FORM_NO"/>
		<result property="cnclYn" column="CNCL_YN"/>
		<result property="cncrId" column="CNCR_ID"/>
		<result property="cnclDt" column="CNCL_DT"/>
		<result property="ptadTrasYn" column="PTAD_TRAS_YN"/>
		<result property="ptadTrasCtn" column="PTAD_TRAS_CTN"/>
		<result property="cfprId" column="CFPR_ID"/>
		<result property="cfprNm" column="CFPR_NM"/>
		<result property="dfntDt" column="DFNT_DT"/>
		<result property="rplyDrId" column="RPLY_DR_ID"/>
		<result property="rplyDrNm" column="RPLY_DR_NM"/>
		<result property="rplyYmd" column="RPLY_YMD"/>
		<result property="rplyDt" column="RPLY_DT"/>
		<result property="cnfmId" column="CNFM_ID"/>
		<result property="cnfmNm" column="CNFM_NM"/>
		<result property="cnfrDt" column="CNFR_DT"/>
		<result property="unslCtn" column="UNSL_CTN"/>
		<result property="apntMdrpNo" column="APNT_MDRP_NO"/>
		<result property="apntWntdDtCtn" column="APNT_WNTD_DT_CTN"/>
		<result property="cmtxSttsCd" column="CMTX_STTS_CD"/>
		<result property="cmtxSttsNm" column="CMTX_STTS_NM"/>
		<result property="mdcrYn" column="MDCR_YN"/>
		<result property="mdcrDt" column="MDCR_DT"/>
		<result property="apntCnclDt" column="APNT_CNCL_DT"/>
	</resultMap>

    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listOtptCmtx (외래협진내역 조회)
        Description :                                           외래협진내역 조회

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listOtptCmtx-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listOtptCmtx"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listOtptCmtx-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-listOtptCmtx */
		SELECT  /* MdpOtptCmtxMngmDAO-listOtptCmtx_외래협진내역 조회 */
		        d.PTNO                                  as PTNO                 /* 환자번호 */
		     ,  p.PTNT_NM                               as PTNT_NM              /* 환자명 */
		     ,  p.GEND_CD                               as GEND_CD              /* 성별코드 */
		     ,  to_char(p.BTDT, 'yyyymmdd')             as BTDT                 /* 생년월일 */
		     ,  to_char(d.REFR_YMD, 'yyyymmdd')         as REFR_YMD             /* 의뢰일자 */
		     ,  to_char(d.REFR_DT, 'yyyymmddhh24miss')  as REFR_DT              /* 의뢰일시 */
		     ,  d.REFR_SNO                              as REFR_SNO             /* 의뢰일련번호 */
		     ,  d.REFR_MCDP_CD                          as REFR_MCDP_CD         /* 의뢰진료과코드 */
		     ,  (   select  ABRV_DPRT_CD
		              from  HZDEPTMMT
		             where  DPRT_CD     =   d.REFR_MCDP_CD
		        )                                       as REFR_ABRV_MCDP_CD    /* 의뢰약어진료과코드 */
		     ,  d.RFRR_ID                               as RFRR_ID              /* 의뢰자ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID     =   d.RFRR_ID
		        )                                       as RFRR_NM              /* 의뢰의명 */
		     ,  d.RPLY_RQST_YN                          as RPLY_RQST_YN         /* 회신요청여부 */
		     ,  d.RQST_DVSN_CD                          as RQST_DVSN_CD         /* 요청구분코드 */
		     ,  d.REFR_FORM_NO                          as REFR_FORM_NO         /* 의뢰서식번호 */
		     ,  d.CODV_CD                               as CODV_CD              /* 내원구분코드 */
		     ,  (   select  DETL_CD_NM
		              from  CCCMCDDMT
		             where  COMN_GRP_CD     =   'AP025'
		               and  COMN_DTLS_CD    =   d.CODV_CD
		        )                                       as CODV_NM              /* 내원구분명 */
		     ,  r.RPLY_SNO                              as RPLY_SNO             /* 회신일련번호 */
		     ,  r.RECV_MCDP_CD                          as RECV_MCDP_CD         /* 수신진료과코드 */
		     ,  (   select  ABRV_DPRT_CD
		              from  HZDEPTMMT
		             where  DPRT_CD     =   r.RECV_MCDP_CD
		        )                                       as RECV_ABRV_MCDP_CD    /* 수신약어진료과코드 */
		     ,  r.RCVR_ID                               as RCVR_ID              /* 수신자ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID     =   r.RCVR_ID
		        )                                       as RCVR_NM              /* 수신자명 */
		     ,  r.MCCN_CD                               as MCCN_CD              /* 진료센터코드 */
		     ,  (   select  KORN_DPRT_NM
		              from  HZDEPTMMT
		             where  DPRT_CD     =   r.MCCN_CD
		        )                                       as MCCN_NM              /* 진료센터명 */
		     ,  r.RPLY_FORM_NO                          as RPLY_FORM_NO         /* 회신서식번호 */
		     ,  r.CNCL_YN                               as CNCL_YN              /* 취소여부 */
		     ,  r.CNCR_ID                               as CNCR_ID              /* 취소자ID */
		     ,  to_char(r.CNCL_DT, 'yyyymmddhh24miss')  as CNCL_DT              /* 취소일시 */
		     ,  r.PTAD_TRAS_YN                          as PTAD_TRAS_YN         /* 원무전송여부 */
		     ,  r.PTAD_TRAS_CTN                         as PTAD_TRAS_CTN        /* 원무전송내용 */
		     ,  r.CFPR_ID                               as CFPR_ID              /* 확정자ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID     =   r.CFPR_ID
		        )                                       as CFPR_NM              /* 확정자명 */
		     ,  to_char(r.DFNT_DT, 'yyyymmddhh24miss')  as DFNT_DT              /* 확정일시 */
		     ,  RPLY_DR_ID                              as RPLY_DR_ID           /* 회신의사ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID     =   r.RPLY_DR_ID
		        )                                       as RPLY_DR_NM           /* 회신의사명 */
		     ,  to_char(r.RPLY_YMD, 'yyyymmdd')         as RPLY_YMD             /* 회신일자 */
		     ,  to_char(r.RPLY_DT, 'yyyymmddhh24miss')  as RPLY_DT              /* 회신일시 */
		     ,  r.CNFM_ID                               as CNFM_ID              /* 확인자ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID     =   r.CNFM_ID
		        )                                       as CNFM_NM              /* 확인자명 */
		     ,  to_char(r.CNFR_DT, 'yyyymmddhh24miss')  as CNFR_DT              /* 확인일시 */
		     ,  r.UNSL_CTN                              as UNSL_CTN             /* 특이내용 */
		     ,  r.APNT_MDRP_NO                          as APNT_MDRP_NO         /* 예약진료접수번호 */
		     ,  r.APNT_WNTD_DT_CTN                      as APNT_WNTD_DT_CTN     /* 예약희망일시내용 */
		     ,  r.CMTX_STTS_CD                          as CMTX_STTS_CD         /* 협진상태코드 */
		     ,  (   select  DETL_CD_NM
		              from  CCCMCDDMT
		             where  COMN_GRP_CD     =   'MM320'
		               and  COMN_DTLS_CD    =   r.CMTX_STTS_CD
		        )                                       as CMTX_STTS_NM         /* 협진상태명 */
		     ,  b.MDCR_YN                               as MDCR_YN              /* 진료여부 */
		     ,  to_char(b.MDCR_DT, 'yyyymmddhh24miss')  as MDCR_DT              /* 진료일시 */
		     ,  to_char(b.CNCL_DT, 'yyyymmddhh24miss')  as APNT_CNCL_DT         /* 예약취소일시 */
		  from  MDOPTMDRT d         /* 진료의뢰요청 */
		     ,  MDOPTMRRT r         /* 진료의뢰회신 */
		     ,  APPTPTNTT p         /* 환자 */
		     ,  APRCRPTNT b         /* 진료접수 */
		 where  r.PTNO          =   d.PTNO
		   and  r.REFR_YMD      =   d.REFR_YMD
		   and  r.REFR_SNO      =   d.REFR_SNO
		   and  p.PTNO          =   d.PTNO
		   and  b.MDRP_NO   (+) =   r.APNT_MDRP_NO
		 <if test='ptno != null and ptno != ""'>
		   and  d.PTNO          =   #{ptno}
		 </if>
		 <if test='refrYmd != null and refrYmd != ""'>
		   and  d.REFR_YMD      =   to_date(#{refrYmd}, 'yyyymmdd')
		 </if>
		 <if test='refrSno != null and refrSno != 0'>
		   and  d.REFR_SNO      =   #{refrSno}
		 </if>
		 <if test='strtYmd != null and strtYmd != ""'>
		   and  d.REFR_YMD between to_date(#{strtYmd}, 'yyyymmdd') and to_date(#{fnshYmd}, 'yyyymmdd')
		 </if>
		 <if test='refrMcdpCd != null and refrMcdpCd != ""'>
		   and  d.REFR_MCDP_CD  =   #{refrMcdpCd}               /* 의뢰진료과코드 */
		 </if>
		 <if test='rfrrId != null and rfrrId != ""'>            /* 의뢰자ID */
		 <![CDATA[
		   and  d.RFRR_ID in (select b.USER_ID
							    from (
								        select distinct b.LGIN_ID
								          from CCUSERAMT a
								              ,CCUSRDPHT b
								         where a.LGIN_ID = b.LGIN_ID
								           and (b.USER_ID = #{rfrrId} or b.LGIN_ID = #{rfrrId})
								         group by b.LGIN_ID
								       ) a
								      ,ccusrdpht b
								 where a.LGIN_ID = b.LGIN_ID)
		 ]]>
		 </if>
		 <if test='recvMcdpCd != null and recvMcdpCd != ""'>
		   and  r.RECV_MCDP_CD  =   #{recvMcdpCd}               /* 수신진료과코드 */
		 </if>
		 <if test='rcvrId != null and rcvrId != ""'>            /* 수신자ID */
		 <![CDATA[
		   and  r.RCVR_ID in (select b.USER_ID
							    from (
								        select distinct b.LGIN_ID
								          from CCUSERAMT a
								              ,CCUSRDPHT b
								         where a.LGIN_ID = b.LGIN_ID
								           and (b.USER_ID = #{rcvrId} or b.LGIN_ID = #{rcvrId})
								         group by b.LGIN_ID
								       ) a
								      ,ccusrdpht b
								 where a.LGIN_ID = b.LGIN_ID)
		 ]]>
		 </if>
		 <if test='mccnCd != null and mccnCd != ""'>
		   and  r.MCCN_CD       =   #{mccnCd}                   /* 진료센터코드 */
		 </if>
		 <if test='cmtxSttsCd != null and cmtxSttsCd != ""'>
		   and  r.CMTX_STTS_CD  =   #{cmtxSttsCd}               /* 'MM320' ('1'의뢰, '2'의뢰확인, ..) */
		 </if>
		 <if test='cnclYn != null and cnclYn != ""'>
		   and  r.CNCL_YN       =   #{cnclYn}
		 </if>
		 <choose>
		   <when test='rplyYn != null and rplyYn == "Y"'>       /* 회신 */
		   <!-- #{rplyYn} 회신여부 -->
		   and  r.RPLY_YMD is not null
		   </when>
		   <when test='rplyYn != null and rplyYn == "N"'>       /* 미회신 */
		   and  r.RPLY_YMD is  null
		   </when>
		 </choose>
		 <if test='ptadTrasYn != null and ptadTrasYn != ""'>
		   and  nvl(r.PTAD_TRAS_YN, 'N') = #{ptadTrasYn}        /* 원무전송여부 */
		 </if>
		 <if test='rqstDvsnCd != null and rqstDvsnCd != ""'>
		   and  d.RQST_DVSN_CD  =   #{rqstDvsnCd}               /* 요청구분코드(1:환자, 2:의사, 3:모두원함) */
		 </if>
		 <choose>
		   <when test='apntYn != null and apntYn == "Y"'>
		   <!-- #{apntYn} 예약여부 -->
		   and  r.APNT_MDRP_NO is not null
		   </when>
		   <when test='apntYn != null and apntYn == "N"'>
		   and  r.APNT_MDRP_NO is null
		   </when>
		 </choose>
		 order
		    by  d.REFR_DT desc
		     ,  d.PTNO
		     ,  d.REFR_SNO
		     ,  r.RPLY_SNO
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRefrSno-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO">

		<result property="refrSno" column="REFR_SNO"/>
	</resultMap>

    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRefrSno (의뢰일련번호 신규채번)
        Description :                                           의뢰일련번호 신규채번

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRefrSno-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRefrSno"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRefrSno-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRefrSno */
		select  /* MdpOtptCmtxMngmDAO-selectOneNewRefrSno_의뢰일련번호 신규채번 */
		        nvl(max(REFR_SNO), 0) + 1       as REFR_SNO
		  from  MDOPTMDRT
		 where  REFR_YMD    =   to_date(#{refrYmd}, 'yyyymmdd')
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRplySno-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO">

		<result property="rplySno" column="RPLY_SNO"/>
	</resultMap>

    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRplySno (회신일련번호 신규채번)
        Description :                                           회신일련번호 신규채번

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRplySno-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRplySno"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRplySno-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneNewRplySno */
		select  /* MdpOtptCmtxMngmDAO-selectOneNewRplySno_회신일련번호 신규채번 */
		        nvl(max(RPLY_SNO), 0) + 1       as RPLY_SNO
		  from  MDOPTMRRT
		 where  PTNO        =   #{ptno}
		   and  REFR_YMD    =   to_date(#{refrYmd}, 'yyyymmdd')
		   and  REFR_SNO    =   #{refrSno}
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneOtptCmtxDetl-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO">

		<result property="ptno" column="PTNO"/>
		<result property="refrYmd" column="REFR_YMD"/>
		<result property="refrSno" column="REFR_SNO"/>
		<result property="rplySno" column="RPLY_SNO"/>
		<result property="ptntNm" column="PTNT_NM"/>
		<result property="gendCd" column="GEND_CD"/>
		<result property="btdt" column="BTDT"/>
		<result property="ageCtn" column="AGE_CTN"/>
		<result property="rfrrId" column="RFRR_ID"/>
		<result property="rfrrNm" column="RFRR_NM"/>
		<result property="refrMcdpCd" column="REFR_MCDP_CD"/>
		<result property="refrDt" column="REFR_DT"/>
		<result property="codvCd" column="CODV_CD"/>
		<result property="rplyRqstYn" column="RPLY_RQST_YN"/>
		<result property="rqstDvsnCd" column="RQST_DVSN_CD"/>
		<result property="mdcrRefrCtn" column="MDCR_REFR_CTN"/>
		<result property="refrFormNo" column="REFR_FORM_NO"/>
		<result property="refrXmlBdByte" column="REFR_XML_BD_BYTE"/>
		<result property="refrXmlBd" column="REFR_XML_BD"/>
		<result property="apntMdrpNo" column="APNT_MDRP_NO"/>
		<result property="rcvrId" column="RCVR_ID"/>
		<result property="rcvrNm" column="RCVR_NM"/>
		<result property="recvMcdpCd" column="RECV_MCDP_CD"/>
		<result property="recvAbrvMcdpCd" column="RECV_ABRV_MCDP_CD"/>
		<result property="smcrYnCd" column="SMCR_YN_CD"/>
		<result property="mccnCd" column="MCCN_CD"/>
		<result property="padvCd" column="PADV_CD"/>
		<result property="rplyYmd" column="RPLY_YMD"/>
		<result property="cmtxRplyCtn" column="CMTX_RPLY_CTN"/>
		<result property="rplyFormNo" column="RPLY_FORM_NO"/>
		<result property="rplyXmlBdByte" column="RPLY_XML_BD_BYTE"/>
		<result property="rplyXmlBd" column="RPLY_XML_BD"/>
		<result property="cnclYn" column="CNCL_YN"/>
		<result property="cnclDt" column="CNCL_DT"/>
		<result property="cncrId" column="CNCR_ID"/>
		<result property="ptadTrasYn" column="PTAD_TRAS_YN"/>
		<result property="ptadTrasCtn" column="PTAD_TRAS_CTN"/>
		<result property="cfprId" column="CFPR_ID"/>
		<result property="cfprNm" column="CFPR_NM"/>
		<result property="dfntDt" column="DFNT_DT"/>
		<result property="unslCtn" column="UNSL_CTN"/>
		<result property="mdcrRplyRecvDvsnCd" column="MDCR_RPLY_RECV_DVSN_CD"/>
		<result property="clniCntrCd" column="CLNI_CNTR_CD"/>
		<result property="apntWntdDtCtn" column="APNT_WNTD_DT_CTN"/>
		<result property="alrtCd" column="ALRT_CD"/>
		<result property="rplyDrId" column="RPLY_DR_ID"/>
		<result property="rplyDrNm" column="RPLY_DR_NM"/>
		<result property="rplyDt" column="RPLY_DT"/>
		<result property="apntCnreCtn" column="APNT_CNRE_CTN"/>
		<result property="cnfmId" column="CNFM_ID"/>
		<result property="cnfmNm" column="CNFM_NM"/>
		<result property="cnfrDt" column="CNFR_DT"/>
		<result property="cmtxSttsCd" column="CMTX_STTS_CD"/>
	</resultMap>

    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneOtptCmtxDetl (외래협진 상세조회)
        Description :                                           외래협진 상세조회

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneOtptCmtxDetl-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneOtptCmtxDetl"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneOtptCmtxDetl-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneOtptCmtxDetl */
		<![CDATA[
		SELECT  /*+ MdpOtptCmtxMngmDAO-selectOneOtptCmtxDetl_외래협진 상세조회 */
		        b.PTNO                                  as PTNO
		     ,  to_char(b.REFR_YMD, 'yyyymmdd')         as REFR_YMD
		     ,  b.REFR_SNO                              as REFR_SNO
		     ,  b.RPLY_SNO                              as RPLY_SNO
		     ,  c.PTNT_NM                               as PTNT_NM                  /* 환자명 */
		     ,  c.GEND_CD                               as GEND_CD                  /* 성별코드 */
		     ,  to_char(c.BTDT, 'yyyymmdd')             as BTDT
		     ,  FN_MD_GETAGE('2', c.BTDT, sysdate)      as AGE_CTN                  /* 연령내용 */
		     ,  a.RFRR_ID                               as RFRR_ID                  /* 의뢰자ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID = a.RFRR_ID
		        )                                       as RFRR_NM                  /* 의뢰의명 */
		     ,  a.REFR_MCDP_CD                          as REFR_MCDP_CD             /* 의뢰진료과코드 */
		     ,  to_char(a.REFR_DT, 'yyyymmddhh24miss')  as REFR_DT                  /* 의뢰일시 */
		     ,  a.CODV_CD                               as CODV_CD                  /* 내원구분코드 */
		     ,  a.RPLY_RQST_YN                          as RPLY_RQST_YN             /* 회신요청여부 */
		     ,  a.RQST_DVSN_CD                          as RQST_DVSN_CD             /* 요청구분코드 */
		     ,  a.MDCR_REFR_CTN                         as MDCR_REFR_CTN            /* 진료의뢰내용 */
		     ,  a.REFR_FORM_NO                          as REFR_FORM_NO             /* 의뢰서식번호 */
		     ,  a.REFR_XML_BD                           as REFR_XML_BD_BYTE         /* 의뢰XML자료 */
		     ,  ''                                      as REFR_XML_BD
		     ,  b.APNT_MDRP_NO                          as APNT_MDRP_NO             /* 예약진료접수번호 */
		     ,  b.RCVR_ID                               as RCVR_ID                  /* 수신자ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID = b.RCVR_ID
		        )                                       as RCVR_NM                  /* 수신자명 */
		     ,  b.RECV_MCDP_CD                          as RECV_MCDP_CD             /* 수신진료과코드 */
		     ,  (   select  ABRV_DPRT_CD
		              from  HZDEPTMMT
		             where  DPRT_CD     =   b.RECV_MCDP_CD
		        )                                       as RECV_ABRV_MCDP_CD        /* 수신약어진료과코드 */
		     ,  b.SMCR_YN_CD                            as SMCR_YN_CD               /* 선택진료여부코드 */
		     ,  b.MCCN_CD                               as MCCN_CD                  /* 진료센터코드 */
		     ,  b.PADV_CD                               as PADV_CD                  /* 장소구분코드 */
		     ,  to_char(b.RPLY_YMD, 'yyyymmdd')         as RPLY_YMD                 /* 회신일자 */
		     ,  b.CMTX_RPLY_CTN                         as CMTX_RPLY_CTN            /* 협진회신내용 */
		     ,  b.RPLY_FORM_NO                          as RPLY_FORM_NO             /* 회신서식번호 */
		     ,  b.RPLY_XML_BD                           as RPLY_XML_BD_BYTE         /* 회신XML자료 */
		     ,  ''                                      as RPLY_XML_BD
		     ,  b.CNCL_YN                               as CNCL_YN                  /* 취소여부 */
		     ,  to_char(b.CNCL_DT, 'yyyymmddhh24miss')  as CNCL_DT                  /* 취소일시 */
		     ,  b.CNCR_ID                               as CNCR_ID                  /* 취소자ID */
		     ,  b.PTAD_TRAS_YN                          as PTAD_TRAS_YN             /* 원무전송여부 */
		     ,  b.PTAD_TRAS_CTN                         as PTAD_TRAS_CTN            /* 원무전송내용 */
		     ,  b.CFPR_ID                               as CFPR_ID                  /* 확정자ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID     =   b.CFPR_ID
		        )                                       as CFPR_NM                  /* 확정자명 */
		     ,  to_char(b.DFNT_DT, 'yyyymmddhh24miss')  as DFNT_DT                  /* 확정일시 */
		     ,  b.UNSL_CTN                              as UNSL_CTN                 /* 특이내용 */
		     ,  b.MDCR_RPLY_RECV_DVSN_CD                as MDCR_RPLY_RECV_DVSN_CD   /* 진료회신수신구분코드 */
		     ,  b.CLNI_CNTR_CD                          as CLNI_CNTR_CD             /* 클리닉센터코드 */
		     ,  b.APNT_WNTD_DT_CTN                      as APNT_WNTD_DT_CTN         /* 예약희망일시내용 */
		     ,  b.ALRT_CD                               as ALRT_CD                  /* Alert코드 */
		     ,  b.RPLY_DR_ID                            as RPLY_DR_ID               /* 회신의사ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID     =   b.RPLY_DR_ID
		        )                                       as RPLY_DR_NM               /* 회신의사명 */
		     ,  to_char(b.RPLY_DT, 'yyyymmddhh24miss')  as RPLY_DT                  /* 회신일시 */
		     ,  b.APNT_CNRE_CTN                         as APNT_CNRE_CTN            /* 예약취소사유내용 */
		     ,  b.CNFM_ID                               as CNFM_ID                  /* 확인자ID */
		     ,  (   select  USER_NM
		              from  CCUSRDPHT
		             where  USER_ID     =   b.CNFM_ID
		        )                                       as CNFM_NM                  /* 확인자명 */
		     ,  to_char(b.CNFR_DT, 'yyyymmddhh24miss')  as CNFR_DT                  /* 확인일시 */
		     ,  b.CMTX_STTS_CD                          as CMTX_STTS_CD             /* 협진상태코드 */
		  from  MDOPTMDRT a
		     ,  MDOPTMRRT b
		     ,  APPTPTNTT c
		 where  b.PTNO      =   #{ptno}
		   and  b.REFR_YMD  =   to_date(#{refrYmd}, 'yyyymmdd')
		   and  b.REFR_SNO  =   #{refrSno}
		   and  b.RPLY_SNO  =   #{rplySno}
		   and  b.PTNO      =   a.PTNO
		   and  b.REFR_YMD  =   a.REFR_YMD
		   and  b.REFR_SNO  =   a.REFR_SNO
		   and  c.PTNO        = a.PTNO
		]]>
	</select>




	<resultMap id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneDummy-result" type="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO">

		<result property="newRefrSno" column="NEW_REFR_SNO"/>
		<result property="newRplySno" column="NEW_RPLY_SNO"/>
		<result property="workNm" column="WORK_NM"/>
	</resultMap>

    <!--
        SQL Name : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneDummy (selectOneDummy)
        Description :                                           selectOneDummy

		parameterType : com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO
		resultMap : com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneDummy-result
    -->
	<select id="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneDummy"  parameterType="com.sds.healthcare.ehr.med.md.mdp.vo.MdpOtptCmtxMngmDVO"  resultMap="com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneDummy-result" useCache="true" flushCache="false">
		/*SQL_ID: com-sds-healthcare-ehr-med-md-mdp-dao-MdpOtptCmtxMngmDAO-selectOneDummy */
		select  1               as NEW_REFR_SNO
		     ,  1               as NEW_RPLY_SNO
		     ,  'workName'      as WORK_NM
		  from  dual
	</select>



</mapper>